Return-Path: <linux-stm32-bounces@st-md-mailman.stormreply.com>
X-Original-To: lists+linux-stm32@lfdr.de
Delivered-To: lists+linux-stm32@lfdr.de
Received: from stm-ict-prod-mailman-01.stormreply.prv (st-md-mailman.stormreply.com [52.209.6.89])
	by mail.lfdr.de (Postfix) with ESMTPS id 41B49A9C94A
	for <lists+linux-stm32@lfdr.de>; Fri, 25 Apr 2025 14:50:30 +0200 (CEST)
Received: from ip-172-31-3-47.eu-west-1.compute.internal (localhost [127.0.0.1])
	by stm-ict-prod-mailman-01.stormreply.prv (Postfix) with ESMTP id 0560CC78F90;
	Fri, 25 Apr 2025 12:50:30 +0000 (UTC)
Received: from mx07-00178001.pphosted.com (mx08-00178001.pphosted.com
 [91.207.212.93])
 (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
 (No client certificate requested)
 by stm-ict-prod-mailman-01.stormreply.prv (Postfix) with ESMTPS id BA1CFC78F88
 for <linux-stm32@st-md-mailman.stormreply.com>;
 Fri, 25 Apr 2025 12:50:27 +0000 (UTC)
Received: from pps.filterd (m0046660.ppops.net [127.0.0.1])
 by mx07-00178001.pphosted.com (8.18.1.2/8.18.1.2) with ESMTP id 53P8APpP008990;
 Fri, 25 Apr 2025 14:50:16 +0200
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=foss.st.com; h=
 cc:content-transfer-encoding:content-type:date:from:in-reply-to
 :message-id:mime-version:references:subject:to; s=selector1; bh=
 QAvR8bHc7xRGQ12NxG7wqG8ta/oQ0TQJr7gEjuwlswM=; b=Pe2O6bkx626qqCIn
 mBAK5I/Im8w+L+7aLcWjoIN3tTqRi+tXVcyHEmGZulGee23OQfmBtHAGxgmW8CBB
 2pJ6Y+im9aqyld9fPPKqjkHDm0GFtuvrTm8CLTMQ2ThzTUo/8bt6XA5jwPVIKhfR
 PmyymUXvbBTebSo1Ua4y+1ARwZJRgG0mUJNr4whKakwg129YFxHRhUDlVxg+YUty
 zEGqAlbdzjd33syza0nf1I1kU9B9vdb7Xd7giLpppfigNd1C5wH92ZAIs06GJcgB
 BBBY8mGpvThFSBwQoHxQuhA/y+46X4zhqgehX9cDLeJrpPeIFzr1StWdGl+bGpLi
 dZ2TMw==
Received: from beta.dmz-ap.st.com (beta.dmz-ap.st.com [138.198.100.35])
 by mx07-00178001.pphosted.com (PPS) with ESMTPS id 466jjxm5s5-1
 (version=TLSv1.2 cipher=ECDHE-RSA-AES256-GCM-SHA384 bits=256 verify=NOT);
 Fri, 25 Apr 2025 14:50:16 +0200 (MEST)
Received: from euls16034.sgp.st.com (euls16034.sgp.st.com [10.75.44.20])
 by beta.dmz-ap.st.com (STMicroelectronics) with ESMTP id 2A35740057;
 Fri, 25 Apr 2025 14:49:16 +0200 (CEST)
Received: from Webmail-eu.st.com (eqndag1node5.st.com [10.75.129.134])
 by euls16034.sgp.st.com (STMicroelectronics) with ESMTP id 68E669FE6EB;
 Fri, 25 Apr 2025 14:48:08 +0200 (CEST)
Received: from SAFDAG1NODE1.st.com (10.75.90.17) by EQNDAG1NODE5.st.com
 (10.75.129.134) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256) id 15.1.2507.39; Fri, 25 Apr
 2025 14:48:08 +0200
Received: from localhost (10.252.15.6) by SAFDAG1NODE1.st.com (10.75.90.17)
 with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256) id 15.1.2507.39; Fri, 25 Apr
 2025 14:48:07 +0200
From: Fabrice Gasnier <fabrice.gasnier@foss.st.com>
To: <lee@kernel.org>, <alexandre.torgue@foss.st.com>,
 <daniel.lezcano@linaro.org>, <tglx@linutronix.de>
Date: Fri, 25 Apr 2025 14:47:52 +0200
Message-ID: <20250425124755.166193-5-fabrice.gasnier@foss.st.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20250425124755.166193-1-fabrice.gasnier@foss.st.com>
References: <20250425124755.166193-1-fabrice.gasnier@foss.st.com>
MIME-Version: 1.0
X-Originating-IP: [10.252.15.6]
X-ClientProxiedBy: EQNCAS1NODE4.st.com (10.75.129.82) To SAFDAG1NODE1.st.com
 (10.75.90.17)
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.293,Aquarius:18.0.1099,Hydra:6.0.736,FMLib:17.12.80.40
 definitions=2025-04-25_03,2025-04-24_02,2025-02-21_01
Cc: robh@kernel.org, conor+dt@kernel.org, devicetree@vger.kernel.org,
 linux-iio@vger.kernel.org, catalin.marinas@arm.com,
 linux-kernel@vger.kernel.org, linux-pwm@vger.kernel.org, ukleinek@kernel.org,
 linux-arm-kernel@lists.infradead.org, krzk+dt@kernel.org, will@kernel.org,
 linux-stm32@st-md-mailman.stormreply.com, jic23@kernel.org, wbg@kernel.org
Subject: [Linux-stm32] [PATCH v5 4/7] pwm: stm32-lp: add support for
	stm32mp25
X-BeenThere: linux-stm32@st-md-mailman.stormreply.com
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: <linux-stm32.st-md-mailman.stormreply.com>
List-Unsubscribe: <https://st-md-mailman.stormreply.com/mailman/options/linux-stm32>, 
 <mailto:linux-stm32-request@st-md-mailman.stormreply.com?subject=unsubscribe>
List-Archive: <http://st-md-mailman.stormreply.com/pipermail/linux-stm32/>
List-Post: <mailto:linux-stm32@st-md-mailman.stormreply.com>
List-Help: <mailto:linux-stm32-request@st-md-mailman.stormreply.com?subject=help>
List-Subscribe: <https://st-md-mailman.stormreply.com/mailman/listinfo/linux-stm32>, 
 <mailto:linux-stm32-request@st-md-mailman.stormreply.com?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: linux-stm32-bounces@st-md-mailman.stormreply.com
Sender: "Linux-stm32" <linux-stm32-bounces@st-md-mailman.stormreply.com>

QWRkIHN1cHBvcnQgZm9yIFNUTTMyTVAyNSBTb0MuIEEgbmV3IGNvbXBhdGlibGUgaGFzIGJlZW4g
YWRkZWQgdG8gdGhlCmR0LWJpbmRpbmdzLiBJdCByZXByZXNlbnRzIGhhbmRsZSBuZXcgZmVhdHVy
ZXMsIHJlZ2lzdGVycyBhbmQgYml0cwpkaXZlcnNpdHkuCkl0IGlzbid0IHVzZWQgY3VycmVudGx5
IGluIHRoZSBkcml2ZXIsIGFzIG1hdGNoaW5nIGlzIGRvbmUgYnkgcmV0cmlldmluZwpNRkQgcGFy
ZW50IGRhdGEuCgpOZXcgZGVkaWNhdGVkIGNhcHR1cmUvY29tcGFyZSBjaGFubmVscyBoYXMgYmVl
biBhZGRlZDogZS5nLiBhIG5ldyBjb21wYXJlCnJlZ2lzdGVyIGZvciBjaGFubmVsIDIuIFNvbWUg
Y29udHJvbHMgKHBvbGFyaXR5IC8gY2MgY2hhbm5lbCBlbmFibGUpIGFyZQpoYW5kbGVkIGluIEND
TVIgcmVnaXN0ZXIgb24gdGhpcyBuZXcgdmFyaWFudCAoaW5zdGVhZCBvZiB3YXZlcG9sIGJpdCku
CgpTbywgTG93LXBvd2VyIHRpbWVyIGNhbiBub3cgaGF2ZSB1cCB0byB0d28gUFdNIG91dHB1dHMu
IFVzZSBkZXZpY2UgZGF0YQpmcm9tIHRoZSBNRkQgcGFyZW50IHRvIGNvbmZpZ3VyZSB0aGUgbnVt
YmVyIG9mIFBXTSBjaGFubmVscyBlLmcuICducHdtJy4KClVwZGF0ZSBjdXJyZW50IGdldF9zdGF0
ZSgpIGFuZCBhcHBseSgpIG9wcyB0byBzdXBwb3J0IGVpdGhlcjoKLSBvbmUgUFdNIGNoYW5uZWwg
KGFzIG9uIG9sZGVyIHJldmlzaW9uLCBvciBMUFRJTTUgb24gU1RNMzJNUDI1KQotIHR3byBQV00g
Y2hhbm5lbHMgKGUuZy4gTFBUSU0xLzIvMy80IG9uIFNUTTMyTVAyNSB0aGF0IGhhcyB0aGUgZnVs
bAogIGZlYXR1cmUgc2V0KQpJbnRyb2R1Y2UgbmV3IHJvdXRpbmVzIHRvIG1hbmFnZSBjb21tb24g
cHJlc2NhbGVyLCByZWxvYWQgcmVnaXN0ZXIgYW5kCmdsb2JhbCBlbmFibGUgYml0LgoKQWNrZWQt
Ynk6IFV3ZSBLbGVpbmUtS8O2bmlnIDx1a2xlaW5la0BrZXJuZWwub3JnPgpTaWduZWQtb2ZmLWJ5
OiBGYWJyaWNlIEdhc25pZXIgPGZhYnJpY2UuZ2FzbmllckBmb3NzLnN0LmNvbT4KLS0tCkNoYW5n
ZXMgaW4gVjU6Ci0gQWRkIFV3ZSdzIEFja2VkLWJ5CkNoYW5nZXMgaW4gVjI6Ci0gcmVseSBvbiBm
YWxsYmFjayBjb21wYXRpYmxlIGFzIG5vIHNwZWNpZmljIC5kYXRhIGlzIGFzc29jaWF0ZWQgdG8g
dGhlCiAgZHJpdmVyLiBNYXRjaGluZyBpcyBhY2hpZXZlZCBieSB1c2luZyBNRkQgcGFyZW50IGRh
dGEuCi0gcmVuYW1lZCByZWdpc3RlcnMvYml0cyBkZWZpbnRpb25zCi0tLQogZHJpdmVycy9wd20v
cHdtLXN0bTMyLWxwLmMgfCAyMTkgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKystLS0t
LQogMSBmaWxlIGNoYW5nZWQsIDE5MyBpbnNlcnRpb25zKCspLCAyNiBkZWxldGlvbnMoLSkKCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL3B3bS9wd20tc3RtMzItbHAuYyBiL2RyaXZlcnMvcHdtL3B3bS1z
dG0zMi1scC5jCmluZGV4IDU4MzJkY2U4ZWQ5ZC4uNDc4OWVhZmI4YmFjIDEwMDY0NAotLS0gYS9k
cml2ZXJzL3B3bS9wd20tc3RtMzItbHAuYworKysgYi9kcml2ZXJzL3B3bS9wd20tc3RtMzItbHAu
YwpAQCAtMjAsNiArMjAsNyBAQAogc3RydWN0IHN0bTMyX3B3bV9scCB7CiAJc3RydWN0IGNsayAq
Y2xrOwogCXN0cnVjdCByZWdtYXAgKnJlZ21hcDsKKwl1bnNpZ25lZCBpbnQgbnVtX2NjX2NoYW5z
OwogfTsKIAogc3RhdGljIGlubGluZSBzdHJ1Y3Qgc3RtMzJfcHdtX2xwICp0b19zdG0zMl9wd21f
bHAoc3RydWN0IHB3bV9jaGlwICpjaGlwKQpAQCAtMzAsMTMgKzMxLDEwMSBAQCBzdGF0aWMgaW5s
aW5lIHN0cnVjdCBzdG0zMl9wd21fbHAgKnRvX3N0bTMyX3B3bV9scChzdHJ1Y3QgcHdtX2NoaXAg
KmNoaXApCiAvKiBTVE0zMiBMb3ctUG93ZXIgVGltZXIgaXMgcHJlY2VkZWQgYnkgYSBjb25maWd1
cmFibGUgcG93ZXItb2YtMiBwcmVzY2FsZXIgKi8KICNkZWZpbmUgU1RNMzJfTFBUSU1fTUFYX1BS
RVNDQUxFUgkxMjgKIAorc3RhdGljIGludCBzdG0zMl9wd21fbHBfdXBkYXRlX2FsbG93ZWQoc3Ry
dWN0IHN0bTMyX3B3bV9scCAqcHJpdiwgaW50IGNoYW5uZWwpCit7CisJaW50IHJldDsKKwl1MzIg
Y2NtcjE7CisJdW5zaWduZWQgbG9uZyBjY21yOworCisJLyogT25seSBvbmUgUFdNIG9uIHRoaXMg
TFBUSU1FUjogZW5hYmxlLCBwcmVzY2FsZXIgYW5kIHJlbG9hZCB2YWx1ZSBjYW4gYmUgY2hhbmdl
ZCAqLworCWlmICghcHJpdi0+bnVtX2NjX2NoYW5zKQorCQlyZXR1cm4gdHJ1ZTsKKworCXJldCA9
IHJlZ21hcF9yZWFkKHByaXYtPnJlZ21hcCwgU1RNMzJfTFBUSU1fQ0NNUjEsICZjY21yMSk7CisJ
aWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKwljY21yID0gY2NtcjEgJiAoU1RNMzJfTFBUSU1fQ0Mx
RSB8IFNUTTMyX0xQVElNX0NDMkUpOworCisJLyogTW9yZSB0aGFuIG9uZSBjaGFubmVsIGVuYWJs
ZWQ6IGVuYWJsZSwgcHJlc2NhbGVyIG9yIEFSUiB2YWx1ZSBjYW4ndCBiZSBjaGFuZ2VkICovCisJ
aWYgKGJpdG1hcF93ZWlnaHQoJmNjbXIsIHNpemVvZih1MzIpICogQklUU19QRVJfQllURSkgPiAx
KQorCQlyZXR1cm4gZmFsc2U7CisKKwkvKgorCSAqIE9ubHkgb25lIGNoYW5uZWwgaXMgZW5hYmxl
ZCAob3Igbm9uZSk6IGNoZWNrIHN0YXR1cyBvbiB0aGUgb3RoZXIgY2hhbm5lbCwgdG8KKwkgKiBy
ZXBvcnQgaWYgZW5hYmxlLCBwcmVzY2FsZXIgb3IgQVJSIHZhbHVlIGNhbiBiZSBjaGFuZ2VkLgor
CSAqLworCWlmIChjaGFubmVsKQorCQlyZXR1cm4gIShjY21yMSAmIFNUTTMyX0xQVElNX0NDMUUp
OworCWVsc2UKKwkJcmV0dXJuICEoY2NtcjEgJiBTVE0zMl9MUFRJTV9DQzJFKTsKK30KKworc3Rh
dGljIGludCBzdG0zMl9wd21fbHBfY29tcGFyZV9jaGFubmVsX2FwcGx5KHN0cnVjdCBzdG0zMl9w
d21fbHAgKnByaXYsIGludCBjaGFubmVsLAorCQkJCQkgICAgICBib29sIGVuYWJsZSwgZW51bSBw
d21fcG9sYXJpdHkgcG9sYXJpdHkpCit7CisJdTMyIGNjbXIxLCB2YWwsIG1hc2s7CisJYm9vbCBy
ZWVuYWJsZTsKKwlpbnQgcmV0OworCisJLyogTm8gZGVkaWNhdGVkIENDIGNoYW5uZWw6IG5vdGhp
bmcgdG8gZG8gKi8KKwlpZiAoIXByaXYtPm51bV9jY19jaGFucykKKwkJcmV0dXJuIDA7CisKKwly
ZXQgPSByZWdtYXBfcmVhZChwcml2LT5yZWdtYXAsIFNUTTMyX0xQVElNX0NDTVIxLCAmY2NtcjEp
OworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlpZiAoY2hhbm5lbCkgeworCQkvKiBNdXN0
IGRpc2FibGUgQ0MgY2hhbm5lbCAoQ0N4RSkgdG8gbW9kaWZ5IHBvbGFyaXR5IChDQ3hQKSwgdGhl
biByZS1lbmFibGUgKi8KKwkJcmVlbmFibGUgPSAoZW5hYmxlICYmIEZJRUxEX0dFVChTVE0zMl9M
UFRJTV9DQzJFLCBjY21yMSkpICYmCisJCQkocG9sYXJpdHkgIT0gRklFTERfR0VUKFNUTTMyX0xQ
VElNX0NDMlAsIGNjbXIxKSk7CisKKwkJbWFzayA9IFNUTTMyX0xQVElNX0NDMlNFTCB8IFNUTTMy
X0xQVElNX0NDMkUgfCBTVE0zMl9MUFRJTV9DQzJQOworCQl2YWwgPSBGSUVMRF9QUkVQKFNUTTMy
X0xQVElNX0NDMlAsIHBvbGFyaXR5KTsKKwkJdmFsIHw9IEZJRUxEX1BSRVAoU1RNMzJfTFBUSU1f
Q0MyRSwgZW5hYmxlKTsKKwl9IGVsc2UgeworCQlyZWVuYWJsZSA9IChlbmFibGUgJiYgRklFTERf
R0VUKFNUTTMyX0xQVElNX0NDMUUsIGNjbXIxKSkgJiYKKwkJCShwb2xhcml0eSAhPSBGSUVMRF9H
RVQoU1RNMzJfTFBUSU1fQ0MxUCwgY2NtcjEpKTsKKworCQltYXNrID0gU1RNMzJfTFBUSU1fQ0Mx
U0VMIHwgU1RNMzJfTFBUSU1fQ0MxRSB8IFNUTTMyX0xQVElNX0NDMVA7CisJCXZhbCA9IEZJRUxE
X1BSRVAoU1RNMzJfTFBUSU1fQ0MxUCwgcG9sYXJpdHkpOworCQl2YWwgfD0gRklFTERfUFJFUChT
VE0zMl9MUFRJTV9DQzFFLCBlbmFibGUpOworCX0KKworCWlmIChyZWVuYWJsZSkgeworCQl1MzIg
Y2ZnciwgcHJlc2M7CisJCXVuc2lnbmVkIGxvbmcgcmF0ZTsKKwkJdW5zaWduZWQgaW50IGRlbGF5
X3VzOworCisJCXJldCA9IHJlZ21hcF91cGRhdGVfYml0cyhwcml2LT5yZWdtYXAsIFNUTTMyX0xQ
VElNX0NDTVIxLAorCQkJCQkgY2hhbm5lbCA/IFNUTTMyX0xQVElNX0NDMkUgOiBTVE0zMl9MUFRJ
TV9DQzFFLCAwKTsKKwkJaWYgKHJldCkKKwkJCXJldHVybiByZXQ7CisJCS8qCisJCSAqIEFmdGVy
IGEgd3JpdGUgdG8gdGhlIExQVElNX0NDTVJ4IHJlZ2lzdGVyLCBhIG5ldyB3cml0ZSBvcGVyYXRp
b24gY2FuIG9ubHkgYmUKKwkJICogcGVyZm9ybWVkIGFmdGVyIGEgZGVsYXkgb2YgYXQgbGVhc3Qg
KFBSRVNDIMOXIDMpIGNsb2NrIGN5Y2xlcworCQkgKi8KKwkJcmV0ID0gcmVnbWFwX3JlYWQocHJp
di0+cmVnbWFwLCBTVE0zMl9MUFRJTV9DRkdSLCAmY2Zncik7CisJCWlmIChyZXQpCisJCQlyZXR1
cm4gcmV0OworCQlwcmVzYyA9IEZJRUxEX0dFVChTVE0zMl9MUFRJTV9QUkVTQywgY2Zncik7CisJ
CXJhdGUgPSBjbGtfZ2V0X3JhdGUocHJpdi0+Y2xrKSA+PiBwcmVzYzsKKwkJaWYgKCFyYXRlKQor
CQkJcmV0dXJuIC1FSU5WQUw7CisJCWRlbGF5X3VzID0gMyAqIERJVl9ST1VORF9VUChVU0VDX1BF
Ul9TRUMsIHJhdGUpOworCQl1c2xlZXBfcmFuZ2UoZGVsYXlfdXMsIGRlbGF5X3VzICogMik7CisJ
fQorCisJcmV0dXJuIHJlZ21hcF91cGRhdGVfYml0cyhwcml2LT5yZWdtYXAsIFNUTTMyX0xQVElN
X0NDTVIxLCBtYXNrLCB2YWwpOworfQorCiBzdGF0aWMgaW50IHN0bTMyX3B3bV9scF9hcHBseShz
dHJ1Y3QgcHdtX2NoaXAgKmNoaXAsIHN0cnVjdCBwd21fZGV2aWNlICpwd20sCiAJCQkgICAgICBj
b25zdCBzdHJ1Y3QgcHdtX3N0YXRlICpzdGF0ZSkKIHsKIAlzdHJ1Y3Qgc3RtMzJfcHdtX2xwICpw
cml2ID0gdG9fc3RtMzJfcHdtX2xwKGNoaXApOwogCXVuc2lnbmVkIGxvbmcgbG9uZyBwcmQsIGRp
diwgZHR5OwogCXN0cnVjdCBwd21fc3RhdGUgY3N0YXRlOwotCXUzMiB2YWwsIG1hc2ssIGNmZ3Is
IHByZXNjID0gMDsKKwl1MzIgYXJyLCB2YWwsIG1hc2ssIGNmZ3IsIHByZXNjID0gMDsKIAlib29s
IHJlZW5hYmxlOwogCWludCByZXQ7CiAKQEAgLTQ1LDEwICsxMzQsMjggQEAgc3RhdGljIGludCBz
dG0zMl9wd21fbHBfYXBwbHkoc3RydWN0IHB3bV9jaGlwICpjaGlwLCBzdHJ1Y3QgcHdtX2Rldmlj
ZSAqcHdtLAogCiAJaWYgKCFzdGF0ZS0+ZW5hYmxlZCkgewogCQlpZiAoY3N0YXRlLmVuYWJsZWQp
IHsKLQkJCS8qIERpc2FibGUgTFAgdGltZXIgKi8KLQkJCXJldCA9IHJlZ21hcF93cml0ZShwcml2
LT5yZWdtYXAsIFNUTTMyX0xQVElNX0NSLCAwKTsKKwkJCS8qIERpc2FibGUgQ0MgY2hhbm5lbCBp
ZiBhbnkgKi8KKwkJCXJldCA9IHN0bTMyX3B3bV9scF9jb21wYXJlX2NoYW5uZWxfYXBwbHkocHJp
diwgcHdtLT5od3B3bSwgZmFsc2UsCisJCQkJCQkJCSBzdGF0ZS0+cG9sYXJpdHkpOwogCQkJaWYg
KHJldCkKIAkJCQlyZXR1cm4gcmV0OworCQkJcmV0ID0gcmVnbWFwX3dyaXRlKHByaXYtPnJlZ21h
cCwgcHdtLT5od3B3bSA/CisJCQkJCSAgIFNUTTMyX0xQVElNX0NDUjIgOiBTVE0zMl9MUFRJTV9D
TVAsIDApOworCQkJaWYgKHJldCkKKwkJCQlyZXR1cm4gcmV0OworCisJCQkvKiBDaGVjayBpZiB0
aGUgdGltZXIgY2FuIGJlIGRpc2FibGVkICovCisJCQlyZXQgPSBzdG0zMl9wd21fbHBfdXBkYXRl
X2FsbG93ZWQocHJpdiwgcHdtLT5od3B3bSk7CisJCQlpZiAocmV0IDwgMCkKKwkJCQlyZXR1cm4g
cmV0OworCisJCQlpZiAocmV0KSB7CisJCQkJLyogRGlzYWJsZSBMUCB0aW1lciAqLworCQkJCXJl
dCA9IHJlZ21hcF93cml0ZShwcml2LT5yZWdtYXAsIFNUTTMyX0xQVElNX0NSLCAwKTsKKwkJCQlp
ZiAocmV0KQorCQkJCQlyZXR1cm4gcmV0OworCQkJfQorCiAJCQkvKiBkaXNhYmxlIGNsb2NrIHRv
IFBXTSBjb3VudGVyICovCiAJCQljbGtfZGlzYWJsZShwcml2LT5jbGspOwogCQl9CkBAIC03OSw2
ICsxODYsMjMgQEAgc3RhdGljIGludCBzdG0zMl9wd21fbHBfYXBwbHkoc3RydWN0IHB3bV9jaGlw
ICpjaGlwLCBzdHJ1Y3QgcHdtX2RldmljZSAqcHdtLAogCWR0eSA9IHByZCAqIHN0YXRlLT5kdXR5
X2N5Y2xlOwogCWRvX2RpdihkdHksIHN0YXRlLT5wZXJpb2QpOwogCisJcmV0ID0gcmVnbWFwX3Jl
YWQocHJpdi0+cmVnbWFwLCBTVE0zMl9MUFRJTV9DRkdSLCAmY2Zncik7CisJaWYgKHJldCkKKwkJ
cmV0dXJuIHJldDsKKworCS8qCisJICogV2hlbiB0aGVyZSBhcmUgc2V2ZXJhbCBjaGFubmVscywg
dGhleSBzaGFyZSB0aGUgc2FtZSBwcmVzY2FsZXIgYW5kIHJlbG9hZCB2YWx1ZS4KKwkgKiBDaGVj
ayBpZiB0aGlzIGNhbiBiZSBjaGFuZ2VkLCBvciB0aGUgdmFsdWVzIGFyZSB0aGUgc2FtZSBmb3Ig
YWxsIGNoYW5uZWxzLgorCSAqLworCWlmICghc3RtMzJfcHdtX2xwX3VwZGF0ZV9hbGxvd2VkKHBy
aXYsIHB3bS0+aHdwd20pKSB7CisJCXJldCA9IHJlZ21hcF9yZWFkKHByaXYtPnJlZ21hcCwgU1RN
MzJfTFBUSU1fQVJSLCAmYXJyKTsKKwkJaWYgKHJldCkKKwkJCXJldHVybiByZXQ7CisKKwkJaWYg
KChGSUVMRF9HRVQoU1RNMzJfTFBUSU1fUFJFU0MsIGNmZ3IpICE9IHByZXNjKSB8fCAoYXJyICE9
IHByZCAtIDEpKQorCQkJcmV0dXJuIC1FQlVTWTsKKwl9CisKIAlpZiAoIWNzdGF0ZS5lbmFibGVk
KSB7CiAJCS8qIGVuYWJsZSBjbG9jayB0byBkcml2ZSBQV00gY291bnRlciAqLwogCQlyZXQgPSBj
bGtfZW5hYmxlKHByaXYtPmNsayk7CkBAIC04NiwxNSArMjEwLDIwIEBAIHN0YXRpYyBpbnQgc3Rt
MzJfcHdtX2xwX2FwcGx5KHN0cnVjdCBwd21fY2hpcCAqY2hpcCwgc3RydWN0IHB3bV9kZXZpY2Ug
KnB3bSwKIAkJCXJldHVybiByZXQ7CiAJfQogCi0JcmV0ID0gcmVnbWFwX3JlYWQocHJpdi0+cmVn
bWFwLCBTVE0zMl9MUFRJTV9DRkdSLCAmY2Zncik7Ci0JaWYgKHJldCkKLQkJZ290byBlcnI7Ci0K
IAlpZiAoKEZJRUxEX0dFVChTVE0zMl9MUFRJTV9QUkVTQywgY2ZncikgIT0gcHJlc2MpIHx8Ci0J
ICAgIChGSUVMRF9HRVQoU1RNMzJfTFBUSU1fV0FWUE9MLCBjZmdyKSAhPSBzdGF0ZS0+cG9sYXJp
dHkpKSB7CisJICAgICgoRklFTERfR0VUKFNUTTMyX0xQVElNX1dBVlBPTCwgY2ZncikgIT0gc3Rh
dGUtPnBvbGFyaXR5KSAmJiAhcHJpdi0+bnVtX2NjX2NoYW5zKSkgewogCQl2YWwgPSBGSUVMRF9Q
UkVQKFNUTTMyX0xQVElNX1BSRVNDLCBwcmVzYyk7Ci0JCXZhbCB8PSBGSUVMRF9QUkVQKFNUTTMy
X0xQVElNX1dBVlBPTCwgc3RhdGUtPnBvbGFyaXR5KTsKLQkJbWFzayA9IFNUTTMyX0xQVElNX1BS
RVNDIHwgU1RNMzJfTFBUSU1fV0FWUE9MOworCQltYXNrID0gU1RNMzJfTFBUSU1fUFJFU0M7CisK
KwkJaWYgKCFwcml2LT5udW1fY2NfY2hhbnMpIHsKKwkJCS8qCisJCQkgKiBXQVZQT0wgYml0IGlz
IG9ubHkgYXZhaWxhYmxlIHdoZW4gbm8gY2FwYXR1cmUgY29tcGFyZSBjaGFubmVsIGlzIHVzZWQs
CisJCQkgKiBlLmcuIG9uIExQVElNRVIgaW5zdGFuY2VzIHRoYXQgaGF2ZSBvbmx5IG9uZSBvdXRw
dXQgY2hhbm5lbC4gQ0NNUjEgaXMKKwkJCSAqIHVzZWQgb3RoZXJ3aXNlLgorCQkJICovCisJCQl2
YWwgfD0gRklFTERfUFJFUChTVE0zMl9MUFRJTV9XQVZQT0wsIHN0YXRlLT5wb2xhcml0eSk7CisJ
CQltYXNrIHw9IFNUTTMyX0xQVElNX1dBVlBPTDsKKwkJfQogCiAJCS8qIE11c3QgZGlzYWJsZSBM
UCB0aW1lciB0byBtb2RpZnkgQ0ZHUiAqLwogCQlyZWVuYWJsZSA9IHRydWU7CkBAIC0xMjAsMjAg
KzI0OSwyNyBAQCBzdGF0aWMgaW50IHN0bTMyX3B3bV9scF9hcHBseShzdHJ1Y3QgcHdtX2NoaXAg
KmNoaXAsIHN0cnVjdCBwd21fZGV2aWNlICpwd20sCiAJaWYgKHJldCkKIAkJZ290byBlcnI7CiAK
LQlyZXQgPSByZWdtYXBfd3JpdGUocHJpdi0+cmVnbWFwLCBTVE0zMl9MUFRJTV9DTVAsIHByZCAt
ICgxICsgZHR5KSk7CisJLyogV3JpdGUgQ01QL0NDUnggcmVnaXN0ZXIgYW5kIGVuc3VyZSBpdCdz
IGJlZW4gcHJvcGVybHkgd3JpdHRlbiAqLworCXJldCA9IHJlZ21hcF93cml0ZShwcml2LT5yZWdt
YXAsIHB3bS0+aHdwd20gPyBTVE0zMl9MUFRJTV9DQ1IyIDogU1RNMzJfTFBUSU1fQ01QLAorCQkJ
ICAgcHJkIC0gKDEgKyBkdHkpKTsKIAlpZiAocmV0KQogCQlnb3RvIGVycjsKIAotCS8qIGVuc3Vy
ZSBDTVAgJiBBUlIgcmVnaXN0ZXJzIGFyZSBwcm9wZXJseSB3cml0dGVuICovCi0JcmV0ID0gcmVn
bWFwX3JlYWRfcG9sbF90aW1lb3V0KHByaXYtPnJlZ21hcCwgU1RNMzJfTFBUSU1fSVNSLCB2YWws
CisJLyogZW5zdXJlIEFSUiBhbmQgQ01QL0NDUnggcmVnaXN0ZXJzIGFyZSBwcm9wZXJseSB3cml0
dGVuICovCisJcmV0ID0gcmVnbWFwX3JlYWRfcG9sbF90aW1lb3V0KHByaXYtPnJlZ21hcCwgU1RN
MzJfTFBUSU1fSVNSLCB2YWwsIHB3bS0+aHdwd20gPworCQkJCSAgICAgICAodmFsICYgU1RNMzJf
TFBUSU1fQ01QMl9BUlJPSykgPT0gU1RNMzJfTFBUSU1fQ01QMl9BUlJPSyA6CiAJCQkJICAgICAg
ICh2YWwgJiBTVE0zMl9MUFRJTV9DTVBPS19BUlJPSykgPT0gU1RNMzJfTFBUSU1fQ01QT0tfQVJS
T0ssCiAJCQkJICAgICAgIDEwMCwgMTAwMCk7CiAJaWYgKHJldCkgewogCQlkZXZfZXJyKHB3bWNo
aXBfcGFyZW50KGNoaXApLCAiQVJSL0NNUCByZWdpc3RlcnMgd3JpdGUgaXNzdWVcbiIpOwogCQln
b3RvIGVycjsKIAl9Ci0JcmV0ID0gcmVnbWFwX3dyaXRlKHByaXYtPnJlZ21hcCwgU1RNMzJfTFBU
SU1fSUNSLAotCQkJICAgU1RNMzJfTFBUSU1fQ01QT0tDRl9BUlJPS0NGKTsKKwlyZXQgPSByZWdt
YXBfd3JpdGUocHJpdi0+cmVnbWFwLCBTVE0zMl9MUFRJTV9JQ1IsIHB3bS0+aHdwd20gPworCQkJ
ICAgU1RNMzJfTFBUSU1fQ01QMk9LQ0ZfQVJST0tDRiA6IFNUTTMyX0xQVElNX0NNUE9LQ0ZfQVJS
T0tDRik7CisJaWYgKHJldCkKKwkJZ290byBlcnI7CisKKwlyZXQgPSBzdG0zMl9wd21fbHBfY29t
cGFyZV9jaGFubmVsX2FwcGx5KHByaXYsIHB3bS0+aHdwd20sIHRydWUsIHN0YXRlLT5wb2xhcml0
eSk7CiAJaWYgKHJldCkKIAkJZ290byBlcnI7CiAKQEAgLTE2MSwxMSArMjk3LDIyIEBAIHN0YXRp
YyBpbnQgc3RtMzJfcHdtX2xwX2dldF9zdGF0ZShzdHJ1Y3QgcHdtX2NoaXAgKmNoaXAsCiB7CiAJ
c3RydWN0IHN0bTMyX3B3bV9scCAqcHJpdiA9IHRvX3N0bTMyX3B3bV9scChjaGlwKTsKIAl1bnNp
Z25lZCBsb25nIHJhdGUgPSBjbGtfZ2V0X3JhdGUocHJpdi0+Y2xrKTsKLQl1MzIgdmFsLCBwcmVz
YywgcHJkOworCXUzMiB2YWwsIHByZXNjLCBwcmQsIGNjbXIxOworCWJvb2wgZW5hYmxlZDsKIAl1
NjQgdG1wOwogCiAJcmVnbWFwX3JlYWQocHJpdi0+cmVnbWFwLCBTVE0zMl9MUFRJTV9DUiwgJnZh
bCk7Ci0Jc3RhdGUtPmVuYWJsZWQgPSAhIUZJRUxEX0dFVChTVE0zMl9MUFRJTV9FTkFCTEUsIHZh
bCk7CisJZW5hYmxlZCA9ICEhRklFTERfR0VUKFNUTTMyX0xQVElNX0VOQUJMRSwgdmFsKTsKKwlp
ZiAocHJpdi0+bnVtX2NjX2NoYW5zKSB7CisJCS8qIFRoZXJlJ3MgYSBDQyBjaGFuLCBuZWVkIHRv
IGFsc28gY2hlY2sgaWYgaXQncyBlbmFibGVkICovCisJCXJlZ21hcF9yZWFkKHByaXYtPnJlZ21h
cCwgU1RNMzJfTFBUSU1fQ0NNUjEsICZjY21yMSk7CisJCWlmIChwd20tPmh3cHdtKQorCQkJZW5h
YmxlZCAmPSAhIUZJRUxEX0dFVChTVE0zMl9MUFRJTV9DQzJFLCBjY21yMSk7CisJCWVsc2UKKwkJ
CWVuYWJsZWQgJj0gISFGSUVMRF9HRVQoU1RNMzJfTFBUSU1fQ0MxRSwgY2NtcjEpOworCX0KKwlz
dGF0ZS0+ZW5hYmxlZCA9IGVuYWJsZWQ7CisKIAkvKiBLZWVwIFBXTSBjb3VudGVyIGNsb2NrIHJl
ZmNvdW50IGluIHN5bmMgd2l0aCBQV00gaW5pdGlhbCBzdGF0ZSAqLwogCWlmIChzdGF0ZS0+ZW5h
YmxlZCkgewogCQlpbnQgcmV0ID0gY2xrX2VuYWJsZShwcml2LT5jbGspOwpAQCAtMTc2LDE0ICsz
MjMsMjEgQEAgc3RhdGljIGludCBzdG0zMl9wd21fbHBfZ2V0X3N0YXRlKHN0cnVjdCBwd21fY2hp
cCAqY2hpcCwKIAogCXJlZ21hcF9yZWFkKHByaXYtPnJlZ21hcCwgU1RNMzJfTFBUSU1fQ0ZHUiwg
JnZhbCk7CiAJcHJlc2MgPSBGSUVMRF9HRVQoU1RNMzJfTFBUSU1fUFJFU0MsIHZhbCk7Ci0Jc3Rh
dGUtPnBvbGFyaXR5ID0gRklFTERfR0VUKFNUTTMyX0xQVElNX1dBVlBPTCwgdmFsKTsKKwlpZiAo
cHJpdi0+bnVtX2NjX2NoYW5zKSB7CisJCWlmIChwd20tPmh3cHdtKQorCQkJc3RhdGUtPnBvbGFy
aXR5ID0gRklFTERfR0VUKFNUTTMyX0xQVElNX0NDMlAsIGNjbXIxKTsKKwkJZWxzZQorCQkJc3Rh
dGUtPnBvbGFyaXR5ID0gRklFTERfR0VUKFNUTTMyX0xQVElNX0NDMVAsIGNjbXIxKTsKKwl9IGVs
c2UgeworCQlzdGF0ZS0+cG9sYXJpdHkgPSBGSUVMRF9HRVQoU1RNMzJfTFBUSU1fV0FWUE9MLCB2
YWwpOworCX0KIAogCXJlZ21hcF9yZWFkKHByaXYtPnJlZ21hcCwgU1RNMzJfTFBUSU1fQVJSLCAm
cHJkKTsKIAl0bXAgPSBwcmQgKyAxOwogCXRtcCA9ICh0bXAgPDwgcHJlc2MpICogTlNFQ19QRVJf
U0VDOwogCXN0YXRlLT5wZXJpb2QgPSBESVZfUk9VTkRfQ0xPU0VTVF9VTEwodG1wLCByYXRlKTsK
IAotCXJlZ21hcF9yZWFkKHByaXYtPnJlZ21hcCwgU1RNMzJfTFBUSU1fQ01QLCAmdmFsKTsKKwly
ZWdtYXBfcmVhZChwcml2LT5yZWdtYXAsIHB3bS0+aHdwd20gPyBTVE0zMl9MUFRJTV9DQ1IyIDog
U1RNMzJfTFBUSU1fQ01QLCAmdmFsKTsKIAl0bXAgPSBwcmQgLSB2YWw7CiAJdG1wID0gKHRtcCA8
PCBwcmVzYykgKiBOU0VDX1BFUl9TRUM7CiAJc3RhdGUtPmR1dHlfY3ljbGUgPSBESVZfUk9VTkRf
Q0xPU0VTVF9VTEwodG1wLCByYXRlKTsKQEAgLTIwMSwxNSArMzU1LDI1IEBAIHN0YXRpYyBpbnQg
c3RtMzJfcHdtX2xwX3Byb2JlKHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYpCiAJc3RydWN0
IHN0bTMyX2xwdGltZXIgKmRkYXRhID0gZGV2X2dldF9kcnZkYXRhKHBkZXYtPmRldi5wYXJlbnQp
OwogCXN0cnVjdCBzdG0zMl9wd21fbHAgKnByaXY7CiAJc3RydWN0IHB3bV9jaGlwICpjaGlwOwor
CXVuc2lnbmVkIGludCBucHdtOwogCWludCByZXQ7CiAKLQljaGlwID0gZGV2bV9wd21jaGlwX2Fs
bG9jKCZwZGV2LT5kZXYsIDEsIHNpemVvZigqcHJpdikpOworCWlmICghZGRhdGEtPm51bV9jY19j
aGFucykgeworCQkvKiBObyBkZWRpY2F0ZWQgQ0MgY2hhbm5lbCwgc28gdGhlcmUncyBvbmx5IG9u
ZSBQV00gY2hhbm5lbCAqLworCQlucHdtID0gMTsKKwl9IGVsc2UgeworCQkvKiBUaGVyZSBhcmUg
ZGVkaWNhdGVkIENDIGNoYW5uZWxzLCBlYWNoIHdpdGggb25lIFBXTSBvdXRwdXQgKi8KKwkJbnB3
bSA9IGRkYXRhLT5udW1fY2NfY2hhbnM7CisJfQorCisJY2hpcCA9IGRldm1fcHdtY2hpcF9hbGxv
YygmcGRldi0+ZGV2LCBucHdtLCBzaXplb2YoKnByaXYpKTsKIAlpZiAoSVNfRVJSKGNoaXApKQog
CQlyZXR1cm4gUFRSX0VSUihjaGlwKTsKIAlwcml2ID0gdG9fc3RtMzJfcHdtX2xwKGNoaXApOwog
CiAJcHJpdi0+cmVnbWFwID0gZGRhdGEtPnJlZ21hcDsKIAlwcml2LT5jbGsgPSBkZGF0YS0+Y2xr
OworCXByaXYtPm51bV9jY19jaGFucyA9IGRkYXRhLT5udW1fY2NfY2hhbnM7CiAJY2hpcC0+b3Bz
ID0gJnN0bTMyX3B3bV9scF9vcHM7CiAKIAlyZXQgPSBkZXZtX3B3bWNoaXBfYWRkKCZwZGV2LT5k
ZXYsIGNoaXApOwpAQCAtMjI1LDEyICszODksMTUgQEAgc3RhdGljIGludCBzdG0zMl9wd21fbHBf
c3VzcGVuZChzdHJ1Y3QgZGV2aWNlICpkZXYpCiB7CiAJc3RydWN0IHB3bV9jaGlwICpjaGlwID0g
ZGV2X2dldF9kcnZkYXRhKGRldik7CiAJc3RydWN0IHB3bV9zdGF0ZSBzdGF0ZTsKLQotCXB3bV9n
ZXRfc3RhdGUoJmNoaXAtPnB3bXNbMF0sICZzdGF0ZSk7Ci0JaWYgKHN0YXRlLmVuYWJsZWQpIHsK
LQkJZGV2X2VycihkZXYsICJUaGUgY29uc3VtZXIgZGlkbid0IHN0b3AgdXMgKCVzKVxuIiwKLQkJ
CWNoaXAtPnB3bXNbMF0ubGFiZWwpOwotCQlyZXR1cm4gLUVCVVNZOworCXVuc2lnbmVkIGludCBp
OworCisJZm9yIChpID0gMDsgaSA8IGNoaXAtPm5wd207IGkrKykgeworCQlwd21fZ2V0X3N0YXRl
KCZjaGlwLT5wd21zW2ldLCAmc3RhdGUpOworCQlpZiAoc3RhdGUuZW5hYmxlZCkgeworCQkJZGV2
X2VycihkZXYsICJUaGUgY29uc3VtZXIgZGlkbid0IHN0b3AgdXMgKCVzKVxuIiwKKwkJCQljaGlw
LT5wd21zW2ldLmxhYmVsKTsKKwkJCXJldHVybiAtRUJVU1k7CisJCX0KIAl9CiAKIAlyZXR1cm4g
cGluY3RybF9wbV9zZWxlY3Rfc2xlZXBfc3RhdGUoZGV2KTsKLS0gCjIuMjUuMQoKX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KTGludXgtc3RtMzIgbWFpbGlu
ZyBsaXN0CkxpbnV4LXN0bTMyQHN0LW1kLW1haWxtYW4uc3Rvcm1yZXBseS5jb20KaHR0cHM6Ly9z
dC1tZC1tYWlsbWFuLnN0b3JtcmVwbHkuY29tL21haWxtYW4vbGlzdGluZm8vbGludXgtc3RtMzIK
