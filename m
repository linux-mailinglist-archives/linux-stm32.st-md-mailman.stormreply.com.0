Return-Path: <linux-stm32-bounces@st-md-mailman.stormreply.com>
X-Original-To: lists+linux-stm32@lfdr.de
Delivered-To: lists+linux-stm32@lfdr.de
Received: from stm-ict-prod-mailman-01.stormreply.prv (st-md-mailman.stormreply.com [52.209.6.89])
	by mail.lfdr.de (Postfix) with ESMTPS id 0D99292A089
	for <lists+linux-stm32@lfdr.de>; Mon,  8 Jul 2024 12:53:04 +0200 (CEST)
Received: from ip-172-31-3-47.eu-west-1.compute.internal (localhost [127.0.0.1])
	by stm-ict-prod-mailman-01.stormreply.prv (Postfix) with ESMTP id B8AAAC6DD9D;
	Mon,  8 Jul 2024 10:53:03 +0000 (UTC)
Received: from mail-lj1-f177.google.com (mail-lj1-f177.google.com
 [209.85.208.177])
 (using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits))
 (No client certificate requested)
 by stm-ict-prod-mailman-01.stormreply.prv (Postfix) with ESMTPS id 7890FC6DD72
 for <linux-stm32@st-md-mailman.stormreply.com>;
 Mon,  8 Jul 2024 10:52:59 +0000 (UTC)
Received: by mail-lj1-f177.google.com with SMTP id
 38308e7fff4ca-2eeb1051360so1737031fa.0
 for <linux-stm32@st-md-mailman.stormreply.com>;
 Mon, 08 Jul 2024 03:52:59 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=baylibre-com.20230601.gappssmtp.com; s=20230601; t=1720435978; x=1721040778;
 darn=st-md-mailman.stormreply.com; 
 h=content-transfer-encoding:mime-version:references:in-reply-to
 :message-id:date:subject:cc:to:from:from:to:cc:subject:date
 :message-id:reply-to;
 bh=Mpt6NFsPkisaY1MwVr6kXrTsatrXRavGiwZl9130ebI=;
 b=DF1CkQUIVkiBLA3O+hg85GmDP0lmNa/bMITJU3NXiSIyLL83DCvBt8GaE/5hsDeBBQ
 ORQoInx9Q/3KlZvDtk8VL9sFn8CvwQYJwKbIODwMpj2YuKOeqiEvH53Vf1u6W9pEjNlq
 5z0bHxTz0dQhbYLETte3cyHNB8aoU1h4IHSQALuJEg9MBBw5nxBUD2UIlVbe1D5d8T29
 xKNfUYZOtA1RmXonvl/N5GZViDzrFdlY8rYYkFyioDOmkNVcCikarszIuB9f1kUYv9uU
 NSBUgIgC2yutdzpDU6Xb4epBTf8877dbDsIcj8HW3tis2l/GBGmhgbVqtbdkBFDHfHyl
 PdTw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20230601; t=1720435978; x=1721040778;
 h=content-transfer-encoding:mime-version:references:in-reply-to
 :message-id:date:subject:cc:to:from:x-gm-message-state:from:to:cc
 :subject:date:message-id:reply-to;
 bh=Mpt6NFsPkisaY1MwVr6kXrTsatrXRavGiwZl9130ebI=;
 b=gPg3FlWJ+7L3zxq/QmQnps1i2W9XgkOb1Nl1FJtvCC6fXi7b4UocpWdMPeEGYhpp8Q
 hAQ+BPqHcdfzvFJs8DXfMByk4slf/ojwpa+qTx+Iat5wefvEZWVl8deAtNk9fkSj7+IP
 Ty5BVMXINY5B2Qoc6QC+iesapDX2sreIiC9z32rcJUtBkKlEZ48rjoN9xhtG+IeL7wpL
 2dWbm1SdcuXkQ0EsVK46LtY100m/sdLjGk+hOgMyfjYPa/M7XJTU1LbeYZk8q+j1gxOv
 TFF9Fd9K+pRwNB3VIfgloA6ApadHhA7y6Gz4cPsijvMDFEfkfQfzXQtm2q1yksQKgNHR
 ggSA==
X-Forwarded-Encrypted: i=1;
 AJvYcCWeZydQNpgE1n/ERniERfP3WqFS5lntIAf9SSAhztGYpLKXHYFv1b3z1QecIu/QWDWRAQBJGkNraiDQxu7WDMY7M9qWtJBMTaus0G9cjNPuUKcSeoekz46e
X-Gm-Message-State: AOJu0Ywf0BI9PuGECj9E+wjp4DBIptkiqjVAvObaFeqJabIa3WgdsAjp
 wDdCJWXZbecJ+1bhuLA2trjTPQmvEqUIgDAIziw9t7KyEfo6pMgWDP/Sj9nqJfg=
X-Google-Smtp-Source: AGHT+IG1Kyf6+PqZfCJhkCxwpP2yCSENJwwTLW1fympL37tJ+rPZDfY6sUvPMiFk+1HfICML4Msv1A==
X-Received: by 2002:a2e:3c03:0:b0:2ee:4ccf:ca4f with SMTP id
 38308e7fff4ca-2ee8eda42e4mr71360861fa.31.1720435978299; 
 Mon, 08 Jul 2024 03:52:58 -0700 (PDT)
Received: from localhost (p50915e7b.dip0.t-ipconnect.de. [80.145.94.123])
 by smtp.gmail.com with ESMTPSA id
 5b1f17b1804b1-4264d6d41cesm147133775e9.16.2024.07.08.03.52.57
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Mon, 08 Jul 2024 03:52:57 -0700 (PDT)
From: =?UTF-8?q?Uwe=20Kleine-K=C3=B6nig?= <u.kleine-koenig@baylibre.com>
To: linux-pwm@vger.kernel.org
Date: Mon,  8 Jul 2024 12:52:28 +0200
Message-ID: <6f7deef208bf25baad7daa8ff35621fb68e7aeb4.1720435656.git.u.kleine-koenig@baylibre.com>
X-Mailer: git-send-email 2.43.0
In-Reply-To: <cover.1720435656.git.u.kleine-koenig@baylibre.com>
References: <cover.1720435656.git.u.kleine-koenig@baylibre.com>
MIME-Version: 1.0
X-Developer-Signature: v=1; a=openpgp-sha256; l=11779;
 i=u.kleine-koenig@baylibre.com; h=from:subject:message-id;
 bh=WQ1tdQJ8LGKBiWT+pmlsAYiB2OzWVFeNGMvJEuabIak=;
 b=owEBbQGS/pANAwAKAY+A+1h9Ev5OAcsmYgBmi8TwFCxuEN1LF0Bi0vED9Q+cPd9ZskZQXcF55
 oMB2TlxhimJATMEAAEKAB0WIQQ/gaxpOnoeWYmt/tOPgPtYfRL+TgUCZovE8AAKCRCPgPtYfRL+
 TljMB/wICzCrg5w7KNoMUuNqsfdJbLNBEN08ijU878THwEjfdMqEEiyf/2EvosUQqhrN8SIJ8FD
 C3mBTuykHKykLLd8CFhWEPxUars3SV2v4WMgGHtOlrwTXylxkkIs4V/lh4U+/75Sz4ZAmG9yYw8
 eOSPW+BO1adTvvQBxfQrIjoZkIZVhutjyZzC1H0iDPjIoae3Hk2QZSrdVHGXapkYr40R+ejemv0
 9N6rbGa6SmnSAzYrHn8ONV8DCiC5hbLOQKPwNWyydYaVuX4H84Kit07laJFpsNMaarvsAMZF7tz
 uaN4kHZmyxnFsObDq+QrMgh2hKFTFpRVvpEMvaZ50E/mx3wM
X-Developer-Key: i=u.kleine-koenig@baylibre.com; a=openpgp;
 fpr=0D2511F322BFAB1C1580266BE2DCDD9132669BD6
Cc: Michael Hennerich <michael.hennerich@analog.com>,
 =?utf-8?q?Nuno_S=C3=A1?= <nuno.sa@analog.com>,
 Maxime Coquelin <mcoquelin.stm32@gmail.com>,
 linux-stm32@st-md-mailman.stormreply.com, linux-arm-kernel@lists.infradead.org
Subject: [Linux-stm32] [PATCH 2/6] pwm: New abstraction for PWM waveforms
X-BeenThere: linux-stm32@st-md-mailman.stormreply.com
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: <linux-stm32.st-md-mailman.stormreply.com>
List-Unsubscribe: <https://st-md-mailman.stormreply.com/mailman/options/linux-stm32>, 
 <mailto:linux-stm32-request@st-md-mailman.stormreply.com?subject=unsubscribe>
List-Archive: <http://st-md-mailman.stormreply.com/pipermail/linux-stm32/>
List-Post: <mailto:linux-stm32@st-md-mailman.stormreply.com>
List-Help: <mailto:linux-stm32-request@st-md-mailman.stormreply.com?subject=help>
List-Subscribe: <https://st-md-mailman.stormreply.com/mailman/listinfo/linux-stm32>, 
 <mailto:linux-stm32-request@st-md-mailman.stormreply.com?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: linux-stm32-bounces@st-md-mailman.stormreply.com
Sender: "Linux-stm32" <linux-stm32-bounces@st-md-mailman.stormreply.com>

VXAgdG8gbm93IHRoZSBjb25maWd1cmF0aW9uIG9mIGEgUFdNIHNldHRpbmcgaXMgZGVjcmliZWQg
ZXhjbHVzaXZlbHkgYnkKYSBzdHJ1Y3QgcHdtX3N0YXRlIHdoaWNoIGNvbnRhaW5zIGluZm9ybWF0
aW9uIGFib3V0IHBlcmlvZCwgZHV0eV9jeWNsZSwKcG9sYXJpdHkgYW5kIGlmIHRoZSBQV00gaXMg
ZW5hYmxlZC4gKFRoZXJlIGlzIGFub3RoZXIgbWVtYmVyIHVzYWdlX3Bvd2VyCndoaWNoIGRvZXNu
J3QgY29tcGxldGVseSBmaXQgaW50byBwd21fc3RhdGUsIEkgaWdub3JlIGl0IGhlcmUgZm9yCnNp
bXBsaWNpdHkuKQoKSW5zdGVhZCBvZiBhIHBvbGFyaXR5IHRoZSBuZXcgYWJzdHJhY3Rpb24gaGFz
IGEgbWVtYmVyIGR1dHlfb2Zmc2V0IHRoYXQKZGVmaW5lcyB3aGVuIHRoZSByaXNpbmcgZWRnZSBo
YXBwZW5zIGFmdGVyIHRoZSBwZXJpb2Qgc3RhcnQuIFRoaXMgaXMKbW9yZSBnZW5lcmFsLCBhcyB3
aXRoIGEgcHdtX3N0YXRlIHRoZSByaXNpbmcgZWRnZSBjYW4gb25seSBoYXBwZW4gYXQgdGhlCnBl
cmlvZCdzIHN0YXJ0IG9yIHN1Y2ggdGhhdCB0aGUgZmFsbGluZyBlZGdlIGlzIGF0IHRoZSBlbmQg
b2YgdGhlIHBlcmlvZAooaS5lLiBkdXR5X29mZnNldCA9PSAwIG9yIGR1dHlfb2Zmc2V0ID09IHBl
cmlvZF9sZW5naCAtIGR1dHlfbGVuZ3RoKS4KCkEgZGlzYWJsZWQgUFdNIGlzIG1vZGVsZWQgYnkg
LnBlcmlvZF9sZW5ndGggPSAwLiBJbiBteSBleWVzIHRoaXMgaXMgYQpuaWNlIHVzYWdlIG9mIHRo
YXQgb3RoZXJ3aXNlIHVudXNhYmxlIHNldHRpbmcsIGFzIGl0IGRvZXNuJ3QgZGVmaW5lCmFueXRo
aW5nIGFib3V0IHRoZSBmdXR1cmUgd2hpY2ggbWF0Y2hlcyB0aGUgZmFjdCB0aGF0IGNvbnN1bWVy
cyBzaG91bGQKY29uc2lkZXIgdGhlIHN0YXRlIG9mIHRoZSBvdXRwdXQgYXMgdW5kZWZpbmVkIGFu
ZCBpdCdzIGp1c3QgdGhlcmUgdG8gc2F5CiJObyBmdXJ0aGVyIHJlcXVpcmVtZW50cyBhYm91dCB0
aGUgb3V0cHV0LCB5b3UgY2FuIHNhdmUgc29tZSBwb3dlci4iLgoKRnVydGhlciBJIHJlbmFtZWQg
cGVyaW9kIGFuZCBkdXR5X2N5Y2xlIHRvIHBlcmlvZF9sZW5ndGggYW5kCmR1dHlfbGVuZ3RoLiBJ
biB0aGUgcGFzdCB0aGVyZSB3YXMgY29uZnVzaW9uIGZyb20gdGltZSB0byB0aW1lIGFib3V0CmR1
dHlfY3ljbGUgYmVpbmcgbWVhc3VyZWQgaW4gbmFub3NlY29uZHMgYmVjYXVzZSBwZW9wbGUgZXhw
ZWN0ZWQgYQpwZXJjZW50YWdlIG9mIHBlcmlvZCBpbnN0ZWFkLiBXaXRoICJsZW5ndGgiIGFzIHN1
ZmZpeCB0aGUgc2VtYW50aWMKc2hvdWxkIGJlIG1vcmUgb2J2aW91cyB0byBwZW9wbGUgdW5mYW1p
bGlhciB3aXRoIHRoZSBwd20gc3Vic3lzdGVtLgpwZXJpb2QgaXMgcmVuYW1lZCBwZXJpb2RfbGVu
Z3RoIGZvciBjb25zaXN0ZW5jeS4KClRoZSBBUEkgZm9yIGNvbnN1bWVycyBkb2Vzbid0IGNoYW5n
ZSB5ZXQsIGJ1dCBsb3dsZXZlbCBkcml2ZXJzIGNhbgppbXBsZW1lbnQgY2FsbGJhY2tzIHRoYXQg
d29yayB3aXRoIHB3bV93YXZlZm9ybXMgaW5zdGVhZCBvZiBwd21fc3RhdGVzLgpBIG5ldyB0aGlu
ZyBhYm91dCB0aGVzZSBjYWxsYmFja3MgaXMgdGhhdCB0aGUgY2FsY3VsYXRpb24gb2YgaGFyZHdh
cmUKc2V0dGluZ3MgbmVlZGVkIHRvIGltcGxlbWVudCBhIGNlcnRhaW4gd2F2ZWZvcm0gaXMgc2Vw
YXJhdGVkIGZyb20KYWN0dWFsbHkgd3JpdGluZyB0aGVzZSBzZXR0aW5ncy4gVGhlIG1vdGl2YXRp
b24gZm9yIHRoYXQgaXMgdGhhdCB0aGlzCmFsbG93cyBhIGNvbnN1bWVyIHRvIHF1ZXJ5IHRoZSBo
YXJkd2FyZSBjYXBhYmlsaXRpZXMgd2l0aG91dCBhY3R1YWxseQptb2RpZnlpbmcgdGhlIGhhcmR3
YXJlIHN0YXRlLgoKVGhlIHJvdW5kaW5nIHJ1bGVzIHRoYXQgYXJlIGV4cGVjdGVkIHRvIGJlIGlt
cGxlbWVudGVkIGluIHRoZQpyb3VuZF93YXZlZm9ybV90b2h3KCkgYXJlOiBGaXJzdCBwaWNrIHRo
ZSBiaWdnZXN0IHBvc3NpYmxlIHBlcmlvZCBub3QKYmlnZ2VyIHRoYW4gd2YtPnBlcmlvZF9sZW5n
dGguIEZvciB0aGF0IHBlcmlvZCBwaWNrIHRoZSBiaWdnZXN0IHBvc3NpYmxlCmR1dHkgc2V0dGlu
ZyBub3QgYmlnZ2VyIHRoYW4gd2YtPmR1dHlfbGVuZ3RoLiBUaGlyZCBwaWNrIHRoZSBiaWdnZXN0
CnBvc3NpYmxlIG9mZnNldCBub3QgYmlnZ2VyIHRoYW4gd2YtPmR1dHlfb2Zmc2V0LiBJZiB0aGUg
cmVxdWVzdGVkIHBlcmlvZAppcyB0b28gc21hbGwgZm9yIHRoZSBoYXJkd2FyZSwgaXQncyBleHBl
Y3RlZCB0aGF0IGEgc2V0dGluZyB3aXRoIHRoZQptaW5pbWFsIHBlcmlvZCBhbmQgZHV0eV9sZW5n
dGggPSBkdXR5X29mZnNldCA9IDAgaXMgcmV0dXJuZWQgYW5kIHRoaXMKZmFjdCBpcyBzaWduYWxl
ZCBieSBhIHJldHVybiB2YWx1ZSBvZiAxLgoKU2lnbmVkLW9mZi1ieTogVXdlIEtsZWluZS1Lw7Zu
aWcgPHUua2xlaW5lLWtvZW5pZ0BiYXlsaWJyZS5jb20+Ci0tLQogZHJpdmVycy9wd20vY29yZS5j
ICB8IDE5NCArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKystLS0tLQogaW5j
bHVkZS9saW51eC9wd20uaCB8ICAzNSArKysrKysrKwogMiBmaWxlcyBjaGFuZ2VkLCAyMDggaW5z
ZXJ0aW9ucygrKSwgMjEgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9wd20vY29y
ZS5jIGIvZHJpdmVycy9wd20vY29yZS5jCmluZGV4IGMzMWUxMmU3NjQ5NS4uOGU2ODQ4MWE3YjMz
IDEwMDY0NAotLS0gYS9kcml2ZXJzL3B3bS9jb3JlLmMKKysrIGIvZHJpdmVycy9wd20vY29yZS5j
CkBAIC00OSw2ICs0OSw3MiBAQCBzdGF0aWMgdm9pZCBwd21jaGlwX3VubG9jayhzdHJ1Y3QgcHdt
X2NoaXAgKmNoaXApCiAKIERFRklORV9HVUFSRChwd21jaGlwLCBzdHJ1Y3QgcHdtX2NoaXAgKiwg
cHdtY2hpcF9sb2NrKF9UKSwgcHdtY2hpcF91bmxvY2soX1QpKQogCitzdGF0aWMgdm9pZCBwd21f
d2Yyc3RhdGUoY29uc3Qgc3RydWN0IHB3bV93YXZlZm9ybSAqd2YsIHN0cnVjdCBwd21fc3RhdGUg
KnN0YXRlKQoreworCWlmICh3Zi0+cGVyaW9kX2xlbmd0aCkgeworCQlpZiAod2YtPmR1dHlfbGVu
Z3RoICsgd2YtPmR1dHlfb2Zmc2V0IDwgd2YtPnBlcmlvZF9sZW5ndGgpCisJCQkqc3RhdGUgPSAo
c3RydWN0IHB3bV9zdGF0ZSl7CisJCQkJLmVuYWJsZWQgPSB0cnVlLAorCQkJCS5wb2xhcml0eSA9
IFBXTV9QT0xBUklUWV9OT1JNQUwsCisJCQkJLnBlcmlvZCA9IHdmLT5wZXJpb2RfbGVuZ3RoLAor
CQkJCS5kdXR5X2N5Y2xlID0gd2YtPmR1dHlfbGVuZ3RoLAorCQkJfTsKKwkJZWxzZQorCQkJKnN0
YXRlID0gKHN0cnVjdCBwd21fc3RhdGUpeworCQkJCS5lbmFibGVkID0gdHJ1ZSwKKwkJCQkucG9s
YXJpdHkgPSBQV01fUE9MQVJJVFlfSU5WRVJTRUQsCisJCQkJLnBlcmlvZCA9IHdmLT5wZXJpb2Rf
bGVuZ3RoLAorCQkJCS5kdXR5X2N5Y2xlID0gd2YtPnBlcmlvZF9sZW5ndGggLSB3Zi0+ZHV0eV9s
ZW5ndGgsCisJCQl9OworCX0gZWxzZSB7CisJCSpzdGF0ZSA9IChzdHJ1Y3QgcHdtX3N0YXRlKXsK
KwkJCS5lbmFibGVkID0gZmFsc2UsCisJCX07CisJfQorfQorCitzdGF0aWMgdm9pZCBwd21fc3Rh
dGUyd2YoY29uc3Qgc3RydWN0IHB3bV9zdGF0ZSAqc3RhdGUsIHN0cnVjdCBwd21fd2F2ZWZvcm0g
KndmKQoreworCWlmIChzdGF0ZS0+ZW5hYmxlZCkgeworCQlpZiAoc3RhdGUtPnBvbGFyaXR5ID09
IFBXTV9QT0xBUklUWV9OT1JNQUwpCisJCQkqd2YgPSAoc3RydWN0IHB3bV93YXZlZm9ybSl7CisJ
CQkJLnBlcmlvZF9sZW5ndGggPSBzdGF0ZS0+cGVyaW9kLAorCQkJCS5kdXR5X2xlbmd0aCA9IHN0
YXRlLT5kdXR5X2N5Y2xlLAorCQkJCS5kdXR5X29mZnNldCA9IDAsCisJCQl9OworCQllbHNlCisJ
CQkqd2YgPSAoc3RydWN0IHB3bV93YXZlZm9ybSl7CisJCQkJLnBlcmlvZF9sZW5ndGggPSBzdGF0
ZS0+cGVyaW9kLAorCQkJCS5kdXR5X2xlbmd0aCA9IHN0YXRlLT5wZXJpb2QgLSBzdGF0ZS0+ZHV0
eV9jeWNsZSwKKwkJCQkuZHV0eV9vZmZzZXQgPSBzdGF0ZS0+ZHV0eV9jeWNsZSwKKwkJCX07CisJ
fSBlbHNlIHsKKwkJKndmID0gKHN0cnVjdCBwd21fd2F2ZWZvcm0peworCQkJLnBlcmlvZF9sZW5n
dGggPSAwLAorCQl9OworCX0KK30KKworc3RhdGljIGludCBwd21fY2hlY2tfcm91bmRpbmcoY29u
c3Qgc3RydWN0IHB3bV93YXZlZm9ybSAqd2YsCisJCQkgICAgICBjb25zdCBzdHJ1Y3QgcHdtX3dh
dmVmb3JtICp3Zl9yb3VuZGVkKQoreworCWlmICghd2YtPnBlcmlvZF9sZW5ndGgpCisJCXJldHVy
biAwOworCisJaWYgKHdmLT5wZXJpb2RfbGVuZ3RoIDwgd2Zfcm91bmRlZC0+cGVyaW9kX2xlbmd0
aCkKKwkJcmV0dXJuIDE7CisKKwlpZiAod2YtPmR1dHlfbGVuZ3RoIDwgd2Zfcm91bmRlZC0+ZHV0
eV9sZW5ndGgpCisJCXJldHVybiAxOworCisJaWYgKHdmLT5kdXR5X29mZnNldCA8IHdmX3JvdW5k
ZWQtPmR1dHlfb2Zmc2V0KQorCQlyZXR1cm4gMTsKKworCXJldHVybiAwOworfQorCisjZGVmaW5l
IFdGSFdTSVpFIDIwCisKIHN0YXRpYyB2b2lkIHB3bV9hcHBseV9kZWJ1ZyhzdHJ1Y3QgcHdtX2Rl
dmljZSAqcHdtLAogCQkJICAgIGNvbnN0IHN0cnVjdCBwd21fc3RhdGUgKnN0YXRlKQogewpAQCAt
MTgyLDYgKzI0OCw3IEBAIHN0YXRpYyBib29sIHB3bV9zdGF0ZV92YWxpZChjb25zdCBzdHJ1Y3Qg
cHdtX3N0YXRlICpzdGF0ZSkKIHN0YXRpYyBpbnQgX19wd21fYXBwbHkoc3RydWN0IHB3bV9kZXZp
Y2UgKnB3bSwgY29uc3Qgc3RydWN0IHB3bV9zdGF0ZSAqc3RhdGUpCiB7CiAJc3RydWN0IHB3bV9j
aGlwICpjaGlwOworCWNvbnN0IHN0cnVjdCBwd21fb3BzICpvcHM7CiAJaW50IGVycjsKIAogCWlm
ICghcHdtIHx8ICFzdGF0ZSkKQEAgLTIwNSw2ICsyNzIsNyBAQCBzdGF0aWMgaW50IF9fcHdtX2Fw
cGx5KHN0cnVjdCBwd21fZGV2aWNlICpwd20sIGNvbnN0IHN0cnVjdCBwd21fc3RhdGUgKnN0YXRl
KQogCX0KIAogCWNoaXAgPSBwd20tPmNoaXA7CisJb3BzID0gY2hpcC0+b3BzOwogCiAJaWYgKHN0
YXRlLT5wZXJpb2QgPT0gcHdtLT5zdGF0ZS5wZXJpb2QgJiYKIAkgICAgc3RhdGUtPmR1dHlfY3lj
bGUgPT0gcHdtLT5zdGF0ZS5kdXR5X2N5Y2xlICYmCkBAIC0yMTMsMTggKzI4MSw1OSBAQCBzdGF0
aWMgaW50IF9fcHdtX2FwcGx5KHN0cnVjdCBwd21fZGV2aWNlICpwd20sIGNvbnN0IHN0cnVjdCBw
d21fc3RhdGUgKnN0YXRlKQogCSAgICBzdGF0ZS0+dXNhZ2VfcG93ZXIgPT0gcHdtLT5zdGF0ZS51
c2FnZV9wb3dlcikKIAkJcmV0dXJuIDA7CiAKLQllcnIgPSBjaGlwLT5vcHMtPmFwcGx5KGNoaXAs
IHB3bSwgc3RhdGUpOwotCXRyYWNlX3B3bV9hcHBseShwd20sIHN0YXRlLCBlcnIpOwotCWlmIChl
cnIpCi0JCXJldHVybiBlcnI7CisJaWYgKG9wcy0+d3JpdGVfd2F2ZWZvcm0pIHsKKwkJc3RydWN0
IHB3bV93YXZlZm9ybSB3ZjsKKwkJY2hhciB3Zmh3W1dGSFdTSVpFXTsKIAotCXB3bS0+c3RhdGUg
PSAqc3RhdGU7CisJCUJVR19PTihXRkhXU0laRSA8IG9wcy0+c2l6ZW9mX3dmaHcpOwogCi0JLyoK
LQkgKiBvbmx5IGRvIHRoaXMgYWZ0ZXIgcHdtLT5zdGF0ZSB3YXMgYXBwbGllZCBhcyBzb21lCi0J
ICogaW1wbGVtZW50YXRpb25zIG9mIC5nZXRfc3RhdGUgZGVwZW5kIG9uIHRoaXMKLQkgKi8KLQlw
d21fYXBwbHlfZGVidWcocHdtLCBzdGF0ZSk7CisJCXB3bV9zdGF0ZTJ3ZihzdGF0ZSwgJndmKTsK
KworCQkvKgorCQkgKiBYWFggVGhlIHJvdW5kaW5nIGlzIHdyb25nIGhlcmUgZm9yIHN0YXRlcyB3
aXRoIGludmVydGVkCisJCSAqIHBvbGFyaXR5LiBXaGlsZSAuYXBwbHkoKSByb3VuZHMgZG93biBk
dXR5X2N5Y2xlICh3aGljaAorCQkgKiByZXByZXNlbnRzIHRoZSB0aW1lIGZyb20gdGhlIHN0YXJ0
IG9mIHRoZSBwZXJpb2QgdG8gdGhlIGlubmVyCisJCSAqIGVkZ2UpLCAucm91bmRfd2F2ZWZvcm1f
dG9odygpIHJvdW5kcyBkb3duIHRoZSB0aW1lIHRoZSBQV00gaXMKKwkJICogaGlnaC4KKwkJICov
CisKKwkJZXJyID0gb3BzLT5yb3VuZF93YXZlZm9ybV90b2h3KGNoaXAsIHB3bSwgJndmLCAmd2Zo
dyk7CisJCWlmIChlcnIpCisJCQlyZXR1cm4gZXJyOworCisJCWlmIChJU19FTkFCTEVEKFBXTV9E
RUJVRykpIHsKKwkJCXN0cnVjdCBwd21fd2F2ZWZvcm0gd2Zfcm91bmRlZDsKKworCQkJZXJyID0g
b3BzLT5yb3VuZF93YXZlZm9ybV9mcm9taHcoY2hpcCwgcHdtLCAmd2ZodywgJndmX3JvdW5kZWQp
OworCQkJaWYgKGVycikKKwkJCQlyZXR1cm4gZXJyOworCisJCQlpZiAocHdtX2NoZWNrX3JvdW5k
aW5nKCZ3ZiwgJndmX3JvdW5kZWQpKQorCQkJCWRldl9lcnIoJmNoaXAtPmRldiwgIldyb25nIHJv
dW5kaW5nOiByZXF1ZXN0ZWQgJWxsdS8lbGx1IFsrJWxsdV0sIHJlc3VsdCAlbGx1LyVsbHUgWysl
bGx1XVxuIiwKKwkJCQkJd2YuZHV0eV9sZW5ndGgsIHdmLnBlcmlvZF9sZW5ndGgsIHdmLmR1dHlf
b2Zmc2V0LAorCQkJCQl3Zl9yb3VuZGVkLmR1dHlfbGVuZ3RoLCB3Zl9yb3VuZGVkLnBlcmlvZF9s
ZW5ndGgsIHdmX3JvdW5kZWQuZHV0eV9vZmZzZXQpOworCQl9CisKKwkJZXJyID0gb3BzLT53cml0
ZV93YXZlZm9ybShjaGlwLCBwd20sICZ3Zmh3KTsKKwkJaWYgKGVycikKKwkJCXJldHVybiBlcnI7
CisKKwkJcHdtLT5zdGF0ZSA9ICpzdGF0ZTsKKworCX0gZWxzZSB7CisJCWVyciA9IG9wcy0+YXBw
bHkoY2hpcCwgcHdtLCBzdGF0ZSk7CisJCXRyYWNlX3B3bV9hcHBseShwd20sIHN0YXRlLCBlcnIp
OworCQlpZiAoZXJyKQorCQkJcmV0dXJuIGVycjsKKworCQlwd20tPnN0YXRlID0gKnN0YXRlOwor
CisJCS8qCisJCSAqIG9ubHkgZG8gdGhpcyBhZnRlciBwd20tPnN0YXRlIHdhcyBhcHBsaWVkIGFz
IHNvbWUKKwkJICogaW1wbGVtZW50YXRpb25zIG9mIC5nZXRfc3RhdGUgZGVwZW5kIG9uIHRoaXMK
KwkJICovCisJCXB3bV9hcHBseV9kZWJ1Zyhwd20sIHN0YXRlKTsKKwl9CiAKIAlyZXR1cm4gMDsK
IH0KQEAgLTI5Miw2ICs0MDEsNDEgQEAgaW50IHB3bV9hcHBseV9hdG9taWMoc3RydWN0IHB3bV9k
ZXZpY2UgKnB3bSwgY29uc3Qgc3RydWN0IHB3bV9zdGF0ZSAqc3RhdGUpCiB9CiBFWFBPUlRfU1lN
Qk9MX0dQTChwd21fYXBwbHlfYXRvbWljKTsKIAorc3RhdGljIGludCBwd21fZ2V0X3N0YXRlX2h3
KHN0cnVjdCBwd21fZGV2aWNlICpwd20sIHN0cnVjdCBwd21fc3RhdGUgKnN0YXRlKQoreworCXN0
cnVjdCBwd21fY2hpcCAqY2hpcCA9IHB3bS0+Y2hpcDsKKwljb25zdCBzdHJ1Y3QgcHdtX29wcyAq
b3BzID0gY2hpcC0+b3BzOworCWludCByZXQgPSAtRU9QTk9UU1VQUDsKKworCWlmIChvcHMtPnJl
YWRfd2F2ZWZvcm0pIHsKKwkJY2hhciB3Zmh3W1dGSFdTSVpFXTsKKwkJc3RydWN0IHB3bV93YXZl
Zm9ybSB3ZjsKKworCQlCVUdfT04oV0ZIV1NJWkUgPCBvcHMtPnNpemVvZl93Zmh3KTsKKworCQlz
Y29wZWRfZ3VhcmQocHdtY2hpcCwgY2hpcCkgeworCisJCQlyZXQgPSBvcHMtPnJlYWRfd2F2ZWZv
cm0oY2hpcCwgcHdtLCAmd2Zodyk7CisJCQlpZiAocmV0KQorCQkJCXJldHVybiByZXQ7CisKKwkJ
CXJldCA9IG9wcy0+cm91bmRfd2F2ZWZvcm1fZnJvbWh3KGNoaXAsIHB3bSwgJndmaHcsICZ3Zik7
CisJCQlpZiAocmV0KQorCQkJCXJldHVybiByZXQ7CisJCX0KKworCQlwd21fd2Yyc3RhdGUoJndm
LCBzdGF0ZSk7CisKKwl9IGVsc2UgaWYgKG9wcy0+Z2V0X3N0YXRlKSB7CisJCXNjb3BlZF9ndWFy
ZChwd21jaGlwLCBjaGlwKQorCQkJcmV0ID0gb3BzLT5nZXRfc3RhdGUoY2hpcCwgcHdtLCBzdGF0
ZSk7CisKKwkJdHJhY2VfcHdtX2dldChwd20sIHN0YXRlLCByZXQpOworCX0KKworCXJldHVybiBy
ZXQ7Cit9CisKIC8qKgogICogcHdtX2FkanVzdF9jb25maWcoKSAtIGFkanVzdCB0aGUgY3VycmVu
dCBQV00gY29uZmlnIHRvIHRoZSBQV00gYXJndW1lbnRzCiAgKiBAcHdtOiBQV00gZGV2aWNlCkBA
IC00MzMsNyArNTc3LDcgQEAgc3RhdGljIGludCBwd21fZGV2aWNlX3JlcXVlc3Qoc3RydWN0IHB3
bV9kZXZpY2UgKnB3bSwgY29uc3QgY2hhciAqbGFiZWwpCiAJCX0KIAl9CiAKLQlpZiAob3BzLT5n
ZXRfc3RhdGUpIHsKKwlpZiAob3BzLT5yZWFkX3dhdmVmb3JtIHx8IG9wcy0+Z2V0X3N0YXRlKSB7
CiAJCS8qCiAJCSAqIFplcm8taW5pdGlhbGl6ZSBzdGF0ZSBiZWNhdXNlIG1vc3QgZHJpdmVycyBh
cmUgdW5hd2FyZSBvZgogCQkgKiAudXNhZ2VfcG93ZXIuIFRoZSBvdGhlciBtZW1iZXJzIG9mIHN0
YXRlIGFyZSBzdXBwb3NlZCB0byBiZQpAQCAtNDQzLDExICs1ODcsNyBAQCBzdGF0aWMgaW50IHB3
bV9kZXZpY2VfcmVxdWVzdChzdHJ1Y3QgcHdtX2RldmljZSAqcHdtLCBjb25zdCBjaGFyICpsYWJl
bCkKIAkJICovCiAJCXN0cnVjdCBwd21fc3RhdGUgc3RhdGUgPSB7IDAsIH07CiAKLQkJc2NvcGVk
X2d1YXJkKHB3bWNoaXAsIGNoaXApCi0JCQllcnIgPSBvcHMtPmdldF9zdGF0ZShjaGlwLCBwd20s
ICZzdGF0ZSk7Ci0KLQkJdHJhY2VfcHdtX2dldChwd20sICZzdGF0ZSwgZXJyKTsKLQorCQllcnIg
PSBwd21fZ2V0X3N0YXRlX2h3KHB3bSwgJnN0YXRlKTsKIAkJaWYgKCFlcnIpCiAJCQlwd20tPnN0
YXRlID0gc3RhdGU7CiAKQEAgLTExMzQsMTIgKzEyNzQsMjQgQEAgc3RhdGljIGJvb2wgcHdtX29w
c19jaGVjayhjb25zdCBzdHJ1Y3QgcHdtX2NoaXAgKmNoaXApCiB7CiAJY29uc3Qgc3RydWN0IHB3
bV9vcHMgKm9wcyA9IGNoaXAtPm9wczsKIAotCWlmICghb3BzLT5hcHBseSkKLQkJcmV0dXJuIGZh
bHNlOworCWlmIChvcHMtPndyaXRlX3dhdmVmb3JtKSB7CisJCWlmICghb3BzLT5yb3VuZF93YXZl
Zm9ybV90b2h3IHx8CisJCSAgICAhb3BzLT5yb3VuZF93YXZlZm9ybV9mcm9taHcgfHwKKwkJICAg
ICFvcHMtPndyaXRlX3dhdmVmb3JtKQorCQkJcmV0dXJuIGZhbHNlOwogCi0JaWYgKElTX0VOQUJM
RUQoQ09ORklHX1BXTV9ERUJVRykgJiYgIW9wcy0+Z2V0X3N0YXRlKQotCQlkZXZfd2Fybihwd21j
aGlwX3BhcmVudChjaGlwKSwKLQkJCSAiUGxlYXNlIGltcGxlbWVudCB0aGUgLmdldF9zdGF0ZSgp
IGNhbGxiYWNrXG4iKTsKKwkJaWYgKFdGSFdTSVpFIDwgb3BzLT5zaXplb2Zfd2ZodykgeworCQkJ
ZGV2X3dhcm4ocHdtY2hpcF9wYXJlbnQoY2hpcCksICJXRkhXU0laRSA8ICV6dVxuIiwgb3BzLT5z
aXplb2Zfd2Zodyk7CisJCQlyZXR1cm4gZmFsc2U7CisJCX0KKwl9IGVsc2UgeworCQlpZiAoIW9w
cy0+YXBwbHkpCisJCQlyZXR1cm4gZmFsc2U7CisKKwkJaWYgKElTX0VOQUJMRUQoQ09ORklHX1BX
TV9ERUJVRykgJiYgIW9wcy0+Z2V0X3N0YXRlKQorCQkJZGV2X3dhcm4ocHdtY2hpcF9wYXJlbnQo
Y2hpcCksCisJCQkJICJQbGVhc2UgaW1wbGVtZW50IHRoZSAuZ2V0X3N0YXRlKCkgY2FsbGJhY2tc
biIpOworCX0KIAogCXJldHVybiB0cnVlOwogfQpkaWZmIC0tZ2l0IGEvaW5jbHVkZS9saW51eC9w
d20uaCBiL2luY2x1ZGUvbGludXgvcHdtLmgKaW5kZXggNTE3NmRmZWJmYmZkLi5iNWRmZjJhOTkw
MzggMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvbGludXgvcHdtLmgKKysrIGIvaW5jbHVkZS9saW51eC9w
d20uaApAQCAtNDksNiArNDksMzAgQEAgZW51bSB7CiAJUFdNRl9FWFBPUlRFRCA9IDEsCiB9Owog
CisvKgorICogc3RydWN0IHB3bV93YXZlZm9ybSAtIGRlc2NyaXB0aW9uIG9mIGEgUFdNIHdhdmVm
b3JtCisgKiBAcGVyaW9kX2xlbmd0aDogUFdNIHBlcmlvZAorICogQGR1dHlfbGVuZ3RoOiBQV00g
ZHV0eSBjeWNsZQorICogQGR1dHlfb2Zmc2V0OiBvZmZzZXQgb2YgdGhlIHJpc2luZyBlZGdlIGZy
b20gdGhlIHBlcmlvZCdzIHN0YXJ0CisgKgorICogVGhpcyBpcyBhIHJlcHJlc2VudGF0aW9uIG9m
IGEgUFdNIHdhdmVmb3JtIGFsdGVybmF0aXZlIHRvIHN0cnVjdCBwd21fc3RhdGUKKyAqIGJlbG93
LiBJdCdzIG1vcmUgZXhwcmVzc2l2ZSB0aGFuIHN0cnVjdCBwd21fc3RhdGUgYXMgaXQgY29udGFp
bnMgYQorICogZHV0eV9vZmZzZXQgYW5kIHNvIGNhbiByZXByZXNlbnQgb2Zmc2V0cyBvdGhlciB0
aGFuICRwZXJpb2QgLSAkZHV0eV9jeWNsZQorICogd2hpY2ggaXMgZG9uZSB1c2luZyAucG9sYXJp
dHkgPSBQV01fUE9MQVJJVFlfSU5WRVJTRUQuIE5vdGUgdGhlcmUgaXMgbm8KKyAqIGV4cGxpY2l0
IGJvb2wgZm9yIGVuYWJsZWQuIEEgImRpc2FibGVkIiBQV00gaXMgcmVwcmVzZW50ZWQgYnkgLnBl
cmlvZCA9IDAuCisgKgorICogTm90ZSB0aGF0IHRoZSBiZWhhdmlvdXIgb2YgYSAiZGlzYWJsZWQi
IFBXTSBpcyB1bmRlZmluZWQuIERlcGVuZGluZyBvbiB0aGUKKyAqIGhhcmR3YXJlJ3MgY2FwYWJp
bGl0aWVzIGl0IG1pZ2h0IGRyaXZlIHRoZSBhY3RpdmUgb3IgaW5hY3RpdmUgbGV2ZWwsIGdvCisg
KiBoaWdoLXogb3IgZXZlbiBjb250aW51ZSB0byB0b2dnbGUuCisgKgorICogVGhlIHVuaXQgZm9y
IGFsbCB0aHJlZSBtZW1iZXJzIGlzIG5hbm9zZWNvbmRzLgorICovCitzdHJ1Y3QgcHdtX3dhdmVm
b3JtIHsKKwl1NjQgcGVyaW9kX2xlbmd0aDsKKwl1NjQgZHV0eV9sZW5ndGg7CisJdTY0IGR1dHlf
b2Zmc2V0OworfTsKKwogLyoKICAqIHN0cnVjdCBwd21fc3RhdGUgLSBzdGF0ZSBvZiBhIFBXTSBj
aGFubmVsCiAgKiBAcGVyaW9kOiBQV00gcGVyaW9kIChpbiBuYW5vc2Vjb25kcykKQEAgLTI1OSw2
ICsyODMsMTcgQEAgc3RydWN0IHB3bV9vcHMgewogCXZvaWQgKCpmcmVlKShzdHJ1Y3QgcHdtX2No
aXAgKmNoaXAsIHN0cnVjdCBwd21fZGV2aWNlICpwd20pOwogCWludCAoKmNhcHR1cmUpKHN0cnVj
dCBwd21fY2hpcCAqY2hpcCwgc3RydWN0IHB3bV9kZXZpY2UgKnB3bSwKIAkJICAgICAgIHN0cnVj
dCBwd21fY2FwdHVyZSAqcmVzdWx0LCB1bnNpZ25lZCBsb25nIHRpbWVvdXQpOworCisJc2l6ZV90
IHNpemVvZl93Zmh3OworCWludCAoKnJvdW5kX3dhdmVmb3JtX3RvaHcpKHN0cnVjdCBwd21fY2hp
cCAqY2hpcCwgc3RydWN0IHB3bV9kZXZpY2UgKnB3bSwKKwkJCQkgICBjb25zdCBzdHJ1Y3QgcHdt
X3dhdmVmb3JtICp3Ziwgdm9pZCAqd2Zodyk7CisJaW50ICgqcm91bmRfd2F2ZWZvcm1fZnJvbWh3
KShzdHJ1Y3QgcHdtX2NoaXAgKmNoaXAsIHN0cnVjdCBwd21fZGV2aWNlICpwd20sCisJCQkJICAg
ICBjb25zdCB2b2lkICp3Zmh3LCBzdHJ1Y3QgcHdtX3dhdmVmb3JtICp3Zik7CisJaW50ICgqcmVh
ZF93YXZlZm9ybSkoc3RydWN0IHB3bV9jaGlwICpjaGlwLCBzdHJ1Y3QgcHdtX2RldmljZSAqcHdt
LAorCQkJICAgIHZvaWQgKndmaHcpOworCWludCAoKndyaXRlX3dhdmVmb3JtKShzdHJ1Y3QgcHdt
X2NoaXAgKmNoaXAsIHN0cnVjdCBwd21fZGV2aWNlICpwd20sCisJCQkgICAgICBjb25zdCB2b2lk
ICp3Zmh3KTsKKwogCWludCAoKmFwcGx5KShzdHJ1Y3QgcHdtX2NoaXAgKmNoaXAsIHN0cnVjdCBw
d21fZGV2aWNlICpwd20sCiAJCSAgICAgY29uc3Qgc3RydWN0IHB3bV9zdGF0ZSAqc3RhdGUpOwog
CWludCAoKmdldF9zdGF0ZSkoc3RydWN0IHB3bV9jaGlwICpjaGlwLCBzdHJ1Y3QgcHdtX2Rldmlj
ZSAqcHdtLAotLSAKMi40My4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fXwpMaW51eC1zdG0zMiBtYWlsaW5nIGxpc3QKTGludXgtc3RtMzJAc3QtbWQtbWFp
bG1hbi5zdG9ybXJlcGx5LmNvbQpodHRwczovL3N0LW1kLW1haWxtYW4uc3Rvcm1yZXBseS5jb20v
bWFpbG1hbi9saXN0aW5mby9saW51eC1zdG0zMgo=
