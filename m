Return-Path: <linux-stm32-bounces@st-md-mailman.stormreply.com>
X-Original-To: lists+linux-stm32@lfdr.de
Delivered-To: lists+linux-stm32@lfdr.de
Received: from stm-ict-prod-mailman-01.stormreply.prv (st-md-mailman.stormreply.com [52.209.6.89])
	by mail.lfdr.de (Postfix) with ESMTPS id 73A5F3A0E7A
	for <lists+linux-stm32@lfdr.de>; Wed,  9 Jun 2021 10:06:07 +0200 (CEST)
Received: from ip-172-31-3-76.eu-west-1.compute.internal (localhost [127.0.0.1])
	by stm-ict-prod-mailman-01.stormreply.prv (Postfix) with ESMTP id 28C4BC57B79;
	Wed,  9 Jun 2021 08:06:07 +0000 (UTC)
Received: from mail-pj1-f52.google.com (mail-pj1-f52.google.com
 [209.85.216.52])
 (using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits))
 (No client certificate requested)
 by stm-ict-prod-mailman-01.stormreply.prv (Postfix) with ESMTPS id 77B09C58D58
 for <linux-stm32@st-md-mailman.stormreply.com>;
 Wed,  9 Jun 2021 01:33:46 +0000 (UTC)
Received: by mail-pj1-f52.google.com with SMTP id
 x21-20020a17090aa395b029016e25313bfcso417299pjp.2
 for <linux-stm32@st-md-mailman.stormreply.com>;
 Tue, 08 Jun 2021 18:33:46 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=erCeWxxMz1n/89OARARPUupOSg2j67Chs6/DBd8t4+0=;
 b=BEBeJn5qdI5CX5+hT+3CqRYcT4Id2ih/nWi54VeeY1ZLXlFO35RB+XpeyF5N2Xghy1
 cbxmaFJhWi/jkAufqe7jTeO2UxaEpwhipt1ylLgcTOl9bA7E0DtRG0ET28G6oSVFKCgM
 6/FzOcpuzuYwMGU9zSApR59WijaqIuRKeatCbQyYStyMUMWkCBtL3hb9xv4vbVO5J84Q
 m/8Pc/6I0mH8/96Qlp+KDQn2UsiGPj7LtiB6s+xMfAHZq1ttz041cX2ARwuoiJ5/STyB
 VOu3BIJ2sFXUFJKgOVwYL1xIW3gPkEjMQQsw8BGRT1YGPr0ZAnsacdS1pT6lVHGqFlRm
 RpMw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=erCeWxxMz1n/89OARARPUupOSg2j67Chs6/DBd8t4+0=;
 b=Uxyg7xR7iAwhej6Nt2EBXTS4nCdgCH8U5dgltlNHZcgEgv+u80t4xU8aNVzppZpNIZ
 SMlFMEz72zxGsBNQ2ddeqvZGT/kpVp0VI5rduY5A5kKq6MuLXVtOUopSVBPfG1I/5zHc
 Y2iE0YFR8jwU5kQPdWNJVA0nRt7OFQAztqb7oms20KhrJe85eLpn/MBt9AvgaeOTe4wY
 Cut+ksq/RjNCJp5mM60EeZGXiM2DRG90JcdzsFS3s5AIJDVcVAPZlwjn69FL8fFhlWhm
 e1hrp43Yx03ZyU2jW1nf9f90lg11cVugrCai2JH3RO9p1lYfKj71s/ZHnaeE/kITzQFd
 HIrQ==
X-Gm-Message-State: AOAM5327TMn1hGZv0gRBPO+TV/ZhqQUIDUfe9GEEQ6LND8+33yTd43id
 69fSKJBVxweChfZ9B6LVwRA=
X-Google-Smtp-Source: ABdhPJzZgDGCbrcGovXFOoQH8y4+dvrl2x1nSglFJfc0bwxkPQoVGa86kAYEB2ePS94G1fp5/g73dQ==
X-Received: by 2002:a17:90a:b008:: with SMTP id
 x8mr29446319pjq.160.1623202424643; 
 Tue, 08 Jun 2021 18:33:44 -0700 (PDT)
Received: from localhost.localdomain ([156.146.35.76])
 by smtp.gmail.com with ESMTPSA id v14sm12659815pgl.86.2021.06.08.18.33.38
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Tue, 08 Jun 2021 18:33:43 -0700 (PDT)
From: William Breathitt Gray <vilhelm.gray@gmail.com>
To: jic23@kernel.org
Date: Wed,  9 Jun 2021 10:31:25 +0900
Message-Id: <87dec6c889e40068ed27cbb3e66a6376856e2267.1623201082.git.vilhelm.gray@gmail.com>
X-Mailer: git-send-email 2.32.0
In-Reply-To: <cover.1623201081.git.vilhelm.gray@gmail.com>
References: <cover.1623201081.git.vilhelm.gray@gmail.com>
MIME-Version: 1.0
X-Mailman-Approved-At: Wed, 09 Jun 2021 08:06:04 +0000
Cc: kamel.bouhara@bootlin.com, gwendal@chromium.org, david@lechnology.com,
 linux-iio@vger.kernel.org, patrick.havelange@essensium.com,
 alexandre.belloni@bootlin.com, mcoquelin.stm32@gmail.com,
 linux-kernel@vger.kernel.org, o.rempel@pengutronix.de,
 jarkko.nikula@linux.intel.com, Dan Carpenter <dan.carpenter@oracle.com>,
 kernel@pengutronix.de, William Breathitt Gray <vilhelm.gray@gmail.com>,
 fabrice.gasnier@st.com, syednwaris@gmail.com,
 linux-stm32@st-md-mailman.stormreply.com, linux-arm-kernel@lists.infradead.org,
 alexandre.torgue@st.com
Subject: [Linux-stm32] [PATCH v11 22/33] counter: Internalize sysfs
	interface code
X-BeenThere: linux-stm32@st-md-mailman.stormreply.com
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: <linux-stm32.st-md-mailman.stormreply.com>
List-Unsubscribe: <https://st-md-mailman.stormreply.com/mailman/options/linux-stm32>, 
 <mailto:linux-stm32-request@st-md-mailman.stormreply.com?subject=unsubscribe>
List-Archive: <http://st-md-mailman.stormreply.com/pipermail/linux-stm32/>
List-Post: <mailto:linux-stm32@st-md-mailman.stormreply.com>
List-Help: <mailto:linux-stm32-request@st-md-mailman.stormreply.com?subject=help>
List-Subscribe: <https://st-md-mailman.stormreply.com/mailman/listinfo/linux-stm32>, 
 <mailto:linux-stm32-request@st-md-mailman.stormreply.com?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: linux-stm32-bounces@st-md-mailman.stormreply.com
Sender: "Linux-stm32" <linux-stm32-bounces@st-md-mailman.stormreply.com>

VGhpcyBpcyBhIHJlaW1wbGVtZW50YXRpb24gb2YgdGhlIEdlbmVyaWMgQ291bnRlciBkcml2ZXIg
aW50ZXJmYWNlLgpUaGVyZSBhcmUgbm8gbW9kaWZpY2F0aW9ucyB0byB0aGUgQ291bnRlciBzdWJz
eXN0ZW0gdXNlcnNwYWNlIGludGVyZmFjZSwKc28gZXhpc3RpbmcgdXNlcnNwYWNlIGFwcGxpY2F0
aW9ucyBzaG91bGQgY29udGludWUgdG8gcnVuIHNlYW1sZXNzbHkuCgpUaGUgcHVycG9zZSBvZiB0
aGlzIHBhdGNoIGlzIHRvIGludGVybmFsaXplIHRoZSBzeXNmcyBpbnRlcmZhY2UgY29kZQphbW9u
ZyB0aGUgdmFyaW91cyBjb3VudGVyIGRyaXZlcnMgaW50byBhIHNoYXJlZCBtb2R1bGUuIENvdW50
ZXIgZHJpdmVycwpwYXNzIGFuZCB0YWtlIGRhdGEgbmF0aXZlbHkgKGkuZS4gdTgsIHU2NCwgZXRj
LikgYW5kIHRoZSBzaGFyZWQgY291bnRlcgptb2R1bGUgaGFuZGxlcyB0aGUgdHJhbnNsYXRpb24g
YmV0d2VlbiB0aGUgc3lzZnMgaW50ZXJmYWNlIGFuZCB0aGUKZGV2aWNlIGRyaXZlcnMuIFRoaXMg
Z3VhcmFudGVlcyBhIHN0YW5kYXJkIHVzZXJzcGFjZSBpbnRlcmZhY2UgZm9yIGFsbApjb3VudGVy
IGRyaXZlcnMsIGFuZCBoZWxwcyBnZW5lcmFsaXplIHRoZSBHZW5lcmljIENvdW50ZXIgZHJpdmVy
IEFCSSBpbgpvcmRlciB0byBzdXBwb3J0IHRoZSBHZW5lcmljIENvdW50ZXIgY2hyZGV2IGludGVy
ZmFjZSAoaW50cm9kdWNlZCBpbiBhCnN1YnNlcXVlbnQgcGF0Y2gpIHdpdGhvdXQgc2lnbmlmaWNh
bnQgY2hhbmdlcyB0byB0aGUgZXhpc3RpbmcgY291bnRlcgpkcml2ZXJzLgoKTm90ZSwgQ291bnRl
ciBkZXZpY2UgcmVnaXN0cmF0aW9uIGlzIHRoZSBzYW1lIGFzIGJlZm9yZTogZHJpdmVycwpwb3B1
bGF0ZSBhIHN0cnVjdCBjb3VudGVyX2RldmljZSB3aXRoIGNvbXBvbmVudHMgYW5kIGNhbGxiYWNr
cywgdGhlbgpwYXNzIHRoZSBzdHJ1Y3R1cmUgdG8gdGhlIGRldm1fY291bnRlcl9yZWdpc3RlciBm
dW5jdGlvbi4gSG93ZXZlciwKd2hhdCdzIGRpZmZlcmVudCBub3cgaXMgaG93IHRoZSBDb3VudGVy
IHN1YnN5c3RlbSBjb2RlIGhhbmRsZXMgdGhpcwpyZWdpc3RyYXRpb24gaW50ZXJuYWxseS4KCldo
ZXJlYXMgYmVmb3JlIGNhbGxiYWNrcyB3b3VsZCBpbnRlcmFjdCBkaXJlY3RseSB3aXRoIHN5c2Zz
IGRhdGEsIHRoaXMKaW50ZXJhY3Rpb24gaXMgbm93IGFic3RyYWN0ZWQgYW5kIGluc3RlYWQgY2Fs
bGJhY2tzIGludGVyYWN0IHdpdGggbmF0aXZlCkMgZGF0YSB0eXBlcy4gVGhlIGNvdW50ZXJfY29t
cCBzdHJ1Y3R1cmUgZm9ybXMgdGhlIGJhc2lzIGZvciBDb3VudGVyCmV4dGVuc2lvbnMuCgpUaGUg
Y291bnRlci1zeXNmcy5jIGZpbGUgY29udGFpbnMgdGhlIGNvZGUgdG8gcGFyc2UgdGhyb3VnaCB0
aGUKY291bnRlcl9kZXZpY2Ugc3RydWN0dXJlIGFuZCByZWdpc3RlciB0aGUgcmVxdWVzdGVkIGNv
bXBvbmVudHMgYW5kCmV4dGVuc2lvbnMuIEF0dHJpYnV0ZXMgYXJlIGNyZWF0ZWQgYW5kIHBvcHVs
YXRlZCBiYXNlZCBvbiB0eXBlLCB3aXRoCnJlc3BlY3RpdmUgdHJhbnNsYXRpb24gZnVuY3Rpb25z
IHRvIGhhbmRsZSB0aGUgbWFwcGluZyBiZXR3ZWVuIHN5c2ZzIGFuZAp0aGUgY291bnRlciBkcml2
ZXIgY2FsbGJhY2tzLgoKVGhlIHRyYW5zbGF0aW9uIHBlcmZvcm1lZCBmb3IgZWFjaCBhdHRyaWJ1
dGUgaXMgc3RyYWlnaHRmb3J3YXJkOiB0aGUKYXR0cmlidXRlIHR5cGUgYW5kIGRhdGEgaXMgcGFy
c2VkIGZyb20gdGhlIGNvdW50ZXJfYXR0cmlidXRlIHN0cnVjdHVyZSwKdGhlIHJlc3BlY3RpdmUg
Y291bnRlciBkcml2ZXIgcmVhZC93cml0ZSBjYWxsYmFjayBpcyBjYWxsZWQsIGFuZCBzeXNmcwpJ
L08gaXMgaGFuZGxlZCBiZWZvcmUgb3IgYWZ0ZXIgdGhlIGRyaXZlciByZWFkL3dyaXRlIGZ1bmN0
aW9uIGlzIGNhbGxlZC4KCkNjOiBTeWVkIE5heXlhciBXYXJpcyA8c3llZG53YXJpc0BnbWFpbC5j
b20+CkNjOiBKYXJra28gTmlrdWxhIDxqYXJra28ubmlrdWxhQGxpbnV4LmludGVsLmNvbT4KQ2M6
IFBhdHJpY2sgSGF2ZWxhbmdlIDxwYXRyaWNrLmhhdmVsYW5nZUBlc3NlbnNpdW0uY29tPgpDYzog
S2FtZWwgQm91aGFyYSA8a2FtZWwuYm91aGFyYUBib290bGluLmNvbT4KQ2M6IEZhYnJpY2UgR2Fz
bmllciA8ZmFicmljZS5nYXNuaWVyQHN0LmNvbT4KQ2M6IE1heGltZSBDb3F1ZWxpbiA8bWNvcXVl
bGluLnN0bTMyQGdtYWlsLmNvbT4KQ2M6IEFsZXhhbmRyZSBUb3JndWUgPGFsZXhhbmRyZS50b3Jn
dWVAc3QuY29tPgpDYzogRGFuIENhcnBlbnRlciA8ZGFuLmNhcnBlbnRlckBvcmFjbGUuY29tPgpS
ZXZpZXdlZC1ieTogRGF2aWQgTGVjaG5lciA8ZGF2aWRAbGVjaG5vbG9neS5jb20+ClRlc3RlZC1i
eTogRGF2aWQgTGVjaG5lciA8ZGF2aWRAbGVjaG5vbG9neS5jb20+ClNpZ25lZC1vZmYtYnk6IFdp
bGxpYW0gQnJlYXRoaXR0IEdyYXkgPHZpbGhlbG0uZ3JheUBnbWFpbC5jb20+Ci0tLQogTUFJTlRB
SU5FUlMgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgICAgMSAtCiBkcml2ZXJzL2NvdW50
ZXIvMTA0LXF1YWQtOC5jICAgICAgICAgICAgfCAgNDQ5ICsrKy0tLS0KIGRyaXZlcnMvY291bnRl
ci9NYWtlZmlsZSAgICAgICAgICAgICAgICB8ICAgIDEgKwogZHJpdmVycy9jb3VudGVyL2NvdW50
ZXItY29yZS5jICAgICAgICAgIHwgIDE1NSArKysKIGRyaXZlcnMvY291bnRlci9jb3VudGVyLXN5
c2ZzLmMgICAgICAgICB8ICA4NDYgKysrKysrKysrKysrKwogZHJpdmVycy9jb3VudGVyL2NvdW50
ZXItc3lzZnMuaCAgICAgICAgIHwgICAxMyArCiBkcml2ZXJzL2NvdW50ZXIvY291bnRlci5jICAg
ICAgICAgICAgICAgfCAxNDk2IC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiBkcml2ZXJzL2NvdW50
ZXIvZnRtLXF1YWRkZWMuYyAgICAgICAgICAgfCAgIDU2ICstCiBkcml2ZXJzL2NvdW50ZXIvaW50
ZWwtcWVwLmMgICAgICAgICAgICAgfCAgMTQ0ICstLQogZHJpdmVycy9jb3VudGVyL2ludGVycnVw
dC1jbnQuYyAgICAgICAgIHwgICA2MiArLQogZHJpdmVycy9jb3VudGVyL21pY3JvY2hpcC10Y2It
Y2FwdHVyZS5jIHwgICA5MyArLQogZHJpdmVycy9jb3VudGVyL3N0bTMyLWxwdGltZXItY250LmMg
ICAgIHwgIDE2MiArKy0KIGRyaXZlcnMvY291bnRlci9zdG0zMi10aW1lci1jbnQuYyAgICAgICB8
ICAxNDcgKy0tCiBkcml2ZXJzL2NvdW50ZXIvdGktZXFlcC5jICAgICAgICAgICAgICAgfCAgMTgw
ICstLQogaW5jbHVkZS9saW51eC9jb3VudGVyLmggICAgICAgICAgICAgICAgIHwgIDYyOSArKysr
Ky0tLS0tCiBpbmNsdWRlL2xpbnV4L2NvdW50ZXJfZW51bS5oICAgICAgICAgICAgfCAgIDQ1IC0K
IDE2IGZpbGVzIGNoYW5nZWQsIDE5MTggaW5zZXJ0aW9ucygrKSwgMjU2MSBkZWxldGlvbnMoLSkK
IGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2NvdW50ZXIvY291bnRlci1jb3JlLmMKIGNyZWF0
ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2NvdW50ZXIvY291bnRlci1zeXNmcy5jCiBjcmVhdGUgbW9k
ZSAxMDA2NDQgZHJpdmVycy9jb3VudGVyL2NvdW50ZXItc3lzZnMuaAogZGVsZXRlIG1vZGUgMTAw
NjQ0IGRyaXZlcnMvY291bnRlci9jb3VudGVyLmMKIGRlbGV0ZSBtb2RlIDEwMDY0NCBpbmNsdWRl
L2xpbnV4L2NvdW50ZXJfZW51bS5oCgpkaWZmIC0tZ2l0IGEvTUFJTlRBSU5FUlMgYi9NQUlOVEFJ
TkVSUwppbmRleCA4ZmE5MjAyNjEwYzUuLjBhY2RlNDBkNjgyYyAxMDA2NDQKLS0tIGEvTUFJTlRB
SU5FUlMKKysrIGIvTUFJTlRBSU5FUlMKQEAgLTQ2NzgsNyArNDY3OCw2IEBAIEY6CURvY3VtZW50
YXRpb24vQUJJL3Rlc3Rpbmcvc3lzZnMtYnVzLWNvdW50ZXIKIEY6CURvY3VtZW50YXRpb24vZHJp
dmVyLWFwaS9nZW5lcmljLWNvdW50ZXIucnN0CiBGOglkcml2ZXJzL2NvdW50ZXIvCiBGOglpbmNs
dWRlL2xpbnV4L2NvdW50ZXIuaAotRjoJaW5jbHVkZS9saW51eC9jb3VudGVyX2VudW0uaAogCiBD
UDI2MTUgSTJDIERSSVZFUgogTToJQmVuY2UgQ3PDs2vDoXMgPGJlbmNlOThAc2NoLmJtZS5odT4K
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvY291bnRlci8xMDQtcXVhZC04LmMgYi9kcml2ZXJzL2NvdW50
ZXIvMTA0LXF1YWQtOC5jCmluZGV4IDVhNDlhY2UyZDRhNi4uZWI3ZDYzNzY5ZjRjIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2NvdW50ZXIvMTA0LXF1YWQtOC5jCisrKyBiL2RyaXZlcnMvY291bnRlci8x
MDQtcXVhZC04LmMKQEAgLTExNiw3ICsxMTYsNyBAQCBzdGF0aWMgaW50IHF1YWQ4X3NpZ25hbF9y
ZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKIH0KIAogc3RhdGljIGludCBxdWFk
OF9jb3VudF9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQlzdHJ1Y3QgY291
bnRlcl9jb3VudCAqY291bnQsIHVuc2lnbmVkIGxvbmcgKnZhbCkKKwkJCSAgICBzdHJ1Y3QgY291
bnRlcl9jb3VudCAqY291bnQsIHU2NCAqdmFsKQogewogCXN0cnVjdCBxdWFkOCAqY29uc3QgcHJp
diA9IGNvdW50ZXItPnByaXY7CiAJY29uc3QgaW50IGJhc2Vfb2Zmc2V0ID0gcHJpdi0+YmFzZSAr
IDIgKiBjb3VudC0+aWQ7CkBAIC0xNDcsNyArMTQ3LDcgQEAgc3RhdGljIGludCBxdWFkOF9jb3Vu
dF9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKIH0KIAogc3RhdGljIGludCBx
dWFkOF9jb3VudF93cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0Jc3RydWN0
IGNvdW50ZXJfY291bnQgKmNvdW50LCB1bnNpZ25lZCBsb25nIHZhbCkKKwkJCSAgICAgc3RydWN0
IGNvdW50ZXJfY291bnQgKmNvdW50LCB1NjQgdmFsKQogewogCXN0cnVjdCBxdWFkOCAqY29uc3Qg
cHJpdiA9IGNvdW50ZXItPnByaXY7CiAJY29uc3QgaW50IGJhc2Vfb2Zmc2V0ID0gcHJpdi0+YmFz
ZSArIDIgKiBjb3VudC0+aWQ7CkBAIC0xODcsMjIgKzE4NywxNiBAQCBzdGF0aWMgaW50IHF1YWQ4
X2NvdW50X3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKIAlyZXR1cm4gMDsK
IH0KIAotZW51bSBxdWFkOF9jb3VudF9mdW5jdGlvbiB7Ci0JUVVBRDhfQ09VTlRfRlVOQ1RJT05f
UFVMU0VfRElSRUNUSU9OID0gMCwKLQlRVUFEOF9DT1VOVF9GVU5DVElPTl9RVUFEUkFUVVJFX1gx
LAotCVFVQUQ4X0NPVU5UX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDIsCi0JUVVBRDhfQ09VTlRfRlVO
Q1RJT05fUVVBRFJBVFVSRV9YNAotfTsKLQogc3RhdGljIGNvbnN0IGVudW0gY291bnRlcl9mdW5j
dGlvbiBxdWFkOF9jb3VudF9mdW5jdGlvbnNfbGlzdFtdID0gewotCVtRVUFEOF9DT1VOVF9GVU5D
VElPTl9QVUxTRV9ESVJFQ1RJT05dID0gQ09VTlRFUl9GVU5DVElPTl9QVUxTRV9ESVJFQ1RJT04s
Ci0JW1FVQUQ4X0NPVU5UX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDFdID0gQ09VTlRFUl9GVU5DVElP
Tl9RVUFEUkFUVVJFX1gxX0EsCi0JW1FVQUQ4X0NPVU5UX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDJd
ID0gQ09VTlRFUl9GVU5DVElPTl9RVUFEUkFUVVJFX1gyX0EsCi0JW1FVQUQ4X0NPVU5UX0ZVTkNU
SU9OX1FVQURSQVRVUkVfWDRdID0gQ09VTlRFUl9GVU5DVElPTl9RVUFEUkFUVVJFX1g0CisJQ09V
TlRFUl9GVU5DVElPTl9QVUxTRV9ESVJFQ1RJT04sCisJQ09VTlRFUl9GVU5DVElPTl9RVUFEUkFU
VVJFX1gxX0EsCisJQ09VTlRFUl9GVU5DVElPTl9RVUFEUkFUVVJFX1gyX0EsCisJQ09VTlRFUl9G
VU5DVElPTl9RVUFEUkFUVVJFX1g0LAogfTsKIAotc3RhdGljIGludCBxdWFkOF9mdW5jdGlvbl9n
ZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCXN0cnVjdCBjb3VudGVyX2NvdW50
ICpjb3VudCwgc2l6ZV90ICpmdW5jdGlvbikKK3N0YXRpYyBpbnQgcXVhZDhfZnVuY3Rpb25fcmVh
ZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkgICAgICAgc3RydWN0IGNvdW50
ZXJfY291bnQgKmNvdW50LAorCQkJICAgICAgIGVudW0gY291bnRlcl9mdW5jdGlvbiAqZnVuY3Rp
b24pCiB7CiAJc3RydWN0IHF1YWQ4ICpjb25zdCBwcml2ID0gY291bnRlci0+cHJpdjsKIAljb25z
dCBpbnQgaWQgPSBjb3VudC0+aWQ7CkBAIC0yMTIsMjUgKzIwNiwyNiBAQCBzdGF0aWMgaW50IHF1
YWQ4X2Z1bmN0aW9uX2dldChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAJaWYgKHBy
aXYtPnF1YWRyYXR1cmVfbW9kZVtpZF0pCiAJCXN3aXRjaCAocHJpdi0+cXVhZHJhdHVyZV9zY2Fs
ZVtpZF0pIHsKIAkJY2FzZSAwOgotCQkJKmZ1bmN0aW9uID0gUVVBRDhfQ09VTlRfRlVOQ1RJT05f
UVVBRFJBVFVSRV9YMTsKKwkJCSpmdW5jdGlvbiA9IENPVU5URVJfRlVOQ1RJT05fUVVBRFJBVFVS
RV9YMV9BOwogCQkJYnJlYWs7CiAJCWNhc2UgMToKLQkJCSpmdW5jdGlvbiA9IFFVQUQ4X0NPVU5U
X0ZVTkNUSU9OX1FVQURSQVRVUkVfWDI7CisJCQkqZnVuY3Rpb24gPSBDT1VOVEVSX0ZVTkNUSU9O
X1FVQURSQVRVUkVfWDJfQTsKIAkJCWJyZWFrOwogCQljYXNlIDI6Ci0JCQkqZnVuY3Rpb24gPSBR
VUFEOF9DT1VOVF9GVU5DVElPTl9RVUFEUkFUVVJFX1g0OworCQkJKmZ1bmN0aW9uID0gQ09VTlRF
Ul9GVU5DVElPTl9RVUFEUkFUVVJFX1g0OwogCQkJYnJlYWs7CiAJCX0KIAllbHNlCi0JCSpmdW5j
dGlvbiA9IFFVQUQ4X0NPVU5UX0ZVTkNUSU9OX1BVTFNFX0RJUkVDVElPTjsKKwkJKmZ1bmN0aW9u
ID0gQ09VTlRFUl9GVU5DVElPTl9QVUxTRV9ESVJFQ1RJT047CiAKIAltdXRleF91bmxvY2soJnBy
aXYtPmxvY2spOwogCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBpbnQgcXVhZDhfZnVuY3Rpb25f
c2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQlzdHJ1Y3QgY291bnRlcl9jb3Vu
dCAqY291bnQsIHNpemVfdCBmdW5jdGlvbikKK3N0YXRpYyBpbnQgcXVhZDhfZnVuY3Rpb25fd3Jp
dGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCXN0cnVjdCBjb3VudGVyX2Nv
dW50ICpjb3VudCwKKwkJCQllbnVtIGNvdW50ZXJfZnVuY3Rpb24gZnVuY3Rpb24pCiB7CiAJc3Ry
dWN0IHF1YWQ4ICpjb25zdCBwcml2ID0gY291bnRlci0+cHJpdjsKIAljb25zdCBpbnQgaWQgPSBj
b3VudC0+aWQ7CkBAIC0yNDYsNyArMjQxLDcgQEAgc3RhdGljIGludCBxdWFkOF9mdW5jdGlvbl9z
ZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAogCW1vZGVfY2ZnID0gcHJpdi0+Y291
bnRfbW9kZVtpZF0gPDwgMTsKIAlpZHJfY2ZnID0gcHJpdi0+aW5kZXhfcG9sYXJpdHlbaWRdIDw8
IDE7CiAKLQlpZiAoZnVuY3Rpb24gPT0gUVVBRDhfQ09VTlRfRlVOQ1RJT05fUFVMU0VfRElSRUNU
SU9OKSB7CisJaWYgKGZ1bmN0aW9uID09IENPVU5URVJfRlVOQ1RJT05fUFVMU0VfRElSRUNUSU9O
KSB7CiAJCSpxdWFkcmF0dXJlX21vZGUgPSAwOwogCiAJCS8qIFF1YWRyYXR1cmUgc2NhbGluZyBv
bmx5IGF2YWlsYWJsZSBpbiBxdWFkcmF0dXJlIG1vZGUgKi8KQEAgLTI2MiwxNSArMjU3LDE1IEBA
IHN0YXRpYyBpbnQgcXVhZDhfZnVuY3Rpb25fc2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291
bnRlciwKIAkJKnF1YWRyYXR1cmVfbW9kZSA9IDE7CiAKIAkJc3dpdGNoIChmdW5jdGlvbikgewot
CQljYXNlIFFVQUQ4X0NPVU5UX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDE6CisJCWNhc2UgQ09VTlRF
Ul9GVU5DVElPTl9RVUFEUkFUVVJFX1gxX0E6CiAJCQkqc2NhbGUgPSAwOwogCQkJbW9kZV9jZmcg
fD0gUVVBRDhfQ01SX1FVQURSQVRVUkVfWDE7CiAJCQlicmVhazsKLQkJY2FzZSBRVUFEOF9DT1VO
VF9GVU5DVElPTl9RVUFEUkFUVVJFX1gyOgorCQljYXNlIENPVU5URVJfRlVOQ1RJT05fUVVBRFJB
VFVSRV9YMl9BOgogCQkJKnNjYWxlID0gMTsKIAkJCW1vZGVfY2ZnIHw9IFFVQUQ4X0NNUl9RVUFE
UkFUVVJFX1gyOwogCQkJYnJlYWs7Ci0JCWNhc2UgUVVBRDhfQ09VTlRfRlVOQ1RJT05fUVVBRFJB
VFVSRV9YNDoKKwkJY2FzZSBDT1VOVEVSX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDQ6CiAJCQkqc2Nh
bGUgPSAyOwogCQkJbW9kZV9jZmcgfD0gUVVBRDhfQ01SX1FVQURSQVRVUkVfWDQ7CiAJCQlicmVh
azsKQEAgLTI4OSw4ICsyODQsOSBAQCBzdGF0aWMgaW50IHF1YWQ4X2Z1bmN0aW9uX3NldChzdHJ1
Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyB2b2lk
IHF1YWQ4X2RpcmVjdGlvbl9nZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCXN0
cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgZW51bSBjb3VudGVyX2NvdW50X2RpcmVjdGlvbiAq
ZGlyZWN0aW9uKQorc3RhdGljIGludCBxdWFkOF9kaXJlY3Rpb25fcmVhZChzdHJ1Y3QgY291bnRl
cl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAorCQkJ
CWVudW0gY291bnRlcl9jb3VudF9kaXJlY3Rpb24gKmRpcmVjdGlvbikKIHsKIAljb25zdCBzdHJ1
Y3QgcXVhZDggKmNvbnN0IHByaXYgPSBjb3VudGVyLT5wcml2OwogCXVuc2lnbmVkIGludCB1ZF9m
bGFnOwpAQCAtMzAxLDc2ICsyOTcsNzQgQEAgc3RhdGljIHZvaWQgcXVhZDhfZGlyZWN0aW9uX2dl
dChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAKIAkqZGlyZWN0aW9uID0gKHVkX2Zs
YWcpID8gQ09VTlRFUl9DT1VOVF9ESVJFQ1RJT05fRk9SV0FSRCA6CiAJCUNPVU5URVJfQ09VTlRf
RElSRUNUSU9OX0JBQ0tXQVJEOwotfQogCi1lbnVtIHF1YWQ4X3N5bmFwc2VfYWN0aW9uIHsKLQlR
VUFEOF9TWU5BUFNFX0FDVElPTl9OT05FID0gMCwKLQlRVUFEOF9TWU5BUFNFX0FDVElPTl9SSVNJ
TkdfRURHRSwKLQlRVUFEOF9TWU5BUFNFX0FDVElPTl9GQUxMSU5HX0VER0UsCi0JUVVBRDhfU1lO
QVBTRV9BQ1RJT05fQk9USF9FREdFUwotfTsKKwlyZXR1cm4gMDsKK30KIAogc3RhdGljIGNvbnN0
IGVudW0gY291bnRlcl9zeW5hcHNlX2FjdGlvbiBxdWFkOF9pbmRleF9hY3Rpb25zX2xpc3RbXSA9
IHsKLQlbUVVBRDhfU1lOQVBTRV9BQ1RJT05fTk9ORV0gPSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9O
X05PTkUsCi0JW1FVQUQ4X1NZTkFQU0VfQUNUSU9OX1JJU0lOR19FREdFXSA9IENPVU5URVJfU1lO
QVBTRV9BQ1RJT05fUklTSU5HX0VER0UKKwlDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX05PTkUsCisJ
Q09VTlRFUl9TWU5BUFNFX0FDVElPTl9SSVNJTkdfRURHRSwKIH07CiAKIHN0YXRpYyBjb25zdCBl
bnVtIGNvdW50ZXJfc3luYXBzZV9hY3Rpb24gcXVhZDhfc3luYXBzZV9hY3Rpb25zX2xpc3RbXSA9
IHsKLQlbUVVBRDhfU1lOQVBTRV9BQ1RJT05fTk9ORV0gPSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9O
X05PTkUsCi0JW1FVQUQ4X1NZTkFQU0VfQUNUSU9OX1JJU0lOR19FREdFXSA9IENPVU5URVJfU1lO
QVBTRV9BQ1RJT05fUklTSU5HX0VER0UsCi0JW1FVQUQ4X1NZTkFQU0VfQUNUSU9OX0ZBTExJTkdf
RURHRV0gPSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX0ZBTExJTkdfRURHRSwKLQlbUVVBRDhfU1lO
QVBTRV9BQ1RJT05fQk9USF9FREdFU10gPSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX0JPVEhfRURH
RVMKKwlDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX05PTkUsCisJQ09VTlRFUl9TWU5BUFNFX0FDVElP
Tl9SSVNJTkdfRURHRSwKKwlDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX0ZBTExJTkdfRURHRSwKKwlD
T1VOVEVSX1NZTkFQU0VfQUNUSU9OX0JPVEhfRURHRVMsCiB9OwogCi1zdGF0aWMgaW50IHF1YWQ4
X2FjdGlvbl9nZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCXN0cnVjdCBjb3Vu
dGVyX2NvdW50ICpjb3VudCwgc3RydWN0IGNvdW50ZXJfc3luYXBzZSAqc3luYXBzZSwKLQlzaXpl
X3QgKmFjdGlvbikKK3N0YXRpYyBpbnQgcXVhZDhfYWN0aW9uX3JlYWQoc3RydWN0IGNvdW50ZXJf
ZGV2aWNlICpjb3VudGVyLAorCQkJICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCisJ
CQkgICAgIHN0cnVjdCBjb3VudGVyX3N5bmFwc2UgKnN5bmFwc2UsCisJCQkgICAgIGVudW0gY291
bnRlcl9zeW5hcHNlX2FjdGlvbiAqYWN0aW9uKQogewogCXN0cnVjdCBxdWFkOCAqY29uc3QgcHJp
diA9IGNvdW50ZXItPnByaXY7CiAJaW50IGVycjsKLQlzaXplX3QgZnVuY3Rpb24gPSAwOworCWVu
dW0gY291bnRlcl9mdW5jdGlvbiBmdW5jdGlvbjsKIAljb25zdCBzaXplX3Qgc2lnbmFsX2FfaWQg
PSBjb3VudC0+c3luYXBzZXNbMF0uc2lnbmFsLT5pZDsKIAllbnVtIGNvdW50ZXJfY291bnRfZGly
ZWN0aW9uIGRpcmVjdGlvbjsKIAogCS8qIEhhbmRsZSBJbmRleCBzaWduYWxzICovCiAJaWYgKHN5
bmFwc2UtPnNpZ25hbC0+aWQgPj0gMTYpIHsKIAkJaWYgKHByaXYtPnByZXNldF9lbmFibGVbY291
bnQtPmlkXSkKLQkJCSphY3Rpb24gPSBRVUFEOF9TWU5BUFNFX0FDVElPTl9SSVNJTkdfRURHRTsK
KwkJCSphY3Rpb24gPSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX1JJU0lOR19FREdFOwogCQllbHNl
Ci0JCQkqYWN0aW9uID0gUVVBRDhfU1lOQVBTRV9BQ1RJT05fTk9ORTsKKwkJCSphY3Rpb24gPSBD
T1VOVEVSX1NZTkFQU0VfQUNUSU9OX05PTkU7CiAKIAkJcmV0dXJuIDA7CiAJfQogCi0JZXJyID0g
cXVhZDhfZnVuY3Rpb25fZ2V0KGNvdW50ZXIsIGNvdW50LCAmZnVuY3Rpb24pOworCWVyciA9IHF1
YWQ4X2Z1bmN0aW9uX3JlYWQoY291bnRlciwgY291bnQsICZmdW5jdGlvbik7CiAJaWYgKGVycikK
IAkJcmV0dXJuIGVycjsKIAogCS8qIERlZmF1bHQgYWN0aW9uIG1vZGUgKi8KLQkqYWN0aW9uID0g
UVVBRDhfU1lOQVBTRV9BQ1RJT05fTk9ORTsKKwkqYWN0aW9uID0gQ09VTlRFUl9TWU5BUFNFX0FD
VElPTl9OT05FOwogCiAJLyogRGV0ZXJtaW5lIGFjdGlvbiBtb2RlIGJhc2VkIG9uIGN1cnJlbnQg
Y291bnQgZnVuY3Rpb24gbW9kZSAqLwogCXN3aXRjaCAoZnVuY3Rpb24pIHsKLQljYXNlIFFVQUQ4
X0NPVU5UX0ZVTkNUSU9OX1BVTFNFX0RJUkVDVElPTjoKKwljYXNlIENPVU5URVJfRlVOQ1RJT05f
UFVMU0VfRElSRUNUSU9OOgogCQlpZiAoc3luYXBzZS0+c2lnbmFsLT5pZCA9PSBzaWduYWxfYV9p
ZCkKLQkJCSphY3Rpb24gPSBRVUFEOF9TWU5BUFNFX0FDVElPTl9SSVNJTkdfRURHRTsKKwkJCSph
Y3Rpb24gPSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX1JJU0lOR19FREdFOwogCQlyZXR1cm4gMDsK
LQljYXNlIFFVQUQ4X0NPVU5UX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDE6CisJY2FzZSBDT1VOVEVS
X0ZVTkNUSU9OX1FVQURSQVRVUkVfWDFfQToKIAkJaWYgKHN5bmFwc2UtPnNpZ25hbC0+aWQgPT0g
c2lnbmFsX2FfaWQpIHsKLQkJCXF1YWQ4X2RpcmVjdGlvbl9nZXQoY291bnRlciwgY291bnQsICZk
aXJlY3Rpb24pOworCQkJZXJyID0gcXVhZDhfZGlyZWN0aW9uX3JlYWQoY291bnRlciwgY291bnQs
ICZkaXJlY3Rpb24pOworCQkJaWYgKGVycikKKwkJCQlyZXR1cm4gZXJyOwogCiAJCQlpZiAoZGly
ZWN0aW9uID09IENPVU5URVJfQ09VTlRfRElSRUNUSU9OX0ZPUldBUkQpCi0JCQkJKmFjdGlvbiA9
IFFVQUQ4X1NZTkFQU0VfQUNUSU9OX1JJU0lOR19FREdFOworCQkJCSphY3Rpb24gPSBDT1VOVEVS
X1NZTkFQU0VfQUNUSU9OX1JJU0lOR19FREdFOwogCQkJZWxzZQotCQkJCSphY3Rpb24gPSBRVUFE
OF9TWU5BUFNFX0FDVElPTl9GQUxMSU5HX0VER0U7CisJCQkJKmFjdGlvbiA9IENPVU5URVJfU1lO
QVBTRV9BQ1RJT05fRkFMTElOR19FREdFOwogCQl9CiAJCXJldHVybiAwOwotCWNhc2UgUVVBRDhf
Q09VTlRfRlVOQ1RJT05fUVVBRFJBVFVSRV9YMjoKKwljYXNlIENPVU5URVJfRlVOQ1RJT05fUVVB
RFJBVFVSRV9YMl9BOgogCQlpZiAoc3luYXBzZS0+c2lnbmFsLT5pZCA9PSBzaWduYWxfYV9pZCkK
LQkJCSphY3Rpb24gPSBRVUFEOF9TWU5BUFNFX0FDVElPTl9CT1RIX0VER0VTOworCQkJKmFjdGlv
biA9IENPVU5URVJfU1lOQVBTRV9BQ1RJT05fQk9USF9FREdFUzsKIAkJcmV0dXJuIDA7Ci0JY2Fz
ZSBRVUFEOF9DT1VOVF9GVU5DVElPTl9RVUFEUkFUVVJFX1g0OgotCQkqYWN0aW9uID0gUVVBRDhf
U1lOQVBTRV9BQ1RJT05fQk9USF9FREdFUzsKKwljYXNlIENPVU5URVJfRlVOQ1RJT05fUVVBRFJB
VFVSRV9YNDoKKwkJKmFjdGlvbiA9IENPVU5URVJfU1lOQVBTRV9BQ1RJT05fQk9USF9FREdFUzsK
IAkJcmV0dXJuIDA7CiAJZGVmYXVsdDoKIAkJLyogc2hvdWxkIG5ldmVyIHJlYWNoIHRoaXMgcGF0
aCAqLwpAQCAtMzgyLDkgKzM3Niw5IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgY291bnRlcl9vcHMg
cXVhZDhfb3BzID0gewogCS5zaWduYWxfcmVhZCA9IHF1YWQ4X3NpZ25hbF9yZWFkLAogCS5jb3Vu
dF9yZWFkID0gcXVhZDhfY291bnRfcmVhZCwKIAkuY291bnRfd3JpdGUgPSBxdWFkOF9jb3VudF93
cml0ZSwKLQkuZnVuY3Rpb25fZ2V0ID0gcXVhZDhfZnVuY3Rpb25fZ2V0LAotCS5mdW5jdGlvbl9z
ZXQgPSBxdWFkOF9mdW5jdGlvbl9zZXQsCi0JLmFjdGlvbl9nZXQgPSBxdWFkOF9hY3Rpb25fZ2V0
CisJLmZ1bmN0aW9uX3JlYWQgPSBxdWFkOF9mdW5jdGlvbl9yZWFkLAorCS5mdW5jdGlvbl93cml0
ZSA9IHF1YWQ4X2Z1bmN0aW9uX3dyaXRlLAorCS5hY3Rpb25fcmVhZCA9IHF1YWQ4X2FjdGlvbl9y
ZWFkCiB9OwogCiBzdGF0aWMgY29uc3QgY2hhciAqY29uc3QgcXVhZDhfaW5kZXhfcG9sYXJpdHlf
bW9kZXNbXSA9IHsKQEAgLTM5Myw3ICszODcsOCBAQCBzdGF0aWMgY29uc3QgY2hhciAqY29uc3Qg
cXVhZDhfaW5kZXhfcG9sYXJpdHlfbW9kZXNbXSA9IHsKIH07CiAKIHN0YXRpYyBpbnQgcXVhZDhf
aW5kZXhfcG9sYXJpdHlfZ2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQlzdHJ1
Y3QgY291bnRlcl9zaWduYWwgKnNpZ25hbCwgc2l6ZV90ICppbmRleF9wb2xhcml0eSkKKwkJCQkg
ICAgc3RydWN0IGNvdW50ZXJfc2lnbmFsICpzaWduYWwsCisJCQkJICAgIHUzMiAqaW5kZXhfcG9s
YXJpdHkpCiB7CiAJY29uc3Qgc3RydWN0IHF1YWQ4ICpjb25zdCBwcml2ID0gY291bnRlci0+cHJp
djsKIAljb25zdCBzaXplX3QgY2hhbm5lbF9pZCA9IHNpZ25hbC0+aWQgLSAxNjsKQEAgLTQwNCw3
ICszOTksOCBAQCBzdGF0aWMgaW50IHF1YWQ4X2luZGV4X3BvbGFyaXR5X2dldChzdHJ1Y3QgY291
bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiB9CiAKIHN0YXRpYyBpbnQgcXVhZDhfaW5kZXhfcG9sYXJp
dHlfc2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQlzdHJ1Y3QgY291bnRlcl9z
aWduYWwgKnNpZ25hbCwgc2l6ZV90IGluZGV4X3BvbGFyaXR5KQorCQkJCSAgICBzdHJ1Y3QgY291
bnRlcl9zaWduYWwgKnNpZ25hbCwKKwkJCQkgICAgdTMyIGluZGV4X3BvbGFyaXR5KQogewogCXN0
cnVjdCBxdWFkOCAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7CiAJY29uc3Qgc2l6ZV90IGNo
YW5uZWxfaWQgPSBzaWduYWwtPmlkIC0gMTY7CkBAIC00MjUsMjAgKzQyMSwxNCBAQCBzdGF0aWMg
aW50IHF1YWQ4X2luZGV4X3BvbGFyaXR5X3NldChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50
ZXIsCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBzdHJ1Y3QgY291bnRlcl9zaWduYWxfZW51bV9l
eHQgcXVhZDhfaW5kZXhfcG9sX2VudW0gPSB7Ci0JLml0ZW1zID0gcXVhZDhfaW5kZXhfcG9sYXJp
dHlfbW9kZXMsCi0JLm51bV9pdGVtcyA9IEFSUkFZX1NJWkUocXVhZDhfaW5kZXhfcG9sYXJpdHlf
bW9kZXMpLAotCS5nZXQgPSBxdWFkOF9pbmRleF9wb2xhcml0eV9nZXQsCi0JLnNldCA9IHF1YWQ4
X2luZGV4X3BvbGFyaXR5X3NldAotfTsKLQogc3RhdGljIGNvbnN0IGNoYXIgKmNvbnN0IHF1YWQ4
X3N5bmNocm9ub3VzX21vZGVzW10gPSB7CiAJIm5vbi1zeW5jaHJvbm91cyIsCiAJInN5bmNocm9u
b3VzIgogfTsKIAogc3RhdGljIGludCBxdWFkOF9zeW5jaHJvbm91c19tb2RlX2dldChzdHJ1Y3Qg
Y291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0Jc3RydWN0IGNvdW50ZXJfc2lnbmFsICpzaWduYWws
IHNpemVfdCAqc3luY2hyb25vdXNfbW9kZSkKKwkJCQkgICAgICBzdHJ1Y3QgY291bnRlcl9zaWdu
YWwgKnNpZ25hbCwKKwkJCQkgICAgICB1MzIgKnN5bmNocm9ub3VzX21vZGUpCiB7CiAJY29uc3Qg
c3RydWN0IHF1YWQ4ICpjb25zdCBwcml2ID0gY291bnRlci0+cHJpdjsKIAljb25zdCBzaXplX3Qg
Y2hhbm5lbF9pZCA9IHNpZ25hbC0+aWQgLSAxNjsKQEAgLTQ0OSw3ICs0MzksOCBAQCBzdGF0aWMg
aW50IHF1YWQ4X3N5bmNocm9ub3VzX21vZGVfZ2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291
bnRlciwKIH0KIAogc3RhdGljIGludCBxdWFkOF9zeW5jaHJvbm91c19tb2RlX3NldChzdHJ1Y3Qg
Y291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0Jc3RydWN0IGNvdW50ZXJfc2lnbmFsICpzaWduYWws
IHNpemVfdCBzeW5jaHJvbm91c19tb2RlKQorCQkJCSAgICAgIHN0cnVjdCBjb3VudGVyX3NpZ25h
bCAqc2lnbmFsLAorCQkJCSAgICAgIHUzMiBzeW5jaHJvbm91c19tb2RlKQogewogCXN0cnVjdCBx
dWFkOCAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7CiAJY29uc3Qgc2l6ZV90IGNoYW5uZWxf
aWQgPSBzaWduYWwtPmlkIC0gMTY7CkBAIC00NzYsMjIgKzQ2NywxOCBAQCBzdGF0aWMgaW50IHF1
YWQ4X3N5bmNocm9ub3VzX21vZGVfc2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwK
IAlyZXR1cm4gMDsKIH0KIAotc3RhdGljIHN0cnVjdCBjb3VudGVyX3NpZ25hbF9lbnVtX2V4dCBx
dWFkOF9zeW5fbW9kZV9lbnVtID0gewotCS5pdGVtcyA9IHF1YWQ4X3N5bmNocm9ub3VzX21vZGVz
LAotCS5udW1faXRlbXMgPSBBUlJBWV9TSVpFKHF1YWQ4X3N5bmNocm9ub3VzX21vZGVzKSwKLQku
Z2V0ID0gcXVhZDhfc3luY2hyb25vdXNfbW9kZV9nZXQsCi0JLnNldCA9IHF1YWQ4X3N5bmNocm9u
b3VzX21vZGVfc2V0Ci19OwotCi1zdGF0aWMgc3NpemVfdCBxdWFkOF9jb3VudF9mbG9vcl9yZWFk
KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQlzdHJ1Y3QgY291bnRlcl9jb3VudCAq
Y291bnQsIHZvaWQgKnByaXZhdGUsIGNoYXIgKmJ1ZikKK3N0YXRpYyBpbnQgcXVhZDhfY291bnRf
Zmxvb3JfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJICBzdHJ1Y3Qg
Y291bnRlcl9jb3VudCAqY291bnQsIHU2NCAqZmxvb3IpCiB7CiAJLyogT25seSBhIGZsb29yIG9m
IDAgaXMgc3VwcG9ydGVkICovCi0JcmV0dXJuIHNwcmludGYoYnVmLCAiMFxuIik7CisJKmZsb29y
ID0gMDsKKworCXJldHVybiAwOwogfQogCi1zdGF0aWMgaW50IHF1YWQ4X2NvdW50X21vZGVfZ2V0
KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQlzdHJ1Y3QgY291bnRlcl9jb3VudCAq
Y291bnQsIHNpemVfdCAqY250X21vZGUpCitzdGF0aWMgaW50IHF1YWQ4X2NvdW50X21vZGVfcmVh
ZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJIHN0cnVjdCBjb3VudGVyX2Nv
dW50ICpjb3VudCwKKwkJCQkgZW51bSBjb3VudGVyX2NvdW50X21vZGUgKmNudF9tb2RlKQogewog
CWNvbnN0IHN0cnVjdCBxdWFkOCAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7CiAKQEAgLTUx
NCwyNiArNTAxLDI4IEBAIHN0YXRpYyBpbnQgcXVhZDhfY291bnRfbW9kZV9nZXQoc3RydWN0IGNv
dW50ZXJfZGV2aWNlICpjb3VudGVyLAogCXJldHVybiAwOwogfQogCi1zdGF0aWMgaW50IHF1YWQ4
X2NvdW50X21vZGVfc2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQlzdHJ1Y3Qg
Y291bnRlcl9jb3VudCAqY291bnQsIHNpemVfdCBjbnRfbW9kZSkKK3N0YXRpYyBpbnQgcXVhZDhf
Y291bnRfbW9kZV93cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJICBz
dHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCisJCQkJICBlbnVtIGNvdW50ZXJfY291bnRfbW9k
ZSBjbnRfbW9kZSkKIHsKIAlzdHJ1Y3QgcXVhZDggKmNvbnN0IHByaXYgPSBjb3VudGVyLT5wcml2
OworCXVuc2lnbmVkIGludCBjb3VudF9tb2RlOwogCXVuc2lnbmVkIGludCBtb2RlX2NmZzsKIAlj
b25zdCBpbnQgYmFzZV9vZmZzZXQgPSBwcml2LT5iYXNlICsgMiAqIGNvdW50LT5pZCArIDE7CiAK
IAkvKiBNYXAgR2VuZXJpYyBDb3VudGVyIGNvdW50IG1vZGUgdG8gMTA0LVFVQUQtOCBjb3VudCBt
b2RlICovCiAJc3dpdGNoIChjbnRfbW9kZSkgewogCWNhc2UgQ09VTlRFUl9DT1VOVF9NT0RFX05P
Uk1BTDoKLQkJY250X21vZGUgPSAwOworCQljb3VudF9tb2RlID0gMDsKIAkJYnJlYWs7CiAJY2Fz
ZSBDT1VOVEVSX0NPVU5UX01PREVfUkFOR0VfTElNSVQ6Ci0JCWNudF9tb2RlID0gMTsKKwkJY291
bnRfbW9kZSA9IDE7CiAJCWJyZWFrOwogCWNhc2UgQ09VTlRFUl9DT1VOVF9NT0RFX05PTl9SRUNZ
Q0xFOgotCQljbnRfbW9kZSA9IDI7CisJCWNvdW50X21vZGUgPSAyOwogCQlicmVhazsKIAljYXNl
IENPVU5URVJfQ09VTlRfTU9ERV9NT0RVTE9fTjoKLQkJY250X21vZGUgPSAzOworCQljb3VudF9t
b2RlID0gMzsKIAkJYnJlYWs7CiAJZGVmYXVsdDoKIAkJLyogc2hvdWxkIG5ldmVyIHJlYWNoIHRo
aXMgcGF0aCAqLwpAQCAtNTQyLDEwICs1MzEsMTAgQEAgc3RhdGljIGludCBxdWFkOF9jb3VudF9t
b2RlX3NldChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAKIAltdXRleF9sb2NrKCZw
cml2LT5sb2NrKTsKIAotCXByaXYtPmNvdW50X21vZGVbY291bnQtPmlkXSA9IGNudF9tb2RlOwor
CXByaXYtPmNvdW50X21vZGVbY291bnQtPmlkXSA9IGNvdW50X21vZGU7CiAKIAkvKiBTZXQgY291
bnQgbW9kZSBjb25maWd1cmF0aW9uIHZhbHVlICovCi0JbW9kZV9jZmcgPSBjbnRfbW9kZSA8PCAx
OworCW1vZGVfY2ZnID0gY291bnRfbW9kZSA8PCAxOwogCiAJLyogQWRkIHF1YWRyYXR1cmUgbW9k
ZSBjb25maWd1cmF0aW9uICovCiAJaWYgKHByaXYtPnF1YWRyYXR1cmVfbW9kZVtjb3VudC0+aWRd
KQpAQCAtNTU5LDU2ICs1NDgsMzUgQEAgc3RhdGljIGludCBxdWFkOF9jb3VudF9tb2RlX3NldChz
dHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBz
dHJ1Y3QgY291bnRlcl9jb3VudF9lbnVtX2V4dCBxdWFkOF9jbnRfbW9kZV9lbnVtID0gewotCS5p
dGVtcyA9IGNvdW50ZXJfY291bnRfbW9kZV9zdHIsCi0JLm51bV9pdGVtcyA9IEFSUkFZX1NJWkUo
Y291bnRlcl9jb3VudF9tb2RlX3N0ciksCi0JLmdldCA9IHF1YWQ4X2NvdW50X21vZGVfZ2V0LAot
CS5zZXQgPSBxdWFkOF9jb3VudF9tb2RlX3NldAotfTsKLQotc3RhdGljIHNzaXplX3QgcXVhZDhf
Y291bnRfZGlyZWN0aW9uX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCXN0
cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgdm9pZCAqcHJpdiwgY2hhciAqYnVmKQotewotCWVu
dW0gY291bnRlcl9jb3VudF9kaXJlY3Rpb24gZGlyOwotCi0JcXVhZDhfZGlyZWN0aW9uX2dldChj
b3VudGVyLCBjb3VudCwgJmRpcik7Ci0KLQlyZXR1cm4gc3ByaW50ZihidWYsICIlc1xuIiwgY291
bnRlcl9jb3VudF9kaXJlY3Rpb25fc3RyW2Rpcl0pOwotfQotCi1zdGF0aWMgc3NpemVfdCBxdWFk
OF9jb3VudF9lbmFibGVfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0Jc3Ry
dWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB2b2lkICpwcml2YXRlLCBjaGFyICpidWYpCitzdGF0
aWMgaW50IHF1YWQ4X2NvdW50X2VuYWJsZV9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291
bnRlciwKKwkJCQkgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHU4ICplbmFibGUpCiB7
CiAJY29uc3Qgc3RydWN0IHF1YWQ4ICpjb25zdCBwcml2ID0gY291bnRlci0+cHJpdjsKIAotCXJl
dHVybiBzcHJpbnRmKGJ1ZiwgIiV1XG4iLCBwcml2LT5hYl9lbmFibGVbY291bnQtPmlkXSk7CisJ
KmVuYWJsZSA9IHByaXYtPmFiX2VuYWJsZVtjb3VudC0+aWRdOworCisJcmV0dXJuIDA7CiB9CiAK
LXN0YXRpYyBzc2l6ZV90IHF1YWQ4X2NvdW50X2VuYWJsZV93cml0ZShzdHJ1Y3QgY291bnRlcl9k
ZXZpY2UgKmNvdW50ZXIsCi0Jc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB2b2lkICpwcml2
YXRlLCBjb25zdCBjaGFyICpidWYsIHNpemVfdCBsZW4pCitzdGF0aWMgaW50IHF1YWQ4X2NvdW50
X2VuYWJsZV93cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJICAgIHN0
cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgdTggZW5hYmxlKQogewogCXN0cnVjdCBxdWFkOCAq
Y29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7CiAJY29uc3QgaW50IGJhc2Vfb2Zmc2V0ID0gcHJp
di0+YmFzZSArIDIgKiBjb3VudC0+aWQ7Ci0JaW50IGVycjsKLQlib29sIGFiX2VuYWJsZTsKIAl1
bnNpZ25lZCBpbnQgaW9yX2NmZzsKIAotCWVyciA9IGtzdHJ0b2Jvb2woYnVmLCAmYWJfZW5hYmxl
KTsKLQlpZiAoZXJyKQotCQlyZXR1cm4gZXJyOwotCiAJbXV0ZXhfbG9jaygmcHJpdi0+bG9jayk7
CiAKLQlwcml2LT5hYl9lbmFibGVbY291bnQtPmlkXSA9IGFiX2VuYWJsZTsKKwlwcml2LT5hYl9l
bmFibGVbY291bnQtPmlkXSA9IGVuYWJsZTsKIAotCWlvcl9jZmcgPSBhYl9lbmFibGUgfCBwcml2
LT5wcmVzZXRfZW5hYmxlW2NvdW50LT5pZF0gPDwgMTsKKwlpb3JfY2ZnID0gZW5hYmxlIHwgcHJp
di0+cHJlc2V0X2VuYWJsZVtjb3VudC0+aWRdIDw8IDE7CiAKIAkvKiBMb2FkIEkvTyBjb250cm9s
IGNvbmZpZ3VyYXRpb24gKi8KIAlvdXRiKFFVQUQ4X0NUUl9JT1IgfCBpb3JfY2ZnLCBiYXNlX29m
ZnNldCArIDEpOwogCiAJbXV0ZXhfdW5sb2NrKCZwcml2LT5sb2NrKTsKIAotCXJldHVybiBsZW47
CisJcmV0dXJuIDA7CiB9CiAKIHN0YXRpYyBjb25zdCBjaGFyICpjb25zdCBxdWFkOF9ub2lzZV9l
cnJvcl9zdGF0ZXNbXSA9IHsKQEAgLTYxNyw3ICs1ODUsNyBAQCBzdGF0aWMgY29uc3QgY2hhciAq
Y29uc3QgcXVhZDhfbm9pc2VfZXJyb3Jfc3RhdGVzW10gPSB7CiB9OwogCiBzdGF0aWMgaW50IHF1
YWQ4X2Vycm9yX25vaXNlX2dldChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0Jc3Ry
dWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCBzaXplX3QgKm5vaXNlX2Vycm9yKQorCQkJCSBzdHJ1
Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHUzMiAqbm9pc2VfZXJyb3IpCiB7CiAJY29uc3Qgc3Ry
dWN0IHF1YWQ4ICpjb25zdCBwcml2ID0gY291bnRlci0+cHJpdjsKIAljb25zdCBpbnQgYmFzZV9v
ZmZzZXQgPSBwcml2LT5iYXNlICsgMiAqIGNvdW50LT5pZCArIDE7CkBAIC02MjcsMTggKzU5NSwx
NCBAQCBzdGF0aWMgaW50IHF1YWQ4X2Vycm9yX25vaXNlX2dldChzdHJ1Y3QgY291bnRlcl9kZXZp
Y2UgKmNvdW50ZXIsCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBzdHJ1Y3QgY291bnRlcl9jb3Vu
dF9lbnVtX2V4dCBxdWFkOF9lcnJvcl9ub2lzZV9lbnVtID0gewotCS5pdGVtcyA9IHF1YWQ4X25v
aXNlX2Vycm9yX3N0YXRlcywKLQkubnVtX2l0ZW1zID0gQVJSQVlfU0laRShxdWFkOF9ub2lzZV9l
cnJvcl9zdGF0ZXMpLAotCS5nZXQgPSBxdWFkOF9lcnJvcl9ub2lzZV9nZXQKLX07Ci0KLXN0YXRp
YyBzc2l6ZV90IHF1YWQ4X2NvdW50X3ByZXNldF9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAq
Y291bnRlciwKLQlzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHZvaWQgKnByaXZhdGUsIGNo
YXIgKmJ1ZikKK3N0YXRpYyBpbnQgcXVhZDhfY291bnRfcHJlc2V0X3JlYWQoc3RydWN0IGNvdW50
ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCSAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwg
dTY0ICpwcmVzZXQpCiB7CiAJY29uc3Qgc3RydWN0IHF1YWQ4ICpjb25zdCBwcml2ID0gY291bnRl
ci0+cHJpdjsKIAotCXJldHVybiBzcHJpbnRmKGJ1ZiwgIiV1XG4iLCBwcml2LT5wcmVzZXRbY291
bnQtPmlkXSk7CisJKnByZXNldCA9IHByaXYtPnByZXNldFtjb3VudC0+aWRdOworCisJcmV0dXJu
IDA7CiB9CiAKIHN0YXRpYyB2b2lkIHF1YWQ4X3ByZXNldF9yZWdpc3Rlcl9zZXQoc3RydWN0IHF1
YWQ4ICpjb25zdCBwcml2LCBjb25zdCBpbnQgaWQsCkBAIC02NTcsMTYgKzYyMSwxMCBAQCBzdGF0
aWMgdm9pZCBxdWFkOF9wcmVzZXRfcmVnaXN0ZXJfc2V0KHN0cnVjdCBxdWFkOCAqY29uc3QgcHJp
diwgY29uc3QgaW50IGlkLAogCQlvdXRiKHByZXNldCA+PiAoOCAqIGkpLCBiYXNlX29mZnNldCk7
CiB9CiAKLXN0YXRpYyBzc2l6ZV90IHF1YWQ4X2NvdW50X3ByZXNldF93cml0ZShzdHJ1Y3QgY291
bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0Jc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB2b2lk
ICpwcml2YXRlLCBjb25zdCBjaGFyICpidWYsIHNpemVfdCBsZW4pCitzdGF0aWMgaW50IHF1YWQ4
X2NvdW50X3ByZXNldF93cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJ
ICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgdTY0IHByZXNldCkKIHsKIAlzdHJ1Y3Qg
cXVhZDggKmNvbnN0IHByaXYgPSBjb3VudGVyLT5wcml2OwotCXVuc2lnbmVkIGludCBwcmVzZXQ7
Ci0JaW50IHJldDsKLQotCXJldCA9IGtzdHJ0b3VpbnQoYnVmLCAwLCAmcHJlc2V0KTsKLQlpZiAo
cmV0KQotCQlyZXR1cm4gcmV0OwogCiAJLyogT25seSAyNC1iaXQgdmFsdWVzIGFyZSBzdXBwb3J0
ZWQgKi8KIAlpZiAocHJlc2V0ID4gMHhGRkZGRkYpCkBAIC02NzgsMTEgKzYzNiwxMSBAQCBzdGF0
aWMgc3NpemVfdCBxdWFkOF9jb3VudF9wcmVzZXRfd3JpdGUoc3RydWN0IGNvdW50ZXJfZGV2aWNl
ICpjb3VudGVyLAogCiAJbXV0ZXhfdW5sb2NrKCZwcml2LT5sb2NrKTsKIAotCXJldHVybiBsZW47
CisJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBzc2l6ZV90IHF1YWQ4X2NvdW50X2NlaWxpbmdfcmVh
ZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0Jc3RydWN0IGNvdW50ZXJfY291bnQg
KmNvdW50LCB2b2lkICpwcml2YXRlLCBjaGFyICpidWYpCitzdGF0aWMgaW50IHF1YWQ4X2NvdW50
X2NlaWxpbmdfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJICAgIHN0
cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgdTY0ICpjZWlsaW5nKQogewogCXN0cnVjdCBxdWFk
OCAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7CiAKQEAgLTY5MiwyNiArNjUwLDIzIEBAIHN0
YXRpYyBzc2l6ZV90IHF1YWQ4X2NvdW50X2NlaWxpbmdfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZp
Y2UgKmNvdW50ZXIsCiAJc3dpdGNoIChwcml2LT5jb3VudF9tb2RlW2NvdW50LT5pZF0pIHsKIAlj
YXNlIDE6CiAJY2FzZSAzOgotCQltdXRleF91bmxvY2soJnByaXYtPmxvY2spOwotCQlyZXR1cm4g
c3ByaW50ZihidWYsICIldVxuIiwgcHJpdi0+cHJlc2V0W2NvdW50LT5pZF0pOworCQkqY2VpbGlu
ZyA9IHByaXYtPnByZXNldFtjb3VudC0+aWRdOworCQlicmVhazsKKwlkZWZhdWx0OgorCQkvKiBC
eSBkZWZhdWx0IDB4MUZGRkZGRiAoMjUgYml0cyB1bnNpZ25lZCkgaXMgbWF4aW11bSBjb3VudCAq
LworCQkqY2VpbGluZyA9IDB4MUZGRkZGRjsKKwkJYnJlYWs7CiAJfQogCiAJbXV0ZXhfdW5sb2Nr
KCZwcml2LT5sb2NrKTsKIAotCS8qIEJ5IGRlZmF1bHQgMHgxRkZGRkZGICgyNSBiaXRzIHVuc2ln
bmVkKSBpcyBtYXhpbXVtIGNvdW50ICovCi0JcmV0dXJuIHNwcmludGYoYnVmLCAiMzM1NTQ0MzFc
biIpOworCXJldHVybiAwOwogfQogCi1zdGF0aWMgc3NpemVfdCBxdWFkOF9jb3VudF9jZWlsaW5n
X3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQlzdHJ1Y3QgY291bnRlcl9j
b3VudCAqY291bnQsIHZvaWQgKnByaXZhdGUsIGNvbnN0IGNoYXIgKmJ1Ziwgc2l6ZV90IGxlbikK
K3N0YXRpYyBpbnQgcXVhZDhfY291bnRfY2VpbGluZ193cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZp
Y2UgKmNvdW50ZXIsCisJCQkJICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHU2NCBj
ZWlsaW5nKQogewogCXN0cnVjdCBxdWFkOCAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7Ci0J
dW5zaWduZWQgaW50IGNlaWxpbmc7Ci0JaW50IHJldDsKLQotCXJldCA9IGtzdHJ0b3VpbnQoYnVm
LCAwLCAmY2VpbGluZyk7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKIAogCS8qIE9ubHkgMjQt
Yml0IHZhbHVlcyBhcmUgc3VwcG9ydGVkICovCiAJaWYgKGNlaWxpbmcgPiAweEZGRkZGRikKQEAg
LTcyNSw3ICs2ODAsNyBAQCBzdGF0aWMgc3NpemVfdCBxdWFkOF9jb3VudF9jZWlsaW5nX3dyaXRl
KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKIAljYXNlIDM6CiAJCW11dGV4X3VubG9j
aygmcHJpdi0+bG9jayk7CiAJCXF1YWQ4X3ByZXNldF9yZWdpc3Rlcl9zZXQocHJpdiwgY291bnQt
PmlkLCBjZWlsaW5nKTsKLQkJcmV0dXJuIGxlbjsKKwkJcmV0dXJuIDA7CiAJfQogCiAJbXV0ZXhf
dW5sb2NrKCZwcml2LT5sb2NrKTsKQEAgLTczMywyNyArNjg4LDI1IEBAIHN0YXRpYyBzc2l6ZV90
IHF1YWQ4X2NvdW50X2NlaWxpbmdfd3JpdGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVy
LAogCXJldHVybiAtRUlOVkFMOwogfQogCi1zdGF0aWMgc3NpemVfdCBxdWFkOF9jb3VudF9wcmVz
ZXRfZW5hYmxlX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCXN0cnVjdCBj
b3VudGVyX2NvdW50ICpjb3VudCwgdm9pZCAqcHJpdmF0ZSwgY2hhciAqYnVmKQorc3RhdGljIGlu
dCBxdWFkOF9jb3VudF9wcmVzZXRfZW5hYmxlX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpj
b3VudGVyLAorCQkJCQkgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKKwkJCQkJICB1OCAq
cHJlc2V0X2VuYWJsZSkKIHsKIAljb25zdCBzdHJ1Y3QgcXVhZDggKmNvbnN0IHByaXYgPSBjb3Vu
dGVyLT5wcml2OwogCi0JcmV0dXJuIHNwcmludGYoYnVmLCAiJXVcbiIsICFwcml2LT5wcmVzZXRf
ZW5hYmxlW2NvdW50LT5pZF0pOworCSpwcmVzZXRfZW5hYmxlID0gIXByaXYtPnByZXNldF9lbmFi
bGVbY291bnQtPmlkXTsKKworCXJldHVybiAwOwogfQogCi1zdGF0aWMgc3NpemVfdCBxdWFkOF9j
b3VudF9wcmVzZXRfZW5hYmxlX3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwK
LQlzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHZvaWQgKnByaXZhdGUsIGNvbnN0IGNoYXIg
KmJ1Ziwgc2l6ZV90IGxlbikKK3N0YXRpYyBpbnQgcXVhZDhfY291bnRfcHJlc2V0X2VuYWJsZV93
cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJCSAgIHN0cnVjdCBjb3Vu
dGVyX2NvdW50ICpjb3VudCwKKwkJCQkJICAgdTggcHJlc2V0X2VuYWJsZSkKIHsKIAlzdHJ1Y3Qg
cXVhZDggKmNvbnN0IHByaXYgPSBjb3VudGVyLT5wcml2OwogCWNvbnN0IGludCBiYXNlX29mZnNl
dCA9IHByaXYtPmJhc2UgKyAyICogY291bnQtPmlkICsgMTsKLQlib29sIHByZXNldF9lbmFibGU7
Ci0JaW50IHJldDsKIAl1bnNpZ25lZCBpbnQgaW9yX2NmZzsKIAotCXJldCA9IGtzdHJ0b2Jvb2wo
YnVmLCAmcHJlc2V0X2VuYWJsZSk7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKLQogCS8qIFBy
ZXNldCBlbmFibGUgaXMgYWN0aXZlIGxvdyBpbiBJbnB1dC9PdXRwdXQgQ29udHJvbCByZWdpc3Rl
ciAqLwogCXByZXNldF9lbmFibGUgPSAhcHJlc2V0X2VuYWJsZTsKIApAQCAtNzYxLDI1ICs3MTQs
MjQgQEAgc3RhdGljIHNzaXplX3QgcXVhZDhfY291bnRfcHJlc2V0X2VuYWJsZV93cml0ZShzdHJ1
Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAKIAlwcml2LT5wcmVzZXRfZW5hYmxlW2NvdW50
LT5pZF0gPSBwcmVzZXRfZW5hYmxlOwogCi0JaW9yX2NmZyA9IHByaXYtPmFiX2VuYWJsZVtjb3Vu
dC0+aWRdIHwgKHVuc2lnbmVkIGludClwcmVzZXRfZW5hYmxlIDw8IDE7CisJaW9yX2NmZyA9IHBy
aXYtPmFiX2VuYWJsZVtjb3VudC0+aWRdIHwgcHJlc2V0X2VuYWJsZSA8PCAxOwogCiAJLyogTG9h
ZCBJL08gY29udHJvbCBjb25maWd1cmF0aW9uIHRvIElucHV0IC8gT3V0cHV0IENvbnRyb2wgUmVn
aXN0ZXIgKi8KIAlvdXRiKFFVQUQ4X0NUUl9JT1IgfCBpb3JfY2ZnLCBiYXNlX29mZnNldCk7CiAK
IAltdXRleF91bmxvY2soJnByaXYtPmxvY2spOwogCi0JcmV0dXJuIGxlbjsKKwlyZXR1cm4gMDsK
IH0KIAotc3RhdGljIHNzaXplX3QgcXVhZDhfc2lnbmFsX2NhYmxlX2ZhdWx0X3JlYWQoc3RydWN0
IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCQkgICAgIHN0cnVjdCBjb3VudGVyX3NpZ25h
bCAqc2lnbmFsLAotCQkJCQkgICAgIHZvaWQgKnByaXZhdGUsIGNoYXIgKmJ1ZikKK3N0YXRpYyBp
bnQgcXVhZDhfc2lnbmFsX2NhYmxlX2ZhdWx0X3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpj
b3VudGVyLAorCQkJCQkgc3RydWN0IGNvdW50ZXJfc2lnbmFsICpzaWduYWwsCisJCQkJCSB1OCAq
Y2FibGVfZmF1bHQpCiB7CiAJc3RydWN0IHF1YWQ4ICpjb25zdCBwcml2ID0gY291bnRlci0+cHJp
djsKIAljb25zdCBzaXplX3QgY2hhbm5lbF9pZCA9IHNpZ25hbC0+aWQgLyAyOwogCWJvb2wgZGlz
YWJsZWQ7CiAJdW5zaWduZWQgaW50IHN0YXR1czsKLQl1bnNpZ25lZCBpbnQgZmF1bHQ7CiAKIAlt
dXRleF9sb2NrKCZwcml2LT5sb2NrKTsKIApAQCAtNzk2LDM2ICs3NDgsMzEgQEAgc3RhdGljIHNz
aXplX3QgcXVhZDhfc2lnbmFsX2NhYmxlX2ZhdWx0X3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNl
ICpjb3VudGVyLAogCW11dGV4X3VubG9jaygmcHJpdi0+bG9jayk7CiAKIAkvKiBNYXNrIHJlc3Bl
Y3RpdmUgY2hhbm5lbCBhbmQgaW52ZXJ0IGxvZ2ljICovCi0JZmF1bHQgPSAhKHN0YXR1cyAmIEJJ
VChjaGFubmVsX2lkKSk7CisJKmNhYmxlX2ZhdWx0ID0gIShzdGF0dXMgJiBCSVQoY2hhbm5lbF9p
ZCkpOwogCi0JcmV0dXJuIHNwcmludGYoYnVmLCAiJXVcbiIsIGZhdWx0KTsKKwlyZXR1cm4gMDsK
IH0KIAotc3RhdGljIHNzaXplX3QgcXVhZDhfc2lnbmFsX2NhYmxlX2ZhdWx0X2VuYWJsZV9yZWFk
KAotCXN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwgc3RydWN0IGNvdW50ZXJfc2lnbmFs
ICpzaWduYWwsCi0Jdm9pZCAqcHJpdmF0ZSwgY2hhciAqYnVmKQorc3RhdGljIGludCBxdWFkOF9z
aWduYWxfY2FibGVfZmF1bHRfZW5hYmxlX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3Vu
dGVyLAorCQkJCQkJc3RydWN0IGNvdW50ZXJfc2lnbmFsICpzaWduYWwsCisJCQkJCQl1OCAqZW5h
YmxlKQogewogCWNvbnN0IHN0cnVjdCBxdWFkOCAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7
CiAJY29uc3Qgc2l6ZV90IGNoYW5uZWxfaWQgPSBzaWduYWwtPmlkIC8gMjsKLQljb25zdCB1bnNp
Z25lZCBpbnQgZW5iID0gISEocHJpdi0+Y2FibGVfZmF1bHRfZW5hYmxlICYgQklUKGNoYW5uZWxf
aWQpKTsKIAotCXJldHVybiBzcHJpbnRmKGJ1ZiwgIiV1XG4iLCBlbmIpOworCSplbmFibGUgPSAh
IShwcml2LT5jYWJsZV9mYXVsdF9lbmFibGUgJiBCSVQoY2hhbm5lbF9pZCkpOworCisJcmV0dXJu
IDA7CiB9CiAKLXN0YXRpYyBzc2l6ZV90IHF1YWQ4X3NpZ25hbF9jYWJsZV9mYXVsdF9lbmFibGVf
d3JpdGUoCi0Jc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLCBzdHJ1Y3QgY291bnRlcl9z
aWduYWwgKnNpZ25hbCwKLQl2b2lkICpwcml2YXRlLCBjb25zdCBjaGFyICpidWYsIHNpemVfdCBs
ZW4pCitzdGF0aWMgaW50IHF1YWQ4X3NpZ25hbF9jYWJsZV9mYXVsdF9lbmFibGVfd3JpdGUoc3Ry
dWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCQkJIHN0cnVjdCBjb3VudGVyX3NpZ25h
bCAqc2lnbmFsLAorCQkJCQkJIHU4IGVuYWJsZSkKIHsKIAlzdHJ1Y3QgcXVhZDggKmNvbnN0IHBy
aXYgPSBjb3VudGVyLT5wcml2OwogCWNvbnN0IHNpemVfdCBjaGFubmVsX2lkID0gc2lnbmFsLT5p
ZCAvIDI7Ci0JYm9vbCBlbmFibGU7Ci0JaW50IHJldDsKIAl1bnNpZ25lZCBpbnQgY2FibGVfZmF1
bHRfZW5hYmxlOwogCi0JcmV0ID0ga3N0cnRvYm9vbChidWYsICZlbmFibGUpOwotCWlmIChyZXQp
Ci0JCXJldHVybiByZXQ7Ci0KIAltdXRleF9sb2NrKCZwcml2LT5sb2NrKTsKIAogCWlmIChlbmFi
bGUpCkBAIC04NDAsMzEgKzc4NywyNyBAQCBzdGF0aWMgc3NpemVfdCBxdWFkOF9zaWduYWxfY2Fi
bGVfZmF1bHRfZW5hYmxlX3dyaXRlKAogCiAJbXV0ZXhfdW5sb2NrKCZwcml2LT5sb2NrKTsKIAot
CXJldHVybiBsZW47CisJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBzc2l6ZV90IHF1YWQ4X3NpZ25h
bF9mY2tfcHJlc2NhbGVyX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCXN0
cnVjdCBjb3VudGVyX3NpZ25hbCAqc2lnbmFsLCB2b2lkICpwcml2YXRlLCBjaGFyICpidWYpCitz
dGF0aWMgaW50IHF1YWQ4X3NpZ25hbF9mY2tfcHJlc2NhbGVyX3JlYWQoc3RydWN0IGNvdW50ZXJf
ZGV2aWNlICpjb3VudGVyLAorCQkJCQkgICBzdHJ1Y3QgY291bnRlcl9zaWduYWwgKnNpZ25hbCwK
KwkJCQkJICAgdTggKnByZXNjYWxlcikKIHsKIAljb25zdCBzdHJ1Y3QgcXVhZDggKmNvbnN0IHBy
aXYgPSBjb3VudGVyLT5wcml2OwotCWNvbnN0IHNpemVfdCBjaGFubmVsX2lkID0gc2lnbmFsLT5p
ZCAvIDI7CiAKLQlyZXR1cm4gc3ByaW50ZihidWYsICIldVxuIiwgcHJpdi0+ZmNrX3ByZXNjYWxl
cltjaGFubmVsX2lkXSk7CisJKnByZXNjYWxlciA9IHByaXYtPmZja19wcmVzY2FsZXJbc2lnbmFs
LT5pZCAvIDJdOworCisJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBzc2l6ZV90IHF1YWQ4X3NpZ25h
bF9mY2tfcHJlc2NhbGVyX3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQlz
dHJ1Y3QgY291bnRlcl9zaWduYWwgKnNpZ25hbCwgdm9pZCAqcHJpdmF0ZSwgY29uc3QgY2hhciAq
YnVmLAotCXNpemVfdCBsZW4pCitzdGF0aWMgaW50IHF1YWQ4X3NpZ25hbF9mY2tfcHJlc2NhbGVy
X3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkJICAgIHN0cnVjdCBj
b3VudGVyX3NpZ25hbCAqc2lnbmFsLAorCQkJCQkgICAgdTggcHJlc2NhbGVyKQogewogCXN0cnVj
dCBxdWFkOCAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7CiAJY29uc3Qgc2l6ZV90IGNoYW5u
ZWxfaWQgPSBzaWduYWwtPmlkIC8gMjsKIAljb25zdCBpbnQgYmFzZV9vZmZzZXQgPSBwcml2LT5i
YXNlICsgMiAqIGNoYW5uZWxfaWQ7Ci0JdTggcHJlc2NhbGVyOwotCWludCByZXQ7Ci0KLQlyZXQg
PSBrc3RydG91OChidWYsIDAsICZwcmVzY2FsZXIpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7
CiAKIAltdXRleF9sb2NrKCZwcml2LT5sb2NrKTsKIApAQCAtODgwLDMxICs4MjMsMzAgQEAgc3Rh
dGljIHNzaXplX3QgcXVhZDhfc2lnbmFsX2Zja19wcmVzY2FsZXJfd3JpdGUoc3RydWN0IGNvdW50
ZXJfZGV2aWNlICpjb3VudGVyLAogCiAJbXV0ZXhfdW5sb2NrKCZwcml2LT5sb2NrKTsKIAotCXJl
dHVybiBsZW47CisJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBjb25zdCBzdHJ1Y3QgY291bnRlcl9z
aWduYWxfZXh0IHF1YWQ4X3NpZ25hbF9leHRbXSA9IHsKLQl7Ci0JCS5uYW1lID0gImNhYmxlX2Zh
dWx0IiwKLQkJLnJlYWQgPSBxdWFkOF9zaWduYWxfY2FibGVfZmF1bHRfcmVhZAotCX0sCi0Jewot
CQkubmFtZSA9ICJjYWJsZV9mYXVsdF9lbmFibGUiLAotCQkucmVhZCA9IHF1YWQ4X3NpZ25hbF9j
YWJsZV9mYXVsdF9lbmFibGVfcmVhZCwKLQkJLndyaXRlID0gcXVhZDhfc2lnbmFsX2NhYmxlX2Zh
dWx0X2VuYWJsZV93cml0ZQotCX0sCi0JewotCQkubmFtZSA9ICJmaWx0ZXJfY2xvY2tfcHJlc2Nh
bGVyIiwKLQkJLnJlYWQgPSBxdWFkOF9zaWduYWxfZmNrX3ByZXNjYWxlcl9yZWFkLAotCQkud3Jp
dGUgPSBxdWFkOF9zaWduYWxfZmNrX3ByZXNjYWxlcl93cml0ZQotCX0KK3N0YXRpYyBzdHJ1Y3Qg
Y291bnRlcl9jb21wIHF1YWQ4X3NpZ25hbF9leHRbXSA9IHsKKwlDT1VOVEVSX0NPTVBfU0lHTkFM
X0JPT0woImNhYmxlX2ZhdWx0IiwgcXVhZDhfc2lnbmFsX2NhYmxlX2ZhdWx0X3JlYWQsCisJCQkJ
IE5VTEwpLAorCUNPVU5URVJfQ09NUF9TSUdOQUxfQk9PTCgiY2FibGVfZmF1bHRfZW5hYmxlIiwK
KwkJCQkgcXVhZDhfc2lnbmFsX2NhYmxlX2ZhdWx0X2VuYWJsZV9yZWFkLAorCQkJCSBxdWFkOF9z
aWduYWxfY2FibGVfZmF1bHRfZW5hYmxlX3dyaXRlKSwKKwlDT1VOVEVSX0NPTVBfU0lHTkFMX1U4
KCJmaWx0ZXJfY2xvY2tfcHJlc2NhbGVyIiwKKwkJCSAgICAgICBxdWFkOF9zaWduYWxfZmNrX3By
ZXNjYWxlcl9yZWFkLAorCQkJICAgICAgIHF1YWQ4X3NpZ25hbF9mY2tfcHJlc2NhbGVyX3dyaXRl
KQogfTsKIAotc3RhdGljIGNvbnN0IHN0cnVjdCBjb3VudGVyX3NpZ25hbF9leHQgcXVhZDhfaW5k
ZXhfZXh0W10gPSB7Ci0JQ09VTlRFUl9TSUdOQUxfRU5VTSgiaW5kZXhfcG9sYXJpdHkiLCAmcXVh
ZDhfaW5kZXhfcG9sX2VudW0pLAotCUNPVU5URVJfU0lHTkFMX0VOVU1fQVZBSUxBQkxFKCJpbmRl
eF9wb2xhcml0eSIsCSZxdWFkOF9pbmRleF9wb2xfZW51bSksCi0JQ09VTlRFUl9TSUdOQUxfRU5V
TSgic3luY2hyb25vdXNfbW9kZSIsICZxdWFkOF9zeW5fbW9kZV9lbnVtKSwKLQlDT1VOVEVSX1NJ
R05BTF9FTlVNX0FWQUlMQUJMRSgic3luY2hyb25vdXNfbW9kZSIsICZxdWFkOF9zeW5fbW9kZV9l
bnVtKQorc3RhdGljIERFRklORV9DT1VOVEVSX0VOVU0ocXVhZDhfaW5kZXhfcG9sX2VudW0sIHF1
YWQ4X2luZGV4X3BvbGFyaXR5X21vZGVzKTsKK3N0YXRpYyBERUZJTkVfQ09VTlRFUl9FTlVNKHF1
YWQ4X3N5bmNoX21vZGVfZW51bSwgcXVhZDhfc3luY2hyb25vdXNfbW9kZXMpOworCitzdGF0aWMg
c3RydWN0IGNvdW50ZXJfY29tcCBxdWFkOF9pbmRleF9leHRbXSA9IHsKKwlDT1VOVEVSX0NPTVBf
U0lHTkFMX0VOVU0oImluZGV4X3BvbGFyaXR5IiwgcXVhZDhfaW5kZXhfcG9sYXJpdHlfZ2V0LAor
CQkJCSBxdWFkOF9pbmRleF9wb2xhcml0eV9zZXQsCisJCQkJIHF1YWQ4X2luZGV4X3BvbF9lbnVt
KSwKKwlDT1VOVEVSX0NPTVBfU0lHTkFMX0VOVU0oInN5bmNocm9ub3VzX21vZGUiLCBxdWFkOF9z
eW5jaHJvbm91c19tb2RlX2dldCwKKwkJCQkgcXVhZDhfc3luY2hyb25vdXNfbW9kZV9zZXQsCisJ
CQkJIHF1YWQ4X3N5bmNoX21vZGVfZW51bSksCiB9OwogCiAjZGVmaW5lIFFVQUQ4X1FVQURfU0lH
TkFMKF9pZCwgX25hbWUpIHsJCVwKQEAgLTk3MywzOSArOTE1LDMwIEBAIHN0YXRpYyBzdHJ1Y3Qg
Y291bnRlcl9zeW5hcHNlIHF1YWQ4X2NvdW50X3N5bmFwc2VzW11bM10gPSB7CiAJUVVBRDhfQ09V
TlRfU1lOQVBTRVMoNiksIFFVQUQ4X0NPVU5UX1NZTkFQU0VTKDcpCiB9OwogCi1zdGF0aWMgY29u
c3Qgc3RydWN0IGNvdW50ZXJfY291bnRfZXh0IHF1YWQ4X2NvdW50X2V4dFtdID0gewotCXsKLQkJ
Lm5hbWUgPSAiY2VpbGluZyIsCi0JCS5yZWFkID0gcXVhZDhfY291bnRfY2VpbGluZ19yZWFkLAot
CQkud3JpdGUgPSBxdWFkOF9jb3VudF9jZWlsaW5nX3dyaXRlCi0JfSwKLQl7Ci0JCS5uYW1lID0g
ImZsb29yIiwKLQkJLnJlYWQgPSBxdWFkOF9jb3VudF9mbG9vcl9yZWFkCi0JfSwKLQlDT1VOVEVS
X0NPVU5UX0VOVU0oImNvdW50X21vZGUiLCAmcXVhZDhfY250X21vZGVfZW51bSksCi0JQ09VTlRF
Ul9DT1VOVF9FTlVNX0FWQUlMQUJMRSgiY291bnRfbW9kZSIsICZxdWFkOF9jbnRfbW9kZV9lbnVt
KSwKLQl7Ci0JCS5uYW1lID0gImRpcmVjdGlvbiIsCi0JCS5yZWFkID0gcXVhZDhfY291bnRfZGly
ZWN0aW9uX3JlYWQKLQl9LAotCXsKLQkJLm5hbWUgPSAiZW5hYmxlIiwKLQkJLnJlYWQgPSBxdWFk
OF9jb3VudF9lbmFibGVfcmVhZCwKLQkJLndyaXRlID0gcXVhZDhfY291bnRfZW5hYmxlX3dyaXRl
Ci0JfSwKLQlDT1VOVEVSX0NPVU5UX0VOVU0oImVycm9yX25vaXNlIiwgJnF1YWQ4X2Vycm9yX25v
aXNlX2VudW0pLAotCUNPVU5URVJfQ09VTlRfRU5VTV9BVkFJTEFCTEUoImVycm9yX25vaXNlIiwg
JnF1YWQ4X2Vycm9yX25vaXNlX2VudW0pLAotCXsKLQkJLm5hbWUgPSAicHJlc2V0IiwKLQkJLnJl
YWQgPSBxdWFkOF9jb3VudF9wcmVzZXRfcmVhZCwKLQkJLndyaXRlID0gcXVhZDhfY291bnRfcHJl
c2V0X3dyaXRlCi0JfSwKLQl7Ci0JCS5uYW1lID0gInByZXNldF9lbmFibGUiLAotCQkucmVhZCA9
IHF1YWQ4X2NvdW50X3ByZXNldF9lbmFibGVfcmVhZCwKLQkJLndyaXRlID0gcXVhZDhfY291bnRf
cHJlc2V0X2VuYWJsZV93cml0ZQotCX0KK3N0YXRpYyBjb25zdCBlbnVtIGNvdW50ZXJfY291bnRf
bW9kZSBxdWFkOF9jbnRfbW9kZXNbXSA9IHsKKwlDT1VOVEVSX0NPVU5UX01PREVfTk9STUFMLAor
CUNPVU5URVJfQ09VTlRfTU9ERV9SQU5HRV9MSU1JVCwKKwlDT1VOVEVSX0NPVU5UX01PREVfTk9O
X1JFQ1lDTEUsCisJQ09VTlRFUl9DT1VOVF9NT0RFX01PRFVMT19OLAorfTsKKworc3RhdGljIERF
RklORV9DT1VOVEVSX0FWQUlMQUJMRShxdWFkOF9jb3VudF9tb2RlX2F2YWlsYWJsZSwgcXVhZDhf
Y250X21vZGVzKTsKKworc3RhdGljIERFRklORV9DT1VOVEVSX0VOVU0ocXVhZDhfZXJyb3Jfbm9p
c2VfZW51bSwgcXVhZDhfbm9pc2VfZXJyb3Jfc3RhdGVzKTsKKworc3RhdGljIHN0cnVjdCBjb3Vu
dGVyX2NvbXAgcXVhZDhfY291bnRfZXh0W10gPSB7CisJQ09VTlRFUl9DT01QX0NFSUxJTkcocXVh
ZDhfY291bnRfY2VpbGluZ19yZWFkLAorCQkJICAgICBxdWFkOF9jb3VudF9jZWlsaW5nX3dyaXRl
KSwKKwlDT1VOVEVSX0NPTVBfRkxPT1IocXVhZDhfY291bnRfZmxvb3JfcmVhZCwgTlVMTCksCisJ
Q09VTlRFUl9DT01QX0NPVU5UX01PREUocXVhZDhfY291bnRfbW9kZV9yZWFkLCBxdWFkOF9jb3Vu
dF9tb2RlX3dyaXRlLAorCQkJCXF1YWQ4X2NvdW50X21vZGVfYXZhaWxhYmxlKSwKKwlDT1VOVEVS
X0NPTVBfRElSRUNUSU9OKHF1YWQ4X2RpcmVjdGlvbl9yZWFkKSwKKwlDT1VOVEVSX0NPTVBfRU5B
QkxFKHF1YWQ4X2NvdW50X2VuYWJsZV9yZWFkLCBxdWFkOF9jb3VudF9lbmFibGVfd3JpdGUpLAor
CUNPVU5URVJfQ09NUF9DT1VOVF9FTlVNKCJlcnJvcl9ub2lzZSIsIHF1YWQ4X2Vycm9yX25vaXNl
X2dldCwgTlVMTCwKKwkJCQlxdWFkOF9lcnJvcl9ub2lzZV9lbnVtKSwKKwlDT1VOVEVSX0NPTVBf
UFJFU0VUKHF1YWQ4X2NvdW50X3ByZXNldF9yZWFkLCBxdWFkOF9jb3VudF9wcmVzZXRfd3JpdGUp
LAorCUNPVU5URVJfQ09NUF9QUkVTRVRfRU5BQkxFKHF1YWQ4X2NvdW50X3ByZXNldF9lbmFibGVf
cmVhZCwKKwkJCQkgICBxdWFkOF9jb3VudF9wcmVzZXRfZW5hYmxlX3dyaXRlKSwKIH07CiAKICNk
ZWZpbmUgUVVBRDhfQ09VTlQoX2lkLCBfY250bmFtZSkgewkJCQkJXApkaWZmIC0tZ2l0IGEvZHJp
dmVycy9jb3VudGVyL01ha2VmaWxlIGIvZHJpdmVycy9jb3VudGVyL01ha2VmaWxlCmluZGV4IDE5
NzQyZTZmNWUzZS4uMWFiN2UwODdmZGMyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2NvdW50ZXIvTWFr
ZWZpbGUKKysrIGIvZHJpdmVycy9jb3VudGVyL01ha2VmaWxlCkBAIC00LDYgKzQsNyBAQAogIwog
CiBvYmotJChDT05GSUdfQ09VTlRFUikgKz0gY291bnRlci5vCitjb3VudGVyLXkgOj0gY291bnRl
ci1jb3JlLm8gY291bnRlci1zeXNmcy5vCiAKIG9iai0kKENPTkZJR18xMDRfUVVBRF84KQkrPSAx
MDQtcXVhZC04Lm8KIG9iai0kKENPTkZJR19JTlRFUlJVUFRfQ05UKQkJKz0gaW50ZXJydXB0LWNu
dC5vCmRpZmYgLS1naXQgYS9kcml2ZXJzL2NvdW50ZXIvY291bnRlci1jb3JlLmMgYi9kcml2ZXJz
L2NvdW50ZXIvY291bnRlci1jb3JlLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAw
MDAwMDAwLi5lN2RkNmVhMDFjOGEKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2NvdW50ZXIv
Y291bnRlci1jb3JlLmMKQEAgLTAsMCArMSwxNTUgQEAKKy8vIFNQRFgtTGljZW5zZS1JZGVudGlm
aWVyOiBHUEwtMi4wCisvKgorICogR2VuZXJpYyBDb3VudGVyIGludGVyZmFjZQorICogQ29weXJp
Z2h0IChDKSAyMDIwIFdpbGxpYW0gQnJlYXRoaXR0IEdyYXkKKyAqLworI2luY2x1ZGUgPGxpbnV4
L2NvdW50ZXIuaD4KKyNpbmNsdWRlIDxsaW51eC9kZXZpY2UuaD4KKyNpbmNsdWRlIDxsaW51eC9l
eHBvcnQuaD4KKyNpbmNsdWRlIDxsaW51eC9nZnAuaD4KKyNpbmNsdWRlIDxsaW51eC9pZHIuaD4K
KyNpbmNsdWRlIDxsaW51eC9pbml0Lmg+CisjaW5jbHVkZSA8bGludXgvbW9kdWxlLmg+CisKKyNp
bmNsdWRlICJjb3VudGVyLXN5c2ZzLmgiCisKKy8qIFByb3ZpZGVzIGEgdW5pcXVlIElEIGZvciBl
YWNoIGNvdW50ZXIgZGV2aWNlICovCitzdGF0aWMgREVGSU5FX0lEQShjb3VudGVyX2lkYSk7CisK
K3N0YXRpYyB2b2lkIGNvdW50ZXJfZGV2aWNlX3JlbGVhc2Uoc3RydWN0IGRldmljZSAqZGV2KQor
eworCXN0cnVjdCBjb3VudGVyX2RldmljZSAqY29uc3QgY291bnRlciA9IGRldl9nZXRfZHJ2ZGF0
YShkZXYpOworCisJY291bnRlcl9jaHJkZXZfcmVtb3ZlKGNvdW50ZXIpOworCWlkYV9mcmVlKCZj
b3VudGVyX2lkYSwgZGV2LT5pZCk7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgZGV2aWNlX3R5cGUgY291
bnRlcl9kZXZpY2VfdHlwZSA9IHsKKwkubmFtZSA9ICJjb3VudGVyX2RldmljZSIsCisJLnJlbGVh
c2UgPSBjb3VudGVyX2RldmljZV9yZWxlYXNlLAorfTsKKworc3RhdGljIHN0cnVjdCBidXNfdHlw
ZSBjb3VudGVyX2J1c190eXBlID0geworCS5uYW1lID0gImNvdW50ZXIiLAorCS5kZXZfbmFtZSA9
ICJjb3VudGVyIiwKK307CisKKy8qKgorICogY291bnRlcl9yZWdpc3RlciAtIHJlZ2lzdGVyIENv
dW50ZXIgdG8gdGhlIHN5c3RlbQorICogQGNvdW50ZXI6CXBvaW50ZXIgdG8gQ291bnRlciB0byBy
ZWdpc3RlcgorICoKKyAqIFRoaXMgZnVuY3Rpb24gcmVnaXN0ZXJzIGEgQ291bnRlciB0byB0aGUg
c3lzdGVtLiBBIHN5c2ZzICJjb3VudGVyIiBkaXJlY3RvcnkKKyAqIHdpbGwgYmUgY3JlYXRlZCBh
bmQgcG9wdWxhdGVkIHdpdGggc3lzZnMgYXR0cmlidXRlcyBjb3JyZWxhdGluZyB3aXRoIHRoZQor
ICogQ291bnRlciBTaWduYWxzLCBTeW5hcHNlcywgYW5kIENvdW50cyByZXNwZWN0aXZlbHkuCisg
Ki8KK2ludCBjb3VudGVyX3JlZ2lzdGVyKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY29uc3QgY291
bnRlcikKK3sKKwlzdHJ1Y3QgZGV2aWNlICpjb25zdCBkZXYgPSAmY291bnRlci0+ZGV2OworCWlu
dCBpZDsKKwlpbnQgZXJyOworCisJLyogQWNxdWlyZSB1bmlxdWUgSUQgKi8KKwlpZCA9IGlkYV9h
bGxvYygmY291bnRlcl9pZGEsIEdGUF9LRVJORUwpOworCWlmIChpZCA8IDApCisJCXJldHVybiBp
ZDsKKworCS8qIENvbmZpZ3VyZSBkZXZpY2Ugc3RydWN0dXJlIGZvciBDb3VudGVyICovCisJZGV2
LT5pZCA9IGlkOworCWRldi0+dHlwZSA9ICZjb3VudGVyX2RldmljZV90eXBlOworCWRldi0+YnVz
ID0gJmNvdW50ZXJfYnVzX3R5cGU7CisJaWYgKGNvdW50ZXItPnBhcmVudCkgeworCQlkZXYtPnBh
cmVudCA9IGNvdW50ZXItPnBhcmVudDsKKwkJZGV2LT5vZl9ub2RlID0gY291bnRlci0+cGFyZW50
LT5vZl9ub2RlOworCX0KKwlkZXZpY2VfaW5pdGlhbGl6ZShkZXYpOworCWRldl9zZXRfZHJ2ZGF0
YShkZXYsIGNvdW50ZXIpOworCisJLyogQWRkIENvdW50ZXIgc3lzZnMgYXR0cmlidXRlcyAqLwor
CWVyciA9IGNvdW50ZXJfc3lzZnNfYWRkKGNvdW50ZXIpOworCWlmIChlcnIgPCAwKQorCQlnb3Rv
IGVycl9mcmVlX2lkOworCisJLyogQWRkIGRldmljZSB0byBzeXN0ZW0gKi8KKwllcnIgPSBkZXZp
Y2VfYWRkKGRldik7CisJaWYgKGVyciA8IDApCisJCWdvdG8gZXJyX2ZyZWVfaWQ7CisKKwlyZXR1
cm4gMDsKKworZXJyX2ZyZWVfaWQ6CisJcHV0X2RldmljZShkZXYpOworCXJldHVybiBlcnI7Cit9
CitFWFBPUlRfU1lNQk9MX0dQTChjb3VudGVyX3JlZ2lzdGVyKTsKKworLyoqCisgKiBjb3VudGVy
X3VucmVnaXN0ZXIgLSB1bnJlZ2lzdGVyIENvdW50ZXIgZnJvbSB0aGUgc3lzdGVtCisgKiBAY291
bnRlcjoJcG9pbnRlciB0byBDb3VudGVyIHRvIHVucmVnaXN0ZXIKKyAqCisgKiBUaGUgQ291bnRl
ciBpcyB1bnJlZ2lzdGVyZWQgZnJvbSB0aGUgc3lzdGVtOyBhbGwgYWxsb2NhdGVkIG1lbW9yeSBp
cyBmcmVlZC4KKyAqLwordm9pZCBjb3VudGVyX3VucmVnaXN0ZXIoc3RydWN0IGNvdW50ZXJfZGV2
aWNlICpjb25zdCBjb3VudGVyKQoreworCWlmICghY291bnRlcikKKwkJcmV0dXJuOworCisJZGV2
aWNlX3VucmVnaXN0ZXIoJmNvdW50ZXItPmRldik7Cit9CitFWFBPUlRfU1lNQk9MX0dQTChjb3Vu
dGVyX3VucmVnaXN0ZXIpOworCitzdGF0aWMgdm9pZCBkZXZtX2NvdW50ZXJfcmVsZWFzZShzdHJ1
Y3QgZGV2aWNlICpkZXYsIHZvaWQgKnJlcykKK3sKKwljb3VudGVyX3VucmVnaXN0ZXIoKihzdHJ1
Y3QgY291bnRlcl9kZXZpY2UgKiopcmVzKTsKK30KKworLyoqCisgKiBkZXZtX2NvdW50ZXJfcmVn
aXN0ZXIgLSBSZXNvdXJjZS1tYW5hZ2VkIGNvdW50ZXJfcmVnaXN0ZXIKKyAqIEBkZXY6CWRldmlj
ZSB0byBhbGxvY2F0ZSBjb3VudGVyX2RldmljZSBmb3IKKyAqIEBjb3VudGVyOglwb2ludGVyIHRv
IENvdW50ZXIgdG8gcmVnaXN0ZXIKKyAqCisgKiBNYW5hZ2VkIGNvdW50ZXJfcmVnaXN0ZXIuIFRo
ZSBDb3VudGVyIHJlZ2lzdGVyZWQgd2l0aCB0aGlzIGZ1bmN0aW9uIGlzCisgKiBhdXRvbWF0aWNh
bGx5IHVucmVnaXN0ZXJlZCBvbiBkcml2ZXIgZGV0YWNoLiBUaGlzIGZ1bmN0aW9uIGNhbGxzCisg
KiBjb3VudGVyX3JlZ2lzdGVyIGludGVybmFsbHkuIFJlZmVyIHRvIHRoYXQgZnVuY3Rpb24gZm9y
IG1vcmUgaW5mb3JtYXRpb24uCisgKgorICogUkVUVVJOUzoKKyAqIDAgb24gc3VjY2VzcywgbmVn
YXRpdmUgZXJyb3IgbnVtYmVyIG9uIGZhaWx1cmUuCisgKi8KK2ludCBkZXZtX2NvdW50ZXJfcmVn
aXN0ZXIoc3RydWN0IGRldmljZSAqZGV2LAorCQkJICBzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNv
bnN0IGNvdW50ZXIpCit7CisJc3RydWN0IGNvdW50ZXJfZGV2aWNlICoqcHRyOworCWludCBlcnI7
CisKKwlwdHIgPSBkZXZyZXNfYWxsb2MoZGV2bV9jb3VudGVyX3JlbGVhc2UsIHNpemVvZigqcHRy
KSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFwdHIpCisJCXJldHVybiAtRU5PTUVNOworCisJZXJyID0g
Y291bnRlcl9yZWdpc3Rlcihjb3VudGVyKTsKKwlpZiAoZXJyIDwgMCkgeworCQlkZXZyZXNfZnJl
ZShwdHIpOworCQlyZXR1cm4gZXJyOworCX0KKworCSpwdHIgPSBjb3VudGVyOworCWRldnJlc19h
ZGQoZGV2LCBwdHIpOworCisJcmV0dXJuIDA7Cit9CitFWFBPUlRfU1lNQk9MX0dQTChkZXZtX2Nv
dW50ZXJfcmVnaXN0ZXIpOworCitzdGF0aWMgaW50IF9faW5pdCBjb3VudGVyX2luaXQodm9pZCkK
K3sKKwlyZXR1cm4gYnVzX3JlZ2lzdGVyKCZjb3VudGVyX2J1c190eXBlKTsKK30KKworc3RhdGlj
IHZvaWQgX19leGl0IGNvdW50ZXJfZXhpdCh2b2lkKQoreworCWJ1c191bnJlZ2lzdGVyKCZjb3Vu
dGVyX2J1c190eXBlKTsKK30KKworc3Vic3lzX2luaXRjYWxsKGNvdW50ZXJfaW5pdCk7Cittb2R1
bGVfZXhpdChjb3VudGVyX2V4aXQpOworCitNT0RVTEVfQVVUSE9SKCJXaWxsaWFtIEJyZWF0aGl0
dCBHcmF5IDx2aWxoZWxtLmdyYXlAZ21haWwuY29tPiIpOworTU9EVUxFX0RFU0NSSVBUSU9OKCJH
ZW5lcmljIENvdW50ZXIgaW50ZXJmYWNlIik7CitNT0RVTEVfTElDRU5TRSgiR1BMIHYyIik7CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2NvdW50ZXIvY291bnRlci1zeXNmcy5jIGIvZHJpdmVycy9jb3Vu
dGVyL2NvdW50ZXItc3lzZnMuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAw
MDAuLjA3NTg4MTMwNjAwYQotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvY291bnRlci9jb3Vu
dGVyLXN5c2ZzLmMKQEAgLTAsMCArMSw4NDYgQEAKKy8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVy
OiBHUEwtMi4wCisvKgorICogR2VuZXJpYyBDb3VudGVyIHN5c2ZzIGludGVyZmFjZQorICogQ29w
eXJpZ2h0IChDKSAyMDIwIFdpbGxpYW0gQnJlYXRoaXR0IEdyYXkKKyAqLworI2luY2x1ZGUgPGxp
bnV4L2NvdW50ZXIuaD4KKyNpbmNsdWRlIDxsaW51eC9kZXZpY2UuaD4KKyNpbmNsdWRlIDxsaW51
eC9lcnIuaD4KKyNpbmNsdWRlIDxsaW51eC9nZnAuaD4KKyNpbmNsdWRlIDxsaW51eC9rZXJuZWwu
aD4KKyNpbmNsdWRlIDxsaW51eC9saXN0Lmg+CisjaW5jbHVkZSA8bGludXgvc3RyaW5nLmg+Cisj
aW5jbHVkZSA8bGludXgvc3lzZnMuaD4KKyNpbmNsdWRlIDxsaW51eC90eXBlcy5oPgorCisjaW5j
bHVkZSAiY291bnRlci1zeXNmcy5oIgorCisvKioKKyAqIHN0cnVjdCBjb3VudGVyX2F0dHJpYnV0
ZSAtIENvdW50ZXIgc3lzZnMgYXR0cmlidXRlCisgKiBAZGV2X2F0dHI6CWRldmljZSBhdHRyaWJ1
dGUgZm9yIHN5c2ZzCisgKiBAbDoJCW5vZGUgdG8gYWRkIENvdW50ZXIgYXR0cmlidXRlIHRvIGF0
dHJpYnV0ZSBncm91cCBsaXN0CisgKiBAY29tcDoJQ291bnRlciBjb21wb25lbnQgY2FsbGJhY2tz
IGFuZCBkYXRhCisgKiBAc2NvcGU6CUNvdW50ZXIgc2NvcGUgb2YgdGhlIGF0dHJpYnV0ZQorICog
QHBhcmVudDoJcG9pbnRlciB0byB0aGUgcGFyZW50IGNvbXBvbmVudAorICovCitzdHJ1Y3QgY291
bnRlcl9hdHRyaWJ1dGUgeworCXN0cnVjdCBkZXZpY2VfYXR0cmlidXRlIGRldl9hdHRyOworCXN0
cnVjdCBsaXN0X2hlYWQgbDsKKworCXN0cnVjdCBjb3VudGVyX2NvbXAgY29tcDsKKwllbnVtIGNv
dW50ZXJfc2NvcGUgc2NvcGU7CisJdm9pZCAqcGFyZW50OworfTsKKworI2RlZmluZSB0b19jb3Vu
dGVyX2F0dHJpYnV0ZShfZGV2X2F0dHIpIFwKKwljb250YWluZXJfb2YoX2Rldl9hdHRyLCBzdHJ1
Y3QgY291bnRlcl9hdHRyaWJ1dGUsIGRldl9hdHRyKQorCisvKioKKyAqIHN0cnVjdCBjb3VudGVy
X2F0dHJpYnV0ZV9ncm91cCAtIGNvbnRhaW5lciBmb3IgYXR0cmlidXRlIGdyb3VwCisgKiBAbmFt
ZToJbmFtZSBvZiB0aGUgYXR0cmlidXRlIGdyb3VwCisgKiBAYXR0cl9saXN0OglsaXN0IHRvIGtl
ZXAgdHJhY2sgb2YgY3JlYXRlZCBhdHRyaWJ1dGVzCisgKiBAbnVtX2F0dHI6CW51bWJlciBvZiBh
dHRyaWJ1dGVzCisgKi8KK3N0cnVjdCBjb3VudGVyX2F0dHJpYnV0ZV9ncm91cCB7CisJY29uc3Qg
Y2hhciAqbmFtZTsKKwlzdHJ1Y3QgbGlzdF9oZWFkIGF0dHJfbGlzdDsKKwlzaXplX3QgbnVtX2F0
dHI7Cit9OworCitzdGF0aWMgY29uc3QgY2hhciAqY29uc3QgY291bnRlcl9mdW5jdGlvbl9zdHJb
XSA9IHsKKwlbQ09VTlRFUl9GVU5DVElPTl9JTkNSRUFTRV0gPSAiaW5jcmVhc2UiLAorCVtDT1VO
VEVSX0ZVTkNUSU9OX0RFQ1JFQVNFXSA9ICJkZWNyZWFzZSIsCisJW0NPVU5URVJfRlVOQ1RJT05f
UFVMU0VfRElSRUNUSU9OXSA9ICJwdWxzZS1kaXJlY3Rpb24iLAorCVtDT1VOVEVSX0ZVTkNUSU9O
X1FVQURSQVRVUkVfWDFfQV0gPSAicXVhZHJhdHVyZSB4MSBhIiwKKwlbQ09VTlRFUl9GVU5DVElP
Tl9RVUFEUkFUVVJFX1gxX0JdID0gInF1YWRyYXR1cmUgeDEgYiIsCisJW0NPVU5URVJfRlVOQ1RJ
T05fUVVBRFJBVFVSRV9YMl9BXSA9ICJxdWFkcmF0dXJlIHgyIGEiLAorCVtDT1VOVEVSX0ZVTkNU
SU9OX1FVQURSQVRVUkVfWDJfQl0gPSAicXVhZHJhdHVyZSB4MiBiIiwKKwlbQ09VTlRFUl9GVU5D
VElPTl9RVUFEUkFUVVJFX1g0XSA9ICJxdWFkcmF0dXJlIHg0IgorfTsKKworc3RhdGljIGNvbnN0
IGNoYXIgKmNvbnN0IGNvdW50ZXJfc2lnbmFsX3ZhbHVlX3N0cltdID0geworCVtDT1VOVEVSX1NJ
R05BTF9MRVZFTF9MT1ddID0gImxvdyIsCisJW0NPVU5URVJfU0lHTkFMX0xFVkVMX0hJR0hdID0g
ImhpZ2giCit9OworCitzdGF0aWMgY29uc3QgY2hhciAqY29uc3QgY291bnRlcl9zeW5hcHNlX2Fj
dGlvbl9zdHJbXSA9IHsKKwlbQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9OT05FXSA9ICJub25lIiwK
KwlbQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9SSVNJTkdfRURHRV0gPSAicmlzaW5nIGVkZ2UiLAor
CVtDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX0ZBTExJTkdfRURHRV0gPSAiZmFsbGluZyBlZGdlIiwK
KwlbQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9CT1RIX0VER0VTXSA9ICJib3RoIGVkZ2VzIgorfTsK
Kworc3RhdGljIGNvbnN0IGNoYXIgKmNvbnN0IGNvdW50ZXJfY291bnRfZGlyZWN0aW9uX3N0cltd
ID0geworCVtDT1VOVEVSX0NPVU5UX0RJUkVDVElPTl9GT1JXQVJEXSA9ICJmb3J3YXJkIiwKKwlb
Q09VTlRFUl9DT1VOVF9ESVJFQ1RJT05fQkFDS1dBUkRdID0gImJhY2t3YXJkIgorfTsKKworc3Rh
dGljIGNvbnN0IGNoYXIgKmNvbnN0IGNvdW50ZXJfY291bnRfbW9kZV9zdHJbXSA9IHsKKwlbQ09V
TlRFUl9DT1VOVF9NT0RFX05PUk1BTF0gPSAibm9ybWFsIiwKKwlbQ09VTlRFUl9DT1VOVF9NT0RF
X1JBTkdFX0xJTUlUXSA9ICJyYW5nZSBsaW1pdCIsCisJW0NPVU5URVJfQ09VTlRfTU9ERV9OT05f
UkVDWUNMRV0gPSAibm9uLXJlY3ljbGUiLAorCVtDT1VOVEVSX0NPVU5UX01PREVfTU9EVUxPX05d
ID0gIm1vZHVsby1uIgorfTsKKworc3RhdGljIHNzaXplX3QgY291bnRlcl9jb21wX3U4X3Nob3co
c3RydWN0IGRldmljZSAqZGV2LAorCQkJCSAgICBzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSAqYXR0
ciwgY2hhciAqYnVmKQoreworCWNvbnN0IHN0cnVjdCBjb3VudGVyX2F0dHJpYnV0ZSAqY29uc3Qg
YSA9IHRvX2NvdW50ZXJfYXR0cmlidXRlKGF0dHIpOworCXN0cnVjdCBjb3VudGVyX2RldmljZSAq
Y29uc3QgY291bnRlciA9IGRldl9nZXRfZHJ2ZGF0YShkZXYpOworCWludCBlcnI7CisJdTggZGF0
YSA9IDA7CisKKwlzd2l0Y2ggKGEtPnNjb3BlKSB7CisJY2FzZSBDT1VOVEVSX1NDT1BFX0RFVklD
RToKKwkJZXJyID0gYS0+Y29tcC5kZXZpY2VfdThfcmVhZChjb3VudGVyLCAmZGF0YSk7CisJCWJy
ZWFrOworCWNhc2UgQ09VTlRFUl9TQ09QRV9TSUdOQUw6CisJCWVyciA9IGEtPmNvbXAuc2lnbmFs
X3U4X3JlYWQoY291bnRlciwgYS0+cGFyZW50LCAmZGF0YSk7CisJCWJyZWFrOworCWNhc2UgQ09V
TlRFUl9TQ09QRV9DT1VOVDoKKwkJZXJyID0gYS0+Y29tcC5jb3VudF91OF9yZWFkKGNvdW50ZXIs
IGEtPnBhcmVudCwgJmRhdGEpOworCQlicmVhazsKKwlkZWZhdWx0OgorCQlyZXR1cm4gLUVJTlZB
TDsKKwl9CisJaWYgKGVyciA8IDApCisJCXJldHVybiBlcnI7CisKKwlpZiAoYS0+Y29tcC50eXBl
ID09IENPVU5URVJfQ09NUF9CT09MKQorCQlkYXRhID0gISFkYXRhOworCisJcmV0dXJuIHNwcmlu
dGYoYnVmLCAiJXVcbiIsICh1bnNpZ25lZCBpbnQpZGF0YSk7Cit9CisKK3N0YXRpYyBzc2l6ZV90
IGNvdW50ZXJfY29tcF91OF9zdG9yZShzdHJ1Y3QgZGV2aWNlICpkZXYsCisJCQkJICAgICBzdHJ1
Y3QgZGV2aWNlX2F0dHJpYnV0ZSAqYXR0ciwKKwkJCQkgICAgIGNvbnN0IGNoYXIgKmJ1Ziwgc2l6
ZV90IGxlbikKK3sKKwljb25zdCBzdHJ1Y3QgY291bnRlcl9hdHRyaWJ1dGUgKmNvbnN0IGEgPSB0
b19jb3VudGVyX2F0dHJpYnV0ZShhdHRyKTsKKwlzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvbnN0
IGNvdW50ZXIgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsKKwlpbnQgZXJyOworCWJvb2wgYm9vbF9k
YXRhID0gMDsKKwl1OCBkYXRhID0gMDsKKworCWlmIChhLT5jb21wLnR5cGUgPT0gQ09VTlRFUl9D
T01QX0JPT0wpIHsKKwkJZXJyID0ga3N0cnRvYm9vbChidWYsICZib29sX2RhdGEpOworCQlkYXRh
ID0gYm9vbF9kYXRhOworCX0gZWxzZQorCQllcnIgPSBrc3RydG91OChidWYsIDAsICZkYXRhKTsK
KwlpZiAoZXJyIDwgMCkKKwkJcmV0dXJuIGVycjsKKworCXN3aXRjaCAoYS0+c2NvcGUpIHsKKwlj
YXNlIENPVU5URVJfU0NPUEVfREVWSUNFOgorCQllcnIgPSBhLT5jb21wLmRldmljZV91OF93cml0
ZShjb3VudGVyLCBkYXRhKTsKKwkJYnJlYWs7CisJY2FzZSBDT1VOVEVSX1NDT1BFX1NJR05BTDoK
KwkJZXJyID0gYS0+Y29tcC5zaWduYWxfdThfd3JpdGUoY291bnRlciwgYS0+cGFyZW50LCBkYXRh
KTsKKwkJYnJlYWs7CisJY2FzZSBDT1VOVEVSX1NDT1BFX0NPVU5UOgorCQllcnIgPSBhLT5jb21w
LmNvdW50X3U4X3dyaXRlKGNvdW50ZXIsIGEtPnBhcmVudCwgZGF0YSk7CisJCWJyZWFrOworCWRl
ZmF1bHQ6CisJCXJldHVybiAtRUlOVkFMOworCX0KKwlpZiAoZXJyIDwgMCkKKwkJcmV0dXJuIGVy
cjsKKworCXJldHVybiBsZW47Cit9CisKK3N0YXRpYyBzc2l6ZV90IGNvdW50ZXJfY29tcF91MzJf
c2hvdyhzdHJ1Y3QgZGV2aWNlICpkZXYsCisJCQkJICAgICBzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0
ZSAqYXR0ciwgY2hhciAqYnVmKQoreworCWNvbnN0IHN0cnVjdCBjb3VudGVyX2F0dHJpYnV0ZSAq
Y29uc3QgYSA9IHRvX2NvdW50ZXJfYXR0cmlidXRlKGF0dHIpOworCXN0cnVjdCBjb3VudGVyX2Rl
dmljZSAqY29uc3QgY291bnRlciA9IGRldl9nZXRfZHJ2ZGF0YShkZXYpOworCWNvbnN0IHN0cnVj
dCBjb3VudGVyX2F2YWlsYWJsZSAqY29uc3QgYXZhaWwgPSBhLT5jb21wLnByaXY7CisJaW50IGVy
cjsKKwl1MzIgZGF0YSA9IDA7CisKKwlzd2l0Y2ggKGEtPnNjb3BlKSB7CisJY2FzZSBDT1VOVEVS
X1NDT1BFX0RFVklDRToKKwkJZXJyID0gYS0+Y29tcC5kZXZpY2VfdTMyX3JlYWQoY291bnRlciwg
JmRhdGEpOworCQlicmVhazsKKwljYXNlIENPVU5URVJfU0NPUEVfU0lHTkFMOgorCQllcnIgPSBh
LT5jb21wLnNpZ25hbF91MzJfcmVhZChjb3VudGVyLCBhLT5wYXJlbnQsICZkYXRhKTsKKwkJYnJl
YWs7CisJY2FzZSBDT1VOVEVSX1NDT1BFX0NPVU5UOgorCQlpZiAoYS0+Y29tcC50eXBlID09IENP
VU5URVJfQ09NUF9TWU5BUFNFX0FDVElPTikKKwkJCWVyciA9IGEtPmNvbXAuYWN0aW9uX3JlYWQo
Y291bnRlciwgYS0+cGFyZW50LAorCQkJCQkJICBhLT5jb21wLnByaXYsICZkYXRhKTsKKwkJZWxz
ZQorCQkJZXJyID0gYS0+Y29tcC5jb3VudF91MzJfcmVhZChjb3VudGVyLCBhLT5wYXJlbnQsICZk
YXRhKTsKKwkJYnJlYWs7CisJZGVmYXVsdDoKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCWlmIChl
cnIgPCAwKQorCQlyZXR1cm4gZXJyOworCisJc3dpdGNoIChhLT5jb21wLnR5cGUpIHsKKwljYXNl
IENPVU5URVJfQ09NUF9GVU5DVElPTjoKKwkJcmV0dXJuIHN5c2ZzX2VtaXQoYnVmLCAiJXNcbiIs
IGNvdW50ZXJfZnVuY3Rpb25fc3RyW2RhdGFdKTsKKwljYXNlIENPVU5URVJfQ09NUF9TSUdOQUxf
TEVWRUw6CisJCXJldHVybiBzeXNmc19lbWl0KGJ1ZiwgIiVzXG4iLCBjb3VudGVyX3NpZ25hbF92
YWx1ZV9zdHJbZGF0YV0pOworCWNhc2UgQ09VTlRFUl9DT01QX1NZTkFQU0VfQUNUSU9OOgorCQly
ZXR1cm4gc3lzZnNfZW1pdChidWYsICIlc1xuIiwgY291bnRlcl9zeW5hcHNlX2FjdGlvbl9zdHJb
ZGF0YV0pOworCWNhc2UgQ09VTlRFUl9DT01QX0VOVU06CisJCXJldHVybiBzeXNmc19lbWl0KGJ1
ZiwgIiVzXG4iLCBhdmFpbC0+c3Ryc1tkYXRhXSk7CisJY2FzZSBDT1VOVEVSX0NPTVBfQ09VTlRf
RElSRUNUSU9OOgorCQlyZXR1cm4gc3lzZnNfZW1pdChidWYsICIlc1xuIiwgY291bnRlcl9jb3Vu
dF9kaXJlY3Rpb25fc3RyW2RhdGFdKTsKKwljYXNlIENPVU5URVJfQ09NUF9DT1VOVF9NT0RFOgor
CQlyZXR1cm4gc3lzZnNfZW1pdChidWYsICIlc1xuIiwgY291bnRlcl9jb3VudF9tb2RlX3N0cltk
YXRhXSk7CisJZGVmYXVsdDoKKwkJcmV0dXJuIHNwcmludGYoYnVmLCAiJXVcbiIsICh1bnNpZ25l
ZCBpbnQpZGF0YSk7CisJfQorfQorCitzdGF0aWMgaW50IGNvdW50ZXJfZmluZF9lbnVtKHUzMiAq
Y29uc3QgZW51bV9pdGVtLCBjb25zdCB1MzIgKmNvbnN0IGVudW1zLAorCQkJICAgICBjb25zdCBz
aXplX3QgbnVtX2VudW1zLCBjb25zdCBjaGFyICpjb25zdCBidWYsCisJCQkgICAgIGNvbnN0IGNo
YXIgKmNvbnN0IHN0cmluZ19hcnJheVtdKQoreworCXNpemVfdCBpbmRleDsKKworCWZvciAoaW5k
ZXggPSAwOyBpbmRleCA8IG51bV9lbnVtczsgaW5kZXgrKykgeworCQkqZW51bV9pdGVtID0gZW51
bXNbaW5kZXhdOworCQlpZiAoc3lzZnNfc3RyZXEoYnVmLCBzdHJpbmdfYXJyYXlbKmVudW1faXRl
bV0pKQorCQkJcmV0dXJuIDA7CisJfQorCisJcmV0dXJuIC1FSU5WQUw7Cit9CisKK3N0YXRpYyBz
c2l6ZV90IGNvdW50ZXJfY29tcF91MzJfc3RvcmUoc3RydWN0IGRldmljZSAqZGV2LAorCQkJCSAg
ICAgIHN0cnVjdCBkZXZpY2VfYXR0cmlidXRlICphdHRyLAorCQkJCSAgICAgIGNvbnN0IGNoYXIg
KmJ1Ziwgc2l6ZV90IGxlbikKK3sKKwljb25zdCBzdHJ1Y3QgY291bnRlcl9hdHRyaWJ1dGUgKmNv
bnN0IGEgPSB0b19jb3VudGVyX2F0dHJpYnV0ZShhdHRyKTsKKwlzdHJ1Y3QgY291bnRlcl9kZXZp
Y2UgKmNvbnN0IGNvdW50ZXIgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsKKwlzdHJ1Y3QgY291bnRl
cl9jb3VudCAqY29uc3QgY291bnQgPSBhLT5wYXJlbnQ7CisJc3RydWN0IGNvdW50ZXJfc3luYXBz
ZSAqY29uc3Qgc3luYXBzZSA9IGEtPmNvbXAucHJpdjsKKwljb25zdCBzdHJ1Y3QgY291bnRlcl9h
dmFpbGFibGUgKmNvbnN0IGF2YWlsID0gYS0+Y29tcC5wcml2OworCWludCBlcnI7CisJdTMyIGRh
dGEgPSAwOworCisJc3dpdGNoIChhLT5jb21wLnR5cGUpIHsKKwljYXNlIENPVU5URVJfQ09NUF9G
VU5DVElPTjoKKwkJZXJyID0gY291bnRlcl9maW5kX2VudW0oJmRhdGEsIGNvdW50LT5mdW5jdGlv
bnNfbGlzdCwKKwkJCQkJY291bnQtPm51bV9mdW5jdGlvbnMsIGJ1ZiwKKwkJCQkJY291bnRlcl9m
dW5jdGlvbl9zdHIpOworCQlicmVhazsKKwljYXNlIENPVU5URVJfQ09NUF9TWU5BUFNFX0FDVElP
TjoKKwkJZXJyID0gY291bnRlcl9maW5kX2VudW0oJmRhdGEsIHN5bmFwc2UtPmFjdGlvbnNfbGlz
dCwKKwkJCQkJc3luYXBzZS0+bnVtX2FjdGlvbnMsIGJ1ZiwKKwkJCQkJY291bnRlcl9zeW5hcHNl
X2FjdGlvbl9zdHIpOworCQlicmVhazsKKwljYXNlIENPVU5URVJfQ09NUF9FTlVNOgorCQllcnIg
PSBfX3N5c2ZzX21hdGNoX3N0cmluZyhhdmFpbC0+c3RycywgYXZhaWwtPm51bV9pdGVtcywgYnVm
KTsKKwkJZGF0YSA9IGVycjsKKwkJYnJlYWs7CisJY2FzZSBDT1VOVEVSX0NPTVBfQ09VTlRfTU9E
RToKKwkJZXJyID0gY291bnRlcl9maW5kX2VudW0oJmRhdGEsIGF2YWlsLT5lbnVtcywgYXZhaWwt
Pm51bV9pdGVtcywKKwkJCQkJYnVmLCBjb3VudGVyX2NvdW50X21vZGVfc3RyKTsKKwkJYnJlYWs7
CisJZGVmYXVsdDoKKwkJZXJyID0ga3N0cnRvdTMyKGJ1ZiwgMCwgJmRhdGEpOworCQlicmVhazsK
Kwl9CisJaWYgKGVyciA8IDApCisJCXJldHVybiBlcnI7CisKKwlzd2l0Y2ggKGEtPnNjb3BlKSB7
CisJY2FzZSBDT1VOVEVSX1NDT1BFX0RFVklDRToKKwkJZXJyID0gYS0+Y29tcC5kZXZpY2VfdTMy
X3dyaXRlKGNvdW50ZXIsIGRhdGEpOworCQlicmVhazsKKwljYXNlIENPVU5URVJfU0NPUEVfU0lH
TkFMOgorCQllcnIgPSBhLT5jb21wLnNpZ25hbF91MzJfd3JpdGUoY291bnRlciwgYS0+cGFyZW50
LCBkYXRhKTsKKwkJYnJlYWs7CisJY2FzZSBDT1VOVEVSX1NDT1BFX0NPVU5UOgorCQlpZiAoYS0+
Y29tcC50eXBlID09IENPVU5URVJfQ09NUF9TWU5BUFNFX0FDVElPTikKKwkJCWVyciA9IGEtPmNv
bXAuYWN0aW9uX3dyaXRlKGNvdW50ZXIsIGNvdW50LCBzeW5hcHNlLAorCQkJCQkJICAgZGF0YSk7
CisJCWVsc2UKKwkJCWVyciA9IGEtPmNvbXAuY291bnRfdTMyX3dyaXRlKGNvdW50ZXIsIGNvdW50
LCBkYXRhKTsKKwkJYnJlYWs7CisJZGVmYXVsdDoKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCWlm
IChlcnIgPCAwKQorCQlyZXR1cm4gZXJyOworCisJcmV0dXJuIGxlbjsKK30KKworc3RhdGljIHNz
aXplX3QgY291bnRlcl9jb21wX3U2NF9zaG93KHN0cnVjdCBkZXZpY2UgKmRldiwKKwkJCQkgICAg
IHN0cnVjdCBkZXZpY2VfYXR0cmlidXRlICphdHRyLCBjaGFyICpidWYpCit7CisJY29uc3Qgc3Ry
dWN0IGNvdW50ZXJfYXR0cmlidXRlICpjb25zdCBhID0gdG9fY291bnRlcl9hdHRyaWJ1dGUoYXR0
cik7CisJc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb25zdCBjb3VudGVyID0gZGV2X2dldF9kcnZk
YXRhKGRldik7CisJaW50IGVycjsKKwl1NjQgZGF0YSA9IDA7CisKKwlzd2l0Y2ggKGEtPnNjb3Bl
KSB7CisJY2FzZSBDT1VOVEVSX1NDT1BFX0RFVklDRToKKwkJZXJyID0gYS0+Y29tcC5kZXZpY2Vf
dTY0X3JlYWQoY291bnRlciwgJmRhdGEpOworCQlicmVhazsKKwljYXNlIENPVU5URVJfU0NPUEVf
U0lHTkFMOgorCQllcnIgPSBhLT5jb21wLnNpZ25hbF91NjRfcmVhZChjb3VudGVyLCBhLT5wYXJl
bnQsICZkYXRhKTsKKwkJYnJlYWs7CisJY2FzZSBDT1VOVEVSX1NDT1BFX0NPVU5UOgorCQllcnIg
PSBhLT5jb21wLmNvdW50X3U2NF9yZWFkKGNvdW50ZXIsIGEtPnBhcmVudCwgJmRhdGEpOworCQli
cmVhazsKKwlkZWZhdWx0OgorCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisJaWYgKGVyciA8IDApCisJ
CXJldHVybiBlcnI7CisKKwlyZXR1cm4gc3ByaW50ZihidWYsICIlbGx1XG4iLCAodW5zaWduZWQg
bG9uZyBsb25nKWRhdGEpOworfQorCitzdGF0aWMgc3NpemVfdCBjb3VudGVyX2NvbXBfdTY0X3N0
b3JlKHN0cnVjdCBkZXZpY2UgKmRldiwKKwkJCQkgICAgICBzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0
ZSAqYXR0ciwKKwkJCQkgICAgICBjb25zdCBjaGFyICpidWYsIHNpemVfdCBsZW4pCit7CisJY29u
c3Qgc3RydWN0IGNvdW50ZXJfYXR0cmlidXRlICpjb25zdCBhID0gdG9fY291bnRlcl9hdHRyaWJ1
dGUoYXR0cik7CisJc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb25zdCBjb3VudGVyID0gZGV2X2dl
dF9kcnZkYXRhKGRldik7CisJaW50IGVycjsKKwl1NjQgZGF0YSA9IDA7CisKKwllcnIgPSBrc3Ry
dG91NjQoYnVmLCAwLCAmZGF0YSk7CisJaWYgKGVyciA8IDApCisJCXJldHVybiBlcnI7CisKKwlz
d2l0Y2ggKGEtPnNjb3BlKSB7CisJY2FzZSBDT1VOVEVSX1NDT1BFX0RFVklDRToKKwkJZXJyID0g
YS0+Y29tcC5kZXZpY2VfdTY0X3dyaXRlKGNvdW50ZXIsIGRhdGEpOworCQlicmVhazsKKwljYXNl
IENPVU5URVJfU0NPUEVfU0lHTkFMOgorCQllcnIgPSBhLT5jb21wLnNpZ25hbF91NjRfd3JpdGUo
Y291bnRlciwgYS0+cGFyZW50LCBkYXRhKTsKKwkJYnJlYWs7CisJY2FzZSBDT1VOVEVSX1NDT1BF
X0NPVU5UOgorCQllcnIgPSBhLT5jb21wLmNvdW50X3U2NF93cml0ZShjb3VudGVyLCBhLT5wYXJl
bnQsIGRhdGEpOworCQlicmVhazsKKwlkZWZhdWx0OgorCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisJ
aWYgKGVyciA8IDApCisJCXJldHVybiBlcnI7CisKKwlyZXR1cm4gbGVuOworfQorCitzdGF0aWMg
c3NpemVfdCBlbnVtc19hdmFpbGFibGVfc2hvdyhjb25zdCB1MzIgKmNvbnN0IGVudW1zLAorCQkJ
CSAgICBjb25zdCBzaXplX3QgbnVtX2VudW1zLAorCQkJCSAgICBjb25zdCBjaGFyICpjb25zdCBz
dHJzW10sIGNoYXIgKmJ1ZikKK3sKKwlzaXplX3QgbGVuID0gMDsKKwlzaXplX3QgaW5kZXg7CisK
Kwlmb3IgKGluZGV4ID0gMDsgaW5kZXggPCBudW1fZW51bXM7IGluZGV4KyspCisJCWxlbiArPSBz
eXNmc19lbWl0X2F0KGJ1ZiwgbGVuLCAiJXNcbiIsIHN0cnNbZW51bXNbaW5kZXhdXSk7CisKKwly
ZXR1cm4gbGVuOworfQorCitzdGF0aWMgc3NpemVfdCBzdHJzX2F2YWlsYWJsZV9zaG93KGNvbnN0
IHN0cnVjdCBjb3VudGVyX2F2YWlsYWJsZSAqY29uc3QgYXZhaWwsCisJCQkJICAgY2hhciAqYnVm
KQoreworCXNpemVfdCBsZW4gPSAwOworCXNpemVfdCBpbmRleDsKKworCWZvciAoaW5kZXggPSAw
OyBpbmRleCA8IGF2YWlsLT5udW1faXRlbXM7IGluZGV4KyspCisJCWxlbiArPSBzeXNmc19lbWl0
X2F0KGJ1ZiwgbGVuLCAiJXNcbiIsIGF2YWlsLT5zdHJzW2luZGV4XSk7CisKKwlyZXR1cm4gbGVu
OworfQorCitzdGF0aWMgc3NpemVfdCBjb3VudGVyX2NvbXBfYXZhaWxhYmxlX3Nob3coc3RydWN0
IGRldmljZSAqZGV2LAorCQkJCQkgICBzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSAqYXR0ciwKKwkJ
CQkJICAgY2hhciAqYnVmKQoreworCWNvbnN0IHN0cnVjdCBjb3VudGVyX2F0dHJpYnV0ZSAqY29u
c3QgYSA9IHRvX2NvdW50ZXJfYXR0cmlidXRlKGF0dHIpOworCWNvbnN0IHN0cnVjdCBjb3VudGVy
X2NvdW50ICpjb25zdCBjb3VudCA9IGEtPnBhcmVudDsKKwljb25zdCBzdHJ1Y3QgY291bnRlcl9z
eW5hcHNlICpjb25zdCBzeW5hcHNlID0gYS0+Y29tcC5wcml2OworCWNvbnN0IHN0cnVjdCBjb3Vu
dGVyX2F2YWlsYWJsZSAqY29uc3QgYXZhaWwgPSBhLT5jb21wLnByaXY7CisKKwlzd2l0Y2ggKGEt
PmNvbXAudHlwZSkgeworCWNhc2UgQ09VTlRFUl9DT01QX0ZVTkNUSU9OOgorCQlyZXR1cm4gZW51
bXNfYXZhaWxhYmxlX3Nob3coY291bnQtPmZ1bmN0aW9uc19saXN0LAorCQkJCQkgICAgY291bnQt
Pm51bV9mdW5jdGlvbnMsCisJCQkJCSAgICBjb3VudGVyX2Z1bmN0aW9uX3N0ciwgYnVmKTsKKwlj
YXNlIENPVU5URVJfQ09NUF9TWU5BUFNFX0FDVElPTjoKKwkJcmV0dXJuIGVudW1zX2F2YWlsYWJs
ZV9zaG93KHN5bmFwc2UtPmFjdGlvbnNfbGlzdCwKKwkJCQkJICAgIHN5bmFwc2UtPm51bV9hY3Rp
b25zLAorCQkJCQkgICAgY291bnRlcl9zeW5hcHNlX2FjdGlvbl9zdHIsIGJ1Zik7CisJY2FzZSBD
T1VOVEVSX0NPTVBfRU5VTToKKwkJcmV0dXJuIHN0cnNfYXZhaWxhYmxlX3Nob3coYXZhaWwsIGJ1
Zik7CisJY2FzZSBDT1VOVEVSX0NPTVBfQ09VTlRfTU9ERToKKwkJcmV0dXJuIGVudW1zX2F2YWls
YWJsZV9zaG93KGF2YWlsLT5lbnVtcywgYXZhaWwtPm51bV9pdGVtcywKKwkJCQkJICAgIGNvdW50
ZXJfY291bnRfbW9kZV9zdHIsIGJ1Zik7CisJZGVmYXVsdDoKKwkJcmV0dXJuIC1FSU5WQUw7CisJ
fQorfQorCitzdGF0aWMgaW50IGNvdW50ZXJfYXZhaWxfYXR0cl9jcmVhdGUoc3RydWN0IGRldmlj
ZSAqY29uc3QgZGV2LAorCXN0cnVjdCBjb3VudGVyX2F0dHJpYnV0ZV9ncm91cCAqY29uc3QgZ3Jv
dXAsCisJY29uc3Qgc3RydWN0IGNvdW50ZXJfY29tcCAqY29uc3QgY29tcCwgdm9pZCAqY29uc3Qg
cGFyZW50KQoreworCXN0cnVjdCBjb3VudGVyX2F0dHJpYnV0ZSAqY291bnRlcl9hdHRyOworCXN0
cnVjdCBkZXZpY2VfYXR0cmlidXRlICpkZXZfYXR0cjsKKworCS8qIEFsbG9jYXRlIENvdW50ZXIg
YXR0cmlidXRlICovCisJY291bnRlcl9hdHRyID0gZGV2bV9remFsbG9jKGRldiwgc2l6ZW9mKCpj
b3VudGVyX2F0dHIpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWNvdW50ZXJfYXR0cikKKwkJcmV0dXJu
IC1FTk9NRU07CisKKwkvKiBDb25maWd1cmUgQ291bnRlciBhdHRyaWJ1dGUgKi8KKwljb3VudGVy
X2F0dHItPmNvbXAudHlwZSA9IGNvbXAtPnR5cGU7CisJY291bnRlcl9hdHRyLT5jb21wLnByaXYg
PSBjb21wLT5wcml2OworCWNvdW50ZXJfYXR0ci0+cGFyZW50ID0gcGFyZW50OworCisJLyogSW5p
dGlhbGl6ZSBzeXNmcyBhdHRyaWJ1dGUgKi8KKwlkZXZfYXR0ciA9ICZjb3VudGVyX2F0dHItPmRl
dl9hdHRyOworCXN5c2ZzX2F0dHJfaW5pdCgmZGV2X2F0dHItPmF0dHIpOworCisJLyogQ29uZmln
dXJlIGRldmljZSBhdHRyaWJ1dGUgKi8KKwlkZXZfYXR0ci0+YXR0ci5uYW1lID0gZGV2bV9rYXNw
cmludGYoZGV2LCBHRlBfS0VSTkVMLCAiJXNfYXZhaWxhYmxlIiwKKwkJCQkJICAgICBjb21wLT5u
YW1lKTsKKwlpZiAoIWRldl9hdHRyLT5hdHRyLm5hbWUpCisJCXJldHVybiAtRU5PTUVNOworCWRl
dl9hdHRyLT5hdHRyLm1vZGUgPSAwNDQ0OworCWRldl9hdHRyLT5zaG93ID0gY291bnRlcl9jb21w
X2F2YWlsYWJsZV9zaG93OworCisJLyogU3RvcmUgbGlzdCBub2RlICovCisJbGlzdF9hZGQoJmNv
dW50ZXJfYXR0ci0+bCwgJmdyb3VwLT5hdHRyX2xpc3QpOworCWdyb3VwLT5udW1fYXR0cisrOwor
CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgY291bnRlcl9hdHRyX2NyZWF0ZShzdHJ1Y3Qg
ZGV2aWNlICpjb25zdCBkZXYsCisJCQkgICAgICAgc3RydWN0IGNvdW50ZXJfYXR0cmlidXRlX2dy
b3VwICpjb25zdCBncm91cCwKKwkJCSAgICAgICBjb25zdCBzdHJ1Y3QgY291bnRlcl9jb21wICpj
b25zdCBjb21wLAorCQkJICAgICAgIGNvbnN0IGVudW0gY291bnRlcl9zY29wZSBzY29wZSwKKwkJ
CSAgICAgICB2b2lkICpjb25zdCBwYXJlbnQpCit7CisJc3RydWN0IGNvdW50ZXJfYXR0cmlidXRl
ICpjb3VudGVyX2F0dHI7CisJc3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmRldl9hdHRyOworCisJ
LyogQWxsb2NhdGUgQ291bnRlciBhdHRyaWJ1dGUgKi8KKwljb3VudGVyX2F0dHIgPSBkZXZtX2t6
YWxsb2MoZGV2LCBzaXplb2YoKmNvdW50ZXJfYXR0ciksIEdGUF9LRVJORUwpOworCWlmICghY291
bnRlcl9hdHRyKQorCQlyZXR1cm4gLUVOT01FTTsKKworCS8qIENvbmZpZ3VyZSBDb3VudGVyIGF0
dHJpYnV0ZSAqLworCWNvdW50ZXJfYXR0ci0+Y29tcCA9ICpjb21wOworCWNvdW50ZXJfYXR0ci0+
c2NvcGUgPSBzY29wZTsKKwljb3VudGVyX2F0dHItPnBhcmVudCA9IHBhcmVudDsKKworCS8qIENv
bmZpZ3VyZSBkZXZpY2UgYXR0cmlidXRlICovCisJZGV2X2F0dHIgPSAmY291bnRlcl9hdHRyLT5k
ZXZfYXR0cjsKKwlzeXNmc19hdHRyX2luaXQoJmRldl9hdHRyLT5hdHRyKTsKKwlkZXZfYXR0ci0+
YXR0ci5uYW1lID0gY29tcC0+bmFtZTsKKwlzd2l0Y2ggKGNvbXAtPnR5cGUpIHsKKwljYXNlIENP
VU5URVJfQ09NUF9VODoKKwljYXNlIENPVU5URVJfQ09NUF9CT09MOgorCQlpZiAoY29tcC0+ZGV2
aWNlX3U4X3JlYWQpIHsKKwkJCWRldl9hdHRyLT5hdHRyLm1vZGUgfD0gMDQ0NDsKKwkJCWRldl9h
dHRyLT5zaG93ID0gY291bnRlcl9jb21wX3U4X3Nob3c7CisJCX0KKwkJaWYgKGNvbXAtPmRldmlj
ZV91OF93cml0ZSkgeworCQkJZGV2X2F0dHItPmF0dHIubW9kZSB8PSAwMjAwOworCQkJZGV2X2F0
dHItPnN0b3JlID0gY291bnRlcl9jb21wX3U4X3N0b3JlOworCQl9CisJCWJyZWFrOworCWNhc2Ug
Q09VTlRFUl9DT01QX1NJR05BTF9MRVZFTDoKKwljYXNlIENPVU5URVJfQ09NUF9GVU5DVElPTjoK
KwljYXNlIENPVU5URVJfQ09NUF9TWU5BUFNFX0FDVElPTjoKKwljYXNlIENPVU5URVJfQ09NUF9F
TlVNOgorCWNhc2UgQ09VTlRFUl9DT01QX0NPVU5UX0RJUkVDVElPTjoKKwljYXNlIENPVU5URVJf
Q09NUF9DT1VOVF9NT0RFOgorCQlpZiAoY29tcC0+ZGV2aWNlX3UzMl9yZWFkKSB7CisJCQlkZXZf
YXR0ci0+YXR0ci5tb2RlIHw9IDA0NDQ7CisJCQlkZXZfYXR0ci0+c2hvdyA9IGNvdW50ZXJfY29t
cF91MzJfc2hvdzsKKwkJfQorCQlpZiAoY29tcC0+ZGV2aWNlX3UzMl93cml0ZSkgeworCQkJZGV2
X2F0dHItPmF0dHIubW9kZSB8PSAwMjAwOworCQkJZGV2X2F0dHItPnN0b3JlID0gY291bnRlcl9j
b21wX3UzMl9zdG9yZTsKKwkJfQorCQlicmVhazsKKwljYXNlIENPVU5URVJfQ09NUF9VNjQ6CisJ
CWlmIChjb21wLT5kZXZpY2VfdTY0X3JlYWQpIHsKKwkJCWRldl9hdHRyLT5hdHRyLm1vZGUgfD0g
MDQ0NDsKKwkJCWRldl9hdHRyLT5zaG93ID0gY291bnRlcl9jb21wX3U2NF9zaG93OworCQl9CisJ
CWlmIChjb21wLT5kZXZpY2VfdTY0X3dyaXRlKSB7CisJCQlkZXZfYXR0ci0+YXR0ci5tb2RlIHw9
IDAyMDA7CisJCQlkZXZfYXR0ci0+c3RvcmUgPSBjb3VudGVyX2NvbXBfdTY0X3N0b3JlOworCQl9
CisJCWJyZWFrOworCWRlZmF1bHQ6CisJCXJldHVybiAtRUlOVkFMOworCX0KKworCS8qIFN0b3Jl
IGxpc3Qgbm9kZSAqLworCWxpc3RfYWRkKCZjb3VudGVyX2F0dHItPmwsICZncm91cC0+YXR0cl9s
aXN0KTsKKwlncm91cC0+bnVtX2F0dHIrKzsKKworCS8qIENyZWF0ZSAiKl9hdmFpbGFibGUiIGF0
dHJpYnV0ZSBpZiBuZWVkZWQgKi8KKwlzd2l0Y2ggKGNvbXAtPnR5cGUpIHsKKwljYXNlIENPVU5U
RVJfQ09NUF9GVU5DVElPTjoKKwljYXNlIENPVU5URVJfQ09NUF9TWU5BUFNFX0FDVElPTjoKKwlj
YXNlIENPVU5URVJfQ09NUF9FTlVNOgorCWNhc2UgQ09VTlRFUl9DT01QX0NPVU5UX01PREU6CisJ
CXJldHVybiBjb3VudGVyX2F2YWlsX2F0dHJfY3JlYXRlKGRldiwgZ3JvdXAsIGNvbXAsIHBhcmVu
dCk7CisJZGVmYXVsdDoKKwkJcmV0dXJuIDA7CisJfQorfQorCitzdGF0aWMgc3NpemVfdCBjb3Vu
dGVyX2NvbXBfbmFtZV9zaG93KHN0cnVjdCBkZXZpY2UgKmRldiwKKwkJCQkgICAgICBzdHJ1Y3Qg
ZGV2aWNlX2F0dHJpYnV0ZSAqYXR0ciwgY2hhciAqYnVmKQoreworCXJldHVybiBzeXNmc19lbWl0
KGJ1ZiwgIiVzXG4iLCB0b19jb3VudGVyX2F0dHJpYnV0ZShhdHRyKS0+Y29tcC5uYW1lKTsKK30K
Kworc3RhdGljIGludCBjb3VudGVyX25hbWVfYXR0cl9jcmVhdGUoc3RydWN0IGRldmljZSAqY29u
c3QgZGV2LAorCQkJCSAgICBzdHJ1Y3QgY291bnRlcl9hdHRyaWJ1dGVfZ3JvdXAgKmNvbnN0IGdy
b3VwLAorCQkJCSAgICBjb25zdCBjaGFyICpjb25zdCBuYW1lKQoreworCXN0cnVjdCBjb3VudGVy
X2F0dHJpYnV0ZSAqY291bnRlcl9hdHRyOworCisJLyogQWxsb2NhdGUgQ291bnRlciBhdHRyaWJ1
dGUgKi8KKwljb3VudGVyX2F0dHIgPSBkZXZtX2t6YWxsb2MoZGV2LCBzaXplb2YoKmNvdW50ZXJf
YXR0ciksIEdGUF9LRVJORUwpOworCWlmICghY291bnRlcl9hdHRyKQorCQlyZXR1cm4gLUVOT01F
TTsKKworCS8qIENvbmZpZ3VyZSBDb3VudGVyIGF0dHJpYnV0ZSAqLworCWNvdW50ZXJfYXR0ci0+
Y29tcC5uYW1lID0gbmFtZTsKKworCS8qIENvbmZpZ3VyZSBkZXZpY2UgYXR0cmlidXRlICovCisJ
c3lzZnNfYXR0cl9pbml0KCZjb3VudGVyX2F0dHItPmRldl9hdHRyLmF0dHIpOworCWNvdW50ZXJf
YXR0ci0+ZGV2X2F0dHIuYXR0ci5uYW1lID0gIm5hbWUiOworCWNvdW50ZXJfYXR0ci0+ZGV2X2F0
dHIuYXR0ci5tb2RlID0gMDQ0NDsKKwljb3VudGVyX2F0dHItPmRldl9hdHRyLnNob3cgPSBjb3Vu
dGVyX2NvbXBfbmFtZV9zaG93OworCisJLyogU3RvcmUgbGlzdCBub2RlICovCisJbGlzdF9hZGQo
JmNvdW50ZXJfYXR0ci0+bCwgJmdyb3VwLT5hdHRyX2xpc3QpOworCWdyb3VwLT5udW1fYXR0cisr
OworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgY291bnRlcl9jb21wIGNvdW50ZXJf
c2lnbmFsX2NvbXAgPSB7CisJLnR5cGUgPSBDT1VOVEVSX0NPTVBfU0lHTkFMX0xFVkVMLAorCS5u
YW1lID0gInNpZ25hbCIsCit9OworCitzdGF0aWMgaW50IGNvdW50ZXJfc2lnbmFsX2F0dHJzX2Ny
ZWF0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvbnN0IGNvdW50ZXIsCisJc3RydWN0IGNvdW50
ZXJfYXR0cmlidXRlX2dyb3VwICpjb25zdCBncm91cCwKKwlzdHJ1Y3QgY291bnRlcl9zaWduYWwg
KmNvbnN0IHNpZ25hbCkKK3sKKwljb25zdCBlbnVtIGNvdW50ZXJfc2NvcGUgc2NvcGUgPSBDT1VO
VEVSX1NDT1BFX1NJR05BTDsKKwlzdHJ1Y3QgZGV2aWNlICpjb25zdCBkZXYgPSAmY291bnRlci0+
ZGV2OworCWludCBlcnI7CisJc3RydWN0IGNvdW50ZXJfY29tcCBjb21wOworCXNpemVfdCBpOwor
CisJLyogQ3JlYXRlIG1haW4gU2lnbmFsIGF0dHJpYnV0ZSAqLworCWNvbXAgPSBjb3VudGVyX3Np
Z25hbF9jb21wOworCWNvbXAuc2lnbmFsX3UzMl9yZWFkID0gY291bnRlci0+b3BzLT5zaWduYWxf
cmVhZDsKKwllcnIgPSBjb3VudGVyX2F0dHJfY3JlYXRlKGRldiwgZ3JvdXAsICZjb21wLCBzY29w
ZSwgc2lnbmFsKTsKKwlpZiAoZXJyIDwgMCkKKwkJcmV0dXJuIGVycjsKKworCS8qIENyZWF0ZSBT
aWduYWwgbmFtZSBhdHRyaWJ1dGUgKi8KKwllcnIgPSBjb3VudGVyX25hbWVfYXR0cl9jcmVhdGUo
ZGV2LCBncm91cCwgc2lnbmFsLT5uYW1lKTsKKwlpZiAoZXJyIDwgMCkKKwkJcmV0dXJuIGVycjsK
KworCS8qIENyZWF0ZSBhbiBhdHRyaWJ1dGUgZm9yIGVhY2ggZXh0ZW5zaW9uICovCisJZm9yIChp
ID0gMDsgaSA8IHNpZ25hbC0+bnVtX2V4dDsgaSsrKSB7CisJCWVyciA9IGNvdW50ZXJfYXR0cl9j
cmVhdGUoZGV2LCBncm91cCwgc2lnbmFsLT5leHQgKyBpLCBzY29wZSwKKwkJCQkJICBzaWduYWwp
OworCQlpZiAoZXJyIDwgMCkKKwkJCXJldHVybiBlcnI7CisJfQorCisJcmV0dXJuIDA7Cit9CisK
K3N0YXRpYyBpbnQgY291bnRlcl9zeXNmc19zaWduYWxzX2FkZChzdHJ1Y3QgY291bnRlcl9kZXZp
Y2UgKmNvbnN0IGNvdW50ZXIsCisJc3RydWN0IGNvdW50ZXJfYXR0cmlidXRlX2dyb3VwICpjb25z
dCBncm91cHMpCit7CisJc2l6ZV90IGk7CisJaW50IGVycjsKKworCS8qIEFkZCBlYWNoIFNpZ25h
bCAqLworCWZvciAoaSA9IDA7IGkgPCBjb3VudGVyLT5udW1fc2lnbmFsczsgaSsrKSB7CisJCS8q
IEdlbmVyYXRlIFNpZ25hbCBhdHRyaWJ1dGUgZGlyZWN0b3J5IG5hbWUgKi8KKwkJZ3JvdXBzW2ld
Lm5hbWUgPSBkZXZtX2thc3ByaW50ZigmY291bnRlci0+ZGV2LCBHRlBfS0VSTkVMLAorCQkJCQkJ
InNpZ25hbCV6dSIsIGkpOworCQlpZiAoIWdyb3Vwc1tpXS5uYW1lKQorCQkJcmV0dXJuIC1FTk9N
RU07CisKKwkJLyogQ3JlYXRlIGFsbCBhdHRyaWJ1dGVzIGFzc29jaWF0ZWQgd2l0aCBTaWduYWwg
Ki8KKwkJZXJyID0gY291bnRlcl9zaWduYWxfYXR0cnNfY3JlYXRlKGNvdW50ZXIsIGdyb3VwcyAr
IGksCisJCQkJCQkgIGNvdW50ZXItPnNpZ25hbHMgKyBpKTsKKwkJaWYgKGVyciA8IDApCisJCQly
ZXR1cm4gZXJyOworCX0KKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGNvdW50ZXJfc3lz
ZnNfc3luYXBzZXNfYWRkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY29uc3QgY291bnRlciwKKwlz
dHJ1Y3QgY291bnRlcl9hdHRyaWJ1dGVfZ3JvdXAgKmNvbnN0IGdyb3VwLAorCXN0cnVjdCBjb3Vu
dGVyX2NvdW50ICpjb25zdCBjb3VudCkKK3sKKwlzaXplX3QgaTsKKworCS8qIEFkZCBlYWNoIFN5
bmFwc2UgKi8KKwlmb3IgKGkgPSAwOyBpIDwgY291bnQtPm51bV9zeW5hcHNlczsgaSsrKSB7CisJ
CXN0cnVjdCBkZXZpY2UgKmNvbnN0IGRldiA9ICZjb3VudGVyLT5kZXY7CisJCXN0cnVjdCBjb3Vu
dGVyX3N5bmFwc2UgKnN5bmFwc2U7CisJCXNpemVfdCBpZDsKKwkJc3RydWN0IGNvdW50ZXJfY29t
cCBjb21wOworCQlpbnQgZXJyOworCisJCXN5bmFwc2UgPSBjb3VudC0+c3luYXBzZXMgKyBpOwor
CisJCS8qIEdlbmVyYXRlIFN5bmFwc2UgYWN0aW9uIG5hbWUgKi8KKwkJaWQgPSBzeW5hcHNlLT5z
aWduYWwgLSBjb3VudGVyLT5zaWduYWxzOworCQljb21wLm5hbWUgPSBkZXZtX2thc3ByaW50Zihk
ZXYsIEdGUF9LRVJORUwsICJzaWduYWwlenVfYWN0aW9uIiwKKwkJCQkJICAgaWQpOworCQlpZiAo
IWNvbXAubmFtZSkKKwkJCXJldHVybiAtRU5PTUVNOworCisJCS8qIENyZWF0ZSBhY3Rpb24gYXR0
cmlidXRlICovCisJCWNvbXAudHlwZSA9IENPVU5URVJfQ09NUF9TWU5BUFNFX0FDVElPTjsKKwkJ
Y29tcC5hY3Rpb25fcmVhZCA9IGNvdW50ZXItPm9wcy0+YWN0aW9uX3JlYWQ7CisJCWNvbXAuYWN0
aW9uX3dyaXRlID0gY291bnRlci0+b3BzLT5hY3Rpb25fd3JpdGU7CisJCWNvbXAucHJpdiA9IHN5
bmFwc2U7CisJCWVyciA9IGNvdW50ZXJfYXR0cl9jcmVhdGUoZGV2LCBncm91cCwgJmNvbXAsCisJ
CQkJCSAgQ09VTlRFUl9TQ09QRV9DT1VOVCwgY291bnQpOworCQlpZiAoZXJyIDwgMCkKKwkJCXJl
dHVybiBlcnI7CisJfQorCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgY291bnRlcl9j
b21wIGNvdW50ZXJfY291bnRfY29tcCA9CisJQ09VTlRFUl9DT01QX0NPVU5UX1U2NCgiY291bnQi
LCBOVUxMLCBOVUxMKTsKKworc3RhdGljIHN0cnVjdCBjb3VudGVyX2NvbXAgY291bnRlcl9mdW5j
dGlvbl9jb21wID0geworCS50eXBlID0gQ09VTlRFUl9DT01QX0ZVTkNUSU9OLAorCS5uYW1lID0g
ImZ1bmN0aW9uIiwKK307CisKK3N0YXRpYyBpbnQgY291bnRlcl9jb3VudF9hdHRyc19jcmVhdGUo
c3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb25zdCBjb3VudGVyLAorCXN0cnVjdCBjb3VudGVyX2F0
dHJpYnV0ZV9ncm91cCAqY29uc3QgZ3JvdXAsCisJc3RydWN0IGNvdW50ZXJfY291bnQgKmNvbnN0
IGNvdW50KQoreworCWNvbnN0IGVudW0gY291bnRlcl9zY29wZSBzY29wZSA9IENPVU5URVJfU0NP
UEVfQ09VTlQ7CisJc3RydWN0IGRldmljZSAqY29uc3QgZGV2ID0gJmNvdW50ZXItPmRldjsKKwlp
bnQgZXJyOworCXN0cnVjdCBjb3VudGVyX2NvbXAgY29tcDsKKwlzaXplX3QgaTsKKworCS8qIENy
ZWF0ZSBtYWluIENvdW50IGF0dHJpYnV0ZSAqLworCWNvbXAgPSBjb3VudGVyX2NvdW50X2NvbXA7
CisJY29tcC5jb3VudF91NjRfcmVhZCA9IGNvdW50ZXItPm9wcy0+Y291bnRfcmVhZDsKKwljb21w
LmNvdW50X3U2NF93cml0ZSA9IGNvdW50ZXItPm9wcy0+Y291bnRfd3JpdGU7CisJZXJyID0gY291
bnRlcl9hdHRyX2NyZWF0ZShkZXYsIGdyb3VwLCAmY29tcCwgc2NvcGUsIGNvdW50KTsKKwlpZiAo
ZXJyIDwgMCkKKwkJcmV0dXJuIGVycjsKKworCS8qIENyZWF0ZSBDb3VudCBuYW1lIGF0dHJpYnV0
ZSAqLworCWVyciA9IGNvdW50ZXJfbmFtZV9hdHRyX2NyZWF0ZShkZXYsIGdyb3VwLCBjb3VudC0+
bmFtZSk7CisJaWYgKGVyciA8IDApCisJCXJldHVybiBlcnI7CisKKwkvKiBDcmVhdGUgQ291bnQg
ZnVuY3Rpb24gYXR0cmlidXRlICovCisJY29tcCA9IGNvdW50ZXJfZnVuY3Rpb25fY29tcDsKKwlj
b21wLmNvdW50X3UzMl9yZWFkID0gY291bnRlci0+b3BzLT5mdW5jdGlvbl9yZWFkOworCWNvbXAu
Y291bnRfdTMyX3dyaXRlID0gY291bnRlci0+b3BzLT5mdW5jdGlvbl93cml0ZTsKKwllcnIgPSBj
b3VudGVyX2F0dHJfY3JlYXRlKGRldiwgZ3JvdXAsICZjb21wLCBzY29wZSwgY291bnQpOworCWlm
IChlcnIgPCAwKQorCQlyZXR1cm4gZXJyOworCisJLyogQ3JlYXRlIGFuIGF0dHJpYnV0ZSBmb3Ig
ZWFjaCBleHRlbnNpb24gKi8KKwlmb3IgKGkgPSAwOyBpIDwgY291bnQtPm51bV9leHQ7IGkrKykg
eworCQllcnIgPSBjb3VudGVyX2F0dHJfY3JlYXRlKGRldiwgZ3JvdXAsIGNvdW50LT5leHQgKyBp
LCBzY29wZSwKKwkJCQkJICBjb3VudCk7CisJCWlmIChlcnIgPCAwKQorCQkJcmV0dXJuIGVycjsK
Kwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBjb3VudGVyX3N5c2ZzX2NvdW50c19h
ZGQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb25zdCBjb3VudGVyLAorCXN0cnVjdCBjb3VudGVy
X2F0dHJpYnV0ZV9ncm91cCAqY29uc3QgZ3JvdXBzKQoreworCXNpemVfdCBpOworCXN0cnVjdCBj
b3VudGVyX2NvdW50ICpjb3VudDsKKwlpbnQgZXJyOworCisJLyogQWRkIGVhY2ggQ291bnQgKi8K
Kwlmb3IgKGkgPSAwOyBpIDwgY291bnRlci0+bnVtX2NvdW50czsgaSsrKSB7CisJCWNvdW50ID0g
Y291bnRlci0+Y291bnRzICsgaTsKKworCQkvKiBHZW5lcmF0ZSBDb3VudCBhdHRyaWJ1dGUgZGly
ZWN0b3J5IG5hbWUgKi8KKwkJZ3JvdXBzW2ldLm5hbWUgPSBkZXZtX2thc3ByaW50ZigmY291bnRl
ci0+ZGV2LCBHRlBfS0VSTkVMLAorCQkJCQkJImNvdW50JXp1IiwgaSk7CisJCWlmICghZ3JvdXBz
W2ldLm5hbWUpCisJCQlyZXR1cm4gLUVOT01FTTsKKworCQkvKiBBZGQgc3lzZnMgYXR0cmlidXRl
cyBvZiB0aGUgU3luYXBzZXMgKi8KKwkJZXJyID0gY291bnRlcl9zeXNmc19zeW5hcHNlc19hZGQo
Y291bnRlciwgZ3JvdXBzICsgaSwgY291bnQpOworCQlpZiAoZXJyIDwgMCkKKwkJCXJldHVybiBl
cnI7CisKKwkJLyogQ3JlYXRlIGFsbCBhdHRyaWJ1dGVzIGFzc29jaWF0ZWQgd2l0aCBDb3VudCAq
LworCQllcnIgPSBjb3VudGVyX2NvdW50X2F0dHJzX2NyZWF0ZShjb3VudGVyLCBncm91cHMgKyBp
LCBjb3VudCk7CisJCWlmIChlcnIgPCAwKQorCQkJcmV0dXJuIGVycjsKKwl9CisKKwlyZXR1cm4g
MDsKK30KKworc3RhdGljIGludCBjb3VudGVyX251bV9zaWduYWxzX3JlYWQoc3RydWN0IGNvdW50
ZXJfZGV2aWNlICpjb3VudGVyLCB1OCAqdmFsKQoreworCSp2YWwgPSBjb3VudGVyLT5udW1fc2ln
bmFsczsKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBjb3VudGVyX251bV9jb3VudHNfcmVh
ZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsIHU4ICp2YWwpCit7CisJKnZhbCA9IGNv
dW50ZXItPm51bV9jb3VudHM7CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgY291bnRl
cl9jb21wIGNvdW50ZXJfbnVtX3NpZ25hbHNfY29tcCA9CisJQ09VTlRFUl9DT01QX0RFVklDRV9V
OCgibnVtX3NpZ25hbHMiLCBjb3VudGVyX251bV9zaWduYWxzX3JlYWQsIE5VTEwpOworCitzdGF0
aWMgc3RydWN0IGNvdW50ZXJfY29tcCBjb3VudGVyX251bV9jb3VudHNfY29tcCA9CisJQ09VTlRF
Ul9DT01QX0RFVklDRV9VOCgibnVtX2NvdW50cyIsIGNvdW50ZXJfbnVtX2NvdW50c19yZWFkLCBO
VUxMKTsKKworc3RhdGljIGludCBjb3VudGVyX3N5c2ZzX2F0dHJfYWRkKHN0cnVjdCBjb3VudGVy
X2RldmljZSAqY29uc3QgY291bnRlciwKKwkJCQkgIHN0cnVjdCBjb3VudGVyX2F0dHJpYnV0ZV9n
cm91cCAqZ3JvdXApCit7CisJY29uc3QgZW51bSBjb3VudGVyX3Njb3BlIHNjb3BlID0gQ09VTlRF
Ul9TQ09QRV9ERVZJQ0U7CisJc3RydWN0IGRldmljZSAqY29uc3QgZGV2ID0gJmNvdW50ZXItPmRl
djsKKwlpbnQgZXJyOworCXNpemVfdCBpOworCisJLyogQWRkIFNpZ25hbHMgc3lzZnMgYXR0cmli
dXRlcyAqLworCWVyciA9IGNvdW50ZXJfc3lzZnNfc2lnbmFsc19hZGQoY291bnRlciwgZ3JvdXAp
OworCWlmIChlcnIgPCAwKQorCQlyZXR1cm4gZXJyOworCWdyb3VwICs9IGNvdW50ZXItPm51bV9z
aWduYWxzOworCisJLyogQWRkIENvdW50cyBzeXNmcyBhdHRyaWJ1dGVzICovCisJZXJyID0gY291
bnRlcl9zeXNmc19jb3VudHNfYWRkKGNvdW50ZXIsIGdyb3VwKTsKKwlpZiAoZXJyIDwgMCkKKwkJ
cmV0dXJuIGVycjsKKwlncm91cCArPSBjb3VudGVyLT5udW1fY291bnRzOworCisJLyogQ3JlYXRl
IG5hbWUgYXR0cmlidXRlICovCisJZXJyID0gY291bnRlcl9uYW1lX2F0dHJfY3JlYXRlKGRldiwg
Z3JvdXAsIGNvdW50ZXItPm5hbWUpOworCWlmIChlcnIgPCAwKQorCQlyZXR1cm4gZXJyOworCisJ
LyogQ3JlYXRlIG51bV9zaWduYWxzIGF0dHJpYnV0ZSAqLworCWVyciA9IGNvdW50ZXJfYXR0cl9j
cmVhdGUoZGV2LCBncm91cCwgJmNvdW50ZXJfbnVtX3NpZ25hbHNfY29tcCwgc2NvcGUsCisJCQkJ
ICBOVUxMKTsKKwlpZiAoZXJyIDwgMCkKKwkJcmV0dXJuIGVycjsKKworCS8qIENyZWF0ZSBudW1f
Y291bnRzIGF0dHJpYnV0ZSAqLworCWVyciA9IGNvdW50ZXJfYXR0cl9jcmVhdGUoZGV2LCBncm91
cCwgJmNvdW50ZXJfbnVtX2NvdW50c19jb21wLCBzY29wZSwKKwkJCQkgIE5VTEwpOworCWlmIChl
cnIgPCAwKQorCQlyZXR1cm4gZXJyOworCisJLyogQ3JlYXRlIGFuIGF0dHJpYnV0ZSBmb3IgZWFj
aCBleHRlbnNpb24gKi8KKwlmb3IgKGkgPSAwOyBpIDwgY291bnRlci0+bnVtX2V4dDsgaSsrKSB7
CisJCWVyciA9IGNvdW50ZXJfYXR0cl9jcmVhdGUoZGV2LCBncm91cCwgY291bnRlci0+ZXh0ICsg
aSwgc2NvcGUsCisJCQkJCSAgTlVMTCk7CisJCWlmIChlcnIgPCAwKQorCQkJcmV0dXJuIGVycjsK
Kwl9CisKKwlyZXR1cm4gMDsKK30KKworLyoqCisgKiBjb3VudGVyX3N5c2ZzX2FkZCAtIEFkZHMg
Q291bnRlciBzeXNmcyBhdHRyaWJ1dGVzIHRvIHRoZSBkZXZpY2Ugc3RydWN0dXJlCisgKiBAY291
bnRlcjoJUG9pbnRlciB0byB0aGUgQ291bnRlciBkZXZpY2Ugc3RydWN0dXJlCisgKgorICogQ291
bnRlciBzeXNmcyBhdHRyaWJ1dGVzIGFyZSBjcmVhdGVkIGFuZCBhZGRlZCB0byB0aGUgcmVzcGVj
dGl2ZSBkZXZpY2UKKyAqIHN0cnVjdHVyZSBmb3IgbGF0ZXIgcmVnaXN0cmF0aW9uIHRvIHRoZSBz
eXN0ZW0uIFJlc291cmNlLW1hbmFnZWQgbWVtb3J5CisgKiBhbGxvY2F0aW9uIGlzIHBlcmZvcm1l
ZCBieSB0aGlzIGZ1bmN0aW9uLCBhbmQgdGhpcyBtZW1vcnkgc2hvdWxkIGJlIGZyZWVkCisgKiB3
aGVuIG5vIGxvbmdlciBuZWVkZWQgKGF1dG9tYXRpY2FsbHkgYnkgYSBkZXZpY2VfdW5yZWdpc3Rl
ciBjYWxsLCBvcgorICogbWFudWFsbHkgYnkgYSBkZXZyZXNfcmVsZWFzZV9hbGwgY2FsbCkuCisg
Ki8KK2ludCBjb3VudGVyX3N5c2ZzX2FkZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvbnN0IGNv
dW50ZXIpCit7CisJc3RydWN0IGRldmljZSAqY29uc3QgZGV2ID0gJmNvdW50ZXItPmRldjsKKwlj
b25zdCBzaXplX3QgbnVtX2dyb3VwcyA9IGNvdW50ZXItPm51bV9zaWduYWxzICsgY291bnRlci0+
bnVtX2NvdW50cyArIDE7CisJc3RydWN0IGNvdW50ZXJfYXR0cmlidXRlX2dyb3VwICpncm91cHM7
CisJc2l6ZV90IGksIGo7CisJaW50IGVycjsKKwlzdHJ1Y3QgYXR0cmlidXRlX2dyb3VwICpncm91
cDsKKwlzdHJ1Y3QgY291bnRlcl9hdHRyaWJ1dGUgKnA7CisKKwkvKiBBbGxvY2F0ZSBzcGFjZSBm
b3IgYXR0cmlidXRlIGdyb3VwcyAoc2lnbmFscywgY291bnRzLCBhbmQgZXh0KSAqLworCWdyb3Vw
cyA9IGRldm1fa2NhbGxvYyhkZXYsIG51bV9ncm91cHMsIHNpemVvZigqZ3JvdXBzKSwgR0ZQX0tF
Uk5FTCk7CisJaWYgKCFncm91cHMpCisJCXJldHVybiAtRU5PTUVNOworCisJLyogSW5pdGlhbGl6
ZSBhdHRyaWJ1dGUgbGlzdHMgKi8KKwlmb3IgKGkgPSAwOyBpIDwgbnVtX2dyb3VwczsgaSsrKQor
CQlJTklUX0xJU1RfSEVBRCgmZ3JvdXBzW2ldLmF0dHJfbGlzdCk7CisKKwkvKiBBZGQgQ291bnRl
ciBkZXZpY2Ugc3lzZnMgYXR0cmlidXRlcyAqLworCWVyciA9IGNvdW50ZXJfc3lzZnNfYXR0cl9h
ZGQoY291bnRlciwgZ3JvdXBzKTsKKwlpZiAoZXJyIDwgMCkKKwkJcmV0dXJuIGVycjsKKworCS8q
IEFsbG9jYXRlIGF0dHJpYnV0ZSBncm91cHMgZm9yIGFzc29jaWF0aW9uIHdpdGggZGV2aWNlICov
CisJZGV2LT5ncm91cHMgPSBkZXZtX2tjYWxsb2MoZGV2LCBudW1fZ3JvdXBzICsgMSwgc2l6ZW9m
KCpkZXYtPmdyb3VwcyksCisJCQkJICAgR0ZQX0tFUk5FTCk7CisJaWYgKCFkZXYtPmdyb3VwcykK
KwkJcmV0dXJuIC1FTk9NRU07CisKKwkvKiBQcmVwYXJlIGVhY2ggZ3JvdXAgb2YgYXR0cmlidXRl
cyBmb3IgYXNzb2NpYXRpb24gKi8KKwlmb3IgKGkgPSAwOyBpIDwgbnVtX2dyb3VwczsgaSsrKSB7
CisJCS8qIEFsbG9jYXRlIHNwYWNlIGZvciBhdHRyaWJ1dGUgZ3JvdXAgKi8KKwkJZ3JvdXAgPSBk
ZXZtX2t6YWxsb2MoZGV2LCBzaXplb2YoKmdyb3VwKSwgR0ZQX0tFUk5FTCk7CisJCWlmICghZ3Jv
dXApCisJCQlyZXR1cm4gLUVOT01FTTsKKwkJZ3JvdXAtPm5hbWUgPSBncm91cHNbaV0ubmFtZTsK
KworCQkvKiBBbGxvY2F0ZSBzcGFjZSBmb3IgYXR0cmlidXRlIHBvaW50ZXJzICovCisJCWdyb3Vw
LT5hdHRycyA9IGRldm1fa2NhbGxvYyhkZXYsIGdyb3Vwc1tpXS5udW1fYXR0ciArIDEsCisJCQkJ
CSAgICBzaXplb2YoKmdyb3VwLT5hdHRycyksIEdGUF9LRVJORUwpOworCQlpZiAoIWdyb3VwLT5h
dHRycykKKwkJCXJldHVybiAtRU5PTUVNOworCisJCS8qIEFkZCBhdHRyaWJ1dGUgcG9pbnRlcnMg
dG8gYXR0cmlidXRlIGdyb3VwICovCisJCWogPSAwOworCQlsaXN0X2Zvcl9lYWNoX2VudHJ5KHAs
ICZncm91cHNbaV0uYXR0cl9saXN0LCBsKQorCQkJZ3JvdXAtPmF0dHJzW2orK10gPSAmcC0+ZGV2
X2F0dHIuYXR0cjsKKworCQkvKiBBc3NvY2lhdGUgYXR0cmlidXRlIGdyb3VwICovCisJCWRldi0+
Z3JvdXBzW2ldID0gZ3JvdXA7CisJfQorCisJcmV0dXJuIDA7Cit9CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2NvdW50ZXIvY291bnRlci1zeXNmcy5oIGIvZHJpdmVycy9jb3VudGVyL2NvdW50ZXItc3lz
ZnMuaApuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLjE0ZmU1NjZhY2Ew
ZQotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvY291bnRlci9jb3VudGVyLXN5c2ZzLmgKQEAg
LTAsMCArMSwxMyBAQAorLyogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAgKi8KKy8q
CisgKiBDb3VudGVyIHN5c2ZzIGludGVyZmFjZQorICogQ29weXJpZ2h0IChDKSAyMDIwIFdpbGxp
YW0gQnJlYXRoaXR0IEdyYXkKKyAqLworI2lmbmRlZiBfQ09VTlRFUl9TWVNGU19IXworI2RlZmlu
ZSBfQ09VTlRFUl9TWVNGU19IXworCisjaW5jbHVkZSA8bGludXgvY291bnRlci5oPgorCitpbnQg
Y291bnRlcl9zeXNmc19hZGQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb25zdCBjb3VudGVyKTsK
KworI2VuZGlmIC8qIF9DT1VOVEVSX1NZU0ZTX0hfICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2Nv
dW50ZXIvY291bnRlci5jIGIvZHJpdmVycy9jb3VudGVyL2NvdW50ZXIuYwpkZWxldGVkIGZpbGUg
bW9kZSAxMDA2NDQKaW5kZXggZGU5MjFlOGEzZjcyLi4wMDAwMDAwMDAwMDAKLS0tIGEvZHJpdmVy
cy9jb3VudGVyL2NvdW50ZXIuYworKysgL2Rldi9udWxsCkBAIC0xLDE0OTYgKzAsMCBAQAotLy8g
U1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAKLS8qCi0gKiBHZW5lcmljIENvdW50ZXIg
aW50ZXJmYWNlCi0gKiBDb3B5cmlnaHQgKEMpIDIwMTggV2lsbGlhbSBCcmVhdGhpdHQgR3JheQot
ICovCi0jaW5jbHVkZSA8bGludXgvY291bnRlci5oPgotI2luY2x1ZGUgPGxpbnV4L2RldmljZS5o
PgotI2luY2x1ZGUgPGxpbnV4L2Vyci5oPgotI2luY2x1ZGUgPGxpbnV4L2V4cG9ydC5oPgotI2lu
Y2x1ZGUgPGxpbnV4L2ZzLmg+Ci0jaW5jbHVkZSA8bGludXgvZ2ZwLmg+Ci0jaW5jbHVkZSA8bGlu
dXgvaWRyLmg+Ci0jaW5jbHVkZSA8bGludXgvaW5pdC5oPgotI2luY2x1ZGUgPGxpbnV4L2tlcm5l
bC5oPgotI2luY2x1ZGUgPGxpbnV4L2xpc3QuaD4KLSNpbmNsdWRlIDxsaW51eC9tb2R1bGUuaD4K
LSNpbmNsdWRlIDxsaW51eC9wcmludGsuaD4KLSNpbmNsdWRlIDxsaW51eC9zbGFiLmg+Ci0jaW5j
bHVkZSA8bGludXgvc3RyaW5nLmg+Ci0jaW5jbHVkZSA8bGludXgvc3lzZnMuaD4KLSNpbmNsdWRl
IDxsaW51eC90eXBlcy5oPgotCi1jb25zdCBjaGFyICpjb25zdCBjb3VudGVyX2NvdW50X2RpcmVj
dGlvbl9zdHJbMl0gPSB7Ci0JW0NPVU5URVJfQ09VTlRfRElSRUNUSU9OX0ZPUldBUkRdID0gImZv
cndhcmQiLAotCVtDT1VOVEVSX0NPVU5UX0RJUkVDVElPTl9CQUNLV0FSRF0gPSAiYmFja3dhcmQi
Ci19OwotRVhQT1JUX1NZTUJPTF9HUEwoY291bnRlcl9jb3VudF9kaXJlY3Rpb25fc3RyKTsKLQot
Y29uc3QgY2hhciAqY29uc3QgY291bnRlcl9jb3VudF9tb2RlX3N0cls0XSA9IHsKLQlbQ09VTlRF
Ul9DT1VOVF9NT0RFX05PUk1BTF0gPSAibm9ybWFsIiwKLQlbQ09VTlRFUl9DT1VOVF9NT0RFX1JB
TkdFX0xJTUlUXSA9ICJyYW5nZSBsaW1pdCIsCi0JW0NPVU5URVJfQ09VTlRfTU9ERV9OT05fUkVD
WUNMRV0gPSAibm9uLXJlY3ljbGUiLAotCVtDT1VOVEVSX0NPVU5UX01PREVfTU9EVUxPX05dID0g
Im1vZHVsby1uIgotfTsKLUVYUE9SVF9TWU1CT0xfR1BMKGNvdW50ZXJfY291bnRfbW9kZV9zdHIp
OwotCi1zc2l6ZV90IGNvdW50ZXJfc2lnbmFsX2VudW1fcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZp
Y2UgKmNvdW50ZXIsCi0JCQkJIHN0cnVjdCBjb3VudGVyX3NpZ25hbCAqc2lnbmFsLCB2b2lkICpw
cml2LAotCQkJCSBjaGFyICpidWYpCi17Ci0JY29uc3Qgc3RydWN0IGNvdW50ZXJfc2lnbmFsX2Vu
dW1fZXh0ICpjb25zdCBlID0gcHJpdjsKLQlpbnQgZXJyOwotCXNpemVfdCBpbmRleDsKLQotCWlm
ICghZS0+Z2V0KQotCQlyZXR1cm4gLUVJTlZBTDsKLQotCWVyciA9IGUtPmdldChjb3VudGVyLCBz
aWduYWwsICZpbmRleCk7Ci0JaWYgKGVycikKLQkJcmV0dXJuIGVycjsKLQotCWlmIChpbmRleCA+
PSBlLT5udW1faXRlbXMpCi0JCXJldHVybiAtRUlOVkFMOwotCi0JcmV0dXJuIHNwcmludGYoYnVm
LCAiJXNcbiIsIGUtPml0ZW1zW2luZGV4XSk7Ci19Ci1FWFBPUlRfU1lNQk9MX0dQTChjb3VudGVy
X3NpZ25hbF9lbnVtX3JlYWQpOwotCi1zc2l6ZV90IGNvdW50ZXJfc2lnbmFsX2VudW1fd3JpdGUo
c3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCSAgc3RydWN0IGNvdW50ZXJfc2ln
bmFsICpzaWduYWwsIHZvaWQgKnByaXYsCi0JCQkJICBjb25zdCBjaGFyICpidWYsIHNpemVfdCBs
ZW4pCi17Ci0JY29uc3Qgc3RydWN0IGNvdW50ZXJfc2lnbmFsX2VudW1fZXh0ICpjb25zdCBlID0g
cHJpdjsKLQlzc2l6ZV90IGluZGV4OwotCWludCBlcnI7Ci0KLQlpZiAoIWUtPnNldCkKLQkJcmV0
dXJuIC1FSU5WQUw7Ci0KLQlpbmRleCA9IF9fc3lzZnNfbWF0Y2hfc3RyaW5nKGUtPml0ZW1zLCBl
LT5udW1faXRlbXMsIGJ1Zik7Ci0JaWYgKGluZGV4IDwgMCkKLQkJcmV0dXJuIGluZGV4OwotCi0J
ZXJyID0gZS0+c2V0KGNvdW50ZXIsIHNpZ25hbCwgaW5kZXgpOwotCWlmIChlcnIpCi0JCXJldHVy
biBlcnI7Ci0KLQlyZXR1cm4gbGVuOwotfQotRVhQT1JUX1NZTUJPTF9HUEwoY291bnRlcl9zaWdu
YWxfZW51bV93cml0ZSk7Ci0KLXNzaXplX3QgY291bnRlcl9zaWduYWxfZW51bV9hdmFpbGFibGVf
cmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkJCSAgIHN0cnVjdCBjb3Vu
dGVyX3NpZ25hbCAqc2lnbmFsLAotCQkJCQkgICB2b2lkICpwcml2LCBjaGFyICpidWYpCi17Ci0J
Y29uc3Qgc3RydWN0IGNvdW50ZXJfc2lnbmFsX2VudW1fZXh0ICpjb25zdCBlID0gcHJpdjsKLQlz
aXplX3QgaTsKLQlzaXplX3QgbGVuID0gMDsKLQotCWlmICghZS0+bnVtX2l0ZW1zKQotCQlyZXR1
cm4gMDsKLQotCWZvciAoaSA9IDA7IGkgPCBlLT5udW1faXRlbXM7IGkrKykKLQkJbGVuICs9IHNw
cmludGYoYnVmICsgbGVuLCAiJXNcbiIsIGUtPml0ZW1zW2ldKTsKLQotCXJldHVybiBsZW47Ci19
Ci1FWFBPUlRfU1lNQk9MX0dQTChjb3VudGVyX3NpZ25hbF9lbnVtX2F2YWlsYWJsZV9yZWFkKTsK
LQotc3NpemVfdCBjb3VudGVyX2NvdW50X2VudW1fcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2Ug
KmNvdW50ZXIsCi0JCQkJc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB2b2lkICpwcml2LAot
CQkJCWNoYXIgKmJ1ZikKLXsKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9jb3VudF9lbnVtX2V4dCAq
Y29uc3QgZSA9IHByaXY7Ci0JaW50IGVycjsKLQlzaXplX3QgaW5kZXg7Ci0KLQlpZiAoIWUtPmdl
dCkKLQkJcmV0dXJuIC1FSU5WQUw7Ci0KLQllcnIgPSBlLT5nZXQoY291bnRlciwgY291bnQsICZp
bmRleCk7Ci0JaWYgKGVycikKLQkJcmV0dXJuIGVycjsKLQotCWlmIChpbmRleCA+PSBlLT5udW1f
aXRlbXMpCi0JCXJldHVybiAtRUlOVkFMOwotCi0JcmV0dXJuIHNwcmludGYoYnVmLCAiJXNcbiIs
IGUtPml0ZW1zW2luZGV4XSk7Ci19Ci1FWFBPUlRfU1lNQk9MX0dQTChjb3VudGVyX2NvdW50X2Vu
dW1fcmVhZCk7Ci0KLXNzaXplX3QgY291bnRlcl9jb3VudF9lbnVtX3dyaXRlKHN0cnVjdCBjb3Vu
dGVyX2RldmljZSAqY291bnRlciwKLQkJCQkgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB2
b2lkICpwcml2LAotCQkJCSBjb25zdCBjaGFyICpidWYsIHNpemVfdCBsZW4pCi17Ci0JY29uc3Qg
c3RydWN0IGNvdW50ZXJfY291bnRfZW51bV9leHQgKmNvbnN0IGUgPSBwcml2OwotCXNzaXplX3Qg
aW5kZXg7Ci0JaW50IGVycjsKLQotCWlmICghZS0+c2V0KQotCQlyZXR1cm4gLUVJTlZBTDsKLQot
CWluZGV4ID0gX19zeXNmc19tYXRjaF9zdHJpbmcoZS0+aXRlbXMsIGUtPm51bV9pdGVtcywgYnVm
KTsKLQlpZiAoaW5kZXggPCAwKQotCQlyZXR1cm4gaW5kZXg7Ci0KLQllcnIgPSBlLT5zZXQoY291
bnRlciwgY291bnQsIGluZGV4KTsKLQlpZiAoZXJyKQotCQlyZXR1cm4gZXJyOwotCi0JcmV0dXJu
IGxlbjsKLX0KLUVYUE9SVF9TWU1CT0xfR1BMKGNvdW50ZXJfY291bnRfZW51bV93cml0ZSk7Ci0K
LXNzaXplX3QgY291bnRlcl9jb3VudF9lbnVtX2F2YWlsYWJsZV9yZWFkKHN0cnVjdCBjb3VudGVy
X2RldmljZSAqY291bnRlciwKLQkJCQkJICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCi0J
CQkJCSAgdm9pZCAqcHJpdiwgY2hhciAqYnVmKQotewotCWNvbnN0IHN0cnVjdCBjb3VudGVyX2Nv
dW50X2VudW1fZXh0ICpjb25zdCBlID0gcHJpdjsKLQlzaXplX3QgaTsKLQlzaXplX3QgbGVuID0g
MDsKLQotCWlmICghZS0+bnVtX2l0ZW1zKQotCQlyZXR1cm4gMDsKLQotCWZvciAoaSA9IDA7IGkg
PCBlLT5udW1faXRlbXM7IGkrKykKLQkJbGVuICs9IHNwcmludGYoYnVmICsgbGVuLCAiJXNcbiIs
IGUtPml0ZW1zW2ldKTsKLQotCXJldHVybiBsZW47Ci19Ci1FWFBPUlRfU1lNQk9MX0dQTChjb3Vu
dGVyX2NvdW50X2VudW1fYXZhaWxhYmxlX3JlYWQpOwotCi1zc2l6ZV90IGNvdW50ZXJfZGV2aWNl
X2VudW1fcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsIHZvaWQgKnByaXYsCi0J
CQkJIGNoYXIgKmJ1ZikKLXsKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9kZXZpY2VfZW51bV9leHQg
KmNvbnN0IGUgPSBwcml2OwotCWludCBlcnI7Ci0Jc2l6ZV90IGluZGV4OwotCi0JaWYgKCFlLT5n
ZXQpCi0JCXJldHVybiAtRUlOVkFMOwotCi0JZXJyID0gZS0+Z2V0KGNvdW50ZXIsICZpbmRleCk7
Ci0JaWYgKGVycikKLQkJcmV0dXJuIGVycjsKLQotCWlmIChpbmRleCA+PSBlLT5udW1faXRlbXMp
Ci0JCXJldHVybiAtRUlOVkFMOwotCi0JcmV0dXJuIHNwcmludGYoYnVmLCAiJXNcbiIsIGUtPml0
ZW1zW2luZGV4XSk7Ci19Ci1FWFBPUlRfU1lNQk9MX0dQTChjb3VudGVyX2RldmljZV9lbnVtX3Jl
YWQpOwotCi1zc2l6ZV90IGNvdW50ZXJfZGV2aWNlX2VudW1fd3JpdGUoc3RydWN0IGNvdW50ZXJf
ZGV2aWNlICpjb3VudGVyLCB2b2lkICpwcml2LAotCQkJCSAgY29uc3QgY2hhciAqYnVmLCBzaXpl
X3QgbGVuKQotewotCWNvbnN0IHN0cnVjdCBjb3VudGVyX2RldmljZV9lbnVtX2V4dCAqY29uc3Qg
ZSA9IHByaXY7Ci0Jc3NpemVfdCBpbmRleDsKLQlpbnQgZXJyOwotCi0JaWYgKCFlLT5zZXQpCi0J
CXJldHVybiAtRUlOVkFMOwotCi0JaW5kZXggPSBfX3N5c2ZzX21hdGNoX3N0cmluZyhlLT5pdGVt
cywgZS0+bnVtX2l0ZW1zLCBidWYpOwotCWlmIChpbmRleCA8IDApCi0JCXJldHVybiBpbmRleDsK
LQotCWVyciA9IGUtPnNldChjb3VudGVyLCBpbmRleCk7Ci0JaWYgKGVycikKLQkJcmV0dXJuIGVy
cjsKLQotCXJldHVybiBsZW47Ci19Ci1FWFBPUlRfU1lNQk9MX0dQTChjb3VudGVyX2RldmljZV9l
bnVtX3dyaXRlKTsKLQotc3NpemVfdCBjb3VudGVyX2RldmljZV9lbnVtX2F2YWlsYWJsZV9yZWFk
KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQkJICAgdm9pZCAqcHJpdiwgY2hh
ciAqYnVmKQotewotCWNvbnN0IHN0cnVjdCBjb3VudGVyX2RldmljZV9lbnVtX2V4dCAqY29uc3Qg
ZSA9IHByaXY7Ci0Jc2l6ZV90IGk7Ci0Jc2l6ZV90IGxlbiA9IDA7Ci0KLQlpZiAoIWUtPm51bV9p
dGVtcykKLQkJcmV0dXJuIDA7Ci0KLQlmb3IgKGkgPSAwOyBpIDwgZS0+bnVtX2l0ZW1zOyBpKysp
Ci0JCWxlbiArPSBzcHJpbnRmKGJ1ZiArIGxlbiwgIiVzXG4iLCBlLT5pdGVtc1tpXSk7Ci0KLQly
ZXR1cm4gbGVuOwotfQotRVhQT1JUX1NZTUJPTF9HUEwoY291bnRlcl9kZXZpY2VfZW51bV9hdmFp
bGFibGVfcmVhZCk7Ci0KLXN0cnVjdCBjb3VudGVyX2F0dHJfcGFybSB7Ci0Jc3RydWN0IGNvdW50
ZXJfZGV2aWNlX2F0dHJfZ3JvdXAgKmdyb3VwOwotCWNvbnN0IGNoYXIgKnByZWZpeDsKLQljb25z
dCBjaGFyICpuYW1lOwotCXNzaXplX3QgKCpzaG93KShzdHJ1Y3QgZGV2aWNlICpkZXYsIHN0cnVj
dCBkZXZpY2VfYXR0cmlidXRlICphdHRyLAotCQkJY2hhciAqYnVmKTsKLQlzc2l6ZV90ICgqc3Rv
cmUpKHN0cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIsCi0J
CQkgY29uc3QgY2hhciAqYnVmLCBzaXplX3QgbGVuKTsKLQl2b2lkICpjb21wb25lbnQ7Ci19Owot
Ci1zdHJ1Y3QgY291bnRlcl9kZXZpY2VfYXR0ciB7Ci0Jc3RydWN0IGRldmljZV9hdHRyaWJ1dGUg
ZGV2X2F0dHI7Ci0Jc3RydWN0IGxpc3RfaGVhZCBsOwotCXZvaWQgKmNvbXBvbmVudDsKLX07Ci0K
LXN0YXRpYyBpbnQgY291bnRlcl9hdHRyaWJ1dGVfY3JlYXRlKGNvbnN0IHN0cnVjdCBjb3VudGVy
X2F0dHJfcGFybSAqY29uc3QgcGFybSkKLXsKLQlzdHJ1Y3QgY291bnRlcl9kZXZpY2VfYXR0ciAq
Y291bnRlcl9hdHRyOwotCXN0cnVjdCBkZXZpY2VfYXR0cmlidXRlICpkZXZfYXR0cjsKLQlpbnQg
ZXJyOwotCXN0cnVjdCBsaXN0X2hlYWQgKmNvbnN0IGF0dHJfbGlzdCA9ICZwYXJtLT5ncm91cC0+
YXR0cl9saXN0OwotCi0JLyogQWxsb2NhdGUgYSBDb3VudGVyIGRldmljZSBhdHRyaWJ1dGUgKi8K
LQljb3VudGVyX2F0dHIgPSBremFsbG9jKHNpemVvZigqY291bnRlcl9hdHRyKSwgR0ZQX0tFUk5F
TCk7Ci0JaWYgKCFjb3VudGVyX2F0dHIpCi0JCXJldHVybiAtRU5PTUVNOwotCWRldl9hdHRyID0g
JmNvdW50ZXJfYXR0ci0+ZGV2X2F0dHI7Ci0KLQlzeXNmc19hdHRyX2luaXQoJmRldl9hdHRyLT5h
dHRyKTsKLQotCS8qIENvbmZpZ3VyZSBkZXZpY2UgYXR0cmlidXRlICovCi0JZGV2X2F0dHItPmF0
dHIubmFtZSA9IGthc3ByaW50ZihHRlBfS0VSTkVMLCAiJXMlcyIsIHBhcm0tPnByZWZpeCwKLQkJ
CQkJcGFybS0+bmFtZSk7Ci0JaWYgKCFkZXZfYXR0ci0+YXR0ci5uYW1lKSB7Ci0JCWVyciA9IC1F
Tk9NRU07Ci0JCWdvdG8gZXJyX2ZyZWVfY291bnRlcl9hdHRyOwotCX0KLQlpZiAocGFybS0+c2hv
dykgewotCQlkZXZfYXR0ci0+YXR0ci5tb2RlIHw9IDA0NDQ7Ci0JCWRldl9hdHRyLT5zaG93ID0g
cGFybS0+c2hvdzsKLQl9Ci0JaWYgKHBhcm0tPnN0b3JlKSB7Ci0JCWRldl9hdHRyLT5hdHRyLm1v
ZGUgfD0gMDIwMDsKLQkJZGV2X2F0dHItPnN0b3JlID0gcGFybS0+c3RvcmU7Ci0JfQotCi0JLyog
U3RvcmUgYXNzb2NpYXRlZCBDb3VudGVyIGNvbXBvbmVudCB3aXRoIGF0dHJpYnV0ZSAqLwotCWNv
dW50ZXJfYXR0ci0+Y29tcG9uZW50ID0gcGFybS0+Y29tcG9uZW50OwotCi0JLyogS2VlcCB0cmFj
ayBvZiB0aGUgYXR0cmlidXRlIGZvciBsYXRlciBjbGVhbnVwICovCi0JbGlzdF9hZGQoJmNvdW50
ZXJfYXR0ci0+bCwgYXR0cl9saXN0KTsKLQlwYXJtLT5ncm91cC0+bnVtX2F0dHIrKzsKLQotCXJl
dHVybiAwOwotCi1lcnJfZnJlZV9jb3VudGVyX2F0dHI6Ci0Ja2ZyZWUoY291bnRlcl9hdHRyKTsK
LQlyZXR1cm4gZXJyOwotfQotCi0jZGVmaW5lIHRvX2NvdW50ZXJfYXR0cihfZGV2X2F0dHIpIFwK
LQljb250YWluZXJfb2YoX2Rldl9hdHRyLCBzdHJ1Y3QgY291bnRlcl9kZXZpY2VfYXR0ciwgZGV2
X2F0dHIpCi0KLXN0cnVjdCBjb3VudGVyX3NpZ25hbF91bml0IHsKLQlzdHJ1Y3QgY291bnRlcl9z
aWduYWwgKnNpZ25hbDsKLX07Ci0KLXN0YXRpYyBjb25zdCBjaGFyICpjb25zdCBjb3VudGVyX3Np
Z25hbF9sZXZlbF9zdHJbXSA9IHsKLQlbQ09VTlRFUl9TSUdOQUxfTEVWRUxfTE9XXSA9ICJsb3ci
LAotCVtDT1VOVEVSX1NJR05BTF9MRVZFTF9ISUdIXSA9ICJoaWdoIgotfTsKLQotc3RhdGljIHNz
aXplX3QgY291bnRlcl9zaWduYWxfc2hvdyhzdHJ1Y3QgZGV2aWNlICpkZXYsCi0JCQkJICAgc3Ry
dWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIsIGNoYXIgKmJ1ZikKLXsKLQlzdHJ1Y3QgY291bnRl
cl9kZXZpY2UgKmNvbnN0IGNvdW50ZXIgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsKLQljb25zdCBz
dHJ1Y3QgY291bnRlcl9kZXZpY2VfYXR0ciAqY29uc3QgZGV2YXR0ciA9IHRvX2NvdW50ZXJfYXR0
cihhdHRyKTsKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9zaWduYWxfdW5pdCAqY29uc3QgY29tcG9u
ZW50ID0gZGV2YXR0ci0+Y29tcG9uZW50OwotCXN0cnVjdCBjb3VudGVyX3NpZ25hbCAqY29uc3Qg
c2lnbmFsID0gY29tcG9uZW50LT5zaWduYWw7Ci0JaW50IGVycjsKLQllbnVtIGNvdW50ZXJfc2ln
bmFsX2xldmVsIGxldmVsOwotCi0JZXJyID0gY291bnRlci0+b3BzLT5zaWduYWxfcmVhZChjb3Vu
dGVyLCBzaWduYWwsICZsZXZlbCk7Ci0JaWYgKGVycikKLQkJcmV0dXJuIGVycjsKLQotCXJldHVy
biBzcHJpbnRmKGJ1ZiwgIiVzXG4iLCBjb3VudGVyX3NpZ25hbF9sZXZlbF9zdHJbbGV2ZWxdKTsK
LX0KLQotc3RydWN0IGNvdW50ZXJfbmFtZV91bml0IHsKLQljb25zdCBjaGFyICpuYW1lOwotfTsK
LQotc3RhdGljIHNzaXplX3QgY291bnRlcl9kZXZpY2VfYXR0cl9uYW1lX3Nob3coc3RydWN0IGRl
dmljZSAqZGV2LAotCQkJCQkgICAgIHN0cnVjdCBkZXZpY2VfYXR0cmlidXRlICphdHRyLAotCQkJ
CQkgICAgIGNoYXIgKmJ1ZikKLXsKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9uYW1lX3VuaXQgKmNv
bnN0IGNvbXAgPSB0b19jb3VudGVyX2F0dHIoYXR0ciktPmNvbXBvbmVudDsKLQotCXJldHVybiBz
cHJpbnRmKGJ1ZiwgIiVzXG4iLCBjb21wLT5uYW1lKTsKLX0KLQotc3RhdGljIGludCBjb3VudGVy
X25hbWVfYXR0cmlidXRlX2NyZWF0ZSgKLQlzdHJ1Y3QgY291bnRlcl9kZXZpY2VfYXR0cl9ncm91
cCAqY29uc3QgZ3JvdXAsCi0JY29uc3QgY2hhciAqY29uc3QgbmFtZSkKLXsKLQlzdHJ1Y3QgY291
bnRlcl9uYW1lX3VuaXQgKm5hbWVfY29tcDsKLQlzdHJ1Y3QgY291bnRlcl9hdHRyX3Bhcm0gcGFy
bTsKLQlpbnQgZXJyOwotCi0JLyogU2tpcCBpZiBubyBuYW1lICovCi0JaWYgKCFuYW1lKQotCQly
ZXR1cm4gMDsKLQotCS8qIEFsbG9jYXRlIG5hbWUgYXR0cmlidXRlIGNvbXBvbmVudCAqLwotCW5h
bWVfY29tcCA9IGttYWxsb2Moc2l6ZW9mKCpuYW1lX2NvbXApLCBHRlBfS0VSTkVMKTsKLQlpZiAo
IW5hbWVfY29tcCkKLQkJcmV0dXJuIC1FTk9NRU07Ci0JbmFtZV9jb21wLT5uYW1lID0gbmFtZTsK
LQotCS8qIEFsbG9jYXRlIFNpZ25hbCBuYW1lIGF0dHJpYnV0ZSAqLwotCXBhcm0uZ3JvdXAgPSBn
cm91cDsKLQlwYXJtLnByZWZpeCA9ICIiOwotCXBhcm0ubmFtZSA9ICJuYW1lIjsKLQlwYXJtLnNo
b3cgPSBjb3VudGVyX2RldmljZV9hdHRyX25hbWVfc2hvdzsKLQlwYXJtLnN0b3JlID0gTlVMTDsK
LQlwYXJtLmNvbXBvbmVudCA9IG5hbWVfY29tcDsKLQllcnIgPSBjb3VudGVyX2F0dHJpYnV0ZV9j
cmVhdGUoJnBhcm0pOwotCWlmIChlcnIpCi0JCWdvdG8gZXJyX2ZyZWVfbmFtZV9jb21wOwotCi0J
cmV0dXJuIDA7Ci0KLWVycl9mcmVlX25hbWVfY29tcDoKLQlrZnJlZShuYW1lX2NvbXApOwotCXJl
dHVybiBlcnI7Ci19Ci0KLXN0cnVjdCBjb3VudGVyX3NpZ25hbF9leHRfdW5pdCB7Ci0Jc3RydWN0
IGNvdW50ZXJfc2lnbmFsICpzaWduYWw7Ci0JY29uc3Qgc3RydWN0IGNvdW50ZXJfc2lnbmFsX2V4
dCAqZXh0OwotfTsKLQotc3RhdGljIHNzaXplX3QgY291bnRlcl9zaWduYWxfZXh0X3Nob3coc3Ry
dWN0IGRldmljZSAqZGV2LAotCQkJCSAgICAgICBzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSAqYXR0
ciwgY2hhciAqYnVmKQotewotCWNvbnN0IHN0cnVjdCBjb3VudGVyX2RldmljZV9hdHRyICpjb25z
dCBkZXZhdHRyID0gdG9fY291bnRlcl9hdHRyKGF0dHIpOwotCWNvbnN0IHN0cnVjdCBjb3VudGVy
X3NpZ25hbF9leHRfdW5pdCAqY29uc3QgY29tcCA9IGRldmF0dHItPmNvbXBvbmVudDsKLQljb25z
dCBzdHJ1Y3QgY291bnRlcl9zaWduYWxfZXh0ICpjb25zdCBleHQgPSBjb21wLT5leHQ7Ci0KLQly
ZXR1cm4gZXh0LT5yZWFkKGRldl9nZXRfZHJ2ZGF0YShkZXYpLCBjb21wLT5zaWduYWwsIGV4dC0+
cHJpdiwgYnVmKTsKLX0KLQotc3RhdGljIHNzaXplX3QgY291bnRlcl9zaWduYWxfZXh0X3N0b3Jl
KHN0cnVjdCBkZXZpY2UgKmRldiwKLQkJCQkJc3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIs
Ci0JCQkJCWNvbnN0IGNoYXIgKmJ1Ziwgc2l6ZV90IGxlbikKLXsKLQljb25zdCBzdHJ1Y3QgY291
bnRlcl9kZXZpY2VfYXR0ciAqY29uc3QgZGV2YXR0ciA9IHRvX2NvdW50ZXJfYXR0cihhdHRyKTsK
LQljb25zdCBzdHJ1Y3QgY291bnRlcl9zaWduYWxfZXh0X3VuaXQgKmNvbnN0IGNvbXAgPSBkZXZh
dHRyLT5jb21wb25lbnQ7Ci0JY29uc3Qgc3RydWN0IGNvdW50ZXJfc2lnbmFsX2V4dCAqY29uc3Qg
ZXh0ID0gY29tcC0+ZXh0OwotCi0JcmV0dXJuIGV4dC0+d3JpdGUoZGV2X2dldF9kcnZkYXRhKGRl
diksIGNvbXAtPnNpZ25hbCwgZXh0LT5wcml2LCBidWYsCi0JCWxlbik7Ci19Ci0KLXN0YXRpYyB2
b2lkIGNvdW50ZXJfZGV2aWNlX2F0dHJfbGlzdF9mcmVlKHN0cnVjdCBsaXN0X2hlYWQgKmF0dHJf
bGlzdCkKLXsKLQlzdHJ1Y3QgY291bnRlcl9kZXZpY2VfYXR0ciAqcCwgKm47Ci0KLQlsaXN0X2Zv
cl9lYWNoX2VudHJ5X3NhZmUocCwgbiwgYXR0cl9saXN0LCBsKSB7Ci0JCS8qIGZyZWUgYXR0cmli
dXRlIG5hbWUgYW5kIGFzc29jaWF0ZWQgY29tcG9uZW50IG1lbW9yeSAqLwotCQlrZnJlZShwLT5k
ZXZfYXR0ci5hdHRyLm5hbWUpOwotCQlrZnJlZShwLT5jb21wb25lbnQpOwotCQlsaXN0X2RlbCgm
cC0+bCk7Ci0JCWtmcmVlKHApOwotCX0KLX0KLQotc3RhdGljIGludCBjb3VudGVyX3NpZ25hbF9l
eHRfcmVnaXN0ZXIoCi0Jc3RydWN0IGNvdW50ZXJfZGV2aWNlX2F0dHJfZ3JvdXAgKmNvbnN0IGdy
b3VwLAotCXN0cnVjdCBjb3VudGVyX3NpZ25hbCAqY29uc3Qgc2lnbmFsKQotewotCWNvbnN0IHNp
emVfdCBudW1fZXh0ID0gc2lnbmFsLT5udW1fZXh0OwotCXNpemVfdCBpOwotCWNvbnN0IHN0cnVj
dCBjb3VudGVyX3NpZ25hbF9leHQgKmV4dDsKLQlzdHJ1Y3QgY291bnRlcl9zaWduYWxfZXh0X3Vu
aXQgKnNpZ25hbF9leHRfY29tcDsKLQlzdHJ1Y3QgY291bnRlcl9hdHRyX3Bhcm0gcGFybTsKLQlp
bnQgZXJyOwotCi0JLyogQ3JlYXRlIGFuIGF0dHJpYnV0ZSBmb3IgZWFjaCBleHRlbnNpb24gKi8K
LQlmb3IgKGkgPSAwIDsgaSA8IG51bV9leHQ7IGkrKykgewotCQlleHQgPSBzaWduYWwtPmV4dCAr
IGk7Ci0KLQkJLyogQWxsb2NhdGUgc2lnbmFsX2V4dCBhdHRyaWJ1dGUgY29tcG9uZW50ICovCi0J
CXNpZ25hbF9leHRfY29tcCA9IGttYWxsb2Moc2l6ZW9mKCpzaWduYWxfZXh0X2NvbXApLCBHRlBf
S0VSTkVMKTsKLQkJaWYgKCFzaWduYWxfZXh0X2NvbXApIHsKLQkJCWVyciA9IC1FTk9NRU07Ci0J
CQlnb3RvIGVycl9mcmVlX2F0dHJfbGlzdDsKLQkJfQotCQlzaWduYWxfZXh0X2NvbXAtPnNpZ25h
bCA9IHNpZ25hbDsKLQkJc2lnbmFsX2V4dF9jb21wLT5leHQgPSBleHQ7Ci0KLQkJLyogQWxsb2Nh
dGUgYSBDb3VudGVyIGRldmljZSBhdHRyaWJ1dGUgKi8KLQkJcGFybS5ncm91cCA9IGdyb3VwOwot
CQlwYXJtLnByZWZpeCA9ICIiOwotCQlwYXJtLm5hbWUgPSBleHQtPm5hbWU7Ci0JCXBhcm0uc2hv
dyA9IChleHQtPnJlYWQpID8gY291bnRlcl9zaWduYWxfZXh0X3Nob3cgOiBOVUxMOwotCQlwYXJt
LnN0b3JlID0gKGV4dC0+d3JpdGUpID8gY291bnRlcl9zaWduYWxfZXh0X3N0b3JlIDogTlVMTDsK
LQkJcGFybS5jb21wb25lbnQgPSBzaWduYWxfZXh0X2NvbXA7Ci0JCWVyciA9IGNvdW50ZXJfYXR0
cmlidXRlX2NyZWF0ZSgmcGFybSk7Ci0JCWlmIChlcnIpIHsKLQkJCWtmcmVlKHNpZ25hbF9leHRf
Y29tcCk7Ci0JCQlnb3RvIGVycl9mcmVlX2F0dHJfbGlzdDsKLQkJfQotCX0KLQotCXJldHVybiAw
OwotCi1lcnJfZnJlZV9hdHRyX2xpc3Q6Ci0JY291bnRlcl9kZXZpY2VfYXR0cl9saXN0X2ZyZWUo
Jmdyb3VwLT5hdHRyX2xpc3QpOwotCXJldHVybiBlcnI7Ci19Ci0KLXN0YXRpYyBpbnQgY291bnRl
cl9zaWduYWxfYXR0cmlidXRlc19jcmVhdGUoCi0Jc3RydWN0IGNvdW50ZXJfZGV2aWNlX2F0dHJf
Z3JvdXAgKmNvbnN0IGdyb3VwLAotCWNvbnN0IHN0cnVjdCBjb3VudGVyX2RldmljZSAqY29uc3Qg
Y291bnRlciwKLQlzdHJ1Y3QgY291bnRlcl9zaWduYWwgKmNvbnN0IHNpZ25hbCkKLXsKLQlzdHJ1
Y3QgY291bnRlcl9zaWduYWxfdW5pdCAqc2lnbmFsX2NvbXA7Ci0Jc3RydWN0IGNvdW50ZXJfYXR0
cl9wYXJtIHBhcm07Ci0JaW50IGVycjsKLQotCS8qIEFsbG9jYXRlIFNpZ25hbCBhdHRyaWJ1dGUg
Y29tcG9uZW50ICovCi0Jc2lnbmFsX2NvbXAgPSBrbWFsbG9jKHNpemVvZigqc2lnbmFsX2NvbXAp
LCBHRlBfS0VSTkVMKTsKLQlpZiAoIXNpZ25hbF9jb21wKQotCQlyZXR1cm4gLUVOT01FTTsKLQlz
aWduYWxfY29tcC0+c2lnbmFsID0gc2lnbmFsOwotCi0JLyogQ3JlYXRlIG1haW4gU2lnbmFsIGF0
dHJpYnV0ZSAqLwotCXBhcm0uZ3JvdXAgPSBncm91cDsKLQlwYXJtLnByZWZpeCA9ICIiOwotCXBh
cm0ubmFtZSA9ICJzaWduYWwiOwotCXBhcm0uc2hvdyA9IChjb3VudGVyLT5vcHMtPnNpZ25hbF9y
ZWFkKSA/IGNvdW50ZXJfc2lnbmFsX3Nob3cgOiBOVUxMOwotCXBhcm0uc3RvcmUgPSBOVUxMOwot
CXBhcm0uY29tcG9uZW50ID0gc2lnbmFsX2NvbXA7Ci0JZXJyID0gY291bnRlcl9hdHRyaWJ1dGVf
Y3JlYXRlKCZwYXJtKTsKLQlpZiAoZXJyKSB7Ci0JCWtmcmVlKHNpZ25hbF9jb21wKTsKLQkJcmV0
dXJuIGVycjsKLQl9Ci0KLQkvKiBDcmVhdGUgU2lnbmFsIG5hbWUgYXR0cmlidXRlICovCi0JZXJy
ID0gY291bnRlcl9uYW1lX2F0dHJpYnV0ZV9jcmVhdGUoZ3JvdXAsIHNpZ25hbC0+bmFtZSk7Ci0J
aWYgKGVycikKLQkJZ290byBlcnJfZnJlZV9hdHRyX2xpc3Q7Ci0KLQkvKiBSZWdpc3RlciBTaWdu
YWwgZXh0ZW5zaW9uIGF0dHJpYnV0ZXMgKi8KLQllcnIgPSBjb3VudGVyX3NpZ25hbF9leHRfcmVn
aXN0ZXIoZ3JvdXAsIHNpZ25hbCk7Ci0JaWYgKGVycikKLQkJZ290byBlcnJfZnJlZV9hdHRyX2xp
c3Q7Ci0KLQlyZXR1cm4gMDsKLQotZXJyX2ZyZWVfYXR0cl9saXN0OgotCWNvdW50ZXJfZGV2aWNl
X2F0dHJfbGlzdF9mcmVlKCZncm91cC0+YXR0cl9saXN0KTsKLQlyZXR1cm4gZXJyOwotfQotCi1z
dGF0aWMgaW50IGNvdW50ZXJfc2lnbmFsc19yZWdpc3RlcigKLQlzdHJ1Y3QgY291bnRlcl9kZXZp
Y2VfYXR0cl9ncm91cCAqY29uc3QgZ3JvdXBzX2xpc3QsCi0JY29uc3Qgc3RydWN0IGNvdW50ZXJf
ZGV2aWNlICpjb25zdCBjb3VudGVyKQotewotCWNvbnN0IHNpemVfdCBudW1fc2lnbmFscyA9IGNv
dW50ZXItPm51bV9zaWduYWxzOwotCXNpemVfdCBpOwotCXN0cnVjdCBjb3VudGVyX3NpZ25hbCAq
c2lnbmFsOwotCWNvbnN0IGNoYXIgKm5hbWU7Ci0JaW50IGVycjsKLQotCS8qIFJlZ2lzdGVyIGVh
Y2ggU2lnbmFsICovCi0JZm9yIChpID0gMDsgaSA8IG51bV9zaWduYWxzOyBpKyspIHsKLQkJc2ln
bmFsID0gY291bnRlci0+c2lnbmFscyArIGk7Ci0KLQkJLyogR2VuZXJhdGUgU2lnbmFsIGF0dHJp
YnV0ZSBkaXJlY3RvcnkgbmFtZSAqLwotCQluYW1lID0ga2FzcHJpbnRmKEdGUF9LRVJORUwsICJz
aWduYWwlZCIsIHNpZ25hbC0+aWQpOwotCQlpZiAoIW5hbWUpIHsKLQkJCWVyciA9IC1FTk9NRU07
Ci0JCQlnb3RvIGVycl9mcmVlX2F0dHJfZ3JvdXBzOwotCQl9Ci0JCWdyb3Vwc19saXN0W2ldLmF0
dHJfZ3JvdXAubmFtZSA9IG5hbWU7Ci0KLQkJLyogQ3JlYXRlIGFsbCBhdHRyaWJ1dGVzIGFzc29j
aWF0ZWQgd2l0aCBTaWduYWwgKi8KLQkJZXJyID0gY291bnRlcl9zaWduYWxfYXR0cmlidXRlc19j
cmVhdGUoZ3JvdXBzX2xpc3QgKyBpLCBjb3VudGVyLAotCQkJCQkJICAgICAgIHNpZ25hbCk7Ci0J
CWlmIChlcnIpCi0JCQlnb3RvIGVycl9mcmVlX2F0dHJfZ3JvdXBzOwotCX0KLQotCXJldHVybiAw
OwotCi1lcnJfZnJlZV9hdHRyX2dyb3VwczoKLQlkbyB7Ci0JCWtmcmVlKGdyb3Vwc19saXN0W2ld
LmF0dHJfZ3JvdXAubmFtZSk7Ci0JCWNvdW50ZXJfZGV2aWNlX2F0dHJfbGlzdF9mcmVlKCZncm91
cHNfbGlzdFtpXS5hdHRyX2xpc3QpOwotCX0gd2hpbGUgKGktLSk7Ci0JcmV0dXJuIGVycjsKLX0K
LQotc3RhdGljIGNvbnN0IGNoYXIgKmNvbnN0IGNvdW50ZXJfc3luYXBzZV9hY3Rpb25fc3RyW10g
PSB7Ci0JW0NPVU5URVJfU1lOQVBTRV9BQ1RJT05fTk9ORV0gPSAibm9uZSIsCi0JW0NPVU5URVJf
U1lOQVBTRV9BQ1RJT05fUklTSU5HX0VER0VdID0gInJpc2luZyBlZGdlIiwKLQlbQ09VTlRFUl9T
WU5BUFNFX0FDVElPTl9GQUxMSU5HX0VER0VdID0gImZhbGxpbmcgZWRnZSIsCi0JW0NPVU5URVJf
U1lOQVBTRV9BQ1RJT05fQk9USF9FREdFU10gPSAiYm90aCBlZGdlcyIKLX07Ci0KLXN0cnVjdCBj
b3VudGVyX2FjdGlvbl91bml0IHsKLQlzdHJ1Y3QgY291bnRlcl9zeW5hcHNlICpzeW5hcHNlOwot
CXN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudDsKLX07Ci0KLXN0YXRpYyBzc2l6ZV90IGNvdW50
ZXJfYWN0aW9uX3Nob3coc3RydWN0IGRldmljZSAqZGV2LAotCQkJCSAgIHN0cnVjdCBkZXZpY2Vf
YXR0cmlidXRlICphdHRyLCBjaGFyICpidWYpCi17Ci0JY29uc3Qgc3RydWN0IGNvdW50ZXJfZGV2
aWNlX2F0dHIgKmNvbnN0IGRldmF0dHIgPSB0b19jb3VudGVyX2F0dHIoYXR0cik7Ci0JaW50IGVy
cjsKLQlzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvbnN0IGNvdW50ZXIgPSBkZXZfZ2V0X2RydmRh
dGEoZGV2KTsKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9hY3Rpb25fdW5pdCAqY29uc3QgY29tcG9u
ZW50ID0gZGV2YXR0ci0+Y29tcG9uZW50OwotCXN0cnVjdCBjb3VudGVyX2NvdW50ICpjb25zdCBj
b3VudCA9IGNvbXBvbmVudC0+Y291bnQ7Ci0Jc3RydWN0IGNvdW50ZXJfc3luYXBzZSAqY29uc3Qg
c3luYXBzZSA9IGNvbXBvbmVudC0+c3luYXBzZTsKLQlzaXplX3QgYWN0aW9uX2luZGV4OwotCWVu
dW0gY291bnRlcl9zeW5hcHNlX2FjdGlvbiBhY3Rpb247Ci0KLQllcnIgPSBjb3VudGVyLT5vcHMt
PmFjdGlvbl9nZXQoY291bnRlciwgY291bnQsIHN5bmFwc2UsICZhY3Rpb25faW5kZXgpOwotCWlm
IChlcnIpCi0JCXJldHVybiBlcnI7Ci0KLQlzeW5hcHNlLT5hY3Rpb24gPSBhY3Rpb25faW5kZXg7
Ci0KLQlhY3Rpb24gPSBzeW5hcHNlLT5hY3Rpb25zX2xpc3RbYWN0aW9uX2luZGV4XTsKLQlyZXR1
cm4gc3ByaW50ZihidWYsICIlc1xuIiwgY291bnRlcl9zeW5hcHNlX2FjdGlvbl9zdHJbYWN0aW9u
XSk7Ci19Ci0KLXN0YXRpYyBzc2l6ZV90IGNvdW50ZXJfYWN0aW9uX3N0b3JlKHN0cnVjdCBkZXZp
Y2UgKmRldiwKLQkJCQkgICAgc3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIsCi0JCQkJICAg
IGNvbnN0IGNoYXIgKmJ1Ziwgc2l6ZV90IGxlbikKLXsKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9k
ZXZpY2VfYXR0ciAqY29uc3QgZGV2YXR0ciA9IHRvX2NvdW50ZXJfYXR0cihhdHRyKTsKLQljb25z
dCBzdHJ1Y3QgY291bnRlcl9hY3Rpb25fdW5pdCAqY29uc3QgY29tcG9uZW50ID0gZGV2YXR0ci0+
Y29tcG9uZW50OwotCXN0cnVjdCBjb3VudGVyX3N5bmFwc2UgKmNvbnN0IHN5bmFwc2UgPSBjb21w
b25lbnQtPnN5bmFwc2U7Ci0Jc2l6ZV90IGFjdGlvbl9pbmRleDsKLQljb25zdCBzaXplX3QgbnVt
X2FjdGlvbnMgPSBzeW5hcHNlLT5udW1fYWN0aW9uczsKLQllbnVtIGNvdW50ZXJfc3luYXBzZV9h
Y3Rpb24gYWN0aW9uOwotCWludCBlcnI7Ci0Jc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb25zdCBj
b3VudGVyID0gZGV2X2dldF9kcnZkYXRhKGRldik7Ci0Jc3RydWN0IGNvdW50ZXJfY291bnQgKmNv
bnN0IGNvdW50ID0gY29tcG9uZW50LT5jb3VudDsKLQotCS8qIEZpbmQgcmVxdWVzdGVkIGFjdGlv
biBtb2RlICovCi0JZm9yIChhY3Rpb25faW5kZXggPSAwOyBhY3Rpb25faW5kZXggPCBudW1fYWN0
aW9uczsgYWN0aW9uX2luZGV4KyspIHsKLQkJYWN0aW9uID0gc3luYXBzZS0+YWN0aW9uc19saXN0
W2FjdGlvbl9pbmRleF07Ci0JCWlmIChzeXNmc19zdHJlcShidWYsIGNvdW50ZXJfc3luYXBzZV9h
Y3Rpb25fc3RyW2FjdGlvbl0pKQotCQkJYnJlYWs7Ci0JfQotCS8qIElmIHJlcXVlc3RlZCBhY3Rp
b24gbW9kZSBub3QgZm91bmQgKi8KLQlpZiAoYWN0aW9uX2luZGV4ID49IG51bV9hY3Rpb25zKQot
CQlyZXR1cm4gLUVJTlZBTDsKLQotCWVyciA9IGNvdW50ZXItPm9wcy0+YWN0aW9uX3NldChjb3Vu
dGVyLCBjb3VudCwgc3luYXBzZSwgYWN0aW9uX2luZGV4KTsKLQlpZiAoZXJyKQotCQlyZXR1cm4g
ZXJyOwotCi0Jc3luYXBzZS0+YWN0aW9uID0gYWN0aW9uX2luZGV4OwotCi0JcmV0dXJuIGxlbjsK
LX0KLQotc3RydWN0IGNvdW50ZXJfYWN0aW9uX2F2YWlsX3VuaXQgewotCWNvbnN0IGVudW0gY291
bnRlcl9zeW5hcHNlX2FjdGlvbiAqYWN0aW9uc19saXN0OwotCXNpemVfdCBudW1fYWN0aW9uczsK
LX07Ci0KLXN0YXRpYyBzc2l6ZV90IGNvdW50ZXJfc3luYXBzZV9hY3Rpb25fYXZhaWxhYmxlX3No
b3coc3RydWN0IGRldmljZSAqZGV2LAotCXN0cnVjdCBkZXZpY2VfYXR0cmlidXRlICphdHRyLCBj
aGFyICpidWYpCi17Ci0JY29uc3Qgc3RydWN0IGNvdW50ZXJfZGV2aWNlX2F0dHIgKmNvbnN0IGRl
dmF0dHIgPSB0b19jb3VudGVyX2F0dHIoYXR0cik7Ci0JY29uc3Qgc3RydWN0IGNvdW50ZXJfYWN0
aW9uX2F2YWlsX3VuaXQgKmNvbnN0IGNvbXBvbmVudCA9IGRldmF0dHItPmNvbXBvbmVudDsKLQlz
aXplX3QgaTsKLQllbnVtIGNvdW50ZXJfc3luYXBzZV9hY3Rpb24gYWN0aW9uOwotCXNzaXplX3Qg
bGVuID0gMDsKLQotCWZvciAoaSA9IDA7IGkgPCBjb21wb25lbnQtPm51bV9hY3Rpb25zOyBpKysp
IHsKLQkJYWN0aW9uID0gY29tcG9uZW50LT5hY3Rpb25zX2xpc3RbaV07Ci0JCWxlbiArPSBzcHJp
bnRmKGJ1ZiArIGxlbiwgIiVzXG4iLAotCQkJICAgICAgIGNvdW50ZXJfc3luYXBzZV9hY3Rpb25f
c3RyW2FjdGlvbl0pOwotCX0KLQotCXJldHVybiBsZW47Ci19Ci0KLXN0YXRpYyBpbnQgY291bnRl
cl9zeW5hcHNlc19yZWdpc3RlcigKLQlzdHJ1Y3QgY291bnRlcl9kZXZpY2VfYXR0cl9ncm91cCAq
Y29uc3QgZ3JvdXAsCi0JY29uc3Qgc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb25zdCBjb3VudGVy
LAotCXN0cnVjdCBjb3VudGVyX2NvdW50ICpjb25zdCBjb3VudCwgY29uc3QgY2hhciAqY29uc3Qg
Y291bnRfYXR0cl9uYW1lKQotewotCXNpemVfdCBpOwotCXN0cnVjdCBjb3VudGVyX3N5bmFwc2Ug
KnN5bmFwc2U7Ci0JY29uc3QgY2hhciAqcHJlZml4OwotCXN0cnVjdCBjb3VudGVyX2FjdGlvbl91
bml0ICphY3Rpb25fY29tcDsKLQlzdHJ1Y3QgY291bnRlcl9hdHRyX3Bhcm0gcGFybTsKLQlpbnQg
ZXJyOwotCXN0cnVjdCBjb3VudGVyX2FjdGlvbl9hdmFpbF91bml0ICphdmFpbF9jb21wOwotCi0J
LyogUmVnaXN0ZXIgZWFjaCBTeW5hcHNlICovCi0JZm9yIChpID0gMDsgaSA8IGNvdW50LT5udW1f
c3luYXBzZXM7IGkrKykgewotCQlzeW5hcHNlID0gY291bnQtPnN5bmFwc2VzICsgaTsKLQotCQkv
KiBHZW5lcmF0ZSBhdHRyaWJ1dGUgcHJlZml4ICovCi0JCXByZWZpeCA9IGthc3ByaW50ZihHRlBf
S0VSTkVMLCAic2lnbmFsJWRfIiwKLQkJCQkgICBzeW5hcHNlLT5zaWduYWwtPmlkKTsKLQkJaWYg
KCFwcmVmaXgpIHsKLQkJCWVyciA9IC1FTk9NRU07Ci0JCQlnb3RvIGVycl9mcmVlX2F0dHJfbGlz
dDsKLQkJfQotCi0JCS8qIEFsbG9jYXRlIGFjdGlvbiBhdHRyaWJ1dGUgY29tcG9uZW50ICovCi0J
CWFjdGlvbl9jb21wID0ga21hbGxvYyhzaXplb2YoKmFjdGlvbl9jb21wKSwgR0ZQX0tFUk5FTCk7
Ci0JCWlmICghYWN0aW9uX2NvbXApIHsKLQkJCWVyciA9IC1FTk9NRU07Ci0JCQlnb3RvIGVycl9m
cmVlX3ByZWZpeDsKLQkJfQotCQlhY3Rpb25fY29tcC0+c3luYXBzZSA9IHN5bmFwc2U7Ci0JCWFj
dGlvbl9jb21wLT5jb3VudCA9IGNvdW50OwotCi0JCS8qIENyZWF0ZSBhY3Rpb24gYXR0cmlidXRl
ICovCi0JCXBhcm0uZ3JvdXAgPSBncm91cDsKLQkJcGFybS5wcmVmaXggPSBwcmVmaXg7Ci0JCXBh
cm0ubmFtZSA9ICJhY3Rpb24iOwotCQlwYXJtLnNob3cgPSAoY291bnRlci0+b3BzLT5hY3Rpb25f
Z2V0KSA/IGNvdW50ZXJfYWN0aW9uX3Nob3cgOiBOVUxMOwotCQlwYXJtLnN0b3JlID0gKGNvdW50
ZXItPm9wcy0+YWN0aW9uX3NldCkgPyBjb3VudGVyX2FjdGlvbl9zdG9yZSA6IE5VTEw7Ci0JCXBh
cm0uY29tcG9uZW50ID0gYWN0aW9uX2NvbXA7Ci0JCWVyciA9IGNvdW50ZXJfYXR0cmlidXRlX2Ny
ZWF0ZSgmcGFybSk7Ci0JCWlmIChlcnIpIHsKLQkJCWtmcmVlKGFjdGlvbl9jb21wKTsKLQkJCWdv
dG8gZXJyX2ZyZWVfcHJlZml4OwotCQl9Ci0KLQkJLyogQWxsb2NhdGUgYWN0aW9uIGF2YWlsYWJs
ZSBhdHRyaWJ1dGUgY29tcG9uZW50ICovCi0JCWF2YWlsX2NvbXAgPSBrbWFsbG9jKHNpemVvZigq
YXZhaWxfY29tcCksIEdGUF9LRVJORUwpOwotCQlpZiAoIWF2YWlsX2NvbXApIHsKLQkJCWVyciA9
IC1FTk9NRU07Ci0JCQlnb3RvIGVycl9mcmVlX3ByZWZpeDsKLQkJfQotCQlhdmFpbF9jb21wLT5h
Y3Rpb25zX2xpc3QgPSBzeW5hcHNlLT5hY3Rpb25zX2xpc3Q7Ci0JCWF2YWlsX2NvbXAtPm51bV9h
Y3Rpb25zID0gc3luYXBzZS0+bnVtX2FjdGlvbnM7Ci0KLQkJLyogQ3JlYXRlIGFjdGlvbl9hdmFp
bGFibGUgYXR0cmlidXRlICovCi0JCXBhcm0uZ3JvdXAgPSBncm91cDsKLQkJcGFybS5wcmVmaXgg
PSBwcmVmaXg7Ci0JCXBhcm0ubmFtZSA9ICJhY3Rpb25fYXZhaWxhYmxlIjsKLQkJcGFybS5zaG93
ID0gY291bnRlcl9zeW5hcHNlX2FjdGlvbl9hdmFpbGFibGVfc2hvdzsKLQkJcGFybS5zdG9yZSA9
IE5VTEw7Ci0JCXBhcm0uY29tcG9uZW50ID0gYXZhaWxfY29tcDsKLQkJZXJyID0gY291bnRlcl9h
dHRyaWJ1dGVfY3JlYXRlKCZwYXJtKTsKLQkJaWYgKGVycikgewotCQkJa2ZyZWUoYXZhaWxfY29t
cCk7Ci0JCQlnb3RvIGVycl9mcmVlX3ByZWZpeDsKLQkJfQotCi0JCWtmcmVlKHByZWZpeCk7Ci0J
fQotCi0JcmV0dXJuIDA7Ci0KLWVycl9mcmVlX3ByZWZpeDoKLQlrZnJlZShwcmVmaXgpOwotZXJy
X2ZyZWVfYXR0cl9saXN0OgotCWNvdW50ZXJfZGV2aWNlX2F0dHJfbGlzdF9mcmVlKCZncm91cC0+
YXR0cl9saXN0KTsKLQlyZXR1cm4gZXJyOwotfQotCi1zdHJ1Y3QgY291bnRlcl9jb3VudF91bml0
IHsKLQlzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQ7Ci19OwotCi1zdGF0aWMgc3NpemVfdCBj
b3VudGVyX2NvdW50X3Nob3coc3RydWN0IGRldmljZSAqZGV2LAotCQkJCSAgc3RydWN0IGRldmlj
ZV9hdHRyaWJ1dGUgKmF0dHIsCi0JCQkJICBjaGFyICpidWYpCi17Ci0Jc3RydWN0IGNvdW50ZXJf
ZGV2aWNlICpjb25zdCBjb3VudGVyID0gZGV2X2dldF9kcnZkYXRhKGRldik7Ci0JY29uc3Qgc3Ry
dWN0IGNvdW50ZXJfZGV2aWNlX2F0dHIgKmNvbnN0IGRldmF0dHIgPSB0b19jb3VudGVyX2F0dHIo
YXR0cik7Ci0JY29uc3Qgc3RydWN0IGNvdW50ZXJfY291bnRfdW5pdCAqY29uc3QgY29tcG9uZW50
ID0gZGV2YXR0ci0+Y29tcG9uZW50OwotCXN0cnVjdCBjb3VudGVyX2NvdW50ICpjb25zdCBjb3Vu
dCA9IGNvbXBvbmVudC0+Y291bnQ7Ci0JaW50IGVycjsKLQl1bnNpZ25lZCBsb25nIHZhbDsKLQot
CWVyciA9IGNvdW50ZXItPm9wcy0+Y291bnRfcmVhZChjb3VudGVyLCBjb3VudCwgJnZhbCk7Ci0J
aWYgKGVycikKLQkJcmV0dXJuIGVycjsKLQotCXJldHVybiBzcHJpbnRmKGJ1ZiwgIiVsdVxuIiwg
dmFsKTsKLX0KLQotc3RhdGljIHNzaXplX3QgY291bnRlcl9jb3VudF9zdG9yZShzdHJ1Y3QgZGV2
aWNlICpkZXYsCi0JCQkJICAgc3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIsCi0JCQkJICAg
Y29uc3QgY2hhciAqYnVmLCBzaXplX3QgbGVuKQotewotCXN0cnVjdCBjb3VudGVyX2RldmljZSAq
Y29uc3QgY291bnRlciA9IGRldl9nZXRfZHJ2ZGF0YShkZXYpOwotCWNvbnN0IHN0cnVjdCBjb3Vu
dGVyX2RldmljZV9hdHRyICpjb25zdCBkZXZhdHRyID0gdG9fY291bnRlcl9hdHRyKGF0dHIpOwot
CWNvbnN0IHN0cnVjdCBjb3VudGVyX2NvdW50X3VuaXQgKmNvbnN0IGNvbXBvbmVudCA9IGRldmF0
dHItPmNvbXBvbmVudDsKLQlzdHJ1Y3QgY291bnRlcl9jb3VudCAqY29uc3QgY291bnQgPSBjb21w
b25lbnQtPmNvdW50OwotCWludCBlcnI7Ci0JdW5zaWduZWQgbG9uZyB2YWw7Ci0KLQllcnIgPSBr
c3RydG91bChidWYsIDAsICZ2YWwpOwotCWlmIChlcnIpCi0JCXJldHVybiBlcnI7Ci0KLQllcnIg
PSBjb3VudGVyLT5vcHMtPmNvdW50X3dyaXRlKGNvdW50ZXIsIGNvdW50LCB2YWwpOwotCWlmIChl
cnIpCi0JCXJldHVybiBlcnI7Ci0KLQlyZXR1cm4gbGVuOwotfQotCi1zdGF0aWMgY29uc3QgY2hh
ciAqY29uc3QgY291bnRlcl9mdW5jdGlvbl9zdHJbXSA9IHsKLQlbQ09VTlRFUl9GVU5DVElPTl9J
TkNSRUFTRV0gPSAiaW5jcmVhc2UiLAotCVtDT1VOVEVSX0ZVTkNUSU9OX0RFQ1JFQVNFXSA9ICJk
ZWNyZWFzZSIsCi0JW0NPVU5URVJfRlVOQ1RJT05fUFVMU0VfRElSRUNUSU9OXSA9ICJwdWxzZS1k
aXJlY3Rpb24iLAotCVtDT1VOVEVSX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDFfQV0gPSAicXVhZHJh
dHVyZSB4MSBhIiwKLQlbQ09VTlRFUl9GVU5DVElPTl9RVUFEUkFUVVJFX1gxX0JdID0gInF1YWRy
YXR1cmUgeDEgYiIsCi0JW0NPVU5URVJfRlVOQ1RJT05fUVVBRFJBVFVSRV9YMl9BXSA9ICJxdWFk
cmF0dXJlIHgyIGEiLAotCVtDT1VOVEVSX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDJfQl0gPSAicXVh
ZHJhdHVyZSB4MiBiIiwKLQlbQ09VTlRFUl9GVU5DVElPTl9RVUFEUkFUVVJFX1g0XSA9ICJxdWFk
cmF0dXJlIHg0IgotfTsKLQotc3RhdGljIHNzaXplX3QgY291bnRlcl9mdW5jdGlvbl9zaG93KHN0
cnVjdCBkZXZpY2UgKmRldiwKLQkJCQkgICAgIHN0cnVjdCBkZXZpY2VfYXR0cmlidXRlICphdHRy
LCBjaGFyICpidWYpCi17Ci0JaW50IGVycjsKLQlzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvbnN0
IGNvdW50ZXIgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9k
ZXZpY2VfYXR0ciAqY29uc3QgZGV2YXR0ciA9IHRvX2NvdW50ZXJfYXR0cihhdHRyKTsKLQljb25z
dCBzdHJ1Y3QgY291bnRlcl9jb3VudF91bml0ICpjb25zdCBjb21wb25lbnQgPSBkZXZhdHRyLT5j
b21wb25lbnQ7Ci0Jc3RydWN0IGNvdW50ZXJfY291bnQgKmNvbnN0IGNvdW50ID0gY29tcG9uZW50
LT5jb3VudDsKLQlzaXplX3QgZnVuY19pbmRleDsKLQllbnVtIGNvdW50ZXJfZnVuY3Rpb24gZnVu
Y3Rpb247Ci0KLQllcnIgPSBjb3VudGVyLT5vcHMtPmZ1bmN0aW9uX2dldChjb3VudGVyLCBjb3Vu
dCwgJmZ1bmNfaW5kZXgpOwotCWlmIChlcnIpCi0JCXJldHVybiBlcnI7Ci0KLQljb3VudC0+ZnVu
Y3Rpb24gPSBmdW5jX2luZGV4OwotCi0JZnVuY3Rpb24gPSBjb3VudC0+ZnVuY3Rpb25zX2xpc3Rb
ZnVuY19pbmRleF07Ci0JcmV0dXJuIHNwcmludGYoYnVmLCAiJXNcbiIsIGNvdW50ZXJfZnVuY3Rp
b25fc3RyW2Z1bmN0aW9uXSk7Ci19Ci0KLXN0YXRpYyBzc2l6ZV90IGNvdW50ZXJfZnVuY3Rpb25f
c3RvcmUoc3RydWN0IGRldmljZSAqZGV2LAotCQkJCSAgICAgIHN0cnVjdCBkZXZpY2VfYXR0cmli
dXRlICphdHRyLAotCQkJCSAgICAgIGNvbnN0IGNoYXIgKmJ1Ziwgc2l6ZV90IGxlbikKLXsKLQlj
b25zdCBzdHJ1Y3QgY291bnRlcl9kZXZpY2VfYXR0ciAqY29uc3QgZGV2YXR0ciA9IHRvX2NvdW50
ZXJfYXR0cihhdHRyKTsKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9jb3VudF91bml0ICpjb25zdCBj
b21wb25lbnQgPSBkZXZhdHRyLT5jb21wb25lbnQ7Ci0Jc3RydWN0IGNvdW50ZXJfY291bnQgKmNv
bnN0IGNvdW50ID0gY29tcG9uZW50LT5jb3VudDsKLQljb25zdCBzaXplX3QgbnVtX2Z1bmN0aW9u
cyA9IGNvdW50LT5udW1fZnVuY3Rpb25zOwotCXNpemVfdCBmdW5jX2luZGV4OwotCWVudW0gY291
bnRlcl9mdW5jdGlvbiBmdW5jdGlvbjsKLQlpbnQgZXJyOwotCXN0cnVjdCBjb3VudGVyX2Rldmlj
ZSAqY29uc3QgY291bnRlciA9IGRldl9nZXRfZHJ2ZGF0YShkZXYpOwotCi0JLyogRmluZCByZXF1
ZXN0ZWQgQ291bnQgZnVuY3Rpb24gbW9kZSAqLwotCWZvciAoZnVuY19pbmRleCA9IDA7IGZ1bmNf
aW5kZXggPCBudW1fZnVuY3Rpb25zOyBmdW5jX2luZGV4KyspIHsKLQkJZnVuY3Rpb24gPSBjb3Vu
dC0+ZnVuY3Rpb25zX2xpc3RbZnVuY19pbmRleF07Ci0JCWlmIChzeXNmc19zdHJlcShidWYsIGNv
dW50ZXJfZnVuY3Rpb25fc3RyW2Z1bmN0aW9uXSkpCi0JCQlicmVhazsKLQl9Ci0JLyogUmV0dXJu
IGVycm9yIGlmIHJlcXVlc3RlZCBDb3VudCBmdW5jdGlvbiBtb2RlIG5vdCBmb3VuZCAqLwotCWlm
IChmdW5jX2luZGV4ID49IG51bV9mdW5jdGlvbnMpCi0JCXJldHVybiAtRUlOVkFMOwotCi0JZXJy
ID0gY291bnRlci0+b3BzLT5mdW5jdGlvbl9zZXQoY291bnRlciwgY291bnQsIGZ1bmNfaW5kZXgp
OwotCWlmIChlcnIpCi0JCXJldHVybiBlcnI7Ci0KLQljb3VudC0+ZnVuY3Rpb24gPSBmdW5jX2lu
ZGV4OwotCi0JcmV0dXJuIGxlbjsKLX0KLQotc3RydWN0IGNvdW50ZXJfY291bnRfZXh0X3VuaXQg
ewotCXN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudDsKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9j
b3VudF9leHQgKmV4dDsKLX07Ci0KLXN0YXRpYyBzc2l6ZV90IGNvdW50ZXJfY291bnRfZXh0X3No
b3coc3RydWN0IGRldmljZSAqZGV2LAotCQkJCSAgICAgIHN0cnVjdCBkZXZpY2VfYXR0cmlidXRl
ICphdHRyLCBjaGFyICpidWYpCi17Ci0JY29uc3Qgc3RydWN0IGNvdW50ZXJfZGV2aWNlX2F0dHIg
KmNvbnN0IGRldmF0dHIgPSB0b19jb3VudGVyX2F0dHIoYXR0cik7Ci0JY29uc3Qgc3RydWN0IGNv
dW50ZXJfY291bnRfZXh0X3VuaXQgKmNvbnN0IGNvbXAgPSBkZXZhdHRyLT5jb21wb25lbnQ7Ci0J
Y29uc3Qgc3RydWN0IGNvdW50ZXJfY291bnRfZXh0ICpjb25zdCBleHQgPSBjb21wLT5leHQ7Ci0K
LQlyZXR1cm4gZXh0LT5yZWFkKGRldl9nZXRfZHJ2ZGF0YShkZXYpLCBjb21wLT5jb3VudCwgZXh0
LT5wcml2LCBidWYpOwotfQotCi1zdGF0aWMgc3NpemVfdCBjb3VudGVyX2NvdW50X2V4dF9zdG9y
ZShzdHJ1Y3QgZGV2aWNlICpkZXYsCi0JCQkJICAgICAgIHN0cnVjdCBkZXZpY2VfYXR0cmlidXRl
ICphdHRyLAotCQkJCSAgICAgICBjb25zdCBjaGFyICpidWYsIHNpemVfdCBsZW4pCi17Ci0JY29u
c3Qgc3RydWN0IGNvdW50ZXJfZGV2aWNlX2F0dHIgKmNvbnN0IGRldmF0dHIgPSB0b19jb3VudGVy
X2F0dHIoYXR0cik7Ci0JY29uc3Qgc3RydWN0IGNvdW50ZXJfY291bnRfZXh0X3VuaXQgKmNvbnN0
IGNvbXAgPSBkZXZhdHRyLT5jb21wb25lbnQ7Ci0JY29uc3Qgc3RydWN0IGNvdW50ZXJfY291bnRf
ZXh0ICpjb25zdCBleHQgPSBjb21wLT5leHQ7Ci0KLQlyZXR1cm4gZXh0LT53cml0ZShkZXZfZ2V0
X2RydmRhdGEoZGV2KSwgY29tcC0+Y291bnQsIGV4dC0+cHJpdiwgYnVmLAotCQlsZW4pOwotfQot
Ci1zdGF0aWMgaW50IGNvdW50ZXJfY291bnRfZXh0X3JlZ2lzdGVyKAotCXN0cnVjdCBjb3VudGVy
X2RldmljZV9hdHRyX2dyb3VwICpjb25zdCBncm91cCwKLQlzdHJ1Y3QgY291bnRlcl9jb3VudCAq
Y29uc3QgY291bnQpCi17Ci0Jc2l6ZV90IGk7Ci0JY29uc3Qgc3RydWN0IGNvdW50ZXJfY291bnRf
ZXh0ICpleHQ7Ci0Jc3RydWN0IGNvdW50ZXJfY291bnRfZXh0X3VuaXQgKmNvdW50X2V4dF9jb21w
OwotCXN0cnVjdCBjb3VudGVyX2F0dHJfcGFybSBwYXJtOwotCWludCBlcnI7Ci0KLQkvKiBDcmVh
dGUgYW4gYXR0cmlidXRlIGZvciBlYWNoIGV4dGVuc2lvbiAqLwotCWZvciAoaSA9IDAgOyBpIDwg
Y291bnQtPm51bV9leHQ7IGkrKykgewotCQlleHQgPSBjb3VudC0+ZXh0ICsgaTsKLQotCQkvKiBB
bGxvY2F0ZSBjb3VudF9leHQgYXR0cmlidXRlIGNvbXBvbmVudCAqLwotCQljb3VudF9leHRfY29t
cCA9IGttYWxsb2Moc2l6ZW9mKCpjb3VudF9leHRfY29tcCksIEdGUF9LRVJORUwpOwotCQlpZiAo
IWNvdW50X2V4dF9jb21wKSB7Ci0JCQllcnIgPSAtRU5PTUVNOwotCQkJZ290byBlcnJfZnJlZV9h
dHRyX2xpc3Q7Ci0JCX0KLQkJY291bnRfZXh0X2NvbXAtPmNvdW50ID0gY291bnQ7Ci0JCWNvdW50
X2V4dF9jb21wLT5leHQgPSBleHQ7Ci0KLQkJLyogQWxsb2NhdGUgY291bnRfZXh0IGF0dHJpYnV0
ZSAqLwotCQlwYXJtLmdyb3VwID0gZ3JvdXA7Ci0JCXBhcm0ucHJlZml4ID0gIiI7Ci0JCXBhcm0u
bmFtZSA9IGV4dC0+bmFtZTsKLQkJcGFybS5zaG93ID0gKGV4dC0+cmVhZCkgPyBjb3VudGVyX2Nv
dW50X2V4dF9zaG93IDogTlVMTDsKLQkJcGFybS5zdG9yZSA9IChleHQtPndyaXRlKSA/IGNvdW50
ZXJfY291bnRfZXh0X3N0b3JlIDogTlVMTDsKLQkJcGFybS5jb21wb25lbnQgPSBjb3VudF9leHRf
Y29tcDsKLQkJZXJyID0gY291bnRlcl9hdHRyaWJ1dGVfY3JlYXRlKCZwYXJtKTsKLQkJaWYgKGVy
cikgewotCQkJa2ZyZWUoY291bnRfZXh0X2NvbXApOwotCQkJZ290byBlcnJfZnJlZV9hdHRyX2xp
c3Q7Ci0JCX0KLQl9Ci0KLQlyZXR1cm4gMDsKLQotZXJyX2ZyZWVfYXR0cl9saXN0OgotCWNvdW50
ZXJfZGV2aWNlX2F0dHJfbGlzdF9mcmVlKCZncm91cC0+YXR0cl9saXN0KTsKLQlyZXR1cm4gZXJy
OwotfQotCi1zdHJ1Y3QgY291bnRlcl9mdW5jX2F2YWlsX3VuaXQgewotCWNvbnN0IGVudW0gY291
bnRlcl9mdW5jdGlvbiAqZnVuY3Rpb25zX2xpc3Q7Ci0Jc2l6ZV90IG51bV9mdW5jdGlvbnM7Ci19
OwotCi1zdGF0aWMgc3NpemVfdCBjb3VudGVyX2Z1bmN0aW9uX2F2YWlsYWJsZV9zaG93KHN0cnVj
dCBkZXZpY2UgKmRldiwKLQlzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSAqYXR0ciwgY2hhciAqYnVm
KQotewotCWNvbnN0IHN0cnVjdCBjb3VudGVyX2RldmljZV9hdHRyICpjb25zdCBkZXZhdHRyID0g
dG9fY291bnRlcl9hdHRyKGF0dHIpOwotCWNvbnN0IHN0cnVjdCBjb3VudGVyX2Z1bmNfYXZhaWxf
dW5pdCAqY29uc3QgY29tcG9uZW50ID0gZGV2YXR0ci0+Y29tcG9uZW50OwotCWNvbnN0IGVudW0g
Y291bnRlcl9mdW5jdGlvbiAqY29uc3QgZnVuY19saXN0ID0gY29tcG9uZW50LT5mdW5jdGlvbnNf
bGlzdDsKLQljb25zdCBzaXplX3QgbnVtX2Z1bmN0aW9ucyA9IGNvbXBvbmVudC0+bnVtX2Z1bmN0
aW9uczsKLQlzaXplX3QgaTsKLQllbnVtIGNvdW50ZXJfZnVuY3Rpb24gZnVuY3Rpb247Ci0Jc3Np
emVfdCBsZW4gPSAwOwotCi0JZm9yIChpID0gMDsgaSA8IG51bV9mdW5jdGlvbnM7IGkrKykgewot
CQlmdW5jdGlvbiA9IGZ1bmNfbGlzdFtpXTsKLQkJbGVuICs9IHNwcmludGYoYnVmICsgbGVuLCAi
JXNcbiIsCi0JCQkgICAgICAgY291bnRlcl9mdW5jdGlvbl9zdHJbZnVuY3Rpb25dKTsKLQl9Ci0K
LQlyZXR1cm4gbGVuOwotfQotCi1zdGF0aWMgaW50IGNvdW50ZXJfY291bnRfYXR0cmlidXRlc19j
cmVhdGUoCi0Jc3RydWN0IGNvdW50ZXJfZGV2aWNlX2F0dHJfZ3JvdXAgKmNvbnN0IGdyb3VwLAot
CWNvbnN0IHN0cnVjdCBjb3VudGVyX2RldmljZSAqY29uc3QgY291bnRlciwKLQlzdHJ1Y3QgY291
bnRlcl9jb3VudCAqY29uc3QgY291bnQpCi17Ci0Jc3RydWN0IGNvdW50ZXJfY291bnRfdW5pdCAq
Y291bnRfY29tcDsKLQlzdHJ1Y3QgY291bnRlcl9hdHRyX3Bhcm0gcGFybTsKLQlpbnQgZXJyOwot
CXN0cnVjdCBjb3VudGVyX2NvdW50X3VuaXQgKmZ1bmNfY29tcDsKLQlzdHJ1Y3QgY291bnRlcl9m
dW5jX2F2YWlsX3VuaXQgKmF2YWlsX2NvbXA7Ci0KLQkvKiBBbGxvY2F0ZSBjb3VudCBhdHRyaWJ1
dGUgY29tcG9uZW50ICovCi0JY291bnRfY29tcCA9IGttYWxsb2Moc2l6ZW9mKCpjb3VudF9jb21w
KSwgR0ZQX0tFUk5FTCk7Ci0JaWYgKCFjb3VudF9jb21wKQotCQlyZXR1cm4gLUVOT01FTTsKLQlj
b3VudF9jb21wLT5jb3VudCA9IGNvdW50OwotCi0JLyogQ3JlYXRlIG1haW4gQ291bnQgYXR0cmli
dXRlICovCi0JcGFybS5ncm91cCA9IGdyb3VwOwotCXBhcm0ucHJlZml4ID0gIiI7Ci0JcGFybS5u
YW1lID0gImNvdW50IjsKLQlwYXJtLnNob3cgPSAoY291bnRlci0+b3BzLT5jb3VudF9yZWFkKSA/
IGNvdW50ZXJfY291bnRfc2hvdyA6IE5VTEw7Ci0JcGFybS5zdG9yZSA9IChjb3VudGVyLT5vcHMt
PmNvdW50X3dyaXRlKSA/IGNvdW50ZXJfY291bnRfc3RvcmUgOiBOVUxMOwotCXBhcm0uY29tcG9u
ZW50ID0gY291bnRfY29tcDsKLQllcnIgPSBjb3VudGVyX2F0dHJpYnV0ZV9jcmVhdGUoJnBhcm0p
OwotCWlmIChlcnIpIHsKLQkJa2ZyZWUoY291bnRfY29tcCk7Ci0JCXJldHVybiBlcnI7Ci0JfQot
Ci0JLyogQWxsb2NhdGUgZnVuY3Rpb24gYXR0cmlidXRlIGNvbXBvbmVudCAqLwotCWZ1bmNfY29t
cCA9IGttYWxsb2Moc2l6ZW9mKCpmdW5jX2NvbXApLCBHRlBfS0VSTkVMKTsKLQlpZiAoIWZ1bmNf
Y29tcCkgewotCQllcnIgPSAtRU5PTUVNOwotCQlnb3RvIGVycl9mcmVlX2F0dHJfbGlzdDsKLQl9
Ci0JZnVuY19jb21wLT5jb3VudCA9IGNvdW50OwotCi0JLyogQ3JlYXRlIENvdW50IGZ1bmN0aW9u
IGF0dHJpYnV0ZSAqLwotCXBhcm0uZ3JvdXAgPSBncm91cDsKLQlwYXJtLnByZWZpeCA9ICIiOwot
CXBhcm0ubmFtZSA9ICJmdW5jdGlvbiI7Ci0JcGFybS5zaG93ID0gKGNvdW50ZXItPm9wcy0+ZnVu
Y3Rpb25fZ2V0KSA/IGNvdW50ZXJfZnVuY3Rpb25fc2hvdyA6IE5VTEw7Ci0JcGFybS5zdG9yZSA9
IChjb3VudGVyLT5vcHMtPmZ1bmN0aW9uX3NldCkgPyBjb3VudGVyX2Z1bmN0aW9uX3N0b3JlIDog
TlVMTDsKLQlwYXJtLmNvbXBvbmVudCA9IGZ1bmNfY29tcDsKLQllcnIgPSBjb3VudGVyX2F0dHJp
YnV0ZV9jcmVhdGUoJnBhcm0pOwotCWlmIChlcnIpIHsKLQkJa2ZyZWUoZnVuY19jb21wKTsKLQkJ
Z290byBlcnJfZnJlZV9hdHRyX2xpc3Q7Ci0JfQotCi0JLyogQWxsb2NhdGUgZnVuY3Rpb24gYXZh
aWxhYmxlIGF0dHJpYnV0ZSBjb21wb25lbnQgKi8KLQlhdmFpbF9jb21wID0ga21hbGxvYyhzaXpl
b2YoKmF2YWlsX2NvbXApLCBHRlBfS0VSTkVMKTsKLQlpZiAoIWF2YWlsX2NvbXApIHsKLQkJZXJy
ID0gLUVOT01FTTsKLQkJZ290byBlcnJfZnJlZV9hdHRyX2xpc3Q7Ci0JfQotCWF2YWlsX2NvbXAt
PmZ1bmN0aW9uc19saXN0ID0gY291bnQtPmZ1bmN0aW9uc19saXN0OwotCWF2YWlsX2NvbXAtPm51
bV9mdW5jdGlvbnMgPSBjb3VudC0+bnVtX2Z1bmN0aW9uczsKLQotCS8qIENyZWF0ZSBDb3VudCBm
dW5jdGlvbl9hdmFpbGFibGUgYXR0cmlidXRlICovCi0JcGFybS5ncm91cCA9IGdyb3VwOwotCXBh
cm0ucHJlZml4ID0gIiI7Ci0JcGFybS5uYW1lID0gImZ1bmN0aW9uX2F2YWlsYWJsZSI7Ci0JcGFy
bS5zaG93ID0gY291bnRlcl9mdW5jdGlvbl9hdmFpbGFibGVfc2hvdzsKLQlwYXJtLnN0b3JlID0g
TlVMTDsKLQlwYXJtLmNvbXBvbmVudCA9IGF2YWlsX2NvbXA7Ci0JZXJyID0gY291bnRlcl9hdHRy
aWJ1dGVfY3JlYXRlKCZwYXJtKTsKLQlpZiAoZXJyKSB7Ci0JCWtmcmVlKGF2YWlsX2NvbXApOwot
CQlnb3RvIGVycl9mcmVlX2F0dHJfbGlzdDsKLQl9Ci0KLQkvKiBDcmVhdGUgQ291bnQgbmFtZSBh
dHRyaWJ1dGUgKi8KLQllcnIgPSBjb3VudGVyX25hbWVfYXR0cmlidXRlX2NyZWF0ZShncm91cCwg
Y291bnQtPm5hbWUpOwotCWlmIChlcnIpCi0JCWdvdG8gZXJyX2ZyZWVfYXR0cl9saXN0OwotCi0J
LyogUmVnaXN0ZXIgQ291bnQgZXh0ZW5zaW9uIGF0dHJpYnV0ZXMgKi8KLQllcnIgPSBjb3VudGVy
X2NvdW50X2V4dF9yZWdpc3Rlcihncm91cCwgY291bnQpOwotCWlmIChlcnIpCi0JCWdvdG8gZXJy
X2ZyZWVfYXR0cl9saXN0OwotCi0JcmV0dXJuIDA7Ci0KLWVycl9mcmVlX2F0dHJfbGlzdDoKLQlj
b3VudGVyX2RldmljZV9hdHRyX2xpc3RfZnJlZSgmZ3JvdXAtPmF0dHJfbGlzdCk7Ci0JcmV0dXJu
IGVycjsKLX0KLQotc3RhdGljIGludCBjb3VudGVyX2NvdW50c19yZWdpc3RlcigKLQlzdHJ1Y3Qg
Y291bnRlcl9kZXZpY2VfYXR0cl9ncm91cCAqY29uc3QgZ3JvdXBzX2xpc3QsCi0JY29uc3Qgc3Ry
dWN0IGNvdW50ZXJfZGV2aWNlICpjb25zdCBjb3VudGVyKQotewotCXNpemVfdCBpOwotCXN0cnVj
dCBjb3VudGVyX2NvdW50ICpjb3VudDsKLQljb25zdCBjaGFyICpuYW1lOwotCWludCBlcnI7Ci0K
LQkvKiBSZWdpc3RlciBlYWNoIENvdW50ICovCi0JZm9yIChpID0gMDsgaSA8IGNvdW50ZXItPm51
bV9jb3VudHM7IGkrKykgewotCQljb3VudCA9IGNvdW50ZXItPmNvdW50cyArIGk7Ci0KLQkJLyog
R2VuZXJhdGUgQ291bnQgYXR0cmlidXRlIGRpcmVjdG9yeSBuYW1lICovCi0JCW5hbWUgPSBrYXNw
cmludGYoR0ZQX0tFUk5FTCwgImNvdW50JWQiLCBjb3VudC0+aWQpOwotCQlpZiAoIW5hbWUpIHsK
LQkJCWVyciA9IC1FTk9NRU07Ci0JCQlnb3RvIGVycl9mcmVlX2F0dHJfZ3JvdXBzOwotCQl9Ci0J
CWdyb3Vwc19saXN0W2ldLmF0dHJfZ3JvdXAubmFtZSA9IG5hbWU7Ci0KLQkJLyogUmVnaXN0ZXIg
dGhlIFN5bmFwc2VzIGFzc29jaWF0ZWQgd2l0aCBlYWNoIENvdW50ICovCi0JCWVyciA9IGNvdW50
ZXJfc3luYXBzZXNfcmVnaXN0ZXIoZ3JvdXBzX2xpc3QgKyBpLCBjb3VudGVyLCBjb3VudCwKLQkJ
CQkJCW5hbWUpOwotCQlpZiAoZXJyKQotCQkJZ290byBlcnJfZnJlZV9hdHRyX2dyb3VwczsKLQot
CQkvKiBDcmVhdGUgYWxsIGF0dHJpYnV0ZXMgYXNzb2NpYXRlZCB3aXRoIENvdW50ICovCi0JCWVy
ciA9IGNvdW50ZXJfY291bnRfYXR0cmlidXRlc19jcmVhdGUoZ3JvdXBzX2xpc3QgKyBpLCBjb3Vu
dGVyLAotCQkJCQkJICAgICAgY291bnQpOwotCQlpZiAoZXJyKQotCQkJZ290byBlcnJfZnJlZV9h
dHRyX2dyb3VwczsKLQl9Ci0KLQlyZXR1cm4gMDsKLQotZXJyX2ZyZWVfYXR0cl9ncm91cHM6Ci0J
ZG8gewotCQlrZnJlZShncm91cHNfbGlzdFtpXS5hdHRyX2dyb3VwLm5hbWUpOwotCQljb3VudGVy
X2RldmljZV9hdHRyX2xpc3RfZnJlZSgmZ3JvdXBzX2xpc3RbaV0uYXR0cl9saXN0KTsKLQl9IHdo
aWxlIChpLS0pOwotCXJldHVybiBlcnI7Ci19Ci0KLXN0cnVjdCBjb3VudGVyX3NpemVfdW5pdCB7
Ci0Jc2l6ZV90IHNpemU7Ci19OwotCi1zdGF0aWMgc3NpemVfdCBjb3VudGVyX2RldmljZV9hdHRy
X3NpemVfc2hvdyhzdHJ1Y3QgZGV2aWNlICpkZXYsCi0JCQkJCSAgICAgc3RydWN0IGRldmljZV9h
dHRyaWJ1dGUgKmF0dHIsCi0JCQkJCSAgICAgY2hhciAqYnVmKQotewotCWNvbnN0IHN0cnVjdCBj
b3VudGVyX3NpemVfdW5pdCAqY29uc3QgY29tcCA9IHRvX2NvdW50ZXJfYXR0cihhdHRyKS0+Y29t
cG9uZW50OwotCi0JcmV0dXJuIHNwcmludGYoYnVmLCAiJXp1XG4iLCBjb21wLT5zaXplKTsKLX0K
LQotc3RhdGljIGludCBjb3VudGVyX3NpemVfYXR0cmlidXRlX2NyZWF0ZSgKLQlzdHJ1Y3QgY291
bnRlcl9kZXZpY2VfYXR0cl9ncm91cCAqY29uc3QgZ3JvdXAsCi0JY29uc3Qgc2l6ZV90IHNpemUs
IGNvbnN0IGNoYXIgKmNvbnN0IG5hbWUpCi17Ci0Jc3RydWN0IGNvdW50ZXJfc2l6ZV91bml0ICpz
aXplX2NvbXA7Ci0Jc3RydWN0IGNvdW50ZXJfYXR0cl9wYXJtIHBhcm07Ci0JaW50IGVycjsKLQot
CS8qIEFsbG9jYXRlIHNpemUgYXR0cmlidXRlIGNvbXBvbmVudCAqLwotCXNpemVfY29tcCA9IGtt
YWxsb2Moc2l6ZW9mKCpzaXplX2NvbXApLCBHRlBfS0VSTkVMKTsKLQlpZiAoIXNpemVfY29tcCkK
LQkJcmV0dXJuIC1FTk9NRU07Ci0Jc2l6ZV9jb21wLT5zaXplID0gc2l6ZTsKLQotCXBhcm0uZ3Jv
dXAgPSBncm91cDsKLQlwYXJtLnByZWZpeCA9ICIiOwotCXBhcm0ubmFtZSA9IG5hbWU7Ci0JcGFy
bS5zaG93ID0gY291bnRlcl9kZXZpY2VfYXR0cl9zaXplX3Nob3c7Ci0JcGFybS5zdG9yZSA9IE5V
TEw7Ci0JcGFybS5jb21wb25lbnQgPSBzaXplX2NvbXA7Ci0JZXJyID0gY291bnRlcl9hdHRyaWJ1
dGVfY3JlYXRlKCZwYXJtKTsKLQlpZiAoZXJyKQotCQlnb3RvIGVycl9mcmVlX3NpemVfY29tcDsK
LQotCXJldHVybiAwOwotCi1lcnJfZnJlZV9zaXplX2NvbXA6Ci0Ja2ZyZWUoc2l6ZV9jb21wKTsK
LQlyZXR1cm4gZXJyOwotfQotCi1zdHJ1Y3QgY291bnRlcl9leHRfdW5pdCB7Ci0JY29uc3Qgc3Ry
dWN0IGNvdW50ZXJfZGV2aWNlX2V4dCAqZXh0OwotfTsKLQotc3RhdGljIHNzaXplX3QgY291bnRl
cl9kZXZpY2VfZXh0X3Nob3coc3RydWN0IGRldmljZSAqZGV2LAotCQkJCSAgICAgICBzdHJ1Y3Qg
ZGV2aWNlX2F0dHJpYnV0ZSAqYXR0ciwgY2hhciAqYnVmKQotewotCWNvbnN0IHN0cnVjdCBjb3Vu
dGVyX2RldmljZV9hdHRyICpjb25zdCBkZXZhdHRyID0gdG9fY291bnRlcl9hdHRyKGF0dHIpOwot
CWNvbnN0IHN0cnVjdCBjb3VudGVyX2V4dF91bml0ICpjb25zdCBjb21wb25lbnQgPSBkZXZhdHRy
LT5jb21wb25lbnQ7Ci0JY29uc3Qgc3RydWN0IGNvdW50ZXJfZGV2aWNlX2V4dCAqY29uc3QgZXh0
ID0gY29tcG9uZW50LT5leHQ7Ci0KLQlyZXR1cm4gZXh0LT5yZWFkKGRldl9nZXRfZHJ2ZGF0YShk
ZXYpLCBleHQtPnByaXYsIGJ1Zik7Ci19Ci0KLXN0YXRpYyBzc2l6ZV90IGNvdW50ZXJfZGV2aWNl
X2V4dF9zdG9yZShzdHJ1Y3QgZGV2aWNlICpkZXYsCi0JCQkJCXN0cnVjdCBkZXZpY2VfYXR0cmli
dXRlICphdHRyLAotCQkJCQljb25zdCBjaGFyICpidWYsIHNpemVfdCBsZW4pCi17Ci0JY29uc3Qg
c3RydWN0IGNvdW50ZXJfZGV2aWNlX2F0dHIgKmNvbnN0IGRldmF0dHIgPSB0b19jb3VudGVyX2F0
dHIoYXR0cik7Ci0JY29uc3Qgc3RydWN0IGNvdW50ZXJfZXh0X3VuaXQgKmNvbnN0IGNvbXBvbmVu
dCA9IGRldmF0dHItPmNvbXBvbmVudDsKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9kZXZpY2VfZXh0
ICpjb25zdCBleHQgPSBjb21wb25lbnQtPmV4dDsKLQotCXJldHVybiBleHQtPndyaXRlKGRldl9n
ZXRfZHJ2ZGF0YShkZXYpLCBleHQtPnByaXYsIGJ1ZiwgbGVuKTsKLX0KLQotc3RhdGljIGludCBj
b3VudGVyX2RldmljZV9leHRfcmVnaXN0ZXIoCi0Jc3RydWN0IGNvdW50ZXJfZGV2aWNlX2F0dHJf
Z3JvdXAgKmNvbnN0IGdyb3VwLAotCXN0cnVjdCBjb3VudGVyX2RldmljZSAqY29uc3QgY291bnRl
cikKLXsKLQlzaXplX3QgaTsKLQlzdHJ1Y3QgY291bnRlcl9leHRfdW5pdCAqZXh0X2NvbXA7Ci0J
c3RydWN0IGNvdW50ZXJfYXR0cl9wYXJtIHBhcm07Ci0JaW50IGVycjsKLQotCS8qIENyZWF0ZSBh
biBhdHRyaWJ1dGUgZm9yIGVhY2ggZXh0ZW5zaW9uICovCi0JZm9yIChpID0gMCA7IGkgPCBjb3Vu
dGVyLT5udW1fZXh0OyBpKyspIHsKLQkJLyogQWxsb2NhdGUgZXh0ZW5zaW9uIGF0dHJpYnV0ZSBj
b21wb25lbnQgKi8KLQkJZXh0X2NvbXAgPSBrbWFsbG9jKHNpemVvZigqZXh0X2NvbXApLCBHRlBf
S0VSTkVMKTsKLQkJaWYgKCFleHRfY29tcCkgewotCQkJZXJyID0gLUVOT01FTTsKLQkJCWdvdG8g
ZXJyX2ZyZWVfYXR0cl9saXN0OwotCQl9Ci0KLQkJZXh0X2NvbXAtPmV4dCA9IGNvdW50ZXItPmV4
dCArIGk7Ci0KLQkJLyogQWxsb2NhdGUgZXh0ZW5zaW9uIGF0dHJpYnV0ZSAqLwotCQlwYXJtLmdy
b3VwID0gZ3JvdXA7Ci0JCXBhcm0ucHJlZml4ID0gIiI7Ci0JCXBhcm0ubmFtZSA9IGNvdW50ZXIt
PmV4dFtpXS5uYW1lOwotCQlwYXJtLnNob3cgPSAoY291bnRlci0+ZXh0W2ldLnJlYWQpID8gY291
bnRlcl9kZXZpY2VfZXh0X3Nob3cgOiBOVUxMOwotCQlwYXJtLnN0b3JlID0gKGNvdW50ZXItPmV4
dFtpXS53cml0ZSkgPyBjb3VudGVyX2RldmljZV9leHRfc3RvcmUgOiBOVUxMOwotCQlwYXJtLmNv
bXBvbmVudCA9IGV4dF9jb21wOwotCQllcnIgPSBjb3VudGVyX2F0dHJpYnV0ZV9jcmVhdGUoJnBh
cm0pOwotCQlpZiAoZXJyKSB7Ci0JCQlrZnJlZShleHRfY29tcCk7Ci0JCQlnb3RvIGVycl9mcmVl
X2F0dHJfbGlzdDsKLQkJfQotCX0KLQotCXJldHVybiAwOwotCi1lcnJfZnJlZV9hdHRyX2xpc3Q6
Ci0JY291bnRlcl9kZXZpY2VfYXR0cl9saXN0X2ZyZWUoJmdyb3VwLT5hdHRyX2xpc3QpOwotCXJl
dHVybiBlcnI7Ci19Ci0KLXN0YXRpYyBpbnQgY291bnRlcl9nbG9iYWxfYXR0cl9yZWdpc3RlcigK
LQlzdHJ1Y3QgY291bnRlcl9kZXZpY2VfYXR0cl9ncm91cCAqY29uc3QgZ3JvdXAsCi0Jc3RydWN0
IGNvdW50ZXJfZGV2aWNlICpjb25zdCBjb3VudGVyKQotewotCWludCBlcnI7Ci0KLQkvKiBDcmVh
dGUgbmFtZSBhdHRyaWJ1dGUgKi8KLQllcnIgPSBjb3VudGVyX25hbWVfYXR0cmlidXRlX2NyZWF0
ZShncm91cCwgY291bnRlci0+bmFtZSk7Ci0JaWYgKGVycikKLQkJcmV0dXJuIGVycjsKLQotCS8q
IENyZWF0ZSBudW1fY291bnRzIGF0dHJpYnV0ZSAqLwotCWVyciA9IGNvdW50ZXJfc2l6ZV9hdHRy
aWJ1dGVfY3JlYXRlKGdyb3VwLCBjb3VudGVyLT5udW1fY291bnRzLAotCQkJCQkgICAgIm51bV9j
b3VudHMiKTsKLQlpZiAoZXJyKQotCQlnb3RvIGVycl9mcmVlX2F0dHJfbGlzdDsKLQotCS8qIENy
ZWF0ZSBudW1fc2lnbmFscyBhdHRyaWJ1dGUgKi8KLQllcnIgPSBjb3VudGVyX3NpemVfYXR0cmli
dXRlX2NyZWF0ZShncm91cCwgY291bnRlci0+bnVtX3NpZ25hbHMsCi0JCQkJCSAgICAibnVtX3Np
Z25hbHMiKTsKLQlpZiAoZXJyKQotCQlnb3RvIGVycl9mcmVlX2F0dHJfbGlzdDsKLQotCS8qIFJl
Z2lzdGVyIENvdW50ZXIgZGV2aWNlIGV4dGVuc2lvbiBhdHRyaWJ1dGVzICovCi0JZXJyID0gY291
bnRlcl9kZXZpY2VfZXh0X3JlZ2lzdGVyKGdyb3VwLCBjb3VudGVyKTsKLQlpZiAoZXJyKQotCQln
b3RvIGVycl9mcmVlX2F0dHJfbGlzdDsKLQotCXJldHVybiAwOwotCi1lcnJfZnJlZV9hdHRyX2xp
c3Q6Ci0JY291bnRlcl9kZXZpY2VfYXR0cl9saXN0X2ZyZWUoJmdyb3VwLT5hdHRyX2xpc3QpOwot
CXJldHVybiBlcnI7Ci19Ci0KLXN0YXRpYyB2b2lkIGNvdW50ZXJfZGV2aWNlX2dyb3Vwc19saXN0
X2ZyZWUoCi0Jc3RydWN0IGNvdW50ZXJfZGV2aWNlX2F0dHJfZ3JvdXAgKmNvbnN0IGdyb3Vwc19s
aXN0LAotCWNvbnN0IHNpemVfdCBudW1fZ3JvdXBzKQotewotCXN0cnVjdCBjb3VudGVyX2Rldmlj
ZV9hdHRyX2dyb3VwICpncm91cDsKLQlzaXplX3QgaTsKLQotCS8qIGxvb3AgdGhyb3VnaCBhbGwg
YXR0cmlidXRlIGdyb3VwcyAoc2lnbmFscywgY291bnRzLCBnbG9iYWwsIGV0Yy4pICovCi0JZm9y
IChpID0gMDsgaSA8IG51bV9ncm91cHM7IGkrKykgewotCQlncm91cCA9IGdyb3Vwc19saXN0ICsg
aTsKLQotCQkvKiBmcmVlIGFsbCBhdHRyaWJ1dGUgZ3JvdXAgYW5kIGFzc29jaWF0ZWQgYXR0cmli
dXRlcyBtZW1vcnkgKi8KLQkJa2ZyZWUoZ3JvdXAtPmF0dHJfZ3JvdXAubmFtZSk7Ci0JCWtmcmVl
KGdyb3VwLT5hdHRyX2dyb3VwLmF0dHJzKTsKLQkJY291bnRlcl9kZXZpY2VfYXR0cl9saXN0X2Zy
ZWUoJmdyb3VwLT5hdHRyX2xpc3QpOwotCX0KLQotCWtmcmVlKGdyb3Vwc19saXN0KTsKLX0KLQot
c3RhdGljIGludCBjb3VudGVyX2RldmljZV9ncm91cHNfbGlzdF9wcmVwYXJlKAotCXN0cnVjdCBj
b3VudGVyX2RldmljZSAqY29uc3QgY291bnRlcikKLXsKLQljb25zdCBzaXplX3QgdG90YWxfbnVt
X2dyb3VwcyA9Ci0JCWNvdW50ZXItPm51bV9zaWduYWxzICsgY291bnRlci0+bnVtX2NvdW50cyAr
IDE7Ci0Jc3RydWN0IGNvdW50ZXJfZGV2aWNlX2F0dHJfZ3JvdXAgKmdyb3Vwc19saXN0OwotCXNp
emVfdCBpOwotCWludCBlcnI7Ci0Jc2l6ZV90IG51bV9ncm91cHMgPSAwOwotCi0JLyogQWxsb2Nh
dGUgc3BhY2UgZm9yIGF0dHJpYnV0ZSBncm91cHMgKHNpZ25hbHMsIGNvdW50cywgYW5kIGV4dCkg
Ki8KLQlncm91cHNfbGlzdCA9IGtjYWxsb2ModG90YWxfbnVtX2dyb3Vwcywgc2l6ZW9mKCpncm91
cHNfbGlzdCksCi0JCQkgICAgICBHRlBfS0VSTkVMKTsKLQlpZiAoIWdyb3Vwc19saXN0KQotCQly
ZXR1cm4gLUVOT01FTTsKLQotCS8qIEluaXRpYWxpemUgYXR0cmlidXRlIGxpc3RzICovCi0JZm9y
IChpID0gMDsgaSA8IHRvdGFsX251bV9ncm91cHM7IGkrKykKLQkJSU5JVF9MSVNUX0hFQUQoJmdy
b3Vwc19saXN0W2ldLmF0dHJfbGlzdCk7Ci0KLQkvKiBSZWdpc3RlciBTaWduYWxzICovCi0JZXJy
ID0gY291bnRlcl9zaWduYWxzX3JlZ2lzdGVyKGdyb3Vwc19saXN0LCBjb3VudGVyKTsKLQlpZiAo
ZXJyKQotCQlnb3RvIGVycl9mcmVlX2dyb3Vwc19saXN0OwotCW51bV9ncm91cHMgKz0gY291bnRl
ci0+bnVtX3NpZ25hbHM7Ci0KLQkvKiBSZWdpc3RlciBDb3VudHMgYW5kIHJlc3BlY3RpdmUgU3lu
YXBzZXMgKi8KLQllcnIgPSBjb3VudGVyX2NvdW50c19yZWdpc3Rlcihncm91cHNfbGlzdCArIG51
bV9ncm91cHMsIGNvdW50ZXIpOwotCWlmIChlcnIpCi0JCWdvdG8gZXJyX2ZyZWVfZ3JvdXBzX2xp
c3Q7Ci0JbnVtX2dyb3VwcyArPSBjb3VudGVyLT5udW1fY291bnRzOwotCi0JLyogUmVnaXN0ZXIg
Q291bnRlciBnbG9iYWwgYXR0cmlidXRlcyAqLwotCWVyciA9IGNvdW50ZXJfZ2xvYmFsX2F0dHJf
cmVnaXN0ZXIoZ3JvdXBzX2xpc3QgKyBudW1fZ3JvdXBzLCBjb3VudGVyKTsKLQlpZiAoZXJyKQot
CQlnb3RvIGVycl9mcmVlX2dyb3Vwc19saXN0OwotCW51bV9ncm91cHMrKzsKLQotCS8qIFN0b3Jl
IGdyb3Vwc19saXN0IGluIGRldmljZV9zdGF0ZSAqLwotCWNvdW50ZXItPmRldmljZV9zdGF0ZS0+
Z3JvdXBzX2xpc3QgPSBncm91cHNfbGlzdDsKLQljb3VudGVyLT5kZXZpY2Vfc3RhdGUtPm51bV9n
cm91cHMgPSBudW1fZ3JvdXBzOwotCi0JcmV0dXJuIDA7Ci0KLWVycl9mcmVlX2dyb3Vwc19saXN0
OgotCWNvdW50ZXJfZGV2aWNlX2dyb3Vwc19saXN0X2ZyZWUoZ3JvdXBzX2xpc3QsIG51bV9ncm91
cHMpOwotCXJldHVybiBlcnI7Ci19Ci0KLXN0YXRpYyBpbnQgY291bnRlcl9kZXZpY2VfZ3JvdXBz
X3ByZXBhcmUoCi0Jc3RydWN0IGNvdW50ZXJfZGV2aWNlX3N0YXRlICpjb25zdCBkZXZpY2Vfc3Rh
dGUpCi17Ci0Jc2l6ZV90IGksIGo7Ci0Jc3RydWN0IGNvdW50ZXJfZGV2aWNlX2F0dHJfZ3JvdXAg
Kmdyb3VwOwotCWludCBlcnI7Ci0Jc3RydWN0IGNvdW50ZXJfZGV2aWNlX2F0dHIgKnA7Ci0KLQkv
KiBBbGxvY2F0ZSBhdHRyaWJ1dGUgZ3JvdXBzIGZvciBhc3NvY2lhdGlvbiB3aXRoIGRldmljZSAq
LwotCWRldmljZV9zdGF0ZS0+Z3JvdXBzID0ga2NhbGxvYyhkZXZpY2Vfc3RhdGUtPm51bV9ncm91
cHMgKyAxLAotCQkJCSAgICAgICBzaXplb2YoKmRldmljZV9zdGF0ZS0+Z3JvdXBzKSwKLQkJCQkg
ICAgICAgR0ZQX0tFUk5FTCk7Ci0JaWYgKCFkZXZpY2Vfc3RhdGUtPmdyb3VwcykKLQkJcmV0dXJu
IC1FTk9NRU07Ci0KLQkvKiBQcmVwYXJlIGVhY2ggZ3JvdXAgb2YgYXR0cmlidXRlcyBmb3IgYXNz
b2NpYXRpb24gKi8KLQlmb3IgKGkgPSAwOyBpIDwgZGV2aWNlX3N0YXRlLT5udW1fZ3JvdXBzOyBp
KyspIHsKLQkJZ3JvdXAgPSBkZXZpY2Vfc3RhdGUtPmdyb3Vwc19saXN0ICsgaTsKLQotCQkvKiBB
bGxvY2F0ZSBzcGFjZSBmb3IgYXR0cmlidXRlIHBvaW50ZXJzIGluIGF0dHJpYnV0ZSBncm91cCAq
LwotCQlncm91cC0+YXR0cl9ncm91cC5hdHRycyA9IGtjYWxsb2MoZ3JvdXAtPm51bV9hdHRyICsg
MSwKLQkJCXNpemVvZigqZ3JvdXAtPmF0dHJfZ3JvdXAuYXR0cnMpLCBHRlBfS0VSTkVMKTsKLQkJ
aWYgKCFncm91cC0+YXR0cl9ncm91cC5hdHRycykgewotCQkJZXJyID0gLUVOT01FTTsKLQkJCWdv
dG8gZXJyX2ZyZWVfZ3JvdXBzOwotCQl9Ci0KLQkJLyogQWRkIGF0dHJpYnV0ZSBwb2ludGVycyB0
byBhdHRyaWJ1dGUgZ3JvdXAgKi8KLQkJaiA9IDA7Ci0JCWxpc3RfZm9yX2VhY2hfZW50cnkocCwg
Jmdyb3VwLT5hdHRyX2xpc3QsIGwpCi0JCQlncm91cC0+YXR0cl9ncm91cC5hdHRyc1tqKytdID0g
JnAtPmRldl9hdHRyLmF0dHI7Ci0KLQkJLyogR3JvdXAgYXR0cmlidXRlcyBpbiBhdHRyaWJ1dGUg
Z3JvdXAgKi8KLQkJZGV2aWNlX3N0YXRlLT5ncm91cHNbaV0gPSAmZ3JvdXAtPmF0dHJfZ3JvdXA7
Ci0JfQotCS8qIEFzc29jaWF0ZSBhdHRyaWJ1dGVzIHdpdGggZGV2aWNlICovCi0JZGV2aWNlX3N0
YXRlLT5kZXYuZ3JvdXBzID0gZGV2aWNlX3N0YXRlLT5ncm91cHM7Ci0KLQlyZXR1cm4gMDsKLQot
ZXJyX2ZyZWVfZ3JvdXBzOgotCWRvIHsKLQkJZ3JvdXAgPSBkZXZpY2Vfc3RhdGUtPmdyb3Vwc19s
aXN0ICsgaTsKLQkJa2ZyZWUoZ3JvdXAtPmF0dHJfZ3JvdXAuYXR0cnMpOwotCQlncm91cC0+YXR0
cl9ncm91cC5hdHRycyA9IE5VTEw7Ci0JfSB3aGlsZSAoaS0tKTsKLQlrZnJlZShkZXZpY2Vfc3Rh
dGUtPmdyb3Vwcyk7Ci0JcmV0dXJuIGVycjsKLX0KLQotLyogUHJvdmlkZXMgYSB1bmlxdWUgSUQg
Zm9yIGVhY2ggY291bnRlciBkZXZpY2UgKi8KLXN0YXRpYyBERUZJTkVfSURBKGNvdW50ZXJfaWRh
KTsKLQotc3RhdGljIHZvaWQgY291bnRlcl9kZXZpY2VfcmVsZWFzZShzdHJ1Y3QgZGV2aWNlICpk
ZXYpCi17Ci0Jc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb25zdCBjb3VudGVyID0gZGV2X2dldF9k
cnZkYXRhKGRldik7Ci0Jc3RydWN0IGNvdW50ZXJfZGV2aWNlX3N0YXRlICpjb25zdCBkZXZpY2Vf
c3RhdGUgPSBjb3VudGVyLT5kZXZpY2Vfc3RhdGU7Ci0KLQlrZnJlZShkZXZpY2Vfc3RhdGUtPmdy
b3Vwcyk7Ci0JY291bnRlcl9kZXZpY2VfZ3JvdXBzX2xpc3RfZnJlZShkZXZpY2Vfc3RhdGUtPmdy
b3Vwc19saXN0LAotCQkJCQlkZXZpY2Vfc3RhdGUtPm51bV9ncm91cHMpOwotCWlkYV9zaW1wbGVf
cmVtb3ZlKCZjb3VudGVyX2lkYSwgZGV2aWNlX3N0YXRlLT5pZCk7Ci0Ja2ZyZWUoZGV2aWNlX3N0
YXRlKTsKLX0KLQotc3RhdGljIHN0cnVjdCBkZXZpY2VfdHlwZSBjb3VudGVyX2RldmljZV90eXBl
ID0gewotCS5uYW1lID0gImNvdW50ZXJfZGV2aWNlIiwKLQkucmVsZWFzZSA9IGNvdW50ZXJfZGV2
aWNlX3JlbGVhc2UKLX07Ci0KLXN0YXRpYyBzdHJ1Y3QgYnVzX3R5cGUgY291bnRlcl9idXNfdHlw
ZSA9IHsKLQkubmFtZSA9ICJjb3VudGVyIgotfTsKLQotLyoqCi0gKiBjb3VudGVyX3JlZ2lzdGVy
IC0gcmVnaXN0ZXIgQ291bnRlciB0byB0aGUgc3lzdGVtCi0gKiBAY291bnRlcjoJcG9pbnRlciB0
byBDb3VudGVyIHRvIHJlZ2lzdGVyCi0gKgotICogVGhpcyBmdW5jdGlvbiByZWdpc3RlcnMgYSBD
b3VudGVyIHRvIHRoZSBzeXN0ZW0uIEEgc3lzZnMgImNvdW50ZXIiIGRpcmVjdG9yeQotICogd2ls
bCBiZSBjcmVhdGVkIGFuZCBwb3B1bGF0ZWQgd2l0aCBzeXNmcyBhdHRyaWJ1dGVzIGNvcnJlbGF0
aW5nIHdpdGggdGhlCi0gKiBDb3VudGVyIFNpZ25hbHMsIFN5bmFwc2VzLCBhbmQgQ291bnRzIHJl
c3BlY3RpdmVseS4KLSAqLwotaW50IGNvdW50ZXJfcmVnaXN0ZXIoc3RydWN0IGNvdW50ZXJfZGV2
aWNlICpjb25zdCBjb3VudGVyKQotewotCXN0cnVjdCBjb3VudGVyX2RldmljZV9zdGF0ZSAqZGV2
aWNlX3N0YXRlOwotCWludCBlcnI7Ci0KLQkvKiBBbGxvY2F0ZSBpbnRlcm5hbCBzdGF0ZSBjb250
YWluZXIgZm9yIENvdW50ZXIgZGV2aWNlICovCi0JZGV2aWNlX3N0YXRlID0ga3phbGxvYyhzaXpl
b2YoKmRldmljZV9zdGF0ZSksIEdGUF9LRVJORUwpOwotCWlmICghZGV2aWNlX3N0YXRlKQotCQly
ZXR1cm4gLUVOT01FTTsKLQljb3VudGVyLT5kZXZpY2Vfc3RhdGUgPSBkZXZpY2Vfc3RhdGU7Ci0K
LQkvKiBBY3F1aXJlIHVuaXF1ZSBJRCAqLwotCWRldmljZV9zdGF0ZS0+aWQgPSBpZGFfc2ltcGxl
X2dldCgmY291bnRlcl9pZGEsIDAsIDAsIEdGUF9LRVJORUwpOwotCWlmIChkZXZpY2Vfc3RhdGUt
PmlkIDwgMCkgewotCQllcnIgPSBkZXZpY2Vfc3RhdGUtPmlkOwotCQlnb3RvIGVycl9mcmVlX2Rl
dmljZV9zdGF0ZTsKLQl9Ci0KLQkvKiBDb25maWd1cmUgZGV2aWNlIHN0cnVjdHVyZSBmb3IgQ291
bnRlciAqLwotCWRldmljZV9zdGF0ZS0+ZGV2LnR5cGUgPSAmY291bnRlcl9kZXZpY2VfdHlwZTsK
LQlkZXZpY2Vfc3RhdGUtPmRldi5idXMgPSAmY291bnRlcl9idXNfdHlwZTsKLQlpZiAoY291bnRl
ci0+cGFyZW50KSB7Ci0JCWRldmljZV9zdGF0ZS0+ZGV2LnBhcmVudCA9IGNvdW50ZXItPnBhcmVu
dDsKLQkJZGV2aWNlX3N0YXRlLT5kZXYub2Zfbm9kZSA9IGNvdW50ZXItPnBhcmVudC0+b2Zfbm9k
ZTsKLQl9Ci0JZGV2X3NldF9uYW1lKCZkZXZpY2Vfc3RhdGUtPmRldiwgImNvdW50ZXIlZCIsIGRl
dmljZV9zdGF0ZS0+aWQpOwotCWRldmljZV9pbml0aWFsaXplKCZkZXZpY2Vfc3RhdGUtPmRldik7
Ci0JZGV2X3NldF9kcnZkYXRhKCZkZXZpY2Vfc3RhdGUtPmRldiwgY291bnRlcik7Ci0KLQkvKiBQ
cmVwYXJlIGRldmljZSBhdHRyaWJ1dGVzICovCi0JZXJyID0gY291bnRlcl9kZXZpY2VfZ3JvdXBz
X2xpc3RfcHJlcGFyZShjb3VudGVyKTsKLQlpZiAoZXJyKQotCQlnb3RvIGVycl9mcmVlX2lkOwot
Ci0JLyogT3JnYW5pemUgZGV2aWNlIGF0dHJpYnV0ZXMgdG8gZ3JvdXBzIGFuZCBtYXRjaCB0byBk
ZXZpY2UgKi8KLQllcnIgPSBjb3VudGVyX2RldmljZV9ncm91cHNfcHJlcGFyZShkZXZpY2Vfc3Rh
dGUpOwotCWlmIChlcnIpCi0JCWdvdG8gZXJyX2ZyZWVfZ3JvdXBzX2xpc3Q7Ci0KLQkvKiBBZGQg
ZGV2aWNlIHRvIHN5c3RlbSAqLwotCWVyciA9IGRldmljZV9hZGQoJmRldmljZV9zdGF0ZS0+ZGV2
KTsKLQlpZiAoZXJyKQotCQlnb3RvIGVycl9mcmVlX2dyb3VwczsKLQotCXJldHVybiAwOwotCi1l
cnJfZnJlZV9ncm91cHM6Ci0Ja2ZyZWUoZGV2aWNlX3N0YXRlLT5ncm91cHMpOwotZXJyX2ZyZWVf
Z3JvdXBzX2xpc3Q6Ci0JY291bnRlcl9kZXZpY2VfZ3JvdXBzX2xpc3RfZnJlZShkZXZpY2Vfc3Rh
dGUtPmdyb3Vwc19saXN0LAotCQkJCQlkZXZpY2Vfc3RhdGUtPm51bV9ncm91cHMpOwotZXJyX2Zy
ZWVfaWQ6Ci0JaWRhX3NpbXBsZV9yZW1vdmUoJmNvdW50ZXJfaWRhLCBkZXZpY2Vfc3RhdGUtPmlk
KTsKLWVycl9mcmVlX2RldmljZV9zdGF0ZToKLQlrZnJlZShkZXZpY2Vfc3RhdGUpOwotCXJldHVy
biBlcnI7Ci19Ci1FWFBPUlRfU1lNQk9MX0dQTChjb3VudGVyX3JlZ2lzdGVyKTsKLQotLyoqCi0g
KiBjb3VudGVyX3VucmVnaXN0ZXIgLSB1bnJlZ2lzdGVyIENvdW50ZXIgZnJvbSB0aGUgc3lzdGVt
Ci0gKiBAY291bnRlcjoJcG9pbnRlciB0byBDb3VudGVyIHRvIHVucmVnaXN0ZXIKLSAqCi0gKiBU
aGUgQ291bnRlciBpcyB1bnJlZ2lzdGVyZWQgZnJvbSB0aGUgc3lzdGVtOyBhbGwgYWxsb2NhdGVk
IG1lbW9yeSBpcyBmcmVlZC4KLSAqLwotdm9pZCBjb3VudGVyX3VucmVnaXN0ZXIoc3RydWN0IGNv
dW50ZXJfZGV2aWNlICpjb25zdCBjb3VudGVyKQotewotCWlmIChjb3VudGVyKQotCQlkZXZpY2Vf
ZGVsKCZjb3VudGVyLT5kZXZpY2Vfc3RhdGUtPmRldik7Ci19Ci1FWFBPUlRfU1lNQk9MX0dQTChj
b3VudGVyX3VucmVnaXN0ZXIpOwotCi1zdGF0aWMgdm9pZCBkZXZtX2NvdW50ZXJfdW5yZWcoc3Ry
dWN0IGRldmljZSAqZGV2LCB2b2lkICpyZXMpCi17Ci0JY291bnRlcl91bnJlZ2lzdGVyKCooc3Ry
dWN0IGNvdW50ZXJfZGV2aWNlICoqKXJlcyk7Ci19Ci0KLS8qKgotICogZGV2bV9jb3VudGVyX3Jl
Z2lzdGVyIC0gUmVzb3VyY2UtbWFuYWdlZCBjb3VudGVyX3JlZ2lzdGVyCi0gKiBAZGV2OglkZXZp
Y2UgdG8gYWxsb2NhdGUgY291bnRlcl9kZXZpY2UgZm9yCi0gKiBAY291bnRlcjoJcG9pbnRlciB0
byBDb3VudGVyIHRvIHJlZ2lzdGVyCi0gKgotICogTWFuYWdlZCBjb3VudGVyX3JlZ2lzdGVyLiBU
aGUgQ291bnRlciByZWdpc3RlcmVkIHdpdGggdGhpcyBmdW5jdGlvbiBpcwotICogYXV0b21hdGlj
YWxseSB1bnJlZ2lzdGVyZWQgb24gZHJpdmVyIGRldGFjaC4gVGhpcyBmdW5jdGlvbiBjYWxscwot
ICogY291bnRlcl9yZWdpc3RlciBpbnRlcm5hbGx5LiBSZWZlciB0byB0aGF0IGZ1bmN0aW9uIGZv
ciBtb3JlIGluZm9ybWF0aW9uLgotICoKLSAqIElmIGFuIENvdW50ZXIgcmVnaXN0ZXJlZCB3aXRo
IHRoaXMgZnVuY3Rpb24gbmVlZHMgdG8gYmUgdW5yZWdpc3RlcmVkCi0gKiBzZXBhcmF0ZWx5LCBk
ZXZtX2NvdW50ZXJfdW5yZWdpc3RlciBtdXN0IGJlIHVzZWQuCi0gKgotICogUkVUVVJOUzoKLSAq
IDAgb24gc3VjY2VzcywgbmVnYXRpdmUgZXJyb3IgbnVtYmVyIG9uIGZhaWx1cmUuCi0gKi8KLWlu
dCBkZXZtX2NvdW50ZXJfcmVnaXN0ZXIoc3RydWN0IGRldmljZSAqZGV2LAotCQkJICBzdHJ1Y3Qg
Y291bnRlcl9kZXZpY2UgKmNvbnN0IGNvdW50ZXIpCi17Ci0Jc3RydWN0IGNvdW50ZXJfZGV2aWNl
ICoqcHRyOwotCWludCByZXQ7Ci0KLQlwdHIgPSBkZXZyZXNfYWxsb2MoZGV2bV9jb3VudGVyX3Vu
cmVnLCBzaXplb2YoKnB0ciksIEdGUF9LRVJORUwpOwotCWlmICghcHRyKQotCQlyZXR1cm4gLUVO
T01FTTsKLQotCXJldCA9IGNvdW50ZXJfcmVnaXN0ZXIoY291bnRlcik7Ci0JaWYgKCFyZXQpIHsK
LQkJKnB0ciA9IGNvdW50ZXI7Ci0JCWRldnJlc19hZGQoZGV2LCBwdHIpOwotCX0gZWxzZSB7Ci0J
CWRldnJlc19mcmVlKHB0cik7Ci0JfQotCi0JcmV0dXJuIHJldDsKLX0KLUVYUE9SVF9TWU1CT0xf
R1BMKGRldm1fY291bnRlcl9yZWdpc3Rlcik7Ci0KLXN0YXRpYyBpbnQgZGV2bV9jb3VudGVyX21h
dGNoKHN0cnVjdCBkZXZpY2UgKmRldiwgdm9pZCAqcmVzLCB2b2lkICpkYXRhKQotewotCXN0cnVj
dCBjb3VudGVyX2RldmljZSAqKnIgPSByZXM7Ci0KLQlpZiAoIXIgfHwgISpyKSB7Ci0JCVdBUk5f
T04oIXIgfHwgISpyKTsKLQkJcmV0dXJuIDA7Ci0JfQotCi0JcmV0dXJuICpyID09IGRhdGE7Ci19
Ci0KLS8qKgotICogZGV2bV9jb3VudGVyX3VucmVnaXN0ZXIgLSBSZXNvdXJjZS1tYW5hZ2VkIGNv
dW50ZXJfdW5yZWdpc3RlcgotICogQGRldjoJZGV2aWNlIHRoaXMgY291bnRlcl9kZXZpY2UgYmVs
b25ncyB0bwotICogQGNvdW50ZXI6CXBvaW50ZXIgdG8gQ291bnRlciBhc3NvY2lhdGVkIHdpdGgg
dGhlIGRldmljZQotICoKLSAqIFVucmVnaXN0ZXIgQ291bnRlciByZWdpc3RlcmVkIHdpdGggZGV2
bV9jb3VudGVyX3JlZ2lzdGVyLgotICovCi12b2lkIGRldm1fY291bnRlcl91bnJlZ2lzdGVyKHN0
cnVjdCBkZXZpY2UgKmRldiwKLQkJCSAgICAgc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb25zdCBj
b3VudGVyKQotewotCWludCByYzsKLQotCXJjID0gZGV2cmVzX3JlbGVhc2UoZGV2LCBkZXZtX2Nv
dW50ZXJfdW5yZWcsIGRldm1fY291bnRlcl9tYXRjaCwKLQkJCSAgICBjb3VudGVyKTsKLQlXQVJO
X09OKHJjKTsKLX0KLUVYUE9SVF9TWU1CT0xfR1BMKGRldm1fY291bnRlcl91bnJlZ2lzdGVyKTsK
LQotc3RhdGljIGludCBfX2luaXQgY291bnRlcl9pbml0KHZvaWQpCi17Ci0JcmV0dXJuIGJ1c19y
ZWdpc3RlcigmY291bnRlcl9idXNfdHlwZSk7Ci19Ci0KLXN0YXRpYyB2b2lkIF9fZXhpdCBjb3Vu
dGVyX2V4aXQodm9pZCkKLXsKLQlidXNfdW5yZWdpc3RlcigmY291bnRlcl9idXNfdHlwZSk7Ci19
Ci0KLXN1YnN5c19pbml0Y2FsbChjb3VudGVyX2luaXQpOwotbW9kdWxlX2V4aXQoY291bnRlcl9l
eGl0KTsKLQotTU9EVUxFX0FVVEhPUigiV2lsbGlhbSBCcmVhdGhpdHQgR3JheSA8dmlsaGVsbS5n
cmF5QGdtYWlsLmNvbT4iKTsKLU1PRFVMRV9ERVNDUklQVElPTigiR2VuZXJpYyBDb3VudGVyIGlu
dGVyZmFjZSIpOwotTU9EVUxFX0xJQ0VOU0UoIkdQTCB2MiIpOwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9jb3VudGVyL2Z0bS1xdWFkZGVjLmMgYi9kcml2ZXJzL2NvdW50ZXIvZnRtLXF1YWRkZWMuYwpp
bmRleCA1M2MxNWY4NDkwOWIuLjA5MmE4MDZhNDZkOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9jb3Vu
dGVyL2Z0bS1xdWFkZGVjLmMKKysrIGIvZHJpdmVycy9jb3VudGVyL2Z0bS1xdWFkZGVjLmMKQEAg
LTE0LDYgKzE0LDcgQEAKICNpbmNsdWRlIDxsaW51eC9tdXRleC5oPgogI2luY2x1ZGUgPGxpbnV4
L2NvdW50ZXIuaD4KICNpbmNsdWRlIDxsaW51eC9iaXRmaWVsZC5oPgorI2luY2x1ZGUgPGxpbnV4
L3R5cGVzLmg+CiAKICNkZWZpbmUgRlRNX0ZJRUxEX1VQREFURShmdG0sIG9mZnNldCwgbWFzaywg
dmFsKQkJCVwKIAkoewkJCQkJCQkJXApAQCAtMTE1LDggKzExNiw3IEBAIHN0YXRpYyB2b2lkIGZ0
bV9xdWFkZGVjX2Rpc2FibGUodm9pZCAqZnRtKQogfQogCiBzdGF0aWMgaW50IGZ0bV9xdWFkZGVj
X2dldF9wcmVzY2FsZXIoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCSAgICAg
c3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkJCSAgICAgc2l6ZV90ICpjbnRfbW9kZSkK
KwkJCQkgICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgdTMyICpjbnRfbW9kZSkKIHsK
IAlzdHJ1Y3QgZnRtX3F1YWRkZWMgKmZ0bSA9IGNvdW50ZXItPnByaXY7CiAJdWludDMyX3Qgc2Nm
bGFnczsKQEAgLTEyOSw4ICsxMjksNyBAQCBzdGF0aWMgaW50IGZ0bV9xdWFkZGVjX2dldF9wcmVz
Y2FsZXIoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAogfQogCiBzdGF0aWMgaW50IGZ0
bV9xdWFkZGVjX3NldF9wcmVzY2FsZXIoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAot
CQkJCSAgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkJCSAgICAgc2l6ZV90IGNu
dF9tb2RlKQorCQkJCSAgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB1MzIgY250X21v
ZGUpCiB7CiAJc3RydWN0IGZ0bV9xdWFkZGVjICpmdG0gPSBjb3VudGVyLT5wcml2OwogCkBAIC0x
NTEsMzMgKzE1MCwyMSBAQCBzdGF0aWMgY29uc3QgY2hhciAqIGNvbnN0IGZ0bV9xdWFkZGVjX3By
ZXNjYWxlcltdID0gewogCSIxIiwgIjIiLCAiNCIsICI4IiwgIjE2IiwgIjMyIiwgIjY0IiwgIjEy
OCIKIH07CiAKLXN0YXRpYyBzdHJ1Y3QgY291bnRlcl9jb3VudF9lbnVtX2V4dCBmdG1fcXVhZGRl
Y19wcmVzY2FsZXJfZW51bSA9IHsKLQkuaXRlbXMgPSBmdG1fcXVhZGRlY19wcmVzY2FsZXIsCi0J
Lm51bV9pdGVtcyA9IEFSUkFZX1NJWkUoZnRtX3F1YWRkZWNfcHJlc2NhbGVyKSwKLQkuZ2V0ID0g
ZnRtX3F1YWRkZWNfZ2V0X3ByZXNjYWxlciwKLQkuc2V0ID0gZnRtX3F1YWRkZWNfc2V0X3ByZXNj
YWxlcgotfTsKLQotZW51bSBmdG1fcXVhZGRlY19zeW5hcHNlX2FjdGlvbiB7Ci0JRlRNX1FVQURE
RUNfU1lOQVBTRV9BQ1RJT05fQk9USF9FREdFUywKLX07Ci0KIHN0YXRpYyBjb25zdCBlbnVtIGNv
dW50ZXJfc3luYXBzZV9hY3Rpb24gZnRtX3F1YWRkZWNfc3luYXBzZV9hY3Rpb25zW10gPSB7Ci0J
W0ZUTV9RVUFEREVDX1NZTkFQU0VfQUNUSU9OX0JPVEhfRURHRVNdID0KIAlDT1VOVEVSX1NZTkFQ
U0VfQUNUSU9OX0JPVEhfRURHRVMKIH07CiAKIGVudW0gZnRtX3F1YWRkZWNfY291bnRfZnVuY3Rp
b24gewotCUZUTV9RVUFEREVDX0NPVU5UX0VOQ09ERVJfTU9ERV8xLAorCUZUTV9RVUFEREVDX0NP
VU5UX0VOQ09ERVJfTU9ERV8xID0gQ09VTlRFUl9GVU5DVElPTl9RVUFEUkFUVVJFX1g0LAogfTsK
IAogc3RhdGljIGNvbnN0IGVudW0gY291bnRlcl9mdW5jdGlvbiBmdG1fcXVhZGRlY19jb3VudF9m
dW5jdGlvbnNbXSA9IHsKLQlbRlRNX1FVQURERUNfQ09VTlRfRU5DT0RFUl9NT0RFXzFdID0gQ09V
TlRFUl9GVU5DVElPTl9RVUFEUkFUVVJFX1g0CisJRlRNX1FVQURERUNfQ09VTlRfRU5DT0RFUl9N
T0RFXzEKIH07CiAKIHN0YXRpYyBpbnQgZnRtX3F1YWRkZWNfY291bnRfcmVhZChzdHJ1Y3QgY291
bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAJCQkJICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQs
Ci0JCQkJICB1bnNpZ25lZCBsb25nICp2YWwpCisJCQkJICB1NjQgKnZhbCkKIHsKIAlzdHJ1Y3Qg
ZnRtX3F1YWRkZWMgKmNvbnN0IGZ0bSA9IGNvdW50ZXItPnByaXY7CiAJdWludDMyX3QgY250dmFs
OwpAQCAtMTkxLDcgKzE3OCw3IEBAIHN0YXRpYyBpbnQgZnRtX3F1YWRkZWNfY291bnRfcmVhZChz
dHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAKIHN0YXRpYyBpbnQgZnRtX3F1YWRkZWNf
Y291bnRfd3JpdGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAogCQkJCSAgIHN0cnVj
dCBjb3VudGVyX2NvdW50ICpjb3VudCwKLQkJCQkgICBjb25zdCB1bnNpZ25lZCBsb25nIHZhbCkK
KwkJCQkgICBjb25zdCB1NjQgdmFsKQogewogCXN0cnVjdCBmdG1fcXVhZGRlYyAqY29uc3QgZnRt
ID0gY291bnRlci0+cHJpdjsKIApAQCAtMjA1LDIxICsxOTIsMjEgQEAgc3RhdGljIGludCBmdG1f
cXVhZGRlY19jb3VudF93cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAJcmV0
dXJuIDA7CiB9CiAKLXN0YXRpYyBpbnQgZnRtX3F1YWRkZWNfY291bnRfZnVuY3Rpb25fZ2V0KHN0
cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQkJICBzdHJ1Y3QgY291bnRlcl9jb3Vu
dCAqY291bnQsCi0JCQkJCSAgc2l6ZV90ICpmdW5jdGlvbikKK3N0YXRpYyBpbnQgZnRtX3F1YWRk
ZWNfY291bnRfZnVuY3Rpb25fcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJ
CQkJCSAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKKwkJCQkJICAgZW51bSBjb3VudGVy
X2Z1bmN0aW9uICpmdW5jdGlvbikKIHsKIAkqZnVuY3Rpb24gPSBGVE1fUVVBRERFQ19DT1VOVF9F
TkNPREVSX01PREVfMTsKIAogCXJldHVybiAwOwogfQogCi1zdGF0aWMgaW50IGZ0bV9xdWFkZGVj
X2FjdGlvbl9nZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCSAgc3RydWN0
IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkJCSAgc3RydWN0IGNvdW50ZXJfc3luYXBzZSAqc3lu
YXBzZSwKLQkJCQkgIHNpemVfdCAqYWN0aW9uKQorc3RhdGljIGludCBmdG1fcXVhZGRlY19hY3Rp
b25fcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJICAgc3RydWN0IGNv
dW50ZXJfY291bnQgKmNvdW50LAorCQkJCSAgIHN0cnVjdCBjb3VudGVyX3N5bmFwc2UgKnN5bmFw
c2UsCisJCQkJICAgZW51bSBjb3VudGVyX3N5bmFwc2VfYWN0aW9uICphY3Rpb24pCiB7Ci0JKmFj
dGlvbiA9IEZUTV9RVUFEREVDX1NZTkFQU0VfQUNUSU9OX0JPVEhfRURHRVM7CisJKmFjdGlvbiA9
IENPVU5URVJfU1lOQVBTRV9BQ1RJT05fQk9USF9FREdFUzsKIAogCXJldHVybiAwOwogfQpAQCAt
MjI3LDggKzIxNCw4IEBAIHN0YXRpYyBpbnQgZnRtX3F1YWRkZWNfYWN0aW9uX2dldChzdHJ1Y3Qg
Y291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiBzdGF0aWMgY29uc3Qgc3RydWN0IGNvdW50ZXJfb3Bz
IGZ0bV9xdWFkZGVjX2NudF9vcHMgPSB7CiAJLmNvdW50X3JlYWQgPSBmdG1fcXVhZGRlY19jb3Vu
dF9yZWFkLAogCS5jb3VudF93cml0ZSA9IGZ0bV9xdWFkZGVjX2NvdW50X3dyaXRlLAotCS5mdW5j
dGlvbl9nZXQgPSBmdG1fcXVhZGRlY19jb3VudF9mdW5jdGlvbl9nZXQsCi0JLmFjdGlvbl9nZXQg
PSBmdG1fcXVhZGRlY19hY3Rpb25fZ2V0LAorCS5mdW5jdGlvbl9yZWFkID0gZnRtX3F1YWRkZWNf
Y291bnRfZnVuY3Rpb25fcmVhZCwKKwkuYWN0aW9uX3JlYWQgPSBmdG1fcXVhZGRlY19hY3Rpb25f
cmVhZCwKIH07CiAKIHN0YXRpYyBzdHJ1Y3QgY291bnRlcl9zaWduYWwgZnRtX3F1YWRkZWNfc2ln
bmFsc1tdID0gewpAQCAtMjU1LDkgKzI0MiwxMiBAQCBzdGF0aWMgc3RydWN0IGNvdW50ZXJfc3lu
YXBzZSBmdG1fcXVhZGRlY19jb3VudF9zeW5hcHNlc1tdID0gewogCX0KIH07CiAKLXN0YXRpYyBj
b25zdCBzdHJ1Y3QgY291bnRlcl9jb3VudF9leHQgZnRtX3F1YWRkZWNfY291bnRfZXh0W10gPSB7
Ci0JQ09VTlRFUl9DT1VOVF9FTlVNKCJwcmVzY2FsZXIiLCAmZnRtX3F1YWRkZWNfcHJlc2NhbGVy
X2VudW0pLAotCUNPVU5URVJfQ09VTlRfRU5VTV9BVkFJTEFCTEUoInByZXNjYWxlciIsICZmdG1f
cXVhZGRlY19wcmVzY2FsZXJfZW51bSksCitzdGF0aWMgREVGSU5FX0NPVU5URVJfRU5VTShmdG1f
cXVhZGRlY19wcmVzY2FsZXJfZW51bSwgZnRtX3F1YWRkZWNfcHJlc2NhbGVyKTsKKworc3RhdGlj
IHN0cnVjdCBjb3VudGVyX2NvbXAgZnRtX3F1YWRkZWNfY291bnRfZXh0W10gPSB7CisJQ09VTlRF
Ul9DT01QX0NPVU5UX0VOVU0oInByZXNjYWxlciIsIGZ0bV9xdWFkZGVjX2dldF9wcmVzY2FsZXIs
CisJCQkJZnRtX3F1YWRkZWNfc2V0X3ByZXNjYWxlciwKKwkJCQlmdG1fcXVhZGRlY19wcmVzY2Fs
ZXJfZW51bSksCiB9OwogCiBzdGF0aWMgc3RydWN0IGNvdW50ZXJfY291bnQgZnRtX3F1YWRkZWNf
Y291bnRzID0gewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9jb3VudGVyL2ludGVsLXFlcC5jIGIvZHJp
dmVycy9jb3VudGVyL2ludGVsLXFlcC5jCmluZGV4IDUxZjE2ZWQxYTdhMC4uZWQxZmQ3Y2YxODI5
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2NvdW50ZXIvaW50ZWwtcWVwLmMKKysrIGIvZHJpdmVycy9j
b3VudGVyL2ludGVsLXFlcC5jCkBAIC02MywxMyArNjMsNiBAQAogCiAjZGVmaW5lIElOVEVMX1FF
UF9DTEtfUEVSSU9EX05TCQkxMAogCi0jZGVmaW5lIElOVEVMX1FFUF9DT1VOVEVSX0VYVF9SVyhf
bmFtZSkJCQkJXAotewkJCQkJCQkJXAotCS5uYW1lID0gI19uYW1lLAkJCQkJCVwKLQkucmVhZCA9
IF9uYW1lIyNfcmVhZCwJCQkJCVwKLQkud3JpdGUgPSBfbmFtZSMjX3dyaXRlLAkJCQkJXAotfQot
CiBzdHJ1Y3QgaW50ZWxfcWVwIHsKIAlzdHJ1Y3QgY291bnRlcl9kZXZpY2UgY291bnRlcjsKIAlz
dHJ1Y3QgbXV0ZXggbG9jazsKQEAgLTExNSw4ICsxMDgsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9x
ZXBfaW5pdChzdHJ1Y3QgaW50ZWxfcWVwICpxZXApCiB9CiAKIHN0YXRpYyBpbnQgaW50ZWxfcWVw
X2NvdW50X3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCXN0cnVjdCBj
b3VudGVyX2NvdW50ICpjb3VudCwKLQkJCQl1bnNpZ25lZCBsb25nICp2YWwpCisJCQkJc3RydWN0
IGNvdW50ZXJfY291bnQgKmNvdW50LCB1NjQgKnZhbCkKIHsKIAlzdHJ1Y3QgaW50ZWxfcWVwICpj
b25zdCBxZXAgPSBjb3VudGVyLT5wcml2OwogCkBAIC0xMzEsMTEgKzEyMywxMSBAQCBzdGF0aWMg
Y29uc3QgZW51bSBjb3VudGVyX2Z1bmN0aW9uIGludGVsX3FlcF9jb3VudF9mdW5jdGlvbnNbXSA9
IHsKIAlDT1VOVEVSX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDQsCiB9OwogCi1zdGF0aWMgaW50IGlu
dGVsX3FlcF9mdW5jdGlvbl9nZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJ
CSAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkJCSAgc2l6ZV90ICpmdW5jdGlvbikK
K3N0YXRpYyBpbnQgaW50ZWxfcWVwX2Z1bmN0aW9uX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNl
ICpjb3VudGVyLAorCQkJCSAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKKwkJCQkgICBl
bnVtIGNvdW50ZXJfZnVuY3Rpb24gKmZ1bmN0aW9uKQogewotCSpmdW5jdGlvbiA9IDA7CisJKmZ1
bmN0aW9uID0gQ09VTlRFUl9GVU5DVElPTl9RVUFEUkFUVVJFX1g0OwogCiAJcmV0dXJuIDA7CiB9
CkBAIC0xNDQsMTkgKzEzNiwxOSBAQCBzdGF0aWMgY29uc3QgZW51bSBjb3VudGVyX3N5bmFwc2Vf
YWN0aW9uIGludGVsX3FlcF9zeW5hcHNlX2FjdGlvbnNbXSA9IHsKIAlDT1VOVEVSX1NZTkFQU0Vf
QUNUSU9OX0JPVEhfRURHRVMsCiB9OwogCi1zdGF0aWMgaW50IGludGVsX3FlcF9hY3Rpb25fZ2V0
KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQlzdHJ1Y3QgY291bnRlcl9jb3Vu
dCAqY291bnQsCi0JCQkJc3RydWN0IGNvdW50ZXJfc3luYXBzZSAqc3luYXBzZSwKLQkJCQlzaXpl
X3QgKmFjdGlvbikKK3N0YXRpYyBpbnQgaW50ZWxfcWVwX2FjdGlvbl9yZWFkKHN0cnVjdCBjb3Vu
dGVyX2RldmljZSAqY291bnRlciwKKwkJCQkgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAor
CQkJCSBzdHJ1Y3QgY291bnRlcl9zeW5hcHNlICpzeW5hcHNlLAorCQkJCSBlbnVtIGNvdW50ZXJf
c3luYXBzZV9hY3Rpb24gKmFjdGlvbikKIHsKLQkqYWN0aW9uID0gMDsKKwkqYWN0aW9uID0gQ09V
TlRFUl9TWU5BUFNFX0FDVElPTl9CT1RIX0VER0VTOwogCXJldHVybiAwOwogfQogCiBzdGF0aWMg
Y29uc3Qgc3RydWN0IGNvdW50ZXJfb3BzIGludGVsX3FlcF9jb3VudGVyX29wcyA9IHsKIAkuY291
bnRfcmVhZCA9IGludGVsX3FlcF9jb3VudF9yZWFkLAotCS5mdW5jdGlvbl9nZXQgPSBpbnRlbF9x
ZXBfZnVuY3Rpb25fZ2V0LAotCS5hY3Rpb25fZ2V0ID0gaW50ZWxfcWVwX2FjdGlvbl9nZXQsCisJ
LmZ1bmN0aW9uX3JlYWQgPSBpbnRlbF9xZXBfZnVuY3Rpb25fcmVhZCwKKwkuYWN0aW9uX3JlYWQg
PSBpbnRlbF9xZXBfYWN0aW9uX3JlYWQsCiB9OwogCiAjZGVmaW5lIElOVEVMX1FFUF9TSUdOQUwo
X2lkLCBfbmFtZSkgewkJCQlcCkBAIC0xODIsMzEgKzE3NCwyNyBAQCBzdGF0aWMgc3RydWN0IGNv
dW50ZXJfc3luYXBzZSBpbnRlbF9xZXBfY291bnRfc3luYXBzZXNbXSA9IHsKIAlJTlRFTF9RRVBf
U1lOQVBTRSgyKSwKIH07CiAKLXN0YXRpYyBzc2l6ZV90IGNlaWxpbmdfcmVhZChzdHJ1Y3QgY291
bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50
LAotCQkJICAgIHZvaWQgKnByaXYsIGNoYXIgKmJ1ZikKK3N0YXRpYyBpbnQgaW50ZWxfcWVwX2Nl
aWxpbmdfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJICBzdHJ1Y3Qg
Y291bnRlcl9jb3VudCAqY291bnQsIHU2NCAqY2VpbGluZykKIHsKIAlzdHJ1Y3QgaW50ZWxfcWVw
ICpxZXAgPSBjb3VudGVyLT5wcml2OwotCXUzMiByZWc7CiAKIAlwbV9ydW50aW1lX2dldF9zeW5j
KHFlcC0+ZGV2KTsKLQlyZWcgPSBpbnRlbF9xZXBfcmVhZGwocWVwLCBJTlRFTF9RRVBNQVgpOwor
CSpjZWlsaW5nID0gaW50ZWxfcWVwX3JlYWRsKHFlcCwgSU5URUxfUUVQTUFYKTsKIAlwbV9ydW50
aW1lX3B1dChxZXAtPmRldik7CiAKLQlyZXR1cm4gc3lzZnNfZW1pdChidWYsICIldVxuIiwgcmVn
KTsKKwlyZXR1cm4gMDsKIH0KIAotc3RhdGljIHNzaXplX3QgY2VpbGluZ193cml0ZShzdHJ1Y3Qg
Y291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkgICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpj
b3VudCwKLQkJCSAgICAgdm9pZCAqcHJpdiwgY29uc3QgY2hhciAqYnVmLCBzaXplX3QgbGVuKQor
c3RhdGljIGludCBpbnRlbF9xZXBfY2VpbGluZ193cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2Ug
KmNvdW50ZXIsCisJCQkJICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB1NjQgbWF4KQog
ewogCXN0cnVjdCBpbnRlbF9xZXAgKnFlcCA9IGNvdW50ZXItPnByaXY7Ci0JdTMyIG1heDsKLQlp
bnQgcmV0OworCWludCByZXQgPSAwOwogCi0JcmV0ID0ga3N0cnRvdTMyKGJ1ZiwgMCwgJm1heCk7
Ci0JaWYgKHJldCA8IDApCi0JCXJldHVybiByZXQ7CisJLyogSW50ZWwgUUVQIGNlaWxpbmcgY29u
ZmlndXJhdGlvbiBvbmx5IHN1cHBvcnRzIDMyLWJpdCB2YWx1ZXMgKi8KKwlpZiAobWF4ICE9ICh1
MzIpbWF4KQorCQlyZXR1cm4gLUVSQU5HRTsKIAogCW11dGV4X2xvY2soJnFlcC0+bG9jayk7CiAJ
aWYgKHFlcC0+ZW5hYmxlZCkgewpAQCAtMjE3LDM0ICsyMDUsMjggQEAgc3RhdGljIHNzaXplX3Qg
Y2VpbGluZ193cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAJcG1fcnVudGlt
ZV9nZXRfc3luYyhxZXAtPmRldik7CiAJaW50ZWxfcWVwX3dyaXRlbChxZXAsIElOVEVMX1FFUE1B
WCwgbWF4KTsKIAlwbV9ydW50aW1lX3B1dChxZXAtPmRldik7Ci0JcmV0ID0gbGVuOwogCiBvdXQ6
CiAJbXV0ZXhfdW5sb2NrKCZxZXAtPmxvY2spOwogCXJldHVybiByZXQ7CiB9CiAKLXN0YXRpYyBz
c2l6ZV90IGVuYWJsZV9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCSAg
IHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKLQkJCSAgIHZvaWQgKnByaXYsIGNoYXIgKmJ1
ZikKK3N0YXRpYyBpbnQgaW50ZWxfcWVwX2VuYWJsZV9yZWFkKHN0cnVjdCBjb3VudGVyX2Rldmlj
ZSAqY291bnRlciwKKwkJCQkgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB1OCAqZW5hYmxl
KQogewogCXN0cnVjdCBpbnRlbF9xZXAgKnFlcCA9IGNvdW50ZXItPnByaXY7CiAKLQlyZXR1cm4g
c3lzZnNfZW1pdChidWYsICIldVxuIiwgcWVwLT5lbmFibGVkKTsKKwkqZW5hYmxlID0gcWVwLT5l
bmFibGVkOworCisJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBzc2l6ZV90IGVuYWJsZV93cml0ZShz
dHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkgICAgc3RydWN0IGNvdW50ZXJfY291
bnQgKmNvdW50LAotCQkJICAgIHZvaWQgKnByaXYsIGNvbnN0IGNoYXIgKmJ1Ziwgc2l6ZV90IGxl
bikKK3N0YXRpYyBpbnQgaW50ZWxfcWVwX2VuYWJsZV93cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZp
Y2UgKmNvdW50ZXIsCisJCQkJICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHU4IHZhbCkK
IHsKIAlzdHJ1Y3QgaW50ZWxfcWVwICpxZXAgPSBjb3VudGVyLT5wcml2OwogCXUzMiByZWc7Ci0J
Ym9vbCB2YWwsIGNoYW5nZWQ7Ci0JaW50IHJldDsKLQotCXJldCA9IGtzdHJ0b2Jvb2woYnVmLCAm
dmFsKTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OworCWJvb2wgY2hhbmdlZDsKIAogCW11dGV4
X2xvY2soJnFlcC0+bG9jayk7CiAJY2hhbmdlZCA9IHZhbCBeIHFlcC0+ZW5hYmxlZDsKQEAgLTI2
OCwxMiArMjUwLDEyIEBAIHN0YXRpYyBzc2l6ZV90IGVuYWJsZV93cml0ZShzdHJ1Y3QgY291bnRl
cl9kZXZpY2UgKmNvdW50ZXIsCiAKIG91dDoKIAltdXRleF91bmxvY2soJnFlcC0+bG9jayk7Ci0J
cmV0dXJuIGxlbjsKKwlyZXR1cm4gMDsKIH0KIAotc3RhdGljIHNzaXplX3Qgc3Bpa2VfZmlsdGVy
X25zX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCSAgICBzdHJ1Y3Qg
Y291bnRlcl9jb3VudCAqY291bnQsCi0JCQkJICAgIHZvaWQgKnByaXYsIGNoYXIgKmJ1ZikKK3N0
YXRpYyBpbnQgaW50ZWxfcWVwX3NwaWtlX2ZpbHRlcl9uc19yZWFkKHN0cnVjdCBjb3VudGVyX2Rl
dmljZSAqY291bnRlciwKKwkJCQkJICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCisJCQkJ
CSAgdTY0ICpsZW5ndGgpCiB7CiAJc3RydWN0IGludGVsX3FlcCAqcWVwID0gY291bnRlci0+cHJp
djsKIAl1MzIgcmVnOwpAQCAtMjgyLDI2ICsyNjQsMjQgQEAgc3RhdGljIHNzaXplX3Qgc3Bpa2Vf
ZmlsdGVyX25zX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAogCXJlZyA9IGlu
dGVsX3FlcF9yZWFkbChxZXAsIElOVEVMX1FFUENPTik7CiAJaWYgKCEocmVnICYgSU5URUxfUUVQ
Q09OX0ZMVF9FTikpIHsKIAkJcG1fcnVudGltZV9wdXQocWVwLT5kZXYpOwotCQlyZXR1cm4gc3lz
ZnNfZW1pdChidWYsICIwXG4iKTsKKwkJcmV0dXJuIDA7CiAJfQogCXJlZyA9IElOVEVMX1FFUEZM
VF9NQVhfQ09VTlQoaW50ZWxfcWVwX3JlYWRsKHFlcCwgSU5URUxfUUVQRkxUKSk7CiAJcG1fcnVu
dGltZV9wdXQocWVwLT5kZXYpOwogCi0JcmV0dXJuIHN5c2ZzX2VtaXQoYnVmLCAiJXVcbiIsIChy
ZWcgKyAyKSAqIElOVEVMX1FFUF9DTEtfUEVSSU9EX05TKTsKKwkqbGVuZ3RoID0gKHJlZyArIDIp
ICogSU5URUxfUUVQX0NMS19QRVJJT0RfTlM7CisKKwlyZXR1cm4gMDsKIH0KIAotc3RhdGljIHNz
aXplX3Qgc3Bpa2VfZmlsdGVyX25zX3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRl
ciwKLQkJCQkgICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKLQkJCQkgICAgIHZvaWQg
KnByaXYsIGNvbnN0IGNoYXIgKmJ1Ziwgc2l6ZV90IGxlbikKK3N0YXRpYyBpbnQgaW50ZWxfcWVw
X3NwaWtlX2ZpbHRlcl9uc193cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJ
CQkJCSAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKKwkJCQkJICAgdTY0IGxlbmd0aCkK
IHsKIAlzdHJ1Y3QgaW50ZWxfcWVwICpxZXAgPSBjb3VudGVyLT5wcml2OwotCXUzMiByZWcsIGxl
bmd0aDsKKwl1MzIgcmVnOwogCWJvb2wgZW5hYmxlOwotCWludCByZXQ7Ci0KLQlyZXQgPSBrc3Ry
dG91MzIoYnVmLCAwLCAmbGVuZ3RoKTsKLQlpZiAocmV0IDwgMCkKLQkJcmV0dXJuIHJldDsKKwlp
bnQgcmV0ID0gMDsKIAogCS8qCiAJICogU3Bpa2UgZmlsdGVyIGxlbmd0aCBpcyAoTUFYX0NPVU5U
ICsgMikgY2xvY2sgcGVyaW9kcy4KQEAgLTMzNywxNiArMzE3LDE1IEBAIHN0YXRpYyBzc2l6ZV90
IHNwaWtlX2ZpbHRlcl9uc193cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAJ
aW50ZWxfcWVwX3dyaXRlbChxZXAsIElOVEVMX1FFUEZMVCwgbGVuZ3RoKTsKIAlpbnRlbF9xZXBf
d3JpdGVsKHFlcCwgSU5URUxfUUVQQ09OLCByZWcpOwogCXBtX3J1bnRpbWVfcHV0KHFlcC0+ZGV2
KTsKLQlyZXQgPSBsZW47CiAKIG91dDoKIAltdXRleF91bmxvY2soJnFlcC0+bG9jayk7CiAJcmV0
dXJuIHJldDsKIH0KIAotc3RhdGljIHNzaXplX3QgcHJlc2V0X2VuYWJsZV9yZWFkKHN0cnVjdCBj
b3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQkgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3Vu
dCwKLQkJCQkgIHZvaWQgKnByaXYsIGNoYXIgKmJ1ZikKK3N0YXRpYyBpbnQgaW50ZWxfcWVwX3By
ZXNldF9lbmFibGVfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJCXN0
cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKKwkJCQkJdTggKnByZXNldF9lbmFibGUpCiB7CiAJ
c3RydWN0IGludGVsX3FlcCAqcWVwID0gY291bnRlci0+cHJpdjsKIAl1MzIgcmVnOwpAQCAtMzU0
LDIxICszMzMsMTggQEAgc3RhdGljIHNzaXplX3QgcHJlc2V0X2VuYWJsZV9yZWFkKHN0cnVjdCBj
b3VudGVyX2RldmljZSAqY291bnRlciwKIAlwbV9ydW50aW1lX2dldF9zeW5jKHFlcC0+ZGV2KTsK
IAlyZWcgPSBpbnRlbF9xZXBfcmVhZGwocWVwLCBJTlRFTF9RRVBDT04pOwogCXBtX3J1bnRpbWVf
cHV0KHFlcC0+ZGV2KTsKLQlyZXR1cm4gc3lzZnNfZW1pdChidWYsICIldVxuIiwgIShyZWcgJiBJ
TlRFTF9RRVBDT05fQ09VTlRfUlNUX01PREUpKTsKKworCSpwcmVzZXRfZW5hYmxlID0gIShyZWcg
JiBJTlRFTF9RRVBDT05fQ09VTlRfUlNUX01PREUpOworCisJcmV0dXJuIDA7CiB9CiAKLXN0YXRp
YyBzc2l6ZV90IHByZXNldF9lbmFibGVfd3JpdGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3Vu
dGVyLAotCQkJCSAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKLQkJCQkgICB2b2lkICpw
cml2LCBjb25zdCBjaGFyICpidWYsIHNpemVfdCBsZW4pCitzdGF0aWMgaW50IGludGVsX3FlcF9w
cmVzZXRfZW5hYmxlX3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkJ
IHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgdTggdmFsKQogewogCXN0cnVjdCBpbnRlbF9x
ZXAgKnFlcCA9IGNvdW50ZXItPnByaXY7CiAJdTMyIHJlZzsKLQlib29sIHZhbDsKLQlpbnQgcmV0
OwotCi0JcmV0ID0ga3N0cnRvYm9vbChidWYsICZ2YWwpOwotCWlmIChyZXQpCi0JCXJldHVybiBy
ZXQ7CisJaW50IHJldCA9IDA7CiAKIAltdXRleF9sb2NrKCZxZXAtPmxvY2spOwogCWlmIChxZXAt
PmVuYWJsZWQpIHsKQEAgLTM4NSw3ICszNjEsNiBAQCBzdGF0aWMgc3NpemVfdCBwcmVzZXRfZW5h
YmxlX3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKIAogCWludGVsX3FlcF93
cml0ZWwocWVwLCBJTlRFTF9RRVBDT04sIHJlZyk7CiAJcG1fcnVudGltZV9wdXQocWVwLT5kZXYp
OwotCXJldCA9IGxlbjsKIAogb3V0OgogCW11dGV4X3VubG9jaygmcWVwLT5sb2NrKTsKQEAgLTM5
MywxMSArMzY4LDE0IEBAIHN0YXRpYyBzc2l6ZV90IHByZXNldF9lbmFibGVfd3JpdGUoc3RydWN0
IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAogCXJldHVybiByZXQ7CiB9CiAKLXN0YXRpYyBjb25z
dCBzdHJ1Y3QgY291bnRlcl9jb3VudF9leHQgaW50ZWxfcWVwX2NvdW50X2V4dFtdID0gewotCUlO
VEVMX1FFUF9DT1VOVEVSX0VYVF9SVyhjZWlsaW5nKSwKLQlJTlRFTF9RRVBfQ09VTlRFUl9FWFRf
UlcoZW5hYmxlKSwKLQlJTlRFTF9RRVBfQ09VTlRFUl9FWFRfUlcoc3Bpa2VfZmlsdGVyX25zKSwK
LQlJTlRFTF9RRVBfQ09VTlRFUl9FWFRfUlcocHJlc2V0X2VuYWJsZSkKK3N0YXRpYyBzdHJ1Y3Qg
Y291bnRlcl9jb21wIGludGVsX3FlcF9jb3VudF9leHRbXSA9IHsKKwlDT1VOVEVSX0NPTVBfRU5B
QkxFKGludGVsX3FlcF9lbmFibGVfcmVhZCwgaW50ZWxfcWVwX2VuYWJsZV93cml0ZSksCisJQ09V
TlRFUl9DT01QX0NFSUxJTkcoaW50ZWxfcWVwX2NlaWxpbmdfcmVhZCwgaW50ZWxfcWVwX2NlaWxp
bmdfd3JpdGUpLAorCUNPVU5URVJfQ09NUF9QUkVTRVRfRU5BQkxFKGludGVsX3FlcF9wcmVzZXRf
ZW5hYmxlX3JlYWQsCisJCQkJICAgaW50ZWxfcWVwX3ByZXNldF9lbmFibGVfd3JpdGUpLAorCUNP
VU5URVJfQ09NUF9DT1VOVF9VNjQoInNwaWtlX2ZpbHRlcl9ucyIsCisJCQkgICAgICAgaW50ZWxf
cWVwX3NwaWtlX2ZpbHRlcl9uc19yZWFkLAorCQkJICAgICAgIGludGVsX3FlcF9zcGlrZV9maWx0
ZXJfbnNfd3JpdGUpLAogfTsKIAogc3RhdGljIHN0cnVjdCBjb3VudGVyX2NvdW50IGludGVsX3Fl
cF9jb3VudGVyX2NvdW50W10gPSB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2NvdW50ZXIvaW50ZXJy
dXB0LWNudC5jIGIvZHJpdmVycy9jb3VudGVyL2ludGVycnVwdC1jbnQuYwppbmRleCAzZGJiOGFj
YzY3ZWIuLjdiYTE5OTE3ZDgwZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9jb3VudGVyL2ludGVycnVw
dC1jbnQuYworKysgYi9kcml2ZXJzL2NvdW50ZXIvaW50ZXJydXB0LWNudC5jCkBAIC0xMCw2ICsx
MCw3IEBACiAjaW5jbHVkZSA8bGludXgvbW9kX2RldmljZXRhYmxlLmg+CiAjaW5jbHVkZSA8bGlu
dXgvbW9kdWxlLmg+CiAjaW5jbHVkZSA8bGludXgvcGxhdGZvcm1fZGV2aWNlLmg+CisjaW5jbHVk
ZSA8bGludXgvdHlwZXMuaD4KIAogI2RlZmluZSBJTlRFUlJVUFRfQ05UX05BTUUgImludGVycnVw
dC1jbnQiCiAKQEAgLTMzLDMwICszNCwyMyBAQCBzdGF0aWMgaXJxcmV0dXJuX3QgaW50ZXJydXB0
X2NudF9pc3IoaW50IGlycSwgdm9pZCAqZGV2X2lkKQogCXJldHVybiBJUlFfSEFORExFRDsKIH0K
IAotc3RhdGljIHNzaXplX3QgaW50ZXJydXB0X2NudF9lbmFibGVfcmVhZChzdHJ1Y3QgY291bnRl
cl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkJCSBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCi0J
CQkJCSB2b2lkICpwcml2YXRlLCBjaGFyICpidWYpCitzdGF0aWMgaW50IGludGVycnVwdF9jbnRf
ZW5hYmxlX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCSAgICAgc3Ry
dWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB1OCAqZW5hYmxlKQogewogCXN0cnVjdCBpbnRlcnJ1
cHRfY250X3ByaXYgKnByaXYgPSBjb3VudGVyLT5wcml2OwogCi0JcmV0dXJuIHN5c2ZzX2VtaXQo
YnVmLCAiJWRcbiIsIHByaXYtPmVuYWJsZWQpOworCSplbmFibGUgPSBwcml2LT5lbmFibGVkOwor
CisJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBzc2l6ZV90IGludGVycnVwdF9jbnRfZW5hYmxlX3dy
aXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQkJICBzdHJ1Y3QgY291bnRl
cl9jb3VudCAqY291bnQsCi0JCQkJCSAgdm9pZCAqcHJpdmF0ZSwgY29uc3QgY2hhciAqYnVmLAot
CQkJCQkgIHNpemVfdCBsZW4pCitzdGF0aWMgaW50IGludGVycnVwdF9jbnRfZW5hYmxlX3dyaXRl
KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkgICAgICBzdHJ1Y3QgY291bnRl
cl9jb3VudCAqY291bnQsIHU4IGVuYWJsZSkKIHsKIAlzdHJ1Y3QgaW50ZXJydXB0X2NudF9wcml2
ICpwcml2ID0gY291bnRlci0+cHJpdjsKLQlib29sIGVuYWJsZTsKLQlzc2l6ZV90IHJldDsKLQot
CXJldCA9IGtzdHJ0b2Jvb2woYnVmLCAmZW5hYmxlKTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0
OwogCiAJaWYgKHByaXYtPmVuYWJsZWQgPT0gZW5hYmxlKQotCQlyZXR1cm4gbGVuOworCQlyZXR1
cm4gMDsKIAogCWlmIChlbmFibGUpIHsKIAkJcHJpdi0+ZW5hYmxlZCA9IHRydWU7CkBAIC02Niwz
MyArNjAsMzAgQEAgc3RhdGljIHNzaXplX3QgaW50ZXJydXB0X2NudF9lbmFibGVfd3JpdGUoc3Ry
dWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAogCQlwcml2LT5lbmFibGVkID0gZmFsc2U7CiAJ
fQogCi0JcmV0dXJuIGxlbjsKKwlyZXR1cm4gMDsKIH0KIAotc3RhdGljIGNvbnN0IHN0cnVjdCBj
b3VudGVyX2NvdW50X2V4dCBpbnRlcnJ1cHRfY250X2V4dFtdID0gewotCXsKLQkJLm5hbWUgPSAi
ZW5hYmxlIiwKLQkJLnJlYWQgPSBpbnRlcnJ1cHRfY250X2VuYWJsZV9yZWFkLAotCQkud3JpdGUg
PSBpbnRlcnJ1cHRfY250X2VuYWJsZV93cml0ZSwKLQl9LAorc3RhdGljIHN0cnVjdCBjb3VudGVy
X2NvbXAgaW50ZXJydXB0X2NudF9leHRbXSA9IHsKKwlDT1VOVEVSX0NPTVBfRU5BQkxFKGludGVy
cnVwdF9jbnRfZW5hYmxlX3JlYWQsCisJCQkgICAgaW50ZXJydXB0X2NudF9lbmFibGVfd3JpdGUp
LAogfTsKIAogc3RhdGljIGNvbnN0IGVudW0gY291bnRlcl9zeW5hcHNlX2FjdGlvbiBpbnRlcnJ1
cHRfY250X3N5bmFwc2VfYWN0aW9uc3NbXSA9IHsKIAlDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX1JJ
U0lOR19FREdFLAogfTsKIAotc3RhdGljIGludCBpbnRlcnJ1cHRfY250X2FjdGlvbl9nZXQoc3Ry
dWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCSAgICBzdHJ1Y3QgY291bnRlcl9jb3Vu
dCAqY291bnQsCi0JCQkJICAgIHN0cnVjdCBjb3VudGVyX3N5bmFwc2UgKnN5bmFwc2UsCi0JCQkJ
ICAgIHNpemVfdCAqYWN0aW9uKQorc3RhdGljIGludCBpbnRlcnJ1cHRfY250X2FjdGlvbl9yZWFk
KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkgICAgIHN0cnVjdCBjb3VudGVy
X2NvdW50ICpjb3VudCwKKwkJCQkgICAgIHN0cnVjdCBjb3VudGVyX3N5bmFwc2UgKnN5bmFwc2Us
CisJCQkJICAgICBlbnVtIGNvdW50ZXJfc3luYXBzZV9hY3Rpb24gKmFjdGlvbikKIHsKLQkqYWN0
aW9uID0gMDsKKwkqYWN0aW9uID0gQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9SSVNJTkdfRURHRTsK
IAogCXJldHVybiAwOwogfQogCiBzdGF0aWMgaW50IGludGVycnVwdF9jbnRfcmVhZChzdHJ1Y3Qg
Y291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkgICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAq
Y291bnQsIHVuc2lnbmVkIGxvbmcgKnZhbCkKKwkJCSAgICAgIHN0cnVjdCBjb3VudGVyX2NvdW50
ICpjb3VudCwgdTY0ICp2YWwpCiB7CiAJc3RydWN0IGludGVycnVwdF9jbnRfcHJpdiAqcHJpdiA9
IGNvdW50ZXItPnByaXY7CiAKQEAgLTEwMiw4ICs5Myw3IEBAIHN0YXRpYyBpbnQgaW50ZXJydXB0
X2NudF9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKIH0KIAogc3RhdGljIGlu
dCBpbnRlcnJ1cHRfY250X3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJ
CSAgICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCi0JCQkgICAgICAgY29uc3QgdW5z
aWduZWQgbG9uZyB2YWwpCisJCQkgICAgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCBj
b25zdCB1NjQgdmFsKQogewogCXN0cnVjdCBpbnRlcnJ1cHRfY250X3ByaXYgKnByaXYgPSBjb3Vu
dGVyLT5wcml2OwogCkBAIC0xMTksMTEgKzEwOSwxMSBAQCBzdGF0aWMgY29uc3QgZW51bSBjb3Vu
dGVyX2Z1bmN0aW9uIGludGVycnVwdF9jbnRfZnVuY3Rpb25zW10gPSB7CiAJQ09VTlRFUl9GVU5D
VElPTl9JTkNSRUFTRSwKIH07CiAKLXN0YXRpYyBpbnQgaW50ZXJydXB0X2NudF9mdW5jdGlvbl9n
ZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCSAgICAgIHN0cnVjdCBjb3Vu
dGVyX2NvdW50ICpjb3VudCwKLQkJCQkgICAgICBzaXplX3QgKmZ1bmN0aW9uKQorc3RhdGljIGlu
dCBpbnRlcnJ1cHRfY250X2Z1bmN0aW9uX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3Vu
dGVyLAorCQkJCSAgICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCisJCQkJICAgICAg
IGVudW0gY291bnRlcl9mdW5jdGlvbiAqZnVuY3Rpb24pCiB7Ci0JKmZ1bmN0aW9uID0gMDsKKwkq
ZnVuY3Rpb24gPSBDT1VOVEVSX0ZVTkNUSU9OX0lOQ1JFQVNFOwogCiAJcmV0dXJuIDA7CiB9CkBA
IC0xNDgsMTAgKzEzOCwxMCBAQCBzdGF0aWMgaW50IGludGVycnVwdF9jbnRfc2lnbmFsX3JlYWQo
c3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAogfQogCiBzdGF0aWMgY29uc3Qgc3RydWN0
IGNvdW50ZXJfb3BzIGludGVycnVwdF9jbnRfb3BzID0gewotCS5hY3Rpb25fZ2V0ID0gaW50ZXJy
dXB0X2NudF9hY3Rpb25fZ2V0LAorCS5hY3Rpb25fcmVhZCA9IGludGVycnVwdF9jbnRfYWN0aW9u
X3JlYWQsCiAJLmNvdW50X3JlYWQgPSBpbnRlcnJ1cHRfY250X3JlYWQsCiAJLmNvdW50X3dyaXRl
ID0gaW50ZXJydXB0X2NudF93cml0ZSwKLQkuZnVuY3Rpb25fZ2V0ID0gaW50ZXJydXB0X2NudF9m
dW5jdGlvbl9nZXQsCisJLmZ1bmN0aW9uX3JlYWQgPSBpbnRlcnJ1cHRfY250X2Z1bmN0aW9uX3Jl
YWQsCiAJLnNpZ25hbF9yZWFkICA9IGludGVycnVwdF9jbnRfc2lnbmFsX3JlYWQsCiB9OwogCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2NvdW50ZXIvbWljcm9jaGlwLXRjYi1jYXB0dXJlLmMgYi9kcml2
ZXJzL2NvdW50ZXIvbWljcm9jaGlwLXRjYi1jYXB0dXJlLmMKaW5kZXggNGM1N2Q0M2U3ZDY2Li43
OWUwYzg0YTNiODEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvY291bnRlci9taWNyb2NoaXAtdGNiLWNh
cHR1cmUuYworKysgYi9kcml2ZXJzL2NvdW50ZXIvbWljcm9jaGlwLXRjYi1jYXB0dXJlLmMKQEAg
LTMyLDI4ICszMiwxNiBAQCBzdHJ1Y3QgbWNocF90Y19kYXRhIHsKIAlib29sIHRyaWdfaW52ZXJ0
ZWQ7CiB9OwogCi1lbnVtIG1jaHBfdGNfY291bnRfZnVuY3Rpb24gewotCU1DSFBfVENfRlVOQ1RJ
T05fSU5DUkVBU0UsCi0JTUNIUF9UQ19GVU5DVElPTl9RVUFEUkFUVVJFLAotfTsKLQotc3RhdGlj
IGNvbnN0IGVudW0gY291bnRlcl9jb3VudF9mdW5jdGlvbiBtY2hwX3RjX2NvdW50X2Z1bmN0aW9u
c1tdID0gewotCVtNQ0hQX1RDX0ZVTkNUSU9OX0lOQ1JFQVNFXSA9IENPVU5URVJfRlVOQ1RJT05f
SU5DUkVBU0UsCi0JW01DSFBfVENfRlVOQ1RJT05fUVVBRFJBVFVSRV0gPSBDT1VOVEVSX0ZVTkNU
SU9OX1FVQURSQVRVUkVfWDQsCi19OwotCi1lbnVtIG1jaHBfdGNfc3luYXBzZV9hY3Rpb24gewot
CU1DSFBfVENfU1lOQVBTRV9BQ1RJT05fTk9ORSA9IDAsCi0JTUNIUF9UQ19TWU5BUFNFX0FDVElP
Tl9SSVNJTkdfRURHRSwKLQlNQ0hQX1RDX1NZTkFQU0VfQUNUSU9OX0ZBTExJTkdfRURHRSwKLQlN
Q0hQX1RDX1NZTkFQU0VfQUNUSU9OX0JPVEhfRURHRQorc3RhdGljIGNvbnN0IGVudW0gY291bnRl
cl9mdW5jdGlvbiBtY2hwX3RjX2NvdW50X2Z1bmN0aW9uc1tdID0geworCUNPVU5URVJfRlVOQ1RJ
T05fSU5DUkVBU0UsCisJQ09VTlRFUl9GVU5DVElPTl9RVUFEUkFUVVJFX1g0LAogfTsKIAogc3Rh
dGljIGNvbnN0IGVudW0gY291bnRlcl9zeW5hcHNlX2FjdGlvbiBtY2hwX3RjX3N5bmFwc2VfYWN0
aW9uc1tdID0gewotCVtNQ0hQX1RDX1NZTkFQU0VfQUNUSU9OX05PTkVdID0gQ09VTlRFUl9TWU5B
UFNFX0FDVElPTl9OT05FLAotCVtNQ0hQX1RDX1NZTkFQU0VfQUNUSU9OX1JJU0lOR19FREdFXSA9
IENPVU5URVJfU1lOQVBTRV9BQ1RJT05fUklTSU5HX0VER0UsCi0JW01DSFBfVENfU1lOQVBTRV9B
Q1RJT05fRkFMTElOR19FREdFXSA9IENPVU5URVJfU1lOQVBTRV9BQ1RJT05fRkFMTElOR19FREdF
LAotCVtNQ0hQX1RDX1NZTkFQU0VfQUNUSU9OX0JPVEhfRURHRV0gPSBDT1VOVEVSX1NZTkFQU0Vf
QUNUSU9OX0JPVEhfRURHRVMsCisJQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9OT05FLAorCUNPVU5U
RVJfU1lOQVBTRV9BQ1RJT05fUklTSU5HX0VER0UsCisJQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9G
QUxMSU5HX0VER0UsCisJQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9CT1RIX0VER0VTLAogfTsKIAog
c3RhdGljIHN0cnVjdCBjb3VudGVyX3NpZ25hbCBtY2hwX3RjX2NvdW50X3NpZ25hbHNbXSA9IHsK
QEAgLTgwLDIzICs2OCwyMyBAQCBzdGF0aWMgc3RydWN0IGNvdW50ZXJfc3luYXBzZSBtY2hwX3Rj
X2NvdW50X3N5bmFwc2VzW10gPSB7CiAJfQogfTsKIAotc3RhdGljIGludCBtY2hwX3RjX2NvdW50
X2Z1bmN0aW9uX2dldChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkJICAgICAg
c3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkJCSAgICAgIHNpemVfdCAqZnVuY3Rpb24p
CitzdGF0aWMgaW50IG1jaHBfdGNfY291bnRfZnVuY3Rpb25fcmVhZChzdHJ1Y3QgY291bnRlcl9k
ZXZpY2UgKmNvdW50ZXIsCisJCQkJICAgICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwK
KwkJCQkgICAgICAgZW51bSBjb3VudGVyX2Z1bmN0aW9uICpmdW5jdGlvbikKIHsKIAlzdHJ1Y3Qg
bWNocF90Y19kYXRhICpjb25zdCBwcml2ID0gY291bnRlci0+cHJpdjsKIAogCWlmIChwcml2LT5x
ZGVjX21vZGUpCi0JCSpmdW5jdGlvbiA9IE1DSFBfVENfRlVOQ1RJT05fUVVBRFJBVFVSRTsKKwkJ
KmZ1bmN0aW9uID0gQ09VTlRFUl9GVU5DVElPTl9RVUFEUkFUVVJFX1g0OwogCWVsc2UKLQkJKmZ1
bmN0aW9uID0gTUNIUF9UQ19GVU5DVElPTl9JTkNSRUFTRTsKKwkJKmZ1bmN0aW9uID0gQ09VTlRF
Ul9GVU5DVElPTl9JTkNSRUFTRTsKIAogCXJldHVybiAwOwogfQogCi1zdGF0aWMgaW50IG1jaHBf
dGNfY291bnRfZnVuY3Rpb25fc2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJ
CQkgICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCi0JCQkJICAgICAgc2l6ZV90IGZ1
bmN0aW9uKQorc3RhdGljIGludCBtY2hwX3RjX2NvdW50X2Z1bmN0aW9uX3dyaXRlKHN0cnVjdCBj
b3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkJc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50
LAorCQkJCQllbnVtIGNvdW50ZXJfZnVuY3Rpb24gZnVuY3Rpb24pCiB7CiAJc3RydWN0IG1jaHBf
dGNfZGF0YSAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7CiAJdTMyIGJtciwgY21yOwpAQCAt
MTA4LDcgKzk2LDcgQEAgc3RhdGljIGludCBtY2hwX3RjX2NvdW50X2Z1bmN0aW9uX3NldChzdHJ1
Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAJY21yICY9IH5BVE1FTF9UQ19XQVZFOwogCiAJ
c3dpdGNoIChmdW5jdGlvbikgewotCWNhc2UgTUNIUF9UQ19GVU5DVElPTl9JTkNSRUFTRToKKwlj
YXNlIENPVU5URVJfRlVOQ1RJT05fSU5DUkVBU0U6CiAJCXByaXYtPnFkZWNfbW9kZSA9IDA7CiAJ
CS8qIFNldCBoaWdoZXN0IHJhdGUgYmFzZWQgb24gd2hldGhlciBzb2MgaGFzIGdjbGsgb3Igbm90
ICovCiAJCWJtciAmPSB+KEFUTUVMX1RDX1FERU4gfCBBVE1FTF9UQ19QT1NFTik7CkBAIC0xMjAs
NyArMTA4LDcgQEAgc3RhdGljIGludCBtY2hwX3RjX2NvdW50X2Z1bmN0aW9uX3NldChzdHJ1Y3Qg
Y291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAJCWNtciB8PSAgQVRNRUxfVENfQ01SX01BU0s7CiAJ
CWNtciAmPSB+KEFUTUVMX1RDX0FCRVRSRyB8IEFUTUVMX1RDX1hDMCk7CiAJCWJyZWFrOwotCWNh
c2UgTUNIUF9UQ19GVU5DVElPTl9RVUFEUkFUVVJFOgorCWNhc2UgQ09VTlRFUl9GVU5DVElPTl9R
VUFEUkFUVVJFX1g0OgogCQlpZiAoIXByaXYtPnRjX2NmZy0+aGFzX3FkZWMpCiAJCQlyZXR1cm4g
LUVJTlZBTDsKIAkJLyogSW4gUURFQyBtb2RlIHNldHRpbmdzIGJvdGggY2hhbm5lbHMgMCBhbmQg
MSBhcmUgcmVxdWlyZWQgKi8KQEAgLTE3NiwxMCArMTY0LDEwIEBAIHN0YXRpYyBpbnQgbWNocF90
Y19jb3VudF9zaWduYWxfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAJcmV0
dXJuIDA7CiB9CiAKLXN0YXRpYyBpbnQgbWNocF90Y19jb3VudF9hY3Rpb25fZ2V0KHN0cnVjdCBj
b3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQkgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNv
dW50LAotCQkJCSAgICBzdHJ1Y3QgY291bnRlcl9zeW5hcHNlICpzeW5hcHNlLAotCQkJCSAgICBz
aXplX3QgKmFjdGlvbikKK3N0YXRpYyBpbnQgbWNocF90Y19jb3VudF9hY3Rpb25fcmVhZChzdHJ1
Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJICAgICBzdHJ1Y3QgY291bnRlcl9jb3Vu
dCAqY291bnQsCisJCQkJICAgICBzdHJ1Y3QgY291bnRlcl9zeW5hcHNlICpzeW5hcHNlLAorCQkJ
CSAgICAgZW51bSBjb3VudGVyX3N5bmFwc2VfYWN0aW9uICphY3Rpb24pCiB7CiAJc3RydWN0IG1j
aHBfdGNfZGF0YSAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7CiAJdTMyIGNtcjsKQEAgLTE4
OCwyNiArMTc2LDI2IEBAIHN0YXRpYyBpbnQgbWNocF90Y19jb3VudF9hY3Rpb25fZ2V0KHN0cnVj
dCBjb3VudGVyX2RldmljZSAqY291bnRlciwKIAogCXN3aXRjaCAoY21yICYgQVRNRUxfVENfRVRS
R0VERykgewogCWRlZmF1bHQ6Ci0JCSphY3Rpb24gPSBNQ0hQX1RDX1NZTkFQU0VfQUNUSU9OX05P
TkU7CisJCSphY3Rpb24gPSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX05PTkU7CiAJCWJyZWFrOwog
CWNhc2UgQVRNRUxfVENfRVRSR0VER19SSVNJTkc6Ci0JCSphY3Rpb24gPSBNQ0hQX1RDX1NZTkFQ
U0VfQUNUSU9OX1JJU0lOR19FREdFOworCQkqYWN0aW9uID0gQ09VTlRFUl9TWU5BUFNFX0FDVElP
Tl9SSVNJTkdfRURHRTsKIAkJYnJlYWs7CiAJY2FzZSBBVE1FTF9UQ19FVFJHRURHX0ZBTExJTkc6
Ci0JCSphY3Rpb24gPSBNQ0hQX1RDX1NZTkFQU0VfQUNUSU9OX0ZBTExJTkdfRURHRTsKKwkJKmFj
dGlvbiA9IENPVU5URVJfU1lOQVBTRV9BQ1RJT05fRkFMTElOR19FREdFOwogCQlicmVhazsKIAlj
YXNlIEFUTUVMX1RDX0VUUkdFREdfQk9USDoKLQkJKmFjdGlvbiA9IE1DSFBfVENfU1lOQVBTRV9B
Q1RJT05fQk9USF9FREdFOworCQkqYWN0aW9uID0gQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9CT1RI
X0VER0VTOwogCQlicmVhazsKIAl9CiAKIAlyZXR1cm4gMDsKIH0KIAotc3RhdGljIGludCBtY2hw
X3RjX2NvdW50X2FjdGlvbl9zZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJ
CSAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCi0JCQkJICAgIHN0cnVjdCBjb3VudGVy
X3N5bmFwc2UgKnN5bmFwc2UsCi0JCQkJICAgIHNpemVfdCBhY3Rpb24pCitzdGF0aWMgaW50IG1j
aHBfdGNfY291bnRfYWN0aW9uX3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwK
KwkJCQkgICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCisJCQkJICAgICAgc3RydWN0
IGNvdW50ZXJfc3luYXBzZSAqc3luYXBzZSwKKwkJCQkgICAgICBlbnVtIGNvdW50ZXJfc3luYXBz
ZV9hY3Rpb24gYWN0aW9uKQogewogCXN0cnVjdCBtY2hwX3RjX2RhdGEgKmNvbnN0IHByaXYgPSBj
b3VudGVyLT5wcml2OwogCXUzMiBlZGdlID0gQVRNRUxfVENfRVRSR0VER19OT05FOwpAQCAtMjE3
LDE2ICsyMDUsMTYgQEAgc3RhdGljIGludCBtY2hwX3RjX2NvdW50X2FjdGlvbl9zZXQoc3RydWN0
IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAogCQlyZXR1cm4gLUVJTlZBTDsKIAogCXN3aXRjaCAo
YWN0aW9uKSB7Ci0JY2FzZSBNQ0hQX1RDX1NZTkFQU0VfQUNUSU9OX05PTkU6CisJY2FzZSBDT1VO
VEVSX1NZTkFQU0VfQUNUSU9OX05PTkU6CiAJCWVkZ2UgPSBBVE1FTF9UQ19FVFJHRURHX05PTkU7
CiAJCWJyZWFrOwotCWNhc2UgTUNIUF9UQ19TWU5BUFNFX0FDVElPTl9SSVNJTkdfRURHRToKKwlj
YXNlIENPVU5URVJfU1lOQVBTRV9BQ1RJT05fUklTSU5HX0VER0U6CiAJCWVkZ2UgPSBBVE1FTF9U
Q19FVFJHRURHX1JJU0lORzsKIAkJYnJlYWs7Ci0JY2FzZSBNQ0hQX1RDX1NZTkFQU0VfQUNUSU9O
X0ZBTExJTkdfRURHRToKKwljYXNlIENPVU5URVJfU1lOQVBTRV9BQ1RJT05fRkFMTElOR19FREdF
OgogCQllZGdlID0gQVRNRUxfVENfRVRSR0VER19GQUxMSU5HOwogCQlicmVhazsKLQljYXNlIE1D
SFBfVENfU1lOQVBTRV9BQ1RJT05fQk9USF9FREdFOgorCWNhc2UgQ09VTlRFUl9TWU5BUFNFX0FD
VElPTl9CT1RIX0VER0VTOgogCQllZGdlID0gQVRNRUxfVENfRVRSR0VER19CT1RIOwogCQlicmVh
azsKIAlkZWZhdWx0OgpAQCAtMjQwLDggKzIyOCw3IEBAIHN0YXRpYyBpbnQgbWNocF90Y19jb3Vu
dF9hY3Rpb25fc2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKIH0KIAogc3RhdGlj
IGludCBtY2hwX3RjX2NvdW50X3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAot
CQkJICAgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkJICAgICAgdW5zaWduZWQg
bG9uZyAqdmFsKQorCQkJICAgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB1NjQgKnZh
bCkKIHsKIAlzdHJ1Y3QgbWNocF90Y19kYXRhICpjb25zdCBwcml2ID0gY291bnRlci0+cHJpdjsK
IAl1MzIgY250OwpAQCAtMjY0LDEyICsyNTEsMTIgQEAgc3RhdGljIHN0cnVjdCBjb3VudGVyX2Nv
dW50IG1jaHBfdGNfY291bnRzW10gPSB7CiB9OwogCiBzdGF0aWMgY29uc3Qgc3RydWN0IGNvdW50
ZXJfb3BzIG1jaHBfdGNfb3BzID0gewotCS5zaWduYWxfcmVhZCAgPSBtY2hwX3RjX2NvdW50X3Np
Z25hbF9yZWFkLAotCS5jb3VudF9yZWFkICAgPSBtY2hwX3RjX2NvdW50X3JlYWQsCi0JLmZ1bmN0
aW9uX2dldCA9IG1jaHBfdGNfY291bnRfZnVuY3Rpb25fZ2V0LAotCS5mdW5jdGlvbl9zZXQgPSBt
Y2hwX3RjX2NvdW50X2Z1bmN0aW9uX3NldCwKLQkuYWN0aW9uX2dldCAgID0gbWNocF90Y19jb3Vu
dF9hY3Rpb25fZ2V0LAotCS5hY3Rpb25fc2V0ICAgPSBtY2hwX3RjX2NvdW50X2FjdGlvbl9zZXQK
Kwkuc2lnbmFsX3JlYWQgICAgPSBtY2hwX3RjX2NvdW50X3NpZ25hbF9yZWFkLAorCS5jb3VudF9y
ZWFkICAgICA9IG1jaHBfdGNfY291bnRfcmVhZCwKKwkuZnVuY3Rpb25fcmVhZCAgPSBtY2hwX3Rj
X2NvdW50X2Z1bmN0aW9uX3JlYWQsCisJLmZ1bmN0aW9uX3dyaXRlID0gbWNocF90Y19jb3VudF9m
dW5jdGlvbl93cml0ZSwKKwkuYWN0aW9uX3JlYWQgICAgPSBtY2hwX3RjX2NvdW50X2FjdGlvbl9y
ZWFkLAorCS5hY3Rpb25fd3JpdGUgICA9IG1jaHBfdGNfY291bnRfYWN0aW9uX3dyaXRlCiB9Owog
CiBzdGF0aWMgY29uc3Qgc3RydWN0IGF0bWVsX3RjYl9jb25maWcgdGNiX3JtOTIwMF9jb25maWcg
PSB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2NvdW50ZXIvc3RtMzItbHB0aW1lci1jbnQuYyBiL2Ry
aXZlcnMvY291bnRlci9zdG0zMi1scHRpbWVyLWNudC5jCmluZGV4IDEzNjU2OTU3YzQ1Zi4uYWVm
NzhhNDIxN2I1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2NvdW50ZXIvc3RtMzItbHB0aW1lci1jbnQu
YworKysgYi9kcml2ZXJzL2NvdW50ZXIvc3RtMzItbHB0aW1lci1jbnQuYwpAQCAtMTcsNiArMTcs
NyBAQAogI2luY2x1ZGUgPGxpbnV4L21vZHVsZS5oPgogI2luY2x1ZGUgPGxpbnV4L3BpbmN0cmwv
Y29uc3VtZXIuaD4KICNpbmNsdWRlIDxsaW51eC9wbGF0Zm9ybV9kZXZpY2UuaD4KKyNpbmNsdWRl
IDxsaW51eC90eXBlcy5oPgogCiBzdHJ1Y3Qgc3RtMzJfbHB0aW1fY250IHsKIAlzdHJ1Y3QgY291
bnRlcl9kZXZpY2UgY291bnRlcjsKQEAgLTEzMCwzMiArMTMxLDQ2IEBAIHN0YXRpYyBpbnQgc3Rt
MzJfbHB0aW1fc2V0dXAoc3RydWN0IHN0bTMyX2xwdGltX2NudCAqcHJpdiwgaW50IGVuYWJsZSkK
ICAqICstLS0tLS0tLS0rLS0tLS0tLS0tLSstLS0tLS0tLS0tKy0tLS0tLS0tLSstLS0tLS0tLS0t
Ky0tLS0tLS0tLSsKICAqLwogZW51bSBzdG0zMl9scHRpbV9jbnRfZnVuY3Rpb24gewotCVNUTTMy
X0xQVElNX0NPVU5URVJfSU5DUkVBU0UsCi0JU1RNMzJfTFBUSU1fRU5DT0RFUl9CT1RIX0VER0Us
CisJU1RNMzJfTFBUSU1fQ09VTlRFUl9JTkNSRUFTRSA9IENPVU5URVJfRlVOQ1RJT05fSU5DUkVB
U0UsCisJU1RNMzJfTFBUSU1fRU5DT0RFUl9CT1RIX0VER0UgPSBDT1VOVEVSX0ZVTkNUSU9OX1FV
QURSQVRVUkVfWDQsCiB9OwogCiBzdGF0aWMgY29uc3QgZW51bSBjb3VudGVyX2Z1bmN0aW9uIHN0
bTMyX2xwdGltX2NudF9mdW5jdGlvbnNbXSA9IHsKLQlbU1RNMzJfTFBUSU1fQ09VTlRFUl9JTkNS
RUFTRV0gPSBDT1VOVEVSX0ZVTkNUSU9OX0lOQ1JFQVNFLAotCVtTVE0zMl9MUFRJTV9FTkNPREVS
X0JPVEhfRURHRV0gPSBDT1VOVEVSX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDQsCisJU1RNMzJfTFBU
SU1fQ09VTlRFUl9JTkNSRUFTRSwKKwlTVE0zMl9MUFRJTV9FTkNPREVSX0JPVEhfRURHRSwKIH07
CiAKIGVudW0gc3RtMzJfbHB0aW1fc3luYXBzZV9hY3Rpb24geworCS8qIEluZGV4IG11c3QgbWF0
Y2ggd2l0aCBzdG0zMl9scHRpbV9jbnRfcG9sYXJpdHlbXSAocHJpdi0+cG9sYXJpdHkpICovCiAJ
U1RNMzJfTFBUSU1fU1lOQVBTRV9BQ1RJT05fUklTSU5HX0VER0UsCiAJU1RNMzJfTFBUSU1fU1lO
QVBTRV9BQ1RJT05fRkFMTElOR19FREdFLAogCVNUTTMyX0xQVElNX1NZTkFQU0VfQUNUSU9OX0JP
VEhfRURHRVMsCiAJU1RNMzJfTFBUSU1fU1lOQVBTRV9BQ1RJT05fTk9ORSwKIH07CiAKLXN0YXRp
YyBjb25zdCBlbnVtIGNvdW50ZXJfc3luYXBzZV9hY3Rpb24gc3RtMzJfbHB0aW1fY250X3N5bmFw
c2VfYWN0aW9uc1tdID0gewotCS8qIEluZGV4IG11c3QgbWF0Y2ggd2l0aCBzdG0zMl9scHRpbV9j
bnRfcG9sYXJpdHlbXSAocHJpdi0+cG9sYXJpdHkpICovCitzdGF0aWMgY29uc3QgZW51bSBzdG0z
Ml9scHRpbV9zeW5hcHNlX2FjdGlvbiBzdG0zMl9scHRpbV9jMmxfYWN0aW9uc19tYXBbXSA9IHsK
KwlbQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9SSVNJTkdfRURHRV0gPSBTVE0zMl9MUFRJTV9TWU5B
UFNFX0FDVElPTl9SSVNJTkdfRURHRSwKKwlbQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9GQUxMSU5H
X0VER0VdID0gU1RNMzJfTFBUSU1fU1lOQVBTRV9BQ1RJT05fRkFMTElOR19FREdFLAorCVtDT1VO
VEVSX1NZTkFQU0VfQUNUSU9OX0JPVEhfRURHRVNdID0gU1RNMzJfTFBUSU1fU1lOQVBTRV9BQ1RJ
T05fQk9USF9FREdFUywKKwlbQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9OT05FXSA9IFNUTTMyX0xQ
VElNX1NZTkFQU0VfQUNUSU9OX05PTkUsCit9OworCitzdGF0aWMgY29uc3QgZW51bSBjb3VudGVy
X3N5bmFwc2VfYWN0aW9uIHN0bTMyX2xwdGltX2wyY19hY3Rpb25zX21hcFtdID0gewogCVtTVE0z
Ml9MUFRJTV9TWU5BUFNFX0FDVElPTl9SSVNJTkdfRURHRV0gPSBDT1VOVEVSX1NZTkFQU0VfQUNU
SU9OX1JJU0lOR19FREdFLAogCVtTVE0zMl9MUFRJTV9TWU5BUFNFX0FDVElPTl9GQUxMSU5HX0VE
R0VdID0gQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9GQUxMSU5HX0VER0UsCiAJW1NUTTMyX0xQVElN
X1NZTkFQU0VfQUNUSU9OX0JPVEhfRURHRVNdID0gQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9CT1RI
X0VER0VTLAogCVtTVE0zMl9MUFRJTV9TWU5BUFNFX0FDVElPTl9OT05FXSA9IENPVU5URVJfU1lO
QVBTRV9BQ1RJT05fTk9ORSwKIH07CiAKK3N0YXRpYyBjb25zdCBlbnVtIGNvdW50ZXJfc3luYXBz
ZV9hY3Rpb24gc3RtMzJfbHB0aW1fY250X3N5bmFwc2VfYWN0aW9uc1tdID0geworCUNPVU5URVJf
U1lOQVBTRV9BQ1RJT05fUklTSU5HX0VER0UsCisJQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9GQUxM
SU5HX0VER0UsCisJQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9CT1RIX0VER0VTLAorCUNPVU5URVJf
U1lOQVBTRV9BQ1RJT05fTk9ORSwKK307CisKIHN0YXRpYyBpbnQgc3RtMzJfbHB0aW1fY250X3Jl
YWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCXN0cnVjdCBjb3VudGVyX2Nv
dW50ICpjb3VudCwgdW5zaWduZWQgbG9uZyAqdmFsKQorCQkJCXN0cnVjdCBjb3VudGVyX2NvdW50
ICpjb3VudCwgdTY0ICp2YWwpCiB7CiAJc3RydWN0IHN0bTMyX2xwdGltX2NudCAqY29uc3QgcHJp
diA9IGNvdW50ZXItPnByaXY7CiAJdTMyIGNudDsKQEAgLTE3MCw5ICsxODUsOSBAQCBzdGF0aWMg
aW50IHN0bTMyX2xwdGltX2NudF9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwK
IAlyZXR1cm4gMDsKIH0KIAotc3RhdGljIGludCBzdG0zMl9scHRpbV9jbnRfZnVuY3Rpb25fZ2V0
KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQkJc3RydWN0IGNvdW50ZXJfY291
bnQgKmNvdW50LAotCQkJCQlzaXplX3QgKmZ1bmN0aW9uKQorc3RhdGljIGludCBzdG0zMl9scHRp
bV9jbnRfZnVuY3Rpb25fcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJ
CSBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCisJCQkJCSBlbnVtIGNvdW50ZXJfZnVuY3Rp
b24gKmZ1bmN0aW9uKQogewogCXN0cnVjdCBzdG0zMl9scHRpbV9jbnQgKmNvbnN0IHByaXYgPSBj
b3VudGVyLT5wcml2OwogCkBAIC0xODksOSArMjA0LDkgQEAgc3RhdGljIGludCBzdG0zMl9scHRp
bV9jbnRfZnVuY3Rpb25fZ2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKIAlyZXR1
cm4gLUVJTlZBTDsKIH0KIAotc3RhdGljIGludCBzdG0zMl9scHRpbV9jbnRfZnVuY3Rpb25fc2V0
KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQkJc3RydWN0IGNvdW50ZXJfY291
bnQgKmNvdW50LAotCQkJCQlzaXplX3QgZnVuY3Rpb24pCitzdGF0aWMgaW50IHN0bTMyX2xwdGlt
X2NudF9mdW5jdGlvbl93cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJ
CSAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAorCQkJCQkgIGVudW0gY291bnRlcl9mdW5j
dGlvbiBmdW5jdGlvbikKIHsKIAlzdHJ1Y3Qgc3RtMzJfbHB0aW1fY250ICpjb25zdCBwcml2ID0g
Y291bnRlci0+cHJpdjsKIApAQCAtMjEyLDkgKzIyNyw5IEBAIHN0YXRpYyBpbnQgc3RtMzJfbHB0
aW1fY250X2Z1bmN0aW9uX3NldChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAJfQog
fQogCi1zdGF0aWMgc3NpemVfdCBzdG0zMl9scHRpbV9jbnRfZW5hYmxlX3JlYWQoc3RydWN0IGNv
dW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCQkgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291
bnQsCi0JCQkJCSAgIHZvaWQgKnByaXZhdGUsIGNoYXIgKmJ1ZikKK3N0YXRpYyBpbnQgc3RtMzJf
bHB0aW1fY250X2VuYWJsZV9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJ
CQkgICAgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAorCQkJCSAgICAgICB1OCAqZW5h
YmxlKQogewogCXN0cnVjdCBzdG0zMl9scHRpbV9jbnQgKmNvbnN0IHByaXYgPSBjb3VudGVyLT5w
cml2OwogCWludCByZXQ7CkBAIC0yMjMsMjIgKzIzOCwxOCBAQCBzdGF0aWMgc3NpemVfdCBzdG0z
Ml9scHRpbV9jbnRfZW5hYmxlX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAog
CWlmIChyZXQgPCAwKQogCQlyZXR1cm4gcmV0OwogCi0JcmV0dXJuIHNjbnByaW50ZihidWYsIFBB
R0VfU0laRSwgIiV1XG4iLCByZXQpOworCSplbmFibGUgPSByZXQ7CisKKwlyZXR1cm4gMDsKIH0K
IAotc3RhdGljIHNzaXplX3Qgc3RtMzJfbHB0aW1fY250X2VuYWJsZV93cml0ZShzdHJ1Y3QgY291
bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkJCSAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291
bnQsCi0JCQkJCSAgICB2b2lkICpwcml2YXRlLAotCQkJCQkgICAgY29uc3QgY2hhciAqYnVmLCBz
aXplX3QgbGVuKQorc3RhdGljIGludCBzdG0zMl9scHRpbV9jbnRfZW5hYmxlX3dyaXRlKHN0cnVj
dCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkJc3RydWN0IGNvdW50ZXJfY291bnQgKmNv
dW50LAorCQkJCQl1OCBlbmFibGUpCiB7CiAJc3RydWN0IHN0bTMyX2xwdGltX2NudCAqY29uc3Qg
cHJpdiA9IGNvdW50ZXItPnByaXY7Ci0JYm9vbCBlbmFibGU7CiAJaW50IHJldDsKIAotCXJldCA9
IGtzdHJ0b2Jvb2woYnVmLCAmZW5hYmxlKTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OwotCiAJ
LyogQ2hlY2sgbm9ib2R5IHVzZXMgdGhlIHRpbWVyLCBvciBhbHJlYWR5IGRpc2FibGVkL2VuYWJs
ZWQgKi8KIAlyZXQgPSBzdG0zMl9scHRpbV9pc19lbmFibGVkKHByaXYpOwogCWlmICgocmV0IDwg
MCkgfHwgKCFyZXQgJiYgIWVuYWJsZSkpCkBAIC0yNTQsNjUgKzI2NSw1NCBAQCBzdGF0aWMgc3Np
emVfdCBzdG0zMl9scHRpbV9jbnRfZW5hYmxlX3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAq
Y291bnRlciwKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCi0JcmV0dXJuIGxlbjsKKwlyZXR1
cm4gMDsKIH0KIAotc3RhdGljIHNzaXplX3Qgc3RtMzJfbHB0aW1fY250X2NlaWxpbmdfcmVhZChz
dHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkJCSAgICBzdHJ1Y3QgY291bnRlcl9j
b3VudCAqY291bnQsCi0JCQkJCSAgICB2b2lkICpwcml2YXRlLCBjaGFyICpidWYpCitzdGF0aWMg
aW50IHN0bTMyX2xwdGltX2NudF9jZWlsaW5nX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpj
b3VudGVyLAorCQkJCQlzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCisJCQkJCXU2NCAqY2Vp
bGluZykKIHsKIAlzdHJ1Y3Qgc3RtMzJfbHB0aW1fY250ICpjb25zdCBwcml2ID0gY291bnRlci0+
cHJpdjsKIAotCXJldHVybiBzbnByaW50ZihidWYsIFBBR0VfU0laRSwgIiV1XG4iLCBwcml2LT5j
ZWlsaW5nKTsKKwkqY2VpbGluZyA9IHByaXYtPmNlaWxpbmc7CisKKwlyZXR1cm4gMDsKIH0KIAot
c3RhdGljIHNzaXplX3Qgc3RtMzJfbHB0aW1fY250X2NlaWxpbmdfd3JpdGUoc3RydWN0IGNvdW50
ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCQkgICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3Vu
dCwKLQkJCQkJICAgICB2b2lkICpwcml2YXRlLAotCQkJCQkgICAgIGNvbnN0IGNoYXIgKmJ1Ziwg
c2l6ZV90IGxlbikKK3N0YXRpYyBpbnQgc3RtMzJfbHB0aW1fY250X2NlaWxpbmdfd3JpdGUoc3Ry
dWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCQkgc3RydWN0IGNvdW50ZXJfY291bnQg
KmNvdW50LAorCQkJCQkgdTY0IGNlaWxpbmcpCiB7CiAJc3RydWN0IHN0bTMyX2xwdGltX2NudCAq
Y29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7Ci0JdW5zaWduZWQgaW50IGNlaWxpbmc7Ci0JaW50
IHJldDsKIAogCWlmIChzdG0zMl9scHRpbV9pc19lbmFibGVkKHByaXYpKQogCQlyZXR1cm4gLUVC
VVNZOwogCi0JcmV0ID0ga3N0cnRvdWludChidWYsIDAsICZjZWlsaW5nKTsKLQlpZiAocmV0KQot
CQlyZXR1cm4gcmV0OwotCiAJaWYgKGNlaWxpbmcgPiBTVE0zMl9MUFRJTV9NQVhfQVJSKQogCQly
ZXR1cm4gLUVSQU5HRTsKIAogCXByaXYtPmNlaWxpbmcgPSBjZWlsaW5nOwogCi0JcmV0dXJuIGxl
bjsKKwlyZXR1cm4gMDsKIH0KIAotc3RhdGljIGNvbnN0IHN0cnVjdCBjb3VudGVyX2NvdW50X2V4
dCBzdG0zMl9scHRpbV9jbnRfZXh0W10gPSB7Ci0JewotCQkubmFtZSA9ICJlbmFibGUiLAotCQku
cmVhZCA9IHN0bTMyX2xwdGltX2NudF9lbmFibGVfcmVhZCwKLQkJLndyaXRlID0gc3RtMzJfbHB0
aW1fY250X2VuYWJsZV93cml0ZQotCX0sCi0JewotCQkubmFtZSA9ICJjZWlsaW5nIiwKLQkJLnJl
YWQgPSBzdG0zMl9scHRpbV9jbnRfY2VpbGluZ19yZWFkLAotCQkud3JpdGUgPSBzdG0zMl9scHRp
bV9jbnRfY2VpbGluZ193cml0ZQotCX0sCitzdGF0aWMgc3RydWN0IGNvdW50ZXJfY29tcCBzdG0z
Ml9scHRpbV9jbnRfZXh0W10gPSB7CisJQ09VTlRFUl9DT01QX0VOQUJMRShzdG0zMl9scHRpbV9j
bnRfZW5hYmxlX3JlYWQsCisJCQkgICAgc3RtMzJfbHB0aW1fY250X2VuYWJsZV93cml0ZSksCisJ
Q09VTlRFUl9DT01QX0NFSUxJTkcoc3RtMzJfbHB0aW1fY250X2NlaWxpbmdfcmVhZCwKKwkJCSAg
ICAgc3RtMzJfbHB0aW1fY250X2NlaWxpbmdfd3JpdGUpLAogfTsKIAotc3RhdGljIGludCBzdG0z
Ml9scHRpbV9jbnRfYWN0aW9uX2dldChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0J
CQkJICAgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkJCSAgICAgIHN0cnVjdCBj
b3VudGVyX3N5bmFwc2UgKnN5bmFwc2UsCi0JCQkJICAgICAgc2l6ZV90ICphY3Rpb24pCitzdGF0
aWMgaW50IHN0bTMyX2xwdGltX2NudF9hY3Rpb25fcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2Ug
KmNvdW50ZXIsCisJCQkJICAgICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKKwkJCQkg
ICAgICAgc3RydWN0IGNvdW50ZXJfc3luYXBzZSAqc3luYXBzZSwKKwkJCQkgICAgICAgZW51bSBj
b3VudGVyX3N5bmFwc2VfYWN0aW9uICphY3Rpb24pCiB7CiAJc3RydWN0IHN0bTMyX2xwdGltX2Nu
dCAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7Ci0Jc2l6ZV90IGZ1bmN0aW9uOworCWVudW0g
Y291bnRlcl9mdW5jdGlvbiBmdW5jdGlvbjsKIAlpbnQgZXJyOwogCi0JZXJyID0gc3RtMzJfbHB0
aW1fY250X2Z1bmN0aW9uX2dldChjb3VudGVyLCBjb3VudCwgJmZ1bmN0aW9uKTsKKwllcnIgPSBz
dG0zMl9scHRpbV9jbnRfZnVuY3Rpb25fcmVhZChjb3VudGVyLCBjb3VudCwgJmZ1bmN0aW9uKTsK
IAlpZiAoZXJyKQogCQlyZXR1cm4gZXJyOwogCkBAIC0zMjAsMTIgKzMyMCwxMiBAQCBzdGF0aWMg
aW50IHN0bTMyX2xwdGltX2NudF9hY3Rpb25fZ2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291
bnRlciwKIAljYXNlIFNUTTMyX0xQVElNX0NPVU5URVJfSU5DUkVBU0U6CiAJCS8qIExQIFRpbWVy
IGFjdHMgYXMgdXAtY291bnRlciBvbiBpbnB1dCAxICovCiAJCWlmIChzeW5hcHNlLT5zaWduYWwt
PmlkID09IGNvdW50LT5zeW5hcHNlc1swXS5zaWduYWwtPmlkKQotCQkJKmFjdGlvbiA9IHByaXYt
PnBvbGFyaXR5OworCQkJKmFjdGlvbiA9IHN0bTMyX2xwdGltX2wyY19hY3Rpb25zX21hcFtwcml2
LT5wb2xhcml0eV07CiAJCWVsc2UKLQkJCSphY3Rpb24gPSBTVE0zMl9MUFRJTV9TWU5BUFNFX0FD
VElPTl9OT05FOworCQkJKmFjdGlvbiA9IENPVU5URVJfU1lOQVBTRV9BQ1RJT05fTk9ORTsKIAkJ
cmV0dXJuIDA7CiAJY2FzZSBTVE0zMl9MUFRJTV9FTkNPREVSX0JPVEhfRURHRToKLQkJKmFjdGlv
biA9IHByaXYtPnBvbGFyaXR5OworCQkqYWN0aW9uID0gc3RtMzJfbHB0aW1fbDJjX2FjdGlvbnNf
bWFwW3ByaXYtPnBvbGFyaXR5XTsKIAkJcmV0dXJuIDA7CiAJZGVmYXVsdDoKIAkJLyogc2hvdWxk
IG5ldmVyIHJlYWNoIHRoaXMgcGF0aCAqLwpAQCAtMzMzLDQzICszMzMsMzkgQEAgc3RhdGljIGlu
dCBzdG0zMl9scHRpbV9jbnRfYWN0aW9uX2dldChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50
ZXIsCiAJfQogfQogCi1zdGF0aWMgaW50IHN0bTMyX2xwdGltX2NudF9hY3Rpb25fc2V0KHN0cnVj
dCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQkgICAgICBzdHJ1Y3QgY291bnRlcl9jb3Vu
dCAqY291bnQsCi0JCQkJICAgICAgc3RydWN0IGNvdW50ZXJfc3luYXBzZSAqc3luYXBzZSwKLQkJ
CQkgICAgICBzaXplX3QgYWN0aW9uKQorc3RhdGljIGludCBzdG0zMl9scHRpbV9jbnRfYWN0aW9u
X3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkJc3RydWN0IGNvdW50
ZXJfY291bnQgKmNvdW50LAorCQkJCQlzdHJ1Y3QgY291bnRlcl9zeW5hcHNlICpzeW5hcHNlLAor
CQkJCQllbnVtIGNvdW50ZXJfc3luYXBzZV9hY3Rpb24gYWN0aW9uKQogewogCXN0cnVjdCBzdG0z
Ml9scHRpbV9jbnQgKmNvbnN0IHByaXYgPSBjb3VudGVyLT5wcml2OwotCXNpemVfdCBmdW5jdGlv
bjsKKwllbnVtIGNvdW50ZXJfZnVuY3Rpb24gZnVuY3Rpb247CiAJaW50IGVycjsKIAogCWlmIChz
dG0zMl9scHRpbV9pc19lbmFibGVkKHByaXYpKQogCQlyZXR1cm4gLUVCVVNZOwogCi0JZXJyID0g
c3RtMzJfbHB0aW1fY250X2Z1bmN0aW9uX2dldChjb3VudGVyLCBjb3VudCwgJmZ1bmN0aW9uKTsK
KwllcnIgPSBzdG0zMl9scHRpbV9jbnRfZnVuY3Rpb25fcmVhZChjb3VudGVyLCBjb3VudCwgJmZ1
bmN0aW9uKTsKIAlpZiAoZXJyKQogCQlyZXR1cm4gZXJyOwogCiAJLyogb25seSBzZXQgcG9sYXJp
dHkgd2hlbiBpbiBjb3VudGVyIG1vZGUgKG9uIGlucHV0IDEpICovCi0JaWYgKGZ1bmN0aW9uID09
IFNUTTMyX0xQVElNX0NPVU5URVJfSU5DUkVBU0UKLQkgICAgJiYgc3luYXBzZS0+c2lnbmFsLT5p
ZCA9PSBjb3VudC0+c3luYXBzZXNbMF0uc2lnbmFsLT5pZCkgewotCQlzd2l0Y2ggKGFjdGlvbikg
ewotCQljYXNlIFNUTTMyX0xQVElNX1NZTkFQU0VfQUNUSU9OX1JJU0lOR19FREdFOgotCQljYXNl
IFNUTTMyX0xQVElNX1NZTkFQU0VfQUNUSU9OX0ZBTExJTkdfRURHRToKLQkJY2FzZSBTVE0zMl9M
UFRJTV9TWU5BUFNFX0FDVElPTl9CT1RIX0VER0VTOgotCQkJcHJpdi0+cG9sYXJpdHkgPSBhY3Rp
b247Ci0JCQlyZXR1cm4gMDsKLQkJfQotCX0KKwlpZiAoKGVudW0gc3RtMzJfbHB0aW1fY250X2Z1
bmN0aW9uKWZ1bmN0aW9uICE9IFNUTTMyX0xQVElNX0NPVU5URVJfSU5DUkVBU0UKKwkgICAgfHwg
c3luYXBzZS0+c2lnbmFsLT5pZCAhPSBjb3VudC0+c3luYXBzZXNbMF0uc2lnbmFsLT5pZAorCSAg
ICB8fCBhY3Rpb24gPT0gQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9OT05FKQorCQlyZXR1cm4gLUVJ
TlZBTDsKIAotCXJldHVybiAtRUlOVkFMOworCXByaXYtPnBvbGFyaXR5ID0gc3RtMzJfbHB0aW1f
YzJsX2FjdGlvbnNfbWFwW2FjdGlvbl07CisKKwlyZXR1cm4gMDsKIH0KIAogc3RhdGljIGNvbnN0
IHN0cnVjdCBjb3VudGVyX29wcyBzdG0zMl9scHRpbV9jbnRfb3BzID0gewogCS5jb3VudF9yZWFk
ID0gc3RtMzJfbHB0aW1fY250X3JlYWQsCi0JLmZ1bmN0aW9uX2dldCA9IHN0bTMyX2xwdGltX2Nu
dF9mdW5jdGlvbl9nZXQsCi0JLmZ1bmN0aW9uX3NldCA9IHN0bTMyX2xwdGltX2NudF9mdW5jdGlv
bl9zZXQsCi0JLmFjdGlvbl9nZXQgPSBzdG0zMl9scHRpbV9jbnRfYWN0aW9uX2dldCwKLQkuYWN0
aW9uX3NldCA9IHN0bTMyX2xwdGltX2NudF9hY3Rpb25fc2V0LAorCS5mdW5jdGlvbl9yZWFkID0g
c3RtMzJfbHB0aW1fY250X2Z1bmN0aW9uX3JlYWQsCisJLmZ1bmN0aW9uX3dyaXRlID0gc3RtMzJf
bHB0aW1fY250X2Z1bmN0aW9uX3dyaXRlLAorCS5hY3Rpb25fcmVhZCA9IHN0bTMyX2xwdGltX2Nu
dF9hY3Rpb25fcmVhZCwKKwkuYWN0aW9uX3dyaXRlID0gc3RtMzJfbHB0aW1fY250X2FjdGlvbl93
cml0ZSwKIH07CiAKIHN0YXRpYyBzdHJ1Y3QgY291bnRlcl9zaWduYWwgc3RtMzJfbHB0aW1fY250
X3NpZ25hbHNbXSA9IHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvY291bnRlci9zdG0zMi10aW1lci1j
bnQuYyBiL2RyaXZlcnMvY291bnRlci9zdG0zMi10aW1lci1jbnQuYwppbmRleCAzZmIwZGViZDc0
MjUuLmM2OTBiNzZlNWRhYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9jb3VudGVyL3N0bTMyLXRpbWVy
LWNudC5jCisrKyBiL2RyaXZlcnMvY291bnRlci9zdG0zMi10aW1lci1jbnQuYwpAQCAtMTMsNiAr
MTMsNyBAQAogI2luY2x1ZGUgPGxpbnV4L21vZHVsZS5oPgogI2luY2x1ZGUgPGxpbnV4L3BpbmN0
cmwvY29uc3VtZXIuaD4KICNpbmNsdWRlIDxsaW51eC9wbGF0Zm9ybV9kZXZpY2UuaD4KKyNpbmNs
dWRlIDxsaW51eC90eXBlcy5oPgogCiAjZGVmaW5lIFRJTV9DQ01SX0NDWFMJKEJJVCg4KSB8IEJJ
VCgwKSkKICNkZWZpbmUgVElNX0NDTVJfTUFTSwkoVElNX0NDTVJfQ0MxUyB8IFRJTV9DQ01SX0ND
MlMgfCBcCkBAIC00NCwyMSArNDUsMjEgQEAgc3RydWN0IHN0bTMyX3RpbWVyX2NudCB7CiAgKiBA
U1RNMzJfQ09VTlRfRU5DT0RFUl9NT0RFXzM6IGNvdW50cyBvbiBib3RoIFRJMUZQMSBhbmQgVEky
RlAyIGVkZ2VzCiAgKi8KIGVudW0gc3RtMzJfY291bnRfZnVuY3Rpb24geworCVNUTTMyX0NPVU5U
X1NMQVZFX01PREVfRElTQUJMRUQgPSBDT1VOVEVSX0ZVTkNUSU9OX0lOQ1JFQVNFLAorCVNUTTMy
X0NPVU5UX0VOQ09ERVJfTU9ERV8xID0gQ09VTlRFUl9GVU5DVElPTl9RVUFEUkFUVVJFX1gyX0Es
CisJU1RNMzJfQ09VTlRfRU5DT0RFUl9NT0RFXzIgPSBDT1VOVEVSX0ZVTkNUSU9OX1FVQURSQVRV
UkVfWDJfQiwKKwlTVE0zMl9DT1VOVF9FTkNPREVSX01PREVfMyA9IENPVU5URVJfRlVOQ1RJT05f
UVVBRFJBVFVSRV9YNCwKK307CisKK3N0YXRpYyBjb25zdCBlbnVtIGNvdW50ZXJfZnVuY3Rpb24g
c3RtMzJfY291bnRfZnVuY3Rpb25zW10gPSB7CiAJU1RNMzJfQ09VTlRfU0xBVkVfTU9ERV9ESVNB
QkxFRCwKIAlTVE0zMl9DT1VOVF9FTkNPREVSX01PREVfMSwKIAlTVE0zMl9DT1VOVF9FTkNPREVS
X01PREVfMiwKIAlTVE0zMl9DT1VOVF9FTkNPREVSX01PREVfMywKIH07CiAKLXN0YXRpYyBjb25z
dCBlbnVtIGNvdW50ZXJfZnVuY3Rpb24gc3RtMzJfY291bnRfZnVuY3Rpb25zW10gPSB7Ci0JW1NU
TTMyX0NPVU5UX1NMQVZFX01PREVfRElTQUJMRURdID0gQ09VTlRFUl9GVU5DVElPTl9JTkNSRUFT
RSwKLQlbU1RNMzJfQ09VTlRfRU5DT0RFUl9NT0RFXzFdID0gQ09VTlRFUl9GVU5DVElPTl9RVUFE
UkFUVVJFX1gyX0EsCi0JW1NUTTMyX0NPVU5UX0VOQ09ERVJfTU9ERV8yXSA9IENPVU5URVJfRlVO
Q1RJT05fUVVBRFJBVFVSRV9YMl9CLAotCVtTVE0zMl9DT1VOVF9FTkNPREVSX01PREVfM10gPSBD
T1VOVEVSX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDQsCi19OwotCiBzdGF0aWMgaW50IHN0bTMyX2Nv
dW50X3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJICAgIHN0cnVjdCBj
b3VudGVyX2NvdW50ICpjb3VudCwgdW5zaWduZWQgbG9uZyAqdmFsKQorCQkJICAgIHN0cnVjdCBj
b3VudGVyX2NvdW50ICpjb3VudCwgdTY0ICp2YWwpCiB7CiAJc3RydWN0IHN0bTMyX3RpbWVyX2Nu
dCAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7CiAJdTMyIGNudDsKQEAgLTcwLDggKzcxLDcg
QEAgc3RhdGljIGludCBzdG0zMl9jb3VudF9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291
bnRlciwKIH0KIAogc3RhdGljIGludCBzdG0zMl9jb3VudF93cml0ZShzdHJ1Y3QgY291bnRlcl9k
ZXZpY2UgKmNvdW50ZXIsCi0JCQkgICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKLQkJ
CSAgICAgY29uc3QgdW5zaWduZWQgbG9uZyB2YWwpCisJCQkgICAgIHN0cnVjdCBjb3VudGVyX2Nv
dW50ICpjb3VudCwgY29uc3QgdTY0IHZhbCkKIHsKIAlzdHJ1Y3Qgc3RtMzJfdGltZXJfY250ICpj
b25zdCBwcml2ID0gY291bnRlci0+cHJpdjsKIAl1MzIgY2VpbGluZzsKQEAgLTgzLDkgKzgzLDkg
QEAgc3RhdGljIGludCBzdG0zMl9jb3VudF93cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNv
dW50ZXIsCiAJcmV0dXJuIHJlZ21hcF93cml0ZShwcml2LT5yZWdtYXAsIFRJTV9DTlQsIHZhbCk7
CiB9CiAKLXN0YXRpYyBpbnQgc3RtMzJfY291bnRfZnVuY3Rpb25fZ2V0KHN0cnVjdCBjb3VudGVy
X2RldmljZSAqY291bnRlciwKLQkJCQkgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAot
CQkJCSAgICBzaXplX3QgKmZ1bmN0aW9uKQorc3RhdGljIGludCBzdG0zMl9jb3VudF9mdW5jdGlv
bl9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkgICAgIHN0cnVjdCBj
b3VudGVyX2NvdW50ICpjb3VudCwKKwkJCQkgICAgIGVudW0gY291bnRlcl9mdW5jdGlvbiAqZnVu
Y3Rpb24pCiB7CiAJc3RydWN0IHN0bTMyX3RpbWVyX2NudCAqY29uc3QgcHJpdiA9IGNvdW50ZXIt
PnByaXY7CiAJdTMyIHNtY3I7CkBAIC0xMTAsOSArMTEwLDkgQEAgc3RhdGljIGludCBzdG0zMl9j
b3VudF9mdW5jdGlvbl9nZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAogCX0KIH0K
IAotc3RhdGljIGludCBzdG0zMl9jb3VudF9mdW5jdGlvbl9zZXQoc3RydWN0IGNvdW50ZXJfZGV2
aWNlICpjb3VudGVyLAotCQkJCSAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCi0JCQkJ
ICAgIHNpemVfdCBmdW5jdGlvbikKK3N0YXRpYyBpbnQgc3RtMzJfY291bnRfZnVuY3Rpb25fd3Jp
dGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCSAgICAgIHN0cnVjdCBjb3Vu
dGVyX2NvdW50ICpjb3VudCwKKwkJCQkgICAgICBlbnVtIGNvdW50ZXJfZnVuY3Rpb24gZnVuY3Rp
b24pCiB7CiAJc3RydWN0IHN0bTMyX3RpbWVyX2NudCAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnBy
aXY7CiAJdTMyIGNyMSwgc21zOwpAQCAtMTUwLDQ0ICsxNTAsMzcgQEAgc3RhdGljIGludCBzdG0z
Ml9jb3VudF9mdW5jdGlvbl9zZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAogCXJl
dHVybiAwOwogfQogCi1zdGF0aWMgc3NpemVfdCBzdG0zMl9jb3VudF9kaXJlY3Rpb25fcmVhZChz
dHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCitzdGF0aWMgaW50IHN0bTMyX2NvdW50X2Rp
cmVjdGlvbl9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKIAkJCQkgICAgICBz
dHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCi0JCQkJICAgICAgdm9pZCAqcHJpdmF0ZSwgY2hh
ciAqYnVmKQorCQkJCSAgICAgIGVudW0gY291bnRlcl9jb3VudF9kaXJlY3Rpb24gKmRpcmVjdGlv
bikKIHsKIAlzdHJ1Y3Qgc3RtMzJfdGltZXJfY250ICpjb25zdCBwcml2ID0gY291bnRlci0+cHJp
djsKLQljb25zdCBjaGFyICpkaXJlY3Rpb247CiAJdTMyIGNyMTsKIAogCXJlZ21hcF9yZWFkKHBy
aXYtPnJlZ21hcCwgVElNX0NSMSwgJmNyMSk7Ci0JZGlyZWN0aW9uID0gKGNyMSAmIFRJTV9DUjFf
RElSKSA/ICJiYWNrd2FyZCIgOiAiZm9yd2FyZCI7CisJKmRpcmVjdGlvbiA9IChjcjEgJiBUSU1f
Q1IxX0RJUikgPyBDT1VOVEVSX0NPVU5UX0RJUkVDVElPTl9CQUNLV0FSRCA6CisJCUNPVU5URVJf
Q09VTlRfRElSRUNUSU9OX0ZPUldBUkQ7CiAKLQlyZXR1cm4gc2NucHJpbnRmKGJ1ZiwgUEFHRV9T
SVpFLCAiJXNcbiIsIGRpcmVjdGlvbik7CisJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBzc2l6ZV90
IHN0bTMyX2NvdW50X2NlaWxpbmdfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIs
Ci0JCQkJCXN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKLQkJCQkJdm9pZCAqcHJpdmF0ZSwg
Y2hhciAqYnVmKQorc3RhdGljIGludCBzdG0zMl9jb3VudF9jZWlsaW5nX3JlYWQoc3RydWN0IGNv
dW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCSAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291
bnQsIHU2NCAqY2VpbGluZykKIHsKIAlzdHJ1Y3Qgc3RtMzJfdGltZXJfY250ICpjb25zdCBwcml2
ID0gY291bnRlci0+cHJpdjsKIAl1MzIgYXJyOwogCiAJcmVnbWFwX3JlYWQocHJpdi0+cmVnbWFw
LCBUSU1fQVJSLCAmYXJyKTsKIAotCXJldHVybiBzbnByaW50ZihidWYsIFBBR0VfU0laRSwgIiV1
XG4iLCBhcnIpOworCSpjZWlsaW5nID0gYXJyOworCisJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBz
c2l6ZV90IHN0bTMyX2NvdW50X2NlaWxpbmdfd3JpdGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpj
b3VudGVyLAotCQkJCQkgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkJCQkgdm9pZCAq
cHJpdmF0ZSwKLQkJCQkJIGNvbnN0IGNoYXIgKmJ1Ziwgc2l6ZV90IGxlbikKK3N0YXRpYyBpbnQg
c3RtMzJfY291bnRfY2VpbGluZ193cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIs
CisJCQkJICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHU2NCBjZWlsaW5nKQogewog
CXN0cnVjdCBzdG0zMl90aW1lcl9jbnQgKmNvbnN0IHByaXYgPSBjb3VudGVyLT5wcml2OwotCXVu
c2lnbmVkIGludCBjZWlsaW5nOwotCWludCByZXQ7Ci0KLQlyZXQgPSBrc3RydG91aW50KGJ1Ziwg
MCwgJmNlaWxpbmcpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7CiAKIAlpZiAoY2VpbGluZyA+
IHByaXYtPm1heF9hcnIpCiAJCXJldHVybiAtRVJBTkdFOwpAQCAtMTk2LDM0ICsxODksMjcgQEAg
c3RhdGljIHNzaXplX3Qgc3RtMzJfY291bnRfY2VpbGluZ193cml0ZShzdHJ1Y3QgY291bnRlcl9k
ZXZpY2UgKmNvdW50ZXIsCiAJcmVnbWFwX3VwZGF0ZV9iaXRzKHByaXYtPnJlZ21hcCwgVElNX0NS
MSwgVElNX0NSMV9BUlBFLCAwKTsKIAlyZWdtYXBfd3JpdGUocHJpdi0+cmVnbWFwLCBUSU1fQVJS
LCBjZWlsaW5nKTsKIAotCXJldHVybiBsZW47CisJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBzc2l6
ZV90IHN0bTMyX2NvdW50X2VuYWJsZV9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRl
ciwKLQkJCQkgICAgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkJCSAgICAgICB2
b2lkICpwcml2YXRlLCBjaGFyICpidWYpCitzdGF0aWMgaW50IHN0bTMyX2NvdW50X2VuYWJsZV9y
ZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkgICBzdHJ1Y3QgY291bnRl
cl9jb3VudCAqY291bnQsIHU4ICplbmFibGUpCiB7CiAJc3RydWN0IHN0bTMyX3RpbWVyX2NudCAq
Y29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7CiAJdTMyIGNyMTsKIAogCXJlZ21hcF9yZWFkKHBy
aXYtPnJlZ21hcCwgVElNX0NSMSwgJmNyMSk7CiAKLQlyZXR1cm4gc2NucHJpbnRmKGJ1ZiwgUEFH
RV9TSVpFLCAiJWRcbiIsIChib29sKShjcjEgJiBUSU1fQ1IxX0NFTikpOworCSplbmFibGUgPSBj
cjEgJiBUSU1fQ1IxX0NFTjsKKworCXJldHVybiAwOwogfQogCi1zdGF0aWMgc3NpemVfdCBzdG0z
Ml9jb3VudF9lbmFibGVfd3JpdGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJ
CQlzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCi0JCQkJCXZvaWQgKnByaXZhdGUsCi0JCQkJ
CWNvbnN0IGNoYXIgKmJ1Ziwgc2l6ZV90IGxlbikKK3N0YXRpYyBpbnQgc3RtMzJfY291bnRfZW5h
YmxlX3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkgICAgc3RydWN0
IGNvdW50ZXJfY291bnQgKmNvdW50LCB1OCBlbmFibGUpCiB7CiAJc3RydWN0IHN0bTMyX3RpbWVy
X2NudCAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7Ci0JaW50IGVycjsKIAl1MzIgY3IxOwot
CWJvb2wgZW5hYmxlOwotCi0JZXJyID0ga3N0cnRvYm9vbChidWYsICZlbmFibGUpOwotCWlmIChl
cnIpCi0JCXJldHVybiBlcnI7CiAKIAlpZiAoZW5hYmxlKSB7CiAJCXJlZ21hcF9yZWFkKHByaXYt
PnJlZ21hcCwgVElNX0NSMSwgJmNyMSk7CkBAIC0yNDIsNzAgKzIyOCw1NSBAQCBzdGF0aWMgc3Np
emVfdCBzdG0zMl9jb3VudF9lbmFibGVfd3JpdGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3Vu
dGVyLAogCS8qIEtlZXAgZW5hYmxlZCBzdGF0ZSB0byBwcm9wZXJseSBoYW5kbGUgbG93IHBvd2Vy
IHN0YXRlcyAqLwogCXByaXYtPmVuYWJsZWQgPSBlbmFibGU7CiAKLQlyZXR1cm4gbGVuOworCXJl
dHVybiAwOwogfQogCi1zdGF0aWMgY29uc3Qgc3RydWN0IGNvdW50ZXJfY291bnRfZXh0IHN0bTMy
X2NvdW50X2V4dFtdID0gewotCXsKLQkJLm5hbWUgPSAiZGlyZWN0aW9uIiwKLQkJLnJlYWQgPSBz
dG0zMl9jb3VudF9kaXJlY3Rpb25fcmVhZCwKLQl9LAotCXsKLQkJLm5hbWUgPSAiZW5hYmxlIiwK
LQkJLnJlYWQgPSBzdG0zMl9jb3VudF9lbmFibGVfcmVhZCwKLQkJLndyaXRlID0gc3RtMzJfY291
bnRfZW5hYmxlX3dyaXRlCi0JfSwKLQl7Ci0JCS5uYW1lID0gImNlaWxpbmciLAotCQkucmVhZCA9
IHN0bTMyX2NvdW50X2NlaWxpbmdfcmVhZCwKLQkJLndyaXRlID0gc3RtMzJfY291bnRfY2VpbGlu
Z193cml0ZQotCX0sCi19OwotCi1lbnVtIHN0bTMyX3N5bmFwc2VfYWN0aW9uIHsKLQlTVE0zMl9T
WU5BUFNFX0FDVElPTl9OT05FLAotCVNUTTMyX1NZTkFQU0VfQUNUSU9OX0JPVEhfRURHRVMKK3N0
YXRpYyBzdHJ1Y3QgY291bnRlcl9jb21wIHN0bTMyX2NvdW50X2V4dFtdID0geworCUNPVU5URVJf
Q09NUF9ESVJFQ1RJT04oc3RtMzJfY291bnRfZGlyZWN0aW9uX3JlYWQpLAorCUNPVU5URVJfQ09N
UF9FTkFCTEUoc3RtMzJfY291bnRfZW5hYmxlX3JlYWQsIHN0bTMyX2NvdW50X2VuYWJsZV93cml0
ZSksCisJQ09VTlRFUl9DT01QX0NFSUxJTkcoc3RtMzJfY291bnRfY2VpbGluZ19yZWFkLAorCQkJ
ICAgICBzdG0zMl9jb3VudF9jZWlsaW5nX3dyaXRlKSwKIH07CiAKIHN0YXRpYyBjb25zdCBlbnVt
IGNvdW50ZXJfc3luYXBzZV9hY3Rpb24gc3RtMzJfc3luYXBzZV9hY3Rpb25zW10gPSB7Ci0JW1NU
TTMyX1NZTkFQU0VfQUNUSU9OX05PTkVdID0gQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9OT05FLAot
CVtTVE0zMl9TWU5BUFNFX0FDVElPTl9CT1RIX0VER0VTXSA9IENPVU5URVJfU1lOQVBTRV9BQ1RJ
T05fQk9USF9FREdFUworCUNPVU5URVJfU1lOQVBTRV9BQ1RJT05fTk9ORSwKKwlDT1VOVEVSX1NZ
TkFQU0VfQUNUSU9OX0JPVEhfRURHRVMKIH07CiAKLXN0YXRpYyBpbnQgc3RtMzJfYWN0aW9uX2dl
dChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkgICAgc3RydWN0IGNvdW50ZXJf
Y291bnQgKmNvdW50LAotCQkJICAgIHN0cnVjdCBjb3VudGVyX3N5bmFwc2UgKnN5bmFwc2UsCi0J
CQkgICAgc2l6ZV90ICphY3Rpb24pCitzdGF0aWMgaW50IHN0bTMyX2FjdGlvbl9yZWFkKHN0cnVj
dCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCSAgICAgc3RydWN0IGNvdW50ZXJfY291bnQg
KmNvdW50LAorCQkJICAgICBzdHJ1Y3QgY291bnRlcl9zeW5hcHNlICpzeW5hcHNlLAorCQkJICAg
ICBlbnVtIGNvdW50ZXJfc3luYXBzZV9hY3Rpb24gKmFjdGlvbikKIHsKLQlzaXplX3QgZnVuY3Rp
b247CisJZW51bSBjb3VudGVyX2Z1bmN0aW9uIGZ1bmN0aW9uOwogCWludCBlcnI7CiAKLQllcnIg
PSBzdG0zMl9jb3VudF9mdW5jdGlvbl9nZXQoY291bnRlciwgY291bnQsICZmdW5jdGlvbik7CisJ
ZXJyID0gc3RtMzJfY291bnRfZnVuY3Rpb25fcmVhZChjb3VudGVyLCBjb3VudCwgJmZ1bmN0aW9u
KTsKIAlpZiAoZXJyKQogCQlyZXR1cm4gZXJyOwogCiAJc3dpdGNoIChmdW5jdGlvbikgewogCWNh
c2UgU1RNMzJfQ09VTlRfU0xBVkVfTU9ERV9ESVNBQkxFRDoKIAkJLyogY291bnRzIG9uIGludGVy
bmFsIGNsb2NrIHdoZW4gQ0VOPTEgKi8KLQkJKmFjdGlvbiA9IFNUTTMyX1NZTkFQU0VfQUNUSU9O
X05PTkU7CisJCSphY3Rpb24gPSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX05PTkU7CiAJCXJldHVy
biAwOwogCWNhc2UgU1RNMzJfQ09VTlRfRU5DT0RFUl9NT0RFXzE6CiAJCS8qIGNvdW50cyB1cC9k
b3duIG9uIFRJMUZQMSBlZGdlIGRlcGVuZGluZyBvbiBUSTJGUDIgbGV2ZWwgKi8KIAkJaWYgKHN5
bmFwc2UtPnNpZ25hbC0+aWQgPT0gY291bnQtPnN5bmFwc2VzWzBdLnNpZ25hbC0+aWQpCi0JCQkq
YWN0aW9uID0gU1RNMzJfU1lOQVBTRV9BQ1RJT05fQk9USF9FREdFUzsKKwkJCSphY3Rpb24gPSBD
T1VOVEVSX1NZTkFQU0VfQUNUSU9OX0JPVEhfRURHRVM7CiAJCWVsc2UKLQkJCSphY3Rpb24gPSBT
VE0zMl9TWU5BUFNFX0FDVElPTl9OT05FOworCQkJKmFjdGlvbiA9IENPVU5URVJfU1lOQVBTRV9B
Q1RJT05fTk9ORTsKIAkJcmV0dXJuIDA7CiAJY2FzZSBTVE0zMl9DT1VOVF9FTkNPREVSX01PREVf
MjoKIAkJLyogY291bnRzIHVwL2Rvd24gb24gVEkyRlAyIGVkZ2UgZGVwZW5kaW5nIG9uIFRJMUZQ
MSBsZXZlbCAqLwogCQlpZiAoc3luYXBzZS0+c2lnbmFsLT5pZCA9PSBjb3VudC0+c3luYXBzZXNb
MV0uc2lnbmFsLT5pZCkKLQkJCSphY3Rpb24gPSBTVE0zMl9TWU5BUFNFX0FDVElPTl9CT1RIX0VE
R0VTOworCQkJKmFjdGlvbiA9IENPVU5URVJfU1lOQVBTRV9BQ1RJT05fQk9USF9FREdFUzsKIAkJ
ZWxzZQotCQkJKmFjdGlvbiA9IFNUTTMyX1NZTkFQU0VfQUNUSU9OX05PTkU7CisJCQkqYWN0aW9u
ID0gQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9OT05FOwogCQlyZXR1cm4gMDsKIAljYXNlIFNUTTMy
X0NPVU5UX0VOQ09ERVJfTU9ERV8zOgogCQkvKiBjb3VudHMgdXAvZG93biBvbiBib3RoIFRJMUZQ
MSBhbmQgVEkyRlAyIGVkZ2VzICovCi0JCSphY3Rpb24gPSBTVE0zMl9TWU5BUFNFX0FDVElPTl9C
T1RIX0VER0VTOworCQkqYWN0aW9uID0gQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9CT1RIX0VER0VT
OwogCQlyZXR1cm4gMDsKIAlkZWZhdWx0OgogCQlyZXR1cm4gLUVJTlZBTDsKQEAgLTMxNSw5ICsy
ODYsOSBAQCBzdGF0aWMgaW50IHN0bTMyX2FjdGlvbl9nZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNl
ICpjb3VudGVyLAogc3RhdGljIGNvbnN0IHN0cnVjdCBjb3VudGVyX29wcyBzdG0zMl90aW1lcl9j
bnRfb3BzID0gewogCS5jb3VudF9yZWFkID0gc3RtMzJfY291bnRfcmVhZCwKIAkuY291bnRfd3Jp
dGUgPSBzdG0zMl9jb3VudF93cml0ZSwKLQkuZnVuY3Rpb25fZ2V0ID0gc3RtMzJfY291bnRfZnVu
Y3Rpb25fZ2V0LAotCS5mdW5jdGlvbl9zZXQgPSBzdG0zMl9jb3VudF9mdW5jdGlvbl9zZXQsCi0J
LmFjdGlvbl9nZXQgPSBzdG0zMl9hY3Rpb25fZ2V0LAorCS5mdW5jdGlvbl9yZWFkID0gc3RtMzJf
Y291bnRfZnVuY3Rpb25fcmVhZCwKKwkuZnVuY3Rpb25fd3JpdGUgPSBzdG0zMl9jb3VudF9mdW5j
dGlvbl93cml0ZSwKKwkuYWN0aW9uX3JlYWQgPSBzdG0zMl9hY3Rpb25fcmVhZCwKIH07CiAKIHN0
YXRpYyBzdHJ1Y3QgY291bnRlcl9zaWduYWwgc3RtMzJfc2lnbmFsc1tdID0gewpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9jb3VudGVyL3RpLWVxZXAuYyBiL2RyaXZlcnMvY291bnRlci90aS1lcWVwLmMK
aW5kZXggMDRiZTI1ZWJmNGE0Li42ZmY1M2QzMTY0ZjUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvY291
bnRlci90aS1lcWVwLmMKKysrIGIvZHJpdmVycy9jb3VudGVyL3RpLWVxZXAuYwpAQCAtMTMsNiAr
MTMsNyBAQAogI2luY2x1ZGUgPGxpbnV4L3BsYXRmb3JtX2RldmljZS5oPgogI2luY2x1ZGUgPGxp
bnV4L3BtX3J1bnRpbWUuaD4KICNpbmNsdWRlIDxsaW51eC9yZWdtYXAuaD4KKyNpbmNsdWRlIDxs
aW51eC90eXBlcy5oPgogCiAvKiAzMi1iaXQgcmVnaXN0ZXJzICovCiAjZGVmaW5lIFFQT1NDTlQJ
CTB4MApAQCAtNzMsMTkgKzc0LDEzIEBAIGVudW0gewogfTsKIAogLyogUG9zaXRpb24gQ291bnRl
ciBJbnB1dCBNb2RlcyAqLwotZW51bSB7CitlbnVtIHRpX2VxZXBfY291bnRfZnVuYyB7CiAJVElf
RVFFUF9DT1VOVF9GVU5DX1FVQURfQ09VTlQsCiAJVElfRVFFUF9DT1VOVF9GVU5DX0RJUl9DT1VO
VCwKIAlUSV9FUUVQX0NPVU5UX0ZVTkNfVVBfQ09VTlQsCiAJVElfRVFFUF9DT1VOVF9GVU5DX0RP
V05fQ09VTlQsCiB9OwogCi1lbnVtIHsKLQlUSV9FUUVQX1NZTkFQU0VfQUNUSU9OX0JPVEhfRURH
RVMsCi0JVElfRVFFUF9TWU5BUFNFX0FDVElPTl9SSVNJTkdfRURHRSwKLQlUSV9FUUVQX1NZTkFQ
U0VfQUNUSU9OX05PTkUsCi19OwotCiBzdHJ1Y3QgdGlfZXFlcF9jbnQgewogCXN0cnVjdCBjb3Vu
dGVyX2RldmljZSBjb3VudGVyOwogCXN0cnVjdCByZWdtYXAgKnJlZ21hcDMyOwpAQCAtOTMsNyAr
ODgsNyBAQCBzdHJ1Y3QgdGlfZXFlcF9jbnQgewogfTsKIAogc3RhdGljIGludCB0aV9lcWVwX2Nv
dW50X3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJICAgICAgc3RydWN0
IGNvdW50ZXJfY291bnQgKmNvdW50LCB1bnNpZ25lZCBsb25nICp2YWwpCisJCQkgICAgICBzdHJ1
Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHU2NCAqdmFsKQogewogCXN0cnVjdCB0aV9lcWVwX2Nu
dCAqcHJpdiA9IGNvdW50ZXItPnByaXY7CiAJdTMyIGNudDsKQEAgLTEwNSw3ICsxMDAsNyBAQCBz
dGF0aWMgaW50IHRpX2VxZXBfY291bnRfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50
ZXIsCiB9CiAKIHN0YXRpYyBpbnQgdGlfZXFlcF9jb3VudF93cml0ZShzdHJ1Y3QgY291bnRlcl9k
ZXZpY2UgKmNvdW50ZXIsCi0JCQkgICAgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB1
bnNpZ25lZCBsb25nIHZhbCkKKwkJCSAgICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQs
IHU2NCB2YWwpCiB7CiAJc3RydWN0IHRpX2VxZXBfY250ICpwcml2ID0gY291bnRlci0+cHJpdjsK
IAl1MzIgbWF4OwpAQCAtMTE3LDYzICsxMTIsOTkgQEAgc3RhdGljIGludCB0aV9lcWVwX2NvdW50
X3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKIAlyZXR1cm4gcmVnbWFwX3dy
aXRlKHByaXYtPnJlZ21hcDMyLCBRUE9TQ05ULCB2YWwpOwogfQogCi1zdGF0aWMgaW50IHRpX2Vx
ZXBfZnVuY3Rpb25fZ2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQlzdHJ1
Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHNpemVfdCAqZnVuY3Rpb24pCitzdGF0aWMgaW50IHRp
X2VxZXBfZnVuY3Rpb25fcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJ
IHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKKwkJCQkgZW51bSBjb3VudGVyX2Z1bmN0aW9u
ICpmdW5jdGlvbikKIHsKIAlzdHJ1Y3QgdGlfZXFlcF9jbnQgKnByaXYgPSBjb3VudGVyLT5wcml2
OwogCXUzMiBxZGVjY3RsOwogCiAJcmVnbWFwX3JlYWQocHJpdi0+cmVnbWFwMTYsIFFERUNDVEws
ICZxZGVjY3RsKTsKLQkqZnVuY3Rpb24gPSAocWRlY2N0bCAmIFFERUNDVExfUVNSQykgPj4gUURF
Q0NUTF9RU1JDX1NISUZUOworCisJc3dpdGNoICgocWRlY2N0bCAmIFFERUNDVExfUVNSQykgPj4g
UURFQ0NUTF9RU1JDX1NISUZUKSB7CisJY2FzZSBUSV9FUUVQX0NPVU5UX0ZVTkNfUVVBRF9DT1VO
VDoKKwkJKmZ1bmN0aW9uID0gQ09VTlRFUl9GVU5DVElPTl9RVUFEUkFUVVJFX1g0OworCQlicmVh
azsKKwljYXNlIFRJX0VRRVBfQ09VTlRfRlVOQ19ESVJfQ09VTlQ6CisJCSpmdW5jdGlvbiA9IENP
VU5URVJfRlVOQ1RJT05fUFVMU0VfRElSRUNUSU9OOworCQlicmVhazsKKwljYXNlIFRJX0VRRVBf
Q09VTlRfRlVOQ19VUF9DT1VOVDoKKwkJKmZ1bmN0aW9uID0gQ09VTlRFUl9GVU5DVElPTl9JTkNS
RUFTRTsKKwkJYnJlYWs7CisJY2FzZSBUSV9FUUVQX0NPVU5UX0ZVTkNfRE9XTl9DT1VOVDoKKwkJ
KmZ1bmN0aW9uID0gQ09VTlRFUl9GVU5DVElPTl9ERUNSRUFTRTsKKwkJYnJlYWs7CisJfQogCiAJ
cmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBpbnQgdGlfZXFlcF9mdW5jdGlvbl9zZXQoc3RydWN0IGNv
dW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCXN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwg
c2l6ZV90IGZ1bmN0aW9uKQorc3RhdGljIGludCB0aV9lcWVwX2Z1bmN0aW9uX3dyaXRlKHN0cnVj
dCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpj
b3VudCwKKwkJCQkgIGVudW0gY291bnRlcl9mdW5jdGlvbiBmdW5jdGlvbikKIHsKIAlzdHJ1Y3Qg
dGlfZXFlcF9jbnQgKnByaXYgPSBjb3VudGVyLT5wcml2OworCWVudW0gdGlfZXFlcF9jb3VudF9m
dW5jIHFzcmM7CisKKwlzd2l0Y2ggKGZ1bmN0aW9uKSB7CisJY2FzZSBDT1VOVEVSX0ZVTkNUSU9O
X1FVQURSQVRVUkVfWDQ6CisJCXFzcmMgPSBUSV9FUUVQX0NPVU5UX0ZVTkNfUVVBRF9DT1VOVDsK
KwkJYnJlYWs7CisJY2FzZSBDT1VOVEVSX0ZVTkNUSU9OX1BVTFNFX0RJUkVDVElPTjoKKwkJcXNy
YyA9IFRJX0VRRVBfQ09VTlRfRlVOQ19ESVJfQ09VTlQ7CisJCWJyZWFrOworCWNhc2UgQ09VTlRF
Ul9GVU5DVElPTl9JTkNSRUFTRToKKwkJcXNyYyA9IFRJX0VRRVBfQ09VTlRfRlVOQ19VUF9DT1VO
VDsKKwkJYnJlYWs7CisJY2FzZSBDT1VOVEVSX0ZVTkNUSU9OX0RFQ1JFQVNFOgorCQlxc3JjID0g
VElfRVFFUF9DT1VOVF9GVU5DX0RPV05fQ09VTlQ7CisJCWJyZWFrOworCWRlZmF1bHQ6CisJCS8q
IHNob3VsZCBuZXZlciByZWFjaCB0aGlzIHBhdGggKi8KKwkJcmV0dXJuIC1FSU5WQUw7CisJfQog
CiAJcmV0dXJuIHJlZ21hcF93cml0ZV9iaXRzKHByaXYtPnJlZ21hcDE2LCBRREVDQ1RMLCBRREVD
Q1RMX1FTUkMsCi0JCQkJIGZ1bmN0aW9uIDw8IFFERUNDVExfUVNSQ19TSElGVCk7CisJCQkJIHFz
cmMgPDwgUURFQ0NUTF9RU1JDX1NISUZUKTsKIH0KIAotc3RhdGljIGludCB0aV9lcWVwX2FjdGlv
bl9nZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJICAgICAgc3RydWN0IGNv
dW50ZXJfY291bnQgKmNvdW50LAotCQkJICAgICAgc3RydWN0IGNvdW50ZXJfc3luYXBzZSAqc3lu
YXBzZSwgc2l6ZV90ICphY3Rpb24pCitzdGF0aWMgaW50IHRpX2VxZXBfYWN0aW9uX3JlYWQoc3Ry
dWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJICAgICAgIHN0cnVjdCBjb3VudGVyX2Nv
dW50ICpjb3VudCwKKwkJCSAgICAgICBzdHJ1Y3QgY291bnRlcl9zeW5hcHNlICpzeW5hcHNlLAor
CQkJICAgICAgIGVudW0gY291bnRlcl9zeW5hcHNlX2FjdGlvbiAqYWN0aW9uKQogewogCXN0cnVj
dCB0aV9lcWVwX2NudCAqcHJpdiA9IGNvdW50ZXItPnByaXY7Ci0Jc2l6ZV90IGZ1bmN0aW9uOwor
CWVudW0gY291bnRlcl9mdW5jdGlvbiBmdW5jdGlvbjsKIAl1MzIgcWRlY2N0bDsKIAlpbnQgZXJy
OwogCi0JZXJyID0gdGlfZXFlcF9mdW5jdGlvbl9nZXQoY291bnRlciwgY291bnQsICZmdW5jdGlv
bik7CisJZXJyID0gdGlfZXFlcF9mdW5jdGlvbl9yZWFkKGNvdW50ZXIsIGNvdW50LCAmZnVuY3Rp
b24pOwogCWlmIChlcnIpCiAJCXJldHVybiBlcnI7CiAKIAlzd2l0Y2ggKGZ1bmN0aW9uKSB7Ci0J
Y2FzZSBUSV9FUUVQX0NPVU5UX0ZVTkNfUVVBRF9DT1VOVDoKKwljYXNlIENPVU5URVJfRlVOQ1RJ
T05fUVVBRFJBVFVSRV9YNDoKIAkJLyogSW4gcXVhZHJhdHVyZSBtb2RlLCB0aGUgcmlzaW5nIGFu
ZCBmYWxsaW5nIGVkZ2Ugb2YgYm90aAogCQkgKiBRRVBBIGFuZCBRRVBCIHRyaWdnZXIgUUNMSy4K
IAkJICovCi0JCSphY3Rpb24gPSBUSV9FUUVQX1NZTkFQU0VfQUNUSU9OX0JPVEhfRURHRVM7CisJ
CSphY3Rpb24gPSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX0JPVEhfRURHRVM7CiAJCXJldHVybiAw
OwotCWNhc2UgVElfRVFFUF9DT1VOVF9GVU5DX0RJUl9DT1VOVDoKKwljYXNlIENPVU5URVJfRlVO
Q1RJT05fUFVMU0VfRElSRUNUSU9OOgogCQkvKiBJbiBkaXJlY3Rpb24tY291bnQgbW9kZSBvbmx5
IHJpc2luZyBlZGdlIG9mIFFFUEEgaXMgY291bnRlZAogCQkgKiBhbmQgUUVQQiBnaXZlcyBkaXJl
Y3Rpb24uCiAJCSAqLwogCQlpZiAoc3luYXBzZS0+c2lnbmFsLT5pZCA9PSBUSV9FUUVQX1NJR05B
TF9RRVBCKQotCQkJKmFjdGlvbiA9IFRJX0VRRVBfU1lOQVBTRV9BQ1RJT05fTk9ORTsKKwkJCSph
Y3Rpb24gPSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX05PTkU7CiAJCWVsc2UKLQkJCSphY3Rpb24g
PSBUSV9FUUVQX1NZTkFQU0VfQUNUSU9OX1JJU0lOR19FREdFOworCQkJKmFjdGlvbiA9IENPVU5U
RVJfU1lOQVBTRV9BQ1RJT05fUklTSU5HX0VER0U7CiAJCXJldHVybiAwOwotCWNhc2UgVElfRVFF
UF9DT1VOVF9GVU5DX1VQX0NPVU5UOgotCWNhc2UgVElfRVFFUF9DT1VOVF9GVU5DX0RPV05fQ09V
TlQ6CisJY2FzZSBDT1VOVEVSX0ZVTkNUSU9OX0lOQ1JFQVNFOgorCWNhc2UgQ09VTlRFUl9GVU5D
VElPTl9ERUNSRUFTRToKIAkJLyogSW4gdXAvZG93bi1jb3VudCBtb2RlcyBvbmx5IFFFUEEgaXMg
Y291bnRlZCBhbmQgUUVQQiBpcyBub3QKIAkJICogdXNlZC4KIAkJICovCiAJCWlmIChzeW5hcHNl
LT5zaWduYWwtPmlkID09IFRJX0VRRVBfU0lHTkFMX1FFUEIpIHsKLQkJCSphY3Rpb24gPSBUSV9F
UUVQX1NZTkFQU0VfQUNUSU9OX05PTkU7CisJCQkqYWN0aW9uID0gQ09VTlRFUl9TWU5BUFNFX0FD
VElPTl9OT05FOwogCQkJcmV0dXJuIDA7CiAJCX0KIApAQCAtMTgyLDkgKzIxMyw5IEBAIHN0YXRp
YyBpbnQgdGlfZXFlcF9hY3Rpb25fZ2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwK
IAkJCXJldHVybiBlcnI7CiAKIAkJaWYgKHFkZWNjdGwgJiBRREVDQ1RMX1hDUikKLQkJCSphY3Rp
b24gPSBUSV9FUUVQX1NZTkFQU0VfQUNUSU9OX0JPVEhfRURHRVM7CisJCQkqYWN0aW9uID0gQ09V
TlRFUl9TWU5BUFNFX0FDVElPTl9CT1RIX0VER0VTOwogCQllbHNlCi0JCQkqYWN0aW9uID0gVElf
RVFFUF9TWU5BUFNFX0FDVElPTl9SSVNJTkdfRURHRTsKKwkJCSphY3Rpb24gPSBDT1VOVEVSX1NZ
TkFQU0VfQUNUSU9OX1JJU0lOR19FREdFOwogCQlyZXR1cm4gMDsKIAlkZWZhdWx0OgogCQkvKiBz
aG91bGQgbmV2ZXIgcmVhY2ggdGhpcyBwYXRoICovCkBAIC0xOTUsODIgKzIyNiw2NyBAQCBzdGF0
aWMgaW50IHRpX2VxZXBfYWN0aW9uX2dldChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIs
CiBzdGF0aWMgY29uc3Qgc3RydWN0IGNvdW50ZXJfb3BzIHRpX2VxZXBfY291bnRlcl9vcHMgPSB7
CiAJLmNvdW50X3JlYWQJPSB0aV9lcWVwX2NvdW50X3JlYWQsCiAJLmNvdW50X3dyaXRlCT0gdGlf
ZXFlcF9jb3VudF93cml0ZSwKLQkuZnVuY3Rpb25fZ2V0CT0gdGlfZXFlcF9mdW5jdGlvbl9nZXQs
Ci0JLmZ1bmN0aW9uX3NldAk9IHRpX2VxZXBfZnVuY3Rpb25fc2V0LAotCS5hY3Rpb25fZ2V0CT0g
dGlfZXFlcF9hY3Rpb25fZ2V0LAorCS5mdW5jdGlvbl9yZWFkCT0gdGlfZXFlcF9mdW5jdGlvbl9y
ZWFkLAorCS5mdW5jdGlvbl93cml0ZQk9IHRpX2VxZXBfZnVuY3Rpb25fd3JpdGUsCisJLmFjdGlv
bl9yZWFkCT0gdGlfZXFlcF9hY3Rpb25fcmVhZCwKIH07CiAKLXN0YXRpYyBzc2l6ZV90IHRpX2Vx
ZXBfcG9zaXRpb25fY2VpbGluZ19yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwK
LQkJCQkJICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCi0JCQkJCSAgICAgdm9pZCAq
ZXh0X3ByaXYsIGNoYXIgKmJ1ZikKK3N0YXRpYyBpbnQgdGlfZXFlcF9wb3NpdGlvbl9jZWlsaW5n
X3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCQkgc3RydWN0IGNvdW50
ZXJfY291bnQgKmNvdW50LAorCQkJCQkgdTY0ICpjZWlsaW5nKQogewogCXN0cnVjdCB0aV9lcWVw
X2NudCAqcHJpdiA9IGNvdW50ZXItPnByaXY7CiAJdTMyIHFwb3NtYXg7CiAKIAlyZWdtYXBfcmVh
ZChwcml2LT5yZWdtYXAzMiwgUVBPU01BWCwgJnFwb3NtYXgpOwogCi0JcmV0dXJuIHNwcmludGYo
YnVmLCAiJXVcbiIsIHFwb3NtYXgpOworCSpjZWlsaW5nID0gcXBvc21heDsKKworCXJldHVybiAw
OwogfQogCi1zdGF0aWMgc3NpemVfdCB0aV9lcWVwX3Bvc2l0aW9uX2NlaWxpbmdfd3JpdGUoc3Ry
dWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCQkgICAgICBzdHJ1Y3QgY291bnRlcl9j
b3VudCAqY291bnQsCi0JCQkJCSAgICAgIHZvaWQgKmV4dF9wcml2LCBjb25zdCBjaGFyICpidWYs
Ci0JCQkJCSAgICAgIHNpemVfdCBsZW4pCitzdGF0aWMgaW50IHRpX2VxZXBfcG9zaXRpb25fY2Vp
bGluZ193cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJCSAgc3RydWN0
IGNvdW50ZXJfY291bnQgKmNvdW50LAorCQkJCQkgIHU2NCBjZWlsaW5nKQogewogCXN0cnVjdCB0
aV9lcWVwX2NudCAqcHJpdiA9IGNvdW50ZXItPnByaXY7Ci0JaW50IGVycjsKLQl1MzIgcmVzOwog
Ci0JZXJyID0ga3N0cnRvdWludChidWYsIDAsICZyZXMpOwotCWlmIChlcnIgPCAwKQotCQlyZXR1
cm4gZXJyOworCWlmIChjZWlsaW5nICE9ICh1MzIpY2VpbGluZykKKwkJcmV0dXJuIC1FUkFOR0U7
CiAKLQlyZWdtYXBfd3JpdGUocHJpdi0+cmVnbWFwMzIsIFFQT1NNQVgsIHJlcyk7CisJcmVnbWFw
X3dyaXRlKHByaXYtPnJlZ21hcDMyLCBRUE9TTUFYLCBjZWlsaW5nKTsKIAotCXJldHVybiBsZW47
CisJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBzc2l6ZV90IHRpX2VxZXBfcG9zaXRpb25fZW5hYmxl
X3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCQkgICAgc3RydWN0IGNv
dW50ZXJfY291bnQgKmNvdW50LAotCQkJCQkgICAgdm9pZCAqZXh0X3ByaXYsIGNoYXIgKmJ1ZikK
K3N0YXRpYyBpbnQgdGlfZXFlcF9wb3NpdGlvbl9lbmFibGVfcmVhZChzdHJ1Y3QgY291bnRlcl9k
ZXZpY2UgKmNvdW50ZXIsCisJCQkJCXN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgdTggKmVu
YWJsZSkKIHsKIAlzdHJ1Y3QgdGlfZXFlcF9jbnQgKnByaXYgPSBjb3VudGVyLT5wcml2OwogCXUz
MiBxZXBjdGw7CiAKIAlyZWdtYXBfcmVhZChwcml2LT5yZWdtYXAxNiwgUUVQQ1RMLCAmcWVwY3Rs
KTsKIAotCXJldHVybiBzcHJpbnRmKGJ1ZiwgIiV1XG4iLCAhIShxZXBjdGwgJiBRRVBDVExfUEhF
TikpOworCSplbmFibGUgPSAhIShxZXBjdGwgJiBRRVBDVExfUEhFTik7CisKKwlyZXR1cm4gMDsK
IH0KIAotc3RhdGljIHNzaXplX3QgdGlfZXFlcF9wb3NpdGlvbl9lbmFibGVfd3JpdGUoc3RydWN0
IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCQkgICAgIHN0cnVjdCBjb3VudGVyX2NvdW50
ICpjb3VudCwKLQkJCQkJICAgICB2b2lkICpleHRfcHJpdiwgY29uc3QgY2hhciAqYnVmLAotCQkJ
CQkgICAgIHNpemVfdCBsZW4pCitzdGF0aWMgaW50IHRpX2VxZXBfcG9zaXRpb25fZW5hYmxlX3dy
aXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkJIHN0cnVjdCBjb3VudGVy
X2NvdW50ICpjb3VudCwgdTggZW5hYmxlKQogewogCXN0cnVjdCB0aV9lcWVwX2NudCAqcHJpdiA9
IGNvdW50ZXItPnByaXY7Ci0JaW50IGVycjsKLQlib29sIHJlczsKLQotCWVyciA9IGtzdHJ0b2Jv
b2woYnVmLCAmcmVzKTsKLQlpZiAoZXJyIDwgMCkKLQkJcmV0dXJuIGVycjsKIAotCXJlZ21hcF93
cml0ZV9iaXRzKHByaXYtPnJlZ21hcDE2LCBRRVBDVEwsIFFFUENUTF9QSEVOLCByZXMgPyAtMSA6
IDApOworCXJlZ21hcF93cml0ZV9iaXRzKHByaXYtPnJlZ21hcDE2LCBRRVBDVEwsIFFFUENUTF9Q
SEVOLCBlbmFibGUgPyAtMSA6IDApOwogCi0JcmV0dXJuIGxlbjsKKwlyZXR1cm4gMDsKIH0KIAot
c3RhdGljIHN0cnVjdCBjb3VudGVyX2NvdW50X2V4dCB0aV9lcWVwX3Bvc2l0aW9uX2V4dFtdID0g
ewotCXsKLQkJLm5hbWUJPSAiY2VpbGluZyIsCi0JCS5yZWFkCT0gdGlfZXFlcF9wb3NpdGlvbl9j
ZWlsaW5nX3JlYWQsCi0JCS53cml0ZQk9IHRpX2VxZXBfcG9zaXRpb25fY2VpbGluZ193cml0ZSwK
LQl9LAotCXsKLQkJLm5hbWUJPSAiZW5hYmxlIiwKLQkJLnJlYWQJPSB0aV9lcWVwX3Bvc2l0aW9u
X2VuYWJsZV9yZWFkLAotCQkud3JpdGUJPSB0aV9lcWVwX3Bvc2l0aW9uX2VuYWJsZV93cml0ZSwK
LQl9LAorc3RhdGljIHN0cnVjdCBjb3VudGVyX2NvbXAgdGlfZXFlcF9wb3NpdGlvbl9leHRbXSA9
IHsKKwlDT1VOVEVSX0NPTVBfQ0VJTElORyh0aV9lcWVwX3Bvc2l0aW9uX2NlaWxpbmdfcmVhZCwK
KwkJCSAgICAgdGlfZXFlcF9wb3NpdGlvbl9jZWlsaW5nX3dyaXRlKSwKKwlDT1VOVEVSX0NPTVBf
RU5BQkxFKHRpX2VxZXBfcG9zaXRpb25fZW5hYmxlX3JlYWQsCisJCQkgICAgdGlfZXFlcF9wb3Np
dGlvbl9lbmFibGVfd3JpdGUpLAogfTsKIAogc3RhdGljIHN0cnVjdCBjb3VudGVyX3NpZ25hbCB0
aV9lcWVwX3NpZ25hbHNbXSA9IHsKQEAgLTI4NSwxNiArMzAxLDE2IEBAIHN0YXRpYyBzdHJ1Y3Qg
Y291bnRlcl9zaWduYWwgdGlfZXFlcF9zaWduYWxzW10gPSB7CiB9OwogCiBzdGF0aWMgY29uc3Qg
ZW51bSBjb3VudGVyX2Z1bmN0aW9uIHRpX2VxZXBfcG9zaXRpb25fZnVuY3Rpb25zW10gPSB7Ci0J
W1RJX0VRRVBfQ09VTlRfRlVOQ19RVUFEX0NPVU5UXQk9IENPVU5URVJfRlVOQ1RJT05fUVVBRFJB
VFVSRV9YNCwKLQlbVElfRVFFUF9DT1VOVF9GVU5DX0RJUl9DT1VOVF0JPSBDT1VOVEVSX0ZVTkNU
SU9OX1BVTFNFX0RJUkVDVElPTiwKLQlbVElfRVFFUF9DT1VOVF9GVU5DX1VQX0NPVU5UXQk9IENP
VU5URVJfRlVOQ1RJT05fSU5DUkVBU0UsCi0JW1RJX0VRRVBfQ09VTlRfRlVOQ19ET1dOX0NPVU5U
XQk9IENPVU5URVJfRlVOQ1RJT05fREVDUkVBU0UsCisJQ09VTlRFUl9GVU5DVElPTl9RVUFEUkFU
VVJFX1g0LAorCUNPVU5URVJfRlVOQ1RJT05fUFVMU0VfRElSRUNUSU9OLAorCUNPVU5URVJfRlVO
Q1RJT05fSU5DUkVBU0UsCisJQ09VTlRFUl9GVU5DVElPTl9ERUNSRUFTRSwKIH07CiAKIHN0YXRp
YyBjb25zdCBlbnVtIGNvdW50ZXJfc3luYXBzZV9hY3Rpb24gdGlfZXFlcF9wb3NpdGlvbl9zeW5h
cHNlX2FjdGlvbnNbXSA9IHsKLQlbVElfRVFFUF9TWU5BUFNFX0FDVElPTl9CT1RIX0VER0VTXQk9
IENPVU5URVJfU1lOQVBTRV9BQ1RJT05fQk9USF9FREdFUywKLQlbVElfRVFFUF9TWU5BUFNFX0FD
VElPTl9SSVNJTkdfRURHRV0JPSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX1JJU0lOR19FREdFLAot
CVtUSV9FUUVQX1NZTkFQU0VfQUNUSU9OX05PTkVdCQk9IENPVU5URVJfU1lOQVBTRV9BQ1RJT05f
Tk9ORSwKKwlDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX0JPVEhfRURHRVMsCisJQ09VTlRFUl9TWU5B
UFNFX0FDVElPTl9SSVNJTkdfRURHRSwKKwlDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX05PTkUsCiB9
OwogCiBzdGF0aWMgc3RydWN0IGNvdW50ZXJfc3luYXBzZSB0aV9lcWVwX3Bvc2l0aW9uX3N5bmFw
c2VzW10gPSB7CmRpZmYgLS1naXQgYS9pbmNsdWRlL2xpbnV4L2NvdW50ZXIuaCBiL2luY2x1ZGUv
bGludXgvY291bnRlci5oCmluZGV4IGQxNmNlMjgxOWI0OC4uNTY3NDcxODE4ZWMzIDEwMDY0NAot
LS0gYS9pbmNsdWRlL2xpbnV4L2NvdW50ZXIuaAorKysgYi9pbmNsdWRlL2xpbnV4L2NvdW50ZXIu
aApAQCAtNiw0MiArNiwxODQgQEAKICNpZm5kZWYgX0NPVU5URVJfSF8KICNkZWZpbmUgX0NPVU5U
RVJfSF8KIAotI2luY2x1ZGUgPGxpbnV4L2NvdW50ZXJfZW51bS5oPgogI2luY2x1ZGUgPGxpbnV4
L2RldmljZS5oPgorI2luY2x1ZGUgPGxpbnV4L2tlcm5lbC5oPgogI2luY2x1ZGUgPGxpbnV4L3R5
cGVzLmg+CiAKK3N0cnVjdCBjb3VudGVyX2RldmljZTsKK3N0cnVjdCBjb3VudGVyX2NvdW50Owor
c3RydWN0IGNvdW50ZXJfc3luYXBzZTsKK3N0cnVjdCBjb3VudGVyX3NpZ25hbDsKKworZW51bSBj
b3VudGVyX2NvbXBfdHlwZSB7CisJQ09VTlRFUl9DT01QX1U4LAorCUNPVU5URVJfQ09NUF9VNjQs
CisJQ09VTlRFUl9DT01QX0JPT0wsCisJQ09VTlRFUl9DT01QX1NJR05BTF9MRVZFTCwKKwlDT1VO
VEVSX0NPTVBfRlVOQ1RJT04sCisJQ09VTlRFUl9DT01QX1NZTkFQU0VfQUNUSU9OLAorCUNPVU5U
RVJfQ09NUF9FTlVNLAorCUNPVU5URVJfQ09NUF9DT1VOVF9ESVJFQ1RJT04sCisJQ09VTlRFUl9D
T01QX0NPVU5UX01PREUsCit9OworCitlbnVtIGNvdW50ZXJfc2NvcGUgeworCUNPVU5URVJfU0NP
UEVfREVWSUNFLAorCUNPVU5URVJfU0NPUEVfU0lHTkFMLAorCUNPVU5URVJfU0NPUEVfQ09VTlQs
Cit9OworCiBlbnVtIGNvdW50ZXJfY291bnRfZGlyZWN0aW9uIHsKLQlDT1VOVEVSX0NPVU5UX0RJ
UkVDVElPTl9GT1JXQVJEID0gMCwKLQlDT1VOVEVSX0NPVU5UX0RJUkVDVElPTl9CQUNLV0FSRAor
CUNPVU5URVJfQ09VTlRfRElSRUNUSU9OX0ZPUldBUkQsCisJQ09VTlRFUl9DT1VOVF9ESVJFQ1RJ
T05fQkFDS1dBUkQsCiB9OwotZXh0ZXJuIGNvbnN0IGNoYXIgKmNvbnN0IGNvdW50ZXJfY291bnRf
ZGlyZWN0aW9uX3N0clsyXTsKIAogZW51bSBjb3VudGVyX2NvdW50X21vZGUgewotCUNPVU5URVJf
Q09VTlRfTU9ERV9OT1JNQUwgPSAwLAorCUNPVU5URVJfQ09VTlRfTU9ERV9OT1JNQUwsCiAJQ09V
TlRFUl9DT1VOVF9NT0RFX1JBTkdFX0xJTUlULAogCUNPVU5URVJfQ09VTlRfTU9ERV9OT05fUkVD
WUNMRSwKLQlDT1VOVEVSX0NPVU5UX01PREVfTU9EVUxPX04KKwlDT1VOVEVSX0NPVU5UX01PREVf
TU9EVUxPX04sCiB9OwotZXh0ZXJuIGNvbnN0IGNoYXIgKmNvbnN0IGNvdW50ZXJfY291bnRfbW9k
ZV9zdHJbNF07CiAKLXN0cnVjdCBjb3VudGVyX2RldmljZTsKLXN0cnVjdCBjb3VudGVyX3NpZ25h
bDsKK2VudW0gY291bnRlcl9mdW5jdGlvbiB7CisJQ09VTlRFUl9GVU5DVElPTl9JTkNSRUFTRSwK
KwlDT1VOVEVSX0ZVTkNUSU9OX0RFQ1JFQVNFLAorCUNPVU5URVJfRlVOQ1RJT05fUFVMU0VfRElS
RUNUSU9OLAorCUNPVU5URVJfRlVOQ1RJT05fUVVBRFJBVFVSRV9YMV9BLAorCUNPVU5URVJfRlVO
Q1RJT05fUVVBRFJBVFVSRV9YMV9CLAorCUNPVU5URVJfRlVOQ1RJT05fUVVBRFJBVFVSRV9YMl9B
LAorCUNPVU5URVJfRlVOQ1RJT05fUVVBRFJBVFVSRV9YMl9CLAorCUNPVU5URVJfRlVOQ1RJT05f
UVVBRFJBVFVSRV9YNCwKK307CisKK2VudW0gY291bnRlcl9zaWduYWxfbGV2ZWwgeworCUNPVU5U
RVJfU0lHTkFMX0xFVkVMX0xPVywKKwlDT1VOVEVSX1NJR05BTF9MRVZFTF9ISUdILAorfTsKKwor
ZW51bSBjb3VudGVyX3N5bmFwc2VfYWN0aW9uIHsKKwlDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX05P
TkUsCisJQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9SSVNJTkdfRURHRSwKKwlDT1VOVEVSX1NZTkFQ
U0VfQUNUSU9OX0ZBTExJTkdfRURHRSwKKwlDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX0JPVEhfRURH
RVMsCit9OwogCiAvKioKLSAqIHN0cnVjdCBjb3VudGVyX3NpZ25hbF9leHQgLSBDb3VudGVyIFNp
Z25hbCBleHRlbnNpb25zCi0gKiBAbmFtZToJYXR0cmlidXRlIG5hbWUKLSAqIEByZWFkOglyZWFk
IGNhbGxiYWNrIGZvciB0aGlzIGF0dHJpYnV0ZTsgbWF5IGJlIE5VTEwKLSAqIEB3cml0ZToJd3Jp
dGUgY2FsbGJhY2sgZm9yIHRoaXMgYXR0cmlidXRlOyBtYXkgYmUgTlVMTAotICogQHByaXY6CWRh
dGEgcHJpdmF0ZSB0byB0aGUgZHJpdmVyCisgKiBzdHJ1Y3QgY291bnRlcl9jb21wIC0gQ291bnRl
ciBjb21wb25lbnQgbm9kZQorICogQHR5cGU6CQlDb3VudGVyIGNvbXBvbmVudCBkYXRhIHR5cGUK
KyAqIEBuYW1lOgkJZGV2aWNlLXNwZWNpZmljIGNvbXBvbmVudCBuYW1lCisgKiBAcHJpdjoJCWNv
bXBvbmVudC1yZWxldmFudCBkYXRhCisgKiBAYWN0aW9uX3JlYWQJCVN5bmFwc2UgYWN0aW9uIG1v
ZGUgcmVhZCBjYWxsYmFjay4gVGhlIHJlYWQgdmFsdWUgb2YgdGhlCisgKgkJCXJlc3BlY3RpdmUg
U3luYXBzZSBhY3Rpb24gbW9kZSBzaG91bGQgYmUgcGFzc2VkIGJhY2sgdmlhCisgKgkJCXRoZSBh
Y3Rpb24gcGFyYW1ldGVyLgorICogQGRldmljZV91OF9yZWFkCURldmljZSB1OCBjb21wb25lbnQg
cmVhZCBjYWxsYmFjay4gVGhlIHJlYWQgdmFsdWUgb2YgdGhlCisgKgkJCXJlc3BlY3RpdmUgRGV2
aWNlIHU4IGNvbXBvbmVudCBzaG91bGQgYmUgcGFzc2VkIGJhY2sgdmlhCisgKgkJCXRoZSB2YWwg
cGFyYW1ldGVyLgorICogQGNvdW50X3U4X3JlYWQJQ291bnQgdTggY29tcG9uZW50IHJlYWQgY2Fs
bGJhY2suIFRoZSByZWFkIHZhbHVlIG9mIHRoZQorICoJCQlyZXNwZWN0aXZlIENvdW50IHU4IGNv
bXBvbmVudCBzaG91bGQgYmUgcGFzc2VkIGJhY2sgdmlhCisgKgkJCXRoZSB2YWwgcGFyYW1ldGVy
LgorICogQHNpZ25hbF91OF9yZWFkCVNpZ25hbCB1OCBjb21wb25lbnQgcmVhZCBjYWxsYmFjay4g
VGhlIHJlYWQgdmFsdWUgb2YgdGhlCisgKgkJCXJlc3BlY3RpdmUgU2lnbmFsIHU4IGNvbXBvbmVu
dCBzaG91bGQgYmUgcGFzc2VkIGJhY2sgdmlhCisgKgkJCXRoZSB2YWwgcGFyYW1ldGVyLgorICog
QGRldmljZV91MzJfcmVhZAlEZXZpY2UgdTMyIGNvbXBvbmVudCByZWFkIGNhbGxiYWNrLiBUaGUg
cmVhZCB2YWx1ZSBvZgorICoJCQl0aGUgcmVzcGVjdGl2ZSBEZXZpY2UgdTMyIGNvbXBvbmVudCBz
aG91bGQgYmUgcGFzc2VkCisgKgkJCWJhY2sgdmlhIHRoZSB2YWwgcGFyYW1ldGVyLgorICogQGNv
dW50X3UzMl9yZWFkCUNvdW50IHUzMiBjb21wb25lbnQgcmVhZCBjYWxsYmFjay4gVGhlIHJlYWQg
dmFsdWUgb2YgdGhlCisgKgkJCXJlc3BlY3RpdmUgQ291bnQgdTMyIGNvbXBvbmVudCBzaG91bGQg
YmUgcGFzc2VkIGJhY2sgdmlhCisgKgkJCXRoZSB2YWwgcGFyYW1ldGVyLgorICogQHNpZ25hbF91
MzJfcmVhZAlTaWduYWwgdTMyIGNvbXBvbmVudCByZWFkIGNhbGxiYWNrLiBUaGUgcmVhZCB2YWx1
ZSBvZgorICoJCQl0aGUgcmVzcGVjdGl2ZSBTaWduYWwgdTMyIGNvbXBvbmVudCBzaG91bGQgYmUg
cGFzc2VkCisgKgkJCWJhY2sgdmlhIHRoZSB2YWwgcGFyYW1ldGVyLgorICogQGRldmljZV91NjRf
cmVhZAlEZXZpY2UgdTY0IGNvbXBvbmVudCByZWFkIGNhbGxiYWNrLiBUaGUgcmVhZCB2YWx1ZSBv
ZgorICoJCQl0aGUgcmVzcGVjdGl2ZSBEZXZpY2UgdTY0IGNvbXBvbmVudCBzaG91bGQgYmUgcGFz
c2VkCisgKgkJCWJhY2sgdmlhIHRoZSB2YWwgcGFyYW1ldGVyLgorICogQGNvdW50X3U2NF9yZWFk
CUNvdW50IHU2NCBjb21wb25lbnQgcmVhZCBjYWxsYmFjay4gVGhlIHJlYWQgdmFsdWUgb2YgdGhl
CisgKgkJCXJlc3BlY3RpdmUgQ291bnQgdTY0IGNvbXBvbmVudCBzaG91bGQgYmUgcGFzc2VkIGJh
Y2sgdmlhCisgKgkJCXRoZSB2YWwgcGFyYW1ldGVyLgorICogQHNpZ25hbF91NjRfcmVhZAlTaWdu
YWwgdTY0IGNvbXBvbmVudCByZWFkIGNhbGxiYWNrLiBUaGUgcmVhZCB2YWx1ZSBvZgorICoJCQl0
aGUgcmVzcGVjdGl2ZSBTaWduYWwgdTY0IGNvbXBvbmVudCBzaG91bGQgYmUgcGFzc2VkCisgKgkJ
CWJhY2sgdmlhIHRoZSB2YWwgcGFyYW1ldGVyLgorICogQGFjdGlvbl93cml0ZQlTeW5hcHNlIGFj
dGlvbiBtb2RlIHdyaXRlIGNhbGxiYWNrLiBUaGUgd3JpdGUgdmFsdWUgb2YKKyAqCQkJdGhlIHJl
c3BlY3RpdmUgU3luYXBzZSBhY3Rpb24gbW9kZSBpcyBwYXNzZWQgdmlhIHRoZQorICoJCQlhY3Rp
b24gcGFyYW1ldGVyLgorICogQGRldmljZV91OF93cml0ZQlEZXZpY2UgdTggY29tcG9uZW50IHdy
aXRlIGNhbGxiYWNrLiBUaGUgd3JpdGUgdmFsdWUgb2YKKyAqCQkJdGhlIHJlc3BlY3RpdmUgRGV2
aWNlIHU4IGNvbXBvbmVudCBpcyBwYXNzZWQgdmlhIHRoZSB2YWwKKyAqCQkJcGFyYW1ldGVyLgor
ICogQGNvdW50X3U4X3dyaXRlCUNvdW50IHU4IGNvbXBvbmVudCB3cml0ZSBjYWxsYmFjay4gVGhl
IHdyaXRlIHZhbHVlIG9mCisgKgkJCXRoZSByZXNwZWN0aXZlIENvdW50IHU4IGNvbXBvbmVudCBp
cyBwYXNzZWQgdmlhIHRoZSB2YWwKKyAqCQkJcGFyYW1ldGVyLgorICogQHNpZ25hbF91OF93cml0
ZQlTaWduYWwgdTggY29tcG9uZW50IHdyaXRlIGNhbGxiYWNrLiBUaGUgd3JpdGUgdmFsdWUgb2YK
KyAqCQkJdGhlIHJlc3BlY3RpdmUgU2lnbmFsIHU4IGNvbXBvbmVudCBpcyBwYXNzZWQgdmlhIHRo
ZSB2YWwKKyAqCQkJcGFyYW1ldGVyLgorICogQGRldmljZV91MzJfd3JpdGUJRGV2aWNlIHUzMiBj
b21wb25lbnQgd3JpdGUgY2FsbGJhY2suIFRoZSB3cml0ZSB2YWx1ZSBvZgorICoJCQl0aGUgcmVz
cGVjdGl2ZSBEZXZpY2UgdTMyIGNvbXBvbmVudCBpcyBwYXNzZWQgdmlhIHRoZQorICoJCQl2YWwg
cGFyYW1ldGVyLgorICogQGNvdW50X3UzMl93cml0ZQlDb3VudCB1MzIgY29tcG9uZW50IHdyaXRl
IGNhbGxiYWNrLiBUaGUgd3JpdGUgdmFsdWUgb2YKKyAqCQkJdGhlIHJlc3BlY3RpdmUgQ291bnQg
dTMyIGNvbXBvbmVudCBpcyBwYXNzZWQgdmlhIHRoZSB2YWwKKyAqCQkJcGFyYW1ldGVyLgorICog
QHNpZ25hbF91MzJfd3JpdGUJU2lnbmFsIHUzMiBjb21wb25lbnQgd3JpdGUgY2FsbGJhY2suIFRo
ZSB3cml0ZSB2YWx1ZSBvZgorICoJCQl0aGUgcmVzcGVjdGl2ZSBTaWduYWwgdTMyIGNvbXBvbmVu
dCBpcyBwYXNzZWQgdmlhIHRoZQorICoJCQl2YWwgcGFyYW1ldGVyLgorICogQGRldmljZV91NjRf
d3JpdGUJRGV2aWNlIHU2NCBjb21wb25lbnQgd3JpdGUgY2FsbGJhY2suIFRoZSB3cml0ZSB2YWx1
ZSBvZgorICoJCQl0aGUgcmVzcGVjdGl2ZSBEZXZpY2UgdTY0IGNvbXBvbmVudCBpcyBwYXNzZWQg
dmlhIHRoZQorICoJCQl2YWwgcGFyYW1ldGVyLgorICogQGNvdW50X3U2NF93cml0ZQlDb3VudCB1
NjQgY29tcG9uZW50IHdyaXRlIGNhbGxiYWNrLiBUaGUgd3JpdGUgdmFsdWUgb2YKKyAqCQkJdGhl
IHJlc3BlY3RpdmUgQ291bnQgdTY0IGNvbXBvbmVudCBpcyBwYXNzZWQgdmlhIHRoZSB2YWwKKyAq
CQkJcGFyYW1ldGVyLgorICogQHNpZ25hbF91NjRfd3JpdGUJU2lnbmFsIHU2NCBjb21wb25lbnQg
d3JpdGUgY2FsbGJhY2suIFRoZSB3cml0ZSB2YWx1ZSBvZgorICoJCQl0aGUgcmVzcGVjdGl2ZSBT
aWduYWwgdTY0IGNvbXBvbmVudCBpcyBwYXNzZWQgdmlhIHRoZQorICoJCQl2YWwgcGFyYW1ldGVy
LgogICovCi1zdHJ1Y3QgY291bnRlcl9zaWduYWxfZXh0IHsKK3N0cnVjdCBjb3VudGVyX2NvbXAg
eworCWVudW0gY291bnRlcl9jb21wX3R5cGUgdHlwZTsKIAljb25zdCBjaGFyICpuYW1lOwotCXNz
aXplX3QgKCpyZWFkKShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCQlzdHJ1Y3Qg
Y291bnRlcl9zaWduYWwgKnNpZ25hbCwgdm9pZCAqcHJpdiwgY2hhciAqYnVmKTsKLQlzc2l6ZV90
ICgqd3JpdGUpKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCSBzdHJ1Y3QgY291
bnRlcl9zaWduYWwgKnNpZ25hbCwgdm9pZCAqcHJpdiwKLQkJCSBjb25zdCBjaGFyICpidWYsIHNp
emVfdCBsZW4pOwogCXZvaWQgKnByaXY7CisJdW5pb24geworCQlpbnQgKCphY3Rpb25fcmVhZCko
c3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCSAgIHN0cnVjdCBjb3VudGVyX2Nv
dW50ICpjb3VudCwKKwkJCQkgICBzdHJ1Y3QgY291bnRlcl9zeW5hcHNlICpzeW5hcHNlLAorCQkJ
CSAgIGVudW0gY291bnRlcl9zeW5hcHNlX2FjdGlvbiAqYWN0aW9uKTsKKwkJaW50ICgqZGV2aWNl
X3U4X3JlYWQpKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwgdTggKnZhbCk7CisJCWlu
dCAoKmNvdW50X3U4X3JlYWQpKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkg
ICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgdTggKnZhbCk7CisJCWludCAoKnNpZ25h
bF91OF9yZWFkKShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJICAgICAgc3Ry
dWN0IGNvdW50ZXJfc2lnbmFsICpzaWduYWwsIHU4ICp2YWwpOworCQlpbnQgKCpkZXZpY2VfdTMy
X3JlYWQpKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkgICAgICAgdTMyICp2
YWwpOworCQlpbnQgKCpjb3VudF91MzJfcmVhZCkoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3Vu
dGVyLAorCQkJCSAgICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgdTMyICp2YWwpOwor
CQlpbnQgKCpzaWduYWxfdTMyX3JlYWQpKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwK
KwkJCQkgICAgICAgc3RydWN0IGNvdW50ZXJfc2lnbmFsICpzaWduYWwsIHUzMiAqdmFsKTsKKwkJ
aW50ICgqZGV2aWNlX3U2NF9yZWFkKShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJ
CQkJICAgICAgIHU2NCAqdmFsKTsKKwkJaW50ICgqY291bnRfdTY0X3JlYWQpKHN0cnVjdCBjb3Vu
dGVyX2RldmljZSAqY291bnRlciwKKwkJCQkgICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291
bnQsIHU2NCAqdmFsKTsKKwkJaW50ICgqc2lnbmFsX3U2NF9yZWFkKShzdHJ1Y3QgY291bnRlcl9k
ZXZpY2UgKmNvdW50ZXIsCisJCQkJICAgICAgIHN0cnVjdCBjb3VudGVyX3NpZ25hbCAqc2lnbmFs
LCB1NjQgKnZhbCk7CisJfTsKKwl1bmlvbiB7CisJCWludCAoKmFjdGlvbl93cml0ZSkoc3RydWN0
IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCSAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAq
Y291bnQsCisJCQkJICAgIHN0cnVjdCBjb3VudGVyX3N5bmFwc2UgKnN5bmFwc2UsCisJCQkJICAg
IGVudW0gY291bnRlcl9zeW5hcHNlX2FjdGlvbiBhY3Rpb24pOworCQlpbnQgKCpkZXZpY2VfdThf
d3JpdGUpKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwgdTggdmFsKTsKKwkJaW50ICgq
Y291bnRfdThfd3JpdGUpKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkgICAg
ICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHU4IHZhbCk7CisJCWludCAoKnNpZ25hbF91
OF93cml0ZSkoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCSAgICAgICBzdHJ1
Y3QgY291bnRlcl9zaWduYWwgKnNpZ25hbCwgdTggdmFsKTsKKwkJaW50ICgqZGV2aWNlX3UzMl93
cml0ZSkoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCQl1MzIgdmFsKTsKKwkJ
aW50ICgqY291bnRfdTMyX3dyaXRlKShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJ
CQkJICAgICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgdTMyIHZhbCk7CisJCWludCAo
KnNpZ25hbF91MzJfd3JpdGUpKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkJ
c3RydWN0IGNvdW50ZXJfc2lnbmFsICpzaWduYWwsIHUzMiB2YWwpOworCQlpbnQgKCpkZXZpY2Vf
dTY0X3dyaXRlKShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJCXU2NCB2YWwp
OworCQlpbnQgKCpjb3VudF91NjRfd3JpdGUpKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRl
ciwKKwkJCQkgICAgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB1NjQgdmFsKTsKKwkJ
aW50ICgqc2lnbmFsX3U2NF93cml0ZSkoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAor
CQkJCQlzdHJ1Y3QgY291bnRlcl9zaWduYWwgKnNpZ25hbCwgdTY0IHZhbCk7CisJfTsKIH07CiAK
IC8qKgpAQCAtNTcsMTIyICsxOTksMjMgQEAgc3RydWN0IGNvdW50ZXJfc2lnbmFsIHsKIAlpbnQg
aWQ7CiAJY29uc3QgY2hhciAqbmFtZTsKIAotCWNvbnN0IHN0cnVjdCBjb3VudGVyX3NpZ25hbF9l
eHQgKmV4dDsKKwlzdHJ1Y3QgY291bnRlcl9jb21wICpleHQ7CiAJc2l6ZV90IG51bV9leHQ7Ci0K
LQl2b2lkICpwcml2OwotfTsKLQotLyoqCi0gKiBzdHJ1Y3QgY291bnRlcl9zaWduYWxfZW51bV9l
eHQgLSBTaWduYWwgZW51bSBleHRlbnNpb24gYXR0cmlidXRlCi0gKiBAaXRlbXM6CUFycmF5IG9m
IHN0cmluZ3MKLSAqIEBudW1faXRlbXM6CU51bWJlciBvZiBpdGVtcyBzcGVjaWZpZWQgaW4gQGl0
ZW1zCi0gKiBAc2V0OglTZXQgY2FsbGJhY2sgZnVuY3Rpb247IG1heSBiZSBOVUxMCi0gKiBAZ2V0
OglHZXQgY2FsbGJhY2sgZnVuY3Rpb247IG1heSBiZSBOVUxMCi0gKgotICogVGhlIGNvdW50ZXJf
c2lnbmFsX2VudW1fZXh0IHN0cnVjdHVyZSBjYW4gYmUgdXNlZCB0byBpbXBsZW1lbnQgZW51bSBz
dHlsZQotICogU2lnbmFsIGV4dGVuc2lvbiBhdHRyaWJ1dGVzLiBFbnVtIHN0eWxlIGF0dHJpYnV0
ZXMgYXJlIHRob3NlIHdoaWNoIGhhdmUgYSBzZXQKLSAqIG9mIHN0cmluZ3MgdGhhdCBtYXAgdG8g
dW5zaWduZWQgaW50ZWdlciB2YWx1ZXMuIFRoZSBHZW5lcmljIENvdW50ZXIgU2lnbmFsCi0gKiBl
bnVtIGV4dGVuc2lvbiBoZWxwZXIgY29kZSB0YWtlcyBjYXJlIG9mIG1hcHBpbmcgYmV0d2VlbiB2
YWx1ZSBhbmQgc3RyaW5nLCBhcwotICogd2VsbCBhcyBnZW5lcmF0aW5nIGEgIl9hdmFpbGFibGUi
IGZpbGUgd2hpY2ggY29udGFpbnMgYSBsaXN0IG9mIGFsbCBhdmFpbGFibGUKLSAqIGl0ZW1zLiBU
aGUgZ2V0IGNhbGxiYWNrIGlzIHVzZWQgdG8gcXVlcnkgdGhlIGN1cnJlbnRseSBhY3RpdmUgaXRl
bTsgdGhlIGluZGV4Ci0gKiBvZiB0aGUgaXRlbSB3aXRoaW4gdGhlIHJlc3BlY3RpdmUgaXRlbXMg
YXJyYXkgaXMgcmV0dXJuZWQgdmlhIHRoZSAnaXRlbScKLSAqIHBhcmFtZXRlci4gVGhlIHNldCBj
YWxsYmFjayBpcyBjYWxsZWQgd2hlbiB0aGUgYXR0cmlidXRlIGlzIHVwZGF0ZWQ7IHRoZQotICog
J2l0ZW0nIHBhcmFtZXRlciBjb250YWlucyB0aGUgaW5kZXggb2YgdGhlIG5ld2x5IGFjdGl2YXRl
ZCBpdGVtIHdpdGhpbiB0aGUKLSAqIHJlc3BlY3RpdmUgaXRlbXMgYXJyYXkuCi0gKi8KLXN0cnVj
dCBjb3VudGVyX3NpZ25hbF9lbnVtX2V4dCB7Ci0JY29uc3QgY2hhciAqIGNvbnN0ICppdGVtczsK
LQlzaXplX3QgbnVtX2l0ZW1zOwotCWludCAoKmdldCkoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpj
b3VudGVyLAotCQkgICBzdHJ1Y3QgY291bnRlcl9zaWduYWwgKnNpZ25hbCwgc2l6ZV90ICppdGVt
KTsKLQlpbnQgKCpzZXQpKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJICAgc3Ry
dWN0IGNvdW50ZXJfc2lnbmFsICpzaWduYWwsIHNpemVfdCBpdGVtKTsKLX07Ci0KLS8qKgotICog
Q09VTlRFUl9TSUdOQUxfRU5VTSgpIC0gSW5pdGlhbGl6ZSBTaWduYWwgZW51bSBleHRlbnNpb24K
LSAqIEBfbmFtZToJQXR0cmlidXRlIG5hbWUKLSAqIEBfZToJCVBvaW50ZXIgdG8gYSBjb3VudGVy
X3NpZ25hbF9lbnVtX2V4dCBzdHJ1Y3R1cmUKLSAqCi0gKiBUaGlzIHNob3VsZCB1c3VhbGx5IGJl
IHVzZWQgdG9nZXRoZXIgd2l0aCBDT1VOVEVSX1NJR05BTF9FTlVNX0FWQUlMQUJMRSgpCi0gKi8K
LSNkZWZpbmUgQ09VTlRFUl9TSUdOQUxfRU5VTShfbmFtZSwgX2UpIFwKLXsgXAotCS5uYW1lID0g
KF9uYW1lKSwgXAotCS5yZWFkID0gY291bnRlcl9zaWduYWxfZW51bV9yZWFkLCBcCi0JLndyaXRl
ID0gY291bnRlcl9zaWduYWxfZW51bV93cml0ZSwgXAotCS5wcml2ID0gKF9lKSBcCi19Ci0KLS8q
KgotICogQ09VTlRFUl9TSUdOQUxfRU5VTV9BVkFJTEFCTEUoKSAtIEluaXRpYWxpemUgU2lnbmFs
IGVudW0gYXZhaWxhYmxlIGV4dGVuc2lvbgotICogQF9uYW1lOglBdHRyaWJ1dGUgbmFtZSAoIl9h
dmFpbGFibGUiIHdpbGwgYmUgYXBwZW5kZWQgdG8gdGhlIG5hbWUpCi0gKiBAX2U6CQlQb2ludGVy
IHRvIGEgY291bnRlcl9zaWduYWxfZW51bV9leHQgc3RydWN0dXJlCi0gKgotICogQ3JlYXRlcyBh
IHJlYWQgb25seSBhdHRyaWJ1dGUgdGhhdCBsaXN0cyBhbGwgdGhlIGF2YWlsYWJsZSBlbnVtIGl0
ZW1zIGluIGEKLSAqIG5ld2xpbmUgc2VwYXJhdGVkIGxpc3QuIFRoaXMgc2hvdWxkIHVzdWFsbHkg
YmUgdXNlZCB0b2dldGhlciB3aXRoCi0gKiBDT1VOVEVSX1NJR05BTF9FTlVNKCkKLSAqLwotI2Rl
ZmluZSBDT1VOVEVSX1NJR05BTF9FTlVNX0FWQUlMQUJMRShfbmFtZSwgX2UpIFwKLXsgXAotCS5u
YW1lID0gKF9uYW1lICJfYXZhaWxhYmxlIiksIFwKLQkucmVhZCA9IGNvdW50ZXJfc2lnbmFsX2Vu
dW1fYXZhaWxhYmxlX3JlYWQsIFwKLQkucHJpdiA9IChfZSkgXAotfQotCi1lbnVtIGNvdW50ZXJf
c3luYXBzZV9hY3Rpb24gewotCUNPVU5URVJfU1lOQVBTRV9BQ1RJT05fTk9ORSA9IDAsCi0JQ09V
TlRFUl9TWU5BUFNFX0FDVElPTl9SSVNJTkdfRURHRSwKLQlDT1VOVEVSX1NZTkFQU0VfQUNUSU9O
X0ZBTExJTkdfRURHRSwKLQlDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX0JPVEhfRURHRVMKIH07CiAK
IC8qKgogICogc3RydWN0IGNvdW50ZXJfc3luYXBzZSAtIENvdW50ZXIgU3luYXBzZSBub2RlCi0g
KiBAYWN0aW9uOgkJaW5kZXggb2YgY3VycmVudCBhY3Rpb24gbW9kZQogICogQGFjdGlvbnNfbGlz
dDoJYXJyYXkgb2YgYXZhaWxhYmxlIGFjdGlvbiBtb2RlcwogICogQG51bV9hY3Rpb25zOgludW1i
ZXIgb2YgYWN0aW9uIG1vZGVzIHNwZWNpZmllZCBpbiBAYWN0aW9uc19saXN0CiAgKiBAc2lnbmFs
OgkJcG9pbnRlciB0byBhc3NvY2lhdGVkIHNpZ25hbAogICovCiBzdHJ1Y3QgY291bnRlcl9zeW5h
cHNlIHsKLQlzaXplX3QgYWN0aW9uOwogCWNvbnN0IGVudW0gY291bnRlcl9zeW5hcHNlX2FjdGlv
biAqYWN0aW9uc19saXN0OwogCXNpemVfdCBudW1fYWN0aW9uczsKIAogCXN0cnVjdCBjb3VudGVy
X3NpZ25hbCAqc2lnbmFsOwogfTsKIAotc3RydWN0IGNvdW50ZXJfY291bnQ7Ci0KLS8qKgotICog
c3RydWN0IGNvdW50ZXJfY291bnRfZXh0IC0gQ291bnRlciBDb3VudCBleHRlbnNpb24KLSAqIEBu
YW1lOglhdHRyaWJ1dGUgbmFtZQotICogQHJlYWQ6CXJlYWQgY2FsbGJhY2sgZm9yIHRoaXMgYXR0
cmlidXRlOyBtYXkgYmUgTlVMTAotICogQHdyaXRlOgl3cml0ZSBjYWxsYmFjayBmb3IgdGhpcyBh
dHRyaWJ1dGU7IG1heSBiZSBOVUxMCi0gKiBAcHJpdjoJZGF0YSBwcml2YXRlIHRvIHRoZSBkcml2
ZXIKLSAqLwotc3RydWN0IGNvdW50ZXJfY291bnRfZXh0IHsKLQljb25zdCBjaGFyICpuYW1lOwot
CXNzaXplX3QgKCpyZWFkKShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCQlzdHJ1
Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHZvaWQgKnByaXYsIGNoYXIgKmJ1Zik7Ci0Jc3NpemVf
dCAoKndyaXRlKShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkgc3RydWN0IGNv
dW50ZXJfY291bnQgKmNvdW50LCB2b2lkICpwcml2LAotCQkJIGNvbnN0IGNoYXIgKmJ1Ziwgc2l6
ZV90IGxlbik7Ci0Jdm9pZCAqcHJpdjsKLX07Ci0KLWVudW0gY291bnRlcl9mdW5jdGlvbiB7Ci0J
Q09VTlRFUl9GVU5DVElPTl9JTkNSRUFTRSA9IDAsCi0JQ09VTlRFUl9GVU5DVElPTl9ERUNSRUFT
RSwKLQlDT1VOVEVSX0ZVTkNUSU9OX1BVTFNFX0RJUkVDVElPTiwKLQlDT1VOVEVSX0ZVTkNUSU9O
X1FVQURSQVRVUkVfWDFfQSwKLQlDT1VOVEVSX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDFfQiwKLQlD
T1VOVEVSX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDJfQSwKLQlDT1VOVEVSX0ZVTkNUSU9OX1FVQURS
QVRVUkVfWDJfQiwKLQlDT1VOVEVSX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDQKLX07Ci0KIC8qKgog
ICogc3RydWN0IGNvdW50ZXJfY291bnQgLSBDb3VudGVyIENvdW50IG5vZGUKICAqIEBpZDoJCQl1
bmlxdWUgSUQgdXNlZCB0byBpZGVudGlmeSBDb3VudApAQCAtMTkxLDEwOCArMjM0LDE0IEBAIHN0
cnVjdCBjb3VudGVyX2NvdW50IHsKIAlpbnQgaWQ7CiAJY29uc3QgY2hhciAqbmFtZTsKIAotCXNp
emVfdCBmdW5jdGlvbjsKIAljb25zdCBlbnVtIGNvdW50ZXJfZnVuY3Rpb24gKmZ1bmN0aW9uc19s
aXN0OwogCXNpemVfdCBudW1fZnVuY3Rpb25zOwogCiAJc3RydWN0IGNvdW50ZXJfc3luYXBzZSAq
c3luYXBzZXM7CiAJc2l6ZV90IG51bV9zeW5hcHNlczsKIAotCWNvbnN0IHN0cnVjdCBjb3VudGVy
X2NvdW50X2V4dCAqZXh0OworCXN0cnVjdCBjb3VudGVyX2NvbXAgKmV4dDsKIAlzaXplX3QgbnVt
X2V4dDsKLQotCXZvaWQgKnByaXY7Ci19OwotCi0vKioKLSAqIHN0cnVjdCBjb3VudGVyX2NvdW50
X2VudW1fZXh0IC0gQ291bnQgZW51bSBleHRlbnNpb24gYXR0cmlidXRlCi0gKiBAaXRlbXM6CUFy
cmF5IG9mIHN0cmluZ3MKLSAqIEBudW1faXRlbXM6CU51bWJlciBvZiBpdGVtcyBzcGVjaWZpZWQg
aW4gQGl0ZW1zCi0gKiBAc2V0OglTZXQgY2FsbGJhY2sgZnVuY3Rpb247IG1heSBiZSBOVUxMCi0g
KiBAZ2V0OglHZXQgY2FsbGJhY2sgZnVuY3Rpb247IG1heSBiZSBOVUxMCi0gKgotICogVGhlIGNv
dW50ZXJfY291bnRfZW51bV9leHQgc3RydWN0dXJlIGNhbiBiZSB1c2VkIHRvIGltcGxlbWVudCBl
bnVtIHN0eWxlCi0gKiBDb3VudCBleHRlbnNpb24gYXR0cmlidXRlcy4gRW51bSBzdHlsZSBhdHRy
aWJ1dGVzIGFyZSB0aG9zZSB3aGljaCBoYXZlIGEgc2V0Ci0gKiBvZiBzdHJpbmdzIHRoYXQgbWFw
IHRvIHVuc2lnbmVkIGludGVnZXIgdmFsdWVzLiBUaGUgR2VuZXJpYyBDb3VudGVyIENvdW50Ci0g
KiBlbnVtIGV4dGVuc2lvbiBoZWxwZXIgY29kZSB0YWtlcyBjYXJlIG9mIG1hcHBpbmcgYmV0d2Vl
biB2YWx1ZSBhbmQgc3RyaW5nLCBhcwotICogd2VsbCBhcyBnZW5lcmF0aW5nIGEgIl9hdmFpbGFi
bGUiIGZpbGUgd2hpY2ggY29udGFpbnMgYSBsaXN0IG9mIGFsbCBhdmFpbGFibGUKLSAqIGl0ZW1z
LiBUaGUgZ2V0IGNhbGxiYWNrIGlzIHVzZWQgdG8gcXVlcnkgdGhlIGN1cnJlbnRseSBhY3RpdmUg
aXRlbTsgdGhlIGluZGV4Ci0gKiBvZiB0aGUgaXRlbSB3aXRoaW4gdGhlIHJlc3BlY3RpdmUgaXRl
bXMgYXJyYXkgaXMgcmV0dXJuZWQgdmlhIHRoZSAnaXRlbScKLSAqIHBhcmFtZXRlci4gVGhlIHNl
dCBjYWxsYmFjayBpcyBjYWxsZWQgd2hlbiB0aGUgYXR0cmlidXRlIGlzIHVwZGF0ZWQ7IHRoZQot
ICogJ2l0ZW0nIHBhcmFtZXRlciBjb250YWlucyB0aGUgaW5kZXggb2YgdGhlIG5ld2x5IGFjdGl2
YXRlZCBpdGVtIHdpdGhpbiB0aGUKLSAqIHJlc3BlY3RpdmUgaXRlbXMgYXJyYXkuCi0gKi8KLXN0
cnVjdCBjb3VudGVyX2NvdW50X2VudW1fZXh0IHsKLQljb25zdCBjaGFyICogY29uc3QgKml0ZW1z
OwotCXNpemVfdCBudW1faXRlbXM7Ci0JaW50ICgqZ2V0KShzdHJ1Y3QgY291bnRlcl9kZXZpY2Ug
KmNvdW50ZXIsIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKLQkJICAgc2l6ZV90ICppdGVt
KTsKLQlpbnQgKCpzZXQpKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwgc3RydWN0IGNv
dW50ZXJfY291bnQgKmNvdW50LAotCQkgICBzaXplX3QgaXRlbSk7Ci19OwotCi0vKioKLSAqIENP
VU5URVJfQ09VTlRfRU5VTSgpIC0gSW5pdGlhbGl6ZSBDb3VudCBlbnVtIGV4dGVuc2lvbgotICog
QF9uYW1lOglBdHRyaWJ1dGUgbmFtZQotICogQF9lOgkJUG9pbnRlciB0byBhIGNvdW50ZXJfY291
bnRfZW51bV9leHQgc3RydWN0dXJlCi0gKgotICogVGhpcyBzaG91bGQgdXN1YWxseSBiZSB1c2Vk
IHRvZ2V0aGVyIHdpdGggQ09VTlRFUl9DT1VOVF9FTlVNX0FWQUlMQUJMRSgpCi0gKi8KLSNkZWZp
bmUgQ09VTlRFUl9DT1VOVF9FTlVNKF9uYW1lLCBfZSkgXAoteyBcCi0JLm5hbWUgPSAoX25hbWUp
LCBcCi0JLnJlYWQgPSBjb3VudGVyX2NvdW50X2VudW1fcmVhZCwgXAotCS53cml0ZSA9IGNvdW50
ZXJfY291bnRfZW51bV93cml0ZSwgXAotCS5wcml2ID0gKF9lKSBcCi19Ci0KLS8qKgotICogQ09V
TlRFUl9DT1VOVF9FTlVNX0FWQUlMQUJMRSgpIC0gSW5pdGlhbGl6ZSBDb3VudCBlbnVtIGF2YWls
YWJsZSBleHRlbnNpb24KLSAqIEBfbmFtZToJQXR0cmlidXRlIG5hbWUgKCJfYXZhaWxhYmxlIiB3
aWxsIGJlIGFwcGVuZGVkIHRvIHRoZSBuYW1lKQotICogQF9lOgkJUG9pbnRlciB0byBhIGNvdW50
ZXJfY291bnRfZW51bV9leHQgc3RydWN0dXJlCi0gKgotICogQ3JlYXRlcyBhIHJlYWQgb25seSBh
dHRyaWJ1dGUgdGhhdCBsaXN0cyBhbGwgdGhlIGF2YWlsYWJsZSBlbnVtIGl0ZW1zIGluIGEKLSAq
IG5ld2xpbmUgc2VwYXJhdGVkIGxpc3QuIFRoaXMgc2hvdWxkIHVzdWFsbHkgYmUgdXNlZCB0b2dl
dGhlciB3aXRoCi0gKiBDT1VOVEVSX0NPVU5UX0VOVU0oKQotICovCi0jZGVmaW5lIENPVU5URVJf
Q09VTlRfRU5VTV9BVkFJTEFCTEUoX25hbWUsIF9lKSBcCi17IFwKLQkubmFtZSA9IChfbmFtZSAi
X2F2YWlsYWJsZSIpLCBcCi0JLnJlYWQgPSBjb3VudGVyX2NvdW50X2VudW1fYXZhaWxhYmxlX3Jl
YWQsIFwKLQkucHJpdiA9IChfZSkgXAotfQotCi0vKioKLSAqIHN0cnVjdCBjb3VudGVyX2Rldmlj
ZV9hdHRyX2dyb3VwIC0gaW50ZXJuYWwgY29udGFpbmVyIGZvciBhdHRyaWJ1dGUgZ3JvdXAKLSAq
IEBhdHRyX2dyb3VwOglDb3VudGVyIHN5c2ZzIGF0dHJpYnV0ZXMgZ3JvdXAKLSAqIEBhdHRyX2xp
c3Q6CWxpc3QgdG8ga2VlcCB0cmFjayBvZiBjcmVhdGVkIENvdW50ZXIgc3lzZnMgYXR0cmlidXRl
cwotICogQG51bV9hdHRyOgludW1iZXIgb2YgQ291bnRlciBzeXNmcyBhdHRyaWJ1dGVzCi0gKi8K
LXN0cnVjdCBjb3VudGVyX2RldmljZV9hdHRyX2dyb3VwIHsKLQlzdHJ1Y3QgYXR0cmlidXRlX2dy
b3VwIGF0dHJfZ3JvdXA7Ci0Jc3RydWN0IGxpc3RfaGVhZCBhdHRyX2xpc3Q7Ci0Jc2l6ZV90IG51
bV9hdHRyOwotfTsKLQotLyoqCi0gKiBzdHJ1Y3QgY291bnRlcl9kZXZpY2Vfc3RhdGUgLSBpbnRl
cm5hbCBzdGF0ZSBjb250YWluZXIgZm9yIGEgQ291bnRlciBkZXZpY2UKLSAqIEBpZDoJCQl1bmlx
dWUgSUQgdXNlZCB0byBpZGVudGlmeSB0aGUgQ291bnRlcgotICogQGRldjoJCWludGVybmFsIGRl
dmljZSBzdHJ1Y3R1cmUKLSAqIEBncm91cHNfbGlzdDoJYXR0cmlidXRlIGdyb3VwcyBsaXN0IChm
b3IgU2lnbmFscywgQ291bnRzLCBhbmQgZXh0KQotICogQG51bV9ncm91cHM6CQludW1iZXIgb2Yg
YXR0cmlidXRlIGdyb3VwcyBjb250YWluZXJzCi0gKiBAZ3JvdXBzOgkJQ291bnRlciBzeXNmcyBh
dHRyaWJ1dGUgZ3JvdXBzICh0byBwb3B1bGF0ZSBAZGV2Lmdyb3VwcykKLSAqLwotc3RydWN0IGNv
dW50ZXJfZGV2aWNlX3N0YXRlIHsKLQlpbnQgaWQ7Ci0Jc3RydWN0IGRldmljZSBkZXY7Ci0Jc3Ry
dWN0IGNvdW50ZXJfZGV2aWNlX2F0dHJfZ3JvdXAgKmdyb3Vwc19saXN0OwotCXNpemVfdCBudW1f
Z3JvdXBzOwotCWNvbnN0IHN0cnVjdCBhdHRyaWJ1dGVfZ3JvdXAgKipncm91cHM7Ci19OwotCi1l
bnVtIGNvdW50ZXJfc2lnbmFsX2xldmVsIHsKLQlDT1VOVEVSX1NJR05BTF9MRVZFTF9MT1csCi0J
Q09VTlRFUl9TSUdOQUxfTEVWRUxfSElHSCwKIH07CiAKIC8qKgpAQCAtMzI2LDk3ICsyNzUsMjkg
QEAgc3RydWN0IGNvdW50ZXJfb3BzIHsKIAkJCSAgIHN0cnVjdCBjb3VudGVyX3NpZ25hbCAqc2ln
bmFsLAogCQkJICAgZW51bSBjb3VudGVyX3NpZ25hbF9sZXZlbCAqbGV2ZWwpOwogCWludCAoKmNv
dW50X3JlYWQpKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCSAgc3RydWN0IGNv
dW50ZXJfY291bnQgKmNvdW50LCB1bnNpZ25lZCBsb25nICp2YWwpOworCQkJICBzdHJ1Y3QgY291
bnRlcl9jb3VudCAqY291bnQsIHU2NCAqdmFsdWUpOwogCWludCAoKmNvdW50X3dyaXRlKShzdHJ1
Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAq
Y291bnQsIHVuc2lnbmVkIGxvbmcgdmFsKTsKLQlpbnQgKCpmdW5jdGlvbl9nZXQpKHN0cnVjdCBj
b3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCSAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291
bnQsIHNpemVfdCAqZnVuY3Rpb24pOwotCWludCAoKmZ1bmN0aW9uX3NldCkoc3RydWN0IGNvdW50
ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwg
c2l6ZV90IGZ1bmN0aW9uKTsKLQlpbnQgKCphY3Rpb25fZ2V0KShzdHJ1Y3QgY291bnRlcl9kZXZp
Y2UgKmNvdW50ZXIsCi0JCQkgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKLQkJCSAgc3Ry
dWN0IGNvdW50ZXJfc3luYXBzZSAqc3luYXBzZSwgc2l6ZV90ICphY3Rpb24pOwotCWludCAoKmFj
dGlvbl9zZXQpKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCSAgc3RydWN0IGNv
dW50ZXJfY291bnQgKmNvdW50LAotCQkJICBzdHJ1Y3QgY291bnRlcl9zeW5hcHNlICpzeW5hcHNl
LCBzaXplX3QgYWN0aW9uKTsKLX07Ci0KLS8qKgotICogc3RydWN0IGNvdW50ZXJfZGV2aWNlX2V4
dCAtIENvdW50ZXIgZGV2aWNlIGV4dGVuc2lvbgotICogQG5hbWU6CWF0dHJpYnV0ZSBuYW1lCi0g
KiBAcmVhZDoJcmVhZCBjYWxsYmFjayBmb3IgdGhpcyBhdHRyaWJ1dGU7IG1heSBiZSBOVUxMCi0g
KiBAd3JpdGU6CXdyaXRlIGNhbGxiYWNrIGZvciB0aGlzIGF0dHJpYnV0ZTsgbWF5IGJlIE5VTEwK
LSAqIEBwcml2OglkYXRhIHByaXZhdGUgdG8gdGhlIGRyaXZlcgotICovCi1zdHJ1Y3QgY291bnRl
cl9kZXZpY2VfZXh0IHsKLQljb25zdCBjaGFyICpuYW1lOwotCXNzaXplX3QgKCpyZWFkKShzdHJ1
Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsIHZvaWQgKnByaXYsIGNoYXIgKmJ1Zik7Ci0Jc3Np
emVfdCAoKndyaXRlKShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsIHZvaWQgKnByaXYs
Ci0JCQkgY29uc3QgY2hhciAqYnVmLCBzaXplX3QgbGVuKTsKLQl2b2lkICpwcml2OwotfTsKLQot
LyoqCi0gKiBzdHJ1Y3QgY291bnRlcl9kZXZpY2VfZW51bV9leHQgLSBDb3VudGVyIGVudW0gZXh0
ZW5zaW9uIGF0dHJpYnV0ZQotICogQGl0ZW1zOglBcnJheSBvZiBzdHJpbmdzCi0gKiBAbnVtX2l0
ZW1zOglOdW1iZXIgb2YgaXRlbXMgc3BlY2lmaWVkIGluIEBpdGVtcwotICogQHNldDoJU2V0IGNh
bGxiYWNrIGZ1bmN0aW9uOyBtYXkgYmUgTlVMTAotICogQGdldDoJR2V0IGNhbGxiYWNrIGZ1bmN0
aW9uOyBtYXkgYmUgTlVMTAotICoKLSAqIFRoZSBjb3VudGVyX2RldmljZV9lbnVtX2V4dCBzdHJ1
Y3R1cmUgY2FuIGJlIHVzZWQgdG8gaW1wbGVtZW50IGVudW0gc3R5bGUKLSAqIENvdW50ZXIgZXh0
ZW5zaW9uIGF0dHJpYnV0ZXMuIEVudW0gc3R5bGUgYXR0cmlidXRlcyBhcmUgdGhvc2Ugd2hpY2gg
aGF2ZSBhCi0gKiBzZXQgb2Ygc3RyaW5ncyB0aGF0IG1hcCB0byB1bnNpZ25lZCBpbnRlZ2VyIHZh
bHVlcy4gVGhlIEdlbmVyaWMgQ291bnRlciBlbnVtCi0gKiBleHRlbnNpb24gaGVscGVyIGNvZGUg
dGFrZXMgY2FyZSBvZiBtYXBwaW5nIGJldHdlZW4gdmFsdWUgYW5kIHN0cmluZywgYXMgd2VsbAot
ICogYXMgZ2VuZXJhdGluZyBhICJfYXZhaWxhYmxlIiBmaWxlIHdoaWNoIGNvbnRhaW5zIGEgbGlz
dCBvZiBhbGwgYXZhaWxhYmxlCi0gKiBpdGVtcy4gVGhlIGdldCBjYWxsYmFjayBpcyB1c2VkIHRv
IHF1ZXJ5IHRoZSBjdXJyZW50bHkgYWN0aXZlIGl0ZW07IHRoZSBpbmRleAotICogb2YgdGhlIGl0
ZW0gd2l0aGluIHRoZSByZXNwZWN0aXZlIGl0ZW1zIGFycmF5IGlzIHJldHVybmVkIHZpYSB0aGUg
J2l0ZW0nCi0gKiBwYXJhbWV0ZXIuIFRoZSBzZXQgY2FsbGJhY2sgaXMgY2FsbGVkIHdoZW4gdGhl
IGF0dHJpYnV0ZSBpcyB1cGRhdGVkOyB0aGUKLSAqICdpdGVtJyBwYXJhbWV0ZXIgY29udGFpbnMg
dGhlIGluZGV4IG9mIHRoZSBuZXdseSBhY3RpdmF0ZWQgaXRlbSB3aXRoaW4gdGhlCi0gKiByZXNw
ZWN0aXZlIGl0ZW1zIGFycmF5LgotICovCi1zdHJ1Y3QgY291bnRlcl9kZXZpY2VfZW51bV9leHQg
ewotCWNvbnN0IGNoYXIgKiBjb25zdCAqaXRlbXM7Ci0Jc2l6ZV90IG51bV9pdGVtczsKLQlpbnQg
KCpnZXQpKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwgc2l6ZV90ICppdGVtKTsKLQlp
bnQgKCpzZXQpKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwgc2l6ZV90IGl0ZW0pOwor
CQkJICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB1NjQgdmFsdWUpOworCWludCAoKmZ1
bmN0aW9uX3JlYWQpKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCSAgICAgc3Ry
dWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAorCQkJICAgICBlbnVtIGNvdW50ZXJfZnVuY3Rpb24g
KmZ1bmN0aW9uKTsKKwlpbnQgKCpmdW5jdGlvbl93cml0ZSkoc3RydWN0IGNvdW50ZXJfZGV2aWNl
ICpjb3VudGVyLAorCQkJICAgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAorCQkJICAg
ICAgZW51bSBjb3VudGVyX2Z1bmN0aW9uIGZ1bmN0aW9uKTsKKwlpbnQgKCphY3Rpb25fcmVhZCko
c3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJICAgc3RydWN0IGNvdW50ZXJfY291
bnQgKmNvdW50LAorCQkJICAgc3RydWN0IGNvdW50ZXJfc3luYXBzZSAqc3luYXBzZSwKKwkJCSAg
IGVudW0gY291bnRlcl9zeW5hcHNlX2FjdGlvbiAqYWN0aW9uKTsKKwlpbnQgKCphY3Rpb25fd3Jp
dGUpKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCSAgICBzdHJ1Y3QgY291bnRl
cl9jb3VudCAqY291bnQsCisJCQkgICAgc3RydWN0IGNvdW50ZXJfc3luYXBzZSAqc3luYXBzZSwK
KwkJCSAgICBlbnVtIGNvdW50ZXJfc3luYXBzZV9hY3Rpb24gYWN0aW9uKTsKIH07CiAKLS8qKgot
ICogQ09VTlRFUl9ERVZJQ0VfRU5VTSgpIC0gSW5pdGlhbGl6ZSBDb3VudGVyIGVudW0gZXh0ZW5z
aW9uCi0gKiBAX25hbWU6CUF0dHJpYnV0ZSBuYW1lCi0gKiBAX2U6CQlQb2ludGVyIHRvIGEgY291
bnRlcl9kZXZpY2VfZW51bV9leHQgc3RydWN0dXJlCi0gKgotICogVGhpcyBzaG91bGQgdXN1YWxs
eSBiZSB1c2VkIHRvZ2V0aGVyIHdpdGggQ09VTlRFUl9ERVZJQ0VfRU5VTV9BVkFJTEFCTEUoKQot
ICovCi0jZGVmaW5lIENPVU5URVJfREVWSUNFX0VOVU0oX25hbWUsIF9lKSBcCi17IFwKLQkubmFt
ZSA9IChfbmFtZSksIFwKLQkucmVhZCA9IGNvdW50ZXJfZGV2aWNlX2VudW1fcmVhZCwgXAotCS53
cml0ZSA9IGNvdW50ZXJfZGV2aWNlX2VudW1fd3JpdGUsIFwKLQkucHJpdiA9IChfZSkgXAotfQot
Ci0vKioKLSAqIENPVU5URVJfREVWSUNFX0VOVU1fQVZBSUxBQkxFKCkgLSBJbml0aWFsaXplIENv
dW50ZXIgZW51bSBhdmFpbGFibGUgZXh0ZW5zaW9uCi0gKiBAX25hbWU6CUF0dHJpYnV0ZSBuYW1l
ICgiX2F2YWlsYWJsZSIgd2lsbCBiZSBhcHBlbmRlZCB0byB0aGUgbmFtZSkKLSAqIEBfZToJCVBv
aW50ZXIgdG8gYSBjb3VudGVyX2RldmljZV9lbnVtX2V4dCBzdHJ1Y3R1cmUKLSAqCi0gKiBDcmVh
dGVzIGEgcmVhZCBvbmx5IGF0dHJpYnV0ZSB0aGF0IGxpc3RzIGFsbCB0aGUgYXZhaWxhYmxlIGVu
dW0gaXRlbXMgaW4gYQotICogbmV3bGluZSBzZXBhcmF0ZWQgbGlzdC4gVGhpcyBzaG91bGQgdXN1
YWxseSBiZSB1c2VkIHRvZ2V0aGVyIHdpdGgKLSAqIENPVU5URVJfREVWSUNFX0VOVU0oKQotICov
Ci0jZGVmaW5lIENPVU5URVJfREVWSUNFX0VOVU1fQVZBSUxBQkxFKF9uYW1lLCBfZSkgXAoteyBc
Ci0JLm5hbWUgPSAoX25hbWUgIl9hdmFpbGFibGUiKSwgXAotCS5yZWFkID0gY291bnRlcl9kZXZp
Y2VfZW51bV9hdmFpbGFibGVfcmVhZCwgXAotCS5wcml2ID0gKF9lKSBcCi19Ci0KIC8qKgogICog
c3RydWN0IGNvdW50ZXJfZGV2aWNlIC0gQ291bnRlciBkYXRhIHN0cnVjdHVyZQogICogQG5hbWU6
CQluYW1lIG9mIHRoZSBkZXZpY2UgYXMgaXQgYXBwZWFycyBpbiB0aGUgZGF0YXNoZWV0CiAgKiBA
cGFyZW50OgkJb3B0aW9uYWwgcGFyZW50IGRldmljZSBwcm92aWRpbmcgdGhlIGNvdW50ZXJzCi0g
KiBAZGV2aWNlX3N0YXRlOglpbnRlcm5hbCBkZXZpY2Ugc3RhdGUgY29udGFpbmVyCiAgKiBAb3Bz
OgkJY2FsbGJhY2tzIGZyb20gZHJpdmVyCiAgKiBAc2lnbmFsczoJCWFycmF5IG9mIFNpZ25hbHMK
ICAqIEBudW1fc2lnbmFsczoJbnVtYmVyIG9mIFNpZ25hbHMgc3BlY2lmaWVkIGluIEBzaWduYWxz
CkBAIC00MjUsMTEgKzMwNiwxMSBAQCBzdHJ1Y3QgY291bnRlcl9kZXZpY2VfZW51bV9leHQgewog
ICogQGV4dDoJCW9wdGlvbmFsIGFycmF5IG9mIENvdW50ZXIgZGV2aWNlIGV4dGVuc2lvbnMKICAq
IEBudW1fZXh0OgkJbnVtYmVyIG9mIENvdW50ZXIgZGV2aWNlIGV4dGVuc2lvbnMgc3BlY2lmaWVk
IGluIEBleHQKICAqIEBwcml2OgkJb3B0aW9uYWwgcHJpdmF0ZSBkYXRhIHN1cHBsaWVkIGJ5IGRy
aXZlcgorICogQGRldjoJCWludGVybmFsIGRldmljZSBzdHJ1Y3R1cmUKICAqLwogc3RydWN0IGNv
dW50ZXJfZGV2aWNlIHsKIAljb25zdCBjaGFyICpuYW1lOwogCXN0cnVjdCBkZXZpY2UgKnBhcmVu
dDsKLQlzdHJ1Y3QgY291bnRlcl9kZXZpY2Vfc3RhdGUgKmRldmljZV9zdGF0ZTsKIAogCWNvbnN0
IHN0cnVjdCBjb3VudGVyX29wcyAqb3BzOwogCkBAIC00MzgsMTcgKzMxOSwxNTkgQEAgc3RydWN0
IGNvdW50ZXJfZGV2aWNlIHsKIAlzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnRzOwogCXNpemVf
dCBudW1fY291bnRzOwogCi0JY29uc3Qgc3RydWN0IGNvdW50ZXJfZGV2aWNlX2V4dCAqZXh0Owor
CXN0cnVjdCBjb3VudGVyX2NvbXAgKmV4dDsKIAlzaXplX3QgbnVtX2V4dDsKIAogCXZvaWQgKnBy
aXY7CisKKwlzdHJ1Y3QgZGV2aWNlIGRldjsKIH07CiAKIGludCBjb3VudGVyX3JlZ2lzdGVyKHN0
cnVjdCBjb3VudGVyX2RldmljZSAqY29uc3QgY291bnRlcik7CiB2b2lkIGNvdW50ZXJfdW5yZWdp
c3RlcihzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvbnN0IGNvdW50ZXIpOwogaW50IGRldm1fY291
bnRlcl9yZWdpc3RlcihzdHJ1Y3QgZGV2aWNlICpkZXYsCiAJCQkgIHN0cnVjdCBjb3VudGVyX2Rl
dmljZSAqY29uc3QgY291bnRlcik7Ci12b2lkIGRldm1fY291bnRlcl91bnJlZ2lzdGVyKHN0cnVj
dCBkZXZpY2UgKmRldiwKLQkJCSAgICAgc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb25zdCBjb3Vu
dGVyKTsKKworI2RlZmluZSBDT1VOVEVSX0NPTVBfREVWSUNFX1U4KF9uYW1lLCBfcmVhZCwgX3dy
aXRlKSBcCit7IFwKKwkudHlwZSA9IENPVU5URVJfQ09NUF9VOCwgXAorCS5uYW1lID0gKF9uYW1l
KSwgXAorCS5kZXZpY2VfdThfcmVhZCA9IChfcmVhZCksIFwKKwkuZGV2aWNlX3U4X3dyaXRlID0g
KF93cml0ZSksIFwKK30KKyNkZWZpbmUgQ09VTlRFUl9DT01QX0NPVU5UX1U4KF9uYW1lLCBfcmVh
ZCwgX3dyaXRlKSBcCit7IFwKKwkudHlwZSA9IENPVU5URVJfQ09NUF9VOCwgXAorCS5uYW1lID0g
KF9uYW1lKSwgXAorCS5jb3VudF91OF9yZWFkID0gKF9yZWFkKSwgXAorCS5jb3VudF91OF93cml0
ZSA9IChfd3JpdGUpLCBcCit9CisjZGVmaW5lIENPVU5URVJfQ09NUF9TSUdOQUxfVTgoX25hbWUs
IF9yZWFkLCBfd3JpdGUpIFwKK3sgXAorCS50eXBlID0gQ09VTlRFUl9DT01QX1U4LCBcCisJLm5h
bWUgPSAoX25hbWUpLCBcCisJLnNpZ25hbF91OF9yZWFkID0gKF9yZWFkKSwgXAorCS5zaWduYWxf
dThfd3JpdGUgPSAoX3dyaXRlKSwgXAorfQorCisjZGVmaW5lIENPVU5URVJfQ09NUF9ERVZJQ0Vf
VTY0KF9uYW1lLCBfcmVhZCwgX3dyaXRlKSBcCit7IFwKKwkudHlwZSA9IENPVU5URVJfQ09NUF9V
NjQsIFwKKwkubmFtZSA9IChfbmFtZSksIFwKKwkuZGV2aWNlX3U2NF9yZWFkID0gKF9yZWFkKSwg
XAorCS5kZXZpY2VfdTY0X3dyaXRlID0gKF93cml0ZSksIFwKK30KKyNkZWZpbmUgQ09VTlRFUl9D
T01QX0NPVU5UX1U2NChfbmFtZSwgX3JlYWQsIF93cml0ZSkgXAoreyBcCisJLnR5cGUgPSBDT1VO
VEVSX0NPTVBfVTY0LCBcCisJLm5hbWUgPSAoX25hbWUpLCBcCisJLmNvdW50X3U2NF9yZWFkID0g
KF9yZWFkKSwgXAorCS5jb3VudF91NjRfd3JpdGUgPSAoX3dyaXRlKSwgXAorfQorI2RlZmluZSBD
T1VOVEVSX0NPTVBfU0lHTkFMX1U2NChfbmFtZSwgX3JlYWQsIF93cml0ZSkgXAoreyBcCisJLnR5
cGUgPSBDT1VOVEVSX0NPTVBfVTY0LCBcCisJLm5hbWUgPSAoX25hbWUpLCBcCisJLnNpZ25hbF91
NjRfcmVhZCA9IChfcmVhZCksIFwKKwkuc2lnbmFsX3U2NF93cml0ZSA9IChfd3JpdGUpLCBcCit9
CisKKyNkZWZpbmUgQ09VTlRFUl9DT01QX0RFVklDRV9CT09MKF9uYW1lLCBfcmVhZCwgX3dyaXRl
KSBcCit7IFwKKwkudHlwZSA9IENPVU5URVJfQ09NUF9CT09MLCBcCisJLm5hbWUgPSAoX25hbWUp
LCBcCisJLmRldmljZV91OF9yZWFkID0gKF9yZWFkKSwgXAorCS5kZXZpY2VfdThfd3JpdGUgPSAo
X3dyaXRlKSwgXAorfQorI2RlZmluZSBDT1VOVEVSX0NPTVBfQ09VTlRfQk9PTChfbmFtZSwgX3Jl
YWQsIF93cml0ZSkgXAoreyBcCisJLnR5cGUgPSBDT1VOVEVSX0NPTVBfQk9PTCwgXAorCS5uYW1l
ID0gKF9uYW1lKSwgXAorCS5jb3VudF91OF9yZWFkID0gKF9yZWFkKSwgXAorCS5jb3VudF91OF93
cml0ZSA9IChfd3JpdGUpLCBcCit9CisjZGVmaW5lIENPVU5URVJfQ09NUF9TSUdOQUxfQk9PTChf
bmFtZSwgX3JlYWQsIF93cml0ZSkgXAoreyBcCisJLnR5cGUgPSBDT1VOVEVSX0NPTVBfQk9PTCwg
XAorCS5uYW1lID0gKF9uYW1lKSwgXAorCS5zaWduYWxfdThfcmVhZCA9IChfcmVhZCksIFwKKwku
c2lnbmFsX3U4X3dyaXRlID0gKF93cml0ZSksIFwKK30KKworc3RydWN0IGNvdW50ZXJfYXZhaWxh
YmxlIHsKKwl1bmlvbiB7CisJCWNvbnN0IHUzMiAqZW51bXM7CisJCWNvbnN0IGNoYXIgKmNvbnN0
ICpzdHJzOworCX07CisJc2l6ZV90IG51bV9pdGVtczsKK307CisKKyNkZWZpbmUgREVGSU5FX0NP
VU5URVJfQVZBSUxBQkxFKF9uYW1lLCBfZW51bXMpIFwKKwlzdHJ1Y3QgY291bnRlcl9hdmFpbGFi
bGUgX25hbWUgPSB7IFwKKwkJLmVudW1zID0gKF9lbnVtcyksIFwKKwkJLm51bV9pdGVtcyA9IEFS
UkFZX1NJWkUoX2VudW1zKSwgXAorCX0KKworI2RlZmluZSBERUZJTkVfQ09VTlRFUl9FTlVNKF9u
YW1lLCBfc3RycykgXAorCXN0cnVjdCBjb3VudGVyX2F2YWlsYWJsZSBfbmFtZSA9IHsgXAorCQku
c3RycyA9IChfc3RycyksIFwKKwkJLm51bV9pdGVtcyA9IEFSUkFZX1NJWkUoX3N0cnMpLCBcCisJ
fQorCisjZGVmaW5lIENPVU5URVJfQ09NUF9ERVZJQ0VfRU5VTShfbmFtZSwgX2dldCwgX3NldCwg
X2F2YWlsYWJsZSkgXAoreyBcCisJLnR5cGUgPSBDT1VOVEVSX0NPTVBfRU5VTSwgXAorCS5uYW1l
ID0gKF9uYW1lKSwgXAorCS5kZXZpY2VfdTMyX3JlYWQgPSAoX2dldCksIFwKKwkuZGV2aWNlX3Uz
Ml93cml0ZSA9IChfc2V0KSwgXAorCS5wcml2ID0gJihfYXZhaWxhYmxlKSwgXAorfQorI2RlZmlu
ZSBDT1VOVEVSX0NPTVBfQ09VTlRfRU5VTShfbmFtZSwgX2dldCwgX3NldCwgX2F2YWlsYWJsZSkg
XAoreyBcCisJLnR5cGUgPSBDT1VOVEVSX0NPTVBfRU5VTSwgXAorCS5uYW1lID0gKF9uYW1lKSwg
XAorCS5jb3VudF91MzJfcmVhZCA9IChfZ2V0KSwgXAorCS5jb3VudF91MzJfd3JpdGUgPSAoX3Nl
dCksIFwKKwkucHJpdiA9ICYoX2F2YWlsYWJsZSksIFwKK30KKyNkZWZpbmUgQ09VTlRFUl9DT01Q
X1NJR05BTF9FTlVNKF9uYW1lLCBfZ2V0LCBfc2V0LCBfYXZhaWxhYmxlKSBcCit7IFwKKwkudHlw
ZSA9IENPVU5URVJfQ09NUF9FTlVNLCBcCisJLm5hbWUgPSAoX25hbWUpLCBcCisJLnNpZ25hbF91
MzJfcmVhZCA9IChfZ2V0KSwgXAorCS5zaWduYWxfdTMyX3dyaXRlID0gKF9zZXQpLCBcCisJLnBy
aXYgPSAmKF9hdmFpbGFibGUpLCBcCit9CisKKyNkZWZpbmUgQ09VTlRFUl9DT01QX0NFSUxJTkco
X3JlYWQsIF93cml0ZSkgXAorCUNPVU5URVJfQ09NUF9DT1VOVF9VNjQoImNlaWxpbmciLCBfcmVh
ZCwgX3dyaXRlKQorCisjZGVmaW5lIENPVU5URVJfQ09NUF9DT1VOVF9NT0RFKF9yZWFkLCBfd3Jp
dGUsIF9hdmFpbGFibGUpIFwKK3sgXAorCS50eXBlID0gQ09VTlRFUl9DT01QX0NPVU5UX01PREUs
IFwKKwkubmFtZSA9ICJjb3VudF9tb2RlIiwgXAorCS5jb3VudF91MzJfcmVhZCA9IChfcmVhZCks
IFwKKwkuY291bnRfdTMyX3dyaXRlID0gKF93cml0ZSksIFwKKwkucHJpdiA9ICYoX2F2YWlsYWJs
ZSksIFwKK30KKworI2RlZmluZSBDT1VOVEVSX0NPTVBfRElSRUNUSU9OKF9yZWFkKSBcCit7IFwK
KwkudHlwZSA9IENPVU5URVJfQ09NUF9DT1VOVF9ESVJFQ1RJT04sIFwKKwkubmFtZSA9ICJkaXJl
Y3Rpb24iLCBcCisJLmNvdW50X3UzMl9yZWFkID0gKF9yZWFkKSwgXAorfQorCisjZGVmaW5lIENP
VU5URVJfQ09NUF9FTkFCTEUoX3JlYWQsIF93cml0ZSkgXAorCUNPVU5URVJfQ09NUF9DT1VOVF9C
T09MKCJlbmFibGUiLCBfcmVhZCwgX3dyaXRlKQorCisjZGVmaW5lIENPVU5URVJfQ09NUF9GTE9P
UihfcmVhZCwgX3dyaXRlKSBcCisJQ09VTlRFUl9DT01QX0NPVU5UX1U2NCgiZmxvb3IiLCBfcmVh
ZCwgX3dyaXRlKQorCisjZGVmaW5lIENPVU5URVJfQ09NUF9QUkVTRVQoX3JlYWQsIF93cml0ZSkg
XAorCUNPVU5URVJfQ09NUF9DT1VOVF9VNjQoInByZXNldCIsIF9yZWFkLCBfd3JpdGUpCisKKyNk
ZWZpbmUgQ09VTlRFUl9DT01QX1BSRVNFVF9FTkFCTEUoX3JlYWQsIF93cml0ZSkgXAorCUNPVU5U
RVJfQ09NUF9DT1VOVF9CT09MKCJwcmVzZXRfZW5hYmxlIiwgX3JlYWQsIF93cml0ZSkKIAogI2Vu
ZGlmIC8qIF9DT1VOVEVSX0hfICovCmRpZmYgLS1naXQgYS9pbmNsdWRlL2xpbnV4L2NvdW50ZXJf
ZW51bS5oIGIvaW5jbHVkZS9saW51eC9jb3VudGVyX2VudW0uaApkZWxldGVkIGZpbGUgbW9kZSAx
MDA2NDQKaW5kZXggOWY5MTcyOThhODhmLi4wMDAwMDAwMDAwMDAKLS0tIGEvaW5jbHVkZS9saW51
eC9jb3VudGVyX2VudW0uaAorKysgL2Rldi9udWxsCkBAIC0xLDQ1ICswLDAgQEAKLS8qIFNQRFgt
TGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wICovCi0vKgotICogQ291bnRlciBpbnRlcmZhY2Ug
ZW51bSBmdW5jdGlvbnMKLSAqIENvcHlyaWdodCAoQykgMjAxOCBXaWxsaWFtIEJyZWF0aGl0dCBH
cmF5Ci0gKi8KLSNpZm5kZWYgX0NPVU5URVJfRU5VTV9IXwotI2RlZmluZSBfQ09VTlRFUl9FTlVN
X0hfCi0KLSNpbmNsdWRlIDxsaW51eC90eXBlcy5oPgotCi1zdHJ1Y3QgY291bnRlcl9kZXZpY2U7
Ci1zdHJ1Y3QgY291bnRlcl9zaWduYWw7Ci1zdHJ1Y3QgY291bnRlcl9jb3VudDsKLQotc3NpemVf
dCBjb3VudGVyX3NpZ25hbF9lbnVtX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVy
LAotCQkJCSBzdHJ1Y3QgY291bnRlcl9zaWduYWwgKnNpZ25hbCwgdm9pZCAqcHJpdiwKLQkJCQkg
Y2hhciAqYnVmKTsKLXNzaXplX3QgY291bnRlcl9zaWduYWxfZW51bV93cml0ZShzdHJ1Y3QgY291
bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkJICBzdHJ1Y3QgY291bnRlcl9zaWduYWwgKnNpZ25h
bCwgdm9pZCAqcHJpdiwKLQkJCQkgIGNvbnN0IGNoYXIgKmJ1Ziwgc2l6ZV90IGxlbik7Ci0KLXNz
aXplX3QgY291bnRlcl9zaWduYWxfZW51bV9hdmFpbGFibGVfcmVhZChzdHJ1Y3QgY291bnRlcl9k
ZXZpY2UgKmNvdW50ZXIsCi0JCQkJCSAgIHN0cnVjdCBjb3VudGVyX3NpZ25hbCAqc2lnbmFsLAot
CQkJCQkgICB2b2lkICpwcml2LCBjaGFyICpidWYpOwotCi1zc2l6ZV90IGNvdW50ZXJfY291bnRf
ZW51bV9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQlzdHJ1Y3QgY291
bnRlcl9jb3VudCAqY291bnQsIHZvaWQgKnByaXYsCi0JCQkJY2hhciAqYnVmKTsKLXNzaXplX3Qg
Y291bnRlcl9jb3VudF9lbnVtX3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwK
LQkJCQkgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB2b2lkICpwcml2LAotCQkJCSBjb25z
dCBjaGFyICpidWYsIHNpemVfdCBsZW4pOwotCi1zc2l6ZV90IGNvdW50ZXJfY291bnRfZW51bV9h
dmFpbGFibGVfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkJCSAgc3Ry
dWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkJCQkgIHZvaWQgKnByaXYsIGNoYXIgKmJ1Zik7
Ci0KLXNzaXplX3QgY291bnRlcl9kZXZpY2VfZW51bV9yZWFkKHN0cnVjdCBjb3VudGVyX2Rldmlj
ZSAqY291bnRlciwgdm9pZCAqcHJpdiwKLQkJCQkgY2hhciAqYnVmKTsKLXNzaXplX3QgY291bnRl
cl9kZXZpY2VfZW51bV93cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsIHZvaWQg
KnByaXYsCi0JCQkJICBjb25zdCBjaGFyICpidWYsIHNpemVfdCBsZW4pOwotCi1zc2l6ZV90IGNv
dW50ZXJfZGV2aWNlX2VudW1fYXZhaWxhYmxlX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpj
b3VudGVyLAotCQkJCQkgICB2b2lkICpwcml2LCBjaGFyICpidWYpOwotCi0jZW5kaWYgLyogX0NP
VU5URVJfRU5VTV9IXyAqLwotLSAKMi4zMi4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fXwpMaW51eC1zdG0zMiBtYWlsaW5nIGxpc3QKTGludXgtc3RtMzJA
c3QtbWQtbWFpbG1hbi5zdG9ybXJlcGx5LmNvbQpodHRwczovL3N0LW1kLW1haWxtYW4uc3Rvcm1y
ZXBseS5jb20vbWFpbG1hbi9saXN0aW5mby9saW51eC1zdG0zMgo=
