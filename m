Return-Path: <linux-stm32-bounces@st-md-mailman.stormreply.com>
X-Original-To: lists+linux-stm32@lfdr.de
Delivered-To: lists+linux-stm32@lfdr.de
Received: from stm-ict-prod-mailman-01.stormreply.prv (st-md-mailman.stormreply.com [52.209.6.89])
	by mail.lfdr.de (Postfix) with ESMTPS id 513703DD355
	for <lists+linux-stm32@lfdr.de>; Mon,  2 Aug 2021 11:51:16 +0200 (CEST)
Received: from ip-172-31-3-76.eu-west-1.compute.internal (localhost [127.0.0.1])
	by stm-ict-prod-mailman-01.stormreply.prv (Postfix) with ESMTP id 104F3C5A4E2;
	Mon,  2 Aug 2021 09:51:16 +0000 (UTC)
Received: from mail-pl1-f179.google.com (mail-pl1-f179.google.com
 [209.85.214.179])
 (using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits))
 (No client certificate requested)
 by stm-ict-prod-mailman-01.stormreply.prv (Postfix) with ESMTPS id 67644C59781
 for <linux-stm32@st-md-mailman.stormreply.com>;
 Tue, 13 Jul 2021 09:54:15 +0000 (UTC)
Received: by mail-pl1-f179.google.com with SMTP id a14so10827998pls.4
 for <linux-stm32@st-md-mailman.stormreply.com>;
 Tue, 13 Jul 2021 02:54:15 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=Ga6vKXw1/wPjsfKpNatj2OVylQokf7NhGEzhc0Lu7vU=;
 b=jowl58sok1/warWgMNE44rsTKN1mXqocYpuF4oZrCL5ikDGYBVgbA0ATPxR7PvR7bY
 QsOGe/S5SENCpHdLySrwt4f3X19Yc5BWPZPmv9XgsC/pOPAe6rAndj9OW4PDgBYMxT/8
 zHioGLpNujx+zSTlwl+WdtCq8V6JamJTEHzxpSWG/kT9+E2uqkBv8t1Ce8lPqbt6jwfS
 yPo1QtXF38/mHetiEGwO+rE/6jtCndwwQUBfFibQGZHiitJEeRDeLl7OFVs2HXID9i4I
 Ajz1hLc6IbcW967y5usMtQW8Wix9oqi33ARy7VZIAX5UG+V0wBnr6HY7G5VG8Lzhh+yo
 XiKw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=Ga6vKXw1/wPjsfKpNatj2OVylQokf7NhGEzhc0Lu7vU=;
 b=LgGKtj05Cz1/VTQ4GD3O0pV9qEmowKcZvj+bhsE4vFSQvP5E6shT3x6ISEEUIT/NGa
 WQtTxhRTL1O6UOidMmcV1IuPIr5yN0h+kajcNil2/z452RjebEicw3p1EjBOEfCJVQgy
 AXboS0dRd873n2uF6sF74H2RjxacUOD9z6jRo3kFXQVHmxff7fGkJULtOLubrmY4/7h9
 mdUuH5FqcOFqk9waQPYvBdXTEypKgyNvrp10s5I43wDQZgvsuBcaC72Uc3ya54iPE+IP
 MhFwAc/c1jfjm2SpHb/rcDrrwcSNA6Ptnbw2BVMa01zofbHD8IoyMNrGlr+DgrHM93Jb
 6s4Q==
X-Gm-Message-State: AOAM533Qn9Tp5JIZDbgeY76aYBzse7Wg3ONqJcNNG10cVKBRTrZtHDBk
 ywECPhl+y2H+N1ZO3s78q0c=
X-Google-Smtp-Source: ABdhPJyCxajhObxwlp+3yHsWGt3L92Z8ZzxeAV4ImxojgeEfeqC3BHslmhbkM0Y05XQ/+GuDK6Vkcw==
X-Received: by 2002:a17:902:a986:b029:129:dcf5:b585 with SMTP id
 bh6-20020a170902a986b0290129dcf5b585mr2943058plb.30.1626170053580; 
 Tue, 13 Jul 2021 02:54:13 -0700 (PDT)
Received: from localhost.localdomain ([156.146.35.76])
 by smtp.gmail.com with ESMTPSA id f6sm18153854pfj.28.2021.07.13.02.54.07
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Tue, 13 Jul 2021 02:54:13 -0700 (PDT)
From: William Breathitt Gray <vilhelm.gray@gmail.com>
To: jic23@kernel.org
Date: Tue, 13 Jul 2021 18:53:10 +0900
Message-Id: <91a25c0c5239d1d9e2ebae59f67ed7cf1015b77d.1626165765.git.vilhelm.gray@gmail.com>
X-Mailer: git-send-email 2.32.0
In-Reply-To: <cover.1626165764.git.vilhelm.gray@gmail.com>
References: <cover.1626165764.git.vilhelm.gray@gmail.com>
MIME-Version: 1.0
X-Mailman-Approved-At: Mon, 02 Aug 2021 09:51:10 +0000
Cc: kamel.bouhara@bootlin.com, gwendal@chromium.org, david@lechnology.com,
 linux-iio@vger.kernel.org, patrick.havelange@essensium.com,
 alexandre.belloni@bootlin.com, mcoquelin.stm32@gmail.com,
 linux-kernel@vger.kernel.org, o.rempel@pengutronix.de,
 jarkko.nikula@linux.intel.com, Dan Carpenter <dan.carpenter@oracle.com>,
 kernel@pengutronix.de, William Breathitt Gray <vilhelm.gray@gmail.com>,
 fabrice.gasnier@st.com, syednwaris@gmail.com,
 linux-stm32@st-md-mailman.stormreply.com, linux-arm-kernel@lists.infradead.org,
 alexandre.torgue@st.com
Subject: [Linux-stm32] [PATCH v13 06/17] counter: Internalize sysfs
	interface code
X-BeenThere: linux-stm32@st-md-mailman.stormreply.com
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: <linux-stm32.st-md-mailman.stormreply.com>
List-Unsubscribe: <https://st-md-mailman.stormreply.com/mailman/options/linux-stm32>, 
 <mailto:linux-stm32-request@st-md-mailman.stormreply.com?subject=unsubscribe>
List-Archive: <http://st-md-mailman.stormreply.com/pipermail/linux-stm32/>
List-Post: <mailto:linux-stm32@st-md-mailman.stormreply.com>
List-Help: <mailto:linux-stm32-request@st-md-mailman.stormreply.com?subject=help>
List-Subscribe: <https://st-md-mailman.stormreply.com/mailman/listinfo/linux-stm32>, 
 <mailto:linux-stm32-request@st-md-mailman.stormreply.com?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: linux-stm32-bounces@st-md-mailman.stormreply.com
Sender: "Linux-stm32" <linux-stm32-bounces@st-md-mailman.stormreply.com>

VGhpcyBpcyBhIHJlaW1wbGVtZW50YXRpb24gb2YgdGhlIEdlbmVyaWMgQ291bnRlciBkcml2ZXIg
aW50ZXJmYWNlLgpUaGVyZSBhcmUgbm8gbW9kaWZpY2F0aW9ucyB0byB0aGUgQ291bnRlciBzdWJz
eXN0ZW0gdXNlcnNwYWNlIGludGVyZmFjZSwKc28gZXhpc3RpbmcgdXNlcnNwYWNlIGFwcGxpY2F0
aW9ucyBzaG91bGQgY29udGludWUgdG8gcnVuIHNlYW1sZXNzbHkuCgpUaGUgcHVycG9zZSBvZiB0
aGlzIHBhdGNoIGlzIHRvIGludGVybmFsaXplIHRoZSBzeXNmcyBpbnRlcmZhY2UgY29kZQphbW9u
ZyB0aGUgdmFyaW91cyBjb3VudGVyIGRyaXZlcnMgaW50byBhIHNoYXJlZCBtb2R1bGUuIENvdW50
ZXIgZHJpdmVycwpwYXNzIGFuZCB0YWtlIGRhdGEgbmF0aXZlbHkgKGkuZS4gdTgsIHU2NCwgZXRj
LikgYW5kIHRoZSBzaGFyZWQgY291bnRlcgptb2R1bGUgaGFuZGxlcyB0aGUgdHJhbnNsYXRpb24g
YmV0d2VlbiB0aGUgc3lzZnMgaW50ZXJmYWNlIGFuZCB0aGUKZGV2aWNlIGRyaXZlcnMuIFRoaXMg
Z3VhcmFudGVlcyBhIHN0YW5kYXJkIHVzZXJzcGFjZSBpbnRlcmZhY2UgZm9yIGFsbApjb3VudGVy
IGRyaXZlcnMsIGFuZCBoZWxwcyBnZW5lcmFsaXplIHRoZSBHZW5lcmljIENvdW50ZXIgZHJpdmVy
IEFCSSBpbgpvcmRlciB0byBzdXBwb3J0IHRoZSBHZW5lcmljIENvdW50ZXIgY2hyZGV2IGludGVy
ZmFjZSAoaW50cm9kdWNlZCBpbiBhCnN1YnNlcXVlbnQgcGF0Y2gpIHdpdGhvdXQgc2lnbmlmaWNh
bnQgY2hhbmdlcyB0byB0aGUgZXhpc3RpbmcgY291bnRlcgpkcml2ZXJzLgoKTm90ZSwgQ291bnRl
ciBkZXZpY2UgcmVnaXN0cmF0aW9uIGlzIHRoZSBzYW1lIGFzIGJlZm9yZTogZHJpdmVycwpwb3B1
bGF0ZSBhIHN0cnVjdCBjb3VudGVyX2RldmljZSB3aXRoIGNvbXBvbmVudHMgYW5kIGNhbGxiYWNr
cywgdGhlbgpwYXNzIHRoZSBzdHJ1Y3R1cmUgdG8gdGhlIGRldm1fY291bnRlcl9yZWdpc3RlciBm
dW5jdGlvbi4gSG93ZXZlciwKd2hhdCdzIGRpZmZlcmVudCBub3cgaXMgaG93IHRoZSBDb3VudGVy
IHN1YnN5c3RlbSBjb2RlIGhhbmRsZXMgdGhpcwpyZWdpc3RyYXRpb24gaW50ZXJuYWxseS4KCldo
ZXJlYXMgYmVmb3JlIGNhbGxiYWNrcyB3b3VsZCBpbnRlcmFjdCBkaXJlY3RseSB3aXRoIHN5c2Zz
IGRhdGEsIHRoaXMKaW50ZXJhY3Rpb24gaXMgbm93IGFic3RyYWN0ZWQgYW5kIGluc3RlYWQgY2Fs
bGJhY2tzIGludGVyYWN0IHdpdGggbmF0aXZlCkMgZGF0YSB0eXBlcy4gVGhlIGNvdW50ZXJfY29t
cCBzdHJ1Y3R1cmUgZm9ybXMgdGhlIGJhc2lzIGZvciBDb3VudGVyCmV4dGVuc2lvbnMuCgpUaGUg
Y291bnRlci1zeXNmcy5jIGZpbGUgY29udGFpbnMgdGhlIGNvZGUgdG8gcGFyc2UgdGhyb3VnaCB0
aGUKY291bnRlcl9kZXZpY2Ugc3RydWN0dXJlIGFuZCByZWdpc3RlciB0aGUgcmVxdWVzdGVkIGNv
bXBvbmVudHMgYW5kCmV4dGVuc2lvbnMuIEF0dHJpYnV0ZXMgYXJlIGNyZWF0ZWQgYW5kIHBvcHVs
YXRlZCBiYXNlZCBvbiB0eXBlLCB3aXRoCnJlc3BlY3RpdmUgdHJhbnNsYXRpb24gZnVuY3Rpb25z
IHRvIGhhbmRsZSB0aGUgbWFwcGluZyBiZXR3ZWVuIHN5c2ZzIGFuZAp0aGUgY291bnRlciBkcml2
ZXIgY2FsbGJhY2tzLgoKVGhlIHRyYW5zbGF0aW9uIHBlcmZvcm1lZCBmb3IgZWFjaCBhdHRyaWJ1
dGUgaXMgc3RyYWlnaHRmb3J3YXJkOiB0aGUKYXR0cmlidXRlIHR5cGUgYW5kIGRhdGEgaXMgcGFy
c2VkIGZyb20gdGhlIGNvdW50ZXJfYXR0cmlidXRlIHN0cnVjdHVyZSwKdGhlIHJlc3BlY3RpdmUg
Y291bnRlciBkcml2ZXIgcmVhZC93cml0ZSBjYWxsYmFjayBpcyBjYWxsZWQsIGFuZCBzeXNmcwpJ
L08gaXMgaGFuZGxlZCBiZWZvcmUgb3IgYWZ0ZXIgdGhlIGRyaXZlciByZWFkL3dyaXRlIGZ1bmN0
aW9uIGlzIGNhbGxlZC4KCkNjOiBKYXJra28gTmlrdWxhIDxqYXJra28ubmlrdWxhQGxpbnV4Lmlu
dGVsLmNvbT4KQ2M6IFBhdHJpY2sgSGF2ZWxhbmdlIDxwYXRyaWNrLmhhdmVsYW5nZUBlc3NlbnNp
dW0uY29tPgpDYzogS2FtZWwgQm91aGFyYSA8a2FtZWwuYm91aGFyYUBib290bGluLmNvbT4KQ2M6
IEZhYnJpY2UgR2FzbmllciA8ZmFicmljZS5nYXNuaWVyQHN0LmNvbT4KQ2M6IE1heGltZSBDb3F1
ZWxpbiA8bWNvcXVlbGluLnN0bTMyQGdtYWlsLmNvbT4KQ2M6IEFsZXhhbmRyZSBUb3JndWUgPGFs
ZXhhbmRyZS50b3JndWVAc3QuY29tPgpDYzogRGFuIENhcnBlbnRlciA8ZGFuLmNhcnBlbnRlckBv
cmFjbGUuY29tPgpBY2tlZC1ieTogU3llZCBOYXl5YXIgV2FyaXMgPHN5ZWRud2FyaXNAZ21haWwu
Y29tPgpSZXZpZXdlZC1ieTogRGF2aWQgTGVjaG5lciA8ZGF2aWRAbGVjaG5vbG9neS5jb20+ClRl
c3RlZC1ieTogRGF2aWQgTGVjaG5lciA8ZGF2aWRAbGVjaG5vbG9neS5jb20+ClNpZ25lZC1vZmYt
Ynk6IFdpbGxpYW0gQnJlYXRoaXR0IEdyYXkgPHZpbGhlbG0uZ3JheUBnbWFpbC5jb20+Ci0tLQog
TUFJTlRBSU5FUlMgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgICAgMSAtCiBkcml2ZXJz
L2NvdW50ZXIvMTA0LXF1YWQtOC5jICAgICAgICAgICAgfCAgNDQ5ICsrKy0tLS0KIGRyaXZlcnMv
Y291bnRlci9NYWtlZmlsZSAgICAgICAgICAgICAgICB8ICAgIDEgKwogZHJpdmVycy9jb3VudGVy
L2NvdW50ZXItY29yZS5jICAgICAgICAgIHwgIDE0NSArKysKIGRyaXZlcnMvY291bnRlci9jb3Vu
dGVyLXN5c2ZzLmMgICAgICAgICB8ICA4NTIgKysrKysrKysrKysrKwogZHJpdmVycy9jb3VudGVy
L2NvdW50ZXItc3lzZnMuaCAgICAgICAgIHwgICAxMyArCiBkcml2ZXJzL2NvdW50ZXIvY291bnRl
ci5jICAgICAgICAgICAgICAgfCAxNDk2IC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiBkcml2ZXJz
L2NvdW50ZXIvZnRtLXF1YWRkZWMuYyAgICAgICAgICAgfCAgIDU2ICstCiBkcml2ZXJzL2NvdW50
ZXIvaW50ZWwtcWVwLmMgICAgICAgICAgICAgfCAgMTQ0ICstLQogZHJpdmVycy9jb3VudGVyL2lu
dGVycnVwdC1jbnQuYyAgICAgICAgIHwgICA2MiArLQogZHJpdmVycy9jb3VudGVyL21pY3JvY2hp
cC10Y2ItY2FwdHVyZS5jIHwgICA5MyArLQogZHJpdmVycy9jb3VudGVyL3N0bTMyLWxwdGltZXIt
Y250LmMgICAgIHwgIDE5NyArLS0KIGRyaXZlcnMvY291bnRlci9zdG0zMi10aW1lci1jbnQuYyAg
ICAgICB8ICAxNDcgKy0tCiBkcml2ZXJzL2NvdW50ZXIvdGktZXFlcC5jICAgICAgICAgICAgICAg
fCAgMTgwICstLQogaW5jbHVkZS9saW51eC9jb3VudGVyLmggICAgICAgICAgICAgICAgIHwgIDY1
OCArKysrKy0tLS0tCiBpbmNsdWRlL2xpbnV4L2NvdW50ZXJfZW51bS5oICAgICAgICAgICAgfCAg
IDQ1IC0KIDE2IGZpbGVzIGNoYW5nZWQsIDE5NTkgaW5zZXJ0aW9ucygrKSwgMjU4MCBkZWxldGlv
bnMoLSkKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2NvdW50ZXIvY291bnRlci1jb3JlLmMK
IGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2NvdW50ZXIvY291bnRlci1zeXNmcy5jCiBjcmVh
dGUgbW9kZSAxMDA2NDQgZHJpdmVycy9jb3VudGVyL2NvdW50ZXItc3lzZnMuaAogZGVsZXRlIG1v
ZGUgMTAwNjQ0IGRyaXZlcnMvY291bnRlci9jb3VudGVyLmMKIGRlbGV0ZSBtb2RlIDEwMDY0NCBp
bmNsdWRlL2xpbnV4L2NvdW50ZXJfZW51bS5oCgpkaWZmIC0tZ2l0IGEvTUFJTlRBSU5FUlMgYi9N
QUlOVEFJTkVSUwppbmRleCBiODBlNmY3MDE1NmIuLjM3MmI2OTY2ZTkzYyAxMDA2NDQKLS0tIGEv
TUFJTlRBSU5FUlMKKysrIGIvTUFJTlRBSU5FUlMKQEAgLTQ3NDgsNyArNDc0OCw2IEBAIEY6CURv
Y3VtZW50YXRpb24vQUJJL3Rlc3Rpbmcvc3lzZnMtYnVzLWNvdW50ZXIKIEY6CURvY3VtZW50YXRp
b24vZHJpdmVyLWFwaS9nZW5lcmljLWNvdW50ZXIucnN0CiBGOglkcml2ZXJzL2NvdW50ZXIvCiBG
OglpbmNsdWRlL2xpbnV4L2NvdW50ZXIuaAotRjoJaW5jbHVkZS9saW51eC9jb3VudGVyX2VudW0u
aAogCiBDUDI2MTUgSTJDIERSSVZFUgogTToJQmVuY2UgQ3PDs2vDoXMgPGJlbmNlOThAc2NoLmJt
ZS5odT4KZGlmZiAtLWdpdCBhL2RyaXZlcnMvY291bnRlci8xMDQtcXVhZC04LmMgYi9kcml2ZXJz
L2NvdW50ZXIvMTA0LXF1YWQtOC5jCmluZGV4IDUyODNmZjEyOGMxNy4uZDExNjFjMjdjNDg4IDEw
MDY0NAotLS0gYS9kcml2ZXJzL2NvdW50ZXIvMTA0LXF1YWQtOC5jCisrKyBiL2RyaXZlcnMvY291
bnRlci8xMDQtcXVhZC04LmMKQEAgLTExNiw3ICsxMTYsNyBAQCBzdGF0aWMgaW50IHF1YWQ4X3Np
Z25hbF9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKIH0KIAogc3RhdGljIGlu
dCBxdWFkOF9jb3VudF9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQlzdHJ1
Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHVuc2lnbmVkIGxvbmcgKnZhbCkKKwkJCSAgICBzdHJ1
Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHU2NCAqdmFsKQogewogCXN0cnVjdCBxdWFkOCAqY29u
c3QgcHJpdiA9IGNvdW50ZXItPnByaXY7CiAJY29uc3QgaW50IGJhc2Vfb2Zmc2V0ID0gcHJpdi0+
YmFzZSArIDIgKiBjb3VudC0+aWQ7CkBAIC0xNDcsNyArMTQ3LDcgQEAgc3RhdGljIGludCBxdWFk
OF9jb3VudF9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKIH0KIAogc3RhdGlj
IGludCBxdWFkOF9jb3VudF93cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0J
c3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB1bnNpZ25lZCBsb25nIHZhbCkKKwkJCSAgICAg
c3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB1NjQgdmFsKQogewogCXN0cnVjdCBxdWFkOCAq
Y29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7CiAJY29uc3QgaW50IGJhc2Vfb2Zmc2V0ID0gcHJp
di0+YmFzZSArIDIgKiBjb3VudC0+aWQ7CkBAIC0xODcsMjIgKzE4NywxNiBAQCBzdGF0aWMgaW50
IHF1YWQ4X2NvdW50X3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKIAlyZXR1
cm4gMDsKIH0KIAotZW51bSBxdWFkOF9jb3VudF9mdW5jdGlvbiB7Ci0JUVVBRDhfQ09VTlRfRlVO
Q1RJT05fUFVMU0VfRElSRUNUSU9OID0gMCwKLQlRVUFEOF9DT1VOVF9GVU5DVElPTl9RVUFEUkFU
VVJFX1gxLAotCVFVQUQ4X0NPVU5UX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDIsCi0JUVVBRDhfQ09V
TlRfRlVOQ1RJT05fUVVBRFJBVFVSRV9YNAotfTsKLQogc3RhdGljIGNvbnN0IGVudW0gY291bnRl
cl9mdW5jdGlvbiBxdWFkOF9jb3VudF9mdW5jdGlvbnNfbGlzdFtdID0gewotCVtRVUFEOF9DT1VO
VF9GVU5DVElPTl9QVUxTRV9ESVJFQ1RJT05dID0gQ09VTlRFUl9GVU5DVElPTl9QVUxTRV9ESVJF
Q1RJT04sCi0JW1FVQUQ4X0NPVU5UX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDFdID0gQ09VTlRFUl9G
VU5DVElPTl9RVUFEUkFUVVJFX1gxX0EsCi0JW1FVQUQ4X0NPVU5UX0ZVTkNUSU9OX1FVQURSQVRV
UkVfWDJdID0gQ09VTlRFUl9GVU5DVElPTl9RVUFEUkFUVVJFX1gyX0EsCi0JW1FVQUQ4X0NPVU5U
X0ZVTkNUSU9OX1FVQURSQVRVUkVfWDRdID0gQ09VTlRFUl9GVU5DVElPTl9RVUFEUkFUVVJFX1g0
CisJQ09VTlRFUl9GVU5DVElPTl9QVUxTRV9ESVJFQ1RJT04sCisJQ09VTlRFUl9GVU5DVElPTl9R
VUFEUkFUVVJFX1gxX0EsCisJQ09VTlRFUl9GVU5DVElPTl9RVUFEUkFUVVJFX1gyX0EsCisJQ09V
TlRFUl9GVU5DVElPTl9RVUFEUkFUVVJFX1g0LAogfTsKIAotc3RhdGljIGludCBxdWFkOF9mdW5j
dGlvbl9nZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCXN0cnVjdCBjb3VudGVy
X2NvdW50ICpjb3VudCwgc2l6ZV90ICpmdW5jdGlvbikKK3N0YXRpYyBpbnQgcXVhZDhfZnVuY3Rp
b25fcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkgICAgICAgc3RydWN0
IGNvdW50ZXJfY291bnQgKmNvdW50LAorCQkJICAgICAgIGVudW0gY291bnRlcl9mdW5jdGlvbiAq
ZnVuY3Rpb24pCiB7CiAJc3RydWN0IHF1YWQ4ICpjb25zdCBwcml2ID0gY291bnRlci0+cHJpdjsK
IAljb25zdCBpbnQgaWQgPSBjb3VudC0+aWQ7CkBAIC0yMTIsMjUgKzIwNiwyNiBAQCBzdGF0aWMg
aW50IHF1YWQ4X2Z1bmN0aW9uX2dldChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAJ
aWYgKHByaXYtPnF1YWRyYXR1cmVfbW9kZVtpZF0pCiAJCXN3aXRjaCAocHJpdi0+cXVhZHJhdHVy
ZV9zY2FsZVtpZF0pIHsKIAkJY2FzZSAwOgotCQkJKmZ1bmN0aW9uID0gUVVBRDhfQ09VTlRfRlVO
Q1RJT05fUVVBRFJBVFVSRV9YMTsKKwkJCSpmdW5jdGlvbiA9IENPVU5URVJfRlVOQ1RJT05fUVVB
RFJBVFVSRV9YMV9BOwogCQkJYnJlYWs7CiAJCWNhc2UgMToKLQkJCSpmdW5jdGlvbiA9IFFVQUQ4
X0NPVU5UX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDI7CisJCQkqZnVuY3Rpb24gPSBDT1VOVEVSX0ZV
TkNUSU9OX1FVQURSQVRVUkVfWDJfQTsKIAkJCWJyZWFrOwogCQljYXNlIDI6Ci0JCQkqZnVuY3Rp
b24gPSBRVUFEOF9DT1VOVF9GVU5DVElPTl9RVUFEUkFUVVJFX1g0OworCQkJKmZ1bmN0aW9uID0g
Q09VTlRFUl9GVU5DVElPTl9RVUFEUkFUVVJFX1g0OwogCQkJYnJlYWs7CiAJCX0KIAllbHNlCi0J
CSpmdW5jdGlvbiA9IFFVQUQ4X0NPVU5UX0ZVTkNUSU9OX1BVTFNFX0RJUkVDVElPTjsKKwkJKmZ1
bmN0aW9uID0gQ09VTlRFUl9GVU5DVElPTl9QVUxTRV9ESVJFQ1RJT047CiAKIAltdXRleF91bmxv
Y2soJnByaXYtPmxvY2spOwogCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBpbnQgcXVhZDhfZnVu
Y3Rpb25fc2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQlzdHJ1Y3QgY291bnRl
cl9jb3VudCAqY291bnQsIHNpemVfdCBmdW5jdGlvbikKK3N0YXRpYyBpbnQgcXVhZDhfZnVuY3Rp
b25fd3JpdGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCXN0cnVjdCBjb3Vu
dGVyX2NvdW50ICpjb3VudCwKKwkJCQllbnVtIGNvdW50ZXJfZnVuY3Rpb24gZnVuY3Rpb24pCiB7
CiAJc3RydWN0IHF1YWQ4ICpjb25zdCBwcml2ID0gY291bnRlci0+cHJpdjsKIAljb25zdCBpbnQg
aWQgPSBjb3VudC0+aWQ7CkBAIC0yNDYsNyArMjQxLDcgQEAgc3RhdGljIGludCBxdWFkOF9mdW5j
dGlvbl9zZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAogCW1vZGVfY2ZnID0gcHJp
di0+Y291bnRfbW9kZVtpZF0gPDwgMTsKIAlpZHJfY2ZnID0gcHJpdi0+aW5kZXhfcG9sYXJpdHlb
aWRdIDw8IDE7CiAKLQlpZiAoZnVuY3Rpb24gPT0gUVVBRDhfQ09VTlRfRlVOQ1RJT05fUFVMU0Vf
RElSRUNUSU9OKSB7CisJaWYgKGZ1bmN0aW9uID09IENPVU5URVJfRlVOQ1RJT05fUFVMU0VfRElS
RUNUSU9OKSB7CiAJCSpxdWFkcmF0dXJlX21vZGUgPSAwOwogCiAJCS8qIFF1YWRyYXR1cmUgc2Nh
bGluZyBvbmx5IGF2YWlsYWJsZSBpbiBxdWFkcmF0dXJlIG1vZGUgKi8KQEAgLTI2MiwxNSArMjU3
LDE1IEBAIHN0YXRpYyBpbnQgcXVhZDhfZnVuY3Rpb25fc2V0KHN0cnVjdCBjb3VudGVyX2Rldmlj
ZSAqY291bnRlciwKIAkJKnF1YWRyYXR1cmVfbW9kZSA9IDE7CiAKIAkJc3dpdGNoIChmdW5jdGlv
bikgewotCQljYXNlIFFVQUQ4X0NPVU5UX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDE6CisJCWNhc2Ug
Q09VTlRFUl9GVU5DVElPTl9RVUFEUkFUVVJFX1gxX0E6CiAJCQkqc2NhbGUgPSAwOwogCQkJbW9k
ZV9jZmcgfD0gUVVBRDhfQ01SX1FVQURSQVRVUkVfWDE7CiAJCQlicmVhazsKLQkJY2FzZSBRVUFE
OF9DT1VOVF9GVU5DVElPTl9RVUFEUkFUVVJFX1gyOgorCQljYXNlIENPVU5URVJfRlVOQ1RJT05f
UVVBRFJBVFVSRV9YMl9BOgogCQkJKnNjYWxlID0gMTsKIAkJCW1vZGVfY2ZnIHw9IFFVQUQ4X0NN
Ul9RVUFEUkFUVVJFX1gyOwogCQkJYnJlYWs7Ci0JCWNhc2UgUVVBRDhfQ09VTlRfRlVOQ1RJT05f
UVVBRFJBVFVSRV9YNDoKKwkJY2FzZSBDT1VOVEVSX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDQ6CiAJ
CQkqc2NhbGUgPSAyOwogCQkJbW9kZV9jZmcgfD0gUVVBRDhfQ01SX1FVQURSQVRVUkVfWDQ7CiAJ
CQlicmVhazsKQEAgLTI4OSw4ICsyODQsOSBAQCBzdGF0aWMgaW50IHF1YWQ4X2Z1bmN0aW9uX3Nl
dChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRp
YyB2b2lkIHF1YWQ4X2RpcmVjdGlvbl9nZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVy
LAotCXN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgZW51bSBjb3VudGVyX2NvdW50X2RpcmVj
dGlvbiAqZGlyZWN0aW9uKQorc3RhdGljIGludCBxdWFkOF9kaXJlY3Rpb25fcmVhZChzdHJ1Y3Qg
Y291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50
LAorCQkJCWVudW0gY291bnRlcl9jb3VudF9kaXJlY3Rpb24gKmRpcmVjdGlvbikKIHsKIAljb25z
dCBzdHJ1Y3QgcXVhZDggKmNvbnN0IHByaXYgPSBjb3VudGVyLT5wcml2OwogCXVuc2lnbmVkIGlu
dCB1ZF9mbGFnOwpAQCAtMzAxLDc2ICsyOTcsNzQgQEAgc3RhdGljIHZvaWQgcXVhZDhfZGlyZWN0
aW9uX2dldChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAKIAkqZGlyZWN0aW9uID0g
KHVkX2ZsYWcpID8gQ09VTlRFUl9DT1VOVF9ESVJFQ1RJT05fRk9SV0FSRCA6CiAJCUNPVU5URVJf
Q09VTlRfRElSRUNUSU9OX0JBQ0tXQVJEOwotfQogCi1lbnVtIHF1YWQ4X3N5bmFwc2VfYWN0aW9u
IHsKLQlRVUFEOF9TWU5BUFNFX0FDVElPTl9OT05FID0gMCwKLQlRVUFEOF9TWU5BUFNFX0FDVElP
Tl9SSVNJTkdfRURHRSwKLQlRVUFEOF9TWU5BUFNFX0FDVElPTl9GQUxMSU5HX0VER0UsCi0JUVVB
RDhfU1lOQVBTRV9BQ1RJT05fQk9USF9FREdFUwotfTsKKwlyZXR1cm4gMDsKK30KIAogc3RhdGlj
IGNvbnN0IGVudW0gY291bnRlcl9zeW5hcHNlX2FjdGlvbiBxdWFkOF9pbmRleF9hY3Rpb25zX2xp
c3RbXSA9IHsKLQlbUVVBRDhfU1lOQVBTRV9BQ1RJT05fTk9ORV0gPSBDT1VOVEVSX1NZTkFQU0Vf
QUNUSU9OX05PTkUsCi0JW1FVQUQ4X1NZTkFQU0VfQUNUSU9OX1JJU0lOR19FREdFXSA9IENPVU5U
RVJfU1lOQVBTRV9BQ1RJT05fUklTSU5HX0VER0UKKwlDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX05P
TkUsCisJQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9SSVNJTkdfRURHRSwKIH07CiAKIHN0YXRpYyBj
b25zdCBlbnVtIGNvdW50ZXJfc3luYXBzZV9hY3Rpb24gcXVhZDhfc3luYXBzZV9hY3Rpb25zX2xp
c3RbXSA9IHsKLQlbUVVBRDhfU1lOQVBTRV9BQ1RJT05fTk9ORV0gPSBDT1VOVEVSX1NZTkFQU0Vf
QUNUSU9OX05PTkUsCi0JW1FVQUQ4X1NZTkFQU0VfQUNUSU9OX1JJU0lOR19FREdFXSA9IENPVU5U
RVJfU1lOQVBTRV9BQ1RJT05fUklTSU5HX0VER0UsCi0JW1FVQUQ4X1NZTkFQU0VfQUNUSU9OX0ZB
TExJTkdfRURHRV0gPSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX0ZBTExJTkdfRURHRSwKLQlbUVVB
RDhfU1lOQVBTRV9BQ1RJT05fQk9USF9FREdFU10gPSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX0JP
VEhfRURHRVMKKwlDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX05PTkUsCisJQ09VTlRFUl9TWU5BUFNF
X0FDVElPTl9SSVNJTkdfRURHRSwKKwlDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX0ZBTExJTkdfRURH
RSwKKwlDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX0JPVEhfRURHRVMsCiB9OwogCi1zdGF0aWMgaW50
IHF1YWQ4X2FjdGlvbl9nZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCXN0cnVj
dCBjb3VudGVyX2NvdW50ICpjb3VudCwgc3RydWN0IGNvdW50ZXJfc3luYXBzZSAqc3luYXBzZSwK
LQlzaXplX3QgKmFjdGlvbikKK3N0YXRpYyBpbnQgcXVhZDhfYWN0aW9uX3JlYWQoc3RydWN0IGNv
dW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291
bnQsCisJCQkgICAgIHN0cnVjdCBjb3VudGVyX3N5bmFwc2UgKnN5bmFwc2UsCisJCQkgICAgIGVu
dW0gY291bnRlcl9zeW5hcHNlX2FjdGlvbiAqYWN0aW9uKQogewogCXN0cnVjdCBxdWFkOCAqY29u
c3QgcHJpdiA9IGNvdW50ZXItPnByaXY7CiAJaW50IGVycjsKLQlzaXplX3QgZnVuY3Rpb24gPSAw
OworCWVudW0gY291bnRlcl9mdW5jdGlvbiBmdW5jdGlvbjsKIAljb25zdCBzaXplX3Qgc2lnbmFs
X2FfaWQgPSBjb3VudC0+c3luYXBzZXNbMF0uc2lnbmFsLT5pZDsKIAllbnVtIGNvdW50ZXJfY291
bnRfZGlyZWN0aW9uIGRpcmVjdGlvbjsKIAogCS8qIEhhbmRsZSBJbmRleCBzaWduYWxzICovCiAJ
aWYgKHN5bmFwc2UtPnNpZ25hbC0+aWQgPj0gMTYpIHsKIAkJaWYgKHByaXYtPnByZXNldF9lbmFi
bGVbY291bnQtPmlkXSkKLQkJCSphY3Rpb24gPSBRVUFEOF9TWU5BUFNFX0FDVElPTl9SSVNJTkdf
RURHRTsKKwkJCSphY3Rpb24gPSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX1JJU0lOR19FREdFOwog
CQllbHNlCi0JCQkqYWN0aW9uID0gUVVBRDhfU1lOQVBTRV9BQ1RJT05fTk9ORTsKKwkJCSphY3Rp
b24gPSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX05PTkU7CiAKIAkJcmV0dXJuIDA7CiAJfQogCi0J
ZXJyID0gcXVhZDhfZnVuY3Rpb25fZ2V0KGNvdW50ZXIsIGNvdW50LCAmZnVuY3Rpb24pOworCWVy
ciA9IHF1YWQ4X2Z1bmN0aW9uX3JlYWQoY291bnRlciwgY291bnQsICZmdW5jdGlvbik7CiAJaWYg
KGVycikKIAkJcmV0dXJuIGVycjsKIAogCS8qIERlZmF1bHQgYWN0aW9uIG1vZGUgKi8KLQkqYWN0
aW9uID0gUVVBRDhfU1lOQVBTRV9BQ1RJT05fTk9ORTsKKwkqYWN0aW9uID0gQ09VTlRFUl9TWU5B
UFNFX0FDVElPTl9OT05FOwogCiAJLyogRGV0ZXJtaW5lIGFjdGlvbiBtb2RlIGJhc2VkIG9uIGN1
cnJlbnQgY291bnQgZnVuY3Rpb24gbW9kZSAqLwogCXN3aXRjaCAoZnVuY3Rpb24pIHsKLQljYXNl
IFFVQUQ4X0NPVU5UX0ZVTkNUSU9OX1BVTFNFX0RJUkVDVElPTjoKKwljYXNlIENPVU5URVJfRlVO
Q1RJT05fUFVMU0VfRElSRUNUSU9OOgogCQlpZiAoc3luYXBzZS0+c2lnbmFsLT5pZCA9PSBzaWdu
YWxfYV9pZCkKLQkJCSphY3Rpb24gPSBRVUFEOF9TWU5BUFNFX0FDVElPTl9SSVNJTkdfRURHRTsK
KwkJCSphY3Rpb24gPSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX1JJU0lOR19FREdFOwogCQlyZXR1
cm4gMDsKLQljYXNlIFFVQUQ4X0NPVU5UX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDE6CisJY2FzZSBD
T1VOVEVSX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDFfQToKIAkJaWYgKHN5bmFwc2UtPnNpZ25hbC0+
aWQgPT0gc2lnbmFsX2FfaWQpIHsKLQkJCXF1YWQ4X2RpcmVjdGlvbl9nZXQoY291bnRlciwgY291
bnQsICZkaXJlY3Rpb24pOworCQkJZXJyID0gcXVhZDhfZGlyZWN0aW9uX3JlYWQoY291bnRlciwg
Y291bnQsICZkaXJlY3Rpb24pOworCQkJaWYgKGVycikKKwkJCQlyZXR1cm4gZXJyOwogCiAJCQlp
ZiAoZGlyZWN0aW9uID09IENPVU5URVJfQ09VTlRfRElSRUNUSU9OX0ZPUldBUkQpCi0JCQkJKmFj
dGlvbiA9IFFVQUQ4X1NZTkFQU0VfQUNUSU9OX1JJU0lOR19FREdFOworCQkJCSphY3Rpb24gPSBD
T1VOVEVSX1NZTkFQU0VfQUNUSU9OX1JJU0lOR19FREdFOwogCQkJZWxzZQotCQkJCSphY3Rpb24g
PSBRVUFEOF9TWU5BUFNFX0FDVElPTl9GQUxMSU5HX0VER0U7CisJCQkJKmFjdGlvbiA9IENPVU5U
RVJfU1lOQVBTRV9BQ1RJT05fRkFMTElOR19FREdFOwogCQl9CiAJCXJldHVybiAwOwotCWNhc2Ug
UVVBRDhfQ09VTlRfRlVOQ1RJT05fUVVBRFJBVFVSRV9YMjoKKwljYXNlIENPVU5URVJfRlVOQ1RJ
T05fUVVBRFJBVFVSRV9YMl9BOgogCQlpZiAoc3luYXBzZS0+c2lnbmFsLT5pZCA9PSBzaWduYWxf
YV9pZCkKLQkJCSphY3Rpb24gPSBRVUFEOF9TWU5BUFNFX0FDVElPTl9CT1RIX0VER0VTOworCQkJ
KmFjdGlvbiA9IENPVU5URVJfU1lOQVBTRV9BQ1RJT05fQk9USF9FREdFUzsKIAkJcmV0dXJuIDA7
Ci0JY2FzZSBRVUFEOF9DT1VOVF9GVU5DVElPTl9RVUFEUkFUVVJFX1g0OgotCQkqYWN0aW9uID0g
UVVBRDhfU1lOQVBTRV9BQ1RJT05fQk9USF9FREdFUzsKKwljYXNlIENPVU5URVJfRlVOQ1RJT05f
UVVBRFJBVFVSRV9YNDoKKwkJKmFjdGlvbiA9IENPVU5URVJfU1lOQVBTRV9BQ1RJT05fQk9USF9F
REdFUzsKIAkJcmV0dXJuIDA7CiAJZGVmYXVsdDoKIAkJLyogc2hvdWxkIG5ldmVyIHJlYWNoIHRo
aXMgcGF0aCAqLwpAQCAtMzgyLDkgKzM3Niw5IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgY291bnRl
cl9vcHMgcXVhZDhfb3BzID0gewogCS5zaWduYWxfcmVhZCA9IHF1YWQ4X3NpZ25hbF9yZWFkLAog
CS5jb3VudF9yZWFkID0gcXVhZDhfY291bnRfcmVhZCwKIAkuY291bnRfd3JpdGUgPSBxdWFkOF9j
b3VudF93cml0ZSwKLQkuZnVuY3Rpb25fZ2V0ID0gcXVhZDhfZnVuY3Rpb25fZ2V0LAotCS5mdW5j
dGlvbl9zZXQgPSBxdWFkOF9mdW5jdGlvbl9zZXQsCi0JLmFjdGlvbl9nZXQgPSBxdWFkOF9hY3Rp
b25fZ2V0CisJLmZ1bmN0aW9uX3JlYWQgPSBxdWFkOF9mdW5jdGlvbl9yZWFkLAorCS5mdW5jdGlv
bl93cml0ZSA9IHF1YWQ4X2Z1bmN0aW9uX3dyaXRlLAorCS5hY3Rpb25fcmVhZCA9IHF1YWQ4X2Fj
dGlvbl9yZWFkCiB9OwogCiBzdGF0aWMgY29uc3QgY2hhciAqY29uc3QgcXVhZDhfaW5kZXhfcG9s
YXJpdHlfbW9kZXNbXSA9IHsKQEAgLTM5Myw3ICszODcsOCBAQCBzdGF0aWMgY29uc3QgY2hhciAq
Y29uc3QgcXVhZDhfaW5kZXhfcG9sYXJpdHlfbW9kZXNbXSA9IHsKIH07CiAKIHN0YXRpYyBpbnQg
cXVhZDhfaW5kZXhfcG9sYXJpdHlfZ2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwK
LQlzdHJ1Y3QgY291bnRlcl9zaWduYWwgKnNpZ25hbCwgc2l6ZV90ICppbmRleF9wb2xhcml0eSkK
KwkJCQkgICAgc3RydWN0IGNvdW50ZXJfc2lnbmFsICpzaWduYWwsCisJCQkJICAgIHUzMiAqaW5k
ZXhfcG9sYXJpdHkpCiB7CiAJY29uc3Qgc3RydWN0IHF1YWQ4ICpjb25zdCBwcml2ID0gY291bnRl
ci0+cHJpdjsKIAljb25zdCBzaXplX3QgY2hhbm5lbF9pZCA9IHNpZ25hbC0+aWQgLSAxNjsKQEAg
LTQwNCw3ICszOTksOCBAQCBzdGF0aWMgaW50IHF1YWQ4X2luZGV4X3BvbGFyaXR5X2dldChzdHJ1
Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiB9CiAKIHN0YXRpYyBpbnQgcXVhZDhfaW5kZXhf
cG9sYXJpdHlfc2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQlzdHJ1Y3QgY291
bnRlcl9zaWduYWwgKnNpZ25hbCwgc2l6ZV90IGluZGV4X3BvbGFyaXR5KQorCQkJCSAgICBzdHJ1
Y3QgY291bnRlcl9zaWduYWwgKnNpZ25hbCwKKwkJCQkgICAgdTMyIGluZGV4X3BvbGFyaXR5KQog
ewogCXN0cnVjdCBxdWFkOCAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7CiAJY29uc3Qgc2l6
ZV90IGNoYW5uZWxfaWQgPSBzaWduYWwtPmlkIC0gMTY7CkBAIC00MjUsMjAgKzQyMSwxNCBAQCBz
dGF0aWMgaW50IHF1YWQ4X2luZGV4X3BvbGFyaXR5X3NldChzdHJ1Y3QgY291bnRlcl9kZXZpY2Ug
KmNvdW50ZXIsCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBzdHJ1Y3QgY291bnRlcl9zaWduYWxf
ZW51bV9leHQgcXVhZDhfaW5kZXhfcG9sX2VudW0gPSB7Ci0JLml0ZW1zID0gcXVhZDhfaW5kZXhf
cG9sYXJpdHlfbW9kZXMsCi0JLm51bV9pdGVtcyA9IEFSUkFZX1NJWkUocXVhZDhfaW5kZXhfcG9s
YXJpdHlfbW9kZXMpLAotCS5nZXQgPSBxdWFkOF9pbmRleF9wb2xhcml0eV9nZXQsCi0JLnNldCA9
IHF1YWQ4X2luZGV4X3BvbGFyaXR5X3NldAotfTsKLQogc3RhdGljIGNvbnN0IGNoYXIgKmNvbnN0
IHF1YWQ4X3N5bmNocm9ub3VzX21vZGVzW10gPSB7CiAJIm5vbi1zeW5jaHJvbm91cyIsCiAJInN5
bmNocm9ub3VzIgogfTsKIAogc3RhdGljIGludCBxdWFkOF9zeW5jaHJvbm91c19tb2RlX2dldChz
dHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0Jc3RydWN0IGNvdW50ZXJfc2lnbmFsICpz
aWduYWwsIHNpemVfdCAqc3luY2hyb25vdXNfbW9kZSkKKwkJCQkgICAgICBzdHJ1Y3QgY291bnRl
cl9zaWduYWwgKnNpZ25hbCwKKwkJCQkgICAgICB1MzIgKnN5bmNocm9ub3VzX21vZGUpCiB7CiAJ
Y29uc3Qgc3RydWN0IHF1YWQ4ICpjb25zdCBwcml2ID0gY291bnRlci0+cHJpdjsKIAljb25zdCBz
aXplX3QgY2hhbm5lbF9pZCA9IHNpZ25hbC0+aWQgLSAxNjsKQEAgLTQ0OSw3ICs0MzksOCBAQCBz
dGF0aWMgaW50IHF1YWQ4X3N5bmNocm9ub3VzX21vZGVfZ2V0KHN0cnVjdCBjb3VudGVyX2Rldmlj
ZSAqY291bnRlciwKIH0KIAogc3RhdGljIGludCBxdWFkOF9zeW5jaHJvbm91c19tb2RlX3NldChz
dHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0Jc3RydWN0IGNvdW50ZXJfc2lnbmFsICpz
aWduYWwsIHNpemVfdCBzeW5jaHJvbm91c19tb2RlKQorCQkJCSAgICAgIHN0cnVjdCBjb3VudGVy
X3NpZ25hbCAqc2lnbmFsLAorCQkJCSAgICAgIHUzMiBzeW5jaHJvbm91c19tb2RlKQogewogCXN0
cnVjdCBxdWFkOCAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7CiAJY29uc3Qgc2l6ZV90IGNo
YW5uZWxfaWQgPSBzaWduYWwtPmlkIC0gMTY7CkBAIC00NzYsMjIgKzQ2NywxOCBAQCBzdGF0aWMg
aW50IHF1YWQ4X3N5bmNocm9ub3VzX21vZGVfc2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291
bnRlciwKIAlyZXR1cm4gMDsKIH0KIAotc3RhdGljIHN0cnVjdCBjb3VudGVyX3NpZ25hbF9lbnVt
X2V4dCBxdWFkOF9zeW5fbW9kZV9lbnVtID0gewotCS5pdGVtcyA9IHF1YWQ4X3N5bmNocm9ub3Vz
X21vZGVzLAotCS5udW1faXRlbXMgPSBBUlJBWV9TSVpFKHF1YWQ4X3N5bmNocm9ub3VzX21vZGVz
KSwKLQkuZ2V0ID0gcXVhZDhfc3luY2hyb25vdXNfbW9kZV9nZXQsCi0JLnNldCA9IHF1YWQ4X3N5
bmNocm9ub3VzX21vZGVfc2V0Ci19OwotCi1zdGF0aWMgc3NpemVfdCBxdWFkOF9jb3VudF9mbG9v
cl9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQlzdHJ1Y3QgY291bnRlcl9j
b3VudCAqY291bnQsIHZvaWQgKnByaXZhdGUsIGNoYXIgKmJ1ZikKK3N0YXRpYyBpbnQgcXVhZDhf
Y291bnRfZmxvb3JfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJICBz
dHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHU2NCAqZmxvb3IpCiB7CiAJLyogT25seSBhIGZs
b29yIG9mIDAgaXMgc3VwcG9ydGVkICovCi0JcmV0dXJuIHNwcmludGYoYnVmLCAiMFxuIik7CisJ
KmZsb29yID0gMDsKKworCXJldHVybiAwOwogfQogCi1zdGF0aWMgaW50IHF1YWQ4X2NvdW50X21v
ZGVfZ2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQlzdHJ1Y3QgY291bnRlcl9j
b3VudCAqY291bnQsIHNpemVfdCAqY250X21vZGUpCitzdGF0aWMgaW50IHF1YWQ4X2NvdW50X21v
ZGVfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJIHN0cnVjdCBjb3Vu
dGVyX2NvdW50ICpjb3VudCwKKwkJCQkgZW51bSBjb3VudGVyX2NvdW50X21vZGUgKmNudF9tb2Rl
KQogewogCWNvbnN0IHN0cnVjdCBxdWFkOCAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7CiAK
QEAgLTUxNCwyNiArNTAxLDI4IEBAIHN0YXRpYyBpbnQgcXVhZDhfY291bnRfbW9kZV9nZXQoc3Ry
dWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAogCXJldHVybiAwOwogfQogCi1zdGF0aWMgaW50
IHF1YWQ4X2NvdW50X21vZGVfc2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQlz
dHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHNpemVfdCBjbnRfbW9kZSkKK3N0YXRpYyBpbnQg
cXVhZDhfY291bnRfbW9kZV93cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJ
CQkJICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCisJCQkJICBlbnVtIGNvdW50ZXJfY291
bnRfbW9kZSBjbnRfbW9kZSkKIHsKIAlzdHJ1Y3QgcXVhZDggKmNvbnN0IHByaXYgPSBjb3VudGVy
LT5wcml2OworCXVuc2lnbmVkIGludCBjb3VudF9tb2RlOwogCXVuc2lnbmVkIGludCBtb2RlX2Nm
ZzsKIAljb25zdCBpbnQgYmFzZV9vZmZzZXQgPSBwcml2LT5iYXNlICsgMiAqIGNvdW50LT5pZCAr
IDE7CiAKIAkvKiBNYXAgR2VuZXJpYyBDb3VudGVyIGNvdW50IG1vZGUgdG8gMTA0LVFVQUQtOCBj
b3VudCBtb2RlICovCiAJc3dpdGNoIChjbnRfbW9kZSkgewogCWNhc2UgQ09VTlRFUl9DT1VOVF9N
T0RFX05PUk1BTDoKLQkJY250X21vZGUgPSAwOworCQljb3VudF9tb2RlID0gMDsKIAkJYnJlYWs7
CiAJY2FzZSBDT1VOVEVSX0NPVU5UX01PREVfUkFOR0VfTElNSVQ6Ci0JCWNudF9tb2RlID0gMTsK
KwkJY291bnRfbW9kZSA9IDE7CiAJCWJyZWFrOwogCWNhc2UgQ09VTlRFUl9DT1VOVF9NT0RFX05P
Tl9SRUNZQ0xFOgotCQljbnRfbW9kZSA9IDI7CisJCWNvdW50X21vZGUgPSAyOwogCQlicmVhazsK
IAljYXNlIENPVU5URVJfQ09VTlRfTU9ERV9NT0RVTE9fTjoKLQkJY250X21vZGUgPSAzOworCQlj
b3VudF9tb2RlID0gMzsKIAkJYnJlYWs7CiAJZGVmYXVsdDoKIAkJLyogc2hvdWxkIG5ldmVyIHJl
YWNoIHRoaXMgcGF0aCAqLwpAQCAtNTQyLDEwICs1MzEsMTAgQEAgc3RhdGljIGludCBxdWFkOF9j
b3VudF9tb2RlX3NldChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAKIAltdXRleF9s
b2NrKCZwcml2LT5sb2NrKTsKIAotCXByaXYtPmNvdW50X21vZGVbY291bnQtPmlkXSA9IGNudF9t
b2RlOworCXByaXYtPmNvdW50X21vZGVbY291bnQtPmlkXSA9IGNvdW50X21vZGU7CiAKIAkvKiBT
ZXQgY291bnQgbW9kZSBjb25maWd1cmF0aW9uIHZhbHVlICovCi0JbW9kZV9jZmcgPSBjbnRfbW9k
ZSA8PCAxOworCW1vZGVfY2ZnID0gY291bnRfbW9kZSA8PCAxOwogCiAJLyogQWRkIHF1YWRyYXR1
cmUgbW9kZSBjb25maWd1cmF0aW9uICovCiAJaWYgKHByaXYtPnF1YWRyYXR1cmVfbW9kZVtjb3Vu
dC0+aWRdKQpAQCAtNTU5LDU2ICs1NDgsMzUgQEAgc3RhdGljIGludCBxdWFkOF9jb3VudF9tb2Rl
X3NldChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAJcmV0dXJuIDA7CiB9CiAKLXN0
YXRpYyBzdHJ1Y3QgY291bnRlcl9jb3VudF9lbnVtX2V4dCBxdWFkOF9jbnRfbW9kZV9lbnVtID0g
ewotCS5pdGVtcyA9IGNvdW50ZXJfY291bnRfbW9kZV9zdHIsCi0JLm51bV9pdGVtcyA9IEFSUkFZ
X1NJWkUoY291bnRlcl9jb3VudF9tb2RlX3N0ciksCi0JLmdldCA9IHF1YWQ4X2NvdW50X21vZGVf
Z2V0LAotCS5zZXQgPSBxdWFkOF9jb3VudF9tb2RlX3NldAotfTsKLQotc3RhdGljIHNzaXplX3Qg
cXVhZDhfY291bnRfZGlyZWN0aW9uX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVy
LAotCXN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgdm9pZCAqcHJpdiwgY2hhciAqYnVmKQot
ewotCWVudW0gY291bnRlcl9jb3VudF9kaXJlY3Rpb24gZGlyOwotCi0JcXVhZDhfZGlyZWN0aW9u
X2dldChjb3VudGVyLCBjb3VudCwgJmRpcik7Ci0KLQlyZXR1cm4gc3ByaW50ZihidWYsICIlc1xu
IiwgY291bnRlcl9jb3VudF9kaXJlY3Rpb25fc3RyW2Rpcl0pOwotfQotCi1zdGF0aWMgc3NpemVf
dCBxdWFkOF9jb3VudF9lbmFibGVfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIs
Ci0Jc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB2b2lkICpwcml2YXRlLCBjaGFyICpidWYp
CitzdGF0aWMgaW50IHF1YWQ4X2NvdW50X2VuYWJsZV9yZWFkKHN0cnVjdCBjb3VudGVyX2Rldmlj
ZSAqY291bnRlciwKKwkJCQkgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHU4ICplbmFi
bGUpCiB7CiAJY29uc3Qgc3RydWN0IHF1YWQ4ICpjb25zdCBwcml2ID0gY291bnRlci0+cHJpdjsK
IAotCXJldHVybiBzcHJpbnRmKGJ1ZiwgIiV1XG4iLCBwcml2LT5hYl9lbmFibGVbY291bnQtPmlk
XSk7CisJKmVuYWJsZSA9IHByaXYtPmFiX2VuYWJsZVtjb3VudC0+aWRdOworCisJcmV0dXJuIDA7
CiB9CiAKLXN0YXRpYyBzc2l6ZV90IHF1YWQ4X2NvdW50X2VuYWJsZV93cml0ZShzdHJ1Y3QgY291
bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0Jc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB2b2lk
ICpwcml2YXRlLCBjb25zdCBjaGFyICpidWYsIHNpemVfdCBsZW4pCitzdGF0aWMgaW50IHF1YWQ4
X2NvdW50X2VuYWJsZV93cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJ
ICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgdTggZW5hYmxlKQogewogCXN0cnVjdCBx
dWFkOCAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7CiAJY29uc3QgaW50IGJhc2Vfb2Zmc2V0
ID0gcHJpdi0+YmFzZSArIDIgKiBjb3VudC0+aWQ7Ci0JaW50IGVycjsKLQlib29sIGFiX2VuYWJs
ZTsKIAl1bnNpZ25lZCBpbnQgaW9yX2NmZzsKIAotCWVyciA9IGtzdHJ0b2Jvb2woYnVmLCAmYWJf
ZW5hYmxlKTsKLQlpZiAoZXJyKQotCQlyZXR1cm4gZXJyOwotCiAJbXV0ZXhfbG9jaygmcHJpdi0+
bG9jayk7CiAKLQlwcml2LT5hYl9lbmFibGVbY291bnQtPmlkXSA9IGFiX2VuYWJsZTsKKwlwcml2
LT5hYl9lbmFibGVbY291bnQtPmlkXSA9IGVuYWJsZTsKIAotCWlvcl9jZmcgPSBhYl9lbmFibGUg
fCBwcml2LT5wcmVzZXRfZW5hYmxlW2NvdW50LT5pZF0gPDwgMTsKKwlpb3JfY2ZnID0gZW5hYmxl
IHwgcHJpdi0+cHJlc2V0X2VuYWJsZVtjb3VudC0+aWRdIDw8IDE7CiAKIAkvKiBMb2FkIEkvTyBj
b250cm9sIGNvbmZpZ3VyYXRpb24gKi8KIAlvdXRiKFFVQUQ4X0NUUl9JT1IgfCBpb3JfY2ZnLCBi
YXNlX29mZnNldCArIDEpOwogCiAJbXV0ZXhfdW5sb2NrKCZwcml2LT5sb2NrKTsKIAotCXJldHVy
biBsZW47CisJcmV0dXJuIDA7CiB9CiAKIHN0YXRpYyBjb25zdCBjaGFyICpjb25zdCBxdWFkOF9u
b2lzZV9lcnJvcl9zdGF0ZXNbXSA9IHsKQEAgLTYxNyw3ICs1ODUsNyBAQCBzdGF0aWMgY29uc3Qg
Y2hhciAqY29uc3QgcXVhZDhfbm9pc2VfZXJyb3Jfc3RhdGVzW10gPSB7CiB9OwogCiBzdGF0aWMg
aW50IHF1YWQ4X2Vycm9yX25vaXNlX2dldChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIs
Ci0Jc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCBzaXplX3QgKm5vaXNlX2Vycm9yKQorCQkJ
CSBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHUzMiAqbm9pc2VfZXJyb3IpCiB7CiAJY29u
c3Qgc3RydWN0IHF1YWQ4ICpjb25zdCBwcml2ID0gY291bnRlci0+cHJpdjsKIAljb25zdCBpbnQg
YmFzZV9vZmZzZXQgPSBwcml2LT5iYXNlICsgMiAqIGNvdW50LT5pZCArIDE7CkBAIC02MjcsMTgg
KzU5NSwxNCBAQCBzdGF0aWMgaW50IHF1YWQ4X2Vycm9yX25vaXNlX2dldChzdHJ1Y3QgY291bnRl
cl9kZXZpY2UgKmNvdW50ZXIsCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBzdHJ1Y3QgY291bnRl
cl9jb3VudF9lbnVtX2V4dCBxdWFkOF9lcnJvcl9ub2lzZV9lbnVtID0gewotCS5pdGVtcyA9IHF1
YWQ4X25vaXNlX2Vycm9yX3N0YXRlcywKLQkubnVtX2l0ZW1zID0gQVJSQVlfU0laRShxdWFkOF9u
b2lzZV9lcnJvcl9zdGF0ZXMpLAotCS5nZXQgPSBxdWFkOF9lcnJvcl9ub2lzZV9nZXQKLX07Ci0K
LXN0YXRpYyBzc2l6ZV90IHF1YWQ4X2NvdW50X3ByZXNldF9yZWFkKHN0cnVjdCBjb3VudGVyX2Rl
dmljZSAqY291bnRlciwKLQlzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHZvaWQgKnByaXZh
dGUsIGNoYXIgKmJ1ZikKK3N0YXRpYyBpbnQgcXVhZDhfY291bnRfcHJlc2V0X3JlYWQoc3RydWN0
IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCSAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpj
b3VudCwgdTY0ICpwcmVzZXQpCiB7CiAJY29uc3Qgc3RydWN0IHF1YWQ4ICpjb25zdCBwcml2ID0g
Y291bnRlci0+cHJpdjsKIAotCXJldHVybiBzcHJpbnRmKGJ1ZiwgIiV1XG4iLCBwcml2LT5wcmVz
ZXRbY291bnQtPmlkXSk7CisJKnByZXNldCA9IHByaXYtPnByZXNldFtjb3VudC0+aWRdOworCisJ
cmV0dXJuIDA7CiB9CiAKIHN0YXRpYyB2b2lkIHF1YWQ4X3ByZXNldF9yZWdpc3Rlcl9zZXQoc3Ry
dWN0IHF1YWQ4ICpjb25zdCBwcml2LCBjb25zdCBpbnQgaWQsCkBAIC02NTcsMTYgKzYyMSwxMCBA
QCBzdGF0aWMgdm9pZCBxdWFkOF9wcmVzZXRfcmVnaXN0ZXJfc2V0KHN0cnVjdCBxdWFkOCAqY29u
c3QgcHJpdiwgY29uc3QgaW50IGlkLAogCQlvdXRiKHByZXNldCA+PiAoOCAqIGkpLCBiYXNlX29m
ZnNldCk7CiB9CiAKLXN0YXRpYyBzc2l6ZV90IHF1YWQ4X2NvdW50X3ByZXNldF93cml0ZShzdHJ1
Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0Jc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50
LCB2b2lkICpwcml2YXRlLCBjb25zdCBjaGFyICpidWYsIHNpemVfdCBsZW4pCitzdGF0aWMgaW50
IHF1YWQ4X2NvdW50X3ByZXNldF93cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIs
CisJCQkJICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgdTY0IHByZXNldCkKIHsKIAlz
dHJ1Y3QgcXVhZDggKmNvbnN0IHByaXYgPSBjb3VudGVyLT5wcml2OwotCXVuc2lnbmVkIGludCBw
cmVzZXQ7Ci0JaW50IHJldDsKLQotCXJldCA9IGtzdHJ0b3VpbnQoYnVmLCAwLCAmcHJlc2V0KTsK
LQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OwogCiAJLyogT25seSAyNC1iaXQgdmFsdWVzIGFyZSBz
dXBwb3J0ZWQgKi8KIAlpZiAocHJlc2V0ID4gMHhGRkZGRkYpCkBAIC02NzgsMTEgKzYzNiwxMSBA
QCBzdGF0aWMgc3NpemVfdCBxdWFkOF9jb3VudF9wcmVzZXRfd3JpdGUoc3RydWN0IGNvdW50ZXJf
ZGV2aWNlICpjb3VudGVyLAogCiAJbXV0ZXhfdW5sb2NrKCZwcml2LT5sb2NrKTsKIAotCXJldHVy
biBsZW47CisJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBzc2l6ZV90IHF1YWQ4X2NvdW50X2NlaWxp
bmdfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0Jc3RydWN0IGNvdW50ZXJf
Y291bnQgKmNvdW50LCB2b2lkICpwcml2YXRlLCBjaGFyICpidWYpCitzdGF0aWMgaW50IHF1YWQ4
X2NvdW50X2NlaWxpbmdfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJ
ICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgdTY0ICpjZWlsaW5nKQogewogCXN0cnVj
dCBxdWFkOCAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7CiAKQEAgLTY5MiwyNiArNjUwLDIz
IEBAIHN0YXRpYyBzc2l6ZV90IHF1YWQ4X2NvdW50X2NlaWxpbmdfcmVhZChzdHJ1Y3QgY291bnRl
cl9kZXZpY2UgKmNvdW50ZXIsCiAJc3dpdGNoIChwcml2LT5jb3VudF9tb2RlW2NvdW50LT5pZF0p
IHsKIAljYXNlIDE6CiAJY2FzZSAzOgotCQltdXRleF91bmxvY2soJnByaXYtPmxvY2spOwotCQly
ZXR1cm4gc3ByaW50ZihidWYsICIldVxuIiwgcHJpdi0+cHJlc2V0W2NvdW50LT5pZF0pOworCQkq
Y2VpbGluZyA9IHByaXYtPnByZXNldFtjb3VudC0+aWRdOworCQlicmVhazsKKwlkZWZhdWx0Ogor
CQkvKiBCeSBkZWZhdWx0IDB4MUZGRkZGRiAoMjUgYml0cyB1bnNpZ25lZCkgaXMgbWF4aW11bSBj
b3VudCAqLworCQkqY2VpbGluZyA9IDB4MUZGRkZGRjsKKwkJYnJlYWs7CiAJfQogCiAJbXV0ZXhf
dW5sb2NrKCZwcml2LT5sb2NrKTsKIAotCS8qIEJ5IGRlZmF1bHQgMHgxRkZGRkZGICgyNSBiaXRz
IHVuc2lnbmVkKSBpcyBtYXhpbXVtIGNvdW50ICovCi0JcmV0dXJuIHNwcmludGYoYnVmLCAiMzM1
NTQ0MzFcbiIpOworCXJldHVybiAwOwogfQogCi1zdGF0aWMgc3NpemVfdCBxdWFkOF9jb3VudF9j
ZWlsaW5nX3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQlzdHJ1Y3QgY291
bnRlcl9jb3VudCAqY291bnQsIHZvaWQgKnByaXZhdGUsIGNvbnN0IGNoYXIgKmJ1Ziwgc2l6ZV90
IGxlbikKK3N0YXRpYyBpbnQgcXVhZDhfY291bnRfY2VpbGluZ193cml0ZShzdHJ1Y3QgY291bnRl
cl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQs
IHU2NCBjZWlsaW5nKQogewogCXN0cnVjdCBxdWFkOCAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnBy
aXY7Ci0JdW5zaWduZWQgaW50IGNlaWxpbmc7Ci0JaW50IHJldDsKLQotCXJldCA9IGtzdHJ0b3Vp
bnQoYnVmLCAwLCAmY2VpbGluZyk7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKIAogCS8qIE9u
bHkgMjQtYml0IHZhbHVlcyBhcmUgc3VwcG9ydGVkICovCiAJaWYgKGNlaWxpbmcgPiAweEZGRkZG
RikKQEAgLTcyNSw3ICs2ODAsNyBAQCBzdGF0aWMgc3NpemVfdCBxdWFkOF9jb3VudF9jZWlsaW5n
X3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKIAljYXNlIDM6CiAJCXF1YWQ4
X3ByZXNldF9yZWdpc3Rlcl9zZXQocHJpdiwgY291bnQtPmlkLCBjZWlsaW5nKTsKIAkJbXV0ZXhf
dW5sb2NrKCZwcml2LT5sb2NrKTsKLQkJcmV0dXJuIGxlbjsKKwkJcmV0dXJuIDA7CiAJfQogCiAJ
bXV0ZXhfdW5sb2NrKCZwcml2LT5sb2NrKTsKQEAgLTczMywyNyArNjg4LDI1IEBAIHN0YXRpYyBz
c2l6ZV90IHF1YWQ4X2NvdW50X2NlaWxpbmdfd3JpdGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpj
b3VudGVyLAogCXJldHVybiAtRUlOVkFMOwogfQogCi1zdGF0aWMgc3NpemVfdCBxdWFkOF9jb3Vu
dF9wcmVzZXRfZW5hYmxlX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCXN0
cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgdm9pZCAqcHJpdmF0ZSwgY2hhciAqYnVmKQorc3Rh
dGljIGludCBxdWFkOF9jb3VudF9wcmVzZXRfZW5hYmxlX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2
aWNlICpjb3VudGVyLAorCQkJCQkgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKKwkJCQkJ
ICB1OCAqcHJlc2V0X2VuYWJsZSkKIHsKIAljb25zdCBzdHJ1Y3QgcXVhZDggKmNvbnN0IHByaXYg
PSBjb3VudGVyLT5wcml2OwogCi0JcmV0dXJuIHNwcmludGYoYnVmLCAiJXVcbiIsICFwcml2LT5w
cmVzZXRfZW5hYmxlW2NvdW50LT5pZF0pOworCSpwcmVzZXRfZW5hYmxlID0gIXByaXYtPnByZXNl
dF9lbmFibGVbY291bnQtPmlkXTsKKworCXJldHVybiAwOwogfQogCi1zdGF0aWMgc3NpemVfdCBx
dWFkOF9jb3VudF9wcmVzZXRfZW5hYmxlX3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291
bnRlciwKLQlzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHZvaWQgKnByaXZhdGUsIGNvbnN0
IGNoYXIgKmJ1Ziwgc2l6ZV90IGxlbikKK3N0YXRpYyBpbnQgcXVhZDhfY291bnRfcHJlc2V0X2Vu
YWJsZV93cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJCSAgIHN0cnVj
dCBjb3VudGVyX2NvdW50ICpjb3VudCwKKwkJCQkJICAgdTggcHJlc2V0X2VuYWJsZSkKIHsKIAlz
dHJ1Y3QgcXVhZDggKmNvbnN0IHByaXYgPSBjb3VudGVyLT5wcml2OwogCWNvbnN0IGludCBiYXNl
X29mZnNldCA9IHByaXYtPmJhc2UgKyAyICogY291bnQtPmlkICsgMTsKLQlib29sIHByZXNldF9l
bmFibGU7Ci0JaW50IHJldDsKIAl1bnNpZ25lZCBpbnQgaW9yX2NmZzsKIAotCXJldCA9IGtzdHJ0
b2Jvb2woYnVmLCAmcHJlc2V0X2VuYWJsZSk7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKLQog
CS8qIFByZXNldCBlbmFibGUgaXMgYWN0aXZlIGxvdyBpbiBJbnB1dC9PdXRwdXQgQ29udHJvbCBy
ZWdpc3RlciAqLwogCXByZXNldF9lbmFibGUgPSAhcHJlc2V0X2VuYWJsZTsKIApAQCAtNzYxLDI1
ICs3MTQsMjQgQEAgc3RhdGljIHNzaXplX3QgcXVhZDhfY291bnRfcHJlc2V0X2VuYWJsZV93cml0
ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAKIAlwcml2LT5wcmVzZXRfZW5hYmxl
W2NvdW50LT5pZF0gPSBwcmVzZXRfZW5hYmxlOwogCi0JaW9yX2NmZyA9IHByaXYtPmFiX2VuYWJs
ZVtjb3VudC0+aWRdIHwgKHVuc2lnbmVkIGludClwcmVzZXRfZW5hYmxlIDw8IDE7CisJaW9yX2Nm
ZyA9IHByaXYtPmFiX2VuYWJsZVtjb3VudC0+aWRdIHwgcHJlc2V0X2VuYWJsZSA8PCAxOwogCiAJ
LyogTG9hZCBJL08gY29udHJvbCBjb25maWd1cmF0aW9uIHRvIElucHV0IC8gT3V0cHV0IENvbnRy
b2wgUmVnaXN0ZXIgKi8KIAlvdXRiKFFVQUQ4X0NUUl9JT1IgfCBpb3JfY2ZnLCBiYXNlX29mZnNl
dCk7CiAKIAltdXRleF91bmxvY2soJnByaXYtPmxvY2spOwogCi0JcmV0dXJuIGxlbjsKKwlyZXR1
cm4gMDsKIH0KIAotc3RhdGljIHNzaXplX3QgcXVhZDhfc2lnbmFsX2NhYmxlX2ZhdWx0X3JlYWQo
c3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCQkgICAgIHN0cnVjdCBjb3VudGVy
X3NpZ25hbCAqc2lnbmFsLAotCQkJCQkgICAgIHZvaWQgKnByaXZhdGUsIGNoYXIgKmJ1ZikKK3N0
YXRpYyBpbnQgcXVhZDhfc2lnbmFsX2NhYmxlX2ZhdWx0X3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2
aWNlICpjb3VudGVyLAorCQkJCQkgc3RydWN0IGNvdW50ZXJfc2lnbmFsICpzaWduYWwsCisJCQkJ
CSB1OCAqY2FibGVfZmF1bHQpCiB7CiAJc3RydWN0IHF1YWQ4ICpjb25zdCBwcml2ID0gY291bnRl
ci0+cHJpdjsKIAljb25zdCBzaXplX3QgY2hhbm5lbF9pZCA9IHNpZ25hbC0+aWQgLyAyOwogCWJv
b2wgZGlzYWJsZWQ7CiAJdW5zaWduZWQgaW50IHN0YXR1czsKLQl1bnNpZ25lZCBpbnQgZmF1bHQ7
CiAKIAltdXRleF9sb2NrKCZwcml2LT5sb2NrKTsKIApAQCAtNzk2LDM2ICs3NDgsMzEgQEAgc3Rh
dGljIHNzaXplX3QgcXVhZDhfc2lnbmFsX2NhYmxlX2ZhdWx0X3JlYWQoc3RydWN0IGNvdW50ZXJf
ZGV2aWNlICpjb3VudGVyLAogCW11dGV4X3VubG9jaygmcHJpdi0+bG9jayk7CiAKIAkvKiBNYXNr
IHJlc3BlY3RpdmUgY2hhbm5lbCBhbmQgaW52ZXJ0IGxvZ2ljICovCi0JZmF1bHQgPSAhKHN0YXR1
cyAmIEJJVChjaGFubmVsX2lkKSk7CisJKmNhYmxlX2ZhdWx0ID0gIShzdGF0dXMgJiBCSVQoY2hh
bm5lbF9pZCkpOwogCi0JcmV0dXJuIHNwcmludGYoYnVmLCAiJXVcbiIsIGZhdWx0KTsKKwlyZXR1
cm4gMDsKIH0KIAotc3RhdGljIHNzaXplX3QgcXVhZDhfc2lnbmFsX2NhYmxlX2ZhdWx0X2VuYWJs
ZV9yZWFkKAotCXN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwgc3RydWN0IGNvdW50ZXJf
c2lnbmFsICpzaWduYWwsCi0Jdm9pZCAqcHJpdmF0ZSwgY2hhciAqYnVmKQorc3RhdGljIGludCBx
dWFkOF9zaWduYWxfY2FibGVfZmF1bHRfZW5hYmxlX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNl
ICpjb3VudGVyLAorCQkJCQkJc3RydWN0IGNvdW50ZXJfc2lnbmFsICpzaWduYWwsCisJCQkJCQl1
OCAqZW5hYmxlKQogewogCWNvbnN0IHN0cnVjdCBxdWFkOCAqY29uc3QgcHJpdiA9IGNvdW50ZXIt
PnByaXY7CiAJY29uc3Qgc2l6ZV90IGNoYW5uZWxfaWQgPSBzaWduYWwtPmlkIC8gMjsKLQljb25z
dCB1bnNpZ25lZCBpbnQgZW5iID0gISEocHJpdi0+Y2FibGVfZmF1bHRfZW5hYmxlICYgQklUKGNo
YW5uZWxfaWQpKTsKIAotCXJldHVybiBzcHJpbnRmKGJ1ZiwgIiV1XG4iLCBlbmIpOworCSplbmFi
bGUgPSAhIShwcml2LT5jYWJsZV9mYXVsdF9lbmFibGUgJiBCSVQoY2hhbm5lbF9pZCkpOworCisJ
cmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBzc2l6ZV90IHF1YWQ4X3NpZ25hbF9jYWJsZV9mYXVsdF9l
bmFibGVfd3JpdGUoCi0Jc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLCBzdHJ1Y3QgY291
bnRlcl9zaWduYWwgKnNpZ25hbCwKLQl2b2lkICpwcml2YXRlLCBjb25zdCBjaGFyICpidWYsIHNp
emVfdCBsZW4pCitzdGF0aWMgaW50IHF1YWQ4X3NpZ25hbF9jYWJsZV9mYXVsdF9lbmFibGVfd3Jp
dGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCQkJIHN0cnVjdCBjb3VudGVy
X3NpZ25hbCAqc2lnbmFsLAorCQkJCQkJIHU4IGVuYWJsZSkKIHsKIAlzdHJ1Y3QgcXVhZDggKmNv
bnN0IHByaXYgPSBjb3VudGVyLT5wcml2OwogCWNvbnN0IHNpemVfdCBjaGFubmVsX2lkID0gc2ln
bmFsLT5pZCAvIDI7Ci0JYm9vbCBlbmFibGU7Ci0JaW50IHJldDsKIAl1bnNpZ25lZCBpbnQgY2Fi
bGVfZmF1bHRfZW5hYmxlOwogCi0JcmV0ID0ga3N0cnRvYm9vbChidWYsICZlbmFibGUpOwotCWlm
IChyZXQpCi0JCXJldHVybiByZXQ7Ci0KIAltdXRleF9sb2NrKCZwcml2LT5sb2NrKTsKIAogCWlm
IChlbmFibGUpCkBAIC04NDAsMzEgKzc4NywyNyBAQCBzdGF0aWMgc3NpemVfdCBxdWFkOF9zaWdu
YWxfY2FibGVfZmF1bHRfZW5hYmxlX3dyaXRlKAogCiAJbXV0ZXhfdW5sb2NrKCZwcml2LT5sb2Nr
KTsKIAotCXJldHVybiBsZW47CisJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBzc2l6ZV90IHF1YWQ4
X3NpZ25hbF9mY2tfcHJlc2NhbGVyX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVy
LAotCXN0cnVjdCBjb3VudGVyX3NpZ25hbCAqc2lnbmFsLCB2b2lkICpwcml2YXRlLCBjaGFyICpi
dWYpCitzdGF0aWMgaW50IHF1YWQ4X3NpZ25hbF9mY2tfcHJlc2NhbGVyX3JlYWQoc3RydWN0IGNv
dW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCQkgICBzdHJ1Y3QgY291bnRlcl9zaWduYWwgKnNp
Z25hbCwKKwkJCQkJICAgdTggKnByZXNjYWxlcikKIHsKIAljb25zdCBzdHJ1Y3QgcXVhZDggKmNv
bnN0IHByaXYgPSBjb3VudGVyLT5wcml2OwotCWNvbnN0IHNpemVfdCBjaGFubmVsX2lkID0gc2ln
bmFsLT5pZCAvIDI7CiAKLQlyZXR1cm4gc3ByaW50ZihidWYsICIldVxuIiwgcHJpdi0+ZmNrX3By
ZXNjYWxlcltjaGFubmVsX2lkXSk7CisJKnByZXNjYWxlciA9IHByaXYtPmZja19wcmVzY2FsZXJb
c2lnbmFsLT5pZCAvIDJdOworCisJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBzc2l6ZV90IHF1YWQ4
X3NpZ25hbF9mY2tfcHJlc2NhbGVyX3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRl
ciwKLQlzdHJ1Y3QgY291bnRlcl9zaWduYWwgKnNpZ25hbCwgdm9pZCAqcHJpdmF0ZSwgY29uc3Qg
Y2hhciAqYnVmLAotCXNpemVfdCBsZW4pCitzdGF0aWMgaW50IHF1YWQ4X3NpZ25hbF9mY2tfcHJl
c2NhbGVyX3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkJICAgIHN0
cnVjdCBjb3VudGVyX3NpZ25hbCAqc2lnbmFsLAorCQkJCQkgICAgdTggcHJlc2NhbGVyKQogewog
CXN0cnVjdCBxdWFkOCAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7CiAJY29uc3Qgc2l6ZV90
IGNoYW5uZWxfaWQgPSBzaWduYWwtPmlkIC8gMjsKIAljb25zdCBpbnQgYmFzZV9vZmZzZXQgPSBw
cml2LT5iYXNlICsgMiAqIGNoYW5uZWxfaWQ7Ci0JdTggcHJlc2NhbGVyOwotCWludCByZXQ7Ci0K
LQlyZXQgPSBrc3RydG91OChidWYsIDAsICZwcmVzY2FsZXIpOwotCWlmIChyZXQpCi0JCXJldHVy
biByZXQ7CiAKIAltdXRleF9sb2NrKCZwcml2LT5sb2NrKTsKIApAQCAtODgwLDMxICs4MjMsMzAg
QEAgc3RhdGljIHNzaXplX3QgcXVhZDhfc2lnbmFsX2Zja19wcmVzY2FsZXJfd3JpdGUoc3RydWN0
IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAogCiAJbXV0ZXhfdW5sb2NrKCZwcml2LT5sb2NrKTsK
IAotCXJldHVybiBsZW47CisJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBjb25zdCBzdHJ1Y3QgY291
bnRlcl9zaWduYWxfZXh0IHF1YWQ4X3NpZ25hbF9leHRbXSA9IHsKLQl7Ci0JCS5uYW1lID0gImNh
YmxlX2ZhdWx0IiwKLQkJLnJlYWQgPSBxdWFkOF9zaWduYWxfY2FibGVfZmF1bHRfcmVhZAotCX0s
Ci0JewotCQkubmFtZSA9ICJjYWJsZV9mYXVsdF9lbmFibGUiLAotCQkucmVhZCA9IHF1YWQ4X3Np
Z25hbF9jYWJsZV9mYXVsdF9lbmFibGVfcmVhZCwKLQkJLndyaXRlID0gcXVhZDhfc2lnbmFsX2Nh
YmxlX2ZhdWx0X2VuYWJsZV93cml0ZQotCX0sCi0JewotCQkubmFtZSA9ICJmaWx0ZXJfY2xvY2tf
cHJlc2NhbGVyIiwKLQkJLnJlYWQgPSBxdWFkOF9zaWduYWxfZmNrX3ByZXNjYWxlcl9yZWFkLAot
CQkud3JpdGUgPSBxdWFkOF9zaWduYWxfZmNrX3ByZXNjYWxlcl93cml0ZQotCX0KK3N0YXRpYyBz
dHJ1Y3QgY291bnRlcl9jb21wIHF1YWQ4X3NpZ25hbF9leHRbXSA9IHsKKwlDT1VOVEVSX0NPTVBf
U0lHTkFMX0JPT0woImNhYmxlX2ZhdWx0IiwgcXVhZDhfc2lnbmFsX2NhYmxlX2ZhdWx0X3JlYWQs
CisJCQkJIE5VTEwpLAorCUNPVU5URVJfQ09NUF9TSUdOQUxfQk9PTCgiY2FibGVfZmF1bHRfZW5h
YmxlIiwKKwkJCQkgcXVhZDhfc2lnbmFsX2NhYmxlX2ZhdWx0X2VuYWJsZV9yZWFkLAorCQkJCSBx
dWFkOF9zaWduYWxfY2FibGVfZmF1bHRfZW5hYmxlX3dyaXRlKSwKKwlDT1VOVEVSX0NPTVBfU0lH
TkFMX1U4KCJmaWx0ZXJfY2xvY2tfcHJlc2NhbGVyIiwKKwkJCSAgICAgICBxdWFkOF9zaWduYWxf
ZmNrX3ByZXNjYWxlcl9yZWFkLAorCQkJICAgICAgIHF1YWQ4X3NpZ25hbF9mY2tfcHJlc2NhbGVy
X3dyaXRlKQogfTsKIAotc3RhdGljIGNvbnN0IHN0cnVjdCBjb3VudGVyX3NpZ25hbF9leHQgcXVh
ZDhfaW5kZXhfZXh0W10gPSB7Ci0JQ09VTlRFUl9TSUdOQUxfRU5VTSgiaW5kZXhfcG9sYXJpdHki
LCAmcXVhZDhfaW5kZXhfcG9sX2VudW0pLAotCUNPVU5URVJfU0lHTkFMX0VOVU1fQVZBSUxBQkxF
KCJpbmRleF9wb2xhcml0eSIsCSZxdWFkOF9pbmRleF9wb2xfZW51bSksCi0JQ09VTlRFUl9TSUdO
QUxfRU5VTSgic3luY2hyb25vdXNfbW9kZSIsICZxdWFkOF9zeW5fbW9kZV9lbnVtKSwKLQlDT1VO
VEVSX1NJR05BTF9FTlVNX0FWQUlMQUJMRSgic3luY2hyb25vdXNfbW9kZSIsICZxdWFkOF9zeW5f
bW9kZV9lbnVtKQorc3RhdGljIERFRklORV9DT1VOVEVSX0VOVU0ocXVhZDhfaW5kZXhfcG9sX2Vu
dW0sIHF1YWQ4X2luZGV4X3BvbGFyaXR5X21vZGVzKTsKK3N0YXRpYyBERUZJTkVfQ09VTlRFUl9F
TlVNKHF1YWQ4X3N5bmNoX21vZGVfZW51bSwgcXVhZDhfc3luY2hyb25vdXNfbW9kZXMpOworCitz
dGF0aWMgc3RydWN0IGNvdW50ZXJfY29tcCBxdWFkOF9pbmRleF9leHRbXSA9IHsKKwlDT1VOVEVS
X0NPTVBfU0lHTkFMX0VOVU0oImluZGV4X3BvbGFyaXR5IiwgcXVhZDhfaW5kZXhfcG9sYXJpdHlf
Z2V0LAorCQkJCSBxdWFkOF9pbmRleF9wb2xhcml0eV9zZXQsCisJCQkJIHF1YWQ4X2luZGV4X3Bv
bF9lbnVtKSwKKwlDT1VOVEVSX0NPTVBfU0lHTkFMX0VOVU0oInN5bmNocm9ub3VzX21vZGUiLCBx
dWFkOF9zeW5jaHJvbm91c19tb2RlX2dldCwKKwkJCQkgcXVhZDhfc3luY2hyb25vdXNfbW9kZV9z
ZXQsCisJCQkJIHF1YWQ4X3N5bmNoX21vZGVfZW51bSksCiB9OwogCiAjZGVmaW5lIFFVQUQ4X1FV
QURfU0lHTkFMKF9pZCwgX25hbWUpIHsJCVwKQEAgLTk3MywzOSArOTE1LDMwIEBAIHN0YXRpYyBz
dHJ1Y3QgY291bnRlcl9zeW5hcHNlIHF1YWQ4X2NvdW50X3N5bmFwc2VzW11bM10gPSB7CiAJUVVB
RDhfQ09VTlRfU1lOQVBTRVMoNiksIFFVQUQ4X0NPVU5UX1NZTkFQU0VTKDcpCiB9OwogCi1zdGF0
aWMgY29uc3Qgc3RydWN0IGNvdW50ZXJfY291bnRfZXh0IHF1YWQ4X2NvdW50X2V4dFtdID0gewot
CXsKLQkJLm5hbWUgPSAiY2VpbGluZyIsCi0JCS5yZWFkID0gcXVhZDhfY291bnRfY2VpbGluZ19y
ZWFkLAotCQkud3JpdGUgPSBxdWFkOF9jb3VudF9jZWlsaW5nX3dyaXRlCi0JfSwKLQl7Ci0JCS5u
YW1lID0gImZsb29yIiwKLQkJLnJlYWQgPSBxdWFkOF9jb3VudF9mbG9vcl9yZWFkCi0JfSwKLQlD
T1VOVEVSX0NPVU5UX0VOVU0oImNvdW50X21vZGUiLCAmcXVhZDhfY250X21vZGVfZW51bSksCi0J
Q09VTlRFUl9DT1VOVF9FTlVNX0FWQUlMQUJMRSgiY291bnRfbW9kZSIsICZxdWFkOF9jbnRfbW9k
ZV9lbnVtKSwKLQl7Ci0JCS5uYW1lID0gImRpcmVjdGlvbiIsCi0JCS5yZWFkID0gcXVhZDhfY291
bnRfZGlyZWN0aW9uX3JlYWQKLQl9LAotCXsKLQkJLm5hbWUgPSAiZW5hYmxlIiwKLQkJLnJlYWQg
PSBxdWFkOF9jb3VudF9lbmFibGVfcmVhZCwKLQkJLndyaXRlID0gcXVhZDhfY291bnRfZW5hYmxl
X3dyaXRlCi0JfSwKLQlDT1VOVEVSX0NPVU5UX0VOVU0oImVycm9yX25vaXNlIiwgJnF1YWQ4X2Vy
cm9yX25vaXNlX2VudW0pLAotCUNPVU5URVJfQ09VTlRfRU5VTV9BVkFJTEFCTEUoImVycm9yX25v
aXNlIiwgJnF1YWQ4X2Vycm9yX25vaXNlX2VudW0pLAotCXsKLQkJLm5hbWUgPSAicHJlc2V0IiwK
LQkJLnJlYWQgPSBxdWFkOF9jb3VudF9wcmVzZXRfcmVhZCwKLQkJLndyaXRlID0gcXVhZDhfY291
bnRfcHJlc2V0X3dyaXRlCi0JfSwKLQl7Ci0JCS5uYW1lID0gInByZXNldF9lbmFibGUiLAotCQku
cmVhZCA9IHF1YWQ4X2NvdW50X3ByZXNldF9lbmFibGVfcmVhZCwKLQkJLndyaXRlID0gcXVhZDhf
Y291bnRfcHJlc2V0X2VuYWJsZV93cml0ZQotCX0KK3N0YXRpYyBjb25zdCBlbnVtIGNvdW50ZXJf
Y291bnRfbW9kZSBxdWFkOF9jbnRfbW9kZXNbXSA9IHsKKwlDT1VOVEVSX0NPVU5UX01PREVfTk9S
TUFMLAorCUNPVU5URVJfQ09VTlRfTU9ERV9SQU5HRV9MSU1JVCwKKwlDT1VOVEVSX0NPVU5UX01P
REVfTk9OX1JFQ1lDTEUsCisJQ09VTlRFUl9DT1VOVF9NT0RFX01PRFVMT19OLAorfTsKKworc3Rh
dGljIERFRklORV9DT1VOVEVSX0FWQUlMQUJMRShxdWFkOF9jb3VudF9tb2RlX2F2YWlsYWJsZSwg
cXVhZDhfY250X21vZGVzKTsKKworc3RhdGljIERFRklORV9DT1VOVEVSX0VOVU0ocXVhZDhfZXJy
b3Jfbm9pc2VfZW51bSwgcXVhZDhfbm9pc2VfZXJyb3Jfc3RhdGVzKTsKKworc3RhdGljIHN0cnVj
dCBjb3VudGVyX2NvbXAgcXVhZDhfY291bnRfZXh0W10gPSB7CisJQ09VTlRFUl9DT01QX0NFSUxJ
TkcocXVhZDhfY291bnRfY2VpbGluZ19yZWFkLAorCQkJICAgICBxdWFkOF9jb3VudF9jZWlsaW5n
X3dyaXRlKSwKKwlDT1VOVEVSX0NPTVBfRkxPT1IocXVhZDhfY291bnRfZmxvb3JfcmVhZCwgTlVM
TCksCisJQ09VTlRFUl9DT01QX0NPVU5UX01PREUocXVhZDhfY291bnRfbW9kZV9yZWFkLCBxdWFk
OF9jb3VudF9tb2RlX3dyaXRlLAorCQkJCXF1YWQ4X2NvdW50X21vZGVfYXZhaWxhYmxlKSwKKwlD
T1VOVEVSX0NPTVBfRElSRUNUSU9OKHF1YWQ4X2RpcmVjdGlvbl9yZWFkKSwKKwlDT1VOVEVSX0NP
TVBfRU5BQkxFKHF1YWQ4X2NvdW50X2VuYWJsZV9yZWFkLCBxdWFkOF9jb3VudF9lbmFibGVfd3Jp
dGUpLAorCUNPVU5URVJfQ09NUF9DT1VOVF9FTlVNKCJlcnJvcl9ub2lzZSIsIHF1YWQ4X2Vycm9y
X25vaXNlX2dldCwgTlVMTCwKKwkJCQlxdWFkOF9lcnJvcl9ub2lzZV9lbnVtKSwKKwlDT1VOVEVS
X0NPTVBfUFJFU0VUKHF1YWQ4X2NvdW50X3ByZXNldF9yZWFkLCBxdWFkOF9jb3VudF9wcmVzZXRf
d3JpdGUpLAorCUNPVU5URVJfQ09NUF9QUkVTRVRfRU5BQkxFKHF1YWQ4X2NvdW50X3ByZXNldF9l
bmFibGVfcmVhZCwKKwkJCQkgICBxdWFkOF9jb3VudF9wcmVzZXRfZW5hYmxlX3dyaXRlKSwKIH07
CiAKICNkZWZpbmUgUVVBRDhfQ09VTlQoX2lkLCBfY250bmFtZSkgewkJCQkJXApkaWZmIC0tZ2l0
IGEvZHJpdmVycy9jb3VudGVyL01ha2VmaWxlIGIvZHJpdmVycy9jb3VudGVyL01ha2VmaWxlCmlu
ZGV4IDE5NzQyZTZmNWUzZS4uMWFiN2UwODdmZGMyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2NvdW50
ZXIvTWFrZWZpbGUKKysrIGIvZHJpdmVycy9jb3VudGVyL01ha2VmaWxlCkBAIC00LDYgKzQsNyBA
QAogIwogCiBvYmotJChDT05GSUdfQ09VTlRFUikgKz0gY291bnRlci5vCitjb3VudGVyLXkgOj0g
Y291bnRlci1jb3JlLm8gY291bnRlci1zeXNmcy5vCiAKIG9iai0kKENPTkZJR18xMDRfUVVBRF84
KQkrPSAxMDQtcXVhZC04Lm8KIG9iai0kKENPTkZJR19JTlRFUlJVUFRfQ05UKQkJKz0gaW50ZXJy
dXB0LWNudC5vCmRpZmYgLS1naXQgYS9kcml2ZXJzL2NvdW50ZXIvY291bnRlci1jb3JlLmMgYi9k
cml2ZXJzL2NvdW50ZXIvY291bnRlci1jb3JlLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXgg
MDAwMDAwMDAwMDAwLi4xNWY3MzVlZjI5NmUKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2Nv
dW50ZXIvY291bnRlci1jb3JlLmMKQEAgLTAsMCArMSwxNDUgQEAKKy8vIFNQRFgtTGljZW5zZS1J
ZGVudGlmaWVyOiBHUEwtMi4wCisvKgorICogR2VuZXJpYyBDb3VudGVyIGludGVyZmFjZQorICog
Q29weXJpZ2h0IChDKSAyMDIwIFdpbGxpYW0gQnJlYXRoaXR0IEdyYXkKKyAqLworI2luY2x1ZGUg
PGxpbnV4L2NvdW50ZXIuaD4KKyNpbmNsdWRlIDxsaW51eC9kZXZpY2UuaD4KKyNpbmNsdWRlIDxs
aW51eC9leHBvcnQuaD4KKyNpbmNsdWRlIDxsaW51eC9nZnAuaD4KKyNpbmNsdWRlIDxsaW51eC9p
ZHIuaD4KKyNpbmNsdWRlIDxsaW51eC9pbml0Lmg+CisjaW5jbHVkZSA8bGludXgvbW9kdWxlLmg+
CisKKyNpbmNsdWRlICJjb3VudGVyLXN5c2ZzLmgiCisKKy8qIFByb3ZpZGVzIGEgdW5pcXVlIElE
IGZvciBlYWNoIGNvdW50ZXIgZGV2aWNlICovCitzdGF0aWMgREVGSU5FX0lEQShjb3VudGVyX2lk
YSk7CisKK3N0YXRpYyB2b2lkIGNvdW50ZXJfZGV2aWNlX3JlbGVhc2Uoc3RydWN0IGRldmljZSAq
ZGV2KQoreworCXN0cnVjdCBjb3VudGVyX2RldmljZSAqY29uc3QgY291bnRlciA9IGRldl9nZXRf
ZHJ2ZGF0YShkZXYpOworCisJY291bnRlcl9jaHJkZXZfcmVtb3ZlKGNvdW50ZXIpOworCWlkYV9m
cmVlKCZjb3VudGVyX2lkYSwgZGV2LT5pZCk7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgZGV2aWNlX3R5
cGUgY291bnRlcl9kZXZpY2VfdHlwZSA9IHsKKwkubmFtZSA9ICJjb3VudGVyX2RldmljZSIsCisJ
LnJlbGVhc2UgPSBjb3VudGVyX2RldmljZV9yZWxlYXNlLAorfTsKKworc3RhdGljIHN0cnVjdCBi
dXNfdHlwZSBjb3VudGVyX2J1c190eXBlID0geworCS5uYW1lID0gImNvdW50ZXIiLAorCS5kZXZf
bmFtZSA9ICJjb3VudGVyIiwKK307CisKKy8qKgorICogY291bnRlcl9yZWdpc3RlciAtIHJlZ2lz
dGVyIENvdW50ZXIgdG8gdGhlIHN5c3RlbQorICogQGNvdW50ZXI6CXBvaW50ZXIgdG8gQ291bnRl
ciB0byByZWdpc3RlcgorICoKKyAqIFRoaXMgZnVuY3Rpb24gcmVnaXN0ZXJzIGEgQ291bnRlciB0
byB0aGUgc3lzdGVtLiBBIHN5c2ZzICJjb3VudGVyIiBkaXJlY3RvcnkKKyAqIHdpbGwgYmUgY3Jl
YXRlZCBhbmQgcG9wdWxhdGVkIHdpdGggc3lzZnMgYXR0cmlidXRlcyBjb3JyZWxhdGluZyB3aXRo
IHRoZQorICogQ291bnRlciBTaWduYWxzLCBTeW5hcHNlcywgYW5kIENvdW50cyByZXNwZWN0aXZl
bHkuCisgKi8KK2ludCBjb3VudGVyX3JlZ2lzdGVyKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY29u
c3QgY291bnRlcikKK3sKKwlzdHJ1Y3QgZGV2aWNlICpjb25zdCBkZXYgPSAmY291bnRlci0+ZGV2
OworCWludCBpZDsKKwlpbnQgZXJyOworCisJLyogQWNxdWlyZSB1bmlxdWUgSUQgKi8KKwlpZCA9
IGlkYV9hbGxvYygmY291bnRlcl9pZGEsIEdGUF9LRVJORUwpOworCWlmIChpZCA8IDApCisJCXJl
dHVybiBpZDsKKworCS8qIENvbmZpZ3VyZSBkZXZpY2Ugc3RydWN0dXJlIGZvciBDb3VudGVyICov
CisJZGV2LT5pZCA9IGlkOworCWRldi0+dHlwZSA9ICZjb3VudGVyX2RldmljZV90eXBlOworCWRl
di0+YnVzID0gJmNvdW50ZXJfYnVzX3R5cGU7CisJaWYgKGNvdW50ZXItPnBhcmVudCkgeworCQlk
ZXYtPnBhcmVudCA9IGNvdW50ZXItPnBhcmVudDsKKwkJZGV2LT5vZl9ub2RlID0gY291bnRlci0+
cGFyZW50LT5vZl9ub2RlOworCX0KKwlkZXZpY2VfaW5pdGlhbGl6ZShkZXYpOworCWRldl9zZXRf
ZHJ2ZGF0YShkZXYsIGNvdW50ZXIpOworCisJLyogQWRkIENvdW50ZXIgc3lzZnMgYXR0cmlidXRl
cyAqLworCWVyciA9IGNvdW50ZXJfc3lzZnNfYWRkKGNvdW50ZXIpOworCWlmIChlcnIgPCAwKQor
CQlnb3RvIGVycl9mcmVlX2lkOworCisJLyogQWRkIGRldmljZSB0byBzeXN0ZW0gKi8KKwllcnIg
PSBkZXZpY2VfYWRkKGRldik7CisJaWYgKGVyciA8IDApCisJCWdvdG8gZXJyX2ZyZWVfaWQ7CisK
KwlyZXR1cm4gMDsKKworZXJyX2ZyZWVfaWQ6CisJcHV0X2RldmljZShkZXYpOworCXJldHVybiBl
cnI7Cit9CitFWFBPUlRfU1lNQk9MX0dQTChjb3VudGVyX3JlZ2lzdGVyKTsKKworLyoqCisgKiBj
b3VudGVyX3VucmVnaXN0ZXIgLSB1bnJlZ2lzdGVyIENvdW50ZXIgZnJvbSB0aGUgc3lzdGVtCisg
KiBAY291bnRlcjoJcG9pbnRlciB0byBDb3VudGVyIHRvIHVucmVnaXN0ZXIKKyAqCisgKiBUaGUg
Q291bnRlciBpcyB1bnJlZ2lzdGVyZWQgZnJvbSB0aGUgc3lzdGVtLgorICovCit2b2lkIGNvdW50
ZXJfdW5yZWdpc3RlcihzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvbnN0IGNvdW50ZXIpCit7CisJ
aWYgKCFjb3VudGVyKQorCQlyZXR1cm47CisKKwlkZXZpY2VfdW5yZWdpc3RlcigmY291bnRlci0+
ZGV2KTsKK30KK0VYUE9SVF9TWU1CT0xfR1BMKGNvdW50ZXJfdW5yZWdpc3Rlcik7CisKK3N0YXRp
YyB2b2lkIGRldm1fY291bnRlcl9yZWxlYXNlKHZvaWQgKmNvdW50ZXIpCit7CisJY291bnRlcl91
bnJlZ2lzdGVyKGNvdW50ZXIpOworfQorCisvKioKKyAqIGRldm1fY291bnRlcl9yZWdpc3RlciAt
IFJlc291cmNlLW1hbmFnZWQgY291bnRlcl9yZWdpc3RlcgorICogQGRldjoJZGV2aWNlIHRvIGFs
bG9jYXRlIGNvdW50ZXJfZGV2aWNlIGZvcgorICogQGNvdW50ZXI6CXBvaW50ZXIgdG8gQ291bnRl
ciB0byByZWdpc3RlcgorICoKKyAqIE1hbmFnZWQgY291bnRlcl9yZWdpc3Rlci4gVGhlIENvdW50
ZXIgcmVnaXN0ZXJlZCB3aXRoIHRoaXMgZnVuY3Rpb24gaXMKKyAqIGF1dG9tYXRpY2FsbHkgdW5y
ZWdpc3RlcmVkIG9uIGRyaXZlciBkZXRhY2guIFRoaXMgZnVuY3Rpb24gY2FsbHMKKyAqIGNvdW50
ZXJfcmVnaXN0ZXIgaW50ZXJuYWxseS4gUmVmZXIgdG8gdGhhdCBmdW5jdGlvbiBmb3IgbW9yZSBp
bmZvcm1hdGlvbi4KKyAqCisgKiBSRVRVUk5TOgorICogMCBvbiBzdWNjZXNzLCBuZWdhdGl2ZSBl
cnJvciBudW1iZXIgb24gZmFpbHVyZS4KKyAqLworaW50IGRldm1fY291bnRlcl9yZWdpc3Rlcihz
dHJ1Y3QgZGV2aWNlICpkZXYsCisJCQkgIHN0cnVjdCBjb3VudGVyX2RldmljZSAqY29uc3QgY291
bnRlcikKK3sKKwlpbnQgZXJyOworCisJZXJyID0gY291bnRlcl9yZWdpc3Rlcihjb3VudGVyKTsK
KwlpZiAoZXJyIDwgMCkKKwkJcmV0dXJuIGVycjsKKworCXJldHVybiBkZXZtX2FkZF9hY3Rpb25f
b3JfcmVzZXQoZGV2LCBkZXZtX2NvdW50ZXJfcmVsZWFzZSwgY291bnRlcik7Cit9CitFWFBPUlRf
U1lNQk9MX0dQTChkZXZtX2NvdW50ZXJfcmVnaXN0ZXIpOworCitzdGF0aWMgaW50IF9faW5pdCBj
b3VudGVyX2luaXQodm9pZCkKK3sKKwlyZXR1cm4gYnVzX3JlZ2lzdGVyKCZjb3VudGVyX2J1c190
eXBlKTsKK30KKworc3RhdGljIHZvaWQgX19leGl0IGNvdW50ZXJfZXhpdCh2b2lkKQoreworCWJ1
c191bnJlZ2lzdGVyKCZjb3VudGVyX2J1c190eXBlKTsKK30KKworc3Vic3lzX2luaXRjYWxsKGNv
dW50ZXJfaW5pdCk7Cittb2R1bGVfZXhpdChjb3VudGVyX2V4aXQpOworCitNT0RVTEVfQVVUSE9S
KCJXaWxsaWFtIEJyZWF0aGl0dCBHcmF5IDx2aWxoZWxtLmdyYXlAZ21haWwuY29tPiIpOworTU9E
VUxFX0RFU0NSSVBUSU9OKCJHZW5lcmljIENvdW50ZXIgaW50ZXJmYWNlIik7CitNT0RVTEVfTElD
RU5TRSgiR1BMIHYyIik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2NvdW50ZXIvY291bnRlci1zeXNm
cy5jIGIvZHJpdmVycy9jb3VudGVyL2NvdW50ZXItc3lzZnMuYwpuZXcgZmlsZSBtb2RlIDEwMDY0
NAppbmRleCAwMDAwMDAwMDAwMDAuLmRiYjUwN2M5ZGExMQotLS0gL2Rldi9udWxsCisrKyBiL2Ry
aXZlcnMvY291bnRlci9jb3VudGVyLXN5c2ZzLmMKQEAgLTAsMCArMSw4NTIgQEAKKy8vIFNQRFgt
TGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wCisvKgorICogR2VuZXJpYyBDb3VudGVyIHN5c2Zz
IGludGVyZmFjZQorICogQ29weXJpZ2h0IChDKSAyMDIwIFdpbGxpYW0gQnJlYXRoaXR0IEdyYXkK
KyAqLworI2luY2x1ZGUgPGxpbnV4L2NvdW50ZXIuaD4KKyNpbmNsdWRlIDxsaW51eC9kZXZpY2Uu
aD4KKyNpbmNsdWRlIDxsaW51eC9lcnIuaD4KKyNpbmNsdWRlIDxsaW51eC9nZnAuaD4KKyNpbmNs
dWRlIDxsaW51eC9rZXJuZWwuaD4KKyNpbmNsdWRlIDxsaW51eC9rc3RydG94Lmg+CisjaW5jbHVk
ZSA8bGludXgvbGlzdC5oPgorI2luY2x1ZGUgPGxpbnV4L3N0cmluZy5oPgorI2luY2x1ZGUgPGxp
bnV4L3N5c2ZzLmg+CisjaW5jbHVkZSA8bGludXgvdHlwZXMuaD4KKworI2luY2x1ZGUgImNvdW50
ZXItc3lzZnMuaCIKKworLyoqCisgKiBzdHJ1Y3QgY291bnRlcl9hdHRyaWJ1dGUgLSBDb3VudGVy
IHN5c2ZzIGF0dHJpYnV0ZQorICogQGRldl9hdHRyOglkZXZpY2UgYXR0cmlidXRlIGZvciBzeXNm
cworICogQGw6CQlub2RlIHRvIGFkZCBDb3VudGVyIGF0dHJpYnV0ZSB0byBhdHRyaWJ1dGUgZ3Jv
dXAgbGlzdAorICogQGNvbXA6CUNvdW50ZXIgY29tcG9uZW50IGNhbGxiYWNrcyBhbmQgZGF0YQor
ICogQHNjb3BlOglDb3VudGVyIHNjb3BlIG9mIHRoZSBhdHRyaWJ1dGUKKyAqIEBwYXJlbnQ6CXBv
aW50ZXIgdG8gdGhlIHBhcmVudCBjb21wb25lbnQKKyAqLworc3RydWN0IGNvdW50ZXJfYXR0cmli
dXRlIHsKKwlzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSBkZXZfYXR0cjsKKwlzdHJ1Y3QgbGlzdF9o
ZWFkIGw7CisKKwlzdHJ1Y3QgY291bnRlcl9jb21wIGNvbXA7CisJZW51bSBjb3VudGVyX3Njb3Bl
IHNjb3BlOworCXZvaWQgKnBhcmVudDsKK307CisKKyNkZWZpbmUgdG9fY291bnRlcl9hdHRyaWJ1
dGUoX2Rldl9hdHRyKSBcCisJY29udGFpbmVyX29mKF9kZXZfYXR0ciwgc3RydWN0IGNvdW50ZXJf
YXR0cmlidXRlLCBkZXZfYXR0cikKKworLyoqCisgKiBzdHJ1Y3QgY291bnRlcl9hdHRyaWJ1dGVf
Z3JvdXAgLSBjb250YWluZXIgZm9yIGF0dHJpYnV0ZSBncm91cAorICogQG5hbWU6CW5hbWUgb2Yg
dGhlIGF0dHJpYnV0ZSBncm91cAorICogQGF0dHJfbGlzdDoJbGlzdCB0byBrZWVwIHRyYWNrIG9m
IGNyZWF0ZWQgYXR0cmlidXRlcworICogQG51bV9hdHRyOgludW1iZXIgb2YgYXR0cmlidXRlcwor
ICovCitzdHJ1Y3QgY291bnRlcl9hdHRyaWJ1dGVfZ3JvdXAgeworCWNvbnN0IGNoYXIgKm5hbWU7
CisJc3RydWN0IGxpc3RfaGVhZCBhdHRyX2xpc3Q7CisJc2l6ZV90IG51bV9hdHRyOworfTsKKwor
c3RhdGljIGNvbnN0IGNoYXIgKmNvbnN0IGNvdW50ZXJfZnVuY3Rpb25fc3RyW10gPSB7CisJW0NP
VU5URVJfRlVOQ1RJT05fSU5DUkVBU0VdID0gImluY3JlYXNlIiwKKwlbQ09VTlRFUl9GVU5DVElP
Tl9ERUNSRUFTRV0gPSAiZGVjcmVhc2UiLAorCVtDT1VOVEVSX0ZVTkNUSU9OX1BVTFNFX0RJUkVD
VElPTl0gPSAicHVsc2UtZGlyZWN0aW9uIiwKKwlbQ09VTlRFUl9GVU5DVElPTl9RVUFEUkFUVVJF
X1gxX0FdID0gInF1YWRyYXR1cmUgeDEgYSIsCisJW0NPVU5URVJfRlVOQ1RJT05fUVVBRFJBVFVS
RV9YMV9CXSA9ICJxdWFkcmF0dXJlIHgxIGIiLAorCVtDT1VOVEVSX0ZVTkNUSU9OX1FVQURSQVRV
UkVfWDJfQV0gPSAicXVhZHJhdHVyZSB4MiBhIiwKKwlbQ09VTlRFUl9GVU5DVElPTl9RVUFEUkFU
VVJFX1gyX0JdID0gInF1YWRyYXR1cmUgeDIgYiIsCisJW0NPVU5URVJfRlVOQ1RJT05fUVVBRFJB
VFVSRV9YNF0gPSAicXVhZHJhdHVyZSB4NCIKK307CisKK3N0YXRpYyBjb25zdCBjaGFyICpjb25z
dCBjb3VudGVyX3NpZ25hbF92YWx1ZV9zdHJbXSA9IHsKKwlbQ09VTlRFUl9TSUdOQUxfTEVWRUxf
TE9XXSA9ICJsb3ciLAorCVtDT1VOVEVSX1NJR05BTF9MRVZFTF9ISUdIXSA9ICJoaWdoIgorfTsK
Kworc3RhdGljIGNvbnN0IGNoYXIgKmNvbnN0IGNvdW50ZXJfc3luYXBzZV9hY3Rpb25fc3RyW10g
PSB7CisJW0NPVU5URVJfU1lOQVBTRV9BQ1RJT05fTk9ORV0gPSAibm9uZSIsCisJW0NPVU5URVJf
U1lOQVBTRV9BQ1RJT05fUklTSU5HX0VER0VdID0gInJpc2luZyBlZGdlIiwKKwlbQ09VTlRFUl9T
WU5BUFNFX0FDVElPTl9GQUxMSU5HX0VER0VdID0gImZhbGxpbmcgZWRnZSIsCisJW0NPVU5URVJf
U1lOQVBTRV9BQ1RJT05fQk9USF9FREdFU10gPSAiYm90aCBlZGdlcyIKK307CisKK3N0YXRpYyBj
b25zdCBjaGFyICpjb25zdCBjb3VudGVyX2NvdW50X2RpcmVjdGlvbl9zdHJbXSA9IHsKKwlbQ09V
TlRFUl9DT1VOVF9ESVJFQ1RJT05fRk9SV0FSRF0gPSAiZm9yd2FyZCIsCisJW0NPVU5URVJfQ09V
TlRfRElSRUNUSU9OX0JBQ0tXQVJEXSA9ICJiYWNrd2FyZCIKK307CisKK3N0YXRpYyBjb25zdCBj
aGFyICpjb25zdCBjb3VudGVyX2NvdW50X21vZGVfc3RyW10gPSB7CisJW0NPVU5URVJfQ09VTlRf
TU9ERV9OT1JNQUxdID0gIm5vcm1hbCIsCisJW0NPVU5URVJfQ09VTlRfTU9ERV9SQU5HRV9MSU1J
VF0gPSAicmFuZ2UgbGltaXQiLAorCVtDT1VOVEVSX0NPVU5UX01PREVfTk9OX1JFQ1lDTEVdID0g
Im5vbi1yZWN5Y2xlIiwKKwlbQ09VTlRFUl9DT1VOVF9NT0RFX01PRFVMT19OXSA9ICJtb2R1bG8t
biIKK307CisKK3N0YXRpYyBzc2l6ZV90IGNvdW50ZXJfY29tcF91OF9zaG93KHN0cnVjdCBkZXZp
Y2UgKmRldiwKKwkJCQkgICAgc3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIsIGNoYXIgKmJ1
ZikKK3sKKwljb25zdCBzdHJ1Y3QgY291bnRlcl9hdHRyaWJ1dGUgKmNvbnN0IGEgPSB0b19jb3Vu
dGVyX2F0dHJpYnV0ZShhdHRyKTsKKwlzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvbnN0IGNvdW50
ZXIgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsKKwlpbnQgZXJyOworCXU4IGRhdGEgPSAwOworCisJ
c3dpdGNoIChhLT5zY29wZSkgeworCWNhc2UgQ09VTlRFUl9TQ09QRV9ERVZJQ0U6CisJCWVyciA9
IGEtPmNvbXAuZGV2aWNlX3U4X3JlYWQoY291bnRlciwgJmRhdGEpOworCQlicmVhazsKKwljYXNl
IENPVU5URVJfU0NPUEVfU0lHTkFMOgorCQllcnIgPSBhLT5jb21wLnNpZ25hbF91OF9yZWFkKGNv
dW50ZXIsIGEtPnBhcmVudCwgJmRhdGEpOworCQlicmVhazsKKwljYXNlIENPVU5URVJfU0NPUEVf
Q09VTlQ6CisJCWVyciA9IGEtPmNvbXAuY291bnRfdThfcmVhZChjb3VudGVyLCBhLT5wYXJlbnQs
ICZkYXRhKTsKKwkJYnJlYWs7CisJZGVmYXVsdDoKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCWlm
IChlcnIgPCAwKQorCQlyZXR1cm4gZXJyOworCisJaWYgKGEtPmNvbXAudHlwZSA9PSBDT1VOVEVS
X0NPTVBfQk9PTCkKKwkJLyogZGF0YSBzaG91bGQgYWxyZWFkeSBiZSBib29sZWFuIGJ1dCBlbnN1
cmUganVzdCB0byBiZSBzYWZlICovCisJCWRhdGEgPSAhIWRhdGE7CisKKwlyZXR1cm4gc3ByaW50
ZihidWYsICIldVxuIiwgKHVuc2lnbmVkIGludClkYXRhKTsKK30KKworc3RhdGljIHNzaXplX3Qg
Y291bnRlcl9jb21wX3U4X3N0b3JlKHN0cnVjdCBkZXZpY2UgKmRldiwKKwkJCQkgICAgIHN0cnVj
dCBkZXZpY2VfYXR0cmlidXRlICphdHRyLAorCQkJCSAgICAgY29uc3QgY2hhciAqYnVmLCBzaXpl
X3QgbGVuKQoreworCWNvbnN0IHN0cnVjdCBjb3VudGVyX2F0dHJpYnV0ZSAqY29uc3QgYSA9IHRv
X2NvdW50ZXJfYXR0cmlidXRlKGF0dHIpOworCXN0cnVjdCBjb3VudGVyX2RldmljZSAqY29uc3Qg
Y291bnRlciA9IGRldl9nZXRfZHJ2ZGF0YShkZXYpOworCWludCBlcnI7CisJYm9vbCBib29sX2Rh
dGEgPSAwOworCXU4IGRhdGEgPSAwOworCisJaWYgKGEtPmNvbXAudHlwZSA9PSBDT1VOVEVSX0NP
TVBfQk9PTCkgeworCQllcnIgPSBrc3RydG9ib29sKGJ1ZiwgJmJvb2xfZGF0YSk7CisJCWRhdGEg
PSBib29sX2RhdGE7CisJfSBlbHNlCisJCWVyciA9IGtzdHJ0b3U4KGJ1ZiwgMCwgJmRhdGEpOwor
CWlmIChlcnIgPCAwKQorCQlyZXR1cm4gZXJyOworCisJc3dpdGNoIChhLT5zY29wZSkgeworCWNh
c2UgQ09VTlRFUl9TQ09QRV9ERVZJQ0U6CisJCWVyciA9IGEtPmNvbXAuZGV2aWNlX3U4X3dyaXRl
KGNvdW50ZXIsIGRhdGEpOworCQlicmVhazsKKwljYXNlIENPVU5URVJfU0NPUEVfU0lHTkFMOgor
CQllcnIgPSBhLT5jb21wLnNpZ25hbF91OF93cml0ZShjb3VudGVyLCBhLT5wYXJlbnQsIGRhdGEp
OworCQlicmVhazsKKwljYXNlIENPVU5URVJfU0NPUEVfQ09VTlQ6CisJCWVyciA9IGEtPmNvbXAu
Y291bnRfdThfd3JpdGUoY291bnRlciwgYS0+cGFyZW50LCBkYXRhKTsKKwkJYnJlYWs7CisJZGVm
YXVsdDoKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCWlmIChlcnIgPCAwKQorCQlyZXR1cm4gZXJy
OworCisJcmV0dXJuIGxlbjsKK30KKworc3RhdGljIHNzaXplX3QgY291bnRlcl9jb21wX3UzMl9z
aG93KHN0cnVjdCBkZXZpY2UgKmRldiwKKwkJCQkgICAgIHN0cnVjdCBkZXZpY2VfYXR0cmlidXRl
ICphdHRyLCBjaGFyICpidWYpCit7CisJY29uc3Qgc3RydWN0IGNvdW50ZXJfYXR0cmlidXRlICpj
b25zdCBhID0gdG9fY291bnRlcl9hdHRyaWJ1dGUoYXR0cik7CisJc3RydWN0IGNvdW50ZXJfZGV2
aWNlICpjb25zdCBjb3VudGVyID0gZGV2X2dldF9kcnZkYXRhKGRldik7CisJY29uc3Qgc3RydWN0
IGNvdW50ZXJfYXZhaWxhYmxlICpjb25zdCBhdmFpbCA9IGEtPmNvbXAucHJpdjsKKwlpbnQgZXJy
OworCXUzMiBkYXRhID0gMDsKKworCXN3aXRjaCAoYS0+c2NvcGUpIHsKKwljYXNlIENPVU5URVJf
U0NPUEVfREVWSUNFOgorCQllcnIgPSBhLT5jb21wLmRldmljZV91MzJfcmVhZChjb3VudGVyLCAm
ZGF0YSk7CisJCWJyZWFrOworCWNhc2UgQ09VTlRFUl9TQ09QRV9TSUdOQUw6CisJCWVyciA9IGEt
PmNvbXAuc2lnbmFsX3UzMl9yZWFkKGNvdW50ZXIsIGEtPnBhcmVudCwgJmRhdGEpOworCQlicmVh
azsKKwljYXNlIENPVU5URVJfU0NPUEVfQ09VTlQ6CisJCWlmIChhLT5jb21wLnR5cGUgPT0gQ09V
TlRFUl9DT01QX1NZTkFQU0VfQUNUSU9OKQorCQkJZXJyID0gYS0+Y29tcC5hY3Rpb25fcmVhZChj
b3VudGVyLCBhLT5wYXJlbnQsCisJCQkJCQkgIGEtPmNvbXAucHJpdiwgJmRhdGEpOworCQllbHNl
CisJCQllcnIgPSBhLT5jb21wLmNvdW50X3UzMl9yZWFkKGNvdW50ZXIsIGEtPnBhcmVudCwgJmRh
dGEpOworCQlicmVhazsKKwlkZWZhdWx0OgorCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisJaWYgKGVy
ciA8IDApCisJCXJldHVybiBlcnI7CisKKwlzd2l0Y2ggKGEtPmNvbXAudHlwZSkgeworCWNhc2Ug
Q09VTlRFUl9DT01QX0ZVTkNUSU9OOgorCQlyZXR1cm4gc3lzZnNfZW1pdChidWYsICIlc1xuIiwg
Y291bnRlcl9mdW5jdGlvbl9zdHJbZGF0YV0pOworCWNhc2UgQ09VTlRFUl9DT01QX1NJR05BTF9M
RVZFTDoKKwkJcmV0dXJuIHN5c2ZzX2VtaXQoYnVmLCAiJXNcbiIsIGNvdW50ZXJfc2lnbmFsX3Zh
bHVlX3N0cltkYXRhXSk7CisJY2FzZSBDT1VOVEVSX0NPTVBfU1lOQVBTRV9BQ1RJT046CisJCXJl
dHVybiBzeXNmc19lbWl0KGJ1ZiwgIiVzXG4iLCBjb3VudGVyX3N5bmFwc2VfYWN0aW9uX3N0cltk
YXRhXSk7CisJY2FzZSBDT1VOVEVSX0NPTVBfRU5VTToKKwkJcmV0dXJuIHN5c2ZzX2VtaXQoYnVm
LCAiJXNcbiIsIGF2YWlsLT5zdHJzW2RhdGFdKTsKKwljYXNlIENPVU5URVJfQ09NUF9DT1VOVF9E
SVJFQ1RJT046CisJCXJldHVybiBzeXNmc19lbWl0KGJ1ZiwgIiVzXG4iLCBjb3VudGVyX2NvdW50
X2RpcmVjdGlvbl9zdHJbZGF0YV0pOworCWNhc2UgQ09VTlRFUl9DT01QX0NPVU5UX01PREU6CisJ
CXJldHVybiBzeXNmc19lbWl0KGJ1ZiwgIiVzXG4iLCBjb3VudGVyX2NvdW50X21vZGVfc3RyW2Rh
dGFdKTsKKwlkZWZhdWx0OgorCQlyZXR1cm4gc3ByaW50ZihidWYsICIldVxuIiwgKHVuc2lnbmVk
IGludClkYXRhKTsKKwl9Cit9CisKK3N0YXRpYyBpbnQgY291bnRlcl9maW5kX2VudW0odTMyICpj
b25zdCBlbnVtX2l0ZW0sIGNvbnN0IHUzMiAqY29uc3QgZW51bXMsCisJCQkgICAgIGNvbnN0IHNp
emVfdCBudW1fZW51bXMsIGNvbnN0IGNoYXIgKmNvbnN0IGJ1ZiwKKwkJCSAgICAgY29uc3QgY2hh
ciAqY29uc3Qgc3RyaW5nX2FycmF5W10pCit7CisJc2l6ZV90IGluZGV4OworCisJZm9yIChpbmRl
eCA9IDA7IGluZGV4IDwgbnVtX2VudW1zOyBpbmRleCsrKSB7CisJCSplbnVtX2l0ZW0gPSBlbnVt
c1tpbmRleF07CisJCWlmIChzeXNmc19zdHJlcShidWYsIHN0cmluZ19hcnJheVsqZW51bV9pdGVt
XSkpCisJCQlyZXR1cm4gMDsKKwl9CisKKwlyZXR1cm4gLUVJTlZBTDsKK30KKworc3RhdGljIHNz
aXplX3QgY291bnRlcl9jb21wX3UzMl9zdG9yZShzdHJ1Y3QgZGV2aWNlICpkZXYsCisJCQkJICAg
ICAgc3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIsCisJCQkJICAgICAgY29uc3QgY2hhciAq
YnVmLCBzaXplX3QgbGVuKQoreworCWNvbnN0IHN0cnVjdCBjb3VudGVyX2F0dHJpYnV0ZSAqY29u
c3QgYSA9IHRvX2NvdW50ZXJfYXR0cmlidXRlKGF0dHIpOworCXN0cnVjdCBjb3VudGVyX2Rldmlj
ZSAqY29uc3QgY291bnRlciA9IGRldl9nZXRfZHJ2ZGF0YShkZXYpOworCXN0cnVjdCBjb3VudGVy
X2NvdW50ICpjb25zdCBjb3VudCA9IGEtPnBhcmVudDsKKwlzdHJ1Y3QgY291bnRlcl9zeW5hcHNl
ICpjb25zdCBzeW5hcHNlID0gYS0+Y29tcC5wcml2OworCWNvbnN0IHN0cnVjdCBjb3VudGVyX2F2
YWlsYWJsZSAqY29uc3QgYXZhaWwgPSBhLT5jb21wLnByaXY7CisJaW50IGVycjsKKwl1MzIgZGF0
YSA9IDA7CisKKwlzd2l0Y2ggKGEtPmNvbXAudHlwZSkgeworCWNhc2UgQ09VTlRFUl9DT01QX0ZV
TkNUSU9OOgorCQllcnIgPSBjb3VudGVyX2ZpbmRfZW51bSgmZGF0YSwgY291bnQtPmZ1bmN0aW9u
c19saXN0LAorCQkJCQljb3VudC0+bnVtX2Z1bmN0aW9ucywgYnVmLAorCQkJCQljb3VudGVyX2Z1
bmN0aW9uX3N0cik7CisJCWJyZWFrOworCWNhc2UgQ09VTlRFUl9DT01QX1NZTkFQU0VfQUNUSU9O
OgorCQllcnIgPSBjb3VudGVyX2ZpbmRfZW51bSgmZGF0YSwgc3luYXBzZS0+YWN0aW9uc19saXN0
LAorCQkJCQlzeW5hcHNlLT5udW1fYWN0aW9ucywgYnVmLAorCQkJCQljb3VudGVyX3N5bmFwc2Vf
YWN0aW9uX3N0cik7CisJCWJyZWFrOworCWNhc2UgQ09VTlRFUl9DT01QX0VOVU06CisJCWVyciA9
IF9fc3lzZnNfbWF0Y2hfc3RyaW5nKGF2YWlsLT5zdHJzLCBhdmFpbC0+bnVtX2l0ZW1zLCBidWYp
OworCQlkYXRhID0gZXJyOworCQlicmVhazsKKwljYXNlIENPVU5URVJfQ09NUF9DT1VOVF9NT0RF
OgorCQllcnIgPSBjb3VudGVyX2ZpbmRfZW51bSgmZGF0YSwgYXZhaWwtPmVudW1zLCBhdmFpbC0+
bnVtX2l0ZW1zLAorCQkJCQlidWYsIGNvdW50ZXJfY291bnRfbW9kZV9zdHIpOworCQlicmVhazsK
KwlkZWZhdWx0OgorCQllcnIgPSBrc3RydG91MzIoYnVmLCAwLCAmZGF0YSk7CisJCWJyZWFrOwor
CX0KKwlpZiAoZXJyIDwgMCkKKwkJcmV0dXJuIGVycjsKKworCXN3aXRjaCAoYS0+c2NvcGUpIHsK
KwljYXNlIENPVU5URVJfU0NPUEVfREVWSUNFOgorCQllcnIgPSBhLT5jb21wLmRldmljZV91MzJf
d3JpdGUoY291bnRlciwgZGF0YSk7CisJCWJyZWFrOworCWNhc2UgQ09VTlRFUl9TQ09QRV9TSUdO
QUw6CisJCWVyciA9IGEtPmNvbXAuc2lnbmFsX3UzMl93cml0ZShjb3VudGVyLCBhLT5wYXJlbnQs
IGRhdGEpOworCQlicmVhazsKKwljYXNlIENPVU5URVJfU0NPUEVfQ09VTlQ6CisJCWlmIChhLT5j
b21wLnR5cGUgPT0gQ09VTlRFUl9DT01QX1NZTkFQU0VfQUNUSU9OKQorCQkJZXJyID0gYS0+Y29t
cC5hY3Rpb25fd3JpdGUoY291bnRlciwgY291bnQsIHN5bmFwc2UsCisJCQkJCQkgICBkYXRhKTsK
KwkJZWxzZQorCQkJZXJyID0gYS0+Y29tcC5jb3VudF91MzJfd3JpdGUoY291bnRlciwgY291bnQs
IGRhdGEpOworCQlicmVhazsKKwlkZWZhdWx0OgorCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisJaWYg
KGVyciA8IDApCisJCXJldHVybiBlcnI7CisKKwlyZXR1cm4gbGVuOworfQorCitzdGF0aWMgc3Np
emVfdCBjb3VudGVyX2NvbXBfdTY0X3Nob3coc3RydWN0IGRldmljZSAqZGV2LAorCQkJCSAgICAg
c3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIsIGNoYXIgKmJ1ZikKK3sKKwljb25zdCBzdHJ1
Y3QgY291bnRlcl9hdHRyaWJ1dGUgKmNvbnN0IGEgPSB0b19jb3VudGVyX2F0dHJpYnV0ZShhdHRy
KTsKKwlzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvbnN0IGNvdW50ZXIgPSBkZXZfZ2V0X2RydmRh
dGEoZGV2KTsKKwlpbnQgZXJyOworCXU2NCBkYXRhID0gMDsKKworCXN3aXRjaCAoYS0+c2NvcGUp
IHsKKwljYXNlIENPVU5URVJfU0NPUEVfREVWSUNFOgorCQllcnIgPSBhLT5jb21wLmRldmljZV91
NjRfcmVhZChjb3VudGVyLCAmZGF0YSk7CisJCWJyZWFrOworCWNhc2UgQ09VTlRFUl9TQ09QRV9T
SUdOQUw6CisJCWVyciA9IGEtPmNvbXAuc2lnbmFsX3U2NF9yZWFkKGNvdW50ZXIsIGEtPnBhcmVu
dCwgJmRhdGEpOworCQlicmVhazsKKwljYXNlIENPVU5URVJfU0NPUEVfQ09VTlQ6CisJCWVyciA9
IGEtPmNvbXAuY291bnRfdTY0X3JlYWQoY291bnRlciwgYS0+cGFyZW50LCAmZGF0YSk7CisJCWJy
ZWFrOworCWRlZmF1bHQ6CisJCXJldHVybiAtRUlOVkFMOworCX0KKwlpZiAoZXJyIDwgMCkKKwkJ
cmV0dXJuIGVycjsKKworCXJldHVybiBzcHJpbnRmKGJ1ZiwgIiVsbHVcbiIsICh1bnNpZ25lZCBs
b25nIGxvbmcpZGF0YSk7Cit9CisKK3N0YXRpYyBzc2l6ZV90IGNvdW50ZXJfY29tcF91NjRfc3Rv
cmUoc3RydWN0IGRldmljZSAqZGV2LAorCQkJCSAgICAgIHN0cnVjdCBkZXZpY2VfYXR0cmlidXRl
ICphdHRyLAorCQkJCSAgICAgIGNvbnN0IGNoYXIgKmJ1Ziwgc2l6ZV90IGxlbikKK3sKKwljb25z
dCBzdHJ1Y3QgY291bnRlcl9hdHRyaWJ1dGUgKmNvbnN0IGEgPSB0b19jb3VudGVyX2F0dHJpYnV0
ZShhdHRyKTsKKwlzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvbnN0IGNvdW50ZXIgPSBkZXZfZ2V0
X2RydmRhdGEoZGV2KTsKKwlpbnQgZXJyOworCXU2NCBkYXRhID0gMDsKKworCWVyciA9IGtzdHJ0
b3U2NChidWYsIDAsICZkYXRhKTsKKwlpZiAoZXJyIDwgMCkKKwkJcmV0dXJuIGVycjsKKworCXN3
aXRjaCAoYS0+c2NvcGUpIHsKKwljYXNlIENPVU5URVJfU0NPUEVfREVWSUNFOgorCQllcnIgPSBh
LT5jb21wLmRldmljZV91NjRfd3JpdGUoY291bnRlciwgZGF0YSk7CisJCWJyZWFrOworCWNhc2Ug
Q09VTlRFUl9TQ09QRV9TSUdOQUw6CisJCWVyciA9IGEtPmNvbXAuc2lnbmFsX3U2NF93cml0ZShj
b3VudGVyLCBhLT5wYXJlbnQsIGRhdGEpOworCQlicmVhazsKKwljYXNlIENPVU5URVJfU0NPUEVf
Q09VTlQ6CisJCWVyciA9IGEtPmNvbXAuY291bnRfdTY0X3dyaXRlKGNvdW50ZXIsIGEtPnBhcmVu
dCwgZGF0YSk7CisJCWJyZWFrOworCWRlZmF1bHQ6CisJCXJldHVybiAtRUlOVkFMOworCX0KKwlp
ZiAoZXJyIDwgMCkKKwkJcmV0dXJuIGVycjsKKworCXJldHVybiBsZW47Cit9CisKK3N0YXRpYyBz
c2l6ZV90IGVudW1zX2F2YWlsYWJsZV9zaG93KGNvbnN0IHUzMiAqY29uc3QgZW51bXMsCisJCQkJ
ICAgIGNvbnN0IHNpemVfdCBudW1fZW51bXMsCisJCQkJICAgIGNvbnN0IGNoYXIgKmNvbnN0IHN0
cnNbXSwgY2hhciAqYnVmKQoreworCXNpemVfdCBsZW4gPSAwOworCXNpemVfdCBpbmRleDsKKwor
CWZvciAoaW5kZXggPSAwOyBpbmRleCA8IG51bV9lbnVtczsgaW5kZXgrKykKKwkJbGVuICs9IHN5
c2ZzX2VtaXRfYXQoYnVmLCBsZW4sICIlc1xuIiwgc3Ryc1tlbnVtc1tpbmRleF1dKTsKKworCXJl
dHVybiBsZW47Cit9CisKK3N0YXRpYyBzc2l6ZV90IHN0cnNfYXZhaWxhYmxlX3Nob3coY29uc3Qg
c3RydWN0IGNvdW50ZXJfYXZhaWxhYmxlICpjb25zdCBhdmFpbCwKKwkJCQkgICBjaGFyICpidWYp
Cit7CisJc2l6ZV90IGxlbiA9IDA7CisJc2l6ZV90IGluZGV4OworCisJZm9yIChpbmRleCA9IDA7
IGluZGV4IDwgYXZhaWwtPm51bV9pdGVtczsgaW5kZXgrKykKKwkJbGVuICs9IHN5c2ZzX2VtaXRf
YXQoYnVmLCBsZW4sICIlc1xuIiwgYXZhaWwtPnN0cnNbaW5kZXhdKTsKKworCXJldHVybiBsZW47
Cit9CisKK3N0YXRpYyBzc2l6ZV90IGNvdW50ZXJfY29tcF9hdmFpbGFibGVfc2hvdyhzdHJ1Y3Qg
ZGV2aWNlICpkZXYsCisJCQkJCSAgIHN0cnVjdCBkZXZpY2VfYXR0cmlidXRlICphdHRyLAorCQkJ
CQkgICBjaGFyICpidWYpCit7CisJY29uc3Qgc3RydWN0IGNvdW50ZXJfYXR0cmlidXRlICpjb25z
dCBhID0gdG9fY291bnRlcl9hdHRyaWJ1dGUoYXR0cik7CisJY29uc3Qgc3RydWN0IGNvdW50ZXJf
Y291bnQgKmNvbnN0IGNvdW50ID0gYS0+cGFyZW50OworCWNvbnN0IHN0cnVjdCBjb3VudGVyX3N5
bmFwc2UgKmNvbnN0IHN5bmFwc2UgPSBhLT5jb21wLnByaXY7CisJY29uc3Qgc3RydWN0IGNvdW50
ZXJfYXZhaWxhYmxlICpjb25zdCBhdmFpbCA9IGEtPmNvbXAucHJpdjsKKworCXN3aXRjaCAoYS0+
Y29tcC50eXBlKSB7CisJY2FzZSBDT1VOVEVSX0NPTVBfRlVOQ1RJT046CisJCXJldHVybiBlbnVt
c19hdmFpbGFibGVfc2hvdyhjb3VudC0+ZnVuY3Rpb25zX2xpc3QsCisJCQkJCSAgICBjb3VudC0+
bnVtX2Z1bmN0aW9ucywKKwkJCQkJICAgIGNvdW50ZXJfZnVuY3Rpb25fc3RyLCBidWYpOworCWNh
c2UgQ09VTlRFUl9DT01QX1NZTkFQU0VfQUNUSU9OOgorCQlyZXR1cm4gZW51bXNfYXZhaWxhYmxl
X3Nob3coc3luYXBzZS0+YWN0aW9uc19saXN0LAorCQkJCQkgICAgc3luYXBzZS0+bnVtX2FjdGlv
bnMsCisJCQkJCSAgICBjb3VudGVyX3N5bmFwc2VfYWN0aW9uX3N0ciwgYnVmKTsKKwljYXNlIENP
VU5URVJfQ09NUF9FTlVNOgorCQlyZXR1cm4gc3Ryc19hdmFpbGFibGVfc2hvdyhhdmFpbCwgYnVm
KTsKKwljYXNlIENPVU5URVJfQ09NUF9DT1VOVF9NT0RFOgorCQlyZXR1cm4gZW51bXNfYXZhaWxh
YmxlX3Nob3coYXZhaWwtPmVudW1zLCBhdmFpbC0+bnVtX2l0ZW1zLAorCQkJCQkgICAgY291bnRl
cl9jb3VudF9tb2RlX3N0ciwgYnVmKTsKKwlkZWZhdWx0OgorCQlyZXR1cm4gLUVJTlZBTDsKKwl9
Cit9CisKK3N0YXRpYyBpbnQgY291bnRlcl9hdmFpbF9hdHRyX2NyZWF0ZShzdHJ1Y3QgZGV2aWNl
ICpjb25zdCBkZXYsCisJc3RydWN0IGNvdW50ZXJfYXR0cmlidXRlX2dyb3VwICpjb25zdCBncm91
cCwKKwljb25zdCBzdHJ1Y3QgY291bnRlcl9jb21wICpjb25zdCBjb21wLCB2b2lkICpjb25zdCBw
YXJlbnQpCit7CisJc3RydWN0IGNvdW50ZXJfYXR0cmlidXRlICpjb3VudGVyX2F0dHI7CisJc3Ry
dWN0IGRldmljZV9hdHRyaWJ1dGUgKmRldl9hdHRyOworCisJLyogQWxsb2NhdGUgQ291bnRlciBh
dHRyaWJ1dGUgKi8KKwljb3VudGVyX2F0dHIgPSBkZXZtX2t6YWxsb2MoZGV2LCBzaXplb2YoKmNv
dW50ZXJfYXR0ciksIEdGUF9LRVJORUwpOworCWlmICghY291bnRlcl9hdHRyKQorCQlyZXR1cm4g
LUVOT01FTTsKKworCS8qIENvbmZpZ3VyZSBDb3VudGVyIGF0dHJpYnV0ZSAqLworCWNvdW50ZXJf
YXR0ci0+Y29tcC50eXBlID0gY29tcC0+dHlwZTsKKwljb3VudGVyX2F0dHItPmNvbXAucHJpdiA9
IGNvbXAtPnByaXY7CisJY291bnRlcl9hdHRyLT5wYXJlbnQgPSBwYXJlbnQ7CisKKwkvKiBJbml0
aWFsaXplIHN5c2ZzIGF0dHJpYnV0ZSAqLworCWRldl9hdHRyID0gJmNvdW50ZXJfYXR0ci0+ZGV2
X2F0dHI7CisJc3lzZnNfYXR0cl9pbml0KCZkZXZfYXR0ci0+YXR0cik7CisKKwkvKiBDb25maWd1
cmUgZGV2aWNlIGF0dHJpYnV0ZSAqLworCWRldl9hdHRyLT5hdHRyLm5hbWUgPSBkZXZtX2thc3By
aW50ZihkZXYsIEdGUF9LRVJORUwsICIlc19hdmFpbGFibGUiLAorCQkJCQkgICAgIGNvbXAtPm5h
bWUpOworCWlmICghZGV2X2F0dHItPmF0dHIubmFtZSkKKwkJcmV0dXJuIC1FTk9NRU07CisJZGV2
X2F0dHItPmF0dHIubW9kZSA9IDA0NDQ7CisJZGV2X2F0dHItPnNob3cgPSBjb3VudGVyX2NvbXBf
YXZhaWxhYmxlX3Nob3c7CisKKwkvKiBTdG9yZSBsaXN0IG5vZGUgKi8KKwlsaXN0X2FkZCgmY291
bnRlcl9hdHRyLT5sLCAmZ3JvdXAtPmF0dHJfbGlzdCk7CisJZ3JvdXAtPm51bV9hdHRyKys7CisK
KwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBjb3VudGVyX2F0dHJfY3JlYXRlKHN0cnVjdCBk
ZXZpY2UgKmNvbnN0IGRldiwKKwkJCSAgICAgICBzdHJ1Y3QgY291bnRlcl9hdHRyaWJ1dGVfZ3Jv
dXAgKmNvbnN0IGdyb3VwLAorCQkJICAgICAgIGNvbnN0IHN0cnVjdCBjb3VudGVyX2NvbXAgKmNv
bnN0IGNvbXAsCisJCQkgICAgICAgY29uc3QgZW51bSBjb3VudGVyX3Njb3BlIHNjb3BlLAorCQkJ
ICAgICAgIHZvaWQgKmNvbnN0IHBhcmVudCkKK3sKKwlzdHJ1Y3QgY291bnRlcl9hdHRyaWJ1dGUg
KmNvdW50ZXJfYXR0cjsKKwlzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSAqZGV2X2F0dHI7CisKKwkv
KiBBbGxvY2F0ZSBDb3VudGVyIGF0dHJpYnV0ZSAqLworCWNvdW50ZXJfYXR0ciA9IGRldm1fa3ph
bGxvYyhkZXYsIHNpemVvZigqY291bnRlcl9hdHRyKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFjb3Vu
dGVyX2F0dHIpCisJCXJldHVybiAtRU5PTUVNOworCisJLyogQ29uZmlndXJlIENvdW50ZXIgYXR0
cmlidXRlICovCisJY291bnRlcl9hdHRyLT5jb21wID0gKmNvbXA7CisJY291bnRlcl9hdHRyLT5z
Y29wZSA9IHNjb3BlOworCWNvdW50ZXJfYXR0ci0+cGFyZW50ID0gcGFyZW50OworCisJLyogQ29u
ZmlndXJlIGRldmljZSBhdHRyaWJ1dGUgKi8KKwlkZXZfYXR0ciA9ICZjb3VudGVyX2F0dHItPmRl
dl9hdHRyOworCXN5c2ZzX2F0dHJfaW5pdCgmZGV2X2F0dHItPmF0dHIpOworCWRldl9hdHRyLT5h
dHRyLm5hbWUgPSBjb21wLT5uYW1lOworCXN3aXRjaCAoY29tcC0+dHlwZSkgeworCWNhc2UgQ09V
TlRFUl9DT01QX1U4OgorCWNhc2UgQ09VTlRFUl9DT01QX0JPT0w6CisJCWlmIChjb21wLT5kZXZp
Y2VfdThfcmVhZCkgeworCQkJZGV2X2F0dHItPmF0dHIubW9kZSB8PSAwNDQ0OworCQkJZGV2X2F0
dHItPnNob3cgPSBjb3VudGVyX2NvbXBfdThfc2hvdzsKKwkJfQorCQlpZiAoY29tcC0+ZGV2aWNl
X3U4X3dyaXRlKSB7CisJCQlkZXZfYXR0ci0+YXR0ci5tb2RlIHw9IDAyMDA7CisJCQlkZXZfYXR0
ci0+c3RvcmUgPSBjb3VudGVyX2NvbXBfdThfc3RvcmU7CisJCX0KKwkJYnJlYWs7CisJY2FzZSBD
T1VOVEVSX0NPTVBfU0lHTkFMX0xFVkVMOgorCWNhc2UgQ09VTlRFUl9DT01QX0ZVTkNUSU9OOgor
CWNhc2UgQ09VTlRFUl9DT01QX1NZTkFQU0VfQUNUSU9OOgorCWNhc2UgQ09VTlRFUl9DT01QX0VO
VU06CisJY2FzZSBDT1VOVEVSX0NPTVBfQ09VTlRfRElSRUNUSU9OOgorCWNhc2UgQ09VTlRFUl9D
T01QX0NPVU5UX01PREU6CisJCWlmIChjb21wLT5kZXZpY2VfdTMyX3JlYWQpIHsKKwkJCWRldl9h
dHRyLT5hdHRyLm1vZGUgfD0gMDQ0NDsKKwkJCWRldl9hdHRyLT5zaG93ID0gY291bnRlcl9jb21w
X3UzMl9zaG93OworCQl9CisJCWlmIChjb21wLT5kZXZpY2VfdTMyX3dyaXRlKSB7CisJCQlkZXZf
YXR0ci0+YXR0ci5tb2RlIHw9IDAyMDA7CisJCQlkZXZfYXR0ci0+c3RvcmUgPSBjb3VudGVyX2Nv
bXBfdTMyX3N0b3JlOworCQl9CisJCWJyZWFrOworCWNhc2UgQ09VTlRFUl9DT01QX1U2NDoKKwkJ
aWYgKGNvbXAtPmRldmljZV91NjRfcmVhZCkgeworCQkJZGV2X2F0dHItPmF0dHIubW9kZSB8PSAw
NDQ0OworCQkJZGV2X2F0dHItPnNob3cgPSBjb3VudGVyX2NvbXBfdTY0X3Nob3c7CisJCX0KKwkJ
aWYgKGNvbXAtPmRldmljZV91NjRfd3JpdGUpIHsKKwkJCWRldl9hdHRyLT5hdHRyLm1vZGUgfD0g
MDIwMDsKKwkJCWRldl9hdHRyLT5zdG9yZSA9IGNvdW50ZXJfY29tcF91NjRfc3RvcmU7CisJCX0K
KwkJYnJlYWs7CisJZGVmYXVsdDoKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCisJLyogU3RvcmUg
bGlzdCBub2RlICovCisJbGlzdF9hZGQoJmNvdW50ZXJfYXR0ci0+bCwgJmdyb3VwLT5hdHRyX2xp
c3QpOworCWdyb3VwLT5udW1fYXR0cisrOworCisJLyogQ3JlYXRlICIqX2F2YWlsYWJsZSIgYXR0
cmlidXRlIGlmIG5lZWRlZCAqLworCXN3aXRjaCAoY29tcC0+dHlwZSkgeworCWNhc2UgQ09VTlRF
Ul9DT01QX0ZVTkNUSU9OOgorCWNhc2UgQ09VTlRFUl9DT01QX1NZTkFQU0VfQUNUSU9OOgorCWNh
c2UgQ09VTlRFUl9DT01QX0VOVU06CisJY2FzZSBDT1VOVEVSX0NPTVBfQ09VTlRfTU9ERToKKwkJ
cmV0dXJuIGNvdW50ZXJfYXZhaWxfYXR0cl9jcmVhdGUoZGV2LCBncm91cCwgY29tcCwgcGFyZW50
KTsKKwlkZWZhdWx0OgorCQlyZXR1cm4gMDsKKwl9Cit9CisKK3N0YXRpYyBzc2l6ZV90IGNvdW50
ZXJfY29tcF9uYW1lX3Nob3coc3RydWN0IGRldmljZSAqZGV2LAorCQkJCSAgICAgIHN0cnVjdCBk
ZXZpY2VfYXR0cmlidXRlICphdHRyLCBjaGFyICpidWYpCit7CisJcmV0dXJuIHN5c2ZzX2VtaXQo
YnVmLCAiJXNcbiIsIHRvX2NvdW50ZXJfYXR0cmlidXRlKGF0dHIpLT5jb21wLm5hbWUpOworfQor
CitzdGF0aWMgaW50IGNvdW50ZXJfbmFtZV9hdHRyX2NyZWF0ZShzdHJ1Y3QgZGV2aWNlICpjb25z
dCBkZXYsCisJCQkJICAgIHN0cnVjdCBjb3VudGVyX2F0dHJpYnV0ZV9ncm91cCAqY29uc3QgZ3Jv
dXAsCisJCQkJICAgIGNvbnN0IGNoYXIgKmNvbnN0IG5hbWUpCit7CisJc3RydWN0IGNvdW50ZXJf
YXR0cmlidXRlICpjb3VudGVyX2F0dHI7CisKKwkvKiBBbGxvY2F0ZSBDb3VudGVyIGF0dHJpYnV0
ZSAqLworCWNvdW50ZXJfYXR0ciA9IGRldm1fa3phbGxvYyhkZXYsIHNpemVvZigqY291bnRlcl9h
dHRyKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFjb3VudGVyX2F0dHIpCisJCXJldHVybiAtRU5PTUVN
OworCisJLyogQ29uZmlndXJlIENvdW50ZXIgYXR0cmlidXRlICovCisJY291bnRlcl9hdHRyLT5j
b21wLm5hbWUgPSBuYW1lOworCisJLyogQ29uZmlndXJlIGRldmljZSBhdHRyaWJ1dGUgKi8KKwlz
eXNmc19hdHRyX2luaXQoJmNvdW50ZXJfYXR0ci0+ZGV2X2F0dHIuYXR0cik7CisJY291bnRlcl9h
dHRyLT5kZXZfYXR0ci5hdHRyLm5hbWUgPSAibmFtZSI7CisJY291bnRlcl9hdHRyLT5kZXZfYXR0
ci5hdHRyLm1vZGUgPSAwNDQ0OworCWNvdW50ZXJfYXR0ci0+ZGV2X2F0dHIuc2hvdyA9IGNvdW50
ZXJfY29tcF9uYW1lX3Nob3c7CisKKwkvKiBTdG9yZSBsaXN0IG5vZGUgKi8KKwlsaXN0X2FkZCgm
Y291bnRlcl9hdHRyLT5sLCAmZ3JvdXAtPmF0dHJfbGlzdCk7CisJZ3JvdXAtPm51bV9hdHRyKys7
CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIHN0cnVjdCBjb3VudGVyX2NvbXAgY291bnRlcl9z
aWduYWxfY29tcCA9IHsKKwkudHlwZSA9IENPVU5URVJfQ09NUF9TSUdOQUxfTEVWRUwsCisJLm5h
bWUgPSAic2lnbmFsIiwKK307CisKK3N0YXRpYyBpbnQgY291bnRlcl9zaWduYWxfYXR0cnNfY3Jl
YXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY29uc3QgY291bnRlciwKKwlzdHJ1Y3QgY291bnRl
cl9hdHRyaWJ1dGVfZ3JvdXAgKmNvbnN0IGNhdHRyX2dyb3VwLAorCXN0cnVjdCBjb3VudGVyX3Np
Z25hbCAqY29uc3Qgc2lnbmFsKQoreworCWNvbnN0IGVudW0gY291bnRlcl9zY29wZSBzY29wZSA9
IENPVU5URVJfU0NPUEVfU0lHTkFMOworCXN0cnVjdCBkZXZpY2UgKmNvbnN0IGRldiA9ICZjb3Vu
dGVyLT5kZXY7CisJaW50IGVycjsKKwlzdHJ1Y3QgY291bnRlcl9jb21wIGNvbXA7CisJc2l6ZV90
IGk7CisKKwkvKiBDcmVhdGUgbWFpbiBTaWduYWwgYXR0cmlidXRlICovCisJY29tcCA9IGNvdW50
ZXJfc2lnbmFsX2NvbXA7CisJY29tcC5zaWduYWxfdTMyX3JlYWQgPSBjb3VudGVyLT5vcHMtPnNp
Z25hbF9yZWFkOworCWVyciA9IGNvdW50ZXJfYXR0cl9jcmVhdGUoZGV2LCBjYXR0cl9ncm91cCwg
JmNvbXAsIHNjb3BlLCBzaWduYWwpOworCWlmIChlcnIgPCAwKQorCQlyZXR1cm4gZXJyOworCisJ
LyogQ3JlYXRlIFNpZ25hbCBuYW1lIGF0dHJpYnV0ZSAqLworCWVyciA9IGNvdW50ZXJfbmFtZV9h
dHRyX2NyZWF0ZShkZXYsIGNhdHRyX2dyb3VwLCBzaWduYWwtPm5hbWUpOworCWlmIChlcnIgPCAw
KQorCQlyZXR1cm4gZXJyOworCisJLyogQ3JlYXRlIGFuIGF0dHJpYnV0ZSBmb3IgZWFjaCBleHRl
bnNpb24gKi8KKwlmb3IgKGkgPSAwOyBpIDwgc2lnbmFsLT5udW1fZXh0OyBpKyspIHsKKwkJZXJy
ID0gY291bnRlcl9hdHRyX2NyZWF0ZShkZXYsIGNhdHRyX2dyb3VwLCBzaWduYWwtPmV4dCArIGks
CisJCQkJCSAgc2NvcGUsIHNpZ25hbCk7CisJCWlmIChlcnIgPCAwKQorCQkJcmV0dXJuIGVycjsK
Kwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBjb3VudGVyX3N5c2ZzX3NpZ25hbHNf
YWRkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY29uc3QgY291bnRlciwKKwlzdHJ1Y3QgY291bnRl
cl9hdHRyaWJ1dGVfZ3JvdXAgKmNvbnN0IGdyb3VwcykKK3sKKwlzaXplX3QgaTsKKwlpbnQgZXJy
OworCisJLyogQWRkIGVhY2ggU2lnbmFsICovCisJZm9yIChpID0gMDsgaSA8IGNvdW50ZXItPm51
bV9zaWduYWxzOyBpKyspIHsKKwkJLyogR2VuZXJhdGUgU2lnbmFsIGF0dHJpYnV0ZSBkaXJlY3Rv
cnkgbmFtZSAqLworCQlncm91cHNbaV0ubmFtZSA9IGRldm1fa2FzcHJpbnRmKCZjb3VudGVyLT5k
ZXYsIEdGUF9LRVJORUwsCisJCQkJCQkic2lnbmFsJXp1IiwgaSk7CisJCWlmICghZ3JvdXBzW2ld
Lm5hbWUpCisJCQlyZXR1cm4gLUVOT01FTTsKKworCQkvKiBDcmVhdGUgYWxsIGF0dHJpYnV0ZXMg
YXNzb2NpYXRlZCB3aXRoIFNpZ25hbCAqLworCQllcnIgPSBjb3VudGVyX3NpZ25hbF9hdHRyc19j
cmVhdGUoY291bnRlciwgZ3JvdXBzICsgaSwKKwkJCQkJCSAgY291bnRlci0+c2lnbmFscyArIGkp
OworCQlpZiAoZXJyIDwgMCkKKwkJCXJldHVybiBlcnI7CisJfQorCisJcmV0dXJuIDA7Cit9CisK
K3N0YXRpYyBpbnQgY291bnRlcl9zeXNmc19zeW5hcHNlc19hZGQoc3RydWN0IGNvdW50ZXJfZGV2
aWNlICpjb25zdCBjb3VudGVyLAorCXN0cnVjdCBjb3VudGVyX2F0dHJpYnV0ZV9ncm91cCAqY29u
c3QgZ3JvdXAsCisJc3RydWN0IGNvdW50ZXJfY291bnQgKmNvbnN0IGNvdW50KQoreworCXNpemVf
dCBpOworCisJLyogQWRkIGVhY2ggU3luYXBzZSAqLworCWZvciAoaSA9IDA7IGkgPCBjb3VudC0+
bnVtX3N5bmFwc2VzOyBpKyspIHsKKwkJc3RydWN0IGRldmljZSAqY29uc3QgZGV2ID0gJmNvdW50
ZXItPmRldjsKKwkJc3RydWN0IGNvdW50ZXJfc3luYXBzZSAqc3luYXBzZTsKKwkJc2l6ZV90IGlk
OworCQlzdHJ1Y3QgY291bnRlcl9jb21wIGNvbXA7CisJCWludCBlcnI7CisKKwkJc3luYXBzZSA9
IGNvdW50LT5zeW5hcHNlcyArIGk7CisKKwkJLyogR2VuZXJhdGUgU3luYXBzZSBhY3Rpb24gbmFt
ZSAqLworCQlpZCA9IHN5bmFwc2UtPnNpZ25hbCAtIGNvdW50ZXItPnNpZ25hbHM7CisJCWNvbXAu
bmFtZSA9IGRldm1fa2FzcHJpbnRmKGRldiwgR0ZQX0tFUk5FTCwgInNpZ25hbCV6dV9hY3Rpb24i
LAorCQkJCQkgICBpZCk7CisJCWlmICghY29tcC5uYW1lKQorCQkJcmV0dXJuIC1FTk9NRU07CisK
KwkJLyogQ3JlYXRlIGFjdGlvbiBhdHRyaWJ1dGUgKi8KKwkJY29tcC50eXBlID0gQ09VTlRFUl9D
T01QX1NZTkFQU0VfQUNUSU9OOworCQljb21wLmFjdGlvbl9yZWFkID0gY291bnRlci0+b3BzLT5h
Y3Rpb25fcmVhZDsKKwkJY29tcC5hY3Rpb25fd3JpdGUgPSBjb3VudGVyLT5vcHMtPmFjdGlvbl93
cml0ZTsKKwkJY29tcC5wcml2ID0gc3luYXBzZTsKKwkJZXJyID0gY291bnRlcl9hdHRyX2NyZWF0
ZShkZXYsIGdyb3VwLCAmY29tcCwKKwkJCQkJICBDT1VOVEVSX1NDT1BFX0NPVU5ULCBjb3VudCk7
CisJCWlmIChlcnIgPCAwKQorCQkJcmV0dXJuIGVycjsKKwl9CisKKwlyZXR1cm4gMDsKK30KKwor
c3RhdGljIHN0cnVjdCBjb3VudGVyX2NvbXAgY291bnRlcl9jb3VudF9jb21wID0KKwlDT1VOVEVS
X0NPTVBfQ09VTlRfVTY0KCJjb3VudCIsIE5VTEwsIE5VTEwpOworCitzdGF0aWMgc3RydWN0IGNv
dW50ZXJfY29tcCBjb3VudGVyX2Z1bmN0aW9uX2NvbXAgPSB7CisJLnR5cGUgPSBDT1VOVEVSX0NP
TVBfRlVOQ1RJT04sCisJLm5hbWUgPSAiZnVuY3Rpb24iLAorfTsKKworc3RhdGljIGludCBjb3Vu
dGVyX2NvdW50X2F0dHJzX2NyZWF0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvbnN0IGNvdW50
ZXIsCisJc3RydWN0IGNvdW50ZXJfYXR0cmlidXRlX2dyb3VwICpjb25zdCBjYXR0cl9ncm91cCwK
KwlzdHJ1Y3QgY291bnRlcl9jb3VudCAqY29uc3QgY291bnQpCit7CisJY29uc3QgZW51bSBjb3Vu
dGVyX3Njb3BlIHNjb3BlID0gQ09VTlRFUl9TQ09QRV9DT1VOVDsKKwlzdHJ1Y3QgZGV2aWNlICpj
b25zdCBkZXYgPSAmY291bnRlci0+ZGV2OworCWludCBlcnI7CisJc3RydWN0IGNvdW50ZXJfY29t
cCBjb21wOworCXNpemVfdCBpOworCisJLyogQ3JlYXRlIG1haW4gQ291bnQgYXR0cmlidXRlICov
CisJY29tcCA9IGNvdW50ZXJfY291bnRfY29tcDsKKwljb21wLmNvdW50X3U2NF9yZWFkID0gY291
bnRlci0+b3BzLT5jb3VudF9yZWFkOworCWNvbXAuY291bnRfdTY0X3dyaXRlID0gY291bnRlci0+
b3BzLT5jb3VudF93cml0ZTsKKwllcnIgPSBjb3VudGVyX2F0dHJfY3JlYXRlKGRldiwgY2F0dHJf
Z3JvdXAsICZjb21wLCBzY29wZSwgY291bnQpOworCWlmIChlcnIgPCAwKQorCQlyZXR1cm4gZXJy
OworCisJLyogQ3JlYXRlIENvdW50IG5hbWUgYXR0cmlidXRlICovCisJZXJyID0gY291bnRlcl9u
YW1lX2F0dHJfY3JlYXRlKGRldiwgY2F0dHJfZ3JvdXAsIGNvdW50LT5uYW1lKTsKKwlpZiAoZXJy
IDwgMCkKKwkJcmV0dXJuIGVycjsKKworCS8qIENyZWF0ZSBDb3VudCBmdW5jdGlvbiBhdHRyaWJ1
dGUgKi8KKwljb21wID0gY291bnRlcl9mdW5jdGlvbl9jb21wOworCWNvbXAuY291bnRfdTMyX3Jl
YWQgPSBjb3VudGVyLT5vcHMtPmZ1bmN0aW9uX3JlYWQ7CisJY29tcC5jb3VudF91MzJfd3JpdGUg
PSBjb3VudGVyLT5vcHMtPmZ1bmN0aW9uX3dyaXRlOworCWVyciA9IGNvdW50ZXJfYXR0cl9jcmVh
dGUoZGV2LCBjYXR0cl9ncm91cCwgJmNvbXAsIHNjb3BlLCBjb3VudCk7CisJaWYgKGVyciA8IDAp
CisJCXJldHVybiBlcnI7CisKKwkvKiBDcmVhdGUgYW4gYXR0cmlidXRlIGZvciBlYWNoIGV4dGVu
c2lvbiAqLworCWZvciAoaSA9IDA7IGkgPCBjb3VudC0+bnVtX2V4dDsgaSsrKSB7CisJCWVyciA9
IGNvdW50ZXJfYXR0cl9jcmVhdGUoZGV2LCBjYXR0cl9ncm91cCwgY291bnQtPmV4dCArIGksCisJ
CQkJCSAgc2NvcGUsIGNvdW50KTsKKwkJaWYgKGVyciA8IDApCisJCQlyZXR1cm4gZXJyOworCX0K
KworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGNvdW50ZXJfc3lzZnNfY291bnRzX2FkZChz
dHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvbnN0IGNvdW50ZXIsCisJc3RydWN0IGNvdW50ZXJfYXR0
cmlidXRlX2dyb3VwICpjb25zdCBncm91cHMpCit7CisJc2l6ZV90IGk7CisJc3RydWN0IGNvdW50
ZXJfY291bnQgKmNvdW50OworCWludCBlcnI7CisKKwkvKiBBZGQgZWFjaCBDb3VudCAqLworCWZv
ciAoaSA9IDA7IGkgPCBjb3VudGVyLT5udW1fY291bnRzOyBpKyspIHsKKwkJY291bnQgPSBjb3Vu
dGVyLT5jb3VudHMgKyBpOworCisJCS8qIEdlbmVyYXRlIENvdW50IGF0dHJpYnV0ZSBkaXJlY3Rv
cnkgbmFtZSAqLworCQlncm91cHNbaV0ubmFtZSA9IGRldm1fa2FzcHJpbnRmKCZjb3VudGVyLT5k
ZXYsIEdGUF9LRVJORUwsCisJCQkJCQkiY291bnQlenUiLCBpKTsKKwkJaWYgKCFncm91cHNbaV0u
bmFtZSkKKwkJCXJldHVybiAtRU5PTUVNOworCisJCS8qIEFkZCBzeXNmcyBhdHRyaWJ1dGVzIG9m
IHRoZSBTeW5hcHNlcyAqLworCQllcnIgPSBjb3VudGVyX3N5c2ZzX3N5bmFwc2VzX2FkZChjb3Vu
dGVyLCBncm91cHMgKyBpLCBjb3VudCk7CisJCWlmIChlcnIgPCAwKQorCQkJcmV0dXJuIGVycjsK
KworCQkvKiBDcmVhdGUgYWxsIGF0dHJpYnV0ZXMgYXNzb2NpYXRlZCB3aXRoIENvdW50ICovCisJ
CWVyciA9IGNvdW50ZXJfY291bnRfYXR0cnNfY3JlYXRlKGNvdW50ZXIsIGdyb3VwcyArIGksIGNv
dW50KTsKKwkJaWYgKGVyciA8IDApCisJCQlyZXR1cm4gZXJyOworCX0KKworCXJldHVybiAwOwor
fQorCitzdGF0aWMgaW50IGNvdW50ZXJfbnVtX3NpZ25hbHNfcmVhZChzdHJ1Y3QgY291bnRlcl9k
ZXZpY2UgKmNvdW50ZXIsIHU4ICp2YWwpCit7CisJKnZhbCA9IGNvdW50ZXItPm51bV9zaWduYWxz
OworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGNvdW50ZXJfbnVtX2NvdW50c19yZWFkKHN0
cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwgdTggKnZhbCkKK3sKKwkqdmFsID0gY291bnRl
ci0+bnVtX2NvdW50czsKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIHN0cnVjdCBjb3VudGVyX2Nv
bXAgY291bnRlcl9udW1fc2lnbmFsc19jb21wID0KKwlDT1VOVEVSX0NPTVBfREVWSUNFX1U4KCJu
dW1fc2lnbmFscyIsIGNvdW50ZXJfbnVtX3NpZ25hbHNfcmVhZCwgTlVMTCk7CisKK3N0YXRpYyBz
dHJ1Y3QgY291bnRlcl9jb21wIGNvdW50ZXJfbnVtX2NvdW50c19jb21wID0KKwlDT1VOVEVSX0NP
TVBfREVWSUNFX1U4KCJudW1fY291bnRzIiwgY291bnRlcl9udW1fY291bnRzX3JlYWQsIE5VTEwp
OworCitzdGF0aWMgaW50IGNvdW50ZXJfc3lzZnNfYXR0cl9hZGQoc3RydWN0IGNvdW50ZXJfZGV2
aWNlICpjb25zdCBjb3VudGVyLAorCQkJCSAgc3RydWN0IGNvdW50ZXJfYXR0cmlidXRlX2dyb3Vw
ICpjYXR0cl9ncm91cCkKK3sKKwljb25zdCBlbnVtIGNvdW50ZXJfc2NvcGUgc2NvcGUgPSBDT1VO
VEVSX1NDT1BFX0RFVklDRTsKKwlzdHJ1Y3QgZGV2aWNlICpjb25zdCBkZXYgPSAmY291bnRlci0+
ZGV2OworCWludCBlcnI7CisJc2l6ZV90IGk7CisKKwkvKiBBZGQgU2lnbmFscyBzeXNmcyBhdHRy
aWJ1dGVzICovCisJZXJyID0gY291bnRlcl9zeXNmc19zaWduYWxzX2FkZChjb3VudGVyLCBjYXR0
cl9ncm91cCk7CisJaWYgKGVyciA8IDApCisJCXJldHVybiBlcnI7CisJY2F0dHJfZ3JvdXAgKz0g
Y291bnRlci0+bnVtX3NpZ25hbHM7CisKKwkvKiBBZGQgQ291bnRzIHN5c2ZzIGF0dHJpYnV0ZXMg
Ki8KKwllcnIgPSBjb3VudGVyX3N5c2ZzX2NvdW50c19hZGQoY291bnRlciwgY2F0dHJfZ3JvdXAp
OworCWlmIChlcnIgPCAwKQorCQlyZXR1cm4gZXJyOworCWNhdHRyX2dyb3VwICs9IGNvdW50ZXIt
Pm51bV9jb3VudHM7CisKKwkvKiBDcmVhdGUgbmFtZSBhdHRyaWJ1dGUgKi8KKwllcnIgPSBjb3Vu
dGVyX25hbWVfYXR0cl9jcmVhdGUoZGV2LCBjYXR0cl9ncm91cCwgY291bnRlci0+bmFtZSk7CisJ
aWYgKGVyciA8IDApCisJCXJldHVybiBlcnI7CisKKwkvKiBDcmVhdGUgbnVtX3NpZ25hbHMgYXR0
cmlidXRlICovCisJZXJyID0gY291bnRlcl9hdHRyX2NyZWF0ZShkZXYsIGNhdHRyX2dyb3VwLCAm
Y291bnRlcl9udW1fc2lnbmFsc19jb21wLAorCQkJCSAgc2NvcGUsIE5VTEwpOworCWlmIChlcnIg
PCAwKQorCQlyZXR1cm4gZXJyOworCisJLyogQ3JlYXRlIG51bV9jb3VudHMgYXR0cmlidXRlICov
CisJZXJyID0gY291bnRlcl9hdHRyX2NyZWF0ZShkZXYsIGNhdHRyX2dyb3VwLCAmY291bnRlcl9u
dW1fY291bnRzX2NvbXAsCisJCQkJICBzY29wZSwgTlVMTCk7CisJaWYgKGVyciA8IDApCisJCXJl
dHVybiBlcnI7CisKKwkvKiBDcmVhdGUgYW4gYXR0cmlidXRlIGZvciBlYWNoIGV4dGVuc2lvbiAq
LworCWZvciAoaSA9IDA7IGkgPCBjb3VudGVyLT5udW1fZXh0OyBpKyspIHsKKwkJZXJyID0gY291
bnRlcl9hdHRyX2NyZWF0ZShkZXYsIGNhdHRyX2dyb3VwLCBjb3VudGVyLT5leHQgKyBpLAorCQkJ
CQkgIHNjb3BlLCBOVUxMKTsKKwkJaWYgKGVyciA8IDApCisJCQlyZXR1cm4gZXJyOworCX0KKwor
CXJldHVybiAwOworfQorCisvKioKKyAqIGNvdW50ZXJfc3lzZnNfYWRkIC0gQWRkcyBDb3VudGVy
IHN5c2ZzIGF0dHJpYnV0ZXMgdG8gdGhlIGRldmljZSBzdHJ1Y3R1cmUKKyAqIEBjb3VudGVyOglQ
b2ludGVyIHRvIHRoZSBDb3VudGVyIGRldmljZSBzdHJ1Y3R1cmUKKyAqCisgKiBDb3VudGVyIHN5
c2ZzIGF0dHJpYnV0ZXMgYXJlIGNyZWF0ZWQgYW5kIGFkZGVkIHRvIHRoZSByZXNwZWN0aXZlIGRl
dmljZQorICogc3RydWN0dXJlIGZvciBsYXRlciByZWdpc3RyYXRpb24gdG8gdGhlIHN5c3RlbS4g
UmVzb3VyY2UtbWFuYWdlZCBtZW1vcnkKKyAqIGFsbG9jYXRpb24gaXMgcGVyZm9ybWVkIGJ5IHRo
aXMgZnVuY3Rpb24sIGFuZCB0aGlzIG1lbW9yeSBzaG91bGQgYmUgZnJlZWQKKyAqIHdoZW4gbm8g
bG9uZ2VyIG5lZWRlZCAoYXV0b21hdGljYWxseSBieSBhIGRldmljZV91bnJlZ2lzdGVyIGNhbGws
IG9yCisgKiBtYW51YWxseSBieSBhIGRldnJlc19yZWxlYXNlX2FsbCBjYWxsKS4KKyAqLworaW50
IGNvdW50ZXJfc3lzZnNfYWRkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY29uc3QgY291bnRlcikK
K3sKKwlzdHJ1Y3QgZGV2aWNlICpjb25zdCBkZXYgPSAmY291bnRlci0+ZGV2OworCWNvbnN0IHNp
emVfdCBudW1fZ3JvdXBzID0gY291bnRlci0+bnVtX3NpZ25hbHMgKyBjb3VudGVyLT5udW1fY291
bnRzICsgMTsKKwlzdHJ1Y3QgY291bnRlcl9hdHRyaWJ1dGVfZ3JvdXAgKmNhdHRyX2dyb3VwczsK
KwlzaXplX3QgaSwgajsKKwlpbnQgZXJyOworCXN0cnVjdCBhdHRyaWJ1dGVfZ3JvdXAgKmdyb3Vw
czsKKwlzdHJ1Y3QgY291bnRlcl9hdHRyaWJ1dGUgKnA7CisKKwkvKiBBbGxvY2F0ZSBzcGFjZSBm
b3IgYXR0cmlidXRlIGdyb3VwcyAoc2lnbmFscywgY291bnRzLCBhbmQgZXh0KSAqLworCWNhdHRy
X2dyb3VwcyA9IGRldm1fa2NhbGxvYyhkZXYsIG51bV9ncm91cHMsIHNpemVvZigqY2F0dHJfZ3Jv
dXBzKSwKKwkJCQkgICAgR0ZQX0tFUk5FTCk7CisJaWYgKCFjYXR0cl9ncm91cHMpCisJCXJldHVy
biAtRU5PTUVNOworCisJLyogSW5pdGlhbGl6ZSBhdHRyaWJ1dGUgbGlzdHMgKi8KKwlmb3IgKGkg
PSAwOyBpIDwgbnVtX2dyb3VwczsgaSsrKQorCQlJTklUX0xJU1RfSEVBRCgmY2F0dHJfZ3JvdXBz
W2ldLmF0dHJfbGlzdCk7CisKKwkvKiBBZGQgQ291bnRlciBkZXZpY2Ugc3lzZnMgYXR0cmlidXRl
cyAqLworCWVyciA9IGNvdW50ZXJfc3lzZnNfYXR0cl9hZGQoY291bnRlciwgY2F0dHJfZ3JvdXBz
KTsKKwlpZiAoZXJyIDwgMCkKKwkJcmV0dXJuIGVycjsKKworCS8qIEFsbG9jYXRlIGF0dHJpYnV0
ZSBncm91cCBwb2ludGVycyBmb3IgYXNzb2NpYXRpb24gd2l0aCBkZXZpY2UgKi8KKwlkZXYtPmdy
b3VwcyA9IGRldm1fa2NhbGxvYyhkZXYsIG51bV9ncm91cHMgKyAxLCBzaXplb2YoKmRldi0+Z3Jv
dXBzKSwKKwkJCQkgICBHRlBfS0VSTkVMKTsKKwlpZiAoIWRldi0+Z3JvdXBzKQorCQlyZXR1cm4g
LUVOT01FTTsKKworCS8qIEFsbG9jYXRlIHNwYWNlIGZvciBhdHRyaWJ1dGUgZ3JvdXBzICovCisJ
Z3JvdXBzID0gZGV2bV9rY2FsbG9jKGRldiwgbnVtX2dyb3Vwcywgc2l6ZW9mKCpncm91cHMpLCBH
RlBfS0VSTkVMKTsKKwlpZiAoIWdyb3VwcykKKwkJcmV0dXJuIC1FTk9NRU07CisKKwkvKiBQcmVw
YXJlIGVhY2ggZ3JvdXAgb2YgYXR0cmlidXRlcyBmb3IgYXNzb2NpYXRpb24gKi8KKwlmb3IgKGkg
PSAwOyBpIDwgbnVtX2dyb3VwczsgaSsrKSB7CisJCWdyb3Vwc1tpXS5uYW1lID0gY2F0dHJfZ3Jv
dXBzW2ldLm5hbWU7CisKKwkJLyogQWxsb2NhdGUgc3BhY2UgZm9yIGF0dHJpYnV0ZSBwb2ludGVy
cyAqLworCQlncm91cHNbaV0uYXR0cnMgPSBkZXZtX2tjYWxsb2MoZGV2LAorCQkJCQkgICAgICAg
Y2F0dHJfZ3JvdXBzW2ldLm51bV9hdHRyICsgMSwKKwkJCQkJICAgICAgIHNpemVvZigqZ3JvdXBz
W2ldLmF0dHJzKSwKKwkJCQkJICAgICAgIEdGUF9LRVJORUwpOworCQlpZiAoIWdyb3Vwc1tpXS5h
dHRycykKKwkJCXJldHVybiAtRU5PTUVNOworCisJCS8qIEFkZCBhdHRyaWJ1dGUgcG9pbnRlcnMg
dG8gYXR0cmlidXRlIGdyb3VwICovCisJCWogPSAwOworCQlsaXN0X2Zvcl9lYWNoX2VudHJ5KHAs
ICZjYXR0cl9ncm91cHNbaV0uYXR0cl9saXN0LCBsKQorCQkJZ3JvdXBzW2ldLmF0dHJzW2orK10g
PSAmcC0+ZGV2X2F0dHIuYXR0cjsKKworCQkvKiBBc3NvY2lhdGUgYXR0cmlidXRlIGdyb3VwICov
CisJCWRldi0+Z3JvdXBzW2ldID0gJmdyb3Vwc1tpXTsKKwl9CisKKwlyZXR1cm4gMDsKK30KZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvY291bnRlci9jb3VudGVyLXN5c2ZzLmggYi9kcml2ZXJzL2NvdW50
ZXIvY291bnRlci1zeXNmcy5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAw
MC4uMTRmZTU2NmFjYTBlCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9jb3VudGVyL2NvdW50
ZXItc3lzZnMuaApAQCAtMCwwICsxLDEzIEBACisvKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjog
R1BMLTIuMCAqLworLyoKKyAqIENvdW50ZXIgc3lzZnMgaW50ZXJmYWNlCisgKiBDb3B5cmlnaHQg
KEMpIDIwMjAgV2lsbGlhbSBCcmVhdGhpdHQgR3JheQorICovCisjaWZuZGVmIF9DT1VOVEVSX1NZ
U0ZTX0hfCisjZGVmaW5lIF9DT1VOVEVSX1NZU0ZTX0hfCisKKyNpbmNsdWRlIDxsaW51eC9jb3Vu
dGVyLmg+CisKK2ludCBjb3VudGVyX3N5c2ZzX2FkZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNv
bnN0IGNvdW50ZXIpOworCisjZW5kaWYgLyogX0NPVU5URVJfU1lTRlNfSF8gKi8KZGlmZiAtLWdp
dCBhL2RyaXZlcnMvY291bnRlci9jb3VudGVyLmMgYi9kcml2ZXJzL2NvdW50ZXIvY291bnRlci5j
CmRlbGV0ZWQgZmlsZSBtb2RlIDEwMDY0NAppbmRleCBkZTkyMWU4YTNmNzIuLjAwMDAwMDAwMDAw
MAotLS0gYS9kcml2ZXJzL2NvdW50ZXIvY291bnRlci5jCisrKyAvZGV2L251bGwKQEAgLTEsMTQ5
NiArMCwwIEBACi0vLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMAotLyoKLSAqIEdl
bmVyaWMgQ291bnRlciBpbnRlcmZhY2UKLSAqIENvcHlyaWdodCAoQykgMjAxOCBXaWxsaWFtIEJy
ZWF0aGl0dCBHcmF5Ci0gKi8KLSNpbmNsdWRlIDxsaW51eC9jb3VudGVyLmg+Ci0jaW5jbHVkZSA8
bGludXgvZGV2aWNlLmg+Ci0jaW5jbHVkZSA8bGludXgvZXJyLmg+Ci0jaW5jbHVkZSA8bGludXgv
ZXhwb3J0Lmg+Ci0jaW5jbHVkZSA8bGludXgvZnMuaD4KLSNpbmNsdWRlIDxsaW51eC9nZnAuaD4K
LSNpbmNsdWRlIDxsaW51eC9pZHIuaD4KLSNpbmNsdWRlIDxsaW51eC9pbml0Lmg+Ci0jaW5jbHVk
ZSA8bGludXgva2VybmVsLmg+Ci0jaW5jbHVkZSA8bGludXgvbGlzdC5oPgotI2luY2x1ZGUgPGxp
bnV4L21vZHVsZS5oPgotI2luY2x1ZGUgPGxpbnV4L3ByaW50ay5oPgotI2luY2x1ZGUgPGxpbnV4
L3NsYWIuaD4KLSNpbmNsdWRlIDxsaW51eC9zdHJpbmcuaD4KLSNpbmNsdWRlIDxsaW51eC9zeXNm
cy5oPgotI2luY2x1ZGUgPGxpbnV4L3R5cGVzLmg+Ci0KLWNvbnN0IGNoYXIgKmNvbnN0IGNvdW50
ZXJfY291bnRfZGlyZWN0aW9uX3N0clsyXSA9IHsKLQlbQ09VTlRFUl9DT1VOVF9ESVJFQ1RJT05f
Rk9SV0FSRF0gPSAiZm9yd2FyZCIsCi0JW0NPVU5URVJfQ09VTlRfRElSRUNUSU9OX0JBQ0tXQVJE
XSA9ICJiYWNrd2FyZCIKLX07Ci1FWFBPUlRfU1lNQk9MX0dQTChjb3VudGVyX2NvdW50X2RpcmVj
dGlvbl9zdHIpOwotCi1jb25zdCBjaGFyICpjb25zdCBjb3VudGVyX2NvdW50X21vZGVfc3RyWzRd
ID0gewotCVtDT1VOVEVSX0NPVU5UX01PREVfTk9STUFMXSA9ICJub3JtYWwiLAotCVtDT1VOVEVS
X0NPVU5UX01PREVfUkFOR0VfTElNSVRdID0gInJhbmdlIGxpbWl0IiwKLQlbQ09VTlRFUl9DT1VO
VF9NT0RFX05PTl9SRUNZQ0xFXSA9ICJub24tcmVjeWNsZSIsCi0JW0NPVU5URVJfQ09VTlRfTU9E
RV9NT0RVTE9fTl0gPSAibW9kdWxvLW4iCi19OwotRVhQT1JUX1NZTUJPTF9HUEwoY291bnRlcl9j
b3VudF9tb2RlX3N0cik7Ci0KLXNzaXplX3QgY291bnRlcl9zaWduYWxfZW51bV9yZWFkKHN0cnVj
dCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQkgc3RydWN0IGNvdW50ZXJfc2lnbmFsICpz
aWduYWwsIHZvaWQgKnByaXYsCi0JCQkJIGNoYXIgKmJ1ZikKLXsKLQljb25zdCBzdHJ1Y3QgY291
bnRlcl9zaWduYWxfZW51bV9leHQgKmNvbnN0IGUgPSBwcml2OwotCWludCBlcnI7Ci0Jc2l6ZV90
IGluZGV4OwotCi0JaWYgKCFlLT5nZXQpCi0JCXJldHVybiAtRUlOVkFMOwotCi0JZXJyID0gZS0+
Z2V0KGNvdW50ZXIsIHNpZ25hbCwgJmluZGV4KTsKLQlpZiAoZXJyKQotCQlyZXR1cm4gZXJyOwot
Ci0JaWYgKGluZGV4ID49IGUtPm51bV9pdGVtcykKLQkJcmV0dXJuIC1FSU5WQUw7Ci0KLQlyZXR1
cm4gc3ByaW50ZihidWYsICIlc1xuIiwgZS0+aXRlbXNbaW5kZXhdKTsKLX0KLUVYUE9SVF9TWU1C
T0xfR1BMKGNvdW50ZXJfc2lnbmFsX2VudW1fcmVhZCk7Ci0KLXNzaXplX3QgY291bnRlcl9zaWdu
YWxfZW51bV93cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkJICBzdHJ1
Y3QgY291bnRlcl9zaWduYWwgKnNpZ25hbCwgdm9pZCAqcHJpdiwKLQkJCQkgIGNvbnN0IGNoYXIg
KmJ1Ziwgc2l6ZV90IGxlbikKLXsKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9zaWduYWxfZW51bV9l
eHQgKmNvbnN0IGUgPSBwcml2OwotCXNzaXplX3QgaW5kZXg7Ci0JaW50IGVycjsKLQotCWlmICgh
ZS0+c2V0KQotCQlyZXR1cm4gLUVJTlZBTDsKLQotCWluZGV4ID0gX19zeXNmc19tYXRjaF9zdHJp
bmcoZS0+aXRlbXMsIGUtPm51bV9pdGVtcywgYnVmKTsKLQlpZiAoaW5kZXggPCAwKQotCQlyZXR1
cm4gaW5kZXg7Ci0KLQllcnIgPSBlLT5zZXQoY291bnRlciwgc2lnbmFsLCBpbmRleCk7Ci0JaWYg
KGVycikKLQkJcmV0dXJuIGVycjsKLQotCXJldHVybiBsZW47Ci19Ci1FWFBPUlRfU1lNQk9MX0dQ
TChjb3VudGVyX3NpZ25hbF9lbnVtX3dyaXRlKTsKLQotc3NpemVfdCBjb3VudGVyX3NpZ25hbF9l
bnVtX2F2YWlsYWJsZV9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQkJ
ICAgc3RydWN0IGNvdW50ZXJfc2lnbmFsICpzaWduYWwsCi0JCQkJCSAgIHZvaWQgKnByaXYsIGNo
YXIgKmJ1ZikKLXsKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9zaWduYWxfZW51bV9leHQgKmNvbnN0
IGUgPSBwcml2OwotCXNpemVfdCBpOwotCXNpemVfdCBsZW4gPSAwOwotCi0JaWYgKCFlLT5udW1f
aXRlbXMpCi0JCXJldHVybiAwOwotCi0JZm9yIChpID0gMDsgaSA8IGUtPm51bV9pdGVtczsgaSsr
KQotCQlsZW4gKz0gc3ByaW50ZihidWYgKyBsZW4sICIlc1xuIiwgZS0+aXRlbXNbaV0pOwotCi0J
cmV0dXJuIGxlbjsKLX0KLUVYUE9SVF9TWU1CT0xfR1BMKGNvdW50ZXJfc2lnbmFsX2VudW1fYXZh
aWxhYmxlX3JlYWQpOwotCi1zc2l6ZV90IGNvdW50ZXJfY291bnRfZW51bV9yZWFkKHN0cnVjdCBj
b3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQlzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQs
IHZvaWQgKnByaXYsCi0JCQkJY2hhciAqYnVmKQotewotCWNvbnN0IHN0cnVjdCBjb3VudGVyX2Nv
dW50X2VudW1fZXh0ICpjb25zdCBlID0gcHJpdjsKLQlpbnQgZXJyOwotCXNpemVfdCBpbmRleDsK
LQotCWlmICghZS0+Z2V0KQotCQlyZXR1cm4gLUVJTlZBTDsKLQotCWVyciA9IGUtPmdldChjb3Vu
dGVyLCBjb3VudCwgJmluZGV4KTsKLQlpZiAoZXJyKQotCQlyZXR1cm4gZXJyOwotCi0JaWYgKGlu
ZGV4ID49IGUtPm51bV9pdGVtcykKLQkJcmV0dXJuIC1FSU5WQUw7Ci0KLQlyZXR1cm4gc3ByaW50
ZihidWYsICIlc1xuIiwgZS0+aXRlbXNbaW5kZXhdKTsKLX0KLUVYUE9SVF9TWU1CT0xfR1BMKGNv
dW50ZXJfY291bnRfZW51bV9yZWFkKTsKLQotc3NpemVfdCBjb3VudGVyX2NvdW50X2VudW1fd3Jp
dGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCSBzdHJ1Y3QgY291bnRlcl9j
b3VudCAqY291bnQsIHZvaWQgKnByaXYsCi0JCQkJIGNvbnN0IGNoYXIgKmJ1Ziwgc2l6ZV90IGxl
bikKLXsKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9jb3VudF9lbnVtX2V4dCAqY29uc3QgZSA9IHBy
aXY7Ci0Jc3NpemVfdCBpbmRleDsKLQlpbnQgZXJyOwotCi0JaWYgKCFlLT5zZXQpCi0JCXJldHVy
biAtRUlOVkFMOwotCi0JaW5kZXggPSBfX3N5c2ZzX21hdGNoX3N0cmluZyhlLT5pdGVtcywgZS0+
bnVtX2l0ZW1zLCBidWYpOwotCWlmIChpbmRleCA8IDApCi0JCXJldHVybiBpbmRleDsKLQotCWVy
ciA9IGUtPnNldChjb3VudGVyLCBjb3VudCwgaW5kZXgpOwotCWlmIChlcnIpCi0JCXJldHVybiBl
cnI7Ci0KLQlyZXR1cm4gbGVuOwotfQotRVhQT1JUX1NZTUJPTF9HUEwoY291bnRlcl9jb3VudF9l
bnVtX3dyaXRlKTsKLQotc3NpemVfdCBjb3VudGVyX2NvdW50X2VudW1fYXZhaWxhYmxlX3JlYWQo
c3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCQkgIHN0cnVjdCBjb3VudGVyX2Nv
dW50ICpjb3VudCwKLQkJCQkJICB2b2lkICpwcml2LCBjaGFyICpidWYpCi17Ci0JY29uc3Qgc3Ry
dWN0IGNvdW50ZXJfY291bnRfZW51bV9leHQgKmNvbnN0IGUgPSBwcml2OwotCXNpemVfdCBpOwot
CXNpemVfdCBsZW4gPSAwOwotCi0JaWYgKCFlLT5udW1faXRlbXMpCi0JCXJldHVybiAwOwotCi0J
Zm9yIChpID0gMDsgaSA8IGUtPm51bV9pdGVtczsgaSsrKQotCQlsZW4gKz0gc3ByaW50ZihidWYg
KyBsZW4sICIlc1xuIiwgZS0+aXRlbXNbaV0pOwotCi0JcmV0dXJuIGxlbjsKLX0KLUVYUE9SVF9T
WU1CT0xfR1BMKGNvdW50ZXJfY291bnRfZW51bV9hdmFpbGFibGVfcmVhZCk7Ci0KLXNzaXplX3Qg
Y291bnRlcl9kZXZpY2VfZW51bV9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwg
dm9pZCAqcHJpdiwKLQkJCQkgY2hhciAqYnVmKQotewotCWNvbnN0IHN0cnVjdCBjb3VudGVyX2Rl
dmljZV9lbnVtX2V4dCAqY29uc3QgZSA9IHByaXY7Ci0JaW50IGVycjsKLQlzaXplX3QgaW5kZXg7
Ci0KLQlpZiAoIWUtPmdldCkKLQkJcmV0dXJuIC1FSU5WQUw7Ci0KLQllcnIgPSBlLT5nZXQoY291
bnRlciwgJmluZGV4KTsKLQlpZiAoZXJyKQotCQlyZXR1cm4gZXJyOwotCi0JaWYgKGluZGV4ID49
IGUtPm51bV9pdGVtcykKLQkJcmV0dXJuIC1FSU5WQUw7Ci0KLQlyZXR1cm4gc3ByaW50ZihidWYs
ICIlc1xuIiwgZS0+aXRlbXNbaW5kZXhdKTsKLX0KLUVYUE9SVF9TWU1CT0xfR1BMKGNvdW50ZXJf
ZGV2aWNlX2VudW1fcmVhZCk7Ci0KLXNzaXplX3QgY291bnRlcl9kZXZpY2VfZW51bV93cml0ZShz
dHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsIHZvaWQgKnByaXYsCi0JCQkJICBjb25zdCBj
aGFyICpidWYsIHNpemVfdCBsZW4pCi17Ci0JY29uc3Qgc3RydWN0IGNvdW50ZXJfZGV2aWNlX2Vu
dW1fZXh0ICpjb25zdCBlID0gcHJpdjsKLQlzc2l6ZV90IGluZGV4OwotCWludCBlcnI7Ci0KLQlp
ZiAoIWUtPnNldCkKLQkJcmV0dXJuIC1FSU5WQUw7Ci0KLQlpbmRleCA9IF9fc3lzZnNfbWF0Y2hf
c3RyaW5nKGUtPml0ZW1zLCBlLT5udW1faXRlbXMsIGJ1Zik7Ci0JaWYgKGluZGV4IDwgMCkKLQkJ
cmV0dXJuIGluZGV4OwotCi0JZXJyID0gZS0+c2V0KGNvdW50ZXIsIGluZGV4KTsKLQlpZiAoZXJy
KQotCQlyZXR1cm4gZXJyOwotCi0JcmV0dXJuIGxlbjsKLX0KLUVYUE9SVF9TWU1CT0xfR1BMKGNv
dW50ZXJfZGV2aWNlX2VudW1fd3JpdGUpOwotCi1zc2l6ZV90IGNvdW50ZXJfZGV2aWNlX2VudW1f
YXZhaWxhYmxlX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCQkgICB2
b2lkICpwcml2LCBjaGFyICpidWYpCi17Ci0JY29uc3Qgc3RydWN0IGNvdW50ZXJfZGV2aWNlX2Vu
dW1fZXh0ICpjb25zdCBlID0gcHJpdjsKLQlzaXplX3QgaTsKLQlzaXplX3QgbGVuID0gMDsKLQot
CWlmICghZS0+bnVtX2l0ZW1zKQotCQlyZXR1cm4gMDsKLQotCWZvciAoaSA9IDA7IGkgPCBlLT5u
dW1faXRlbXM7IGkrKykKLQkJbGVuICs9IHNwcmludGYoYnVmICsgbGVuLCAiJXNcbiIsIGUtPml0
ZW1zW2ldKTsKLQotCXJldHVybiBsZW47Ci19Ci1FWFBPUlRfU1lNQk9MX0dQTChjb3VudGVyX2Rl
dmljZV9lbnVtX2F2YWlsYWJsZV9yZWFkKTsKLQotc3RydWN0IGNvdW50ZXJfYXR0cl9wYXJtIHsK
LQlzdHJ1Y3QgY291bnRlcl9kZXZpY2VfYXR0cl9ncm91cCAqZ3JvdXA7Ci0JY29uc3QgY2hhciAq
cHJlZml4OwotCWNvbnN0IGNoYXIgKm5hbWU7Ci0Jc3NpemVfdCAoKnNob3cpKHN0cnVjdCBkZXZp
Y2UgKmRldiwgc3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIsCi0JCQljaGFyICpidWYpOwot
CXNzaXplX3QgKCpzdG9yZSkoc3RydWN0IGRldmljZSAqZGV2LCBzdHJ1Y3QgZGV2aWNlX2F0dHJp
YnV0ZSAqYXR0ciwKLQkJCSBjb25zdCBjaGFyICpidWYsIHNpemVfdCBsZW4pOwotCXZvaWQgKmNv
bXBvbmVudDsKLX07Ci0KLXN0cnVjdCBjb3VudGVyX2RldmljZV9hdHRyIHsKLQlzdHJ1Y3QgZGV2
aWNlX2F0dHJpYnV0ZSBkZXZfYXR0cjsKLQlzdHJ1Y3QgbGlzdF9oZWFkIGw7Ci0Jdm9pZCAqY29t
cG9uZW50OwotfTsKLQotc3RhdGljIGludCBjb3VudGVyX2F0dHJpYnV0ZV9jcmVhdGUoY29uc3Qg
c3RydWN0IGNvdW50ZXJfYXR0cl9wYXJtICpjb25zdCBwYXJtKQotewotCXN0cnVjdCBjb3VudGVy
X2RldmljZV9hdHRyICpjb3VudGVyX2F0dHI7Ci0Jc3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmRl
dl9hdHRyOwotCWludCBlcnI7Ci0Jc3RydWN0IGxpc3RfaGVhZCAqY29uc3QgYXR0cl9saXN0ID0g
JnBhcm0tPmdyb3VwLT5hdHRyX2xpc3Q7Ci0KLQkvKiBBbGxvY2F0ZSBhIENvdW50ZXIgZGV2aWNl
IGF0dHJpYnV0ZSAqLwotCWNvdW50ZXJfYXR0ciA9IGt6YWxsb2Moc2l6ZW9mKCpjb3VudGVyX2F0
dHIpLCBHRlBfS0VSTkVMKTsKLQlpZiAoIWNvdW50ZXJfYXR0cikKLQkJcmV0dXJuIC1FTk9NRU07
Ci0JZGV2X2F0dHIgPSAmY291bnRlcl9hdHRyLT5kZXZfYXR0cjsKLQotCXN5c2ZzX2F0dHJfaW5p
dCgmZGV2X2F0dHItPmF0dHIpOwotCi0JLyogQ29uZmlndXJlIGRldmljZSBhdHRyaWJ1dGUgKi8K
LQlkZXZfYXR0ci0+YXR0ci5uYW1lID0ga2FzcHJpbnRmKEdGUF9LRVJORUwsICIlcyVzIiwgcGFy
bS0+cHJlZml4LAotCQkJCQlwYXJtLT5uYW1lKTsKLQlpZiAoIWRldl9hdHRyLT5hdHRyLm5hbWUp
IHsKLQkJZXJyID0gLUVOT01FTTsKLQkJZ290byBlcnJfZnJlZV9jb3VudGVyX2F0dHI7Ci0JfQot
CWlmIChwYXJtLT5zaG93KSB7Ci0JCWRldl9hdHRyLT5hdHRyLm1vZGUgfD0gMDQ0NDsKLQkJZGV2
X2F0dHItPnNob3cgPSBwYXJtLT5zaG93OwotCX0KLQlpZiAocGFybS0+c3RvcmUpIHsKLQkJZGV2
X2F0dHItPmF0dHIubW9kZSB8PSAwMjAwOwotCQlkZXZfYXR0ci0+c3RvcmUgPSBwYXJtLT5zdG9y
ZTsKLQl9Ci0KLQkvKiBTdG9yZSBhc3NvY2lhdGVkIENvdW50ZXIgY29tcG9uZW50IHdpdGggYXR0
cmlidXRlICovCi0JY291bnRlcl9hdHRyLT5jb21wb25lbnQgPSBwYXJtLT5jb21wb25lbnQ7Ci0K
LQkvKiBLZWVwIHRyYWNrIG9mIHRoZSBhdHRyaWJ1dGUgZm9yIGxhdGVyIGNsZWFudXAgKi8KLQls
aXN0X2FkZCgmY291bnRlcl9hdHRyLT5sLCBhdHRyX2xpc3QpOwotCXBhcm0tPmdyb3VwLT5udW1f
YXR0cisrOwotCi0JcmV0dXJuIDA7Ci0KLWVycl9mcmVlX2NvdW50ZXJfYXR0cjoKLQlrZnJlZShj
b3VudGVyX2F0dHIpOwotCXJldHVybiBlcnI7Ci19Ci0KLSNkZWZpbmUgdG9fY291bnRlcl9hdHRy
KF9kZXZfYXR0cikgXAotCWNvbnRhaW5lcl9vZihfZGV2X2F0dHIsIHN0cnVjdCBjb3VudGVyX2Rl
dmljZV9hdHRyLCBkZXZfYXR0cikKLQotc3RydWN0IGNvdW50ZXJfc2lnbmFsX3VuaXQgewotCXN0
cnVjdCBjb3VudGVyX3NpZ25hbCAqc2lnbmFsOwotfTsKLQotc3RhdGljIGNvbnN0IGNoYXIgKmNv
bnN0IGNvdW50ZXJfc2lnbmFsX2xldmVsX3N0cltdID0gewotCVtDT1VOVEVSX1NJR05BTF9MRVZF
TF9MT1ddID0gImxvdyIsCi0JW0NPVU5URVJfU0lHTkFMX0xFVkVMX0hJR0hdID0gImhpZ2giCi19
OwotCi1zdGF0aWMgc3NpemVfdCBjb3VudGVyX3NpZ25hbF9zaG93KHN0cnVjdCBkZXZpY2UgKmRl
diwKLQkJCQkgICBzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSAqYXR0ciwgY2hhciAqYnVmKQotewot
CXN0cnVjdCBjb3VudGVyX2RldmljZSAqY29uc3QgY291bnRlciA9IGRldl9nZXRfZHJ2ZGF0YShk
ZXYpOwotCWNvbnN0IHN0cnVjdCBjb3VudGVyX2RldmljZV9hdHRyICpjb25zdCBkZXZhdHRyID0g
dG9fY291bnRlcl9hdHRyKGF0dHIpOwotCWNvbnN0IHN0cnVjdCBjb3VudGVyX3NpZ25hbF91bml0
ICpjb25zdCBjb21wb25lbnQgPSBkZXZhdHRyLT5jb21wb25lbnQ7Ci0Jc3RydWN0IGNvdW50ZXJf
c2lnbmFsICpjb25zdCBzaWduYWwgPSBjb21wb25lbnQtPnNpZ25hbDsKLQlpbnQgZXJyOwotCWVu
dW0gY291bnRlcl9zaWduYWxfbGV2ZWwgbGV2ZWw7Ci0KLQllcnIgPSBjb3VudGVyLT5vcHMtPnNp
Z25hbF9yZWFkKGNvdW50ZXIsIHNpZ25hbCwgJmxldmVsKTsKLQlpZiAoZXJyKQotCQlyZXR1cm4g
ZXJyOwotCi0JcmV0dXJuIHNwcmludGYoYnVmLCAiJXNcbiIsIGNvdW50ZXJfc2lnbmFsX2xldmVs
X3N0cltsZXZlbF0pOwotfQotCi1zdHJ1Y3QgY291bnRlcl9uYW1lX3VuaXQgewotCWNvbnN0IGNo
YXIgKm5hbWU7Ci19OwotCi1zdGF0aWMgc3NpemVfdCBjb3VudGVyX2RldmljZV9hdHRyX25hbWVf
c2hvdyhzdHJ1Y3QgZGV2aWNlICpkZXYsCi0JCQkJCSAgICAgc3RydWN0IGRldmljZV9hdHRyaWJ1
dGUgKmF0dHIsCi0JCQkJCSAgICAgY2hhciAqYnVmKQotewotCWNvbnN0IHN0cnVjdCBjb3VudGVy
X25hbWVfdW5pdCAqY29uc3QgY29tcCA9IHRvX2NvdW50ZXJfYXR0cihhdHRyKS0+Y29tcG9uZW50
OwotCi0JcmV0dXJuIHNwcmludGYoYnVmLCAiJXNcbiIsIGNvbXAtPm5hbWUpOwotfQotCi1zdGF0
aWMgaW50IGNvdW50ZXJfbmFtZV9hdHRyaWJ1dGVfY3JlYXRlKAotCXN0cnVjdCBjb3VudGVyX2Rl
dmljZV9hdHRyX2dyb3VwICpjb25zdCBncm91cCwKLQljb25zdCBjaGFyICpjb25zdCBuYW1lKQot
ewotCXN0cnVjdCBjb3VudGVyX25hbWVfdW5pdCAqbmFtZV9jb21wOwotCXN0cnVjdCBjb3VudGVy
X2F0dHJfcGFybSBwYXJtOwotCWludCBlcnI7Ci0KLQkvKiBTa2lwIGlmIG5vIG5hbWUgKi8KLQlp
ZiAoIW5hbWUpCi0JCXJldHVybiAwOwotCi0JLyogQWxsb2NhdGUgbmFtZSBhdHRyaWJ1dGUgY29t
cG9uZW50ICovCi0JbmFtZV9jb21wID0ga21hbGxvYyhzaXplb2YoKm5hbWVfY29tcCksIEdGUF9L
RVJORUwpOwotCWlmICghbmFtZV9jb21wKQotCQlyZXR1cm4gLUVOT01FTTsKLQluYW1lX2NvbXAt
Pm5hbWUgPSBuYW1lOwotCi0JLyogQWxsb2NhdGUgU2lnbmFsIG5hbWUgYXR0cmlidXRlICovCi0J
cGFybS5ncm91cCA9IGdyb3VwOwotCXBhcm0ucHJlZml4ID0gIiI7Ci0JcGFybS5uYW1lID0gIm5h
bWUiOwotCXBhcm0uc2hvdyA9IGNvdW50ZXJfZGV2aWNlX2F0dHJfbmFtZV9zaG93OwotCXBhcm0u
c3RvcmUgPSBOVUxMOwotCXBhcm0uY29tcG9uZW50ID0gbmFtZV9jb21wOwotCWVyciA9IGNvdW50
ZXJfYXR0cmlidXRlX2NyZWF0ZSgmcGFybSk7Ci0JaWYgKGVycikKLQkJZ290byBlcnJfZnJlZV9u
YW1lX2NvbXA7Ci0KLQlyZXR1cm4gMDsKLQotZXJyX2ZyZWVfbmFtZV9jb21wOgotCWtmcmVlKG5h
bWVfY29tcCk7Ci0JcmV0dXJuIGVycjsKLX0KLQotc3RydWN0IGNvdW50ZXJfc2lnbmFsX2V4dF91
bml0IHsKLQlzdHJ1Y3QgY291bnRlcl9zaWduYWwgKnNpZ25hbDsKLQljb25zdCBzdHJ1Y3QgY291
bnRlcl9zaWduYWxfZXh0ICpleHQ7Ci19OwotCi1zdGF0aWMgc3NpemVfdCBjb3VudGVyX3NpZ25h
bF9leHRfc2hvdyhzdHJ1Y3QgZGV2aWNlICpkZXYsCi0JCQkJICAgICAgIHN0cnVjdCBkZXZpY2Vf
YXR0cmlidXRlICphdHRyLCBjaGFyICpidWYpCi17Ci0JY29uc3Qgc3RydWN0IGNvdW50ZXJfZGV2
aWNlX2F0dHIgKmNvbnN0IGRldmF0dHIgPSB0b19jb3VudGVyX2F0dHIoYXR0cik7Ci0JY29uc3Qg
c3RydWN0IGNvdW50ZXJfc2lnbmFsX2V4dF91bml0ICpjb25zdCBjb21wID0gZGV2YXR0ci0+Y29t
cG9uZW50OwotCWNvbnN0IHN0cnVjdCBjb3VudGVyX3NpZ25hbF9leHQgKmNvbnN0IGV4dCA9IGNv
bXAtPmV4dDsKLQotCXJldHVybiBleHQtPnJlYWQoZGV2X2dldF9kcnZkYXRhKGRldiksIGNvbXAt
PnNpZ25hbCwgZXh0LT5wcml2LCBidWYpOwotfQotCi1zdGF0aWMgc3NpemVfdCBjb3VudGVyX3Np
Z25hbF9leHRfc3RvcmUoc3RydWN0IGRldmljZSAqZGV2LAotCQkJCQlzdHJ1Y3QgZGV2aWNlX2F0
dHJpYnV0ZSAqYXR0ciwKLQkJCQkJY29uc3QgY2hhciAqYnVmLCBzaXplX3QgbGVuKQotewotCWNv
bnN0IHN0cnVjdCBjb3VudGVyX2RldmljZV9hdHRyICpjb25zdCBkZXZhdHRyID0gdG9fY291bnRl
cl9hdHRyKGF0dHIpOwotCWNvbnN0IHN0cnVjdCBjb3VudGVyX3NpZ25hbF9leHRfdW5pdCAqY29u
c3QgY29tcCA9IGRldmF0dHItPmNvbXBvbmVudDsKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9zaWdu
YWxfZXh0ICpjb25zdCBleHQgPSBjb21wLT5leHQ7Ci0KLQlyZXR1cm4gZXh0LT53cml0ZShkZXZf
Z2V0X2RydmRhdGEoZGV2KSwgY29tcC0+c2lnbmFsLCBleHQtPnByaXYsIGJ1ZiwKLQkJbGVuKTsK
LX0KLQotc3RhdGljIHZvaWQgY291bnRlcl9kZXZpY2VfYXR0cl9saXN0X2ZyZWUoc3RydWN0IGxp
c3RfaGVhZCAqYXR0cl9saXN0KQotewotCXN0cnVjdCBjb3VudGVyX2RldmljZV9hdHRyICpwLCAq
bjsKLQotCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShwLCBuLCBhdHRyX2xpc3QsIGwpIHsKLQkJ
LyogZnJlZSBhdHRyaWJ1dGUgbmFtZSBhbmQgYXNzb2NpYXRlZCBjb21wb25lbnQgbWVtb3J5ICov
Ci0JCWtmcmVlKHAtPmRldl9hdHRyLmF0dHIubmFtZSk7Ci0JCWtmcmVlKHAtPmNvbXBvbmVudCk7
Ci0JCWxpc3RfZGVsKCZwLT5sKTsKLQkJa2ZyZWUocCk7Ci0JfQotfQotCi1zdGF0aWMgaW50IGNv
dW50ZXJfc2lnbmFsX2V4dF9yZWdpc3RlcigKLQlzdHJ1Y3QgY291bnRlcl9kZXZpY2VfYXR0cl9n
cm91cCAqY29uc3QgZ3JvdXAsCi0Jc3RydWN0IGNvdW50ZXJfc2lnbmFsICpjb25zdCBzaWduYWwp
Ci17Ci0JY29uc3Qgc2l6ZV90IG51bV9leHQgPSBzaWduYWwtPm51bV9leHQ7Ci0Jc2l6ZV90IGk7
Ci0JY29uc3Qgc3RydWN0IGNvdW50ZXJfc2lnbmFsX2V4dCAqZXh0OwotCXN0cnVjdCBjb3VudGVy
X3NpZ25hbF9leHRfdW5pdCAqc2lnbmFsX2V4dF9jb21wOwotCXN0cnVjdCBjb3VudGVyX2F0dHJf
cGFybSBwYXJtOwotCWludCBlcnI7Ci0KLQkvKiBDcmVhdGUgYW4gYXR0cmlidXRlIGZvciBlYWNo
IGV4dGVuc2lvbiAqLwotCWZvciAoaSA9IDAgOyBpIDwgbnVtX2V4dDsgaSsrKSB7Ci0JCWV4dCA9
IHNpZ25hbC0+ZXh0ICsgaTsKLQotCQkvKiBBbGxvY2F0ZSBzaWduYWxfZXh0IGF0dHJpYnV0ZSBj
b21wb25lbnQgKi8KLQkJc2lnbmFsX2V4dF9jb21wID0ga21hbGxvYyhzaXplb2YoKnNpZ25hbF9l
eHRfY29tcCksIEdGUF9LRVJORUwpOwotCQlpZiAoIXNpZ25hbF9leHRfY29tcCkgewotCQkJZXJy
ID0gLUVOT01FTTsKLQkJCWdvdG8gZXJyX2ZyZWVfYXR0cl9saXN0OwotCQl9Ci0JCXNpZ25hbF9l
eHRfY29tcC0+c2lnbmFsID0gc2lnbmFsOwotCQlzaWduYWxfZXh0X2NvbXAtPmV4dCA9IGV4dDsK
LQotCQkvKiBBbGxvY2F0ZSBhIENvdW50ZXIgZGV2aWNlIGF0dHJpYnV0ZSAqLwotCQlwYXJtLmdy
b3VwID0gZ3JvdXA7Ci0JCXBhcm0ucHJlZml4ID0gIiI7Ci0JCXBhcm0ubmFtZSA9IGV4dC0+bmFt
ZTsKLQkJcGFybS5zaG93ID0gKGV4dC0+cmVhZCkgPyBjb3VudGVyX3NpZ25hbF9leHRfc2hvdyA6
IE5VTEw7Ci0JCXBhcm0uc3RvcmUgPSAoZXh0LT53cml0ZSkgPyBjb3VudGVyX3NpZ25hbF9leHRf
c3RvcmUgOiBOVUxMOwotCQlwYXJtLmNvbXBvbmVudCA9IHNpZ25hbF9leHRfY29tcDsKLQkJZXJy
ID0gY291bnRlcl9hdHRyaWJ1dGVfY3JlYXRlKCZwYXJtKTsKLQkJaWYgKGVycikgewotCQkJa2Zy
ZWUoc2lnbmFsX2V4dF9jb21wKTsKLQkJCWdvdG8gZXJyX2ZyZWVfYXR0cl9saXN0OwotCQl9Ci0J
fQotCi0JcmV0dXJuIDA7Ci0KLWVycl9mcmVlX2F0dHJfbGlzdDoKLQljb3VudGVyX2RldmljZV9h
dHRyX2xpc3RfZnJlZSgmZ3JvdXAtPmF0dHJfbGlzdCk7Ci0JcmV0dXJuIGVycjsKLX0KLQotc3Rh
dGljIGludCBjb3VudGVyX3NpZ25hbF9hdHRyaWJ1dGVzX2NyZWF0ZSgKLQlzdHJ1Y3QgY291bnRl
cl9kZXZpY2VfYXR0cl9ncm91cCAqY29uc3QgZ3JvdXAsCi0JY29uc3Qgc3RydWN0IGNvdW50ZXJf
ZGV2aWNlICpjb25zdCBjb3VudGVyLAotCXN0cnVjdCBjb3VudGVyX3NpZ25hbCAqY29uc3Qgc2ln
bmFsKQotewotCXN0cnVjdCBjb3VudGVyX3NpZ25hbF91bml0ICpzaWduYWxfY29tcDsKLQlzdHJ1
Y3QgY291bnRlcl9hdHRyX3Bhcm0gcGFybTsKLQlpbnQgZXJyOwotCi0JLyogQWxsb2NhdGUgU2ln
bmFsIGF0dHJpYnV0ZSBjb21wb25lbnQgKi8KLQlzaWduYWxfY29tcCA9IGttYWxsb2Moc2l6ZW9m
KCpzaWduYWxfY29tcCksIEdGUF9LRVJORUwpOwotCWlmICghc2lnbmFsX2NvbXApCi0JCXJldHVy
biAtRU5PTUVNOwotCXNpZ25hbF9jb21wLT5zaWduYWwgPSBzaWduYWw7Ci0KLQkvKiBDcmVhdGUg
bWFpbiBTaWduYWwgYXR0cmlidXRlICovCi0JcGFybS5ncm91cCA9IGdyb3VwOwotCXBhcm0ucHJl
Zml4ID0gIiI7Ci0JcGFybS5uYW1lID0gInNpZ25hbCI7Ci0JcGFybS5zaG93ID0gKGNvdW50ZXIt
Pm9wcy0+c2lnbmFsX3JlYWQpID8gY291bnRlcl9zaWduYWxfc2hvdyA6IE5VTEw7Ci0JcGFybS5z
dG9yZSA9IE5VTEw7Ci0JcGFybS5jb21wb25lbnQgPSBzaWduYWxfY29tcDsKLQllcnIgPSBjb3Vu
dGVyX2F0dHJpYnV0ZV9jcmVhdGUoJnBhcm0pOwotCWlmIChlcnIpIHsKLQkJa2ZyZWUoc2lnbmFs
X2NvbXApOwotCQlyZXR1cm4gZXJyOwotCX0KLQotCS8qIENyZWF0ZSBTaWduYWwgbmFtZSBhdHRy
aWJ1dGUgKi8KLQllcnIgPSBjb3VudGVyX25hbWVfYXR0cmlidXRlX2NyZWF0ZShncm91cCwgc2ln
bmFsLT5uYW1lKTsKLQlpZiAoZXJyKQotCQlnb3RvIGVycl9mcmVlX2F0dHJfbGlzdDsKLQotCS8q
IFJlZ2lzdGVyIFNpZ25hbCBleHRlbnNpb24gYXR0cmlidXRlcyAqLwotCWVyciA9IGNvdW50ZXJf
c2lnbmFsX2V4dF9yZWdpc3Rlcihncm91cCwgc2lnbmFsKTsKLQlpZiAoZXJyKQotCQlnb3RvIGVy
cl9mcmVlX2F0dHJfbGlzdDsKLQotCXJldHVybiAwOwotCi1lcnJfZnJlZV9hdHRyX2xpc3Q6Ci0J
Y291bnRlcl9kZXZpY2VfYXR0cl9saXN0X2ZyZWUoJmdyb3VwLT5hdHRyX2xpc3QpOwotCXJldHVy
biBlcnI7Ci19Ci0KLXN0YXRpYyBpbnQgY291bnRlcl9zaWduYWxzX3JlZ2lzdGVyKAotCXN0cnVj
dCBjb3VudGVyX2RldmljZV9hdHRyX2dyb3VwICpjb25zdCBncm91cHNfbGlzdCwKLQljb25zdCBz
dHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvbnN0IGNvdW50ZXIpCi17Ci0JY29uc3Qgc2l6ZV90IG51
bV9zaWduYWxzID0gY291bnRlci0+bnVtX3NpZ25hbHM7Ci0Jc2l6ZV90IGk7Ci0Jc3RydWN0IGNv
dW50ZXJfc2lnbmFsICpzaWduYWw7Ci0JY29uc3QgY2hhciAqbmFtZTsKLQlpbnQgZXJyOwotCi0J
LyogUmVnaXN0ZXIgZWFjaCBTaWduYWwgKi8KLQlmb3IgKGkgPSAwOyBpIDwgbnVtX3NpZ25hbHM7
IGkrKykgewotCQlzaWduYWwgPSBjb3VudGVyLT5zaWduYWxzICsgaTsKLQotCQkvKiBHZW5lcmF0
ZSBTaWduYWwgYXR0cmlidXRlIGRpcmVjdG9yeSBuYW1lICovCi0JCW5hbWUgPSBrYXNwcmludGYo
R0ZQX0tFUk5FTCwgInNpZ25hbCVkIiwgc2lnbmFsLT5pZCk7Ci0JCWlmICghbmFtZSkgewotCQkJ
ZXJyID0gLUVOT01FTTsKLQkJCWdvdG8gZXJyX2ZyZWVfYXR0cl9ncm91cHM7Ci0JCX0KLQkJZ3Jv
dXBzX2xpc3RbaV0uYXR0cl9ncm91cC5uYW1lID0gbmFtZTsKLQotCQkvKiBDcmVhdGUgYWxsIGF0
dHJpYnV0ZXMgYXNzb2NpYXRlZCB3aXRoIFNpZ25hbCAqLwotCQllcnIgPSBjb3VudGVyX3NpZ25h
bF9hdHRyaWJ1dGVzX2NyZWF0ZShncm91cHNfbGlzdCArIGksIGNvdW50ZXIsCi0JCQkJCQkgICAg
ICAgc2lnbmFsKTsKLQkJaWYgKGVycikKLQkJCWdvdG8gZXJyX2ZyZWVfYXR0cl9ncm91cHM7Ci0J
fQotCi0JcmV0dXJuIDA7Ci0KLWVycl9mcmVlX2F0dHJfZ3JvdXBzOgotCWRvIHsKLQkJa2ZyZWUo
Z3JvdXBzX2xpc3RbaV0uYXR0cl9ncm91cC5uYW1lKTsKLQkJY291bnRlcl9kZXZpY2VfYXR0cl9s
aXN0X2ZyZWUoJmdyb3Vwc19saXN0W2ldLmF0dHJfbGlzdCk7Ci0JfSB3aGlsZSAoaS0tKTsKLQly
ZXR1cm4gZXJyOwotfQotCi1zdGF0aWMgY29uc3QgY2hhciAqY29uc3QgY291bnRlcl9zeW5hcHNl
X2FjdGlvbl9zdHJbXSA9IHsKLQlbQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9OT05FXSA9ICJub25l
IiwKLQlbQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9SSVNJTkdfRURHRV0gPSAicmlzaW5nIGVkZ2Ui
LAotCVtDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX0ZBTExJTkdfRURHRV0gPSAiZmFsbGluZyBlZGdl
IiwKLQlbQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9CT1RIX0VER0VTXSA9ICJib3RoIGVkZ2VzIgot
fTsKLQotc3RydWN0IGNvdW50ZXJfYWN0aW9uX3VuaXQgewotCXN0cnVjdCBjb3VudGVyX3N5bmFw
c2UgKnN5bmFwc2U7Ci0Jc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50OwotfTsKLQotc3RhdGlj
IHNzaXplX3QgY291bnRlcl9hY3Rpb25fc2hvdyhzdHJ1Y3QgZGV2aWNlICpkZXYsCi0JCQkJICAg
c3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIsIGNoYXIgKmJ1ZikKLXsKLQljb25zdCBzdHJ1
Y3QgY291bnRlcl9kZXZpY2VfYXR0ciAqY29uc3QgZGV2YXR0ciA9IHRvX2NvdW50ZXJfYXR0cihh
dHRyKTsKLQlpbnQgZXJyOwotCXN0cnVjdCBjb3VudGVyX2RldmljZSAqY29uc3QgY291bnRlciA9
IGRldl9nZXRfZHJ2ZGF0YShkZXYpOwotCWNvbnN0IHN0cnVjdCBjb3VudGVyX2FjdGlvbl91bml0
ICpjb25zdCBjb21wb25lbnQgPSBkZXZhdHRyLT5jb21wb25lbnQ7Ci0Jc3RydWN0IGNvdW50ZXJf
Y291bnQgKmNvbnN0IGNvdW50ID0gY29tcG9uZW50LT5jb3VudDsKLQlzdHJ1Y3QgY291bnRlcl9z
eW5hcHNlICpjb25zdCBzeW5hcHNlID0gY29tcG9uZW50LT5zeW5hcHNlOwotCXNpemVfdCBhY3Rp
b25faW5kZXg7Ci0JZW51bSBjb3VudGVyX3N5bmFwc2VfYWN0aW9uIGFjdGlvbjsKLQotCWVyciA9
IGNvdW50ZXItPm9wcy0+YWN0aW9uX2dldChjb3VudGVyLCBjb3VudCwgc3luYXBzZSwgJmFjdGlv
bl9pbmRleCk7Ci0JaWYgKGVycikKLQkJcmV0dXJuIGVycjsKLQotCXN5bmFwc2UtPmFjdGlvbiA9
IGFjdGlvbl9pbmRleDsKLQotCWFjdGlvbiA9IHN5bmFwc2UtPmFjdGlvbnNfbGlzdFthY3Rpb25f
aW5kZXhdOwotCXJldHVybiBzcHJpbnRmKGJ1ZiwgIiVzXG4iLCBjb3VudGVyX3N5bmFwc2VfYWN0
aW9uX3N0clthY3Rpb25dKTsKLX0KLQotc3RhdGljIHNzaXplX3QgY291bnRlcl9hY3Rpb25fc3Rv
cmUoc3RydWN0IGRldmljZSAqZGV2LAotCQkJCSAgICBzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSAq
YXR0ciwKLQkJCQkgICAgY29uc3QgY2hhciAqYnVmLCBzaXplX3QgbGVuKQotewotCWNvbnN0IHN0
cnVjdCBjb3VudGVyX2RldmljZV9hdHRyICpjb25zdCBkZXZhdHRyID0gdG9fY291bnRlcl9hdHRy
KGF0dHIpOwotCWNvbnN0IHN0cnVjdCBjb3VudGVyX2FjdGlvbl91bml0ICpjb25zdCBjb21wb25l
bnQgPSBkZXZhdHRyLT5jb21wb25lbnQ7Ci0Jc3RydWN0IGNvdW50ZXJfc3luYXBzZSAqY29uc3Qg
c3luYXBzZSA9IGNvbXBvbmVudC0+c3luYXBzZTsKLQlzaXplX3QgYWN0aW9uX2luZGV4OwotCWNv
bnN0IHNpemVfdCBudW1fYWN0aW9ucyA9IHN5bmFwc2UtPm51bV9hY3Rpb25zOwotCWVudW0gY291
bnRlcl9zeW5hcHNlX2FjdGlvbiBhY3Rpb247Ci0JaW50IGVycjsKLQlzdHJ1Y3QgY291bnRlcl9k
ZXZpY2UgKmNvbnN0IGNvdW50ZXIgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsKLQlzdHJ1Y3QgY291
bnRlcl9jb3VudCAqY29uc3QgY291bnQgPSBjb21wb25lbnQtPmNvdW50OwotCi0JLyogRmluZCBy
ZXF1ZXN0ZWQgYWN0aW9uIG1vZGUgKi8KLQlmb3IgKGFjdGlvbl9pbmRleCA9IDA7IGFjdGlvbl9p
bmRleCA8IG51bV9hY3Rpb25zOyBhY3Rpb25faW5kZXgrKykgewotCQlhY3Rpb24gPSBzeW5hcHNl
LT5hY3Rpb25zX2xpc3RbYWN0aW9uX2luZGV4XTsKLQkJaWYgKHN5c2ZzX3N0cmVxKGJ1ZiwgY291
bnRlcl9zeW5hcHNlX2FjdGlvbl9zdHJbYWN0aW9uXSkpCi0JCQlicmVhazsKLQl9Ci0JLyogSWYg
cmVxdWVzdGVkIGFjdGlvbiBtb2RlIG5vdCBmb3VuZCAqLwotCWlmIChhY3Rpb25faW5kZXggPj0g
bnVtX2FjdGlvbnMpCi0JCXJldHVybiAtRUlOVkFMOwotCi0JZXJyID0gY291bnRlci0+b3BzLT5h
Y3Rpb25fc2V0KGNvdW50ZXIsIGNvdW50LCBzeW5hcHNlLCBhY3Rpb25faW5kZXgpOwotCWlmIChl
cnIpCi0JCXJldHVybiBlcnI7Ci0KLQlzeW5hcHNlLT5hY3Rpb24gPSBhY3Rpb25faW5kZXg7Ci0K
LQlyZXR1cm4gbGVuOwotfQotCi1zdHJ1Y3QgY291bnRlcl9hY3Rpb25fYXZhaWxfdW5pdCB7Ci0J
Y29uc3QgZW51bSBjb3VudGVyX3N5bmFwc2VfYWN0aW9uICphY3Rpb25zX2xpc3Q7Ci0Jc2l6ZV90
IG51bV9hY3Rpb25zOwotfTsKLQotc3RhdGljIHNzaXplX3QgY291bnRlcl9zeW5hcHNlX2FjdGlv
bl9hdmFpbGFibGVfc2hvdyhzdHJ1Y3QgZGV2aWNlICpkZXYsCi0Jc3RydWN0IGRldmljZV9hdHRy
aWJ1dGUgKmF0dHIsIGNoYXIgKmJ1ZikKLXsKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9kZXZpY2Vf
YXR0ciAqY29uc3QgZGV2YXR0ciA9IHRvX2NvdW50ZXJfYXR0cihhdHRyKTsKLQljb25zdCBzdHJ1
Y3QgY291bnRlcl9hY3Rpb25fYXZhaWxfdW5pdCAqY29uc3QgY29tcG9uZW50ID0gZGV2YXR0ci0+
Y29tcG9uZW50OwotCXNpemVfdCBpOwotCWVudW0gY291bnRlcl9zeW5hcHNlX2FjdGlvbiBhY3Rp
b247Ci0Jc3NpemVfdCBsZW4gPSAwOwotCi0JZm9yIChpID0gMDsgaSA8IGNvbXBvbmVudC0+bnVt
X2FjdGlvbnM7IGkrKykgewotCQlhY3Rpb24gPSBjb21wb25lbnQtPmFjdGlvbnNfbGlzdFtpXTsK
LQkJbGVuICs9IHNwcmludGYoYnVmICsgbGVuLCAiJXNcbiIsCi0JCQkgICAgICAgY291bnRlcl9z
eW5hcHNlX2FjdGlvbl9zdHJbYWN0aW9uXSk7Ci0JfQotCi0JcmV0dXJuIGxlbjsKLX0KLQotc3Rh
dGljIGludCBjb3VudGVyX3N5bmFwc2VzX3JlZ2lzdGVyKAotCXN0cnVjdCBjb3VudGVyX2Rldmlj
ZV9hdHRyX2dyb3VwICpjb25zdCBncm91cCwKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9kZXZpY2Ug
KmNvbnN0IGNvdW50ZXIsCi0Jc3RydWN0IGNvdW50ZXJfY291bnQgKmNvbnN0IGNvdW50LCBjb25z
dCBjaGFyICpjb25zdCBjb3VudF9hdHRyX25hbWUpCi17Ci0Jc2l6ZV90IGk7Ci0Jc3RydWN0IGNv
dW50ZXJfc3luYXBzZSAqc3luYXBzZTsKLQljb25zdCBjaGFyICpwcmVmaXg7Ci0Jc3RydWN0IGNv
dW50ZXJfYWN0aW9uX3VuaXQgKmFjdGlvbl9jb21wOwotCXN0cnVjdCBjb3VudGVyX2F0dHJfcGFy
bSBwYXJtOwotCWludCBlcnI7Ci0Jc3RydWN0IGNvdW50ZXJfYWN0aW9uX2F2YWlsX3VuaXQgKmF2
YWlsX2NvbXA7Ci0KLQkvKiBSZWdpc3RlciBlYWNoIFN5bmFwc2UgKi8KLQlmb3IgKGkgPSAwOyBp
IDwgY291bnQtPm51bV9zeW5hcHNlczsgaSsrKSB7Ci0JCXN5bmFwc2UgPSBjb3VudC0+c3luYXBz
ZXMgKyBpOwotCi0JCS8qIEdlbmVyYXRlIGF0dHJpYnV0ZSBwcmVmaXggKi8KLQkJcHJlZml4ID0g
a2FzcHJpbnRmKEdGUF9LRVJORUwsICJzaWduYWwlZF8iLAotCQkJCSAgIHN5bmFwc2UtPnNpZ25h
bC0+aWQpOwotCQlpZiAoIXByZWZpeCkgewotCQkJZXJyID0gLUVOT01FTTsKLQkJCWdvdG8gZXJy
X2ZyZWVfYXR0cl9saXN0OwotCQl9Ci0KLQkJLyogQWxsb2NhdGUgYWN0aW9uIGF0dHJpYnV0ZSBj
b21wb25lbnQgKi8KLQkJYWN0aW9uX2NvbXAgPSBrbWFsbG9jKHNpemVvZigqYWN0aW9uX2NvbXAp
LCBHRlBfS0VSTkVMKTsKLQkJaWYgKCFhY3Rpb25fY29tcCkgewotCQkJZXJyID0gLUVOT01FTTsK
LQkJCWdvdG8gZXJyX2ZyZWVfcHJlZml4OwotCQl9Ci0JCWFjdGlvbl9jb21wLT5zeW5hcHNlID0g
c3luYXBzZTsKLQkJYWN0aW9uX2NvbXAtPmNvdW50ID0gY291bnQ7Ci0KLQkJLyogQ3JlYXRlIGFj
dGlvbiBhdHRyaWJ1dGUgKi8KLQkJcGFybS5ncm91cCA9IGdyb3VwOwotCQlwYXJtLnByZWZpeCA9
IHByZWZpeDsKLQkJcGFybS5uYW1lID0gImFjdGlvbiI7Ci0JCXBhcm0uc2hvdyA9IChjb3VudGVy
LT5vcHMtPmFjdGlvbl9nZXQpID8gY291bnRlcl9hY3Rpb25fc2hvdyA6IE5VTEw7Ci0JCXBhcm0u
c3RvcmUgPSAoY291bnRlci0+b3BzLT5hY3Rpb25fc2V0KSA/IGNvdW50ZXJfYWN0aW9uX3N0b3Jl
IDogTlVMTDsKLQkJcGFybS5jb21wb25lbnQgPSBhY3Rpb25fY29tcDsKLQkJZXJyID0gY291bnRl
cl9hdHRyaWJ1dGVfY3JlYXRlKCZwYXJtKTsKLQkJaWYgKGVycikgewotCQkJa2ZyZWUoYWN0aW9u
X2NvbXApOwotCQkJZ290byBlcnJfZnJlZV9wcmVmaXg7Ci0JCX0KLQotCQkvKiBBbGxvY2F0ZSBh
Y3Rpb24gYXZhaWxhYmxlIGF0dHJpYnV0ZSBjb21wb25lbnQgKi8KLQkJYXZhaWxfY29tcCA9IGtt
YWxsb2Moc2l6ZW9mKCphdmFpbF9jb21wKSwgR0ZQX0tFUk5FTCk7Ci0JCWlmICghYXZhaWxfY29t
cCkgewotCQkJZXJyID0gLUVOT01FTTsKLQkJCWdvdG8gZXJyX2ZyZWVfcHJlZml4OwotCQl9Ci0J
CWF2YWlsX2NvbXAtPmFjdGlvbnNfbGlzdCA9IHN5bmFwc2UtPmFjdGlvbnNfbGlzdDsKLQkJYXZh
aWxfY29tcC0+bnVtX2FjdGlvbnMgPSBzeW5hcHNlLT5udW1fYWN0aW9uczsKLQotCQkvKiBDcmVh
dGUgYWN0aW9uX2F2YWlsYWJsZSBhdHRyaWJ1dGUgKi8KLQkJcGFybS5ncm91cCA9IGdyb3VwOwot
CQlwYXJtLnByZWZpeCA9IHByZWZpeDsKLQkJcGFybS5uYW1lID0gImFjdGlvbl9hdmFpbGFibGUi
OwotCQlwYXJtLnNob3cgPSBjb3VudGVyX3N5bmFwc2VfYWN0aW9uX2F2YWlsYWJsZV9zaG93Owot
CQlwYXJtLnN0b3JlID0gTlVMTDsKLQkJcGFybS5jb21wb25lbnQgPSBhdmFpbF9jb21wOwotCQll
cnIgPSBjb3VudGVyX2F0dHJpYnV0ZV9jcmVhdGUoJnBhcm0pOwotCQlpZiAoZXJyKSB7Ci0JCQlr
ZnJlZShhdmFpbF9jb21wKTsKLQkJCWdvdG8gZXJyX2ZyZWVfcHJlZml4OwotCQl9Ci0KLQkJa2Zy
ZWUocHJlZml4KTsKLQl9Ci0KLQlyZXR1cm4gMDsKLQotZXJyX2ZyZWVfcHJlZml4OgotCWtmcmVl
KHByZWZpeCk7Ci1lcnJfZnJlZV9hdHRyX2xpc3Q6Ci0JY291bnRlcl9kZXZpY2VfYXR0cl9saXN0
X2ZyZWUoJmdyb3VwLT5hdHRyX2xpc3QpOwotCXJldHVybiBlcnI7Ci19Ci0KLXN0cnVjdCBjb3Vu
dGVyX2NvdW50X3VuaXQgewotCXN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudDsKLX07Ci0KLXN0
YXRpYyBzc2l6ZV90IGNvdW50ZXJfY291bnRfc2hvdyhzdHJ1Y3QgZGV2aWNlICpkZXYsCi0JCQkJ
ICBzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSAqYXR0ciwKLQkJCQkgIGNoYXIgKmJ1ZikKLXsKLQlz
dHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvbnN0IGNvdW50ZXIgPSBkZXZfZ2V0X2RydmRhdGEoZGV2
KTsKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9kZXZpY2VfYXR0ciAqY29uc3QgZGV2YXR0ciA9IHRv
X2NvdW50ZXJfYXR0cihhdHRyKTsKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9jb3VudF91bml0ICpj
b25zdCBjb21wb25lbnQgPSBkZXZhdHRyLT5jb21wb25lbnQ7Ci0Jc3RydWN0IGNvdW50ZXJfY291
bnQgKmNvbnN0IGNvdW50ID0gY29tcG9uZW50LT5jb3VudDsKLQlpbnQgZXJyOwotCXVuc2lnbmVk
IGxvbmcgdmFsOwotCi0JZXJyID0gY291bnRlci0+b3BzLT5jb3VudF9yZWFkKGNvdW50ZXIsIGNv
dW50LCAmdmFsKTsKLQlpZiAoZXJyKQotCQlyZXR1cm4gZXJyOwotCi0JcmV0dXJuIHNwcmludGYo
YnVmLCAiJWx1XG4iLCB2YWwpOwotfQotCi1zdGF0aWMgc3NpemVfdCBjb3VudGVyX2NvdW50X3N0
b3JlKHN0cnVjdCBkZXZpY2UgKmRldiwKLQkJCQkgICBzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSAq
YXR0ciwKLQkJCQkgICBjb25zdCBjaGFyICpidWYsIHNpemVfdCBsZW4pCi17Ci0Jc3RydWN0IGNv
dW50ZXJfZGV2aWNlICpjb25zdCBjb3VudGVyID0gZGV2X2dldF9kcnZkYXRhKGRldik7Ci0JY29u
c3Qgc3RydWN0IGNvdW50ZXJfZGV2aWNlX2F0dHIgKmNvbnN0IGRldmF0dHIgPSB0b19jb3VudGVy
X2F0dHIoYXR0cik7Ci0JY29uc3Qgc3RydWN0IGNvdW50ZXJfY291bnRfdW5pdCAqY29uc3QgY29t
cG9uZW50ID0gZGV2YXR0ci0+Y29tcG9uZW50OwotCXN0cnVjdCBjb3VudGVyX2NvdW50ICpjb25z
dCBjb3VudCA9IGNvbXBvbmVudC0+Y291bnQ7Ci0JaW50IGVycjsKLQl1bnNpZ25lZCBsb25nIHZh
bDsKLQotCWVyciA9IGtzdHJ0b3VsKGJ1ZiwgMCwgJnZhbCk7Ci0JaWYgKGVycikKLQkJcmV0dXJu
IGVycjsKLQotCWVyciA9IGNvdW50ZXItPm9wcy0+Y291bnRfd3JpdGUoY291bnRlciwgY291bnQs
IHZhbCk7Ci0JaWYgKGVycikKLQkJcmV0dXJuIGVycjsKLQotCXJldHVybiBsZW47Ci19Ci0KLXN0
YXRpYyBjb25zdCBjaGFyICpjb25zdCBjb3VudGVyX2Z1bmN0aW9uX3N0cltdID0gewotCVtDT1VO
VEVSX0ZVTkNUSU9OX0lOQ1JFQVNFXSA9ICJpbmNyZWFzZSIsCi0JW0NPVU5URVJfRlVOQ1RJT05f
REVDUkVBU0VdID0gImRlY3JlYXNlIiwKLQlbQ09VTlRFUl9GVU5DVElPTl9QVUxTRV9ESVJFQ1RJ
T05dID0gInB1bHNlLWRpcmVjdGlvbiIsCi0JW0NPVU5URVJfRlVOQ1RJT05fUVVBRFJBVFVSRV9Y
MV9BXSA9ICJxdWFkcmF0dXJlIHgxIGEiLAotCVtDT1VOVEVSX0ZVTkNUSU9OX1FVQURSQVRVUkVf
WDFfQl0gPSAicXVhZHJhdHVyZSB4MSBiIiwKLQlbQ09VTlRFUl9GVU5DVElPTl9RVUFEUkFUVVJF
X1gyX0FdID0gInF1YWRyYXR1cmUgeDIgYSIsCi0JW0NPVU5URVJfRlVOQ1RJT05fUVVBRFJBVFVS
RV9YMl9CXSA9ICJxdWFkcmF0dXJlIHgyIGIiLAotCVtDT1VOVEVSX0ZVTkNUSU9OX1FVQURSQVRV
UkVfWDRdID0gInF1YWRyYXR1cmUgeDQiCi19OwotCi1zdGF0aWMgc3NpemVfdCBjb3VudGVyX2Z1
bmN0aW9uX3Nob3coc3RydWN0IGRldmljZSAqZGV2LAotCQkJCSAgICAgc3RydWN0IGRldmljZV9h
dHRyaWJ1dGUgKmF0dHIsIGNoYXIgKmJ1ZikKLXsKLQlpbnQgZXJyOwotCXN0cnVjdCBjb3VudGVy
X2RldmljZSAqY29uc3QgY291bnRlciA9IGRldl9nZXRfZHJ2ZGF0YShkZXYpOwotCWNvbnN0IHN0
cnVjdCBjb3VudGVyX2RldmljZV9hdHRyICpjb25zdCBkZXZhdHRyID0gdG9fY291bnRlcl9hdHRy
KGF0dHIpOwotCWNvbnN0IHN0cnVjdCBjb3VudGVyX2NvdW50X3VuaXQgKmNvbnN0IGNvbXBvbmVu
dCA9IGRldmF0dHItPmNvbXBvbmVudDsKLQlzdHJ1Y3QgY291bnRlcl9jb3VudCAqY29uc3QgY291
bnQgPSBjb21wb25lbnQtPmNvdW50OwotCXNpemVfdCBmdW5jX2luZGV4OwotCWVudW0gY291bnRl
cl9mdW5jdGlvbiBmdW5jdGlvbjsKLQotCWVyciA9IGNvdW50ZXItPm9wcy0+ZnVuY3Rpb25fZ2V0
KGNvdW50ZXIsIGNvdW50LCAmZnVuY19pbmRleCk7Ci0JaWYgKGVycikKLQkJcmV0dXJuIGVycjsK
LQotCWNvdW50LT5mdW5jdGlvbiA9IGZ1bmNfaW5kZXg7Ci0KLQlmdW5jdGlvbiA9IGNvdW50LT5m
dW5jdGlvbnNfbGlzdFtmdW5jX2luZGV4XTsKLQlyZXR1cm4gc3ByaW50ZihidWYsICIlc1xuIiwg
Y291bnRlcl9mdW5jdGlvbl9zdHJbZnVuY3Rpb25dKTsKLX0KLQotc3RhdGljIHNzaXplX3QgY291
bnRlcl9mdW5jdGlvbl9zdG9yZShzdHJ1Y3QgZGV2aWNlICpkZXYsCi0JCQkJICAgICAgc3RydWN0
IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIsCi0JCQkJICAgICAgY29uc3QgY2hhciAqYnVmLCBzaXpl
X3QgbGVuKQotewotCWNvbnN0IHN0cnVjdCBjb3VudGVyX2RldmljZV9hdHRyICpjb25zdCBkZXZh
dHRyID0gdG9fY291bnRlcl9hdHRyKGF0dHIpOwotCWNvbnN0IHN0cnVjdCBjb3VudGVyX2NvdW50
X3VuaXQgKmNvbnN0IGNvbXBvbmVudCA9IGRldmF0dHItPmNvbXBvbmVudDsKLQlzdHJ1Y3QgY291
bnRlcl9jb3VudCAqY29uc3QgY291bnQgPSBjb21wb25lbnQtPmNvdW50OwotCWNvbnN0IHNpemVf
dCBudW1fZnVuY3Rpb25zID0gY291bnQtPm51bV9mdW5jdGlvbnM7Ci0Jc2l6ZV90IGZ1bmNfaW5k
ZXg7Ci0JZW51bSBjb3VudGVyX2Z1bmN0aW9uIGZ1bmN0aW9uOwotCWludCBlcnI7Ci0Jc3RydWN0
IGNvdW50ZXJfZGV2aWNlICpjb25zdCBjb3VudGVyID0gZGV2X2dldF9kcnZkYXRhKGRldik7Ci0K
LQkvKiBGaW5kIHJlcXVlc3RlZCBDb3VudCBmdW5jdGlvbiBtb2RlICovCi0JZm9yIChmdW5jX2lu
ZGV4ID0gMDsgZnVuY19pbmRleCA8IG51bV9mdW5jdGlvbnM7IGZ1bmNfaW5kZXgrKykgewotCQlm
dW5jdGlvbiA9IGNvdW50LT5mdW5jdGlvbnNfbGlzdFtmdW5jX2luZGV4XTsKLQkJaWYgKHN5c2Zz
X3N0cmVxKGJ1ZiwgY291bnRlcl9mdW5jdGlvbl9zdHJbZnVuY3Rpb25dKSkKLQkJCWJyZWFrOwot
CX0KLQkvKiBSZXR1cm4gZXJyb3IgaWYgcmVxdWVzdGVkIENvdW50IGZ1bmN0aW9uIG1vZGUgbm90
IGZvdW5kICovCi0JaWYgKGZ1bmNfaW5kZXggPj0gbnVtX2Z1bmN0aW9ucykKLQkJcmV0dXJuIC1F
SU5WQUw7Ci0KLQllcnIgPSBjb3VudGVyLT5vcHMtPmZ1bmN0aW9uX3NldChjb3VudGVyLCBjb3Vu
dCwgZnVuY19pbmRleCk7Ci0JaWYgKGVycikKLQkJcmV0dXJuIGVycjsKLQotCWNvdW50LT5mdW5j
dGlvbiA9IGZ1bmNfaW5kZXg7Ci0KLQlyZXR1cm4gbGVuOwotfQotCi1zdHJ1Y3QgY291bnRlcl9j
b3VudF9leHRfdW5pdCB7Ci0Jc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50OwotCWNvbnN0IHN0
cnVjdCBjb3VudGVyX2NvdW50X2V4dCAqZXh0OwotfTsKLQotc3RhdGljIHNzaXplX3QgY291bnRl
cl9jb3VudF9leHRfc2hvdyhzdHJ1Y3QgZGV2aWNlICpkZXYsCi0JCQkJICAgICAgc3RydWN0IGRl
dmljZV9hdHRyaWJ1dGUgKmF0dHIsIGNoYXIgKmJ1ZikKLXsKLQljb25zdCBzdHJ1Y3QgY291bnRl
cl9kZXZpY2VfYXR0ciAqY29uc3QgZGV2YXR0ciA9IHRvX2NvdW50ZXJfYXR0cihhdHRyKTsKLQlj
b25zdCBzdHJ1Y3QgY291bnRlcl9jb3VudF9leHRfdW5pdCAqY29uc3QgY29tcCA9IGRldmF0dHIt
PmNvbXBvbmVudDsKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9jb3VudF9leHQgKmNvbnN0IGV4dCA9
IGNvbXAtPmV4dDsKLQotCXJldHVybiBleHQtPnJlYWQoZGV2X2dldF9kcnZkYXRhKGRldiksIGNv
bXAtPmNvdW50LCBleHQtPnByaXYsIGJ1Zik7Ci19Ci0KLXN0YXRpYyBzc2l6ZV90IGNvdW50ZXJf
Y291bnRfZXh0X3N0b3JlKHN0cnVjdCBkZXZpY2UgKmRldiwKLQkJCQkgICAgICAgc3RydWN0IGRl
dmljZV9hdHRyaWJ1dGUgKmF0dHIsCi0JCQkJICAgICAgIGNvbnN0IGNoYXIgKmJ1Ziwgc2l6ZV90
IGxlbikKLXsKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9kZXZpY2VfYXR0ciAqY29uc3QgZGV2YXR0
ciA9IHRvX2NvdW50ZXJfYXR0cihhdHRyKTsKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9jb3VudF9l
eHRfdW5pdCAqY29uc3QgY29tcCA9IGRldmF0dHItPmNvbXBvbmVudDsKLQljb25zdCBzdHJ1Y3Qg
Y291bnRlcl9jb3VudF9leHQgKmNvbnN0IGV4dCA9IGNvbXAtPmV4dDsKLQotCXJldHVybiBleHQt
PndyaXRlKGRldl9nZXRfZHJ2ZGF0YShkZXYpLCBjb21wLT5jb3VudCwgZXh0LT5wcml2LCBidWYs
Ci0JCWxlbik7Ci19Ci0KLXN0YXRpYyBpbnQgY291bnRlcl9jb3VudF9leHRfcmVnaXN0ZXIoCi0J
c3RydWN0IGNvdW50ZXJfZGV2aWNlX2F0dHJfZ3JvdXAgKmNvbnN0IGdyb3VwLAotCXN0cnVjdCBj
b3VudGVyX2NvdW50ICpjb25zdCBjb3VudCkKLXsKLQlzaXplX3QgaTsKLQljb25zdCBzdHJ1Y3Qg
Y291bnRlcl9jb3VudF9leHQgKmV4dDsKLQlzdHJ1Y3QgY291bnRlcl9jb3VudF9leHRfdW5pdCAq
Y291bnRfZXh0X2NvbXA7Ci0Jc3RydWN0IGNvdW50ZXJfYXR0cl9wYXJtIHBhcm07Ci0JaW50IGVy
cjsKLQotCS8qIENyZWF0ZSBhbiBhdHRyaWJ1dGUgZm9yIGVhY2ggZXh0ZW5zaW9uICovCi0JZm9y
IChpID0gMCA7IGkgPCBjb3VudC0+bnVtX2V4dDsgaSsrKSB7Ci0JCWV4dCA9IGNvdW50LT5leHQg
KyBpOwotCi0JCS8qIEFsbG9jYXRlIGNvdW50X2V4dCBhdHRyaWJ1dGUgY29tcG9uZW50ICovCi0J
CWNvdW50X2V4dF9jb21wID0ga21hbGxvYyhzaXplb2YoKmNvdW50X2V4dF9jb21wKSwgR0ZQX0tF
Uk5FTCk7Ci0JCWlmICghY291bnRfZXh0X2NvbXApIHsKLQkJCWVyciA9IC1FTk9NRU07Ci0JCQln
b3RvIGVycl9mcmVlX2F0dHJfbGlzdDsKLQkJfQotCQljb3VudF9leHRfY29tcC0+Y291bnQgPSBj
b3VudDsKLQkJY291bnRfZXh0X2NvbXAtPmV4dCA9IGV4dDsKLQotCQkvKiBBbGxvY2F0ZSBjb3Vu
dF9leHQgYXR0cmlidXRlICovCi0JCXBhcm0uZ3JvdXAgPSBncm91cDsKLQkJcGFybS5wcmVmaXgg
PSAiIjsKLQkJcGFybS5uYW1lID0gZXh0LT5uYW1lOwotCQlwYXJtLnNob3cgPSAoZXh0LT5yZWFk
KSA/IGNvdW50ZXJfY291bnRfZXh0X3Nob3cgOiBOVUxMOwotCQlwYXJtLnN0b3JlID0gKGV4dC0+
d3JpdGUpID8gY291bnRlcl9jb3VudF9leHRfc3RvcmUgOiBOVUxMOwotCQlwYXJtLmNvbXBvbmVu
dCA9IGNvdW50X2V4dF9jb21wOwotCQllcnIgPSBjb3VudGVyX2F0dHJpYnV0ZV9jcmVhdGUoJnBh
cm0pOwotCQlpZiAoZXJyKSB7Ci0JCQlrZnJlZShjb3VudF9leHRfY29tcCk7Ci0JCQlnb3RvIGVy
cl9mcmVlX2F0dHJfbGlzdDsKLQkJfQotCX0KLQotCXJldHVybiAwOwotCi1lcnJfZnJlZV9hdHRy
X2xpc3Q6Ci0JY291bnRlcl9kZXZpY2VfYXR0cl9saXN0X2ZyZWUoJmdyb3VwLT5hdHRyX2xpc3Qp
OwotCXJldHVybiBlcnI7Ci19Ci0KLXN0cnVjdCBjb3VudGVyX2Z1bmNfYXZhaWxfdW5pdCB7Ci0J
Y29uc3QgZW51bSBjb3VudGVyX2Z1bmN0aW9uICpmdW5jdGlvbnNfbGlzdDsKLQlzaXplX3QgbnVt
X2Z1bmN0aW9uczsKLX07Ci0KLXN0YXRpYyBzc2l6ZV90IGNvdW50ZXJfZnVuY3Rpb25fYXZhaWxh
YmxlX3Nob3coc3RydWN0IGRldmljZSAqZGV2LAotCXN0cnVjdCBkZXZpY2VfYXR0cmlidXRlICph
dHRyLCBjaGFyICpidWYpCi17Ci0JY29uc3Qgc3RydWN0IGNvdW50ZXJfZGV2aWNlX2F0dHIgKmNv
bnN0IGRldmF0dHIgPSB0b19jb3VudGVyX2F0dHIoYXR0cik7Ci0JY29uc3Qgc3RydWN0IGNvdW50
ZXJfZnVuY19hdmFpbF91bml0ICpjb25zdCBjb21wb25lbnQgPSBkZXZhdHRyLT5jb21wb25lbnQ7
Ci0JY29uc3QgZW51bSBjb3VudGVyX2Z1bmN0aW9uICpjb25zdCBmdW5jX2xpc3QgPSBjb21wb25l
bnQtPmZ1bmN0aW9uc19saXN0OwotCWNvbnN0IHNpemVfdCBudW1fZnVuY3Rpb25zID0gY29tcG9u
ZW50LT5udW1fZnVuY3Rpb25zOwotCXNpemVfdCBpOwotCWVudW0gY291bnRlcl9mdW5jdGlvbiBm
dW5jdGlvbjsKLQlzc2l6ZV90IGxlbiA9IDA7Ci0KLQlmb3IgKGkgPSAwOyBpIDwgbnVtX2Z1bmN0
aW9uczsgaSsrKSB7Ci0JCWZ1bmN0aW9uID0gZnVuY19saXN0W2ldOwotCQlsZW4gKz0gc3ByaW50
ZihidWYgKyBsZW4sICIlc1xuIiwKLQkJCSAgICAgICBjb3VudGVyX2Z1bmN0aW9uX3N0cltmdW5j
dGlvbl0pOwotCX0KLQotCXJldHVybiBsZW47Ci19Ci0KLXN0YXRpYyBpbnQgY291bnRlcl9jb3Vu
dF9hdHRyaWJ1dGVzX2NyZWF0ZSgKLQlzdHJ1Y3QgY291bnRlcl9kZXZpY2VfYXR0cl9ncm91cCAq
Y29uc3QgZ3JvdXAsCi0JY29uc3Qgc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb25zdCBjb3VudGVy
LAotCXN0cnVjdCBjb3VudGVyX2NvdW50ICpjb25zdCBjb3VudCkKLXsKLQlzdHJ1Y3QgY291bnRl
cl9jb3VudF91bml0ICpjb3VudF9jb21wOwotCXN0cnVjdCBjb3VudGVyX2F0dHJfcGFybSBwYXJt
OwotCWludCBlcnI7Ci0Jc3RydWN0IGNvdW50ZXJfY291bnRfdW5pdCAqZnVuY19jb21wOwotCXN0
cnVjdCBjb3VudGVyX2Z1bmNfYXZhaWxfdW5pdCAqYXZhaWxfY29tcDsKLQotCS8qIEFsbG9jYXRl
IGNvdW50IGF0dHJpYnV0ZSBjb21wb25lbnQgKi8KLQljb3VudF9jb21wID0ga21hbGxvYyhzaXpl
b2YoKmNvdW50X2NvbXApLCBHRlBfS0VSTkVMKTsKLQlpZiAoIWNvdW50X2NvbXApCi0JCXJldHVy
biAtRU5PTUVNOwotCWNvdW50X2NvbXAtPmNvdW50ID0gY291bnQ7Ci0KLQkvKiBDcmVhdGUgbWFp
biBDb3VudCBhdHRyaWJ1dGUgKi8KLQlwYXJtLmdyb3VwID0gZ3JvdXA7Ci0JcGFybS5wcmVmaXgg
PSAiIjsKLQlwYXJtLm5hbWUgPSAiY291bnQiOwotCXBhcm0uc2hvdyA9IChjb3VudGVyLT5vcHMt
PmNvdW50X3JlYWQpID8gY291bnRlcl9jb3VudF9zaG93IDogTlVMTDsKLQlwYXJtLnN0b3JlID0g
KGNvdW50ZXItPm9wcy0+Y291bnRfd3JpdGUpID8gY291bnRlcl9jb3VudF9zdG9yZSA6IE5VTEw7
Ci0JcGFybS5jb21wb25lbnQgPSBjb3VudF9jb21wOwotCWVyciA9IGNvdW50ZXJfYXR0cmlidXRl
X2NyZWF0ZSgmcGFybSk7Ci0JaWYgKGVycikgewotCQlrZnJlZShjb3VudF9jb21wKTsKLQkJcmV0
dXJuIGVycjsKLQl9Ci0KLQkvKiBBbGxvY2F0ZSBmdW5jdGlvbiBhdHRyaWJ1dGUgY29tcG9uZW50
ICovCi0JZnVuY19jb21wID0ga21hbGxvYyhzaXplb2YoKmZ1bmNfY29tcCksIEdGUF9LRVJORUwp
OwotCWlmICghZnVuY19jb21wKSB7Ci0JCWVyciA9IC1FTk9NRU07Ci0JCWdvdG8gZXJyX2ZyZWVf
YXR0cl9saXN0OwotCX0KLQlmdW5jX2NvbXAtPmNvdW50ID0gY291bnQ7Ci0KLQkvKiBDcmVhdGUg
Q291bnQgZnVuY3Rpb24gYXR0cmlidXRlICovCi0JcGFybS5ncm91cCA9IGdyb3VwOwotCXBhcm0u
cHJlZml4ID0gIiI7Ci0JcGFybS5uYW1lID0gImZ1bmN0aW9uIjsKLQlwYXJtLnNob3cgPSAoY291
bnRlci0+b3BzLT5mdW5jdGlvbl9nZXQpID8gY291bnRlcl9mdW5jdGlvbl9zaG93IDogTlVMTDsK
LQlwYXJtLnN0b3JlID0gKGNvdW50ZXItPm9wcy0+ZnVuY3Rpb25fc2V0KSA/IGNvdW50ZXJfZnVu
Y3Rpb25fc3RvcmUgOiBOVUxMOwotCXBhcm0uY29tcG9uZW50ID0gZnVuY19jb21wOwotCWVyciA9
IGNvdW50ZXJfYXR0cmlidXRlX2NyZWF0ZSgmcGFybSk7Ci0JaWYgKGVycikgewotCQlrZnJlZShm
dW5jX2NvbXApOwotCQlnb3RvIGVycl9mcmVlX2F0dHJfbGlzdDsKLQl9Ci0KLQkvKiBBbGxvY2F0
ZSBmdW5jdGlvbiBhdmFpbGFibGUgYXR0cmlidXRlIGNvbXBvbmVudCAqLwotCWF2YWlsX2NvbXAg
PSBrbWFsbG9jKHNpemVvZigqYXZhaWxfY29tcCksIEdGUF9LRVJORUwpOwotCWlmICghYXZhaWxf
Y29tcCkgewotCQllcnIgPSAtRU5PTUVNOwotCQlnb3RvIGVycl9mcmVlX2F0dHJfbGlzdDsKLQl9
Ci0JYXZhaWxfY29tcC0+ZnVuY3Rpb25zX2xpc3QgPSBjb3VudC0+ZnVuY3Rpb25zX2xpc3Q7Ci0J
YXZhaWxfY29tcC0+bnVtX2Z1bmN0aW9ucyA9IGNvdW50LT5udW1fZnVuY3Rpb25zOwotCi0JLyog
Q3JlYXRlIENvdW50IGZ1bmN0aW9uX2F2YWlsYWJsZSBhdHRyaWJ1dGUgKi8KLQlwYXJtLmdyb3Vw
ID0gZ3JvdXA7Ci0JcGFybS5wcmVmaXggPSAiIjsKLQlwYXJtLm5hbWUgPSAiZnVuY3Rpb25fYXZh
aWxhYmxlIjsKLQlwYXJtLnNob3cgPSBjb3VudGVyX2Z1bmN0aW9uX2F2YWlsYWJsZV9zaG93Owot
CXBhcm0uc3RvcmUgPSBOVUxMOwotCXBhcm0uY29tcG9uZW50ID0gYXZhaWxfY29tcDsKLQllcnIg
PSBjb3VudGVyX2F0dHJpYnV0ZV9jcmVhdGUoJnBhcm0pOwotCWlmIChlcnIpIHsKLQkJa2ZyZWUo
YXZhaWxfY29tcCk7Ci0JCWdvdG8gZXJyX2ZyZWVfYXR0cl9saXN0OwotCX0KLQotCS8qIENyZWF0
ZSBDb3VudCBuYW1lIGF0dHJpYnV0ZSAqLwotCWVyciA9IGNvdW50ZXJfbmFtZV9hdHRyaWJ1dGVf
Y3JlYXRlKGdyb3VwLCBjb3VudC0+bmFtZSk7Ci0JaWYgKGVycikKLQkJZ290byBlcnJfZnJlZV9h
dHRyX2xpc3Q7Ci0KLQkvKiBSZWdpc3RlciBDb3VudCBleHRlbnNpb24gYXR0cmlidXRlcyAqLwot
CWVyciA9IGNvdW50ZXJfY291bnRfZXh0X3JlZ2lzdGVyKGdyb3VwLCBjb3VudCk7Ci0JaWYgKGVy
cikKLQkJZ290byBlcnJfZnJlZV9hdHRyX2xpc3Q7Ci0KLQlyZXR1cm4gMDsKLQotZXJyX2ZyZWVf
YXR0cl9saXN0OgotCWNvdW50ZXJfZGV2aWNlX2F0dHJfbGlzdF9mcmVlKCZncm91cC0+YXR0cl9s
aXN0KTsKLQlyZXR1cm4gZXJyOwotfQotCi1zdGF0aWMgaW50IGNvdW50ZXJfY291bnRzX3JlZ2lz
dGVyKAotCXN0cnVjdCBjb3VudGVyX2RldmljZV9hdHRyX2dyb3VwICpjb25zdCBncm91cHNfbGlz
dCwKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvbnN0IGNvdW50ZXIpCi17Ci0Jc2l6
ZV90IGk7Ci0Jc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50OwotCWNvbnN0IGNoYXIgKm5hbWU7
Ci0JaW50IGVycjsKLQotCS8qIFJlZ2lzdGVyIGVhY2ggQ291bnQgKi8KLQlmb3IgKGkgPSAwOyBp
IDwgY291bnRlci0+bnVtX2NvdW50czsgaSsrKSB7Ci0JCWNvdW50ID0gY291bnRlci0+Y291bnRz
ICsgaTsKLQotCQkvKiBHZW5lcmF0ZSBDb3VudCBhdHRyaWJ1dGUgZGlyZWN0b3J5IG5hbWUgKi8K
LQkJbmFtZSA9IGthc3ByaW50ZihHRlBfS0VSTkVMLCAiY291bnQlZCIsIGNvdW50LT5pZCk7Ci0J
CWlmICghbmFtZSkgewotCQkJZXJyID0gLUVOT01FTTsKLQkJCWdvdG8gZXJyX2ZyZWVfYXR0cl9n
cm91cHM7Ci0JCX0KLQkJZ3JvdXBzX2xpc3RbaV0uYXR0cl9ncm91cC5uYW1lID0gbmFtZTsKLQot
CQkvKiBSZWdpc3RlciB0aGUgU3luYXBzZXMgYXNzb2NpYXRlZCB3aXRoIGVhY2ggQ291bnQgKi8K
LQkJZXJyID0gY291bnRlcl9zeW5hcHNlc19yZWdpc3Rlcihncm91cHNfbGlzdCArIGksIGNvdW50
ZXIsIGNvdW50LAotCQkJCQkJbmFtZSk7Ci0JCWlmIChlcnIpCi0JCQlnb3RvIGVycl9mcmVlX2F0
dHJfZ3JvdXBzOwotCi0JCS8qIENyZWF0ZSBhbGwgYXR0cmlidXRlcyBhc3NvY2lhdGVkIHdpdGgg
Q291bnQgKi8KLQkJZXJyID0gY291bnRlcl9jb3VudF9hdHRyaWJ1dGVzX2NyZWF0ZShncm91cHNf
bGlzdCArIGksIGNvdW50ZXIsCi0JCQkJCQkgICAgICBjb3VudCk7Ci0JCWlmIChlcnIpCi0JCQln
b3RvIGVycl9mcmVlX2F0dHJfZ3JvdXBzOwotCX0KLQotCXJldHVybiAwOwotCi1lcnJfZnJlZV9h
dHRyX2dyb3VwczoKLQlkbyB7Ci0JCWtmcmVlKGdyb3Vwc19saXN0W2ldLmF0dHJfZ3JvdXAubmFt
ZSk7Ci0JCWNvdW50ZXJfZGV2aWNlX2F0dHJfbGlzdF9mcmVlKCZncm91cHNfbGlzdFtpXS5hdHRy
X2xpc3QpOwotCX0gd2hpbGUgKGktLSk7Ci0JcmV0dXJuIGVycjsKLX0KLQotc3RydWN0IGNvdW50
ZXJfc2l6ZV91bml0IHsKLQlzaXplX3Qgc2l6ZTsKLX07Ci0KLXN0YXRpYyBzc2l6ZV90IGNvdW50
ZXJfZGV2aWNlX2F0dHJfc2l6ZV9zaG93KHN0cnVjdCBkZXZpY2UgKmRldiwKLQkJCQkJICAgICBz
dHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSAqYXR0ciwKLQkJCQkJICAgICBjaGFyICpidWYpCi17Ci0J
Y29uc3Qgc3RydWN0IGNvdW50ZXJfc2l6ZV91bml0ICpjb25zdCBjb21wID0gdG9fY291bnRlcl9h
dHRyKGF0dHIpLT5jb21wb25lbnQ7Ci0KLQlyZXR1cm4gc3ByaW50ZihidWYsICIlenVcbiIsIGNv
bXAtPnNpemUpOwotfQotCi1zdGF0aWMgaW50IGNvdW50ZXJfc2l6ZV9hdHRyaWJ1dGVfY3JlYXRl
KAotCXN0cnVjdCBjb3VudGVyX2RldmljZV9hdHRyX2dyb3VwICpjb25zdCBncm91cCwKLQljb25z
dCBzaXplX3Qgc2l6ZSwgY29uc3QgY2hhciAqY29uc3QgbmFtZSkKLXsKLQlzdHJ1Y3QgY291bnRl
cl9zaXplX3VuaXQgKnNpemVfY29tcDsKLQlzdHJ1Y3QgY291bnRlcl9hdHRyX3Bhcm0gcGFybTsK
LQlpbnQgZXJyOwotCi0JLyogQWxsb2NhdGUgc2l6ZSBhdHRyaWJ1dGUgY29tcG9uZW50ICovCi0J
c2l6ZV9jb21wID0ga21hbGxvYyhzaXplb2YoKnNpemVfY29tcCksIEdGUF9LRVJORUwpOwotCWlm
ICghc2l6ZV9jb21wKQotCQlyZXR1cm4gLUVOT01FTTsKLQlzaXplX2NvbXAtPnNpemUgPSBzaXpl
OwotCi0JcGFybS5ncm91cCA9IGdyb3VwOwotCXBhcm0ucHJlZml4ID0gIiI7Ci0JcGFybS5uYW1l
ID0gbmFtZTsKLQlwYXJtLnNob3cgPSBjb3VudGVyX2RldmljZV9hdHRyX3NpemVfc2hvdzsKLQlw
YXJtLnN0b3JlID0gTlVMTDsKLQlwYXJtLmNvbXBvbmVudCA9IHNpemVfY29tcDsKLQllcnIgPSBj
b3VudGVyX2F0dHJpYnV0ZV9jcmVhdGUoJnBhcm0pOwotCWlmIChlcnIpCi0JCWdvdG8gZXJyX2Zy
ZWVfc2l6ZV9jb21wOwotCi0JcmV0dXJuIDA7Ci0KLWVycl9mcmVlX3NpemVfY29tcDoKLQlrZnJl
ZShzaXplX2NvbXApOwotCXJldHVybiBlcnI7Ci19Ci0KLXN0cnVjdCBjb3VudGVyX2V4dF91bml0
IHsKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9kZXZpY2VfZXh0ICpleHQ7Ci19OwotCi1zdGF0aWMg
c3NpemVfdCBjb3VudGVyX2RldmljZV9leHRfc2hvdyhzdHJ1Y3QgZGV2aWNlICpkZXYsCi0JCQkJ
ICAgICAgIHN0cnVjdCBkZXZpY2VfYXR0cmlidXRlICphdHRyLCBjaGFyICpidWYpCi17Ci0JY29u
c3Qgc3RydWN0IGNvdW50ZXJfZGV2aWNlX2F0dHIgKmNvbnN0IGRldmF0dHIgPSB0b19jb3VudGVy
X2F0dHIoYXR0cik7Ci0JY29uc3Qgc3RydWN0IGNvdW50ZXJfZXh0X3VuaXQgKmNvbnN0IGNvbXBv
bmVudCA9IGRldmF0dHItPmNvbXBvbmVudDsKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9kZXZpY2Vf
ZXh0ICpjb25zdCBleHQgPSBjb21wb25lbnQtPmV4dDsKLQotCXJldHVybiBleHQtPnJlYWQoZGV2
X2dldF9kcnZkYXRhKGRldiksIGV4dC0+cHJpdiwgYnVmKTsKLX0KLQotc3RhdGljIHNzaXplX3Qg
Y291bnRlcl9kZXZpY2VfZXh0X3N0b3JlKHN0cnVjdCBkZXZpY2UgKmRldiwKLQkJCQkJc3RydWN0
IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIsCi0JCQkJCWNvbnN0IGNoYXIgKmJ1Ziwgc2l6ZV90IGxl
bikKLXsKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9kZXZpY2VfYXR0ciAqY29uc3QgZGV2YXR0ciA9
IHRvX2NvdW50ZXJfYXR0cihhdHRyKTsKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9leHRfdW5pdCAq
Y29uc3QgY29tcG9uZW50ID0gZGV2YXR0ci0+Y29tcG9uZW50OwotCWNvbnN0IHN0cnVjdCBjb3Vu
dGVyX2RldmljZV9leHQgKmNvbnN0IGV4dCA9IGNvbXBvbmVudC0+ZXh0OwotCi0JcmV0dXJuIGV4
dC0+d3JpdGUoZGV2X2dldF9kcnZkYXRhKGRldiksIGV4dC0+cHJpdiwgYnVmLCBsZW4pOwotfQot
Ci1zdGF0aWMgaW50IGNvdW50ZXJfZGV2aWNlX2V4dF9yZWdpc3RlcigKLQlzdHJ1Y3QgY291bnRl
cl9kZXZpY2VfYXR0cl9ncm91cCAqY29uc3QgZ3JvdXAsCi0Jc3RydWN0IGNvdW50ZXJfZGV2aWNl
ICpjb25zdCBjb3VudGVyKQotewotCXNpemVfdCBpOwotCXN0cnVjdCBjb3VudGVyX2V4dF91bml0
ICpleHRfY29tcDsKLQlzdHJ1Y3QgY291bnRlcl9hdHRyX3Bhcm0gcGFybTsKLQlpbnQgZXJyOwot
Ci0JLyogQ3JlYXRlIGFuIGF0dHJpYnV0ZSBmb3IgZWFjaCBleHRlbnNpb24gKi8KLQlmb3IgKGkg
PSAwIDsgaSA8IGNvdW50ZXItPm51bV9leHQ7IGkrKykgewotCQkvKiBBbGxvY2F0ZSBleHRlbnNp
b24gYXR0cmlidXRlIGNvbXBvbmVudCAqLwotCQlleHRfY29tcCA9IGttYWxsb2Moc2l6ZW9mKCpl
eHRfY29tcCksIEdGUF9LRVJORUwpOwotCQlpZiAoIWV4dF9jb21wKSB7Ci0JCQllcnIgPSAtRU5P
TUVNOwotCQkJZ290byBlcnJfZnJlZV9hdHRyX2xpc3Q7Ci0JCX0KLQotCQlleHRfY29tcC0+ZXh0
ID0gY291bnRlci0+ZXh0ICsgaTsKLQotCQkvKiBBbGxvY2F0ZSBleHRlbnNpb24gYXR0cmlidXRl
ICovCi0JCXBhcm0uZ3JvdXAgPSBncm91cDsKLQkJcGFybS5wcmVmaXggPSAiIjsKLQkJcGFybS5u
YW1lID0gY291bnRlci0+ZXh0W2ldLm5hbWU7Ci0JCXBhcm0uc2hvdyA9IChjb3VudGVyLT5leHRb
aV0ucmVhZCkgPyBjb3VudGVyX2RldmljZV9leHRfc2hvdyA6IE5VTEw7Ci0JCXBhcm0uc3RvcmUg
PSAoY291bnRlci0+ZXh0W2ldLndyaXRlKSA/IGNvdW50ZXJfZGV2aWNlX2V4dF9zdG9yZSA6IE5V
TEw7Ci0JCXBhcm0uY29tcG9uZW50ID0gZXh0X2NvbXA7Ci0JCWVyciA9IGNvdW50ZXJfYXR0cmli
dXRlX2NyZWF0ZSgmcGFybSk7Ci0JCWlmIChlcnIpIHsKLQkJCWtmcmVlKGV4dF9jb21wKTsKLQkJ
CWdvdG8gZXJyX2ZyZWVfYXR0cl9saXN0OwotCQl9Ci0JfQotCi0JcmV0dXJuIDA7Ci0KLWVycl9m
cmVlX2F0dHJfbGlzdDoKLQljb3VudGVyX2RldmljZV9hdHRyX2xpc3RfZnJlZSgmZ3JvdXAtPmF0
dHJfbGlzdCk7Ci0JcmV0dXJuIGVycjsKLX0KLQotc3RhdGljIGludCBjb3VudGVyX2dsb2JhbF9h
dHRyX3JlZ2lzdGVyKAotCXN0cnVjdCBjb3VudGVyX2RldmljZV9hdHRyX2dyb3VwICpjb25zdCBn
cm91cCwKLQlzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvbnN0IGNvdW50ZXIpCi17Ci0JaW50IGVy
cjsKLQotCS8qIENyZWF0ZSBuYW1lIGF0dHJpYnV0ZSAqLwotCWVyciA9IGNvdW50ZXJfbmFtZV9h
dHRyaWJ1dGVfY3JlYXRlKGdyb3VwLCBjb3VudGVyLT5uYW1lKTsKLQlpZiAoZXJyKQotCQlyZXR1
cm4gZXJyOwotCi0JLyogQ3JlYXRlIG51bV9jb3VudHMgYXR0cmlidXRlICovCi0JZXJyID0gY291
bnRlcl9zaXplX2F0dHJpYnV0ZV9jcmVhdGUoZ3JvdXAsIGNvdW50ZXItPm51bV9jb3VudHMsCi0J
CQkJCSAgICAibnVtX2NvdW50cyIpOwotCWlmIChlcnIpCi0JCWdvdG8gZXJyX2ZyZWVfYXR0cl9s
aXN0OwotCi0JLyogQ3JlYXRlIG51bV9zaWduYWxzIGF0dHJpYnV0ZSAqLwotCWVyciA9IGNvdW50
ZXJfc2l6ZV9hdHRyaWJ1dGVfY3JlYXRlKGdyb3VwLCBjb3VudGVyLT5udW1fc2lnbmFscywKLQkJ
CQkJICAgICJudW1fc2lnbmFscyIpOwotCWlmIChlcnIpCi0JCWdvdG8gZXJyX2ZyZWVfYXR0cl9s
aXN0OwotCi0JLyogUmVnaXN0ZXIgQ291bnRlciBkZXZpY2UgZXh0ZW5zaW9uIGF0dHJpYnV0ZXMg
Ki8KLQllcnIgPSBjb3VudGVyX2RldmljZV9leHRfcmVnaXN0ZXIoZ3JvdXAsIGNvdW50ZXIpOwot
CWlmIChlcnIpCi0JCWdvdG8gZXJyX2ZyZWVfYXR0cl9saXN0OwotCi0JcmV0dXJuIDA7Ci0KLWVy
cl9mcmVlX2F0dHJfbGlzdDoKLQljb3VudGVyX2RldmljZV9hdHRyX2xpc3RfZnJlZSgmZ3JvdXAt
PmF0dHJfbGlzdCk7Ci0JcmV0dXJuIGVycjsKLX0KLQotc3RhdGljIHZvaWQgY291bnRlcl9kZXZp
Y2VfZ3JvdXBzX2xpc3RfZnJlZSgKLQlzdHJ1Y3QgY291bnRlcl9kZXZpY2VfYXR0cl9ncm91cCAq
Y29uc3QgZ3JvdXBzX2xpc3QsCi0JY29uc3Qgc2l6ZV90IG51bV9ncm91cHMpCi17Ci0Jc3RydWN0
IGNvdW50ZXJfZGV2aWNlX2F0dHJfZ3JvdXAgKmdyb3VwOwotCXNpemVfdCBpOwotCi0JLyogbG9v
cCB0aHJvdWdoIGFsbCBhdHRyaWJ1dGUgZ3JvdXBzIChzaWduYWxzLCBjb3VudHMsIGdsb2JhbCwg
ZXRjLikgKi8KLQlmb3IgKGkgPSAwOyBpIDwgbnVtX2dyb3VwczsgaSsrKSB7Ci0JCWdyb3VwID0g
Z3JvdXBzX2xpc3QgKyBpOwotCi0JCS8qIGZyZWUgYWxsIGF0dHJpYnV0ZSBncm91cCBhbmQgYXNz
b2NpYXRlZCBhdHRyaWJ1dGVzIG1lbW9yeSAqLwotCQlrZnJlZShncm91cC0+YXR0cl9ncm91cC5u
YW1lKTsKLQkJa2ZyZWUoZ3JvdXAtPmF0dHJfZ3JvdXAuYXR0cnMpOwotCQljb3VudGVyX2Rldmlj
ZV9hdHRyX2xpc3RfZnJlZSgmZ3JvdXAtPmF0dHJfbGlzdCk7Ci0JfQotCi0Ja2ZyZWUoZ3JvdXBz
X2xpc3QpOwotfQotCi1zdGF0aWMgaW50IGNvdW50ZXJfZGV2aWNlX2dyb3Vwc19saXN0X3ByZXBh
cmUoCi0Jc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb25zdCBjb3VudGVyKQotewotCWNvbnN0IHNp
emVfdCB0b3RhbF9udW1fZ3JvdXBzID0KLQkJY291bnRlci0+bnVtX3NpZ25hbHMgKyBjb3VudGVy
LT5udW1fY291bnRzICsgMTsKLQlzdHJ1Y3QgY291bnRlcl9kZXZpY2VfYXR0cl9ncm91cCAqZ3Jv
dXBzX2xpc3Q7Ci0Jc2l6ZV90IGk7Ci0JaW50IGVycjsKLQlzaXplX3QgbnVtX2dyb3VwcyA9IDA7
Ci0KLQkvKiBBbGxvY2F0ZSBzcGFjZSBmb3IgYXR0cmlidXRlIGdyb3VwcyAoc2lnbmFscywgY291
bnRzLCBhbmQgZXh0KSAqLwotCWdyb3Vwc19saXN0ID0ga2NhbGxvYyh0b3RhbF9udW1fZ3JvdXBz
LCBzaXplb2YoKmdyb3Vwc19saXN0KSwKLQkJCSAgICAgIEdGUF9LRVJORUwpOwotCWlmICghZ3Jv
dXBzX2xpc3QpCi0JCXJldHVybiAtRU5PTUVNOwotCi0JLyogSW5pdGlhbGl6ZSBhdHRyaWJ1dGUg
bGlzdHMgKi8KLQlmb3IgKGkgPSAwOyBpIDwgdG90YWxfbnVtX2dyb3VwczsgaSsrKQotCQlJTklU
X0xJU1RfSEVBRCgmZ3JvdXBzX2xpc3RbaV0uYXR0cl9saXN0KTsKLQotCS8qIFJlZ2lzdGVyIFNp
Z25hbHMgKi8KLQllcnIgPSBjb3VudGVyX3NpZ25hbHNfcmVnaXN0ZXIoZ3JvdXBzX2xpc3QsIGNv
dW50ZXIpOwotCWlmIChlcnIpCi0JCWdvdG8gZXJyX2ZyZWVfZ3JvdXBzX2xpc3Q7Ci0JbnVtX2dy
b3VwcyArPSBjb3VudGVyLT5udW1fc2lnbmFsczsKLQotCS8qIFJlZ2lzdGVyIENvdW50cyBhbmQg
cmVzcGVjdGl2ZSBTeW5hcHNlcyAqLwotCWVyciA9IGNvdW50ZXJfY291bnRzX3JlZ2lzdGVyKGdy
b3Vwc19saXN0ICsgbnVtX2dyb3VwcywgY291bnRlcik7Ci0JaWYgKGVycikKLQkJZ290byBlcnJf
ZnJlZV9ncm91cHNfbGlzdDsKLQludW1fZ3JvdXBzICs9IGNvdW50ZXItPm51bV9jb3VudHM7Ci0K
LQkvKiBSZWdpc3RlciBDb3VudGVyIGdsb2JhbCBhdHRyaWJ1dGVzICovCi0JZXJyID0gY291bnRl
cl9nbG9iYWxfYXR0cl9yZWdpc3Rlcihncm91cHNfbGlzdCArIG51bV9ncm91cHMsIGNvdW50ZXIp
OwotCWlmIChlcnIpCi0JCWdvdG8gZXJyX2ZyZWVfZ3JvdXBzX2xpc3Q7Ci0JbnVtX2dyb3Vwcysr
OwotCi0JLyogU3RvcmUgZ3JvdXBzX2xpc3QgaW4gZGV2aWNlX3N0YXRlICovCi0JY291bnRlci0+
ZGV2aWNlX3N0YXRlLT5ncm91cHNfbGlzdCA9IGdyb3Vwc19saXN0OwotCWNvdW50ZXItPmRldmlj
ZV9zdGF0ZS0+bnVtX2dyb3VwcyA9IG51bV9ncm91cHM7Ci0KLQlyZXR1cm4gMDsKLQotZXJyX2Zy
ZWVfZ3JvdXBzX2xpc3Q6Ci0JY291bnRlcl9kZXZpY2VfZ3JvdXBzX2xpc3RfZnJlZShncm91cHNf
bGlzdCwgbnVtX2dyb3Vwcyk7Ci0JcmV0dXJuIGVycjsKLX0KLQotc3RhdGljIGludCBjb3VudGVy
X2RldmljZV9ncm91cHNfcHJlcGFyZSgKLQlzdHJ1Y3QgY291bnRlcl9kZXZpY2Vfc3RhdGUgKmNv
bnN0IGRldmljZV9zdGF0ZSkKLXsKLQlzaXplX3QgaSwgajsKLQlzdHJ1Y3QgY291bnRlcl9kZXZp
Y2VfYXR0cl9ncm91cCAqZ3JvdXA7Ci0JaW50IGVycjsKLQlzdHJ1Y3QgY291bnRlcl9kZXZpY2Vf
YXR0ciAqcDsKLQotCS8qIEFsbG9jYXRlIGF0dHJpYnV0ZSBncm91cHMgZm9yIGFzc29jaWF0aW9u
IHdpdGggZGV2aWNlICovCi0JZGV2aWNlX3N0YXRlLT5ncm91cHMgPSBrY2FsbG9jKGRldmljZV9z
dGF0ZS0+bnVtX2dyb3VwcyArIDEsCi0JCQkJICAgICAgIHNpemVvZigqZGV2aWNlX3N0YXRlLT5n
cm91cHMpLAotCQkJCSAgICAgICBHRlBfS0VSTkVMKTsKLQlpZiAoIWRldmljZV9zdGF0ZS0+Z3Jv
dXBzKQotCQlyZXR1cm4gLUVOT01FTTsKLQotCS8qIFByZXBhcmUgZWFjaCBncm91cCBvZiBhdHRy
aWJ1dGVzIGZvciBhc3NvY2lhdGlvbiAqLwotCWZvciAoaSA9IDA7IGkgPCBkZXZpY2Vfc3RhdGUt
Pm51bV9ncm91cHM7IGkrKykgewotCQlncm91cCA9IGRldmljZV9zdGF0ZS0+Z3JvdXBzX2xpc3Qg
KyBpOwotCi0JCS8qIEFsbG9jYXRlIHNwYWNlIGZvciBhdHRyaWJ1dGUgcG9pbnRlcnMgaW4gYXR0
cmlidXRlIGdyb3VwICovCi0JCWdyb3VwLT5hdHRyX2dyb3VwLmF0dHJzID0ga2NhbGxvYyhncm91
cC0+bnVtX2F0dHIgKyAxLAotCQkJc2l6ZW9mKCpncm91cC0+YXR0cl9ncm91cC5hdHRycyksIEdG
UF9LRVJORUwpOwotCQlpZiAoIWdyb3VwLT5hdHRyX2dyb3VwLmF0dHJzKSB7Ci0JCQllcnIgPSAt
RU5PTUVNOwotCQkJZ290byBlcnJfZnJlZV9ncm91cHM7Ci0JCX0KLQotCQkvKiBBZGQgYXR0cmli
dXRlIHBvaW50ZXJzIHRvIGF0dHJpYnV0ZSBncm91cCAqLwotCQlqID0gMDsKLQkJbGlzdF9mb3Jf
ZWFjaF9lbnRyeShwLCAmZ3JvdXAtPmF0dHJfbGlzdCwgbCkKLQkJCWdyb3VwLT5hdHRyX2dyb3Vw
LmF0dHJzW2orK10gPSAmcC0+ZGV2X2F0dHIuYXR0cjsKLQotCQkvKiBHcm91cCBhdHRyaWJ1dGVz
IGluIGF0dHJpYnV0ZSBncm91cCAqLwotCQlkZXZpY2Vfc3RhdGUtPmdyb3Vwc1tpXSA9ICZncm91
cC0+YXR0cl9ncm91cDsKLQl9Ci0JLyogQXNzb2NpYXRlIGF0dHJpYnV0ZXMgd2l0aCBkZXZpY2Ug
Ki8KLQlkZXZpY2Vfc3RhdGUtPmRldi5ncm91cHMgPSBkZXZpY2Vfc3RhdGUtPmdyb3VwczsKLQot
CXJldHVybiAwOwotCi1lcnJfZnJlZV9ncm91cHM6Ci0JZG8gewotCQlncm91cCA9IGRldmljZV9z
dGF0ZS0+Z3JvdXBzX2xpc3QgKyBpOwotCQlrZnJlZShncm91cC0+YXR0cl9ncm91cC5hdHRycyk7
Ci0JCWdyb3VwLT5hdHRyX2dyb3VwLmF0dHJzID0gTlVMTDsKLQl9IHdoaWxlIChpLS0pOwotCWtm
cmVlKGRldmljZV9zdGF0ZS0+Z3JvdXBzKTsKLQlyZXR1cm4gZXJyOwotfQotCi0vKiBQcm92aWRl
cyBhIHVuaXF1ZSBJRCBmb3IgZWFjaCBjb3VudGVyIGRldmljZSAqLwotc3RhdGljIERFRklORV9J
REEoY291bnRlcl9pZGEpOwotCi1zdGF0aWMgdm9pZCBjb3VudGVyX2RldmljZV9yZWxlYXNlKHN0
cnVjdCBkZXZpY2UgKmRldikKLXsKLQlzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvbnN0IGNvdW50
ZXIgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsKLQlzdHJ1Y3QgY291bnRlcl9kZXZpY2Vfc3RhdGUg
KmNvbnN0IGRldmljZV9zdGF0ZSA9IGNvdW50ZXItPmRldmljZV9zdGF0ZTsKLQotCWtmcmVlKGRl
dmljZV9zdGF0ZS0+Z3JvdXBzKTsKLQljb3VudGVyX2RldmljZV9ncm91cHNfbGlzdF9mcmVlKGRl
dmljZV9zdGF0ZS0+Z3JvdXBzX2xpc3QsCi0JCQkJCWRldmljZV9zdGF0ZS0+bnVtX2dyb3Vwcyk7
Ci0JaWRhX3NpbXBsZV9yZW1vdmUoJmNvdW50ZXJfaWRhLCBkZXZpY2Vfc3RhdGUtPmlkKTsKLQlr
ZnJlZShkZXZpY2Vfc3RhdGUpOwotfQotCi1zdGF0aWMgc3RydWN0IGRldmljZV90eXBlIGNvdW50
ZXJfZGV2aWNlX3R5cGUgPSB7Ci0JLm5hbWUgPSAiY291bnRlcl9kZXZpY2UiLAotCS5yZWxlYXNl
ID0gY291bnRlcl9kZXZpY2VfcmVsZWFzZQotfTsKLQotc3RhdGljIHN0cnVjdCBidXNfdHlwZSBj
b3VudGVyX2J1c190eXBlID0gewotCS5uYW1lID0gImNvdW50ZXIiCi19OwotCi0vKioKLSAqIGNv
dW50ZXJfcmVnaXN0ZXIgLSByZWdpc3RlciBDb3VudGVyIHRvIHRoZSBzeXN0ZW0KLSAqIEBjb3Vu
dGVyOglwb2ludGVyIHRvIENvdW50ZXIgdG8gcmVnaXN0ZXIKLSAqCi0gKiBUaGlzIGZ1bmN0aW9u
IHJlZ2lzdGVycyBhIENvdW50ZXIgdG8gdGhlIHN5c3RlbS4gQSBzeXNmcyAiY291bnRlciIgZGly
ZWN0b3J5Ci0gKiB3aWxsIGJlIGNyZWF0ZWQgYW5kIHBvcHVsYXRlZCB3aXRoIHN5c2ZzIGF0dHJp
YnV0ZXMgY29ycmVsYXRpbmcgd2l0aCB0aGUKLSAqIENvdW50ZXIgU2lnbmFscywgU3luYXBzZXMs
IGFuZCBDb3VudHMgcmVzcGVjdGl2ZWx5LgotICovCi1pbnQgY291bnRlcl9yZWdpc3RlcihzdHJ1
Y3QgY291bnRlcl9kZXZpY2UgKmNvbnN0IGNvdW50ZXIpCi17Ci0Jc3RydWN0IGNvdW50ZXJfZGV2
aWNlX3N0YXRlICpkZXZpY2Vfc3RhdGU7Ci0JaW50IGVycjsKLQotCS8qIEFsbG9jYXRlIGludGVy
bmFsIHN0YXRlIGNvbnRhaW5lciBmb3IgQ291bnRlciBkZXZpY2UgKi8KLQlkZXZpY2Vfc3RhdGUg
PSBremFsbG9jKHNpemVvZigqZGV2aWNlX3N0YXRlKSwgR0ZQX0tFUk5FTCk7Ci0JaWYgKCFkZXZp
Y2Vfc3RhdGUpCi0JCXJldHVybiAtRU5PTUVNOwotCWNvdW50ZXItPmRldmljZV9zdGF0ZSA9IGRl
dmljZV9zdGF0ZTsKLQotCS8qIEFjcXVpcmUgdW5pcXVlIElEICovCi0JZGV2aWNlX3N0YXRlLT5p
ZCA9IGlkYV9zaW1wbGVfZ2V0KCZjb3VudGVyX2lkYSwgMCwgMCwgR0ZQX0tFUk5FTCk7Ci0JaWYg
KGRldmljZV9zdGF0ZS0+aWQgPCAwKSB7Ci0JCWVyciA9IGRldmljZV9zdGF0ZS0+aWQ7Ci0JCWdv
dG8gZXJyX2ZyZWVfZGV2aWNlX3N0YXRlOwotCX0KLQotCS8qIENvbmZpZ3VyZSBkZXZpY2Ugc3Ry
dWN0dXJlIGZvciBDb3VudGVyICovCi0JZGV2aWNlX3N0YXRlLT5kZXYudHlwZSA9ICZjb3VudGVy
X2RldmljZV90eXBlOwotCWRldmljZV9zdGF0ZS0+ZGV2LmJ1cyA9ICZjb3VudGVyX2J1c190eXBl
OwotCWlmIChjb3VudGVyLT5wYXJlbnQpIHsKLQkJZGV2aWNlX3N0YXRlLT5kZXYucGFyZW50ID0g
Y291bnRlci0+cGFyZW50OwotCQlkZXZpY2Vfc3RhdGUtPmRldi5vZl9ub2RlID0gY291bnRlci0+
cGFyZW50LT5vZl9ub2RlOwotCX0KLQlkZXZfc2V0X25hbWUoJmRldmljZV9zdGF0ZS0+ZGV2LCAi
Y291bnRlciVkIiwgZGV2aWNlX3N0YXRlLT5pZCk7Ci0JZGV2aWNlX2luaXRpYWxpemUoJmRldmlj
ZV9zdGF0ZS0+ZGV2KTsKLQlkZXZfc2V0X2RydmRhdGEoJmRldmljZV9zdGF0ZS0+ZGV2LCBjb3Vu
dGVyKTsKLQotCS8qIFByZXBhcmUgZGV2aWNlIGF0dHJpYnV0ZXMgKi8KLQllcnIgPSBjb3VudGVy
X2RldmljZV9ncm91cHNfbGlzdF9wcmVwYXJlKGNvdW50ZXIpOwotCWlmIChlcnIpCi0JCWdvdG8g
ZXJyX2ZyZWVfaWQ7Ci0KLQkvKiBPcmdhbml6ZSBkZXZpY2UgYXR0cmlidXRlcyB0byBncm91cHMg
YW5kIG1hdGNoIHRvIGRldmljZSAqLwotCWVyciA9IGNvdW50ZXJfZGV2aWNlX2dyb3Vwc19wcmVw
YXJlKGRldmljZV9zdGF0ZSk7Ci0JaWYgKGVycikKLQkJZ290byBlcnJfZnJlZV9ncm91cHNfbGlz
dDsKLQotCS8qIEFkZCBkZXZpY2UgdG8gc3lzdGVtICovCi0JZXJyID0gZGV2aWNlX2FkZCgmZGV2
aWNlX3N0YXRlLT5kZXYpOwotCWlmIChlcnIpCi0JCWdvdG8gZXJyX2ZyZWVfZ3JvdXBzOwotCi0J
cmV0dXJuIDA7Ci0KLWVycl9mcmVlX2dyb3VwczoKLQlrZnJlZShkZXZpY2Vfc3RhdGUtPmdyb3Vw
cyk7Ci1lcnJfZnJlZV9ncm91cHNfbGlzdDoKLQljb3VudGVyX2RldmljZV9ncm91cHNfbGlzdF9m
cmVlKGRldmljZV9zdGF0ZS0+Z3JvdXBzX2xpc3QsCi0JCQkJCWRldmljZV9zdGF0ZS0+bnVtX2dy
b3Vwcyk7Ci1lcnJfZnJlZV9pZDoKLQlpZGFfc2ltcGxlX3JlbW92ZSgmY291bnRlcl9pZGEsIGRl
dmljZV9zdGF0ZS0+aWQpOwotZXJyX2ZyZWVfZGV2aWNlX3N0YXRlOgotCWtmcmVlKGRldmljZV9z
dGF0ZSk7Ci0JcmV0dXJuIGVycjsKLX0KLUVYUE9SVF9TWU1CT0xfR1BMKGNvdW50ZXJfcmVnaXN0
ZXIpOwotCi0vKioKLSAqIGNvdW50ZXJfdW5yZWdpc3RlciAtIHVucmVnaXN0ZXIgQ291bnRlciBm
cm9tIHRoZSBzeXN0ZW0KLSAqIEBjb3VudGVyOglwb2ludGVyIHRvIENvdW50ZXIgdG8gdW5yZWdp
c3RlcgotICoKLSAqIFRoZSBDb3VudGVyIGlzIHVucmVnaXN0ZXJlZCBmcm9tIHRoZSBzeXN0ZW07
IGFsbCBhbGxvY2F0ZWQgbWVtb3J5IGlzIGZyZWVkLgotICovCi12b2lkIGNvdW50ZXJfdW5yZWdp
c3RlcihzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvbnN0IGNvdW50ZXIpCi17Ci0JaWYgKGNvdW50
ZXIpCi0JCWRldmljZV9kZWwoJmNvdW50ZXItPmRldmljZV9zdGF0ZS0+ZGV2KTsKLX0KLUVYUE9S
VF9TWU1CT0xfR1BMKGNvdW50ZXJfdW5yZWdpc3Rlcik7Ci0KLXN0YXRpYyB2b2lkIGRldm1fY291
bnRlcl91bnJlZyhzdHJ1Y3QgZGV2aWNlICpkZXYsIHZvaWQgKnJlcykKLXsKLQljb3VudGVyX3Vu
cmVnaXN0ZXIoKihzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKiopcmVzKTsKLX0KLQotLyoqCi0gKiBk
ZXZtX2NvdW50ZXJfcmVnaXN0ZXIgLSBSZXNvdXJjZS1tYW5hZ2VkIGNvdW50ZXJfcmVnaXN0ZXIK
LSAqIEBkZXY6CWRldmljZSB0byBhbGxvY2F0ZSBjb3VudGVyX2RldmljZSBmb3IKLSAqIEBjb3Vu
dGVyOglwb2ludGVyIHRvIENvdW50ZXIgdG8gcmVnaXN0ZXIKLSAqCi0gKiBNYW5hZ2VkIGNvdW50
ZXJfcmVnaXN0ZXIuIFRoZSBDb3VudGVyIHJlZ2lzdGVyZWQgd2l0aCB0aGlzIGZ1bmN0aW9uIGlz
Ci0gKiBhdXRvbWF0aWNhbGx5IHVucmVnaXN0ZXJlZCBvbiBkcml2ZXIgZGV0YWNoLiBUaGlzIGZ1
bmN0aW9uIGNhbGxzCi0gKiBjb3VudGVyX3JlZ2lzdGVyIGludGVybmFsbHkuIFJlZmVyIHRvIHRo
YXQgZnVuY3Rpb24gZm9yIG1vcmUgaW5mb3JtYXRpb24uCi0gKgotICogSWYgYW4gQ291bnRlciBy
ZWdpc3RlcmVkIHdpdGggdGhpcyBmdW5jdGlvbiBuZWVkcyB0byBiZSB1bnJlZ2lzdGVyZWQKLSAq
IHNlcGFyYXRlbHksIGRldm1fY291bnRlcl91bnJlZ2lzdGVyIG11c3QgYmUgdXNlZC4KLSAqCi0g
KiBSRVRVUk5TOgotICogMCBvbiBzdWNjZXNzLCBuZWdhdGl2ZSBlcnJvciBudW1iZXIgb24gZmFp
bHVyZS4KLSAqLwotaW50IGRldm1fY291bnRlcl9yZWdpc3RlcihzdHJ1Y3QgZGV2aWNlICpkZXYs
Ci0JCQkgIHN0cnVjdCBjb3VudGVyX2RldmljZSAqY29uc3QgY291bnRlcikKLXsKLQlzdHJ1Y3Qg
Y291bnRlcl9kZXZpY2UgKipwdHI7Ci0JaW50IHJldDsKLQotCXB0ciA9IGRldnJlc19hbGxvYyhk
ZXZtX2NvdW50ZXJfdW5yZWcsIHNpemVvZigqcHRyKSwgR0ZQX0tFUk5FTCk7Ci0JaWYgKCFwdHIp
Ci0JCXJldHVybiAtRU5PTUVNOwotCi0JcmV0ID0gY291bnRlcl9yZWdpc3Rlcihjb3VudGVyKTsK
LQlpZiAoIXJldCkgewotCQkqcHRyID0gY291bnRlcjsKLQkJZGV2cmVzX2FkZChkZXYsIHB0cik7
Ci0JfSBlbHNlIHsKLQkJZGV2cmVzX2ZyZWUocHRyKTsKLQl9Ci0KLQlyZXR1cm4gcmV0OwotfQot
RVhQT1JUX1NZTUJPTF9HUEwoZGV2bV9jb3VudGVyX3JlZ2lzdGVyKTsKLQotc3RhdGljIGludCBk
ZXZtX2NvdW50ZXJfbWF0Y2goc3RydWN0IGRldmljZSAqZGV2LCB2b2lkICpyZXMsIHZvaWQgKmRh
dGEpCi17Ci0Jc3RydWN0IGNvdW50ZXJfZGV2aWNlICoqciA9IHJlczsKLQotCWlmICghciB8fCAh
KnIpIHsKLQkJV0FSTl9PTighciB8fCAhKnIpOwotCQlyZXR1cm4gMDsKLQl9Ci0KLQlyZXR1cm4g
KnIgPT0gZGF0YTsKLX0KLQotLyoqCi0gKiBkZXZtX2NvdW50ZXJfdW5yZWdpc3RlciAtIFJlc291
cmNlLW1hbmFnZWQgY291bnRlcl91bnJlZ2lzdGVyCi0gKiBAZGV2OglkZXZpY2UgdGhpcyBjb3Vu
dGVyX2RldmljZSBiZWxvbmdzIHRvCi0gKiBAY291bnRlcjoJcG9pbnRlciB0byBDb3VudGVyIGFz
c29jaWF0ZWQgd2l0aCB0aGUgZGV2aWNlCi0gKgotICogVW5yZWdpc3RlciBDb3VudGVyIHJlZ2lz
dGVyZWQgd2l0aCBkZXZtX2NvdW50ZXJfcmVnaXN0ZXIuCi0gKi8KLXZvaWQgZGV2bV9jb3VudGVy
X3VucmVnaXN0ZXIoc3RydWN0IGRldmljZSAqZGV2LAotCQkJICAgICBzdHJ1Y3QgY291bnRlcl9k
ZXZpY2UgKmNvbnN0IGNvdW50ZXIpCi17Ci0JaW50IHJjOwotCi0JcmMgPSBkZXZyZXNfcmVsZWFz
ZShkZXYsIGRldm1fY291bnRlcl91bnJlZywgZGV2bV9jb3VudGVyX21hdGNoLAotCQkJICAgIGNv
dW50ZXIpOwotCVdBUk5fT04ocmMpOwotfQotRVhQT1JUX1NZTUJPTF9HUEwoZGV2bV9jb3VudGVy
X3VucmVnaXN0ZXIpOwotCi1zdGF0aWMgaW50IF9faW5pdCBjb3VudGVyX2luaXQodm9pZCkKLXsK
LQlyZXR1cm4gYnVzX3JlZ2lzdGVyKCZjb3VudGVyX2J1c190eXBlKTsKLX0KLQotc3RhdGljIHZv
aWQgX19leGl0IGNvdW50ZXJfZXhpdCh2b2lkKQotewotCWJ1c191bnJlZ2lzdGVyKCZjb3VudGVy
X2J1c190eXBlKTsKLX0KLQotc3Vic3lzX2luaXRjYWxsKGNvdW50ZXJfaW5pdCk7Ci1tb2R1bGVf
ZXhpdChjb3VudGVyX2V4aXQpOwotCi1NT0RVTEVfQVVUSE9SKCJXaWxsaWFtIEJyZWF0aGl0dCBH
cmF5IDx2aWxoZWxtLmdyYXlAZ21haWwuY29tPiIpOwotTU9EVUxFX0RFU0NSSVBUSU9OKCJHZW5l
cmljIENvdW50ZXIgaW50ZXJmYWNlIik7Ci1NT0RVTEVfTElDRU5TRSgiR1BMIHYyIik7CmRpZmYg
LS1naXQgYS9kcml2ZXJzL2NvdW50ZXIvZnRtLXF1YWRkZWMuYyBiL2RyaXZlcnMvY291bnRlci9m
dG0tcXVhZGRlYy5jCmluZGV4IDUzYzE1Zjg0OTA5Yi4uMDkyYTgwNmE0NmQ4IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2NvdW50ZXIvZnRtLXF1YWRkZWMuYworKysgYi9kcml2ZXJzL2NvdW50ZXIvZnRt
LXF1YWRkZWMuYwpAQCAtMTQsNiArMTQsNyBAQAogI2luY2x1ZGUgPGxpbnV4L211dGV4Lmg+CiAj
aW5jbHVkZSA8bGludXgvY291bnRlci5oPgogI2luY2x1ZGUgPGxpbnV4L2JpdGZpZWxkLmg+Cisj
aW5jbHVkZSA8bGludXgvdHlwZXMuaD4KIAogI2RlZmluZSBGVE1fRklFTERfVVBEQVRFKGZ0bSwg
b2Zmc2V0LCBtYXNrLCB2YWwpCQkJXAogCSh7CQkJCQkJCQlcCkBAIC0xMTUsOCArMTE2LDcgQEAg
c3RhdGljIHZvaWQgZnRtX3F1YWRkZWNfZGlzYWJsZSh2b2lkICpmdG0pCiB9CiAKIHN0YXRpYyBp
bnQgZnRtX3F1YWRkZWNfZ2V0X3ByZXNjYWxlcihzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50
ZXIsCi0JCQkJICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCi0JCQkJICAgICBzaXpl
X3QgKmNudF9tb2RlKQorCQkJCSAgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB1MzIg
KmNudF9tb2RlKQogewogCXN0cnVjdCBmdG1fcXVhZGRlYyAqZnRtID0gY291bnRlci0+cHJpdjsK
IAl1aW50MzJfdCBzY2ZsYWdzOwpAQCAtMTI5LDggKzEyOSw3IEBAIHN0YXRpYyBpbnQgZnRtX3F1
YWRkZWNfZ2V0X3ByZXNjYWxlcihzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiB9CiAK
IHN0YXRpYyBpbnQgZnRtX3F1YWRkZWNfc2V0X3ByZXNjYWxlcihzdHJ1Y3QgY291bnRlcl9kZXZp
Y2UgKmNvdW50ZXIsCi0JCQkJICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCi0JCQkJ
ICAgICBzaXplX3QgY250X21vZGUpCisJCQkJICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291
bnQsIHUzMiBjbnRfbW9kZSkKIHsKIAlzdHJ1Y3QgZnRtX3F1YWRkZWMgKmZ0bSA9IGNvdW50ZXIt
PnByaXY7CiAKQEAgLTE1MSwzMyArMTUwLDIxIEBAIHN0YXRpYyBjb25zdCBjaGFyICogY29uc3Qg
ZnRtX3F1YWRkZWNfcHJlc2NhbGVyW10gPSB7CiAJIjEiLCAiMiIsICI0IiwgIjgiLCAiMTYiLCAi
MzIiLCAiNjQiLCAiMTI4IgogfTsKIAotc3RhdGljIHN0cnVjdCBjb3VudGVyX2NvdW50X2VudW1f
ZXh0IGZ0bV9xdWFkZGVjX3ByZXNjYWxlcl9lbnVtID0gewotCS5pdGVtcyA9IGZ0bV9xdWFkZGVj
X3ByZXNjYWxlciwKLQkubnVtX2l0ZW1zID0gQVJSQVlfU0laRShmdG1fcXVhZGRlY19wcmVzY2Fs
ZXIpLAotCS5nZXQgPSBmdG1fcXVhZGRlY19nZXRfcHJlc2NhbGVyLAotCS5zZXQgPSBmdG1fcXVh
ZGRlY19zZXRfcHJlc2NhbGVyCi19OwotCi1lbnVtIGZ0bV9xdWFkZGVjX3N5bmFwc2VfYWN0aW9u
IHsKLQlGVE1fUVVBRERFQ19TWU5BUFNFX0FDVElPTl9CT1RIX0VER0VTLAotfTsKLQogc3RhdGlj
IGNvbnN0IGVudW0gY291bnRlcl9zeW5hcHNlX2FjdGlvbiBmdG1fcXVhZGRlY19zeW5hcHNlX2Fj
dGlvbnNbXSA9IHsKLQlbRlRNX1FVQURERUNfU1lOQVBTRV9BQ1RJT05fQk9USF9FREdFU10gPQog
CUNPVU5URVJfU1lOQVBTRV9BQ1RJT05fQk9USF9FREdFUwogfTsKIAogZW51bSBmdG1fcXVhZGRl
Y19jb3VudF9mdW5jdGlvbiB7Ci0JRlRNX1FVQURERUNfQ09VTlRfRU5DT0RFUl9NT0RFXzEsCisJ
RlRNX1FVQURERUNfQ09VTlRfRU5DT0RFUl9NT0RFXzEgPSBDT1VOVEVSX0ZVTkNUSU9OX1FVQURS
QVRVUkVfWDQsCiB9OwogCiBzdGF0aWMgY29uc3QgZW51bSBjb3VudGVyX2Z1bmN0aW9uIGZ0bV9x
dWFkZGVjX2NvdW50X2Z1bmN0aW9uc1tdID0gewotCVtGVE1fUVVBRERFQ19DT1VOVF9FTkNPREVS
X01PREVfMV0gPSBDT1VOVEVSX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDQKKwlGVE1fUVVBRERFQ19D
T1VOVF9FTkNPREVSX01PREVfMQogfTsKIAogc3RhdGljIGludCBmdG1fcXVhZGRlY19jb3VudF9y
ZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKIAkJCQkgIHN0cnVjdCBjb3VudGVy
X2NvdW50ICpjb3VudCwKLQkJCQkgIHVuc2lnbmVkIGxvbmcgKnZhbCkKKwkJCQkgIHU2NCAqdmFs
KQogewogCXN0cnVjdCBmdG1fcXVhZGRlYyAqY29uc3QgZnRtID0gY291bnRlci0+cHJpdjsKIAl1
aW50MzJfdCBjbnR2YWw7CkBAIC0xOTEsNyArMTc4LDcgQEAgc3RhdGljIGludCBmdG1fcXVhZGRl
Y19jb3VudF9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKIAogc3RhdGljIGlu
dCBmdG1fcXVhZGRlY19jb3VudF93cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIs
CiAJCQkJICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkJCSAgIGNvbnN0IHVuc2ln
bmVkIGxvbmcgdmFsKQorCQkJCSAgIGNvbnN0IHU2NCB2YWwpCiB7CiAJc3RydWN0IGZ0bV9xdWFk
ZGVjICpjb25zdCBmdG0gPSBjb3VudGVyLT5wcml2OwogCkBAIC0yMDUsMjEgKzE5MiwyMSBAQCBz
dGF0aWMgaW50IGZ0bV9xdWFkZGVjX2NvdW50X3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAq
Y291bnRlciwKIAlyZXR1cm4gMDsKIH0KIAotc3RhdGljIGludCBmdG1fcXVhZGRlY19jb3VudF9m
dW5jdGlvbl9nZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCQkgIHN0cnVj
dCBjb3VudGVyX2NvdW50ICpjb3VudCwKLQkJCQkJICBzaXplX3QgKmZ1bmN0aW9uKQorc3RhdGlj
IGludCBmdG1fcXVhZGRlY19jb3VudF9mdW5jdGlvbl9yZWFkKHN0cnVjdCBjb3VudGVyX2Rldmlj
ZSAqY291bnRlciwKKwkJCQkJICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAorCQkJCQkg
ICBlbnVtIGNvdW50ZXJfZnVuY3Rpb24gKmZ1bmN0aW9uKQogewogCSpmdW5jdGlvbiA9IEZUTV9R
VUFEREVDX0NPVU5UX0VOQ09ERVJfTU9ERV8xOwogCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBp
bnQgZnRtX3F1YWRkZWNfYWN0aW9uX2dldChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIs
Ci0JCQkJICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCi0JCQkJICBzdHJ1Y3QgY291bnRl
cl9zeW5hcHNlICpzeW5hcHNlLAotCQkJCSAgc2l6ZV90ICphY3Rpb24pCitzdGF0aWMgaW50IGZ0
bV9xdWFkZGVjX2FjdGlvbl9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJ
CQkgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCisJCQkJICAgc3RydWN0IGNvdW50ZXJf
c3luYXBzZSAqc3luYXBzZSwKKwkJCQkgICBlbnVtIGNvdW50ZXJfc3luYXBzZV9hY3Rpb24gKmFj
dGlvbikKIHsKLQkqYWN0aW9uID0gRlRNX1FVQURERUNfU1lOQVBTRV9BQ1RJT05fQk9USF9FREdF
UzsKKwkqYWN0aW9uID0gQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9CT1RIX0VER0VTOwogCiAJcmV0
dXJuIDA7CiB9CkBAIC0yMjcsOCArMjE0LDggQEAgc3RhdGljIGludCBmdG1fcXVhZGRlY19hY3Rp
b25fZ2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKIHN0YXRpYyBjb25zdCBzdHJ1
Y3QgY291bnRlcl9vcHMgZnRtX3F1YWRkZWNfY250X29wcyA9IHsKIAkuY291bnRfcmVhZCA9IGZ0
bV9xdWFkZGVjX2NvdW50X3JlYWQsCiAJLmNvdW50X3dyaXRlID0gZnRtX3F1YWRkZWNfY291bnRf
d3JpdGUsCi0JLmZ1bmN0aW9uX2dldCA9IGZ0bV9xdWFkZGVjX2NvdW50X2Z1bmN0aW9uX2dldCwK
LQkuYWN0aW9uX2dldCA9IGZ0bV9xdWFkZGVjX2FjdGlvbl9nZXQsCisJLmZ1bmN0aW9uX3JlYWQg
PSBmdG1fcXVhZGRlY19jb3VudF9mdW5jdGlvbl9yZWFkLAorCS5hY3Rpb25fcmVhZCA9IGZ0bV9x
dWFkZGVjX2FjdGlvbl9yZWFkLAogfTsKIAogc3RhdGljIHN0cnVjdCBjb3VudGVyX3NpZ25hbCBm
dG1fcXVhZGRlY19zaWduYWxzW10gPSB7CkBAIC0yNTUsOSArMjQyLDEyIEBAIHN0YXRpYyBzdHJ1
Y3QgY291bnRlcl9zeW5hcHNlIGZ0bV9xdWFkZGVjX2NvdW50X3N5bmFwc2VzW10gPSB7CiAJfQog
fTsKIAotc3RhdGljIGNvbnN0IHN0cnVjdCBjb3VudGVyX2NvdW50X2V4dCBmdG1fcXVhZGRlY19j
b3VudF9leHRbXSA9IHsKLQlDT1VOVEVSX0NPVU5UX0VOVU0oInByZXNjYWxlciIsICZmdG1fcXVh
ZGRlY19wcmVzY2FsZXJfZW51bSksCi0JQ09VTlRFUl9DT1VOVF9FTlVNX0FWQUlMQUJMRSgicHJl
c2NhbGVyIiwgJmZ0bV9xdWFkZGVjX3ByZXNjYWxlcl9lbnVtKSwKK3N0YXRpYyBERUZJTkVfQ09V
TlRFUl9FTlVNKGZ0bV9xdWFkZGVjX3ByZXNjYWxlcl9lbnVtLCBmdG1fcXVhZGRlY19wcmVzY2Fs
ZXIpOworCitzdGF0aWMgc3RydWN0IGNvdW50ZXJfY29tcCBmdG1fcXVhZGRlY19jb3VudF9leHRb
XSA9IHsKKwlDT1VOVEVSX0NPTVBfQ09VTlRfRU5VTSgicHJlc2NhbGVyIiwgZnRtX3F1YWRkZWNf
Z2V0X3ByZXNjYWxlciwKKwkJCQlmdG1fcXVhZGRlY19zZXRfcHJlc2NhbGVyLAorCQkJCWZ0bV9x
dWFkZGVjX3ByZXNjYWxlcl9lbnVtKSwKIH07CiAKIHN0YXRpYyBzdHJ1Y3QgY291bnRlcl9jb3Vu
dCBmdG1fcXVhZGRlY19jb3VudHMgPSB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2NvdW50ZXIvaW50
ZWwtcWVwLmMgYi9kcml2ZXJzL2NvdW50ZXIvaW50ZWwtcWVwLmMKaW5kZXggZjRiZTlkNzhjODRj
Li5lYzA1NmYzMWZhNTUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvY291bnRlci9pbnRlbC1xZXAuYwor
KysgYi9kcml2ZXJzL2NvdW50ZXIvaW50ZWwtcWVwLmMKQEAgLTYzLDEzICs2Myw2IEBACiAKICNk
ZWZpbmUgSU5URUxfUUVQX0NMS19QRVJJT0RfTlMJCTEwCiAKLSNkZWZpbmUgSU5URUxfUUVQX0NP
VU5URVJfRVhUX1JXKF9uYW1lKQkJCQlcCi17CQkJCQkJCQlcCi0JLm5hbWUgPSAjX25hbWUsCQkJ
CQkJXAotCS5yZWFkID0gX25hbWUjI19yZWFkLAkJCQkJXAotCS53cml0ZSA9IF9uYW1lIyNfd3Jp
dGUsCQkJCQlcCi19Ci0KIHN0cnVjdCBpbnRlbF9xZXAgewogCXN0cnVjdCBjb3VudGVyX2Rldmlj
ZSBjb3VudGVyOwogCXN0cnVjdCBtdXRleCBsb2NrOwpAQCAtMTE1LDggKzEwOCw3IEBAIHN0YXRp
YyB2b2lkIGludGVsX3FlcF9pbml0KHN0cnVjdCBpbnRlbF9xZXAgKnFlcCkKIH0KIAogc3RhdGlj
IGludCBpbnRlbF9xZXBfY291bnRfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIs
Ci0JCQkJc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkJCXVuc2lnbmVkIGxvbmcgKnZh
bCkKKwkJCQlzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHU2NCAqdmFsKQogewogCXN0cnVj
dCBpbnRlbF9xZXAgKmNvbnN0IHFlcCA9IGNvdW50ZXItPnByaXY7CiAKQEAgLTEzMSwxMSArMTIz
LDExIEBAIHN0YXRpYyBjb25zdCBlbnVtIGNvdW50ZXJfZnVuY3Rpb24gaW50ZWxfcWVwX2NvdW50
X2Z1bmN0aW9uc1tdID0gewogCUNPVU5URVJfRlVOQ1RJT05fUVVBRFJBVFVSRV9YNCwKIH07CiAK
LXN0YXRpYyBpbnQgaW50ZWxfcWVwX2Z1bmN0aW9uX2dldChzdHJ1Y3QgY291bnRlcl9kZXZpY2Ug
KmNvdW50ZXIsCi0JCQkJICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCi0JCQkJICBzaXpl
X3QgKmZ1bmN0aW9uKQorc3RhdGljIGludCBpbnRlbF9xZXBfZnVuY3Rpb25fcmVhZChzdHJ1Y3Qg
Y291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNv
dW50LAorCQkJCSAgIGVudW0gY291bnRlcl9mdW5jdGlvbiAqZnVuY3Rpb24pCiB7Ci0JKmZ1bmN0
aW9uID0gMDsKKwkqZnVuY3Rpb24gPSBDT1VOVEVSX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDQ7CiAK
IAlyZXR1cm4gMDsKIH0KQEAgLTE0NCwxOSArMTM2LDE5IEBAIHN0YXRpYyBjb25zdCBlbnVtIGNv
dW50ZXJfc3luYXBzZV9hY3Rpb24gaW50ZWxfcWVwX3N5bmFwc2VfYWN0aW9uc1tdID0gewogCUNP
VU5URVJfU1lOQVBTRV9BQ1RJT05fQk9USF9FREdFUywKIH07CiAKLXN0YXRpYyBpbnQgaW50ZWxf
cWVwX2FjdGlvbl9nZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCXN0cnVj
dCBjb3VudGVyX2NvdW50ICpjb3VudCwKLQkJCQlzdHJ1Y3QgY291bnRlcl9zeW5hcHNlICpzeW5h
cHNlLAotCQkJCXNpemVfdCAqYWN0aW9uKQorc3RhdGljIGludCBpbnRlbF9xZXBfYWN0aW9uX3Jl
YWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCSBzdHJ1Y3QgY291bnRlcl9j
b3VudCAqY291bnQsCisJCQkJIHN0cnVjdCBjb3VudGVyX3N5bmFwc2UgKnN5bmFwc2UsCisJCQkJ
IGVudW0gY291bnRlcl9zeW5hcHNlX2FjdGlvbiAqYWN0aW9uKQogewotCSphY3Rpb24gPSAwOwor
CSphY3Rpb24gPSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX0JPVEhfRURHRVM7CiAJcmV0dXJuIDA7
CiB9CiAKIHN0YXRpYyBjb25zdCBzdHJ1Y3QgY291bnRlcl9vcHMgaW50ZWxfcWVwX2NvdW50ZXJf
b3BzID0gewogCS5jb3VudF9yZWFkID0gaW50ZWxfcWVwX2NvdW50X3JlYWQsCi0JLmZ1bmN0aW9u
X2dldCA9IGludGVsX3FlcF9mdW5jdGlvbl9nZXQsCi0JLmFjdGlvbl9nZXQgPSBpbnRlbF9xZXBf
YWN0aW9uX2dldCwKKwkuZnVuY3Rpb25fcmVhZCA9IGludGVsX3FlcF9mdW5jdGlvbl9yZWFkLAor
CS5hY3Rpb25fcmVhZCA9IGludGVsX3FlcF9hY3Rpb25fcmVhZCwKIH07CiAKICNkZWZpbmUgSU5U
RUxfUUVQX1NJR05BTChfaWQsIF9uYW1lKSB7CQkJCVwKQEAgLTE4MiwzMSArMTc0LDI3IEBAIHN0
YXRpYyBzdHJ1Y3QgY291bnRlcl9zeW5hcHNlIGludGVsX3FlcF9jb3VudF9zeW5hcHNlc1tdID0g
ewogCUlOVEVMX1FFUF9TWU5BUFNFKDIpLAogfTsKIAotc3RhdGljIHNzaXplX3QgY2VpbGluZ19y
ZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCSAgICBzdHJ1Y3QgY291bnRl
cl9jb3VudCAqY291bnQsCi0JCQkgICAgdm9pZCAqcHJpdiwgY2hhciAqYnVmKQorc3RhdGljIGlu
dCBpbnRlbF9xZXBfY2VpbGluZ19yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwK
KwkJCQkgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgdTY0ICpjZWlsaW5nKQogewogCXN0
cnVjdCBpbnRlbF9xZXAgKnFlcCA9IGNvdW50ZXItPnByaXY7Ci0JdTMyIHJlZzsKIAogCXBtX3J1
bnRpbWVfZ2V0X3N5bmMocWVwLT5kZXYpOwotCXJlZyA9IGludGVsX3FlcF9yZWFkbChxZXAsIElO
VEVMX1FFUE1BWCk7CisJKmNlaWxpbmcgPSBpbnRlbF9xZXBfcmVhZGwocWVwLCBJTlRFTF9RRVBN
QVgpOwogCXBtX3J1bnRpbWVfcHV0KHFlcC0+ZGV2KTsKIAotCXJldHVybiBzeXNmc19lbWl0KGJ1
ZiwgIiV1XG4iLCByZWcpOworCXJldHVybiAwOwogfQogCi1zdGF0aWMgc3NpemVfdCBjZWlsaW5n
X3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCSAgICAgc3RydWN0IGNv
dW50ZXJfY291bnQgKmNvdW50LAotCQkJICAgICB2b2lkICpwcml2LCBjb25zdCBjaGFyICpidWYs
IHNpemVfdCBsZW4pCitzdGF0aWMgaW50IGludGVsX3FlcF9jZWlsaW5nX3dyaXRlKHN0cnVjdCBj
b3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291
bnQsIHU2NCBtYXgpCiB7CiAJc3RydWN0IGludGVsX3FlcCAqcWVwID0gY291bnRlci0+cHJpdjsK
LQl1MzIgbWF4OwotCWludCByZXQ7CisJaW50IHJldCA9IDA7CiAKLQlyZXQgPSBrc3RydG91MzIo
YnVmLCAwLCAmbWF4KTsKLQlpZiAocmV0IDwgMCkKLQkJcmV0dXJuIHJldDsKKwkvKiBJbnRlbCBR
RVAgY2VpbGluZyBjb25maWd1cmF0aW9uIG9ubHkgc3VwcG9ydHMgMzItYml0IHZhbHVlcyAqLwor
CWlmIChtYXggIT0gKHUzMiltYXgpCisJCXJldHVybiAtRVJBTkdFOwogCiAJbXV0ZXhfbG9jaygm
cWVwLT5sb2NrKTsKIAlpZiAocWVwLT5lbmFibGVkKSB7CkBAIC0yMTcsMzQgKzIwNSwyOCBAQCBz
dGF0aWMgc3NpemVfdCBjZWlsaW5nX3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRl
ciwKIAlwbV9ydW50aW1lX2dldF9zeW5jKHFlcC0+ZGV2KTsKIAlpbnRlbF9xZXBfd3JpdGVsKHFl
cCwgSU5URUxfUUVQTUFYLCBtYXgpOwogCXBtX3J1bnRpbWVfcHV0KHFlcC0+ZGV2KTsKLQlyZXQg
PSBsZW47CiAKIG91dDoKIAltdXRleF91bmxvY2soJnFlcC0+bG9jayk7CiAJcmV0dXJuIHJldDsK
IH0KIAotc3RhdGljIHNzaXplX3QgZW5hYmxlX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpj
b3VudGVyLAotCQkJICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkJICAgdm9pZCAq
cHJpdiwgY2hhciAqYnVmKQorc3RhdGljIGludCBpbnRlbF9xZXBfZW5hYmxlX3JlYWQoc3RydWN0
IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCSBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291
bnQsIHU4ICplbmFibGUpCiB7CiAJc3RydWN0IGludGVsX3FlcCAqcWVwID0gY291bnRlci0+cHJp
djsKIAotCXJldHVybiBzeXNmc19lbWl0KGJ1ZiwgIiV1XG4iLCBxZXAtPmVuYWJsZWQpOworCSpl
bmFibGUgPSBxZXAtPmVuYWJsZWQ7CisKKwlyZXR1cm4gMDsKIH0KIAotc3RhdGljIHNzaXplX3Qg
ZW5hYmxlX3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCSAgICBzdHJ1
Y3QgY291bnRlcl9jb3VudCAqY291bnQsCi0JCQkgICAgdm9pZCAqcHJpdiwgY29uc3QgY2hhciAq
YnVmLCBzaXplX3QgbGVuKQorc3RhdGljIGludCBpbnRlbF9xZXBfZW5hYmxlX3dyaXRlKHN0cnVj
dCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpj
b3VudCwgdTggdmFsKQogewogCXN0cnVjdCBpbnRlbF9xZXAgKnFlcCA9IGNvdW50ZXItPnByaXY7
CiAJdTMyIHJlZzsKLQlib29sIHZhbCwgY2hhbmdlZDsKLQlpbnQgcmV0OwotCi0JcmV0ID0ga3N0
cnRvYm9vbChidWYsICZ2YWwpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7CisJYm9vbCBjaGFu
Z2VkOwogCiAJbXV0ZXhfbG9jaygmcWVwLT5sb2NrKTsKIAljaGFuZ2VkID0gdmFsIF4gcWVwLT5l
bmFibGVkOwpAQCAtMjY4LDEyICsyNTAsMTIgQEAgc3RhdGljIHNzaXplX3QgZW5hYmxlX3dyaXRl
KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKIAogb3V0OgogCW11dGV4X3VubG9jaygm
cWVwLT5sb2NrKTsKLQlyZXR1cm4gbGVuOworCXJldHVybiAwOwogfQogCi1zdGF0aWMgc3NpemVf
dCBzcGlrZV9maWx0ZXJfbnNfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0J
CQkJICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKLQkJCQkgICAgdm9pZCAqcHJpdiwg
Y2hhciAqYnVmKQorc3RhdGljIGludCBpbnRlbF9xZXBfc3Bpa2VfZmlsdGVyX25zX3JlYWQoc3Ry
dWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCQkgIHN0cnVjdCBjb3VudGVyX2NvdW50
ICpjb3VudCwKKwkJCQkJICB1NjQgKmxlbmd0aCkKIHsKIAlzdHJ1Y3QgaW50ZWxfcWVwICpxZXAg
PSBjb3VudGVyLT5wcml2OwogCXUzMiByZWc7CkBAIC0yODIsMjYgKzI2NCwyNCBAQCBzdGF0aWMg
c3NpemVfdCBzcGlrZV9maWx0ZXJfbnNfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50
ZXIsCiAJcmVnID0gaW50ZWxfcWVwX3JlYWRsKHFlcCwgSU5URUxfUUVQQ09OKTsKIAlpZiAoIShy
ZWcgJiBJTlRFTF9RRVBDT05fRkxUX0VOKSkgewogCQlwbV9ydW50aW1lX3B1dChxZXAtPmRldik7
Ci0JCXJldHVybiBzeXNmc19lbWl0KGJ1ZiwgIjBcbiIpOworCQlyZXR1cm4gMDsKIAl9CiAJcmVn
ID0gSU5URUxfUUVQRkxUX01BWF9DT1VOVChpbnRlbF9xZXBfcmVhZGwocWVwLCBJTlRFTF9RRVBG
TFQpKTsKIAlwbV9ydW50aW1lX3B1dChxZXAtPmRldik7CiAKLQlyZXR1cm4gc3lzZnNfZW1pdChi
dWYsICIldVxuIiwgKHJlZyArIDIpICogSU5URUxfUUVQX0NMS19QRVJJT0RfTlMpOworCSpsZW5n
dGggPSAocmVnICsgMikgKiBJTlRFTF9RRVBfQ0xLX1BFUklPRF9OUzsKKworCXJldHVybiAwOwog
fQogCi1zdGF0aWMgc3NpemVfdCBzcGlrZV9maWx0ZXJfbnNfd3JpdGUoc3RydWN0IGNvdW50ZXJf
ZGV2aWNlICpjb3VudGVyLAotCQkJCSAgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAot
CQkJCSAgICAgdm9pZCAqcHJpdiwgY29uc3QgY2hhciAqYnVmLCBzaXplX3QgbGVuKQorc3RhdGlj
IGludCBpbnRlbF9xZXBfc3Bpa2VfZmlsdGVyX25zX3dyaXRlKHN0cnVjdCBjb3VudGVyX2Rldmlj
ZSAqY291bnRlciwKKwkJCQkJICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAorCQkJCQkg
ICB1NjQgbGVuZ3RoKQogewogCXN0cnVjdCBpbnRlbF9xZXAgKnFlcCA9IGNvdW50ZXItPnByaXY7
Ci0JdTMyIHJlZywgbGVuZ3RoOworCXUzMiByZWc7CiAJYm9vbCBlbmFibGU7Ci0JaW50IHJldDsK
LQotCXJldCA9IGtzdHJ0b3UzMihidWYsIDAsICZsZW5ndGgpOwotCWlmIChyZXQgPCAwKQotCQly
ZXR1cm4gcmV0OworCWludCByZXQgPSAwOwogCiAJLyoKIAkgKiBTcGlrZSBmaWx0ZXIgbGVuZ3Ro
IGlzIChNQVhfQ09VTlQgKyAyKSBjbG9jayBwZXJpb2RzLgpAQCAtMzM3LDE2ICszMTcsMTUgQEAg
c3RhdGljIHNzaXplX3Qgc3Bpa2VfZmlsdGVyX25zX3dyaXRlKHN0cnVjdCBjb3VudGVyX2Rldmlj
ZSAqY291bnRlciwKIAlpbnRlbF9xZXBfd3JpdGVsKHFlcCwgSU5URUxfUUVQRkxULCBsZW5ndGgp
OwogCWludGVsX3FlcF93cml0ZWwocWVwLCBJTlRFTF9RRVBDT04sIHJlZyk7CiAJcG1fcnVudGlt
ZV9wdXQocWVwLT5kZXYpOwotCXJldCA9IGxlbjsKIAogb3V0OgogCW11dGV4X3VubG9jaygmcWVw
LT5sb2NrKTsKIAlyZXR1cm4gcmV0OwogfQogCi1zdGF0aWMgc3NpemVfdCBwcmVzZXRfZW5hYmxl
X3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCSAgc3RydWN0IGNvdW50
ZXJfY291bnQgKmNvdW50LAotCQkJCSAgdm9pZCAqcHJpdiwgY2hhciAqYnVmKQorc3RhdGljIGlu
dCBpbnRlbF9xZXBfcHJlc2V0X2VuYWJsZV9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291
bnRlciwKKwkJCQkJc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAorCQkJCQl1OCAqcHJlc2V0
X2VuYWJsZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfcWVwICpxZXAgPSBjb3VudGVyLT5wcml2OwogCXUz
MiByZWc7CkBAIC0zNTQsMjEgKzMzMywxOCBAQCBzdGF0aWMgc3NpemVfdCBwcmVzZXRfZW5hYmxl
X3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAogCXBtX3J1bnRpbWVfZ2V0X3N5
bmMocWVwLT5kZXYpOwogCXJlZyA9IGludGVsX3FlcF9yZWFkbChxZXAsIElOVEVMX1FFUENPTik7
CiAJcG1fcnVudGltZV9wdXQocWVwLT5kZXYpOwotCXJldHVybiBzeXNmc19lbWl0KGJ1ZiwgIiV1
XG4iLCAhKHJlZyAmIElOVEVMX1FFUENPTl9DT1VOVF9SU1RfTU9ERSkpOworCisJKnByZXNldF9l
bmFibGUgPSAhKHJlZyAmIElOVEVMX1FFUENPTl9DT1VOVF9SU1RfTU9ERSk7CisKKwlyZXR1cm4g
MDsKIH0KIAotc3RhdGljIHNzaXplX3QgcHJlc2V0X2VuYWJsZV93cml0ZShzdHJ1Y3QgY291bnRl
cl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkJICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAot
CQkJCSAgIHZvaWQgKnByaXYsIGNvbnN0IGNoYXIgKmJ1Ziwgc2l6ZV90IGxlbikKK3N0YXRpYyBp
bnQgaW50ZWxfcWVwX3ByZXNldF9lbmFibGVfd3JpdGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpj
b3VudGVyLAorCQkJCQkgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB1OCB2YWwpCiB7CiAJ
c3RydWN0IGludGVsX3FlcCAqcWVwID0gY291bnRlci0+cHJpdjsKIAl1MzIgcmVnOwotCWJvb2wg
dmFsOwotCWludCByZXQ7Ci0KLQlyZXQgPSBrc3RydG9ib29sKGJ1ZiwgJnZhbCk7Ci0JaWYgKHJl
dCkKLQkJcmV0dXJuIHJldDsKKwlpbnQgcmV0ID0gMDsKIAogCW11dGV4X2xvY2soJnFlcC0+bG9j
ayk7CiAJaWYgKHFlcC0+ZW5hYmxlZCkgewpAQCAtMzg1LDcgKzM2MSw2IEBAIHN0YXRpYyBzc2l6
ZV90IHByZXNldF9lbmFibGVfd3JpdGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAog
CiAJaW50ZWxfcWVwX3dyaXRlbChxZXAsIElOVEVMX1FFUENPTiwgcmVnKTsKIAlwbV9ydW50aW1l
X3B1dChxZXAtPmRldik7Ci0JcmV0ID0gbGVuOwogCiBvdXQ6CiAJbXV0ZXhfdW5sb2NrKCZxZXAt
PmxvY2spOwpAQCAtMzkzLDExICszNjgsMTQgQEAgc3RhdGljIHNzaXplX3QgcHJlc2V0X2VuYWJs
ZV93cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAJcmV0dXJuIHJldDsKIH0K
IAotc3RhdGljIGNvbnN0IHN0cnVjdCBjb3VudGVyX2NvdW50X2V4dCBpbnRlbF9xZXBfY291bnRf
ZXh0W10gPSB7Ci0JSU5URUxfUUVQX0NPVU5URVJfRVhUX1JXKGNlaWxpbmcpLAotCUlOVEVMX1FF
UF9DT1VOVEVSX0VYVF9SVyhlbmFibGUpLAotCUlOVEVMX1FFUF9DT1VOVEVSX0VYVF9SVyhzcGlr
ZV9maWx0ZXJfbnMpLAotCUlOVEVMX1FFUF9DT1VOVEVSX0VYVF9SVyhwcmVzZXRfZW5hYmxlKQor
c3RhdGljIHN0cnVjdCBjb3VudGVyX2NvbXAgaW50ZWxfcWVwX2NvdW50X2V4dFtdID0geworCUNP
VU5URVJfQ09NUF9FTkFCTEUoaW50ZWxfcWVwX2VuYWJsZV9yZWFkLCBpbnRlbF9xZXBfZW5hYmxl
X3dyaXRlKSwKKwlDT1VOVEVSX0NPTVBfQ0VJTElORyhpbnRlbF9xZXBfY2VpbGluZ19yZWFkLCBp
bnRlbF9xZXBfY2VpbGluZ193cml0ZSksCisJQ09VTlRFUl9DT01QX1BSRVNFVF9FTkFCTEUoaW50
ZWxfcWVwX3ByZXNldF9lbmFibGVfcmVhZCwKKwkJCQkgICBpbnRlbF9xZXBfcHJlc2V0X2VuYWJs
ZV93cml0ZSksCisJQ09VTlRFUl9DT01QX0NPVU5UX1U2NCgic3Bpa2VfZmlsdGVyX25zIiwKKwkJ
CSAgICAgICBpbnRlbF9xZXBfc3Bpa2VfZmlsdGVyX25zX3JlYWQsCisJCQkgICAgICAgaW50ZWxf
cWVwX3NwaWtlX2ZpbHRlcl9uc193cml0ZSksCiB9OwogCiBzdGF0aWMgc3RydWN0IGNvdW50ZXJf
Y291bnQgaW50ZWxfcWVwX2NvdW50ZXJfY291bnRbXSA9IHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Y291bnRlci9pbnRlcnJ1cHQtY250LmMgYi9kcml2ZXJzL2NvdW50ZXIvaW50ZXJydXB0LWNudC5j
CmluZGV4IDFkZTQyNDNkYjQ4OC4uODUxNGE4N2ZjYmVlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2Nv
dW50ZXIvaW50ZXJydXB0LWNudC5jCisrKyBiL2RyaXZlcnMvY291bnRlci9pbnRlcnJ1cHQtY250
LmMKQEAgLTEwLDYgKzEwLDcgQEAKICNpbmNsdWRlIDxsaW51eC9tb2RfZGV2aWNldGFibGUuaD4K
ICNpbmNsdWRlIDxsaW51eC9tb2R1bGUuaD4KICNpbmNsdWRlIDxsaW51eC9wbGF0Zm9ybV9kZXZp
Y2UuaD4KKyNpbmNsdWRlIDxsaW51eC90eXBlcy5oPgogCiAjZGVmaW5lIElOVEVSUlVQVF9DTlRf
TkFNRSAiaW50ZXJydXB0LWNudCIKIApAQCAtMzMsMzAgKzM0LDIzIEBAIHN0YXRpYyBpcnFyZXR1
cm5fdCBpbnRlcnJ1cHRfY250X2lzcihpbnQgaXJxLCB2b2lkICpkZXZfaWQpCiAJcmV0dXJuIElS
UV9IQU5ETEVEOwogfQogCi1zdGF0aWMgc3NpemVfdCBpbnRlcnJ1cHRfY250X2VuYWJsZV9yZWFk
KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQkJIHN0cnVjdCBjb3VudGVyX2Nv
dW50ICpjb3VudCwKLQkJCQkJIHZvaWQgKnByaXZhdGUsIGNoYXIgKmJ1ZikKK3N0YXRpYyBpbnQg
aW50ZXJydXB0X2NudF9lbmFibGVfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIs
CisJCQkJICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHU4ICplbmFibGUpCiB7CiAJ
c3RydWN0IGludGVycnVwdF9jbnRfcHJpdiAqcHJpdiA9IGNvdW50ZXItPnByaXY7CiAKLQlyZXR1
cm4gc3lzZnNfZW1pdChidWYsICIlZFxuIiwgcHJpdi0+ZW5hYmxlZCk7CisJKmVuYWJsZSA9IHBy
aXYtPmVuYWJsZWQ7CisKKwlyZXR1cm4gMDsKIH0KIAotc3RhdGljIHNzaXplX3QgaW50ZXJydXB0
X2NudF9lbmFibGVfd3JpdGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCQkg
IHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKLQkJCQkJICB2b2lkICpwcml2YXRlLCBjb25z
dCBjaGFyICpidWYsCi0JCQkJCSAgc2l6ZV90IGxlbikKK3N0YXRpYyBpbnQgaW50ZXJydXB0X2Nu
dF9lbmFibGVfd3JpdGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCSAgICAg
IHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgdTggZW5hYmxlKQogewogCXN0cnVjdCBpbnRl
cnJ1cHRfY250X3ByaXYgKnByaXYgPSBjb3VudGVyLT5wcml2OwotCWJvb2wgZW5hYmxlOwotCXNz
aXplX3QgcmV0OwotCi0JcmV0ID0ga3N0cnRvYm9vbChidWYsICZlbmFibGUpOwotCWlmIChyZXQp
Ci0JCXJldHVybiByZXQ7CiAKIAlpZiAocHJpdi0+ZW5hYmxlZCA9PSBlbmFibGUpCi0JCXJldHVy
biBsZW47CisJCXJldHVybiAwOwogCiAJaWYgKGVuYWJsZSkgewogCQlwcml2LT5lbmFibGVkID0g
dHJ1ZTsKQEAgLTY2LDMzICs2MCwzMCBAQCBzdGF0aWMgc3NpemVfdCBpbnRlcnJ1cHRfY250X2Vu
YWJsZV93cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAJCXByaXYtPmVuYWJs
ZWQgPSBmYWxzZTsKIAl9CiAKLQlyZXR1cm4gbGVuOworCXJldHVybiAwOwogfQogCi1zdGF0aWMg
Y29uc3Qgc3RydWN0IGNvdW50ZXJfY291bnRfZXh0IGludGVycnVwdF9jbnRfZXh0W10gPSB7Ci0J
ewotCQkubmFtZSA9ICJlbmFibGUiLAotCQkucmVhZCA9IGludGVycnVwdF9jbnRfZW5hYmxlX3Jl
YWQsCi0JCS53cml0ZSA9IGludGVycnVwdF9jbnRfZW5hYmxlX3dyaXRlLAotCX0sCitzdGF0aWMg
c3RydWN0IGNvdW50ZXJfY29tcCBpbnRlcnJ1cHRfY250X2V4dFtdID0geworCUNPVU5URVJfQ09N
UF9FTkFCTEUoaW50ZXJydXB0X2NudF9lbmFibGVfcmVhZCwKKwkJCSAgICBpbnRlcnJ1cHRfY250
X2VuYWJsZV93cml0ZSksCiB9OwogCiBzdGF0aWMgY29uc3QgZW51bSBjb3VudGVyX3N5bmFwc2Vf
YWN0aW9uIGludGVycnVwdF9jbnRfc3luYXBzZV9hY3Rpb25zW10gPSB7CiAJQ09VTlRFUl9TWU5B
UFNFX0FDVElPTl9SSVNJTkdfRURHRSwKIH07CiAKLXN0YXRpYyBpbnQgaW50ZXJydXB0X2NudF9h
Y3Rpb25fZ2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQkgICAgc3RydWN0
IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkJCSAgICBzdHJ1Y3QgY291bnRlcl9zeW5hcHNlICpz
eW5hcHNlLAotCQkJCSAgICBzaXplX3QgKmFjdGlvbikKK3N0YXRpYyBpbnQgaW50ZXJydXB0X2Nu
dF9hY3Rpb25fcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJICAgICBz
dHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCisJCQkJICAgICBzdHJ1Y3QgY291bnRlcl9zeW5h
cHNlICpzeW5hcHNlLAorCQkJCSAgICAgZW51bSBjb3VudGVyX3N5bmFwc2VfYWN0aW9uICphY3Rp
b24pCiB7Ci0JKmFjdGlvbiA9IDA7CisJKmFjdGlvbiA9IENPVU5URVJfU1lOQVBTRV9BQ1RJT05f
UklTSU5HX0VER0U7CiAKIAlyZXR1cm4gMDsKIH0KIAogc3RhdGljIGludCBpbnRlcnJ1cHRfY250
X3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJICAgICAgc3RydWN0IGNv
dW50ZXJfY291bnQgKmNvdW50LCB1bnNpZ25lZCBsb25nICp2YWwpCisJCQkgICAgICBzdHJ1Y3Qg
Y291bnRlcl9jb3VudCAqY291bnQsIHU2NCAqdmFsKQogewogCXN0cnVjdCBpbnRlcnJ1cHRfY250
X3ByaXYgKnByaXYgPSBjb3VudGVyLT5wcml2OwogCkBAIC0xMDIsOCArOTMsNyBAQCBzdGF0aWMg
aW50IGludGVycnVwdF9jbnRfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiB9
CiAKIHN0YXRpYyBpbnQgaW50ZXJydXB0X2NudF93cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2Ug
KmNvdW50ZXIsCi0JCQkgICAgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkJICAg
ICAgIGNvbnN0IHVuc2lnbmVkIGxvbmcgdmFsKQorCQkJICAgICAgIHN0cnVjdCBjb3VudGVyX2Nv
dW50ICpjb3VudCwgY29uc3QgdTY0IHZhbCkKIHsKIAlzdHJ1Y3QgaW50ZXJydXB0X2NudF9wcml2
ICpwcml2ID0gY291bnRlci0+cHJpdjsKIApAQCAtMTE5LDExICsxMDksMTEgQEAgc3RhdGljIGNv
bnN0IGVudW0gY291bnRlcl9mdW5jdGlvbiBpbnRlcnJ1cHRfY250X2Z1bmN0aW9uc1tdID0gewog
CUNPVU5URVJfRlVOQ1RJT05fSU5DUkVBU0UsCiB9OwogCi1zdGF0aWMgaW50IGludGVycnVwdF9j
bnRfZnVuY3Rpb25fZ2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQkgICAg
ICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCi0JCQkJICAgICAgc2l6ZV90ICpmdW5jdGlv
bikKK3N0YXRpYyBpbnQgaW50ZXJydXB0X2NudF9mdW5jdGlvbl9yZWFkKHN0cnVjdCBjb3VudGVy
X2RldmljZSAqY291bnRlciwKKwkJCQkgICAgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50
LAorCQkJCSAgICAgICBlbnVtIGNvdW50ZXJfZnVuY3Rpb24gKmZ1bmN0aW9uKQogewotCSpmdW5j
dGlvbiA9IDA7CisJKmZ1bmN0aW9uID0gQ09VTlRFUl9GVU5DVElPTl9JTkNSRUFTRTsKIAogCXJl
dHVybiAwOwogfQpAQCAtMTQ4LDEwICsxMzgsMTAgQEAgc3RhdGljIGludCBpbnRlcnJ1cHRfY250
X3NpZ25hbF9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKIH0KIAogc3RhdGlj
IGNvbnN0IHN0cnVjdCBjb3VudGVyX29wcyBpbnRlcnJ1cHRfY250X29wcyA9IHsKLQkuYWN0aW9u
X2dldCA9IGludGVycnVwdF9jbnRfYWN0aW9uX2dldCwKKwkuYWN0aW9uX3JlYWQgPSBpbnRlcnJ1
cHRfY250X2FjdGlvbl9yZWFkLAogCS5jb3VudF9yZWFkID0gaW50ZXJydXB0X2NudF9yZWFkLAog
CS5jb3VudF93cml0ZSA9IGludGVycnVwdF9jbnRfd3JpdGUsCi0JLmZ1bmN0aW9uX2dldCA9IGlu
dGVycnVwdF9jbnRfZnVuY3Rpb25fZ2V0LAorCS5mdW5jdGlvbl9yZWFkID0gaW50ZXJydXB0X2Nu
dF9mdW5jdGlvbl9yZWFkLAogCS5zaWduYWxfcmVhZCAgPSBpbnRlcnJ1cHRfY250X3NpZ25hbF9y
ZWFkLAogfTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9jb3VudGVyL21pY3JvY2hpcC10Y2ItY2Fw
dHVyZS5jIGIvZHJpdmVycy9jb3VudGVyL21pY3JvY2hpcC10Y2ItY2FwdHVyZS5jCmluZGV4IDRj
NTdkNDNlN2Q2Ni4uNzllMGM4NGEzYjgxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2NvdW50ZXIvbWlj
cm9jaGlwLXRjYi1jYXB0dXJlLmMKKysrIGIvZHJpdmVycy9jb3VudGVyL21pY3JvY2hpcC10Y2It
Y2FwdHVyZS5jCkBAIC0zMiwyOCArMzIsMTYgQEAgc3RydWN0IG1jaHBfdGNfZGF0YSB7CiAJYm9v
bCB0cmlnX2ludmVydGVkOwogfTsKIAotZW51bSBtY2hwX3RjX2NvdW50X2Z1bmN0aW9uIHsKLQlN
Q0hQX1RDX0ZVTkNUSU9OX0lOQ1JFQVNFLAotCU1DSFBfVENfRlVOQ1RJT05fUVVBRFJBVFVSRSwK
LX07Ci0KLXN0YXRpYyBjb25zdCBlbnVtIGNvdW50ZXJfY291bnRfZnVuY3Rpb24gbWNocF90Y19j
b3VudF9mdW5jdGlvbnNbXSA9IHsKLQlbTUNIUF9UQ19GVU5DVElPTl9JTkNSRUFTRV0gPSBDT1VO
VEVSX0ZVTkNUSU9OX0lOQ1JFQVNFLAotCVtNQ0hQX1RDX0ZVTkNUSU9OX1FVQURSQVRVUkVdID0g
Q09VTlRFUl9GVU5DVElPTl9RVUFEUkFUVVJFX1g0LAotfTsKLQotZW51bSBtY2hwX3RjX3N5bmFw
c2VfYWN0aW9uIHsKLQlNQ0hQX1RDX1NZTkFQU0VfQUNUSU9OX05PTkUgPSAwLAotCU1DSFBfVENf
U1lOQVBTRV9BQ1RJT05fUklTSU5HX0VER0UsCi0JTUNIUF9UQ19TWU5BUFNFX0FDVElPTl9GQUxM
SU5HX0VER0UsCi0JTUNIUF9UQ19TWU5BUFNFX0FDVElPTl9CT1RIX0VER0UKK3N0YXRpYyBjb25z
dCBlbnVtIGNvdW50ZXJfZnVuY3Rpb24gbWNocF90Y19jb3VudF9mdW5jdGlvbnNbXSA9IHsKKwlD
T1VOVEVSX0ZVTkNUSU9OX0lOQ1JFQVNFLAorCUNPVU5URVJfRlVOQ1RJT05fUVVBRFJBVFVSRV9Y
NCwKIH07CiAKIHN0YXRpYyBjb25zdCBlbnVtIGNvdW50ZXJfc3luYXBzZV9hY3Rpb24gbWNocF90
Y19zeW5hcHNlX2FjdGlvbnNbXSA9IHsKLQlbTUNIUF9UQ19TWU5BUFNFX0FDVElPTl9OT05FXSA9
IENPVU5URVJfU1lOQVBTRV9BQ1RJT05fTk9ORSwKLQlbTUNIUF9UQ19TWU5BUFNFX0FDVElPTl9S
SVNJTkdfRURHRV0gPSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX1JJU0lOR19FREdFLAotCVtNQ0hQ
X1RDX1NZTkFQU0VfQUNUSU9OX0ZBTExJTkdfRURHRV0gPSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9O
X0ZBTExJTkdfRURHRSwKLQlbTUNIUF9UQ19TWU5BUFNFX0FDVElPTl9CT1RIX0VER0VdID0gQ09V
TlRFUl9TWU5BUFNFX0FDVElPTl9CT1RIX0VER0VTLAorCUNPVU5URVJfU1lOQVBTRV9BQ1RJT05f
Tk9ORSwKKwlDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX1JJU0lOR19FREdFLAorCUNPVU5URVJfU1lO
QVBTRV9BQ1RJT05fRkFMTElOR19FREdFLAorCUNPVU5URVJfU1lOQVBTRV9BQ1RJT05fQk9USF9F
REdFUywKIH07CiAKIHN0YXRpYyBzdHJ1Y3QgY291bnRlcl9zaWduYWwgbWNocF90Y19jb3VudF9z
aWduYWxzW10gPSB7CkBAIC04MCwyMyArNjgsMjMgQEAgc3RhdGljIHN0cnVjdCBjb3VudGVyX3N5
bmFwc2UgbWNocF90Y19jb3VudF9zeW5hcHNlc1tdID0gewogCX0KIH07CiAKLXN0YXRpYyBpbnQg
bWNocF90Y19jb3VudF9mdW5jdGlvbl9nZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVy
LAotCQkJCSAgICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKLQkJCQkgICAgICBzaXpl
X3QgKmZ1bmN0aW9uKQorc3RhdGljIGludCBtY2hwX3RjX2NvdW50X2Z1bmN0aW9uX3JlYWQoc3Ry
dWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCSAgICAgICBzdHJ1Y3QgY291bnRlcl9j
b3VudCAqY291bnQsCisJCQkJICAgICAgIGVudW0gY291bnRlcl9mdW5jdGlvbiAqZnVuY3Rpb24p
CiB7CiAJc3RydWN0IG1jaHBfdGNfZGF0YSAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7CiAK
IAlpZiAocHJpdi0+cWRlY19tb2RlKQotCQkqZnVuY3Rpb24gPSBNQ0hQX1RDX0ZVTkNUSU9OX1FV
QURSQVRVUkU7CisJCSpmdW5jdGlvbiA9IENPVU5URVJfRlVOQ1RJT05fUVVBRFJBVFVSRV9YNDsK
IAllbHNlCi0JCSpmdW5jdGlvbiA9IE1DSFBfVENfRlVOQ1RJT05fSU5DUkVBU0U7CisJCSpmdW5j
dGlvbiA9IENPVU5URVJfRlVOQ1RJT05fSU5DUkVBU0U7CiAKIAlyZXR1cm4gMDsKIH0KIAotc3Rh
dGljIGludCBtY2hwX3RjX2NvdW50X2Z1bmN0aW9uX3NldChzdHJ1Y3QgY291bnRlcl9kZXZpY2Ug
KmNvdW50ZXIsCi0JCQkJICAgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkJCSAg
ICAgIHNpemVfdCBmdW5jdGlvbikKK3N0YXRpYyBpbnQgbWNocF90Y19jb3VudF9mdW5jdGlvbl93
cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJCXN0cnVjdCBjb3VudGVy
X2NvdW50ICpjb3VudCwKKwkJCQkJZW51bSBjb3VudGVyX2Z1bmN0aW9uIGZ1bmN0aW9uKQogewog
CXN0cnVjdCBtY2hwX3RjX2RhdGEgKmNvbnN0IHByaXYgPSBjb3VudGVyLT5wcml2OwogCXUzMiBi
bXIsIGNtcjsKQEAgLTEwOCw3ICs5Niw3IEBAIHN0YXRpYyBpbnQgbWNocF90Y19jb3VudF9mdW5j
dGlvbl9zZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAogCWNtciAmPSB+QVRNRUxf
VENfV0FWRTsKIAogCXN3aXRjaCAoZnVuY3Rpb24pIHsKLQljYXNlIE1DSFBfVENfRlVOQ1RJT05f
SU5DUkVBU0U6CisJY2FzZSBDT1VOVEVSX0ZVTkNUSU9OX0lOQ1JFQVNFOgogCQlwcml2LT5xZGVj
X21vZGUgPSAwOwogCQkvKiBTZXQgaGlnaGVzdCByYXRlIGJhc2VkIG9uIHdoZXRoZXIgc29jIGhh
cyBnY2xrIG9yIG5vdCAqLwogCQlibXIgJj0gfihBVE1FTF9UQ19RREVOIHwgQVRNRUxfVENfUE9T
RU4pOwpAQCAtMTIwLDcgKzEwOCw3IEBAIHN0YXRpYyBpbnQgbWNocF90Y19jb3VudF9mdW5jdGlv
bl9zZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAogCQljbXIgfD0gIEFUTUVMX1RD
X0NNUl9NQVNLOwogCQljbXIgJj0gfihBVE1FTF9UQ19BQkVUUkcgfCBBVE1FTF9UQ19YQzApOwog
CQlicmVhazsKLQljYXNlIE1DSFBfVENfRlVOQ1RJT05fUVVBRFJBVFVSRToKKwljYXNlIENPVU5U
RVJfRlVOQ1RJT05fUVVBRFJBVFVSRV9YNDoKIAkJaWYgKCFwcml2LT50Y19jZmctPmhhc19xZGVj
KQogCQkJcmV0dXJuIC1FSU5WQUw7CiAJCS8qIEluIFFERUMgbW9kZSBzZXR0aW5ncyBib3RoIGNo
YW5uZWxzIDAgYW5kIDEgYXJlIHJlcXVpcmVkICovCkBAIC0xNzYsMTAgKzE2NCwxMCBAQCBzdGF0
aWMgaW50IG1jaHBfdGNfY291bnRfc2lnbmFsX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpj
b3VudGVyLAogCXJldHVybiAwOwogfQogCi1zdGF0aWMgaW50IG1jaHBfdGNfY291bnRfYWN0aW9u
X2dldChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkJICAgIHN0cnVjdCBjb3Vu
dGVyX2NvdW50ICpjb3VudCwKLQkJCQkgICAgc3RydWN0IGNvdW50ZXJfc3luYXBzZSAqc3luYXBz
ZSwKLQkJCQkgICAgc2l6ZV90ICphY3Rpb24pCitzdGF0aWMgaW50IG1jaHBfdGNfY291bnRfYWN0
aW9uX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCSAgICAgc3RydWN0
IGNvdW50ZXJfY291bnQgKmNvdW50LAorCQkJCSAgICAgc3RydWN0IGNvdW50ZXJfc3luYXBzZSAq
c3luYXBzZSwKKwkJCQkgICAgIGVudW0gY291bnRlcl9zeW5hcHNlX2FjdGlvbiAqYWN0aW9uKQog
ewogCXN0cnVjdCBtY2hwX3RjX2RhdGEgKmNvbnN0IHByaXYgPSBjb3VudGVyLT5wcml2OwogCXUz
MiBjbXI7CkBAIC0xODgsMjYgKzE3NiwyNiBAQCBzdGF0aWMgaW50IG1jaHBfdGNfY291bnRfYWN0
aW9uX2dldChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAKIAlzd2l0Y2ggKGNtciAm
IEFUTUVMX1RDX0VUUkdFREcpIHsKIAlkZWZhdWx0OgotCQkqYWN0aW9uID0gTUNIUF9UQ19TWU5B
UFNFX0FDVElPTl9OT05FOworCQkqYWN0aW9uID0gQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9OT05F
OwogCQlicmVhazsKIAljYXNlIEFUTUVMX1RDX0VUUkdFREdfUklTSU5HOgotCQkqYWN0aW9uID0g
TUNIUF9UQ19TWU5BUFNFX0FDVElPTl9SSVNJTkdfRURHRTsKKwkJKmFjdGlvbiA9IENPVU5URVJf
U1lOQVBTRV9BQ1RJT05fUklTSU5HX0VER0U7CiAJCWJyZWFrOwogCWNhc2UgQVRNRUxfVENfRVRS
R0VER19GQUxMSU5HOgotCQkqYWN0aW9uID0gTUNIUF9UQ19TWU5BUFNFX0FDVElPTl9GQUxMSU5H
X0VER0U7CisJCSphY3Rpb24gPSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX0ZBTExJTkdfRURHRTsK
IAkJYnJlYWs7CiAJY2FzZSBBVE1FTF9UQ19FVFJHRURHX0JPVEg6Ci0JCSphY3Rpb24gPSBNQ0hQ
X1RDX1NZTkFQU0VfQUNUSU9OX0JPVEhfRURHRTsKKwkJKmFjdGlvbiA9IENPVU5URVJfU1lOQVBT
RV9BQ1RJT05fQk9USF9FREdFUzsKIAkJYnJlYWs7CiAJfQogCiAJcmV0dXJuIDA7CiB9CiAKLXN0
YXRpYyBpbnQgbWNocF90Y19jb3VudF9hY3Rpb25fc2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAq
Y291bnRlciwKLQkJCQkgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkJCSAgICBz
dHJ1Y3QgY291bnRlcl9zeW5hcHNlICpzeW5hcHNlLAotCQkJCSAgICBzaXplX3QgYWN0aW9uKQor
c3RhdGljIGludCBtY2hwX3RjX2NvdW50X2FjdGlvbl93cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZp
Y2UgKmNvdW50ZXIsCisJCQkJICAgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAorCQkJ
CSAgICAgIHN0cnVjdCBjb3VudGVyX3N5bmFwc2UgKnN5bmFwc2UsCisJCQkJICAgICAgZW51bSBj
b3VudGVyX3N5bmFwc2VfYWN0aW9uIGFjdGlvbikKIHsKIAlzdHJ1Y3QgbWNocF90Y19kYXRhICpj
b25zdCBwcml2ID0gY291bnRlci0+cHJpdjsKIAl1MzIgZWRnZSA9IEFUTUVMX1RDX0VUUkdFREdf
Tk9ORTsKQEAgLTIxNywxNiArMjA1LDE2IEBAIHN0YXRpYyBpbnQgbWNocF90Y19jb3VudF9hY3Rp
b25fc2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKIAkJcmV0dXJuIC1FSU5WQUw7
CiAKIAlzd2l0Y2ggKGFjdGlvbikgewotCWNhc2UgTUNIUF9UQ19TWU5BUFNFX0FDVElPTl9OT05F
OgorCWNhc2UgQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9OT05FOgogCQllZGdlID0gQVRNRUxfVENf
RVRSR0VER19OT05FOwogCQlicmVhazsKLQljYXNlIE1DSFBfVENfU1lOQVBTRV9BQ1RJT05fUklT
SU5HX0VER0U6CisJY2FzZSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX1JJU0lOR19FREdFOgogCQll
ZGdlID0gQVRNRUxfVENfRVRSR0VER19SSVNJTkc7CiAJCWJyZWFrOwotCWNhc2UgTUNIUF9UQ19T
WU5BUFNFX0FDVElPTl9GQUxMSU5HX0VER0U6CisJY2FzZSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9O
X0ZBTExJTkdfRURHRToKIAkJZWRnZSA9IEFUTUVMX1RDX0VUUkdFREdfRkFMTElORzsKIAkJYnJl
YWs7Ci0JY2FzZSBNQ0hQX1RDX1NZTkFQU0VfQUNUSU9OX0JPVEhfRURHRToKKwljYXNlIENPVU5U
RVJfU1lOQVBTRV9BQ1RJT05fQk9USF9FREdFUzoKIAkJZWRnZSA9IEFUTUVMX1RDX0VUUkdFREdf
Qk9USDsKIAkJYnJlYWs7CiAJZGVmYXVsdDoKQEAgLTI0MCw4ICsyMjgsNyBAQCBzdGF0aWMgaW50
IG1jaHBfdGNfY291bnRfYWN0aW9uX3NldChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIs
CiB9CiAKIHN0YXRpYyBpbnQgbWNocF90Y19jb3VudF9yZWFkKHN0cnVjdCBjb3VudGVyX2Rldmlj
ZSAqY291bnRlciwKLQkJCSAgICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKLQkJCSAg
ICAgIHVuc2lnbmVkIGxvbmcgKnZhbCkKKwkJCSAgICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpj
b3VudCwgdTY0ICp2YWwpCiB7CiAJc3RydWN0IG1jaHBfdGNfZGF0YSAqY29uc3QgcHJpdiA9IGNv
dW50ZXItPnByaXY7CiAJdTMyIGNudDsKQEAgLTI2NCwxMiArMjUxLDEyIEBAIHN0YXRpYyBzdHJ1
Y3QgY291bnRlcl9jb3VudCBtY2hwX3RjX2NvdW50c1tdID0gewogfTsKIAogc3RhdGljIGNvbnN0
IHN0cnVjdCBjb3VudGVyX29wcyBtY2hwX3RjX29wcyA9IHsKLQkuc2lnbmFsX3JlYWQgID0gbWNo
cF90Y19jb3VudF9zaWduYWxfcmVhZCwKLQkuY291bnRfcmVhZCAgID0gbWNocF90Y19jb3VudF9y
ZWFkLAotCS5mdW5jdGlvbl9nZXQgPSBtY2hwX3RjX2NvdW50X2Z1bmN0aW9uX2dldCwKLQkuZnVu
Y3Rpb25fc2V0ID0gbWNocF90Y19jb3VudF9mdW5jdGlvbl9zZXQsCi0JLmFjdGlvbl9nZXQgICA9
IG1jaHBfdGNfY291bnRfYWN0aW9uX2dldCwKLQkuYWN0aW9uX3NldCAgID0gbWNocF90Y19jb3Vu
dF9hY3Rpb25fc2V0CisJLnNpZ25hbF9yZWFkICAgID0gbWNocF90Y19jb3VudF9zaWduYWxfcmVh
ZCwKKwkuY291bnRfcmVhZCAgICAgPSBtY2hwX3RjX2NvdW50X3JlYWQsCisJLmZ1bmN0aW9uX3Jl
YWQgID0gbWNocF90Y19jb3VudF9mdW5jdGlvbl9yZWFkLAorCS5mdW5jdGlvbl93cml0ZSA9IG1j
aHBfdGNfY291bnRfZnVuY3Rpb25fd3JpdGUsCisJLmFjdGlvbl9yZWFkICAgID0gbWNocF90Y19j
b3VudF9hY3Rpb25fcmVhZCwKKwkuYWN0aW9uX3dyaXRlICAgPSBtY2hwX3RjX2NvdW50X2FjdGlv
bl93cml0ZQogfTsKIAogc3RhdGljIGNvbnN0IHN0cnVjdCBhdG1lbF90Y2JfY29uZmlnIHRjYl9y
bTkyMDBfY29uZmlnID0gewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9jb3VudGVyL3N0bTMyLWxwdGlt
ZXItY250LmMgYi9kcml2ZXJzL2NvdW50ZXIvc3RtMzItbHB0aW1lci1jbnQuYwppbmRleCAxMzY1
Njk1N2M0NWYuLmJlZGU4MDI2YjZhYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9jb3VudGVyL3N0bTMy
LWxwdGltZXItY250LmMKKysrIGIvZHJpdmVycy9jb3VudGVyL3N0bTMyLWxwdGltZXItY250LmMK
QEAgLTE3LDYgKzE3LDcgQEAKICNpbmNsdWRlIDxsaW51eC9tb2R1bGUuaD4KICNpbmNsdWRlIDxs
aW51eC9waW5jdHJsL2NvbnN1bWVyLmg+CiAjaW5jbHVkZSA8bGludXgvcGxhdGZvcm1fZGV2aWNl
Lmg+CisjaW5jbHVkZSA8bGludXgvdHlwZXMuaD4KIAogc3RydWN0IHN0bTMyX2xwdGltX2NudCB7
CiAJc3RydWN0IGNvdW50ZXJfZGV2aWNlIGNvdW50ZXI7CkBAIC0xMzAsMzIgKzEzMSw0NiBAQCBz
dGF0aWMgaW50IHN0bTMyX2xwdGltX3NldHVwKHN0cnVjdCBzdG0zMl9scHRpbV9jbnQgKnByaXYs
IGludCBlbmFibGUpCiAgKiArLS0tLS0tLS0tKy0tLS0tLS0tLS0rLS0tLS0tLS0tLSstLS0tLS0t
LS0rLS0tLS0tLS0tLSstLS0tLS0tLS0rCiAgKi8KIGVudW0gc3RtMzJfbHB0aW1fY250X2Z1bmN0
aW9uIHsKLQlTVE0zMl9MUFRJTV9DT1VOVEVSX0lOQ1JFQVNFLAotCVNUTTMyX0xQVElNX0VOQ09E
RVJfQk9USF9FREdFLAorCVNUTTMyX0xQVElNX0NPVU5URVJfSU5DUkVBU0UgPSBDT1VOVEVSX0ZV
TkNUSU9OX0lOQ1JFQVNFLAorCVNUTTMyX0xQVElNX0VOQ09ERVJfQk9USF9FREdFID0gQ09VTlRF
Ul9GVU5DVElPTl9RVUFEUkFUVVJFX1g0LAogfTsKIAogc3RhdGljIGNvbnN0IGVudW0gY291bnRl
cl9mdW5jdGlvbiBzdG0zMl9scHRpbV9jbnRfZnVuY3Rpb25zW10gPSB7Ci0JW1NUTTMyX0xQVElN
X0NPVU5URVJfSU5DUkVBU0VdID0gQ09VTlRFUl9GVU5DVElPTl9JTkNSRUFTRSwKLQlbU1RNMzJf
TFBUSU1fRU5DT0RFUl9CT1RIX0VER0VdID0gQ09VTlRFUl9GVU5DVElPTl9RVUFEUkFUVVJFX1g0
LAorCVNUTTMyX0xQVElNX0NPVU5URVJfSU5DUkVBU0UsCisJU1RNMzJfTFBUSU1fRU5DT0RFUl9C
T1RIX0VER0UsCiB9OwogCiBlbnVtIHN0bTMyX2xwdGltX3N5bmFwc2VfYWN0aW9uIHsKKwkvKiBJ
bmRleCBtdXN0IG1hdGNoIHdpdGggc3RtMzJfbHB0aW1fY250X3BvbGFyaXR5W10gKHByaXYtPnBv
bGFyaXR5KSAqLwogCVNUTTMyX0xQVElNX1NZTkFQU0VfQUNUSU9OX1JJU0lOR19FREdFLAogCVNU
TTMyX0xQVElNX1NZTkFQU0VfQUNUSU9OX0ZBTExJTkdfRURHRSwKIAlTVE0zMl9MUFRJTV9TWU5B
UFNFX0FDVElPTl9CT1RIX0VER0VTLAogCVNUTTMyX0xQVElNX1NZTkFQU0VfQUNUSU9OX05PTkUs
CiB9OwogCi1zdGF0aWMgY29uc3QgZW51bSBjb3VudGVyX3N5bmFwc2VfYWN0aW9uIHN0bTMyX2xw
dGltX2NudF9zeW5hcHNlX2FjdGlvbnNbXSA9IHsKLQkvKiBJbmRleCBtdXN0IG1hdGNoIHdpdGgg
c3RtMzJfbHB0aW1fY250X3BvbGFyaXR5W10gKHByaXYtPnBvbGFyaXR5KSAqLworc3RhdGljIGNv
bnN0IGVudW0gc3RtMzJfbHB0aW1fc3luYXBzZV9hY3Rpb24gc3RtMzJfbHB0aW1fYzJsX2FjdGlv
bnNfbWFwW10gPSB7CisJW0NPVU5URVJfU1lOQVBTRV9BQ1RJT05fUklTSU5HX0VER0VdID0gU1RN
MzJfTFBUSU1fU1lOQVBTRV9BQ1RJT05fUklTSU5HX0VER0UsCisJW0NPVU5URVJfU1lOQVBTRV9B
Q1RJT05fRkFMTElOR19FREdFXSA9IFNUTTMyX0xQVElNX1NZTkFQU0VfQUNUSU9OX0ZBTExJTkdf
RURHRSwKKwlbQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9CT1RIX0VER0VTXSA9IFNUTTMyX0xQVElN
X1NZTkFQU0VfQUNUSU9OX0JPVEhfRURHRVMsCisJW0NPVU5URVJfU1lOQVBTRV9BQ1RJT05fTk9O
RV0gPSBTVE0zMl9MUFRJTV9TWU5BUFNFX0FDVElPTl9OT05FLAorfTsKKworc3RhdGljIGNvbnN0
IGVudW0gY291bnRlcl9zeW5hcHNlX2FjdGlvbiBzdG0zMl9scHRpbV9sMmNfYWN0aW9uc19tYXBb
XSA9IHsKIAlbU1RNMzJfTFBUSU1fU1lOQVBTRV9BQ1RJT05fUklTSU5HX0VER0VdID0gQ09VTlRF
Ul9TWU5BUFNFX0FDVElPTl9SSVNJTkdfRURHRSwKIAlbU1RNMzJfTFBUSU1fU1lOQVBTRV9BQ1RJ
T05fRkFMTElOR19FREdFXSA9IENPVU5URVJfU1lOQVBTRV9BQ1RJT05fRkFMTElOR19FREdFLAog
CVtTVE0zMl9MUFRJTV9TWU5BUFNFX0FDVElPTl9CT1RIX0VER0VTXSA9IENPVU5URVJfU1lOQVBT
RV9BQ1RJT05fQk9USF9FREdFUywKIAlbU1RNMzJfTFBUSU1fU1lOQVBTRV9BQ1RJT05fTk9ORV0g
PSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX05PTkUsCiB9OwogCitzdGF0aWMgY29uc3QgZW51bSBj
b3VudGVyX3N5bmFwc2VfYWN0aW9uIHN0bTMyX2xwdGltX2NudF9zeW5hcHNlX2FjdGlvbnNbXSA9
IHsKKwlDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX1JJU0lOR19FREdFLAorCUNPVU5URVJfU1lOQVBT
RV9BQ1RJT05fRkFMTElOR19FREdFLAorCUNPVU5URVJfU1lOQVBTRV9BQ1RJT05fQk9USF9FREdF
UywKKwlDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX05PTkUsCit9OworCiBzdGF0aWMgaW50IHN0bTMy
X2xwdGltX2NudF9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQlzdHJ1
Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHVuc2lnbmVkIGxvbmcgKnZhbCkKKwkJCQlzdHJ1Y3Qg
Y291bnRlcl9jb3VudCAqY291bnQsIHU2NCAqdmFsKQogewogCXN0cnVjdCBzdG0zMl9scHRpbV9j
bnQgKmNvbnN0IHByaXYgPSBjb3VudGVyLT5wcml2OwogCXUzMiBjbnQ7CkBAIC0xNzAsOSArMTg1
LDkgQEAgc3RhdGljIGludCBzdG0zMl9scHRpbV9jbnRfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZp
Y2UgKmNvdW50ZXIsCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBpbnQgc3RtMzJfbHB0aW1fY250
X2Z1bmN0aW9uX2dldChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkJCXN0cnVj
dCBjb3VudGVyX2NvdW50ICpjb3VudCwKLQkJCQkJc2l6ZV90ICpmdW5jdGlvbikKK3N0YXRpYyBp
bnQgc3RtMzJfbHB0aW1fY250X2Z1bmN0aW9uX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpj
b3VudGVyLAorCQkJCQkgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAorCQkJCQkgZW51bSBj
b3VudGVyX2Z1bmN0aW9uICpmdW5jdGlvbikKIHsKIAlzdHJ1Y3Qgc3RtMzJfbHB0aW1fY250ICpj
b25zdCBwcml2ID0gY291bnRlci0+cHJpdjsKIApAQCAtMTg5LDE2ICsyMDQsMzcgQEAgc3RhdGlj
IGludCBzdG0zMl9scHRpbV9jbnRfZnVuY3Rpb25fZ2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAq
Y291bnRlciwKIAlyZXR1cm4gLUVJTlZBTDsKIH0KIAotc3RhdGljIGludCBzdG0zMl9scHRpbV9j
bnRfZnVuY3Rpb25fc2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQkJc3Ry
dWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkJCQlzaXplX3QgZnVuY3Rpb24pCitzdGF0aWMg
aW50IHN0bTMyX2xwdGltX2Z1bmNfbWFwKGVudW0gc3RtMzJfbHB0aW1fY250X2Z1bmN0aW9uICpj
b25zdCBjbnRfZnVuYywKKwkJCQljb25zdCBlbnVtIGNvdW50ZXJfZnVuY3Rpb24gZnVuY3Rpb24p
Cit7CisJc3dpdGNoIChmdW5jdGlvbikgeworCWNhc2UgQ09VTlRFUl9GVU5DVElPTl9JTkNSRUFT
RToKKwkJKmNudF9mdW5jID0gU1RNMzJfTFBUSU1fQ09VTlRFUl9JTkNSRUFTRTsKKwkJcmV0dXJu
IDA7CisJY2FzZSBDT1VOVEVSX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDQ6CisJCSpjbnRfZnVuYyA9
IFNUTTMyX0xQVElNX0VOQ09ERVJfQk9USF9FREdFOworCQlyZXR1cm4gMDsKKwlkZWZhdWx0Ogor
CQlyZXR1cm4gLUVJTlZBTDsKKwl9Cit9CisKK3N0YXRpYyBpbnQgc3RtMzJfbHB0aW1fY250X2Z1
bmN0aW9uX3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkJICBzdHJ1
Y3QgY291bnRlcl9jb3VudCAqY291bnQsCisJCQkJCSAgZW51bSBjb3VudGVyX2Z1bmN0aW9uIGZ1
bmN0aW9uKQogewogCXN0cnVjdCBzdG0zMl9scHRpbV9jbnQgKmNvbnN0IHByaXYgPSBjb3VudGVy
LT5wcml2OworCWVudW0gc3RtMzJfbHB0aW1fY250X2Z1bmN0aW9uIGNudF9mdW5jOworCWludCBl
cnI7CiAKIAlpZiAoc3RtMzJfbHB0aW1faXNfZW5hYmxlZChwcml2KSkKIAkJcmV0dXJuIC1FQlVT
WTsKIAotCXN3aXRjaCAoZnVuY3Rpb24pIHsKKwllcnIgPSBzdG0zMl9scHRpbV9mdW5jX21hcCgm
Y250X2Z1bmMsIGZ1bmN0aW9uKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJc3dpdGNo
IChjbnRfZnVuYykgewogCWNhc2UgU1RNMzJfTFBUSU1fQ09VTlRFUl9JTkNSRUFTRToKIAkJcHJp
di0+cXVhZHJhdHVyZV9tb2RlID0gMDsKIAkJcmV0dXJuIDA7CkBAIC0yMTIsOSArMjQ4LDkgQEAg
c3RhdGljIGludCBzdG0zMl9scHRpbV9jbnRfZnVuY3Rpb25fc2V0KHN0cnVjdCBjb3VudGVyX2Rl
dmljZSAqY291bnRlciwKIAl9CiB9CiAKLXN0YXRpYyBzc2l6ZV90IHN0bTMyX2xwdGltX2NudF9l
bmFibGVfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkJCSAgIHN0cnVj
dCBjb3VudGVyX2NvdW50ICpjb3VudCwKLQkJCQkJICAgdm9pZCAqcHJpdmF0ZSwgY2hhciAqYnVm
KQorc3RhdGljIGludCBzdG0zMl9scHRpbV9jbnRfZW5hYmxlX3JlYWQoc3RydWN0IGNvdW50ZXJf
ZGV2aWNlICpjb3VudGVyLAorCQkJCSAgICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQs
CisJCQkJICAgICAgIHU4ICplbmFibGUpCiB7CiAJc3RydWN0IHN0bTMyX2xwdGltX2NudCAqY29u
c3QgcHJpdiA9IGNvdW50ZXItPnByaXY7CiAJaW50IHJldDsKQEAgLTIyMywyMiArMjU5LDE4IEBA
IHN0YXRpYyBzc2l6ZV90IHN0bTMyX2xwdGltX2NudF9lbmFibGVfcmVhZChzdHJ1Y3QgY291bnRl
cl9kZXZpY2UgKmNvdW50ZXIsCiAJaWYgKHJldCA8IDApCiAJCXJldHVybiByZXQ7CiAKLQlyZXR1
cm4gc2NucHJpbnRmKGJ1ZiwgUEFHRV9TSVpFLCAiJXVcbiIsIHJldCk7CisJKmVuYWJsZSA9IHJl
dDsKKworCXJldHVybiAwOwogfQogCi1zdGF0aWMgc3NpemVfdCBzdG0zMl9scHRpbV9jbnRfZW5h
YmxlX3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQkJICAgIHN0cnVj
dCBjb3VudGVyX2NvdW50ICpjb3VudCwKLQkJCQkJICAgIHZvaWQgKnByaXZhdGUsCi0JCQkJCSAg
ICBjb25zdCBjaGFyICpidWYsIHNpemVfdCBsZW4pCitzdGF0aWMgaW50IHN0bTMyX2xwdGltX2Nu
dF9lbmFibGVfd3JpdGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCQlzdHJ1
Y3QgY291bnRlcl9jb3VudCAqY291bnQsCisJCQkJCXU4IGVuYWJsZSkKIHsKIAlzdHJ1Y3Qgc3Rt
MzJfbHB0aW1fY250ICpjb25zdCBwcml2ID0gY291bnRlci0+cHJpdjsKLQlib29sIGVuYWJsZTsK
IAlpbnQgcmV0OwogCi0JcmV0ID0ga3N0cnRvYm9vbChidWYsICZlbmFibGUpOwotCWlmIChyZXQp
Ci0JCXJldHVybiByZXQ7Ci0KIAkvKiBDaGVjayBub2JvZHkgdXNlcyB0aGUgdGltZXIsIG9yIGFs
cmVhZHkgZGlzYWJsZWQvZW5hYmxlZCAqLwogCXJldCA9IHN0bTMyX2xwdGltX2lzX2VuYWJsZWQo
cHJpdik7CiAJaWYgKChyZXQgPCAwKSB8fCAoIXJldCAmJiAhZW5hYmxlKSkKQEAgLTI1NCw3OCAr
Mjg2LDcyIEBAIHN0YXRpYyBzc2l6ZV90IHN0bTMyX2xwdGltX2NudF9lbmFibGVfd3JpdGUoc3Ry
dWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAK
LQlyZXR1cm4gbGVuOworCXJldHVybiAwOwogfQogCi1zdGF0aWMgc3NpemVfdCBzdG0zMl9scHRp
bV9jbnRfY2VpbGluZ19yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQkJ
ICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKLQkJCQkJICAgIHZvaWQgKnByaXZhdGUs
IGNoYXIgKmJ1ZikKK3N0YXRpYyBpbnQgc3RtMzJfbHB0aW1fY250X2NlaWxpbmdfcmVhZChzdHJ1
Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJCXN0cnVjdCBjb3VudGVyX2NvdW50ICpj
b3VudCwKKwkJCQkJdTY0ICpjZWlsaW5nKQogewogCXN0cnVjdCBzdG0zMl9scHRpbV9jbnQgKmNv
bnN0IHByaXYgPSBjb3VudGVyLT5wcml2OwogCi0JcmV0dXJuIHNucHJpbnRmKGJ1ZiwgUEFHRV9T
SVpFLCAiJXVcbiIsIHByaXYtPmNlaWxpbmcpOworCSpjZWlsaW5nID0gcHJpdi0+Y2VpbGluZzsK
KworCXJldHVybiAwOwogfQogCi1zdGF0aWMgc3NpemVfdCBzdG0zMl9scHRpbV9jbnRfY2VpbGlu
Z193cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkJCSAgICAgc3RydWN0
IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkJCQkgICAgIHZvaWQgKnByaXZhdGUsCi0JCQkJCSAg
ICAgY29uc3QgY2hhciAqYnVmLCBzaXplX3QgbGVuKQorc3RhdGljIGludCBzdG0zMl9scHRpbV9j
bnRfY2VpbGluZ193cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJCSBz
dHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCisJCQkJCSB1NjQgY2VpbGluZykKIHsKIAlzdHJ1
Y3Qgc3RtMzJfbHB0aW1fY250ICpjb25zdCBwcml2ID0gY291bnRlci0+cHJpdjsKLQl1bnNpZ25l
ZCBpbnQgY2VpbGluZzsKLQlpbnQgcmV0OwogCiAJaWYgKHN0bTMyX2xwdGltX2lzX2VuYWJsZWQo
cHJpdikpCiAJCXJldHVybiAtRUJVU1k7CiAKLQlyZXQgPSBrc3RydG91aW50KGJ1ZiwgMCwgJmNl
aWxpbmcpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KIAlpZiAoY2VpbGluZyA+IFNUTTMy
X0xQVElNX01BWF9BUlIpCiAJCXJldHVybiAtRVJBTkdFOwogCiAJcHJpdi0+Y2VpbGluZyA9IGNl
aWxpbmc7CiAKLQlyZXR1cm4gbGVuOworCXJldHVybiAwOwogfQogCi1zdGF0aWMgY29uc3Qgc3Ry
dWN0IGNvdW50ZXJfY291bnRfZXh0IHN0bTMyX2xwdGltX2NudF9leHRbXSA9IHsKLQl7Ci0JCS5u
YW1lID0gImVuYWJsZSIsCi0JCS5yZWFkID0gc3RtMzJfbHB0aW1fY250X2VuYWJsZV9yZWFkLAot
CQkud3JpdGUgPSBzdG0zMl9scHRpbV9jbnRfZW5hYmxlX3dyaXRlCi0JfSwKLQl7Ci0JCS5uYW1l
ID0gImNlaWxpbmciLAotCQkucmVhZCA9IHN0bTMyX2xwdGltX2NudF9jZWlsaW5nX3JlYWQsCi0J
CS53cml0ZSA9IHN0bTMyX2xwdGltX2NudF9jZWlsaW5nX3dyaXRlCi0JfSwKK3N0YXRpYyBzdHJ1
Y3QgY291bnRlcl9jb21wIHN0bTMyX2xwdGltX2NudF9leHRbXSA9IHsKKwlDT1VOVEVSX0NPTVBf
RU5BQkxFKHN0bTMyX2xwdGltX2NudF9lbmFibGVfcmVhZCwKKwkJCSAgICBzdG0zMl9scHRpbV9j
bnRfZW5hYmxlX3dyaXRlKSwKKwlDT1VOVEVSX0NPTVBfQ0VJTElORyhzdG0zMl9scHRpbV9jbnRf
Y2VpbGluZ19yZWFkLAorCQkJICAgICBzdG0zMl9scHRpbV9jbnRfY2VpbGluZ193cml0ZSksCiB9
OwogCi1zdGF0aWMgaW50IHN0bTMyX2xwdGltX2NudF9hY3Rpb25fZ2V0KHN0cnVjdCBjb3VudGVy
X2RldmljZSAqY291bnRlciwKLQkJCQkgICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQs
Ci0JCQkJICAgICAgc3RydWN0IGNvdW50ZXJfc3luYXBzZSAqc3luYXBzZSwKLQkJCQkgICAgICBz
aXplX3QgKmFjdGlvbikKK3N0YXRpYyBpbnQgc3RtMzJfbHB0aW1fY250X2FjdGlvbl9yZWFkKHN0
cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkgICAgICAgc3RydWN0IGNvdW50ZXJf
Y291bnQgKmNvdW50LAorCQkJCSAgICAgICBzdHJ1Y3QgY291bnRlcl9zeW5hcHNlICpzeW5hcHNl
LAorCQkJCSAgICAgICBlbnVtIGNvdW50ZXJfc3luYXBzZV9hY3Rpb24gKmFjdGlvbikKIHsKIAlz
dHJ1Y3Qgc3RtMzJfbHB0aW1fY250ICpjb25zdCBwcml2ID0gY291bnRlci0+cHJpdjsKLQlzaXpl
X3QgZnVuY3Rpb247CisJZW51bSBjb3VudGVyX2Z1bmN0aW9uIGZ1bmN0aW9uOworCWVudW0gc3Rt
MzJfbHB0aW1fY250X2Z1bmN0aW9uIGNudF9mdW5jOwogCWludCBlcnI7CiAKLQllcnIgPSBzdG0z
Ml9scHRpbV9jbnRfZnVuY3Rpb25fZ2V0KGNvdW50ZXIsIGNvdW50LCAmZnVuY3Rpb24pOworCWVy
ciA9IHN0bTMyX2xwdGltX2NudF9mdW5jdGlvbl9yZWFkKGNvdW50ZXIsIGNvdW50LCAmZnVuY3Rp
b24pOwogCWlmIChlcnIpCiAJCXJldHVybiBlcnI7CiAKLQlzd2l0Y2ggKGZ1bmN0aW9uKSB7CisJ
ZXJyID0gc3RtMzJfbHB0aW1fZnVuY19tYXAoJmNudF9mdW5jLCBmdW5jdGlvbik7CisJaWYgKGVy
cikKKwkJcmV0dXJuIGVycjsKKworCXN3aXRjaCAoY250X2Z1bmMpIHsKIAljYXNlIFNUTTMyX0xQ
VElNX0NPVU5URVJfSU5DUkVBU0U6CiAJCS8qIExQIFRpbWVyIGFjdHMgYXMgdXAtY291bnRlciBv
biBpbnB1dCAxICovCiAJCWlmIChzeW5hcHNlLT5zaWduYWwtPmlkID09IGNvdW50LT5zeW5hcHNl
c1swXS5zaWduYWwtPmlkKQotCQkJKmFjdGlvbiA9IHByaXYtPnBvbGFyaXR5OworCQkJKmFjdGlv
biA9IHN0bTMyX2xwdGltX2wyY19hY3Rpb25zX21hcFtwcml2LT5wb2xhcml0eV07CiAJCWVsc2UK
LQkJCSphY3Rpb24gPSBTVE0zMl9MUFRJTV9TWU5BUFNFX0FDVElPTl9OT05FOworCQkJKmFjdGlv
biA9IENPVU5URVJfU1lOQVBTRV9BQ1RJT05fTk9ORTsKIAkJcmV0dXJuIDA7CiAJY2FzZSBTVE0z
Ml9MUFRJTV9FTkNPREVSX0JPVEhfRURHRToKLQkJKmFjdGlvbiA9IHByaXYtPnBvbGFyaXR5Owor
CQkqYWN0aW9uID0gc3RtMzJfbHB0aW1fbDJjX2FjdGlvbnNfbWFwW3ByaXYtPnBvbGFyaXR5XTsK
IAkJcmV0dXJuIDA7CiAJZGVmYXVsdDoKIAkJLyogc2hvdWxkIG5ldmVyIHJlYWNoIHRoaXMgcGF0
aCAqLwpAQCAtMzMzLDQzICszNTksNDQgQEAgc3RhdGljIGludCBzdG0zMl9scHRpbV9jbnRfYWN0
aW9uX2dldChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAJfQogfQogCi1zdGF0aWMg
aW50IHN0bTMyX2xwdGltX2NudF9hY3Rpb25fc2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291
bnRlciwKLQkJCQkgICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCi0JCQkJICAgICAg
c3RydWN0IGNvdW50ZXJfc3luYXBzZSAqc3luYXBzZSwKLQkJCQkgICAgICBzaXplX3QgYWN0aW9u
KQorc3RhdGljIGludCBzdG0zMl9scHRpbV9jbnRfYWN0aW9uX3dyaXRlKHN0cnVjdCBjb3VudGVy
X2RldmljZSAqY291bnRlciwKKwkJCQkJc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAorCQkJ
CQlzdHJ1Y3QgY291bnRlcl9zeW5hcHNlICpzeW5hcHNlLAorCQkJCQllbnVtIGNvdW50ZXJfc3lu
YXBzZV9hY3Rpb24gYWN0aW9uKQogewogCXN0cnVjdCBzdG0zMl9scHRpbV9jbnQgKmNvbnN0IHBy
aXYgPSBjb3VudGVyLT5wcml2OwotCXNpemVfdCBmdW5jdGlvbjsKKwllbnVtIGNvdW50ZXJfZnVu
Y3Rpb24gZnVuY3Rpb247CisJZW51bSBzdG0zMl9scHRpbV9jbnRfZnVuY3Rpb24gY250X2Z1bmM7
CiAJaW50IGVycjsKIAogCWlmIChzdG0zMl9scHRpbV9pc19lbmFibGVkKHByaXYpKQogCQlyZXR1
cm4gLUVCVVNZOwogCi0JZXJyID0gc3RtMzJfbHB0aW1fY250X2Z1bmN0aW9uX2dldChjb3VudGVy
LCBjb3VudCwgJmZ1bmN0aW9uKTsKKwllcnIgPSBzdG0zMl9scHRpbV9jbnRfZnVuY3Rpb25fcmVh
ZChjb3VudGVyLCBjb3VudCwgJmZ1bmN0aW9uKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOwor
CisJZXJyID0gc3RtMzJfbHB0aW1fZnVuY19tYXAoJmNudF9mdW5jLCBmdW5jdGlvbik7CiAJaWYg
KGVycikKIAkJcmV0dXJuIGVycjsKIAogCS8qIG9ubHkgc2V0IHBvbGFyaXR5IHdoZW4gaW4gY291
bnRlciBtb2RlIChvbiBpbnB1dCAxKSAqLwotCWlmIChmdW5jdGlvbiA9PSBTVE0zMl9MUFRJTV9D
T1VOVEVSX0lOQ1JFQVNFCi0JICAgICYmIHN5bmFwc2UtPnNpZ25hbC0+aWQgPT0gY291bnQtPnN5
bmFwc2VzWzBdLnNpZ25hbC0+aWQpIHsKLQkJc3dpdGNoIChhY3Rpb24pIHsKLQkJY2FzZSBTVE0z
Ml9MUFRJTV9TWU5BUFNFX0FDVElPTl9SSVNJTkdfRURHRToKLQkJY2FzZSBTVE0zMl9MUFRJTV9T
WU5BUFNFX0FDVElPTl9GQUxMSU5HX0VER0U6Ci0JCWNhc2UgU1RNMzJfTFBUSU1fU1lOQVBTRV9B
Q1RJT05fQk9USF9FREdFUzoKLQkJCXByaXYtPnBvbGFyaXR5ID0gYWN0aW9uOwotCQkJcmV0dXJu
IDA7Ci0JCX0KLQl9CisJaWYgKGNudF9mdW5jICE9IFNUTTMyX0xQVElNX0NPVU5URVJfSU5DUkVB
U0UKKwkgICAgfHwgc3luYXBzZS0+c2lnbmFsLT5pZCAhPSBjb3VudC0+c3luYXBzZXNbMF0uc2ln
bmFsLT5pZAorCSAgICB8fCBhY3Rpb24gPT0gQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9OT05FKQor
CQlyZXR1cm4gLUVJTlZBTDsKIAotCXJldHVybiAtRUlOVkFMOworCXByaXYtPnBvbGFyaXR5ID0g
c3RtMzJfbHB0aW1fYzJsX2FjdGlvbnNfbWFwW2FjdGlvbl07CisKKwlyZXR1cm4gMDsKIH0KIAog
c3RhdGljIGNvbnN0IHN0cnVjdCBjb3VudGVyX29wcyBzdG0zMl9scHRpbV9jbnRfb3BzID0gewog
CS5jb3VudF9yZWFkID0gc3RtMzJfbHB0aW1fY250X3JlYWQsCi0JLmZ1bmN0aW9uX2dldCA9IHN0
bTMyX2xwdGltX2NudF9mdW5jdGlvbl9nZXQsCi0JLmZ1bmN0aW9uX3NldCA9IHN0bTMyX2xwdGlt
X2NudF9mdW5jdGlvbl9zZXQsCi0JLmFjdGlvbl9nZXQgPSBzdG0zMl9scHRpbV9jbnRfYWN0aW9u
X2dldCwKLQkuYWN0aW9uX3NldCA9IHN0bTMyX2xwdGltX2NudF9hY3Rpb25fc2V0LAorCS5mdW5j
dGlvbl9yZWFkID0gc3RtMzJfbHB0aW1fY250X2Z1bmN0aW9uX3JlYWQsCisJLmZ1bmN0aW9uX3dy
aXRlID0gc3RtMzJfbHB0aW1fY250X2Z1bmN0aW9uX3dyaXRlLAorCS5hY3Rpb25fcmVhZCA9IHN0
bTMyX2xwdGltX2NudF9hY3Rpb25fcmVhZCwKKwkuYWN0aW9uX3dyaXRlID0gc3RtMzJfbHB0aW1f
Y250X2FjdGlvbl93cml0ZSwKIH07CiAKIHN0YXRpYyBzdHJ1Y3QgY291bnRlcl9zaWduYWwgc3Rt
MzJfbHB0aW1fY250X3NpZ25hbHNbXSA9IHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvY291bnRlci9z
dG0zMi10aW1lci1jbnQuYyBiL2RyaXZlcnMvY291bnRlci9zdG0zMi10aW1lci1jbnQuYwppbmRl
eCAzZmIwZGViZDc0MjUuLmM2OTBiNzZlNWRhYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9jb3VudGVy
L3N0bTMyLXRpbWVyLWNudC5jCisrKyBiL2RyaXZlcnMvY291bnRlci9zdG0zMi10aW1lci1jbnQu
YwpAQCAtMTMsNiArMTMsNyBAQAogI2luY2x1ZGUgPGxpbnV4L21vZHVsZS5oPgogI2luY2x1ZGUg
PGxpbnV4L3BpbmN0cmwvY29uc3VtZXIuaD4KICNpbmNsdWRlIDxsaW51eC9wbGF0Zm9ybV9kZXZp
Y2UuaD4KKyNpbmNsdWRlIDxsaW51eC90eXBlcy5oPgogCiAjZGVmaW5lIFRJTV9DQ01SX0NDWFMJ
KEJJVCg4KSB8IEJJVCgwKSkKICNkZWZpbmUgVElNX0NDTVJfTUFTSwkoVElNX0NDTVJfQ0MxUyB8
IFRJTV9DQ01SX0NDMlMgfCBcCkBAIC00NCwyMSArNDUsMjEgQEAgc3RydWN0IHN0bTMyX3RpbWVy
X2NudCB7CiAgKiBAU1RNMzJfQ09VTlRfRU5DT0RFUl9NT0RFXzM6IGNvdW50cyBvbiBib3RoIFRJ
MUZQMSBhbmQgVEkyRlAyIGVkZ2VzCiAgKi8KIGVudW0gc3RtMzJfY291bnRfZnVuY3Rpb24gewor
CVNUTTMyX0NPVU5UX1NMQVZFX01PREVfRElTQUJMRUQgPSBDT1VOVEVSX0ZVTkNUSU9OX0lOQ1JF
QVNFLAorCVNUTTMyX0NPVU5UX0VOQ09ERVJfTU9ERV8xID0gQ09VTlRFUl9GVU5DVElPTl9RVUFE
UkFUVVJFX1gyX0EsCisJU1RNMzJfQ09VTlRfRU5DT0RFUl9NT0RFXzIgPSBDT1VOVEVSX0ZVTkNU
SU9OX1FVQURSQVRVUkVfWDJfQiwKKwlTVE0zMl9DT1VOVF9FTkNPREVSX01PREVfMyA9IENPVU5U
RVJfRlVOQ1RJT05fUVVBRFJBVFVSRV9YNCwKK307CisKK3N0YXRpYyBjb25zdCBlbnVtIGNvdW50
ZXJfZnVuY3Rpb24gc3RtMzJfY291bnRfZnVuY3Rpb25zW10gPSB7CiAJU1RNMzJfQ09VTlRfU0xB
VkVfTU9ERV9ESVNBQkxFRCwKIAlTVE0zMl9DT1VOVF9FTkNPREVSX01PREVfMSwKIAlTVE0zMl9D
T1VOVF9FTkNPREVSX01PREVfMiwKIAlTVE0zMl9DT1VOVF9FTkNPREVSX01PREVfMywKIH07CiAK
LXN0YXRpYyBjb25zdCBlbnVtIGNvdW50ZXJfZnVuY3Rpb24gc3RtMzJfY291bnRfZnVuY3Rpb25z
W10gPSB7Ci0JW1NUTTMyX0NPVU5UX1NMQVZFX01PREVfRElTQUJMRURdID0gQ09VTlRFUl9GVU5D
VElPTl9JTkNSRUFTRSwKLQlbU1RNMzJfQ09VTlRfRU5DT0RFUl9NT0RFXzFdID0gQ09VTlRFUl9G
VU5DVElPTl9RVUFEUkFUVVJFX1gyX0EsCi0JW1NUTTMyX0NPVU5UX0VOQ09ERVJfTU9ERV8yXSA9
IENPVU5URVJfRlVOQ1RJT05fUVVBRFJBVFVSRV9YMl9CLAotCVtTVE0zMl9DT1VOVF9FTkNPREVS
X01PREVfM10gPSBDT1VOVEVSX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDQsCi19OwotCiBzdGF0aWMg
aW50IHN0bTMyX2NvdW50X3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJ
ICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgdW5zaWduZWQgbG9uZyAqdmFsKQorCQkJ
ICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgdTY0ICp2YWwpCiB7CiAJc3RydWN0IHN0
bTMyX3RpbWVyX2NudCAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7CiAJdTMyIGNudDsKQEAg
LTcwLDggKzcxLDcgQEAgc3RhdGljIGludCBzdG0zMl9jb3VudF9yZWFkKHN0cnVjdCBjb3VudGVy
X2RldmljZSAqY291bnRlciwKIH0KIAogc3RhdGljIGludCBzdG0zMl9jb3VudF93cml0ZShzdHJ1
Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkgICAgIHN0cnVjdCBjb3VudGVyX2NvdW50
ICpjb3VudCwKLQkJCSAgICAgY29uc3QgdW5zaWduZWQgbG9uZyB2YWwpCisJCQkgICAgIHN0cnVj
dCBjb3VudGVyX2NvdW50ICpjb3VudCwgY29uc3QgdTY0IHZhbCkKIHsKIAlzdHJ1Y3Qgc3RtMzJf
dGltZXJfY250ICpjb25zdCBwcml2ID0gY291bnRlci0+cHJpdjsKIAl1MzIgY2VpbGluZzsKQEAg
LTgzLDkgKzgzLDkgQEAgc3RhdGljIGludCBzdG0zMl9jb3VudF93cml0ZShzdHJ1Y3QgY291bnRl
cl9kZXZpY2UgKmNvdW50ZXIsCiAJcmV0dXJuIHJlZ21hcF93cml0ZShwcml2LT5yZWdtYXAsIFRJ
TV9DTlQsIHZhbCk7CiB9CiAKLXN0YXRpYyBpbnQgc3RtMzJfY291bnRfZnVuY3Rpb25fZ2V0KHN0
cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQkgICAgc3RydWN0IGNvdW50ZXJfY291
bnQgKmNvdW50LAotCQkJCSAgICBzaXplX3QgKmZ1bmN0aW9uKQorc3RhdGljIGludCBzdG0zMl9j
b3VudF9mdW5jdGlvbl9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkg
ICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKKwkJCQkgICAgIGVudW0gY291bnRlcl9m
dW5jdGlvbiAqZnVuY3Rpb24pCiB7CiAJc3RydWN0IHN0bTMyX3RpbWVyX2NudCAqY29uc3QgcHJp
diA9IGNvdW50ZXItPnByaXY7CiAJdTMyIHNtY3I7CkBAIC0xMTAsOSArMTEwLDkgQEAgc3RhdGlj
IGludCBzdG0zMl9jb3VudF9mdW5jdGlvbl9nZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3Vu
dGVyLAogCX0KIH0KIAotc3RhdGljIGludCBzdG0zMl9jb3VudF9mdW5jdGlvbl9zZXQoc3RydWN0
IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCSAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAq
Y291bnQsCi0JCQkJICAgIHNpemVfdCBmdW5jdGlvbikKK3N0YXRpYyBpbnQgc3RtMzJfY291bnRf
ZnVuY3Rpb25fd3JpdGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCSAgICAg
IHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKKwkJCQkgICAgICBlbnVtIGNvdW50ZXJfZnVu
Y3Rpb24gZnVuY3Rpb24pCiB7CiAJc3RydWN0IHN0bTMyX3RpbWVyX2NudCAqY29uc3QgcHJpdiA9
IGNvdW50ZXItPnByaXY7CiAJdTMyIGNyMSwgc21zOwpAQCAtMTUwLDQ0ICsxNTAsMzcgQEAgc3Rh
dGljIGludCBzdG0zMl9jb3VudF9mdW5jdGlvbl9zZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpj
b3VudGVyLAogCXJldHVybiAwOwogfQogCi1zdGF0aWMgc3NpemVfdCBzdG0zMl9jb3VudF9kaXJl
Y3Rpb25fcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCitzdGF0aWMgaW50IHN0
bTMyX2NvdW50X2RpcmVjdGlvbl9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwK
IAkJCQkgICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCi0JCQkJICAgICAgdm9pZCAq
cHJpdmF0ZSwgY2hhciAqYnVmKQorCQkJCSAgICAgIGVudW0gY291bnRlcl9jb3VudF9kaXJlY3Rp
b24gKmRpcmVjdGlvbikKIHsKIAlzdHJ1Y3Qgc3RtMzJfdGltZXJfY250ICpjb25zdCBwcml2ID0g
Y291bnRlci0+cHJpdjsKLQljb25zdCBjaGFyICpkaXJlY3Rpb247CiAJdTMyIGNyMTsKIAogCXJl
Z21hcF9yZWFkKHByaXYtPnJlZ21hcCwgVElNX0NSMSwgJmNyMSk7Ci0JZGlyZWN0aW9uID0gKGNy
MSAmIFRJTV9DUjFfRElSKSA/ICJiYWNrd2FyZCIgOiAiZm9yd2FyZCI7CisJKmRpcmVjdGlvbiA9
IChjcjEgJiBUSU1fQ1IxX0RJUikgPyBDT1VOVEVSX0NPVU5UX0RJUkVDVElPTl9CQUNLV0FSRCA6
CisJCUNPVU5URVJfQ09VTlRfRElSRUNUSU9OX0ZPUldBUkQ7CiAKLQlyZXR1cm4gc2NucHJpbnRm
KGJ1ZiwgUEFHRV9TSVpFLCAiJXNcbiIsIGRpcmVjdGlvbik7CisJcmV0dXJuIDA7CiB9CiAKLXN0
YXRpYyBzc2l6ZV90IHN0bTMyX2NvdW50X2NlaWxpbmdfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZp
Y2UgKmNvdW50ZXIsCi0JCQkJCXN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKLQkJCQkJdm9p
ZCAqcHJpdmF0ZSwgY2hhciAqYnVmKQorc3RhdGljIGludCBzdG0zMl9jb3VudF9jZWlsaW5nX3Jl
YWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCSAgICBzdHJ1Y3QgY291bnRl
cl9jb3VudCAqY291bnQsIHU2NCAqY2VpbGluZykKIHsKIAlzdHJ1Y3Qgc3RtMzJfdGltZXJfY250
ICpjb25zdCBwcml2ID0gY291bnRlci0+cHJpdjsKIAl1MzIgYXJyOwogCiAJcmVnbWFwX3JlYWQo
cHJpdi0+cmVnbWFwLCBUSU1fQVJSLCAmYXJyKTsKIAotCXJldHVybiBzbnByaW50ZihidWYsIFBB
R0VfU0laRSwgIiV1XG4iLCBhcnIpOworCSpjZWlsaW5nID0gYXJyOworCisJcmV0dXJuIDA7CiB9
CiAKLXN0YXRpYyBzc2l6ZV90IHN0bTMyX2NvdW50X2NlaWxpbmdfd3JpdGUoc3RydWN0IGNvdW50
ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCQkgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAot
CQkJCQkgdm9pZCAqcHJpdmF0ZSwKLQkJCQkJIGNvbnN0IGNoYXIgKmJ1Ziwgc2l6ZV90IGxlbikK
K3N0YXRpYyBpbnQgc3RtMzJfY291bnRfY2VpbGluZ193cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZp
Y2UgKmNvdW50ZXIsCisJCQkJICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHU2NCBj
ZWlsaW5nKQogewogCXN0cnVjdCBzdG0zMl90aW1lcl9jbnQgKmNvbnN0IHByaXYgPSBjb3VudGVy
LT5wcml2OwotCXVuc2lnbmVkIGludCBjZWlsaW5nOwotCWludCByZXQ7Ci0KLQlyZXQgPSBrc3Ry
dG91aW50KGJ1ZiwgMCwgJmNlaWxpbmcpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7CiAKIAlp
ZiAoY2VpbGluZyA+IHByaXYtPm1heF9hcnIpCiAJCXJldHVybiAtRVJBTkdFOwpAQCAtMTk2LDM0
ICsxODksMjcgQEAgc3RhdGljIHNzaXplX3Qgc3RtMzJfY291bnRfY2VpbGluZ193cml0ZShzdHJ1
Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAJcmVnbWFwX3VwZGF0ZV9iaXRzKHByaXYtPnJl
Z21hcCwgVElNX0NSMSwgVElNX0NSMV9BUlBFLCAwKTsKIAlyZWdtYXBfd3JpdGUocHJpdi0+cmVn
bWFwLCBUSU1fQVJSLCBjZWlsaW5nKTsKIAotCXJldHVybiBsZW47CisJcmV0dXJuIDA7CiB9CiAK
LXN0YXRpYyBzc2l6ZV90IHN0bTMyX2NvdW50X2VuYWJsZV9yZWFkKHN0cnVjdCBjb3VudGVyX2Rl
dmljZSAqY291bnRlciwKLQkJCQkgICAgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAot
CQkJCSAgICAgICB2b2lkICpwcml2YXRlLCBjaGFyICpidWYpCitzdGF0aWMgaW50IHN0bTMyX2Nv
dW50X2VuYWJsZV9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkgICBz
dHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHU4ICplbmFibGUpCiB7CiAJc3RydWN0IHN0bTMy
X3RpbWVyX2NudCAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7CiAJdTMyIGNyMTsKIAogCXJl
Z21hcF9yZWFkKHByaXYtPnJlZ21hcCwgVElNX0NSMSwgJmNyMSk7CiAKLQlyZXR1cm4gc2NucHJp
bnRmKGJ1ZiwgUEFHRV9TSVpFLCAiJWRcbiIsIChib29sKShjcjEgJiBUSU1fQ1IxX0NFTikpOwor
CSplbmFibGUgPSBjcjEgJiBUSU1fQ1IxX0NFTjsKKworCXJldHVybiAwOwogfQogCi1zdGF0aWMg
c3NpemVfdCBzdG0zMl9jb3VudF9lbmFibGVfd3JpdGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpj
b3VudGVyLAotCQkJCQlzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCi0JCQkJCXZvaWQgKnBy
aXZhdGUsCi0JCQkJCWNvbnN0IGNoYXIgKmJ1Ziwgc2l6ZV90IGxlbikKK3N0YXRpYyBpbnQgc3Rt
MzJfY291bnRfZW5hYmxlX3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJ
CQkgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB1OCBlbmFibGUpCiB7CiAJc3RydWN0
IHN0bTMyX3RpbWVyX2NudCAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7Ci0JaW50IGVycjsK
IAl1MzIgY3IxOwotCWJvb2wgZW5hYmxlOwotCi0JZXJyID0ga3N0cnRvYm9vbChidWYsICZlbmFi
bGUpOwotCWlmIChlcnIpCi0JCXJldHVybiBlcnI7CiAKIAlpZiAoZW5hYmxlKSB7CiAJCXJlZ21h
cF9yZWFkKHByaXYtPnJlZ21hcCwgVElNX0NSMSwgJmNyMSk7CkBAIC0yNDIsNzAgKzIyOCw1NSBA
QCBzdGF0aWMgc3NpemVfdCBzdG0zMl9jb3VudF9lbmFibGVfd3JpdGUoc3RydWN0IGNvdW50ZXJf
ZGV2aWNlICpjb3VudGVyLAogCS8qIEtlZXAgZW5hYmxlZCBzdGF0ZSB0byBwcm9wZXJseSBoYW5k
bGUgbG93IHBvd2VyIHN0YXRlcyAqLwogCXByaXYtPmVuYWJsZWQgPSBlbmFibGU7CiAKLQlyZXR1
cm4gbGVuOworCXJldHVybiAwOwogfQogCi1zdGF0aWMgY29uc3Qgc3RydWN0IGNvdW50ZXJfY291
bnRfZXh0IHN0bTMyX2NvdW50X2V4dFtdID0gewotCXsKLQkJLm5hbWUgPSAiZGlyZWN0aW9uIiwK
LQkJLnJlYWQgPSBzdG0zMl9jb3VudF9kaXJlY3Rpb25fcmVhZCwKLQl9LAotCXsKLQkJLm5hbWUg
PSAiZW5hYmxlIiwKLQkJLnJlYWQgPSBzdG0zMl9jb3VudF9lbmFibGVfcmVhZCwKLQkJLndyaXRl
ID0gc3RtMzJfY291bnRfZW5hYmxlX3dyaXRlCi0JfSwKLQl7Ci0JCS5uYW1lID0gImNlaWxpbmci
LAotCQkucmVhZCA9IHN0bTMyX2NvdW50X2NlaWxpbmdfcmVhZCwKLQkJLndyaXRlID0gc3RtMzJf
Y291bnRfY2VpbGluZ193cml0ZQotCX0sCi19OwotCi1lbnVtIHN0bTMyX3N5bmFwc2VfYWN0aW9u
IHsKLQlTVE0zMl9TWU5BUFNFX0FDVElPTl9OT05FLAotCVNUTTMyX1NZTkFQU0VfQUNUSU9OX0JP
VEhfRURHRVMKK3N0YXRpYyBzdHJ1Y3QgY291bnRlcl9jb21wIHN0bTMyX2NvdW50X2V4dFtdID0g
eworCUNPVU5URVJfQ09NUF9ESVJFQ1RJT04oc3RtMzJfY291bnRfZGlyZWN0aW9uX3JlYWQpLAor
CUNPVU5URVJfQ09NUF9FTkFCTEUoc3RtMzJfY291bnRfZW5hYmxlX3JlYWQsIHN0bTMyX2NvdW50
X2VuYWJsZV93cml0ZSksCisJQ09VTlRFUl9DT01QX0NFSUxJTkcoc3RtMzJfY291bnRfY2VpbGlu
Z19yZWFkLAorCQkJICAgICBzdG0zMl9jb3VudF9jZWlsaW5nX3dyaXRlKSwKIH07CiAKIHN0YXRp
YyBjb25zdCBlbnVtIGNvdW50ZXJfc3luYXBzZV9hY3Rpb24gc3RtMzJfc3luYXBzZV9hY3Rpb25z
W10gPSB7Ci0JW1NUTTMyX1NZTkFQU0VfQUNUSU9OX05PTkVdID0gQ09VTlRFUl9TWU5BUFNFX0FD
VElPTl9OT05FLAotCVtTVE0zMl9TWU5BUFNFX0FDVElPTl9CT1RIX0VER0VTXSA9IENPVU5URVJf
U1lOQVBTRV9BQ1RJT05fQk9USF9FREdFUworCUNPVU5URVJfU1lOQVBTRV9BQ1RJT05fTk9ORSwK
KwlDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX0JPVEhfRURHRVMKIH07CiAKLXN0YXRpYyBpbnQgc3Rt
MzJfYWN0aW9uX2dldChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkgICAgc3Ry
dWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkJICAgIHN0cnVjdCBjb3VudGVyX3N5bmFwc2Ug
KnN5bmFwc2UsCi0JCQkgICAgc2l6ZV90ICphY3Rpb24pCitzdGF0aWMgaW50IHN0bTMyX2FjdGlv
bl9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCSAgICAgc3RydWN0IGNv
dW50ZXJfY291bnQgKmNvdW50LAorCQkJICAgICBzdHJ1Y3QgY291bnRlcl9zeW5hcHNlICpzeW5h
cHNlLAorCQkJICAgICBlbnVtIGNvdW50ZXJfc3luYXBzZV9hY3Rpb24gKmFjdGlvbikKIHsKLQlz
aXplX3QgZnVuY3Rpb247CisJZW51bSBjb3VudGVyX2Z1bmN0aW9uIGZ1bmN0aW9uOwogCWludCBl
cnI7CiAKLQllcnIgPSBzdG0zMl9jb3VudF9mdW5jdGlvbl9nZXQoY291bnRlciwgY291bnQsICZm
dW5jdGlvbik7CisJZXJyID0gc3RtMzJfY291bnRfZnVuY3Rpb25fcmVhZChjb3VudGVyLCBjb3Vu
dCwgJmZ1bmN0aW9uKTsKIAlpZiAoZXJyKQogCQlyZXR1cm4gZXJyOwogCiAJc3dpdGNoIChmdW5j
dGlvbikgewogCWNhc2UgU1RNMzJfQ09VTlRfU0xBVkVfTU9ERV9ESVNBQkxFRDoKIAkJLyogY291
bnRzIG9uIGludGVybmFsIGNsb2NrIHdoZW4gQ0VOPTEgKi8KLQkJKmFjdGlvbiA9IFNUTTMyX1NZ
TkFQU0VfQUNUSU9OX05PTkU7CisJCSphY3Rpb24gPSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX05P
TkU7CiAJCXJldHVybiAwOwogCWNhc2UgU1RNMzJfQ09VTlRfRU5DT0RFUl9NT0RFXzE6CiAJCS8q
IGNvdW50cyB1cC9kb3duIG9uIFRJMUZQMSBlZGdlIGRlcGVuZGluZyBvbiBUSTJGUDIgbGV2ZWwg
Ki8KIAkJaWYgKHN5bmFwc2UtPnNpZ25hbC0+aWQgPT0gY291bnQtPnN5bmFwc2VzWzBdLnNpZ25h
bC0+aWQpCi0JCQkqYWN0aW9uID0gU1RNMzJfU1lOQVBTRV9BQ1RJT05fQk9USF9FREdFUzsKKwkJ
CSphY3Rpb24gPSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX0JPVEhfRURHRVM7CiAJCWVsc2UKLQkJ
CSphY3Rpb24gPSBTVE0zMl9TWU5BUFNFX0FDVElPTl9OT05FOworCQkJKmFjdGlvbiA9IENPVU5U
RVJfU1lOQVBTRV9BQ1RJT05fTk9ORTsKIAkJcmV0dXJuIDA7CiAJY2FzZSBTVE0zMl9DT1VOVF9F
TkNPREVSX01PREVfMjoKIAkJLyogY291bnRzIHVwL2Rvd24gb24gVEkyRlAyIGVkZ2UgZGVwZW5k
aW5nIG9uIFRJMUZQMSBsZXZlbCAqLwogCQlpZiAoc3luYXBzZS0+c2lnbmFsLT5pZCA9PSBjb3Vu
dC0+c3luYXBzZXNbMV0uc2lnbmFsLT5pZCkKLQkJCSphY3Rpb24gPSBTVE0zMl9TWU5BUFNFX0FD
VElPTl9CT1RIX0VER0VTOworCQkJKmFjdGlvbiA9IENPVU5URVJfU1lOQVBTRV9BQ1RJT05fQk9U
SF9FREdFUzsKIAkJZWxzZQotCQkJKmFjdGlvbiA9IFNUTTMyX1NZTkFQU0VfQUNUSU9OX05PTkU7
CisJCQkqYWN0aW9uID0gQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9OT05FOwogCQlyZXR1cm4gMDsK
IAljYXNlIFNUTTMyX0NPVU5UX0VOQ09ERVJfTU9ERV8zOgogCQkvKiBjb3VudHMgdXAvZG93biBv
biBib3RoIFRJMUZQMSBhbmQgVEkyRlAyIGVkZ2VzICovCi0JCSphY3Rpb24gPSBTVE0zMl9TWU5B
UFNFX0FDVElPTl9CT1RIX0VER0VTOworCQkqYWN0aW9uID0gQ09VTlRFUl9TWU5BUFNFX0FDVElP
Tl9CT1RIX0VER0VTOwogCQlyZXR1cm4gMDsKIAlkZWZhdWx0OgogCQlyZXR1cm4gLUVJTlZBTDsK
QEAgLTMxNSw5ICsyODYsOSBAQCBzdGF0aWMgaW50IHN0bTMyX2FjdGlvbl9nZXQoc3RydWN0IGNv
dW50ZXJfZGV2aWNlICpjb3VudGVyLAogc3RhdGljIGNvbnN0IHN0cnVjdCBjb3VudGVyX29wcyBz
dG0zMl90aW1lcl9jbnRfb3BzID0gewogCS5jb3VudF9yZWFkID0gc3RtMzJfY291bnRfcmVhZCwK
IAkuY291bnRfd3JpdGUgPSBzdG0zMl9jb3VudF93cml0ZSwKLQkuZnVuY3Rpb25fZ2V0ID0gc3Rt
MzJfY291bnRfZnVuY3Rpb25fZ2V0LAotCS5mdW5jdGlvbl9zZXQgPSBzdG0zMl9jb3VudF9mdW5j
dGlvbl9zZXQsCi0JLmFjdGlvbl9nZXQgPSBzdG0zMl9hY3Rpb25fZ2V0LAorCS5mdW5jdGlvbl9y
ZWFkID0gc3RtMzJfY291bnRfZnVuY3Rpb25fcmVhZCwKKwkuZnVuY3Rpb25fd3JpdGUgPSBzdG0z
Ml9jb3VudF9mdW5jdGlvbl93cml0ZSwKKwkuYWN0aW9uX3JlYWQgPSBzdG0zMl9hY3Rpb25fcmVh
ZCwKIH07CiAKIHN0YXRpYyBzdHJ1Y3QgY291bnRlcl9zaWduYWwgc3RtMzJfc2lnbmFsc1tdID0g
ewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9jb3VudGVyL3RpLWVxZXAuYyBiL2RyaXZlcnMvY291bnRl
ci90aS1lcWVwLmMKaW5kZXggOTRmZTU4YmIzZWFiLi4wOTgxN2M5NTNmOWEgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvY291bnRlci90aS1lcWVwLmMKKysrIGIvZHJpdmVycy9jb3VudGVyL3RpLWVxZXAu
YwpAQCAtMTMsNiArMTMsNyBAQAogI2luY2x1ZGUgPGxpbnV4L3BsYXRmb3JtX2RldmljZS5oPgog
I2luY2x1ZGUgPGxpbnV4L3BtX3J1bnRpbWUuaD4KICNpbmNsdWRlIDxsaW51eC9yZWdtYXAuaD4K
KyNpbmNsdWRlIDxsaW51eC90eXBlcy5oPgogCiAvKiAzMi1iaXQgcmVnaXN0ZXJzICovCiAjZGVm
aW5lIFFQT1NDTlQJCTB4MApAQCAtNzMsMTkgKzc0LDEzIEBAIGVudW0gewogfTsKIAogLyogUG9z
aXRpb24gQ291bnRlciBJbnB1dCBNb2RlcyAqLwotZW51bSB7CitlbnVtIHRpX2VxZXBfY291bnRf
ZnVuYyB7CiAJVElfRVFFUF9DT1VOVF9GVU5DX1FVQURfQ09VTlQsCiAJVElfRVFFUF9DT1VOVF9G
VU5DX0RJUl9DT1VOVCwKIAlUSV9FUUVQX0NPVU5UX0ZVTkNfVVBfQ09VTlQsCiAJVElfRVFFUF9D
T1VOVF9GVU5DX0RPV05fQ09VTlQsCiB9OwogCi1lbnVtIHsKLQlUSV9FUUVQX1NZTkFQU0VfQUNU
SU9OX0JPVEhfRURHRVMsCi0JVElfRVFFUF9TWU5BUFNFX0FDVElPTl9SSVNJTkdfRURHRSwKLQlU
SV9FUUVQX1NZTkFQU0VfQUNUSU9OX05PTkUsCi19OwotCiBzdHJ1Y3QgdGlfZXFlcF9jbnQgewog
CXN0cnVjdCBjb3VudGVyX2RldmljZSBjb3VudGVyOwogCXN0cnVjdCByZWdtYXAgKnJlZ21hcDMy
OwpAQCAtOTMsNyArODgsNyBAQCBzdHJ1Y3QgdGlfZXFlcF9jbnQgewogfTsKIAogc3RhdGljIGlu
dCB0aV9lcWVwX2NvdW50X3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJ
ICAgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB1bnNpZ25lZCBsb25nICp2YWwpCisJ
CQkgICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHU2NCAqdmFsKQogewogCXN0cnVj
dCB0aV9lcWVwX2NudCAqcHJpdiA9IGNvdW50ZXItPnByaXY7CiAJdTMyIGNudDsKQEAgLTEwNSw3
ICsxMDAsNyBAQCBzdGF0aWMgaW50IHRpX2VxZXBfY291bnRfcmVhZChzdHJ1Y3QgY291bnRlcl9k
ZXZpY2UgKmNvdW50ZXIsCiB9CiAKIHN0YXRpYyBpbnQgdGlfZXFlcF9jb3VudF93cml0ZShzdHJ1
Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkgICAgICAgc3RydWN0IGNvdW50ZXJfY291
bnQgKmNvdW50LCB1bnNpZ25lZCBsb25nIHZhbCkKKwkJCSAgICAgICBzdHJ1Y3QgY291bnRlcl9j
b3VudCAqY291bnQsIHU2NCB2YWwpCiB7CiAJc3RydWN0IHRpX2VxZXBfY250ICpwcml2ID0gY291
bnRlci0+cHJpdjsKIAl1MzIgbWF4OwpAQCAtMTE3LDY0ICsxMTIsMTAwIEBAIHN0YXRpYyBpbnQg
dGlfZXFlcF9jb3VudF93cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAJcmV0
dXJuIHJlZ21hcF93cml0ZShwcml2LT5yZWdtYXAzMiwgUVBPU0NOVCwgdmFsKTsKIH0KIAotc3Rh
dGljIGludCB0aV9lcWVwX2Z1bmN0aW9uX2dldChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50
ZXIsCi0JCQkJc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCBzaXplX3QgKmZ1bmN0aW9uKQor
c3RhdGljIGludCB0aV9lcWVwX2Z1bmN0aW9uX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpj
b3VudGVyLAorCQkJCSBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCisJCQkJIGVudW0gY291
bnRlcl9mdW5jdGlvbiAqZnVuY3Rpb24pCiB7CiAJc3RydWN0IHRpX2VxZXBfY250ICpwcml2ID0g
Y291bnRlci0+cHJpdjsKIAl1MzIgcWRlY2N0bDsKIAogCXJlZ21hcF9yZWFkKHByaXYtPnJlZ21h
cDE2LCBRREVDQ1RMLCAmcWRlY2N0bCk7Ci0JKmZ1bmN0aW9uID0gKHFkZWNjdGwgJiBRREVDQ1RM
X1FTUkMpID4+IFFERUNDVExfUVNSQ19TSElGVDsKKworCXN3aXRjaCAoKHFkZWNjdGwgJiBRREVD
Q1RMX1FTUkMpID4+IFFERUNDVExfUVNSQ19TSElGVCkgeworCWNhc2UgVElfRVFFUF9DT1VOVF9G
VU5DX1FVQURfQ09VTlQ6CisJCSpmdW5jdGlvbiA9IENPVU5URVJfRlVOQ1RJT05fUVVBRFJBVFVS
RV9YNDsKKwkJYnJlYWs7CisJY2FzZSBUSV9FUUVQX0NPVU5UX0ZVTkNfRElSX0NPVU5UOgorCQkq
ZnVuY3Rpb24gPSBDT1VOVEVSX0ZVTkNUSU9OX1BVTFNFX0RJUkVDVElPTjsKKwkJYnJlYWs7CisJ
Y2FzZSBUSV9FUUVQX0NPVU5UX0ZVTkNfVVBfQ09VTlQ6CisJCSpmdW5jdGlvbiA9IENPVU5URVJf
RlVOQ1RJT05fSU5DUkVBU0U7CisJCWJyZWFrOworCWNhc2UgVElfRVFFUF9DT1VOVF9GVU5DX0RP
V05fQ09VTlQ6CisJCSpmdW5jdGlvbiA9IENPVU5URVJfRlVOQ1RJT05fREVDUkVBU0U7CisJCWJy
ZWFrOworCX0KIAogCXJldHVybiAwOwogfQogCi1zdGF0aWMgaW50IHRpX2VxZXBfZnVuY3Rpb25f
c2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQlzdHJ1Y3QgY291bnRlcl9j
b3VudCAqY291bnQsIHNpemVfdCBmdW5jdGlvbikKK3N0YXRpYyBpbnQgdGlfZXFlcF9mdW5jdGlv
bl93cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJICBzdHJ1Y3QgY291
bnRlcl9jb3VudCAqY291bnQsCisJCQkJICBlbnVtIGNvdW50ZXJfZnVuY3Rpb24gZnVuY3Rpb24p
CiB7CiAJc3RydWN0IHRpX2VxZXBfY250ICpwcml2ID0gY291bnRlci0+cHJpdjsKKwllbnVtIHRp
X2VxZXBfY291bnRfZnVuYyBxc3JjOworCisJc3dpdGNoIChmdW5jdGlvbikgeworCWNhc2UgQ09V
TlRFUl9GVU5DVElPTl9RVUFEUkFUVVJFX1g0OgorCQlxc3JjID0gVElfRVFFUF9DT1VOVF9GVU5D
X1FVQURfQ09VTlQ7CisJCWJyZWFrOworCWNhc2UgQ09VTlRFUl9GVU5DVElPTl9QVUxTRV9ESVJF
Q1RJT046CisJCXFzcmMgPSBUSV9FUUVQX0NPVU5UX0ZVTkNfRElSX0NPVU5UOworCQlicmVhazsK
KwljYXNlIENPVU5URVJfRlVOQ1RJT05fSU5DUkVBU0U6CisJCXFzcmMgPSBUSV9FUUVQX0NPVU5U
X0ZVTkNfVVBfQ09VTlQ7CisJCWJyZWFrOworCWNhc2UgQ09VTlRFUl9GVU5DVElPTl9ERUNSRUFT
RToKKwkJcXNyYyA9IFRJX0VRRVBfQ09VTlRfRlVOQ19ET1dOX0NPVU5UOworCQlicmVhazsKKwlk
ZWZhdWx0OgorCQkvKiBzaG91bGQgbmV2ZXIgcmVhY2ggdGhpcyBwYXRoICovCisJCXJldHVybiAt
RUlOVkFMOworCX0KIAogCXJldHVybiByZWdtYXBfd3JpdGVfYml0cyhwcml2LT5yZWdtYXAxNiwg
UURFQ0NUTCwgUURFQ0NUTF9RU1JDLAotCQkJCSBmdW5jdGlvbiA8PCBRREVDQ1RMX1FTUkNfU0hJ
RlQpOworCQkJCSBxc3JjIDw8IFFERUNDVExfUVNSQ19TSElGVCk7CiB9CiAKLXN0YXRpYyBpbnQg
dGlfZXFlcF9hY3Rpb25fZ2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCSAg
ICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKLQkJCSAgICAgIHN0cnVjdCBjb3VudGVy
X3N5bmFwc2UgKnN5bmFwc2UsIHNpemVfdCAqYWN0aW9uKQorc3RhdGljIGludCB0aV9lcWVwX2Fj
dGlvbl9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCSAgICAgICBzdHJ1
Y3QgY291bnRlcl9jb3VudCAqY291bnQsCisJCQkgICAgICAgc3RydWN0IGNvdW50ZXJfc3luYXBz
ZSAqc3luYXBzZSwKKwkJCSAgICAgICBlbnVtIGNvdW50ZXJfc3luYXBzZV9hY3Rpb24gKmFjdGlv
bikKIHsKIAlzdHJ1Y3QgdGlfZXFlcF9jbnQgKnByaXYgPSBjb3VudGVyLT5wcml2OwotCXNpemVf
dCBmdW5jdGlvbjsKKwllbnVtIGNvdW50ZXJfZnVuY3Rpb24gZnVuY3Rpb247CiAJdTMyIHFkZWNj
dGw7CiAJaW50IGVycjsKIAotCWVyciA9IHRpX2VxZXBfZnVuY3Rpb25fZ2V0KGNvdW50ZXIsIGNv
dW50LCAmZnVuY3Rpb24pOworCWVyciA9IHRpX2VxZXBfZnVuY3Rpb25fcmVhZChjb3VudGVyLCBj
b3VudCwgJmZ1bmN0aW9uKTsKIAlpZiAoZXJyKQogCQlyZXR1cm4gZXJyOwogCiAJc3dpdGNoIChm
dW5jdGlvbikgewotCWNhc2UgVElfRVFFUF9DT1VOVF9GVU5DX1FVQURfQ09VTlQ6CisJY2FzZSBD
T1VOVEVSX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDQ6CiAJCS8qIEluIHF1YWRyYXR1cmUgbW9kZSwg
dGhlIHJpc2luZyBhbmQgZmFsbGluZyBlZGdlIG9mIGJvdGgKIAkJICogUUVQQSBhbmQgUUVQQiB0
cmlnZ2VyIFFDTEsuCiAJCSAqLwotCQkqYWN0aW9uID0gVElfRVFFUF9TWU5BUFNFX0FDVElPTl9C
T1RIX0VER0VTOworCQkqYWN0aW9uID0gQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9CT1RIX0VER0VT
OwogCQlyZXR1cm4gMDsKLQljYXNlIFRJX0VRRVBfQ09VTlRfRlVOQ19ESVJfQ09VTlQ6CisJY2Fz
ZSBDT1VOVEVSX0ZVTkNUSU9OX1BVTFNFX0RJUkVDVElPTjoKIAkJLyogSW4gZGlyZWN0aW9uLWNv
dW50IG1vZGUgb25seSByaXNpbmcgZWRnZSBvZiBRRVBBIGlzIGNvdW50ZWQKIAkJICogYW5kIFFF
UEIgZ2l2ZXMgZGlyZWN0aW9uLgogCQkgKi8KIAkJc3dpdGNoIChzeW5hcHNlLT5zaWduYWwtPmlk
KSB7CiAJCWNhc2UgVElfRVFFUF9TSUdOQUxfUUVQQToKLQkJCSphY3Rpb24gPSBUSV9FUUVQX1NZ
TkFQU0VfQUNUSU9OX1JJU0lOR19FREdFOworCQkJKmFjdGlvbiA9IENPVU5URVJfU1lOQVBTRV9B
Q1RJT05fUklTSU5HX0VER0U7CiAJCQlyZXR1cm4gMDsKIAkJY2FzZSBUSV9FUUVQX1NJR05BTF9R
RVBCOgotCQkJKmFjdGlvbiA9IFRJX0VRRVBfU1lOQVBTRV9BQ1RJT05fTk9ORTsKKwkJCSphY3Rp
b24gPSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX05PTkU7CiAJCQlyZXR1cm4gMDsKIAkJZGVmYXVs
dDoKIAkJCS8qIHNob3VsZCBuZXZlciByZWFjaCB0aGlzIHBhdGggKi8KIAkJCXJldHVybiAtRUlO
VkFMOwogCQl9Ci0JY2FzZSBUSV9FUUVQX0NPVU5UX0ZVTkNfVVBfQ09VTlQ6Ci0JY2FzZSBUSV9F
UUVQX0NPVU5UX0ZVTkNfRE9XTl9DT1VOVDoKKwljYXNlIENPVU5URVJfRlVOQ1RJT05fSU5DUkVB
U0U6CisJY2FzZSBDT1VOVEVSX0ZVTkNUSU9OX0RFQ1JFQVNFOgogCQkvKiBJbiB1cC9kb3duLWNv
dW50IG1vZGVzIG9ubHkgUUVQQSBpcyBjb3VudGVkIGFuZCBRRVBCIGlzIG5vdAogCQkgKiB1c2Vk
LgogCQkgKi8KQEAgLTE4NSwxMiArMjE2LDEyIEBAIHN0YXRpYyBpbnQgdGlfZXFlcF9hY3Rpb25f
Z2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKIAkJCQlyZXR1cm4gZXJyOwogCiAJ
CQlpZiAocWRlY2N0bCAmIFFERUNDVExfWENSKQotCQkJCSphY3Rpb24gPSBUSV9FUUVQX1NZTkFQ
U0VfQUNUSU9OX0JPVEhfRURHRVM7CisJCQkJKmFjdGlvbiA9IENPVU5URVJfU1lOQVBTRV9BQ1RJ
T05fQk9USF9FREdFUzsKIAkJCWVsc2UKLQkJCQkqYWN0aW9uID0gVElfRVFFUF9TWU5BUFNFX0FD
VElPTl9SSVNJTkdfRURHRTsKKwkJCQkqYWN0aW9uID0gQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9S
SVNJTkdfRURHRTsKIAkJCXJldHVybiAwOwogCQljYXNlIFRJX0VRRVBfU0lHTkFMX1FFUEI6Ci0J
CQkqYWN0aW9uID0gVElfRVFFUF9TWU5BUFNFX0FDVElPTl9OT05FOworCQkJKmFjdGlvbiA9IENP
VU5URVJfU1lOQVBTRV9BQ1RJT05fTk9ORTsKIAkJCXJldHVybiAwOwogCQlkZWZhdWx0OgogCQkJ
Lyogc2hvdWxkIG5ldmVyIHJlYWNoIHRoaXMgcGF0aCAqLwpAQCAtMjA1LDgyICsyMzYsNjcgQEAg
c3RhdGljIGludCB0aV9lcWVwX2FjdGlvbl9nZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3Vu
dGVyLAogc3RhdGljIGNvbnN0IHN0cnVjdCBjb3VudGVyX29wcyB0aV9lcWVwX2NvdW50ZXJfb3Bz
ID0gewogCS5jb3VudF9yZWFkCT0gdGlfZXFlcF9jb3VudF9yZWFkLAogCS5jb3VudF93cml0ZQk9
IHRpX2VxZXBfY291bnRfd3JpdGUsCi0JLmZ1bmN0aW9uX2dldAk9IHRpX2VxZXBfZnVuY3Rpb25f
Z2V0LAotCS5mdW5jdGlvbl9zZXQJPSB0aV9lcWVwX2Z1bmN0aW9uX3NldCwKLQkuYWN0aW9uX2dl
dAk9IHRpX2VxZXBfYWN0aW9uX2dldCwKKwkuZnVuY3Rpb25fcmVhZAk9IHRpX2VxZXBfZnVuY3Rp
b25fcmVhZCwKKwkuZnVuY3Rpb25fd3JpdGUJPSB0aV9lcWVwX2Z1bmN0aW9uX3dyaXRlLAorCS5h
Y3Rpb25fcmVhZAk9IHRpX2VxZXBfYWN0aW9uX3JlYWQsCiB9OwogCi1zdGF0aWMgc3NpemVfdCB0
aV9lcWVwX3Bvc2l0aW9uX2NlaWxpbmdfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50
ZXIsCi0JCQkJCSAgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkJCQkgICAgIHZv
aWQgKmV4dF9wcml2LCBjaGFyICpidWYpCitzdGF0aWMgaW50IHRpX2VxZXBfcG9zaXRpb25fY2Vp
bGluZ19yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkJIHN0cnVjdCBj
b3VudGVyX2NvdW50ICpjb3VudCwKKwkJCQkJIHU2NCAqY2VpbGluZykKIHsKIAlzdHJ1Y3QgdGlf
ZXFlcF9jbnQgKnByaXYgPSBjb3VudGVyLT5wcml2OwogCXUzMiBxcG9zbWF4OwogCiAJcmVnbWFw
X3JlYWQocHJpdi0+cmVnbWFwMzIsIFFQT1NNQVgsICZxcG9zbWF4KTsKIAotCXJldHVybiBzcHJp
bnRmKGJ1ZiwgIiV1XG4iLCBxcG9zbWF4KTsKKwkqY2VpbGluZyA9IHFwb3NtYXg7CisKKwlyZXR1
cm4gMDsKIH0KIAotc3RhdGljIHNzaXplX3QgdGlfZXFlcF9wb3NpdGlvbl9jZWlsaW5nX3dyaXRl
KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQkJICAgICAgc3RydWN0IGNvdW50
ZXJfY291bnQgKmNvdW50LAotCQkJCQkgICAgICB2b2lkICpleHRfcHJpdiwgY29uc3QgY2hhciAq
YnVmLAotCQkJCQkgICAgICBzaXplX3QgbGVuKQorc3RhdGljIGludCB0aV9lcWVwX3Bvc2l0aW9u
X2NlaWxpbmdfd3JpdGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCQkgIHN0
cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKKwkJCQkJICB1NjQgY2VpbGluZykKIHsKIAlzdHJ1
Y3QgdGlfZXFlcF9jbnQgKnByaXYgPSBjb3VudGVyLT5wcml2OwotCWludCBlcnI7Ci0JdTMyIHJl
czsKIAotCWVyciA9IGtzdHJ0b3VpbnQoYnVmLCAwLCAmcmVzKTsKLQlpZiAoZXJyIDwgMCkKLQkJ
cmV0dXJuIGVycjsKKwlpZiAoY2VpbGluZyAhPSAodTMyKWNlaWxpbmcpCisJCXJldHVybiAtRVJB
TkdFOwogCi0JcmVnbWFwX3dyaXRlKHByaXYtPnJlZ21hcDMyLCBRUE9TTUFYLCByZXMpOworCXJl
Z21hcF93cml0ZShwcml2LT5yZWdtYXAzMiwgUVBPU01BWCwgY2VpbGluZyk7CiAKLQlyZXR1cm4g
bGVuOworCXJldHVybiAwOwogfQogCi1zdGF0aWMgc3NpemVfdCB0aV9lcWVwX3Bvc2l0aW9uX2Vu
YWJsZV9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQkJICAgIHN0cnVj
dCBjb3VudGVyX2NvdW50ICpjb3VudCwKLQkJCQkJICAgIHZvaWQgKmV4dF9wcml2LCBjaGFyICpi
dWYpCitzdGF0aWMgaW50IHRpX2VxZXBfcG9zaXRpb25fZW5hYmxlX3JlYWQoc3RydWN0IGNvdW50
ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCQlzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHU4
ICplbmFibGUpCiB7CiAJc3RydWN0IHRpX2VxZXBfY250ICpwcml2ID0gY291bnRlci0+cHJpdjsK
IAl1MzIgcWVwY3RsOwogCiAJcmVnbWFwX3JlYWQocHJpdi0+cmVnbWFwMTYsIFFFUENUTCwgJnFl
cGN0bCk7CiAKLQlyZXR1cm4gc3ByaW50ZihidWYsICIldVxuIiwgISEocWVwY3RsICYgUUVQQ1RM
X1BIRU4pKTsKKwkqZW5hYmxlID0gISEocWVwY3RsICYgUUVQQ1RMX1BIRU4pOworCisJcmV0dXJu
IDA7CiB9CiAKLXN0YXRpYyBzc2l6ZV90IHRpX2VxZXBfcG9zaXRpb25fZW5hYmxlX3dyaXRlKHN0
cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQkJICAgICBzdHJ1Y3QgY291bnRlcl9j
b3VudCAqY291bnQsCi0JCQkJCSAgICAgdm9pZCAqZXh0X3ByaXYsIGNvbnN0IGNoYXIgKmJ1ZiwK
LQkJCQkJICAgICBzaXplX3QgbGVuKQorc3RhdGljIGludCB0aV9lcWVwX3Bvc2l0aW9uX2VuYWJs
ZV93cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJCSBzdHJ1Y3QgY291
bnRlcl9jb3VudCAqY291bnQsIHU4IGVuYWJsZSkKIHsKIAlzdHJ1Y3QgdGlfZXFlcF9jbnQgKnBy
aXYgPSBjb3VudGVyLT5wcml2OwotCWludCBlcnI7Ci0JYm9vbCByZXM7Ci0KLQllcnIgPSBrc3Ry
dG9ib29sKGJ1ZiwgJnJlcyk7Ci0JaWYgKGVyciA8IDApCi0JCXJldHVybiBlcnI7CiAKLQlyZWdt
YXBfd3JpdGVfYml0cyhwcml2LT5yZWdtYXAxNiwgUUVQQ1RMLCBRRVBDVExfUEhFTiwgcmVzID8g
LTEgOiAwKTsKKwlyZWdtYXBfd3JpdGVfYml0cyhwcml2LT5yZWdtYXAxNiwgUUVQQ1RMLCBRRVBD
VExfUEhFTiwgZW5hYmxlID8gLTEgOiAwKTsKIAotCXJldHVybiBsZW47CisJcmV0dXJuIDA7CiB9
CiAKLXN0YXRpYyBzdHJ1Y3QgY291bnRlcl9jb3VudF9leHQgdGlfZXFlcF9wb3NpdGlvbl9leHRb
XSA9IHsKLQl7Ci0JCS5uYW1lCT0gImNlaWxpbmciLAotCQkucmVhZAk9IHRpX2VxZXBfcG9zaXRp
b25fY2VpbGluZ19yZWFkLAotCQkud3JpdGUJPSB0aV9lcWVwX3Bvc2l0aW9uX2NlaWxpbmdfd3Jp
dGUsCi0JfSwKLQl7Ci0JCS5uYW1lCT0gImVuYWJsZSIsCi0JCS5yZWFkCT0gdGlfZXFlcF9wb3Np
dGlvbl9lbmFibGVfcmVhZCwKLQkJLndyaXRlCT0gdGlfZXFlcF9wb3NpdGlvbl9lbmFibGVfd3Jp
dGUsCi0JfSwKK3N0YXRpYyBzdHJ1Y3QgY291bnRlcl9jb21wIHRpX2VxZXBfcG9zaXRpb25fZXh0
W10gPSB7CisJQ09VTlRFUl9DT01QX0NFSUxJTkcodGlfZXFlcF9wb3NpdGlvbl9jZWlsaW5nX3Jl
YWQsCisJCQkgICAgIHRpX2VxZXBfcG9zaXRpb25fY2VpbGluZ193cml0ZSksCisJQ09VTlRFUl9D
T01QX0VOQUJMRSh0aV9lcWVwX3Bvc2l0aW9uX2VuYWJsZV9yZWFkLAorCQkJICAgIHRpX2VxZXBf
cG9zaXRpb25fZW5hYmxlX3dyaXRlKSwKIH07CiAKIHN0YXRpYyBzdHJ1Y3QgY291bnRlcl9zaWdu
YWwgdGlfZXFlcF9zaWduYWxzW10gPSB7CkBAIC0yOTUsMTYgKzMxMSwxNiBAQCBzdGF0aWMgc3Ry
dWN0IGNvdW50ZXJfc2lnbmFsIHRpX2VxZXBfc2lnbmFsc1tdID0gewogfTsKIAogc3RhdGljIGNv
bnN0IGVudW0gY291bnRlcl9mdW5jdGlvbiB0aV9lcWVwX3Bvc2l0aW9uX2Z1bmN0aW9uc1tdID0g
ewotCVtUSV9FUUVQX0NPVU5UX0ZVTkNfUVVBRF9DT1VOVF0JPSBDT1VOVEVSX0ZVTkNUSU9OX1FV
QURSQVRVUkVfWDQsCi0JW1RJX0VRRVBfQ09VTlRfRlVOQ19ESVJfQ09VTlRdCT0gQ09VTlRFUl9G
VU5DVElPTl9QVUxTRV9ESVJFQ1RJT04sCi0JW1RJX0VRRVBfQ09VTlRfRlVOQ19VUF9DT1VOVF0J
PSBDT1VOVEVSX0ZVTkNUSU9OX0lOQ1JFQVNFLAotCVtUSV9FUUVQX0NPVU5UX0ZVTkNfRE9XTl9D
T1VOVF0JPSBDT1VOVEVSX0ZVTkNUSU9OX0RFQ1JFQVNFLAorCUNPVU5URVJfRlVOQ1RJT05fUVVB
RFJBVFVSRV9YNCwKKwlDT1VOVEVSX0ZVTkNUSU9OX1BVTFNFX0RJUkVDVElPTiwKKwlDT1VOVEVS
X0ZVTkNUSU9OX0lOQ1JFQVNFLAorCUNPVU5URVJfRlVOQ1RJT05fREVDUkVBU0UsCiB9OwogCiBz
dGF0aWMgY29uc3QgZW51bSBjb3VudGVyX3N5bmFwc2VfYWN0aW9uIHRpX2VxZXBfcG9zaXRpb25f
c3luYXBzZV9hY3Rpb25zW10gPSB7Ci0JW1RJX0VRRVBfU1lOQVBTRV9BQ1RJT05fQk9USF9FREdF
U10JPSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX0JPVEhfRURHRVMsCi0JW1RJX0VRRVBfU1lOQVBT
RV9BQ1RJT05fUklTSU5HX0VER0VdCT0gQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9SSVNJTkdfRURH
RSwKLQlbVElfRVFFUF9TWU5BUFNFX0FDVElPTl9OT05FXQkJPSBDT1VOVEVSX1NZTkFQU0VfQUNU
SU9OX05PTkUsCisJQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9CT1RIX0VER0VTLAorCUNPVU5URVJf
U1lOQVBTRV9BQ1RJT05fUklTSU5HX0VER0UsCisJQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9OT05F
LAogfTsKIAogc3RhdGljIHN0cnVjdCBjb3VudGVyX3N5bmFwc2UgdGlfZXFlcF9wb3NpdGlvbl9z
eW5hcHNlc1tdID0gewpkaWZmIC0tZ2l0IGEvaW5jbHVkZS9saW51eC9jb3VudGVyLmggYi9pbmNs
dWRlL2xpbnV4L2NvdW50ZXIuaAppbmRleCBkMTZjZTI4MTliNDguLmI2OTI3N2Y1YzRjNSAxMDA2
NDQKLS0tIGEvaW5jbHVkZS9saW51eC9jb3VudGVyLmgKKysrIGIvaW5jbHVkZS9saW51eC9jb3Vu
dGVyLmgKQEAgLTYsNDIgKzYsMTg0IEBACiAjaWZuZGVmIF9DT1VOVEVSX0hfCiAjZGVmaW5lIF9D
T1VOVEVSX0hfCiAKLSNpbmNsdWRlIDxsaW51eC9jb3VudGVyX2VudW0uaD4KICNpbmNsdWRlIDxs
aW51eC9kZXZpY2UuaD4KKyNpbmNsdWRlIDxsaW51eC9rZXJuZWwuaD4KICNpbmNsdWRlIDxsaW51
eC90eXBlcy5oPgogCitzdHJ1Y3QgY291bnRlcl9kZXZpY2U7CitzdHJ1Y3QgY291bnRlcl9jb3Vu
dDsKK3N0cnVjdCBjb3VudGVyX3N5bmFwc2U7CitzdHJ1Y3QgY291bnRlcl9zaWduYWw7CisKK2Vu
dW0gY291bnRlcl9jb21wX3R5cGUgeworCUNPVU5URVJfQ09NUF9VOCwKKwlDT1VOVEVSX0NPTVBf
VTY0LAorCUNPVU5URVJfQ09NUF9CT09MLAorCUNPVU5URVJfQ09NUF9TSUdOQUxfTEVWRUwsCisJ
Q09VTlRFUl9DT01QX0ZVTkNUSU9OLAorCUNPVU5URVJfQ09NUF9TWU5BUFNFX0FDVElPTiwKKwlD
T1VOVEVSX0NPTVBfRU5VTSwKKwlDT1VOVEVSX0NPTVBfQ09VTlRfRElSRUNUSU9OLAorCUNPVU5U
RVJfQ09NUF9DT1VOVF9NT0RFLAorfTsKKworZW51bSBjb3VudGVyX3Njb3BlIHsKKwlDT1VOVEVS
X1NDT1BFX0RFVklDRSwKKwlDT1VOVEVSX1NDT1BFX1NJR05BTCwKKwlDT1VOVEVSX1NDT1BFX0NP
VU5ULAorfTsKKwogZW51bSBjb3VudGVyX2NvdW50X2RpcmVjdGlvbiB7Ci0JQ09VTlRFUl9DT1VO
VF9ESVJFQ1RJT05fRk9SV0FSRCA9IDAsCi0JQ09VTlRFUl9DT1VOVF9ESVJFQ1RJT05fQkFDS1dB
UkQKKwlDT1VOVEVSX0NPVU5UX0RJUkVDVElPTl9GT1JXQVJELAorCUNPVU5URVJfQ09VTlRfRElS
RUNUSU9OX0JBQ0tXQVJELAogfTsKLWV4dGVybiBjb25zdCBjaGFyICpjb25zdCBjb3VudGVyX2Nv
dW50X2RpcmVjdGlvbl9zdHJbMl07CiAKIGVudW0gY291bnRlcl9jb3VudF9tb2RlIHsKLQlDT1VO
VEVSX0NPVU5UX01PREVfTk9STUFMID0gMCwKKwlDT1VOVEVSX0NPVU5UX01PREVfTk9STUFMLAog
CUNPVU5URVJfQ09VTlRfTU9ERV9SQU5HRV9MSU1JVCwKIAlDT1VOVEVSX0NPVU5UX01PREVfTk9O
X1JFQ1lDTEUsCi0JQ09VTlRFUl9DT1VOVF9NT0RFX01PRFVMT19OCisJQ09VTlRFUl9DT1VOVF9N
T0RFX01PRFVMT19OLAogfTsKLWV4dGVybiBjb25zdCBjaGFyICpjb25zdCBjb3VudGVyX2NvdW50
X21vZGVfc3RyWzRdOwogCi1zdHJ1Y3QgY291bnRlcl9kZXZpY2U7Ci1zdHJ1Y3QgY291bnRlcl9z
aWduYWw7CitlbnVtIGNvdW50ZXJfZnVuY3Rpb24geworCUNPVU5URVJfRlVOQ1RJT05fSU5DUkVB
U0UsCisJQ09VTlRFUl9GVU5DVElPTl9ERUNSRUFTRSwKKwlDT1VOVEVSX0ZVTkNUSU9OX1BVTFNF
X0RJUkVDVElPTiwKKwlDT1VOVEVSX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDFfQSwKKwlDT1VOVEVS
X0ZVTkNUSU9OX1FVQURSQVRVUkVfWDFfQiwKKwlDT1VOVEVSX0ZVTkNUSU9OX1FVQURSQVRVUkVf
WDJfQSwKKwlDT1VOVEVSX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDJfQiwKKwlDT1VOVEVSX0ZVTkNU
SU9OX1FVQURSQVRVUkVfWDQsCit9OworCitlbnVtIGNvdW50ZXJfc2lnbmFsX2xldmVsIHsKKwlD
T1VOVEVSX1NJR05BTF9MRVZFTF9MT1csCisJQ09VTlRFUl9TSUdOQUxfTEVWRUxfSElHSCwKK307
CisKK2VudW0gY291bnRlcl9zeW5hcHNlX2FjdGlvbiB7CisJQ09VTlRFUl9TWU5BUFNFX0FDVElP
Tl9OT05FLAorCUNPVU5URVJfU1lOQVBTRV9BQ1RJT05fUklTSU5HX0VER0UsCisJQ09VTlRFUl9T
WU5BUFNFX0FDVElPTl9GQUxMSU5HX0VER0UsCisJQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9CT1RI
X0VER0VTLAorfTsKIAogLyoqCi0gKiBzdHJ1Y3QgY291bnRlcl9zaWduYWxfZXh0IC0gQ291bnRl
ciBTaWduYWwgZXh0ZW5zaW9ucwotICogQG5hbWU6CWF0dHJpYnV0ZSBuYW1lCi0gKiBAcmVhZDoJ
cmVhZCBjYWxsYmFjayBmb3IgdGhpcyBhdHRyaWJ1dGU7IG1heSBiZSBOVUxMCi0gKiBAd3JpdGU6
CXdyaXRlIGNhbGxiYWNrIGZvciB0aGlzIGF0dHJpYnV0ZTsgbWF5IGJlIE5VTEwKLSAqIEBwcml2
OglkYXRhIHByaXZhdGUgdG8gdGhlIGRyaXZlcgorICogc3RydWN0IGNvdW50ZXJfY29tcCAtIENv
dW50ZXIgY29tcG9uZW50IG5vZGUKKyAqIEB0eXBlOgkJQ291bnRlciBjb21wb25lbnQgZGF0YSB0
eXBlCisgKiBAbmFtZToJCWRldmljZS1zcGVjaWZpYyBjb21wb25lbnQgbmFtZQorICogQHByaXY6
CQljb21wb25lbnQtcmVsZXZhbnQgZGF0YQorICogQGFjdGlvbl9yZWFkCQlTeW5hcHNlIGFjdGlv
biBtb2RlIHJlYWQgY2FsbGJhY2suIFRoZSByZWFkIHZhbHVlIG9mIHRoZQorICoJCQlyZXNwZWN0
aXZlIFN5bmFwc2UgYWN0aW9uIG1vZGUgc2hvdWxkIGJlIHBhc3NlZCBiYWNrIHZpYQorICoJCQl0
aGUgYWN0aW9uIHBhcmFtZXRlci4KKyAqIEBkZXZpY2VfdThfcmVhZAlEZXZpY2UgdTggY29tcG9u
ZW50IHJlYWQgY2FsbGJhY2suIFRoZSByZWFkIHZhbHVlIG9mIHRoZQorICoJCQlyZXNwZWN0aXZl
IERldmljZSB1OCBjb21wb25lbnQgc2hvdWxkIGJlIHBhc3NlZCBiYWNrIHZpYQorICoJCQl0aGUg
dmFsIHBhcmFtZXRlci4KKyAqIEBjb3VudF91OF9yZWFkCUNvdW50IHU4IGNvbXBvbmVudCByZWFk
IGNhbGxiYWNrLiBUaGUgcmVhZCB2YWx1ZSBvZiB0aGUKKyAqCQkJcmVzcGVjdGl2ZSBDb3VudCB1
OCBjb21wb25lbnQgc2hvdWxkIGJlIHBhc3NlZCBiYWNrIHZpYQorICoJCQl0aGUgdmFsIHBhcmFt
ZXRlci4KKyAqIEBzaWduYWxfdThfcmVhZAlTaWduYWwgdTggY29tcG9uZW50IHJlYWQgY2FsbGJh
Y2suIFRoZSByZWFkIHZhbHVlIG9mIHRoZQorICoJCQlyZXNwZWN0aXZlIFNpZ25hbCB1OCBjb21w
b25lbnQgc2hvdWxkIGJlIHBhc3NlZCBiYWNrIHZpYQorICoJCQl0aGUgdmFsIHBhcmFtZXRlci4K
KyAqIEBkZXZpY2VfdTMyX3JlYWQJRGV2aWNlIHUzMiBjb21wb25lbnQgcmVhZCBjYWxsYmFjay4g
VGhlIHJlYWQgdmFsdWUgb2YKKyAqCQkJdGhlIHJlc3BlY3RpdmUgRGV2aWNlIHUzMiBjb21wb25l
bnQgc2hvdWxkIGJlIHBhc3NlZAorICoJCQliYWNrIHZpYSB0aGUgdmFsIHBhcmFtZXRlci4KKyAq
IEBjb3VudF91MzJfcmVhZAlDb3VudCB1MzIgY29tcG9uZW50IHJlYWQgY2FsbGJhY2suIFRoZSBy
ZWFkIHZhbHVlIG9mIHRoZQorICoJCQlyZXNwZWN0aXZlIENvdW50IHUzMiBjb21wb25lbnQgc2hv
dWxkIGJlIHBhc3NlZCBiYWNrIHZpYQorICoJCQl0aGUgdmFsIHBhcmFtZXRlci4KKyAqIEBzaWdu
YWxfdTMyX3JlYWQJU2lnbmFsIHUzMiBjb21wb25lbnQgcmVhZCBjYWxsYmFjay4gVGhlIHJlYWQg
dmFsdWUgb2YKKyAqCQkJdGhlIHJlc3BlY3RpdmUgU2lnbmFsIHUzMiBjb21wb25lbnQgc2hvdWxk
IGJlIHBhc3NlZAorICoJCQliYWNrIHZpYSB0aGUgdmFsIHBhcmFtZXRlci4KKyAqIEBkZXZpY2Vf
dTY0X3JlYWQJRGV2aWNlIHU2NCBjb21wb25lbnQgcmVhZCBjYWxsYmFjay4gVGhlIHJlYWQgdmFs
dWUgb2YKKyAqCQkJdGhlIHJlc3BlY3RpdmUgRGV2aWNlIHU2NCBjb21wb25lbnQgc2hvdWxkIGJl
IHBhc3NlZAorICoJCQliYWNrIHZpYSB0aGUgdmFsIHBhcmFtZXRlci4KKyAqIEBjb3VudF91NjRf
cmVhZAlDb3VudCB1NjQgY29tcG9uZW50IHJlYWQgY2FsbGJhY2suIFRoZSByZWFkIHZhbHVlIG9m
IHRoZQorICoJCQlyZXNwZWN0aXZlIENvdW50IHU2NCBjb21wb25lbnQgc2hvdWxkIGJlIHBhc3Nl
ZCBiYWNrIHZpYQorICoJCQl0aGUgdmFsIHBhcmFtZXRlci4KKyAqIEBzaWduYWxfdTY0X3JlYWQJ
U2lnbmFsIHU2NCBjb21wb25lbnQgcmVhZCBjYWxsYmFjay4gVGhlIHJlYWQgdmFsdWUgb2YKKyAq
CQkJdGhlIHJlc3BlY3RpdmUgU2lnbmFsIHU2NCBjb21wb25lbnQgc2hvdWxkIGJlIHBhc3NlZAor
ICoJCQliYWNrIHZpYSB0aGUgdmFsIHBhcmFtZXRlci4KKyAqIEBhY3Rpb25fd3JpdGUJU3luYXBz
ZSBhY3Rpb24gbW9kZSB3cml0ZSBjYWxsYmFjay4gVGhlIHdyaXRlIHZhbHVlIG9mCisgKgkJCXRo
ZSByZXNwZWN0aXZlIFN5bmFwc2UgYWN0aW9uIG1vZGUgaXMgcGFzc2VkIHZpYSB0aGUKKyAqCQkJ
YWN0aW9uIHBhcmFtZXRlci4KKyAqIEBkZXZpY2VfdThfd3JpdGUJRGV2aWNlIHU4IGNvbXBvbmVu
dCB3cml0ZSBjYWxsYmFjay4gVGhlIHdyaXRlIHZhbHVlIG9mCisgKgkJCXRoZSByZXNwZWN0aXZl
IERldmljZSB1OCBjb21wb25lbnQgaXMgcGFzc2VkIHZpYSB0aGUgdmFsCisgKgkJCXBhcmFtZXRl
ci4KKyAqIEBjb3VudF91OF93cml0ZQlDb3VudCB1OCBjb21wb25lbnQgd3JpdGUgY2FsbGJhY2su
IFRoZSB3cml0ZSB2YWx1ZSBvZgorICoJCQl0aGUgcmVzcGVjdGl2ZSBDb3VudCB1OCBjb21wb25l
bnQgaXMgcGFzc2VkIHZpYSB0aGUgdmFsCisgKgkJCXBhcmFtZXRlci4KKyAqIEBzaWduYWxfdThf
d3JpdGUJU2lnbmFsIHU4IGNvbXBvbmVudCB3cml0ZSBjYWxsYmFjay4gVGhlIHdyaXRlIHZhbHVl
IG9mCisgKgkJCXRoZSByZXNwZWN0aXZlIFNpZ25hbCB1OCBjb21wb25lbnQgaXMgcGFzc2VkIHZp
YSB0aGUgdmFsCisgKgkJCXBhcmFtZXRlci4KKyAqIEBkZXZpY2VfdTMyX3dyaXRlCURldmljZSB1
MzIgY29tcG9uZW50IHdyaXRlIGNhbGxiYWNrLiBUaGUgd3JpdGUgdmFsdWUgb2YKKyAqCQkJdGhl
IHJlc3BlY3RpdmUgRGV2aWNlIHUzMiBjb21wb25lbnQgaXMgcGFzc2VkIHZpYSB0aGUKKyAqCQkJ
dmFsIHBhcmFtZXRlci4KKyAqIEBjb3VudF91MzJfd3JpdGUJQ291bnQgdTMyIGNvbXBvbmVudCB3
cml0ZSBjYWxsYmFjay4gVGhlIHdyaXRlIHZhbHVlIG9mCisgKgkJCXRoZSByZXNwZWN0aXZlIENv
dW50IHUzMiBjb21wb25lbnQgaXMgcGFzc2VkIHZpYSB0aGUgdmFsCisgKgkJCXBhcmFtZXRlci4K
KyAqIEBzaWduYWxfdTMyX3dyaXRlCVNpZ25hbCB1MzIgY29tcG9uZW50IHdyaXRlIGNhbGxiYWNr
LiBUaGUgd3JpdGUgdmFsdWUgb2YKKyAqCQkJdGhlIHJlc3BlY3RpdmUgU2lnbmFsIHUzMiBjb21w
b25lbnQgaXMgcGFzc2VkIHZpYSB0aGUKKyAqCQkJdmFsIHBhcmFtZXRlci4KKyAqIEBkZXZpY2Vf
dTY0X3dyaXRlCURldmljZSB1NjQgY29tcG9uZW50IHdyaXRlIGNhbGxiYWNrLiBUaGUgd3JpdGUg
dmFsdWUgb2YKKyAqCQkJdGhlIHJlc3BlY3RpdmUgRGV2aWNlIHU2NCBjb21wb25lbnQgaXMgcGFz
c2VkIHZpYSB0aGUKKyAqCQkJdmFsIHBhcmFtZXRlci4KKyAqIEBjb3VudF91NjRfd3JpdGUJQ291
bnQgdTY0IGNvbXBvbmVudCB3cml0ZSBjYWxsYmFjay4gVGhlIHdyaXRlIHZhbHVlIG9mCisgKgkJ
CXRoZSByZXNwZWN0aXZlIENvdW50IHU2NCBjb21wb25lbnQgaXMgcGFzc2VkIHZpYSB0aGUgdmFs
CisgKgkJCXBhcmFtZXRlci4KKyAqIEBzaWduYWxfdTY0X3dyaXRlCVNpZ25hbCB1NjQgY29tcG9u
ZW50IHdyaXRlIGNhbGxiYWNrLiBUaGUgd3JpdGUgdmFsdWUgb2YKKyAqCQkJdGhlIHJlc3BlY3Rp
dmUgU2lnbmFsIHU2NCBjb21wb25lbnQgaXMgcGFzc2VkIHZpYSB0aGUKKyAqCQkJdmFsIHBhcmFt
ZXRlci4KICAqLwotc3RydWN0IGNvdW50ZXJfc2lnbmFsX2V4dCB7CitzdHJ1Y3QgY291bnRlcl9j
b21wIHsKKwllbnVtIGNvdW50ZXJfY29tcF90eXBlIHR5cGU7CiAJY29uc3QgY2hhciAqbmFtZTsK
LQlzc2l6ZV90ICgqcmVhZCkoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJc3Ry
dWN0IGNvdW50ZXJfc2lnbmFsICpzaWduYWwsIHZvaWQgKnByaXYsIGNoYXIgKmJ1Zik7Ci0Jc3Np
emVfdCAoKndyaXRlKShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkgc3RydWN0
IGNvdW50ZXJfc2lnbmFsICpzaWduYWwsIHZvaWQgKnByaXYsCi0JCQkgY29uc3QgY2hhciAqYnVm
LCBzaXplX3QgbGVuKTsKIAl2b2lkICpwcml2OworCXVuaW9uIHsKKwkJaW50ICgqYWN0aW9uX3Jl
YWQpKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkgICBzdHJ1Y3QgY291bnRl
cl9jb3VudCAqY291bnQsCisJCQkJICAgc3RydWN0IGNvdW50ZXJfc3luYXBzZSAqc3luYXBzZSwK
KwkJCQkgICBlbnVtIGNvdW50ZXJfc3luYXBzZV9hY3Rpb24gKmFjdGlvbik7CisJCWludCAoKmRl
dmljZV91OF9yZWFkKShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsIHU4ICp2YWwpOwor
CQlpbnQgKCpjb3VudF91OF9yZWFkKShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJ
CQkJICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHU4ICp2YWwpOworCQlpbnQgKCpz
aWduYWxfdThfcmVhZCkoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCSAgICAg
IHN0cnVjdCBjb3VudGVyX3NpZ25hbCAqc2lnbmFsLCB1OCAqdmFsKTsKKwkJaW50ICgqZGV2aWNl
X3UzMl9yZWFkKShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJICAgICAgIHUz
MiAqdmFsKTsKKwkJaW50ICgqY291bnRfdTMyX3JlYWQpKHN0cnVjdCBjb3VudGVyX2RldmljZSAq
Y291bnRlciwKKwkJCQkgICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHUzMiAqdmFs
KTsKKwkJaW50ICgqc2lnbmFsX3UzMl9yZWFkKShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50
ZXIsCisJCQkJICAgICAgIHN0cnVjdCBjb3VudGVyX3NpZ25hbCAqc2lnbmFsLCB1MzIgKnZhbCk7
CisJCWludCAoKmRldmljZV91NjRfcmVhZCkoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVy
LAorCQkJCSAgICAgICB1NjQgKnZhbCk7CisJCWludCAoKmNvdW50X3U2NF9yZWFkKShzdHJ1Y3Qg
Y291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJICAgICAgc3RydWN0IGNvdW50ZXJfY291bnQg
KmNvdW50LCB1NjQgKnZhbCk7CisJCWludCAoKnNpZ25hbF91NjRfcmVhZCkoc3RydWN0IGNvdW50
ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCSAgICAgICBzdHJ1Y3QgY291bnRlcl9zaWduYWwgKnNp
Z25hbCwgdTY0ICp2YWwpOworCX07CisJdW5pb24geworCQlpbnQgKCphY3Rpb25fd3JpdGUpKHN0
cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkgICAgc3RydWN0IGNvdW50ZXJfY291
bnQgKmNvdW50LAorCQkJCSAgICBzdHJ1Y3QgY291bnRlcl9zeW5hcHNlICpzeW5hcHNlLAorCQkJ
CSAgICBlbnVtIGNvdW50ZXJfc3luYXBzZV9hY3Rpb24gYWN0aW9uKTsKKwkJaW50ICgqZGV2aWNl
X3U4X3dyaXRlKShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsIHU4IHZhbCk7CisJCWlu
dCAoKmNvdW50X3U4X3dyaXRlKShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJ
ICAgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB1OCB2YWwpOworCQlpbnQgKCpzaWdu
YWxfdThfd3JpdGUpKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkgICAgICAg
c3RydWN0IGNvdW50ZXJfc2lnbmFsICpzaWduYWwsIHU4IHZhbCk7CisJCWludCAoKmRldmljZV91
MzJfd3JpdGUpKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkJdTMyIHZhbCk7
CisJCWludCAoKmNvdW50X3UzMl93cml0ZSkoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVy
LAorCQkJCSAgICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHUzMiB2YWwpOworCQlp
bnQgKCpzaWduYWxfdTMyX3dyaXRlKShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJ
CQkJCXN0cnVjdCBjb3VudGVyX3NpZ25hbCAqc2lnbmFsLCB1MzIgdmFsKTsKKwkJaW50ICgqZGV2
aWNlX3U2NF93cml0ZSkoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCQl1NjQg
dmFsKTsKKwkJaW50ICgqY291bnRfdTY0X3dyaXRlKShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNv
dW50ZXIsCisJCQkJICAgICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgdTY0IHZhbCk7
CisJCWludCAoKnNpZ25hbF91NjRfd3JpdGUpKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRl
ciwKKwkJCQkJc3RydWN0IGNvdW50ZXJfc2lnbmFsICpzaWduYWwsIHU2NCB2YWwpOworCX07CiB9
OwogCiAvKioKQEAgLTUxLDI0OCArMTkzLDUyIEBAIHN0cnVjdCBjb3VudGVyX3NpZ25hbF9leHQg
ewogICoJCWFzIGl0IGFwcGVhcnMgaW4gdGhlIGRhdGFzaGVldCBkb2N1bWVudGF0aW9uCiAgKiBA
ZXh0OglvcHRpb25hbCBhcnJheSBvZiBDb3VudGVyIFNpZ25hbCBleHRlbnNpb25zCiAgKiBAbnVt
X2V4dDoJbnVtYmVyIG9mIENvdW50ZXIgU2lnbmFsIGV4dGVuc2lvbnMgc3BlY2lmaWVkIGluIEBl
eHQKLSAqIEBwcml2OglvcHRpb25hbCBwcml2YXRlIGRhdGEgc3VwcGxpZWQgYnkgZHJpdmVyCiAg
Ki8KIHN0cnVjdCBjb3VudGVyX3NpZ25hbCB7CiAJaW50IGlkOwogCWNvbnN0IGNoYXIgKm5hbWU7
CiAKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9zaWduYWxfZXh0ICpleHQ7CisJc3RydWN0IGNvdW50
ZXJfY29tcCAqZXh0OwogCXNpemVfdCBudW1fZXh0OwotCi0Jdm9pZCAqcHJpdjsKLX07Ci0KLS8q
KgotICogc3RydWN0IGNvdW50ZXJfc2lnbmFsX2VudW1fZXh0IC0gU2lnbmFsIGVudW0gZXh0ZW5z
aW9uIGF0dHJpYnV0ZQotICogQGl0ZW1zOglBcnJheSBvZiBzdHJpbmdzCi0gKiBAbnVtX2l0ZW1z
OglOdW1iZXIgb2YgaXRlbXMgc3BlY2lmaWVkIGluIEBpdGVtcwotICogQHNldDoJU2V0IGNhbGxi
YWNrIGZ1bmN0aW9uOyBtYXkgYmUgTlVMTAotICogQGdldDoJR2V0IGNhbGxiYWNrIGZ1bmN0aW9u
OyBtYXkgYmUgTlVMTAotICoKLSAqIFRoZSBjb3VudGVyX3NpZ25hbF9lbnVtX2V4dCBzdHJ1Y3R1
cmUgY2FuIGJlIHVzZWQgdG8gaW1wbGVtZW50IGVudW0gc3R5bGUKLSAqIFNpZ25hbCBleHRlbnNp
b24gYXR0cmlidXRlcy4gRW51bSBzdHlsZSBhdHRyaWJ1dGVzIGFyZSB0aG9zZSB3aGljaCBoYXZl
IGEgc2V0Ci0gKiBvZiBzdHJpbmdzIHRoYXQgbWFwIHRvIHVuc2lnbmVkIGludGVnZXIgdmFsdWVz
LiBUaGUgR2VuZXJpYyBDb3VudGVyIFNpZ25hbAotICogZW51bSBleHRlbnNpb24gaGVscGVyIGNv
ZGUgdGFrZXMgY2FyZSBvZiBtYXBwaW5nIGJldHdlZW4gdmFsdWUgYW5kIHN0cmluZywgYXMKLSAq
IHdlbGwgYXMgZ2VuZXJhdGluZyBhICJfYXZhaWxhYmxlIiBmaWxlIHdoaWNoIGNvbnRhaW5zIGEg
bGlzdCBvZiBhbGwgYXZhaWxhYmxlCi0gKiBpdGVtcy4gVGhlIGdldCBjYWxsYmFjayBpcyB1c2Vk
IHRvIHF1ZXJ5IHRoZSBjdXJyZW50bHkgYWN0aXZlIGl0ZW07IHRoZSBpbmRleAotICogb2YgdGhl
IGl0ZW0gd2l0aGluIHRoZSByZXNwZWN0aXZlIGl0ZW1zIGFycmF5IGlzIHJldHVybmVkIHZpYSB0
aGUgJ2l0ZW0nCi0gKiBwYXJhbWV0ZXIuIFRoZSBzZXQgY2FsbGJhY2sgaXMgY2FsbGVkIHdoZW4g
dGhlIGF0dHJpYnV0ZSBpcyB1cGRhdGVkOyB0aGUKLSAqICdpdGVtJyBwYXJhbWV0ZXIgY29udGFp
bnMgdGhlIGluZGV4IG9mIHRoZSBuZXdseSBhY3RpdmF0ZWQgaXRlbSB3aXRoaW4gdGhlCi0gKiBy
ZXNwZWN0aXZlIGl0ZW1zIGFycmF5LgotICovCi1zdHJ1Y3QgY291bnRlcl9zaWduYWxfZW51bV9l
eHQgewotCWNvbnN0IGNoYXIgKiBjb25zdCAqaXRlbXM7Ci0Jc2l6ZV90IG51bV9pdGVtczsKLQlp
bnQgKCpnZXQpKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJICAgc3RydWN0IGNv
dW50ZXJfc2lnbmFsICpzaWduYWwsIHNpemVfdCAqaXRlbSk7Ci0JaW50ICgqc2V0KShzdHJ1Y3Qg
Y291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCSAgIHN0cnVjdCBjb3VudGVyX3NpZ25hbCAqc2ln
bmFsLCBzaXplX3QgaXRlbSk7Ci19OwotCi0vKioKLSAqIENPVU5URVJfU0lHTkFMX0VOVU0oKSAt
IEluaXRpYWxpemUgU2lnbmFsIGVudW0gZXh0ZW5zaW9uCi0gKiBAX25hbWU6CUF0dHJpYnV0ZSBu
YW1lCi0gKiBAX2U6CQlQb2ludGVyIHRvIGEgY291bnRlcl9zaWduYWxfZW51bV9leHQgc3RydWN0
dXJlCi0gKgotICogVGhpcyBzaG91bGQgdXN1YWxseSBiZSB1c2VkIHRvZ2V0aGVyIHdpdGggQ09V
TlRFUl9TSUdOQUxfRU5VTV9BVkFJTEFCTEUoKQotICovCi0jZGVmaW5lIENPVU5URVJfU0lHTkFM
X0VOVU0oX25hbWUsIF9lKSBcCi17IFwKLQkubmFtZSA9IChfbmFtZSksIFwKLQkucmVhZCA9IGNv
dW50ZXJfc2lnbmFsX2VudW1fcmVhZCwgXAotCS53cml0ZSA9IGNvdW50ZXJfc2lnbmFsX2VudW1f
d3JpdGUsIFwKLQkucHJpdiA9IChfZSkgXAotfQotCi0vKioKLSAqIENPVU5URVJfU0lHTkFMX0VO
VU1fQVZBSUxBQkxFKCkgLSBJbml0aWFsaXplIFNpZ25hbCBlbnVtIGF2YWlsYWJsZSBleHRlbnNp
b24KLSAqIEBfbmFtZToJQXR0cmlidXRlIG5hbWUgKCJfYXZhaWxhYmxlIiB3aWxsIGJlIGFwcGVu
ZGVkIHRvIHRoZSBuYW1lKQotICogQF9lOgkJUG9pbnRlciB0byBhIGNvdW50ZXJfc2lnbmFsX2Vu
dW1fZXh0IHN0cnVjdHVyZQotICoKLSAqIENyZWF0ZXMgYSByZWFkIG9ubHkgYXR0cmlidXRlIHRo
YXQgbGlzdHMgYWxsIHRoZSBhdmFpbGFibGUgZW51bSBpdGVtcyBpbiBhCi0gKiBuZXdsaW5lIHNl
cGFyYXRlZCBsaXN0LiBUaGlzIHNob3VsZCB1c3VhbGx5IGJlIHVzZWQgdG9nZXRoZXIgd2l0aAot
ICogQ09VTlRFUl9TSUdOQUxfRU5VTSgpCi0gKi8KLSNkZWZpbmUgQ09VTlRFUl9TSUdOQUxfRU5V
TV9BVkFJTEFCTEUoX25hbWUsIF9lKSBcCi17IFwKLQkubmFtZSA9IChfbmFtZSAiX2F2YWlsYWJs
ZSIpLCBcCi0JLnJlYWQgPSBjb3VudGVyX3NpZ25hbF9lbnVtX2F2YWlsYWJsZV9yZWFkLCBcCi0J
LnByaXYgPSAoX2UpIFwKLX0KLQotZW51bSBjb3VudGVyX3N5bmFwc2VfYWN0aW9uIHsKLQlDT1VO
VEVSX1NZTkFQU0VfQUNUSU9OX05PTkUgPSAwLAotCUNPVU5URVJfU1lOQVBTRV9BQ1RJT05fUklT
SU5HX0VER0UsCi0JQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9GQUxMSU5HX0VER0UsCi0JQ09VTlRF
Ul9TWU5BUFNFX0FDVElPTl9CT1RIX0VER0VTCiB9OwogCiAvKioKICAqIHN0cnVjdCBjb3VudGVy
X3N5bmFwc2UgLSBDb3VudGVyIFN5bmFwc2Ugbm9kZQotICogQGFjdGlvbjoJCWluZGV4IG9mIGN1
cnJlbnQgYWN0aW9uIG1vZGUKICAqIEBhY3Rpb25zX2xpc3Q6CWFycmF5IG9mIGF2YWlsYWJsZSBh
Y3Rpb24gbW9kZXMKICAqIEBudW1fYWN0aW9uczoJbnVtYmVyIG9mIGFjdGlvbiBtb2RlcyBzcGVj
aWZpZWQgaW4gQGFjdGlvbnNfbGlzdAogICogQHNpZ25hbDoJCXBvaW50ZXIgdG8gYXNzb2NpYXRl
ZCBzaWduYWwKICAqLwogc3RydWN0IGNvdW50ZXJfc3luYXBzZSB7Ci0Jc2l6ZV90IGFjdGlvbjsK
IAljb25zdCBlbnVtIGNvdW50ZXJfc3luYXBzZV9hY3Rpb24gKmFjdGlvbnNfbGlzdDsKIAlzaXpl
X3QgbnVtX2FjdGlvbnM7CiAKIAlzdHJ1Y3QgY291bnRlcl9zaWduYWwgKnNpZ25hbDsKIH07CiAK
LXN0cnVjdCBjb3VudGVyX2NvdW50OwotCi0vKioKLSAqIHN0cnVjdCBjb3VudGVyX2NvdW50X2V4
dCAtIENvdW50ZXIgQ291bnQgZXh0ZW5zaW9uCi0gKiBAbmFtZToJYXR0cmlidXRlIG5hbWUKLSAq
IEByZWFkOglyZWFkIGNhbGxiYWNrIGZvciB0aGlzIGF0dHJpYnV0ZTsgbWF5IGJlIE5VTEwKLSAq
IEB3cml0ZToJd3JpdGUgY2FsbGJhY2sgZm9yIHRoaXMgYXR0cmlidXRlOyBtYXkgYmUgTlVMTAot
ICogQHByaXY6CWRhdGEgcHJpdmF0ZSB0byB0aGUgZHJpdmVyCi0gKi8KLXN0cnVjdCBjb3VudGVy
X2NvdW50X2V4dCB7Ci0JY29uc3QgY2hhciAqbmFtZTsKLQlzc2l6ZV90ICgqcmVhZCkoc3RydWN0
IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50
LCB2b2lkICpwcml2LCBjaGFyICpidWYpOwotCXNzaXplX3QgKCp3cml0ZSkoc3RydWN0IGNvdW50
ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgdm9p
ZCAqcHJpdiwKLQkJCSBjb25zdCBjaGFyICpidWYsIHNpemVfdCBsZW4pOwotCXZvaWQgKnByaXY7
Ci19OwotCi1lbnVtIGNvdW50ZXJfZnVuY3Rpb24gewotCUNPVU5URVJfRlVOQ1RJT05fSU5DUkVB
U0UgPSAwLAotCUNPVU5URVJfRlVOQ1RJT05fREVDUkVBU0UsCi0JQ09VTlRFUl9GVU5DVElPTl9Q
VUxTRV9ESVJFQ1RJT04sCi0JQ09VTlRFUl9GVU5DVElPTl9RVUFEUkFUVVJFX1gxX0EsCi0JQ09V
TlRFUl9GVU5DVElPTl9RVUFEUkFUVVJFX1gxX0IsCi0JQ09VTlRFUl9GVU5DVElPTl9RVUFEUkFU
VVJFX1gyX0EsCi0JQ09VTlRFUl9GVU5DVElPTl9RVUFEUkFUVVJFX1gyX0IsCi0JQ09VTlRFUl9G
VU5DVElPTl9RVUFEUkFUVVJFX1g0Ci19OwotCiAvKioKICAqIHN0cnVjdCBjb3VudGVyX2NvdW50
IC0gQ291bnRlciBDb3VudCBub2RlCiAgKiBAaWQ6CQkJdW5pcXVlIElEIHVzZWQgdG8gaWRlbnRp
ZnkgQ291bnQKICAqIEBuYW1lOgkJZGV2aWNlLXNwZWNpZmljIENvdW50IG5hbWU7IGlkZWFsbHks
IHRoaXMgc2hvdWxkIG1hdGNoCiAgKgkJCXRoZSBuYW1lIGFzIGl0IGFwcGVhcnMgaW4gdGhlIGRh
dGFzaGVldCBkb2N1bWVudGF0aW9uCi0gKiBAZnVuY3Rpb246CQlpbmRleCBvZiBjdXJyZW50IGZ1
bmN0aW9uIG1vZGUKICAqIEBmdW5jdGlvbnNfbGlzdDoJYXJyYXkgYXZhaWxhYmxlIGZ1bmN0aW9u
IG1vZGVzCiAgKiBAbnVtX2Z1bmN0aW9uczoJbnVtYmVyIG9mIGZ1bmN0aW9uIG1vZGVzIHNwZWNp
ZmllZCBpbiBAZnVuY3Rpb25zX2xpc3QKICAqIEBzeW5hcHNlczoJCWFycmF5IG9mIHN5bmFwc2Vz
IGZvciBpbml0aWFsaXphdGlvbgogICogQG51bV9zeW5hcHNlczoJbnVtYmVyIG9mIHN5bmFwc2Vz
IHNwZWNpZmllZCBpbiBAc3luYXBzZXMKICAqIEBleHQ6CQlvcHRpb25hbCBhcnJheSBvZiBDb3Vu
dGVyIENvdW50IGV4dGVuc2lvbnMKICAqIEBudW1fZXh0OgkJbnVtYmVyIG9mIENvdW50ZXIgQ291
bnQgZXh0ZW5zaW9ucyBzcGVjaWZpZWQgaW4gQGV4dAotICogQHByaXY6CQlvcHRpb25hbCBwcml2
YXRlIGRhdGEgc3VwcGxpZWQgYnkgZHJpdmVyCiAgKi8KIHN0cnVjdCBjb3VudGVyX2NvdW50IHsK
IAlpbnQgaWQ7CiAJY29uc3QgY2hhciAqbmFtZTsKIAotCXNpemVfdCBmdW5jdGlvbjsKIAljb25z
dCBlbnVtIGNvdW50ZXJfZnVuY3Rpb24gKmZ1bmN0aW9uc19saXN0OwogCXNpemVfdCBudW1fZnVu
Y3Rpb25zOwogCiAJc3RydWN0IGNvdW50ZXJfc3luYXBzZSAqc3luYXBzZXM7CiAJc2l6ZV90IG51
bV9zeW5hcHNlczsKIAotCWNvbnN0IHN0cnVjdCBjb3VudGVyX2NvdW50X2V4dCAqZXh0OworCXN0
cnVjdCBjb3VudGVyX2NvbXAgKmV4dDsKIAlzaXplX3QgbnVtX2V4dDsKLQotCXZvaWQgKnByaXY7
Ci19OwotCi0vKioKLSAqIHN0cnVjdCBjb3VudGVyX2NvdW50X2VudW1fZXh0IC0gQ291bnQgZW51
bSBleHRlbnNpb24gYXR0cmlidXRlCi0gKiBAaXRlbXM6CUFycmF5IG9mIHN0cmluZ3MKLSAqIEBu
dW1faXRlbXM6CU51bWJlciBvZiBpdGVtcyBzcGVjaWZpZWQgaW4gQGl0ZW1zCi0gKiBAc2V0OglT
ZXQgY2FsbGJhY2sgZnVuY3Rpb247IG1heSBiZSBOVUxMCi0gKiBAZ2V0OglHZXQgY2FsbGJhY2sg
ZnVuY3Rpb247IG1heSBiZSBOVUxMCi0gKgotICogVGhlIGNvdW50ZXJfY291bnRfZW51bV9leHQg
c3RydWN0dXJlIGNhbiBiZSB1c2VkIHRvIGltcGxlbWVudCBlbnVtIHN0eWxlCi0gKiBDb3VudCBl
eHRlbnNpb24gYXR0cmlidXRlcy4gRW51bSBzdHlsZSBhdHRyaWJ1dGVzIGFyZSB0aG9zZSB3aGlj
aCBoYXZlIGEgc2V0Ci0gKiBvZiBzdHJpbmdzIHRoYXQgbWFwIHRvIHVuc2lnbmVkIGludGVnZXIg
dmFsdWVzLiBUaGUgR2VuZXJpYyBDb3VudGVyIENvdW50Ci0gKiBlbnVtIGV4dGVuc2lvbiBoZWxw
ZXIgY29kZSB0YWtlcyBjYXJlIG9mIG1hcHBpbmcgYmV0d2VlbiB2YWx1ZSBhbmQgc3RyaW5nLCBh
cwotICogd2VsbCBhcyBnZW5lcmF0aW5nIGEgIl9hdmFpbGFibGUiIGZpbGUgd2hpY2ggY29udGFp
bnMgYSBsaXN0IG9mIGFsbCBhdmFpbGFibGUKLSAqIGl0ZW1zLiBUaGUgZ2V0IGNhbGxiYWNrIGlz
IHVzZWQgdG8gcXVlcnkgdGhlIGN1cnJlbnRseSBhY3RpdmUgaXRlbTsgdGhlIGluZGV4Ci0gKiBv
ZiB0aGUgaXRlbSB3aXRoaW4gdGhlIHJlc3BlY3RpdmUgaXRlbXMgYXJyYXkgaXMgcmV0dXJuZWQg
dmlhIHRoZSAnaXRlbScKLSAqIHBhcmFtZXRlci4gVGhlIHNldCBjYWxsYmFjayBpcyBjYWxsZWQg
d2hlbiB0aGUgYXR0cmlidXRlIGlzIHVwZGF0ZWQ7IHRoZQotICogJ2l0ZW0nIHBhcmFtZXRlciBj
b250YWlucyB0aGUgaW5kZXggb2YgdGhlIG5ld2x5IGFjdGl2YXRlZCBpdGVtIHdpdGhpbiB0aGUK
LSAqIHJlc3BlY3RpdmUgaXRlbXMgYXJyYXkuCi0gKi8KLXN0cnVjdCBjb3VudGVyX2NvdW50X2Vu
dW1fZXh0IHsKLQljb25zdCBjaGFyICogY29uc3QgKml0ZW1zOwotCXNpemVfdCBudW1faXRlbXM7
Ci0JaW50ICgqZ2V0KShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsIHN0cnVjdCBjb3Vu
dGVyX2NvdW50ICpjb3VudCwKLQkJICAgc2l6ZV90ICppdGVtKTsKLQlpbnQgKCpzZXQpKHN0cnVj
dCBjb3VudGVyX2RldmljZSAqY291bnRlciwgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAot
CQkgICBzaXplX3QgaXRlbSk7Ci19OwotCi0vKioKLSAqIENPVU5URVJfQ09VTlRfRU5VTSgpIC0g
SW5pdGlhbGl6ZSBDb3VudCBlbnVtIGV4dGVuc2lvbgotICogQF9uYW1lOglBdHRyaWJ1dGUgbmFt
ZQotICogQF9lOgkJUG9pbnRlciB0byBhIGNvdW50ZXJfY291bnRfZW51bV9leHQgc3RydWN0dXJl
Ci0gKgotICogVGhpcyBzaG91bGQgdXN1YWxseSBiZSB1c2VkIHRvZ2V0aGVyIHdpdGggQ09VTlRF
Ul9DT1VOVF9FTlVNX0FWQUlMQUJMRSgpCi0gKi8KLSNkZWZpbmUgQ09VTlRFUl9DT1VOVF9FTlVN
KF9uYW1lLCBfZSkgXAoteyBcCi0JLm5hbWUgPSAoX25hbWUpLCBcCi0JLnJlYWQgPSBjb3VudGVy
X2NvdW50X2VudW1fcmVhZCwgXAotCS53cml0ZSA9IGNvdW50ZXJfY291bnRfZW51bV93cml0ZSwg
XAotCS5wcml2ID0gKF9lKSBcCi19Ci0KLS8qKgotICogQ09VTlRFUl9DT1VOVF9FTlVNX0FWQUlM
QUJMRSgpIC0gSW5pdGlhbGl6ZSBDb3VudCBlbnVtIGF2YWlsYWJsZSBleHRlbnNpb24KLSAqIEBf
bmFtZToJQXR0cmlidXRlIG5hbWUgKCJfYXZhaWxhYmxlIiB3aWxsIGJlIGFwcGVuZGVkIHRvIHRo
ZSBuYW1lKQotICogQF9lOgkJUG9pbnRlciB0byBhIGNvdW50ZXJfY291bnRfZW51bV9leHQgc3Ry
dWN0dXJlCi0gKgotICogQ3JlYXRlcyBhIHJlYWQgb25seSBhdHRyaWJ1dGUgdGhhdCBsaXN0cyBh
bGwgdGhlIGF2YWlsYWJsZSBlbnVtIGl0ZW1zIGluIGEKLSAqIG5ld2xpbmUgc2VwYXJhdGVkIGxp
c3QuIFRoaXMgc2hvdWxkIHVzdWFsbHkgYmUgdXNlZCB0b2dldGhlciB3aXRoCi0gKiBDT1VOVEVS
X0NPVU5UX0VOVU0oKQotICovCi0jZGVmaW5lIENPVU5URVJfQ09VTlRfRU5VTV9BVkFJTEFCTEUo
X25hbWUsIF9lKSBcCi17IFwKLQkubmFtZSA9IChfbmFtZSAiX2F2YWlsYWJsZSIpLCBcCi0JLnJl
YWQgPSBjb3VudGVyX2NvdW50X2VudW1fYXZhaWxhYmxlX3JlYWQsIFwKLQkucHJpdiA9IChfZSkg
XAotfQotCi0vKioKLSAqIHN0cnVjdCBjb3VudGVyX2RldmljZV9hdHRyX2dyb3VwIC0gaW50ZXJu
YWwgY29udGFpbmVyIGZvciBhdHRyaWJ1dGUgZ3JvdXAKLSAqIEBhdHRyX2dyb3VwOglDb3VudGVy
IHN5c2ZzIGF0dHJpYnV0ZXMgZ3JvdXAKLSAqIEBhdHRyX2xpc3Q6CWxpc3QgdG8ga2VlcCB0cmFj
ayBvZiBjcmVhdGVkIENvdW50ZXIgc3lzZnMgYXR0cmlidXRlcwotICogQG51bV9hdHRyOgludW1i
ZXIgb2YgQ291bnRlciBzeXNmcyBhdHRyaWJ1dGVzCi0gKi8KLXN0cnVjdCBjb3VudGVyX2Rldmlj
ZV9hdHRyX2dyb3VwIHsKLQlzdHJ1Y3QgYXR0cmlidXRlX2dyb3VwIGF0dHJfZ3JvdXA7Ci0Jc3Ry
dWN0IGxpc3RfaGVhZCBhdHRyX2xpc3Q7Ci0Jc2l6ZV90IG51bV9hdHRyOwotfTsKLQotLyoqCi0g
KiBzdHJ1Y3QgY291bnRlcl9kZXZpY2Vfc3RhdGUgLSBpbnRlcm5hbCBzdGF0ZSBjb250YWluZXIg
Zm9yIGEgQ291bnRlciBkZXZpY2UKLSAqIEBpZDoJCQl1bmlxdWUgSUQgdXNlZCB0byBpZGVudGlm
eSB0aGUgQ291bnRlcgotICogQGRldjoJCWludGVybmFsIGRldmljZSBzdHJ1Y3R1cmUKLSAqIEBn
cm91cHNfbGlzdDoJYXR0cmlidXRlIGdyb3VwcyBsaXN0IChmb3IgU2lnbmFscywgQ291bnRzLCBh
bmQgZXh0KQotICogQG51bV9ncm91cHM6CQludW1iZXIgb2YgYXR0cmlidXRlIGdyb3VwcyBjb250
YWluZXJzCi0gKiBAZ3JvdXBzOgkJQ291bnRlciBzeXNmcyBhdHRyaWJ1dGUgZ3JvdXBzICh0byBw
b3B1bGF0ZSBAZGV2Lmdyb3VwcykKLSAqLwotc3RydWN0IGNvdW50ZXJfZGV2aWNlX3N0YXRlIHsK
LQlpbnQgaWQ7Ci0Jc3RydWN0IGRldmljZSBkZXY7Ci0Jc3RydWN0IGNvdW50ZXJfZGV2aWNlX2F0
dHJfZ3JvdXAgKmdyb3Vwc19saXN0OwotCXNpemVfdCBudW1fZ3JvdXBzOwotCWNvbnN0IHN0cnVj
dCBhdHRyaWJ1dGVfZ3JvdXAgKipncm91cHM7Ci19OwotCi1lbnVtIGNvdW50ZXJfc2lnbmFsX2xl
dmVsIHsKLQlDT1VOVEVSX1NJR05BTF9MRVZFTF9MT1csCi0JQ09VTlRFUl9TSUdOQUxfTEVWRUxf
SElHSCwKIH07CiAKIC8qKgpAQCAtMzA2LDExNyArMjUyLDQ3IEBAIGVudW0gY291bnRlcl9zaWdu
YWxfbGV2ZWwgewogICogQGNvdW50X3dyaXRlOglvcHRpb25hbCB3cml0ZSBjYWxsYmFjayBmb3Ig
Q291bnQgYXR0cmlidXRlLiBUaGUgd3JpdGUKICAqCQkJdmFsdWUgZm9yIHRoZSByZXNwZWN0aXZl
IENvdW50IGlzIHBhc3NlZCBpbiB2aWEgdGhlIHZhbAogICoJCQlwYXJhbWV0ZXIuCi0gKiBAZnVu
Y3Rpb25fZ2V0OglmdW5jdGlvbiB0byBnZXQgdGhlIGN1cnJlbnQgY291bnQgZnVuY3Rpb24gbW9k
ZS4gUmV0dXJucwotICoJCQkwIG9uIHN1Y2Nlc3MgYW5kIG5lZ2F0aXZlIGVycm9yIGNvZGUgb24g
ZXJyb3IuIFRoZSBpbmRleAotICoJCQlvZiB0aGUgcmVzcGVjdGl2ZSBDb3VudCdzIHJldHVybmVk
IGZ1bmN0aW9uIG1vZGUgc2hvdWxkCi0gKgkJCWJlIHBhc3NlZCBiYWNrIHZpYSB0aGUgZnVuY3Rp
b24gcGFyYW1ldGVyLgotICogQGZ1bmN0aW9uX3NldDoJZnVuY3Rpb24gdG8gc2V0IHRoZSBjb3Vu
dCBmdW5jdGlvbiBtb2RlLiBmdW5jdGlvbiBpcyB0aGUKLSAqCQkJaW5kZXggb2YgdGhlIHJlcXVl
c3RlZCBmdW5jdGlvbiBtb2RlIGZyb20gdGhlIHJlc3BlY3RpdmUKLSAqCQkJQ291bnQncyBmdW5j
dGlvbnNfbGlzdCBhcnJheS4KLSAqIEBhY3Rpb25fZ2V0OgkJZnVuY3Rpb24gdG8gZ2V0IHRoZSBj
dXJyZW50IGFjdGlvbiBtb2RlLiBSZXR1cm5zIDAgb24KLSAqCQkJc3VjY2VzcyBhbmQgbmVnYXRp
dmUgZXJyb3IgY29kZSBvbiBlcnJvci4gVGhlIGluZGV4IG9mCi0gKgkJCXRoZSByZXNwZWN0aXZl
IFN5bmFwc2UncyByZXR1cm5lZCBhY3Rpb24gbW9kZSBzaG91bGQgYmUKLSAqCQkJcGFzc2VkIGJh
Y2sgdmlhIHRoZSBhY3Rpb24gcGFyYW1ldGVyLgotICogQGFjdGlvbl9zZXQ6CQlmdW5jdGlvbiB0
byBzZXQgdGhlIGFjdGlvbiBtb2RlLiBhY3Rpb24gaXMgdGhlIGluZGV4IG9mCi0gKgkJCXRoZSBy
ZXF1ZXN0ZWQgYWN0aW9uIG1vZGUgZnJvbSB0aGUgcmVzcGVjdGl2ZSBTeW5hcHNlJ3MKLSAqCQkJ
YWN0aW9uc19saXN0IGFycmF5LgorICogQGZ1bmN0aW9uX3JlYWQ6CXJlYWQgY2FsbGJhY2sgdGhl
IENvdW50IGZ1bmN0aW9uIG1vZGVzLiBUaGUgcmVhZAorICoJCQlmdW5jdGlvbiBtb2RlIG9mIHRo
ZSByZXNwZWN0aXZlIENvdW50IHNob3VsZCBiZSBwYXNzZWQKKyAqCQkJYmFjayB2aWEgdGhlIGZ1
bmN0aW9uIHBhcmFtZXRlci4KKyAqIEBmdW5jdGlvbl93cml0ZToJd3JpdGUgY2FsbGJhY2sgZm9y
IENvdW50IGZ1bmN0aW9uIG1vZGVzLiBUaGUgZnVuY3Rpb24KKyAqCQkJbW9kZSB0byB3cml0ZSBm
b3IgdGhlIHJlc3BlY3RpdmUgQ291bnQgaXMgcGFzc2VkIGluIHZpYQorICoJCQl0aGUgZnVuY3Rp
b24gcGFyYW1ldGVyLgorICogQGFjdGlvbl9yZWFkOglyZWFkIGNhbGxiYWNrIHRoZSBTeW5hcHNl
IGFjdGlvbiBtb2Rlcy4gVGhlIHJlYWQgYWN0aW9uCisgKgkJCW1vZGUgb2YgdGhlIHJlc3BlY3Rp
dmUgU3luYXBzZSBzaG91bGQgYmUgcGFzc2VkIGJhY2sgdmlhCisgKgkJCXRoZSBhY3Rpb24gcGFy
YW1ldGVyLgorICogQGFjdGlvbl93cml0ZToJd3JpdGUgY2FsbGJhY2sgZm9yIFN5bmFwc2UgYWN0
aW9uIG1vZGVzLiBUaGUgYWN0aW9uIG1vZGUKKyAqCQkJdG8gd3JpdGUgZm9yIHRoZSByZXNwZWN0
aXZlIFN5bmFwc2UgaXMgcGFzc2VkIGluIHZpYSB0aGUKKyAqCQkJYWN0aW9uIHBhcmFtZXRlci4K
ICAqLwogc3RydWN0IGNvdW50ZXJfb3BzIHsKIAlpbnQgKCpzaWduYWxfcmVhZCkoc3RydWN0IGNv
dW50ZXJfZGV2aWNlICpjb3VudGVyLAogCQkJICAgc3RydWN0IGNvdW50ZXJfc2lnbmFsICpzaWdu
YWwsCiAJCQkgICBlbnVtIGNvdW50ZXJfc2lnbmFsX2xldmVsICpsZXZlbCk7CiAJaW50ICgqY291
bnRfcmVhZCkoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJICBzdHJ1Y3QgY291
bnRlcl9jb3VudCAqY291bnQsIHVuc2lnbmVkIGxvbmcgKnZhbCk7CisJCQkgIHN0cnVjdCBjb3Vu
dGVyX2NvdW50ICpjb3VudCwgdTY0ICp2YWx1ZSk7CiAJaW50ICgqY291bnRfd3JpdGUpKHN0cnVj
dCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCSAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpj
b3VudCwgdW5zaWduZWQgbG9uZyB2YWwpOwotCWludCAoKmZ1bmN0aW9uX2dldCkoc3RydWN0IGNv
dW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3Vu
dCwgc2l6ZV90ICpmdW5jdGlvbik7Ci0JaW50ICgqZnVuY3Rpb25fc2V0KShzdHJ1Y3QgY291bnRl
cl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCBz
aXplX3QgZnVuY3Rpb24pOwotCWludCAoKmFjdGlvbl9nZXQpKHN0cnVjdCBjb3VudGVyX2Rldmlj
ZSAqY291bnRlciwKLQkJCSAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkJICBzdHJ1
Y3QgY291bnRlcl9zeW5hcHNlICpzeW5hcHNlLCBzaXplX3QgKmFjdGlvbik7Ci0JaW50ICgqYWN0
aW9uX3NldCkoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJICBzdHJ1Y3QgY291
bnRlcl9jb3VudCAqY291bnQsCi0JCQkgIHN0cnVjdCBjb3VudGVyX3N5bmFwc2UgKnN5bmFwc2Us
IHNpemVfdCBhY3Rpb24pOwotfTsKLQotLyoqCi0gKiBzdHJ1Y3QgY291bnRlcl9kZXZpY2VfZXh0
IC0gQ291bnRlciBkZXZpY2UgZXh0ZW5zaW9uCi0gKiBAbmFtZToJYXR0cmlidXRlIG5hbWUKLSAq
IEByZWFkOglyZWFkIGNhbGxiYWNrIGZvciB0aGlzIGF0dHJpYnV0ZTsgbWF5IGJlIE5VTEwKLSAq
IEB3cml0ZToJd3JpdGUgY2FsbGJhY2sgZm9yIHRoaXMgYXR0cmlidXRlOyBtYXkgYmUgTlVMTAot
ICogQHByaXY6CWRhdGEgcHJpdmF0ZSB0byB0aGUgZHJpdmVyCi0gKi8KLXN0cnVjdCBjb3VudGVy
X2RldmljZV9leHQgewotCWNvbnN0IGNoYXIgKm5hbWU7Ci0Jc3NpemVfdCAoKnJlYWQpKHN0cnVj
dCBjb3VudGVyX2RldmljZSAqY291bnRlciwgdm9pZCAqcHJpdiwgY2hhciAqYnVmKTsKLQlzc2l6
ZV90ICgqd3JpdGUpKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwgdm9pZCAqcHJpdiwK
LQkJCSBjb25zdCBjaGFyICpidWYsIHNpemVfdCBsZW4pOwotCXZvaWQgKnByaXY7CisJCQkgICBz
dHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHU2NCB2YWx1ZSk7CisJaW50ICgqZnVuY3Rpb25f
cmVhZCkoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJICAgICBzdHJ1Y3QgY291
bnRlcl9jb3VudCAqY291bnQsCisJCQkgICAgIGVudW0gY291bnRlcl9mdW5jdGlvbiAqZnVuY3Rp
b24pOworCWludCAoKmZ1bmN0aW9uX3dyaXRlKShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50
ZXIsCisJCQkgICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCisJCQkgICAgICBlbnVt
IGNvdW50ZXJfZnVuY3Rpb24gZnVuY3Rpb24pOworCWludCAoKmFjdGlvbl9yZWFkKShzdHJ1Y3Qg
Y291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291
bnQsCisJCQkgICBzdHJ1Y3QgY291bnRlcl9zeW5hcHNlICpzeW5hcHNlLAorCQkJICAgZW51bSBj
b3VudGVyX3N5bmFwc2VfYWN0aW9uICphY3Rpb24pOworCWludCAoKmFjdGlvbl93cml0ZSkoc3Ry
dWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJICAgIHN0cnVjdCBjb3VudGVyX2NvdW50
ICpjb3VudCwKKwkJCSAgICBzdHJ1Y3QgY291bnRlcl9zeW5hcHNlICpzeW5hcHNlLAorCQkJICAg
IGVudW0gY291bnRlcl9zeW5hcHNlX2FjdGlvbiBhY3Rpb24pOwogfTsKIAotLyoqCi0gKiBzdHJ1
Y3QgY291bnRlcl9kZXZpY2VfZW51bV9leHQgLSBDb3VudGVyIGVudW0gZXh0ZW5zaW9uIGF0dHJp
YnV0ZQotICogQGl0ZW1zOglBcnJheSBvZiBzdHJpbmdzCi0gKiBAbnVtX2l0ZW1zOglOdW1iZXIg
b2YgaXRlbXMgc3BlY2lmaWVkIGluIEBpdGVtcwotICogQHNldDoJU2V0IGNhbGxiYWNrIGZ1bmN0
aW9uOyBtYXkgYmUgTlVMTAotICogQGdldDoJR2V0IGNhbGxiYWNrIGZ1bmN0aW9uOyBtYXkgYmUg
TlVMTAotICoKLSAqIFRoZSBjb3VudGVyX2RldmljZV9lbnVtX2V4dCBzdHJ1Y3R1cmUgY2FuIGJl
IHVzZWQgdG8gaW1wbGVtZW50IGVudW0gc3R5bGUKLSAqIENvdW50ZXIgZXh0ZW5zaW9uIGF0dHJp
YnV0ZXMuIEVudW0gc3R5bGUgYXR0cmlidXRlcyBhcmUgdGhvc2Ugd2hpY2ggaGF2ZSBhCi0gKiBz
ZXQgb2Ygc3RyaW5ncyB0aGF0IG1hcCB0byB1bnNpZ25lZCBpbnRlZ2VyIHZhbHVlcy4gVGhlIEdl
bmVyaWMgQ291bnRlciBlbnVtCi0gKiBleHRlbnNpb24gaGVscGVyIGNvZGUgdGFrZXMgY2FyZSBv
ZiBtYXBwaW5nIGJldHdlZW4gdmFsdWUgYW5kIHN0cmluZywgYXMgd2VsbAotICogYXMgZ2VuZXJh
dGluZyBhICJfYXZhaWxhYmxlIiBmaWxlIHdoaWNoIGNvbnRhaW5zIGEgbGlzdCBvZiBhbGwgYXZh
aWxhYmxlCi0gKiBpdGVtcy4gVGhlIGdldCBjYWxsYmFjayBpcyB1c2VkIHRvIHF1ZXJ5IHRoZSBj
dXJyZW50bHkgYWN0aXZlIGl0ZW07IHRoZSBpbmRleAotICogb2YgdGhlIGl0ZW0gd2l0aGluIHRo
ZSByZXNwZWN0aXZlIGl0ZW1zIGFycmF5IGlzIHJldHVybmVkIHZpYSB0aGUgJ2l0ZW0nCi0gKiBw
YXJhbWV0ZXIuIFRoZSBzZXQgY2FsbGJhY2sgaXMgY2FsbGVkIHdoZW4gdGhlIGF0dHJpYnV0ZSBp
cyB1cGRhdGVkOyB0aGUKLSAqICdpdGVtJyBwYXJhbWV0ZXIgY29udGFpbnMgdGhlIGluZGV4IG9m
IHRoZSBuZXdseSBhY3RpdmF0ZWQgaXRlbSB3aXRoaW4gdGhlCi0gKiByZXNwZWN0aXZlIGl0ZW1z
IGFycmF5LgotICovCi1zdHJ1Y3QgY291bnRlcl9kZXZpY2VfZW51bV9leHQgewotCWNvbnN0IGNo
YXIgKiBjb25zdCAqaXRlbXM7Ci0Jc2l6ZV90IG51bV9pdGVtczsKLQlpbnQgKCpnZXQpKHN0cnVj
dCBjb3VudGVyX2RldmljZSAqY291bnRlciwgc2l6ZV90ICppdGVtKTsKLQlpbnQgKCpzZXQpKHN0
cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwgc2l6ZV90IGl0ZW0pOwotfTsKLQotLyoqCi0g
KiBDT1VOVEVSX0RFVklDRV9FTlVNKCkgLSBJbml0aWFsaXplIENvdW50ZXIgZW51bSBleHRlbnNp
b24KLSAqIEBfbmFtZToJQXR0cmlidXRlIG5hbWUKLSAqIEBfZToJCVBvaW50ZXIgdG8gYSBjb3Vu
dGVyX2RldmljZV9lbnVtX2V4dCBzdHJ1Y3R1cmUKLSAqCi0gKiBUaGlzIHNob3VsZCB1c3VhbGx5
IGJlIHVzZWQgdG9nZXRoZXIgd2l0aCBDT1VOVEVSX0RFVklDRV9FTlVNX0FWQUlMQUJMRSgpCi0g
Ki8KLSNkZWZpbmUgQ09VTlRFUl9ERVZJQ0VfRU5VTShfbmFtZSwgX2UpIFwKLXsgXAotCS5uYW1l
ID0gKF9uYW1lKSwgXAotCS5yZWFkID0gY291bnRlcl9kZXZpY2VfZW51bV9yZWFkLCBcCi0JLndy
aXRlID0gY291bnRlcl9kZXZpY2VfZW51bV93cml0ZSwgXAotCS5wcml2ID0gKF9lKSBcCi19Ci0K
LS8qKgotICogQ09VTlRFUl9ERVZJQ0VfRU5VTV9BVkFJTEFCTEUoKSAtIEluaXRpYWxpemUgQ291
bnRlciBlbnVtIGF2YWlsYWJsZSBleHRlbnNpb24KLSAqIEBfbmFtZToJQXR0cmlidXRlIG5hbWUg
KCJfYXZhaWxhYmxlIiB3aWxsIGJlIGFwcGVuZGVkIHRvIHRoZSBuYW1lKQotICogQF9lOgkJUG9p
bnRlciB0byBhIGNvdW50ZXJfZGV2aWNlX2VudW1fZXh0IHN0cnVjdHVyZQotICoKLSAqIENyZWF0
ZXMgYSByZWFkIG9ubHkgYXR0cmlidXRlIHRoYXQgbGlzdHMgYWxsIHRoZSBhdmFpbGFibGUgZW51
bSBpdGVtcyBpbiBhCi0gKiBuZXdsaW5lIHNlcGFyYXRlZCBsaXN0LiBUaGlzIHNob3VsZCB1c3Vh
bGx5IGJlIHVzZWQgdG9nZXRoZXIgd2l0aAotICogQ09VTlRFUl9ERVZJQ0VfRU5VTSgpCi0gKi8K
LSNkZWZpbmUgQ09VTlRFUl9ERVZJQ0VfRU5VTV9BVkFJTEFCTEUoX25hbWUsIF9lKSBcCi17IFwK
LQkubmFtZSA9IChfbmFtZSAiX2F2YWlsYWJsZSIpLCBcCi0JLnJlYWQgPSBjb3VudGVyX2Rldmlj
ZV9lbnVtX2F2YWlsYWJsZV9yZWFkLCBcCi0JLnByaXYgPSAoX2UpIFwKLX0KLQogLyoqCiAgKiBz
dHJ1Y3QgY291bnRlcl9kZXZpY2UgLSBDb3VudGVyIGRhdGEgc3RydWN0dXJlCiAgKiBAbmFtZToJ
CW5hbWUgb2YgdGhlIGRldmljZSBhcyBpdCBhcHBlYXJzIGluIHRoZSBkYXRhc2hlZXQKICAqIEBw
YXJlbnQ6CQlvcHRpb25hbCBwYXJlbnQgZGV2aWNlIHByb3ZpZGluZyB0aGUgY291bnRlcnMKLSAq
IEBkZXZpY2Vfc3RhdGU6CWludGVybmFsIGRldmljZSBzdGF0ZSBjb250YWluZXIKICAqIEBvcHM6
CQljYWxsYmFja3MgZnJvbSBkcml2ZXIKICAqIEBzaWduYWxzOgkJYXJyYXkgb2YgU2lnbmFscwog
ICogQG51bV9zaWduYWxzOgludW1iZXIgb2YgU2lnbmFscyBzcGVjaWZpZWQgaW4gQHNpZ25hbHMK
QEAgLTQyNSwxMSArMzAxLDExIEBAIHN0cnVjdCBjb3VudGVyX2RldmljZV9lbnVtX2V4dCB7CiAg
KiBAZXh0OgkJb3B0aW9uYWwgYXJyYXkgb2YgQ291bnRlciBkZXZpY2UgZXh0ZW5zaW9ucwogICog
QG51bV9leHQ6CQludW1iZXIgb2YgQ291bnRlciBkZXZpY2UgZXh0ZW5zaW9ucyBzcGVjaWZpZWQg
aW4gQGV4dAogICogQHByaXY6CQlvcHRpb25hbCBwcml2YXRlIGRhdGEgc3VwcGxpZWQgYnkgZHJp
dmVyCisgKiBAZGV2OgkJaW50ZXJuYWwgZGV2aWNlIHN0cnVjdHVyZQogICovCiBzdHJ1Y3QgY291
bnRlcl9kZXZpY2UgewogCWNvbnN0IGNoYXIgKm5hbWU7CiAJc3RydWN0IGRldmljZSAqcGFyZW50
OwotCXN0cnVjdCBjb3VudGVyX2RldmljZV9zdGF0ZSAqZGV2aWNlX3N0YXRlOwogCiAJY29uc3Qg
c3RydWN0IGNvdW50ZXJfb3BzICpvcHM7CiAKQEAgLTQzOCwxNyArMzE0LDE1OSBAQCBzdHJ1Y3Qg
Y291bnRlcl9kZXZpY2UgewogCXN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudHM7CiAJc2l6ZV90
IG51bV9jb3VudHM7CiAKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9kZXZpY2VfZXh0ICpleHQ7CisJ
c3RydWN0IGNvdW50ZXJfY29tcCAqZXh0OwogCXNpemVfdCBudW1fZXh0OwogCiAJdm9pZCAqcHJp
djsKKworCXN0cnVjdCBkZXZpY2UgZGV2OwogfTsKIAogaW50IGNvdW50ZXJfcmVnaXN0ZXIoc3Ry
dWN0IGNvdW50ZXJfZGV2aWNlICpjb25zdCBjb3VudGVyKTsKIHZvaWQgY291bnRlcl91bnJlZ2lz
dGVyKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY29uc3QgY291bnRlcik7CiBpbnQgZGV2bV9jb3Vu
dGVyX3JlZ2lzdGVyKHN0cnVjdCBkZXZpY2UgKmRldiwKIAkJCSAgc3RydWN0IGNvdW50ZXJfZGV2
aWNlICpjb25zdCBjb3VudGVyKTsKLXZvaWQgZGV2bV9jb3VudGVyX3VucmVnaXN0ZXIoc3RydWN0
IGRldmljZSAqZGV2LAotCQkJICAgICBzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvbnN0IGNvdW50
ZXIpOworCisjZGVmaW5lIENPVU5URVJfQ09NUF9ERVZJQ0VfVTgoX25hbWUsIF9yZWFkLCBfd3Jp
dGUpIFwKK3sgXAorCS50eXBlID0gQ09VTlRFUl9DT01QX1U4LCBcCisJLm5hbWUgPSAoX25hbWUp
LCBcCisJLmRldmljZV91OF9yZWFkID0gKF9yZWFkKSwgXAorCS5kZXZpY2VfdThfd3JpdGUgPSAo
X3dyaXRlKSwgXAorfQorI2RlZmluZSBDT1VOVEVSX0NPTVBfQ09VTlRfVTgoX25hbWUsIF9yZWFk
LCBfd3JpdGUpIFwKK3sgXAorCS50eXBlID0gQ09VTlRFUl9DT01QX1U4LCBcCisJLm5hbWUgPSAo
X25hbWUpLCBcCisJLmNvdW50X3U4X3JlYWQgPSAoX3JlYWQpLCBcCisJLmNvdW50X3U4X3dyaXRl
ID0gKF93cml0ZSksIFwKK30KKyNkZWZpbmUgQ09VTlRFUl9DT01QX1NJR05BTF9VOChfbmFtZSwg
X3JlYWQsIF93cml0ZSkgXAoreyBcCisJLnR5cGUgPSBDT1VOVEVSX0NPTVBfVTgsIFwKKwkubmFt
ZSA9IChfbmFtZSksIFwKKwkuc2lnbmFsX3U4X3JlYWQgPSAoX3JlYWQpLCBcCisJLnNpZ25hbF91
OF93cml0ZSA9IChfd3JpdGUpLCBcCit9CisKKyNkZWZpbmUgQ09VTlRFUl9DT01QX0RFVklDRV9V
NjQoX25hbWUsIF9yZWFkLCBfd3JpdGUpIFwKK3sgXAorCS50eXBlID0gQ09VTlRFUl9DT01QX1U2
NCwgXAorCS5uYW1lID0gKF9uYW1lKSwgXAorCS5kZXZpY2VfdTY0X3JlYWQgPSAoX3JlYWQpLCBc
CisJLmRldmljZV91NjRfd3JpdGUgPSAoX3dyaXRlKSwgXAorfQorI2RlZmluZSBDT1VOVEVSX0NP
TVBfQ09VTlRfVTY0KF9uYW1lLCBfcmVhZCwgX3dyaXRlKSBcCit7IFwKKwkudHlwZSA9IENPVU5U
RVJfQ09NUF9VNjQsIFwKKwkubmFtZSA9IChfbmFtZSksIFwKKwkuY291bnRfdTY0X3JlYWQgPSAo
X3JlYWQpLCBcCisJLmNvdW50X3U2NF93cml0ZSA9IChfd3JpdGUpLCBcCit9CisjZGVmaW5lIENP
VU5URVJfQ09NUF9TSUdOQUxfVTY0KF9uYW1lLCBfcmVhZCwgX3dyaXRlKSBcCit7IFwKKwkudHlw
ZSA9IENPVU5URVJfQ09NUF9VNjQsIFwKKwkubmFtZSA9IChfbmFtZSksIFwKKwkuc2lnbmFsX3U2
NF9yZWFkID0gKF9yZWFkKSwgXAorCS5zaWduYWxfdTY0X3dyaXRlID0gKF93cml0ZSksIFwKK30K
KworI2RlZmluZSBDT1VOVEVSX0NPTVBfREVWSUNFX0JPT0woX25hbWUsIF9yZWFkLCBfd3JpdGUp
IFwKK3sgXAorCS50eXBlID0gQ09VTlRFUl9DT01QX0JPT0wsIFwKKwkubmFtZSA9IChfbmFtZSks
IFwKKwkuZGV2aWNlX3U4X3JlYWQgPSAoX3JlYWQpLCBcCisJLmRldmljZV91OF93cml0ZSA9IChf
d3JpdGUpLCBcCit9CisjZGVmaW5lIENPVU5URVJfQ09NUF9DT1VOVF9CT09MKF9uYW1lLCBfcmVh
ZCwgX3dyaXRlKSBcCit7IFwKKwkudHlwZSA9IENPVU5URVJfQ09NUF9CT09MLCBcCisJLm5hbWUg
PSAoX25hbWUpLCBcCisJLmNvdW50X3U4X3JlYWQgPSAoX3JlYWQpLCBcCisJLmNvdW50X3U4X3dy
aXRlID0gKF93cml0ZSksIFwKK30KKyNkZWZpbmUgQ09VTlRFUl9DT01QX1NJR05BTF9CT09MKF9u
YW1lLCBfcmVhZCwgX3dyaXRlKSBcCit7IFwKKwkudHlwZSA9IENPVU5URVJfQ09NUF9CT09MLCBc
CisJLm5hbWUgPSAoX25hbWUpLCBcCisJLnNpZ25hbF91OF9yZWFkID0gKF9yZWFkKSwgXAorCS5z
aWduYWxfdThfd3JpdGUgPSAoX3dyaXRlKSwgXAorfQorCitzdHJ1Y3QgY291bnRlcl9hdmFpbGFi
bGUgeworCXVuaW9uIHsKKwkJY29uc3QgdTMyICplbnVtczsKKwkJY29uc3QgY2hhciAqY29uc3Qg
KnN0cnM7CisJfTsKKwlzaXplX3QgbnVtX2l0ZW1zOworfTsKKworI2RlZmluZSBERUZJTkVfQ09V
TlRFUl9BVkFJTEFCTEUoX25hbWUsIF9lbnVtcykgXAorCXN0cnVjdCBjb3VudGVyX2F2YWlsYWJs
ZSBfbmFtZSA9IHsgXAorCQkuZW51bXMgPSAoX2VudW1zKSwgXAorCQkubnVtX2l0ZW1zID0gQVJS
QVlfU0laRShfZW51bXMpLCBcCisJfQorCisjZGVmaW5lIERFRklORV9DT1VOVEVSX0VOVU0oX25h
bWUsIF9zdHJzKSBcCisJc3RydWN0IGNvdW50ZXJfYXZhaWxhYmxlIF9uYW1lID0geyBcCisJCS5z
dHJzID0gKF9zdHJzKSwgXAorCQkubnVtX2l0ZW1zID0gQVJSQVlfU0laRShfc3RycyksIFwKKwl9
CisKKyNkZWZpbmUgQ09VTlRFUl9DT01QX0RFVklDRV9FTlVNKF9uYW1lLCBfZ2V0LCBfc2V0LCBf
YXZhaWxhYmxlKSBcCit7IFwKKwkudHlwZSA9IENPVU5URVJfQ09NUF9FTlVNLCBcCisJLm5hbWUg
PSAoX25hbWUpLCBcCisJLmRldmljZV91MzJfcmVhZCA9IChfZ2V0KSwgXAorCS5kZXZpY2VfdTMy
X3dyaXRlID0gKF9zZXQpLCBcCisJLnByaXYgPSAmKF9hdmFpbGFibGUpLCBcCit9CisjZGVmaW5l
IENPVU5URVJfQ09NUF9DT1VOVF9FTlVNKF9uYW1lLCBfZ2V0LCBfc2V0LCBfYXZhaWxhYmxlKSBc
Cit7IFwKKwkudHlwZSA9IENPVU5URVJfQ09NUF9FTlVNLCBcCisJLm5hbWUgPSAoX25hbWUpLCBc
CisJLmNvdW50X3UzMl9yZWFkID0gKF9nZXQpLCBcCisJLmNvdW50X3UzMl93cml0ZSA9IChfc2V0
KSwgXAorCS5wcml2ID0gJihfYXZhaWxhYmxlKSwgXAorfQorI2RlZmluZSBDT1VOVEVSX0NPTVBf
U0lHTkFMX0VOVU0oX25hbWUsIF9nZXQsIF9zZXQsIF9hdmFpbGFibGUpIFwKK3sgXAorCS50eXBl
ID0gQ09VTlRFUl9DT01QX0VOVU0sIFwKKwkubmFtZSA9IChfbmFtZSksIFwKKwkuc2lnbmFsX3Uz
Ml9yZWFkID0gKF9nZXQpLCBcCisJLnNpZ25hbF91MzJfd3JpdGUgPSAoX3NldCksIFwKKwkucHJp
diA9ICYoX2F2YWlsYWJsZSksIFwKK30KKworI2RlZmluZSBDT1VOVEVSX0NPTVBfQ0VJTElORyhf
cmVhZCwgX3dyaXRlKSBcCisJQ09VTlRFUl9DT01QX0NPVU5UX1U2NCgiY2VpbGluZyIsIF9yZWFk
LCBfd3JpdGUpCisKKyNkZWZpbmUgQ09VTlRFUl9DT01QX0NPVU5UX01PREUoX3JlYWQsIF93cml0
ZSwgX2F2YWlsYWJsZSkgXAoreyBcCisJLnR5cGUgPSBDT1VOVEVSX0NPTVBfQ09VTlRfTU9ERSwg
XAorCS5uYW1lID0gImNvdW50X21vZGUiLCBcCisJLmNvdW50X3UzMl9yZWFkID0gKF9yZWFkKSwg
XAorCS5jb3VudF91MzJfd3JpdGUgPSAoX3dyaXRlKSwgXAorCS5wcml2ID0gJihfYXZhaWxhYmxl
KSwgXAorfQorCisjZGVmaW5lIENPVU5URVJfQ09NUF9ESVJFQ1RJT04oX3JlYWQpIFwKK3sgXAor
CS50eXBlID0gQ09VTlRFUl9DT01QX0NPVU5UX0RJUkVDVElPTiwgXAorCS5uYW1lID0gImRpcmVj
dGlvbiIsIFwKKwkuY291bnRfdTMyX3JlYWQgPSAoX3JlYWQpLCBcCit9CisKKyNkZWZpbmUgQ09V
TlRFUl9DT01QX0VOQUJMRShfcmVhZCwgX3dyaXRlKSBcCisJQ09VTlRFUl9DT01QX0NPVU5UX0JP
T0woImVuYWJsZSIsIF9yZWFkLCBfd3JpdGUpCisKKyNkZWZpbmUgQ09VTlRFUl9DT01QX0ZMT09S
KF9yZWFkLCBfd3JpdGUpIFwKKwlDT1VOVEVSX0NPTVBfQ09VTlRfVTY0KCJmbG9vciIsIF9yZWFk
LCBfd3JpdGUpCisKKyNkZWZpbmUgQ09VTlRFUl9DT01QX1BSRVNFVChfcmVhZCwgX3dyaXRlKSBc
CisJQ09VTlRFUl9DT01QX0NPVU5UX1U2NCgicHJlc2V0IiwgX3JlYWQsIF93cml0ZSkKKworI2Rl
ZmluZSBDT1VOVEVSX0NPTVBfUFJFU0VUX0VOQUJMRShfcmVhZCwgX3dyaXRlKSBcCisJQ09VTlRF
Ul9DT01QX0NPVU5UX0JPT0woInByZXNldF9lbmFibGUiLCBfcmVhZCwgX3dyaXRlKQogCiAjZW5k
aWYgLyogX0NPVU5URVJfSF8gKi8KZGlmZiAtLWdpdCBhL2luY2x1ZGUvbGludXgvY291bnRlcl9l
bnVtLmggYi9pbmNsdWRlL2xpbnV4L2NvdW50ZXJfZW51bS5oCmRlbGV0ZWQgZmlsZSBtb2RlIDEw
MDY0NAppbmRleCA5ZjkxNzI5OGE4OGYuLjAwMDAwMDAwMDAwMAotLS0gYS9pbmNsdWRlL2xpbnV4
L2NvdW50ZXJfZW51bS5oCisrKyAvZGV2L251bGwKQEAgLTEsNDUgKzAsMCBAQAotLyogU1BEWC1M
aWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAgKi8KLS8qCi0gKiBDb3VudGVyIGludGVyZmFjZSBl
bnVtIGZ1bmN0aW9ucwotICogQ29weXJpZ2h0IChDKSAyMDE4IFdpbGxpYW0gQnJlYXRoaXR0IEdy
YXkKLSAqLwotI2lmbmRlZiBfQ09VTlRFUl9FTlVNX0hfCi0jZGVmaW5lIF9DT1VOVEVSX0VOVU1f
SF8KLQotI2luY2x1ZGUgPGxpbnV4L3R5cGVzLmg+Ci0KLXN0cnVjdCBjb3VudGVyX2RldmljZTsK
LXN0cnVjdCBjb3VudGVyX3NpZ25hbDsKLXN0cnVjdCBjb3VudGVyX2NvdW50OwotCi1zc2l6ZV90
IGNvdW50ZXJfc2lnbmFsX2VudW1fcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIs
Ci0JCQkJIHN0cnVjdCBjb3VudGVyX3NpZ25hbCAqc2lnbmFsLCB2b2lkICpwcml2LAotCQkJCSBj
aGFyICpidWYpOwotc3NpemVfdCBjb3VudGVyX3NpZ25hbF9lbnVtX3dyaXRlKHN0cnVjdCBjb3Vu
dGVyX2RldmljZSAqY291bnRlciwKLQkJCQkgIHN0cnVjdCBjb3VudGVyX3NpZ25hbCAqc2lnbmFs
LCB2b2lkICpwcml2LAotCQkJCSAgY29uc3QgY2hhciAqYnVmLCBzaXplX3QgbGVuKTsKLQotc3Np
emVfdCBjb3VudGVyX3NpZ25hbF9lbnVtX2F2YWlsYWJsZV9yZWFkKHN0cnVjdCBjb3VudGVyX2Rl
dmljZSAqY291bnRlciwKLQkJCQkJICAgc3RydWN0IGNvdW50ZXJfc2lnbmFsICpzaWduYWwsCi0J
CQkJCSAgIHZvaWQgKnByaXYsIGNoYXIgKmJ1Zik7Ci0KLXNzaXplX3QgY291bnRlcl9jb3VudF9l
bnVtX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCXN0cnVjdCBjb3Vu
dGVyX2NvdW50ICpjb3VudCwgdm9pZCAqcHJpdiwKLQkJCQljaGFyICpidWYpOwotc3NpemVfdCBj
b3VudGVyX2NvdW50X2VudW1fd3JpdGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAot
CQkJCSBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHZvaWQgKnByaXYsCi0JCQkJIGNvbnN0
IGNoYXIgKmJ1Ziwgc2l6ZV90IGxlbik7Ci0KLXNzaXplX3QgY291bnRlcl9jb3VudF9lbnVtX2F2
YWlsYWJsZV9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQkJICBzdHJ1
Y3QgY291bnRlcl9jb3VudCAqY291bnQsCi0JCQkJCSAgdm9pZCAqcHJpdiwgY2hhciAqYnVmKTsK
LQotc3NpemVfdCBjb3VudGVyX2RldmljZV9lbnVtX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNl
ICpjb3VudGVyLCB2b2lkICpwcml2LAotCQkJCSBjaGFyICpidWYpOwotc3NpemVfdCBjb3VudGVy
X2RldmljZV9lbnVtX3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwgdm9pZCAq
cHJpdiwKLQkJCQkgIGNvbnN0IGNoYXIgKmJ1Ziwgc2l6ZV90IGxlbik7Ci0KLXNzaXplX3QgY291
bnRlcl9kZXZpY2VfZW51bV9hdmFpbGFibGVfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNv
dW50ZXIsCi0JCQkJCSAgIHZvaWQgKnByaXYsIGNoYXIgKmJ1Zik7Ci0KLSNlbmRpZiAvKiBfQ09V
TlRFUl9FTlVNX0hfICovCi0tIAoyLjMyLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fCkxpbnV4LXN0bTMyIG1haWxpbmcgbGlzdApMaW51eC1zdG0zMkBz
dC1tZC1tYWlsbWFuLnN0b3JtcmVwbHkuY29tCmh0dHBzOi8vc3QtbWQtbWFpbG1hbi5zdG9ybXJl
cGx5LmNvbS9tYWlsbWFuL2xpc3RpbmZvL2xpbnV4LXN0bTMyCg==
