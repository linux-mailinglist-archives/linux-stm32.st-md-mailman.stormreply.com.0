Return-Path: <linux-stm32-bounces@st-md-mailman.stormreply.com>
X-Original-To: lists+linux-stm32@lfdr.de
Delivered-To: lists+linux-stm32@lfdr.de
Received: from stm-ict-prod-mailman-01.stormreply.prv (st-md-mailman.stormreply.com [52.209.6.89])
	by mail.lfdr.de (Postfix) with ESMTPS id 71FA98A9D60
	for <lists+linux-stm32@lfdr.de>; Thu, 18 Apr 2024 16:44:30 +0200 (CEST)
Received: from ip-172-31-3-47.eu-west-1.compute.internal (localhost [127.0.0.1])
	by stm-ict-prod-mailman-01.stormreply.prv (Postfix) with ESMTP id 38AE5C6DD9C;
	Thu, 18 Apr 2024 14:44:30 +0000 (UTC)
Received: from mx07-00178001.pphosted.com (mx07-00178001.pphosted.com
 [185.132.182.106])
 (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
 (No client certificate requested)
 by stm-ict-prod-mailman-01.stormreply.prv (Postfix) with ESMTPS id 275AEC6DD9B
 for <linux-stm32@st-md-mailman.stormreply.com>;
 Thu, 18 Apr 2024 14:44:29 +0000 (UTC)
Received: from pps.filterd (m0241204.ppops.net [127.0.0.1])
 by mx07-00178001.pphosted.com (8.17.1.24/8.17.1.24) with ESMTP id
 43ICkpAi024390; Thu, 18 Apr 2024 16:44:03 +0200
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=foss.st.com; h=
 from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-type:content-transfer-encoding; s=
 selector1; bh=kCEdnMcJCFwIkVj1mDIJIZ2ZcGqG9mLc4VGAUReqE6w=; b=1n
 zocMbIY5rPBCoAHCDuTY+l+2nDgO3VDRUDhk0mu7mMZuepaaGIBSbxwBPhJeyd8A
 b3HuCyg+jOV3LnonerOIAvf3flfgmURZ5k28rBnlKzEcc/nXfYtsTWVtAZjfdc8o
 hurUBmZGDs4iCRpALxdgKTkaic9QrIAQSnz5NpH3qnVXdJ9zh/YNFolh+9AjQL+k
 UxB6Sz5/LRq/Cs8IxspkPUq4H7PzMWFxbIBCrOeQYQrgx51BLodVZ5fqIdJuH8Kn
 Q7b7F8+DSy8yojRjjuFMei//dcimA7M1jvf/kE9rkhuiedWQE99Sdnvqtdign+K6
 bBS4rXyyG5Isd7jyXPGQ==
Received: from beta.dmz-ap.st.com (beta.dmz-ap.st.com [138.198.100.35])
 by mx07-00178001.pphosted.com (PPS) with ESMTPS id 3xfhcwyugm-1
 (version=TLSv1.2 cipher=ECDHE-RSA-AES256-GCM-SHA384 bits=256 verify=NOT);
 Thu, 18 Apr 2024 16:44:02 +0200 (MEST)
Received: from euls16034.sgp.st.com (euls16034.sgp.st.com [10.75.44.20])
 by beta.dmz-ap.st.com (STMicroelectronics) with ESMTP id 240934002D;
 Thu, 18 Apr 2024 16:43:41 +0200 (CEST)
Received: from Webmail-eu.st.com (shfdag1node3.st.com [10.75.129.71])
 by euls16034.sgp.st.com (STMicroelectronics) with ESMTP id 1C74621ED3D;
 Thu, 18 Apr 2024 16:43:02 +0200 (CEST)
Received: from localhost (10.48.86.103) by SHFDAG1NODE3.st.com (10.75.129.71)
 with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256) id 15.1.2507.35; Thu, 18 Apr
 2024 16:43:01 +0200
From: Maxime MERE <maxime.mere@foss.st.com>
To: Herbert Xu <herbert@gondor.apana.org.au>, "David S . Miller"
 <davem@davemloft.net>, Maxime Coquelin <mcoquelin.stm32@gmail.com>,
 Alexandre Torgue <alexandre.torgue@foss.st.com>
Date: Thu, 18 Apr 2024 16:42:54 +0200
Message-ID: <20240418144256.3736800-2-maxime.mere@foss.st.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20240418144256.3736800-1-maxime.mere@foss.st.com>
References: <20240418144256.3736800-1-maxime.mere@foss.st.com>
MIME-Version: 1.0
X-Originating-IP: [10.48.86.103]
X-ClientProxiedBy: EQNCAS1NODE4.st.com (10.75.129.82) To SHFDAG1NODE3.st.com
 (10.75.129.71)
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.272,Aquarius:18.0.1011,Hydra:6.0.619,FMLib:17.11.176.26
 definitions=2024-04-18_12,2024-04-17_01,2023-05-22_02
Cc: Rob Herring <robh@kernel.org>, linux-kernel@vger.kernel.org,
 linux-crypto@vger.kernel.org,
 =?UTF-8?q?Uwe=20Kleine-K=C3=B6nig?= <u.kleine-koenig@pengutronix.de>,
 linux-stm32@st-md-mailman.stormreply.com, linux-arm-kernel@lists.infradead.org
Subject: [Linux-stm32] [PATCH 1/3] crypto: stm32/cryp - use dma when
	possible.
X-BeenThere: linux-stm32@st-md-mailman.stormreply.com
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: <linux-stm32.st-md-mailman.stormreply.com>
List-Unsubscribe: <https://st-md-mailman.stormreply.com/mailman/options/linux-stm32>, 
 <mailto:linux-stm32-request@st-md-mailman.stormreply.com?subject=unsubscribe>
List-Archive: <http://st-md-mailman.stormreply.com/pipermail/linux-stm32/>
List-Post: <mailto:linux-stm32@st-md-mailman.stormreply.com>
List-Help: <mailto:linux-stm32-request@st-md-mailman.stormreply.com?subject=help>
List-Subscribe: <https://st-md-mailman.stormreply.com/mailman/listinfo/linux-stm32>, 
 <mailto:linux-stm32-request@st-md-mailman.stormreply.com?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: linux-stm32-bounces@st-md-mailman.stormreply.com
Sender: "Linux-stm32" <linux-stm32-bounces@st-md-mailman.stormreply.com>

RnJvbTogTWF4aW1lIE3DqXLDqSA8bWF4aW1lLm1lcmVAZm9zcy5zdC5jb20+CgpVc2UgRE1BIHdo
ZW4gYnVmZmVyIGFyZSBhbGlnbmVkIGFuZCB3aXRoIGV4cGVjdGVkIHNpemUuCgpJZiBidWZmZXIg
YXJlIGNvcnJlY3RseSBhbGlnbmVkIGFuZCBiaWdnZXIgdGhhbiAxS0Igd2UgaGF2ZSBzb21lCnBl
cmZvcm1hbmNlIGdhaW46CgpXaXRoIERNQSBlbmFibGU6CiQgb3BlbnNzbCBzcGVlZCAtZXZwIGFl
cy0yNTYtY2JjIC1lbmdpbmUgYWZhbGcgLWVsYXBzZWQKVGhlICdudW1iZXJzJyBhcmUgaW4gMTAw
MHMgb2YgYnl0ZXMgcGVyIHNlY29uZCBwcm9jZXNzZWQuCnR5cGUgICAgICAgICAgMTYgYnl0ZXMg
ICAgIDY0IGJ5dGVzICAgIDI1NiBieXRlcyAgIDEwMjQgYnl0ZXMgICA4MTkyIGJ5dGVzICAxNjM4
NCBieXRlcwphZXMtMjU2LWNiYyAgIDEyMC4wMmsgICAgICA0MDYuNzhrICAgICAxNTg4LjgyayAg
ICAgNTg3My4zMmsgICAgMjYwMjAuNTJrICAgIDM0MjU4Ljk0awoKV2l0aG91dCBETUE6CiQgb3Bl
bnNzbCBzcGVlZCAtZXZwIGFlcy0yNTYtY2JjIC1lbmdpbmUgYWZhbGcgLWVsYXBzZWQKVGhlICdu
dW1iZXJzJyBhcmUgaW4gMTAwMHMgb2YgYnl0ZXMgcGVyIHNlY29uZCBwcm9jZXNzZWQuCnR5cGUg
ICAgICAgICAgMTYgYnl0ZXMgICAgIDY0IGJ5dGVzICAgIDI1NiBieXRlcyAgIDEwMjQgYnl0ZXMg
ICA4MTkyIGJ5dGVzICAxNjM4NCBieXRlcwphZXMtMjU2LWNiYyAgIDEyMS4wNmsgICAgICA0MTku
OTVrICAgICAxMTEyLjIzayAgICAgMTg5Ny40N2sgICAgIDIzNjIuMDNrICAgICAyMzg2LjYwawoK
V2l0aCBETUE6CmV4dHJhY3Qgb2YKJCBtb2Rwcm9iZSB0Y3J5cHQgbW9kZT01MDAKdGVzdGluZyBz
cGVlZCBvZiBhc3luYyBjYmMoYWVzKSAoc3RtMzItY2JjLWFlcykgZW5jcnlwdGlvbgp0Y3J5cHQ6
IHRlc3QgMTQgKDI1NiBiaXQga2V5LCAgIDE2IGJ5dGUgYmxvY2tzKTogMSBvcGVyYXRpb24gaW4g
IDE2NzkgY3ljbGVzICgxNiBieXRlcykKdGNyeXB0OiB0ZXN0IDE1ICgyNTYgYml0IGtleSwgICA2
NCBieXRlIGJsb2Nrcyk6IDEgb3BlcmF0aW9uIGluICAxODkzIGN5Y2xlcyAoNjQgYnl0ZXMpCnRj
cnlwdDogdGVzdCAxNiAoMjU2IGJpdCBrZXksICAxMjggYnl0ZSBibG9ja3MpOiAxIG9wZXJhdGlv
biBpbiAgMTc2MCBjeWNsZXMgKDEyOCBieXRlcykKdGNyeXB0OiB0ZXN0IDE3ICgyNTYgYml0IGtl
eSwgIDI1NiBieXRlIGJsb2Nrcyk6IDEgb3BlcmF0aW9uIGluICAyMTU0IGN5Y2xlcyAoMjU2IGJ5
dGVzKQp0Y3J5cHQ6IHRlc3QgMTggKDI1NiBiaXQga2V5LCAxMDI0IGJ5dGUgYmxvY2tzKTogMSBv
cGVyYXRpb24gaW4gIDIxMzIgY3ljbGVzICgxMDI0IGJ5dGVzKQp0Y3J5cHQ6IHRlc3QgMTkgKDI1
NiBiaXQga2V5LCAxNDI0IGJ5dGUgYmxvY2tzKTogMSBvcGVyYXRpb24gaW4gIDI0NjYgY3ljbGVz
ICgxNDI0IGJ5dGVzKQp0Y3J5cHQ6IHRlc3QgMjAgKDI1NiBiaXQga2V5LCA0MDk2IGJ5dGUgYmxv
Y2tzKTogMSBvcGVyYXRpb24gaW4gIDQwNDAgY3ljbGVzICg0MDk2IGJ5dGVzKQoKV2l0aG91dCBE
TUE6CiQgbW9kcHJvYmUgdGNyeXB0IG1vZGU9NTAwCnRjcnlwdDogdGVzdCAxNCAoMjU2IGJpdCBr
ZXksICAgMTYgYnl0ZSBibG9ja3MpOiAxIG9wZXJhdGlvbiBpbiAgMTY3MSBjeWNsZXMgKDE2IGJ5
dGVzKQp0Y3J5cHQ6IHRlc3QgMTUgKDI1NiBiaXQga2V5LCAgIDY0IGJ5dGUgYmxvY2tzKTogMSBv
cGVyYXRpb24gaW4gIDIyNjMgY3ljbGVzICg2NCBieXRlcykKdGNyeXB0OiB0ZXN0IDE2ICgyNTYg
Yml0IGtleSwgIDEyOCBieXRlIGJsb2Nrcyk6IDEgb3BlcmF0aW9uIGluICAyODgxIGN5Y2xlcyAo
MTI4IGJ5dGVzKQp0Y3J5cHQ6IHRlc3QgMTcgKDI1NiBiaXQga2V5LCAgMjU2IGJ5dGUgYmxvY2tz
KTogMSBvcGVyYXRpb24gaW4gIDQyNzAgY3ljbGVzICgyNTYgYnl0ZXMpCnRjcnlwdDogdGVzdCAx
OCAoMjU2IGJpdCBrZXksIDEwMjQgYnl0ZSBibG9ja3MpOiAxIG9wZXJhdGlvbiBpbiAxMTUzNyBj
eWNsZXMgKDEwMjQgYnl0ZXMpCnRjcnlwdDogdGVzdCAxOSAoMjU2IGJpdCBrZXksIDE0MjQgYnl0
ZSBibG9ja3MpOiAxIG9wZXJhdGlvbiBpbiAxNTAyNSBjeWNsZXMgKDE0MjQgYnl0ZXMpCnRjcnlw
dDogdGVzdCAyMCAoMjU2IGJpdCBrZXksIDQwOTYgYnl0ZSBibG9ja3MpOiAxIG9wZXJhdGlvbiBp
biA0MDc0NyBjeWNsZXMgKDQwOTYgYnl0ZXMpCgpDby1kZXZlbG9wZWQtYnk6IE5pY29sYXMgVG9y
b21hbm9mZiA8bmljb2xhcy50b3JvbWFub2ZmQGZvc3Muc3QuY29tPgpTaWduZWQtb2ZmLWJ5OiBO
aWNvbGFzIFRvcm9tYW5vZmYgPG5pY29sYXMudG9yb21hbm9mZkBmb3NzLnN0LmNvbT4KQ28tZGV2
ZWxvcGVkLWJ5OiBBbGV4YW5kcmUgVG9yZ3VlIDxhbGV4YW5kcmUudG9yZ3VlQGZvc3Muc3QuY29t
PgpTaWduZWQtb2ZmLWJ5OiBBbGV4YW5kcmUgVG9yZ3VlIDxhbGV4YW5kcmUudG9yZ3VlQGZvc3Mu
c3QuY29tPgpTaWduZWQtb2ZmLWJ5OiBNYXhpbWUgTcOpcsOpIDxtYXhpbWUubWVyZUBmb3NzLnN0
LmNvbT4KCi0tLQogZHJpdmVycy9jcnlwdG8vc3RtMzIvc3RtMzItY3J5cC5jIHwgNjg2ICsrKysr
KysrKysrKysrKysrKysrKysrKysrKystLQogMSBmaWxlIGNoYW5nZWQsIDY2MCBpbnNlcnRpb25z
KCspLCAyNiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2NyeXB0by9zdG0zMi9z
dG0zMi1jcnlwLmMgYi9kcml2ZXJzL2NyeXB0by9zdG0zMi9zdG0zMi1jcnlwLmMKaW5kZXggZjA5
NWYwMDY1NDI4Li5jNmQ3NmM4MWQ2MGYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvY3J5cHRvL3N0bTMy
L3N0bTMyLWNyeXAuYworKysgYi9kcml2ZXJzL2NyeXB0by9zdG0zMi9zdG0zMi1jcnlwLmMKQEAg
LTEzLDYgKzEzLDggQEAKICNpbmNsdWRlIDxjcnlwdG8vc2NhdHRlcndhbGsuaD4KICNpbmNsdWRl
IDxsaW51eC9jbGsuaD4KICNpbmNsdWRlIDxsaW51eC9kZWxheS5oPgorI2luY2x1ZGUgPGxpbnV4
L2RtYS1tYXBwaW5nLmg+CisjaW5jbHVkZSA8bGludXgvZG1hZW5naW5lLmg+CiAjaW5jbHVkZSA8
bGludXgvZXJyLmg+CiAjaW5jbHVkZSA8bGludXgvaW9wb2xsLmg+CiAjaW5jbHVkZSA8bGludXgv
aW50ZXJydXB0Lmg+CkBAIC00MCw2ICs0Miw4IEBACiAvKiBNb2RlIG1hc2sgPSBiaXRzIFsxNS4u
MF0gKi8KICNkZWZpbmUgRkxHX01PREVfTUFTSyAgICAgICAgICAgR0VOTUFTSygxNSwgMCkKIC8q
IEJpdCBbMzEuLjE2XSBzdGF0dXMgICovCisjZGVmaW5lIEZMR19JTl9PVVRfRE1BICAgICAgICAg
IEJJVCgxNikKKyNkZWZpbmUgRkxHX0hFQURFUl9ETUEgICAgICAgICAgQklUKDE3KQogCiAvKiBS
ZWdpc3RlcnMgKi8KICNkZWZpbmUgQ1JZUF9DUiAgICAgICAgICAgICAgICAgMHgwMDAwMDAwMApA
QCAtMTIxLDggKzEyNSwxMiBAQAogI2RlZmluZSBDUl9QSF9NQVNLICAgICAgICAgICAgICAweDAw
MDMwMDAwCiAjZGVmaW5lIENSX05CUEJMX1NISUZUICAgICAgICAgIDIwCiAKLSNkZWZpbmUgU1Jf
QlVTWSAgICAgICAgICAgICAgICAgMHgwMDAwMDAxMAotI2RlZmluZSBTUl9PRk5FICAgICAgICAg
ICAgICAgICAweDAwMDAwMDA0CisjZGVmaW5lIFNSX0lGTkYgICAgICAgICAgICAgICAgIEJJVCgx
KQorI2RlZmluZSBTUl9PRk5FICAgICAgICAgICAgICAgICBCSVQoMikKKyNkZWZpbmUgU1JfQlVT
WSAgICAgICAgICAgICAgICAgQklUKDgpCisKKyNkZWZpbmUgRE1BQ1JfRElFTiAgICAgICAgICAg
ICAgQklUKDApCisjZGVmaW5lIERNQUNSX0RPRU4gICAgICAgICAgICAgIEJJVCgxKQogCiAjZGVm
aW5lIElNU0NSX0lOICAgICAgICAgICAgICAgIEJJVCgwKQogI2RlZmluZSBJTVNDUl9PVVQgICAg
ICAgICAgICAgICBCSVQoMSkKQEAgLTEzMyw3ICsxNDEsMTUgQEAKIC8qIE1pc2MgKi8KICNkZWZp
bmUgQUVTX0JMT0NLXzMyICAgICAgICAgICAgKEFFU19CTE9DS19TSVpFIC8gc2l6ZW9mKHUzMikp
CiAjZGVmaW5lIEdDTV9DVFJfSU5JVCAgICAgICAgICAgIDIKLSNkZWZpbmUgQ1JZUF9BVVRPU1VT
UEVORF9ERUxBWQk1MAorI2RlZmluZSBDUllQX0FVVE9TVVNQRU5EX0RFTEFZICA1MAorCisjZGVm
aW5lIENSWVBfRE1BX0JVUlNUX1JFRyAgICAgIDQKKworZW51bSBzdG0zMl9kbWFfbW9kZSB7CisJ
Tk9fRE1BLAorCURNQV9QTEFJTl9TRywKKwlETUFfTkVFRF9TR19UUlVOQworfTsKIAogc3RydWN0
IHN0bTMyX2NyeXBfY2FwcyB7CiAJYm9vbAkJCWFlYWRzX3N1cHBvcnQ7CkBAIC0xNDYsNiArMTYy
LDcgQEAgc3RydWN0IHN0bTMyX2NyeXBfY2FwcyB7CiAJdTMyCQkJc3I7CiAJdTMyCQkJZGluOwog
CXUzMgkJCWRvdXQ7CisJdTMyCQkJZG1hY3I7CiAJdTMyCQkJaW1zYzsKIAl1MzIJCQltaXM7CiAJ
dTMyCQkJazFsOwpAQCAtMTcyLDYgKzE4OSw3IEBAIHN0cnVjdCBzdG0zMl9jcnlwIHsKIAlzdHJ1
Y3QgbGlzdF9oZWFkICAgICAgICBsaXN0OwogCXN0cnVjdCBkZXZpY2UgICAgICAgICAgICpkZXY7
CiAJdm9pZCBfX2lvbWVtICAgICAgICAgICAgKnJlZ3M7CisJcGh5c19hZGRyX3QgICAgICAgICAg
ICAgcGh5c19iYXNlOwogCXN0cnVjdCBjbGsgICAgICAgICAgICAgICpjbGs7CiAJdW5zaWduZWQg
bG9uZyAgICAgICAgICAgZmxhZ3M7CiAJdTMyICAgICAgICAgICAgICAgICAgICAgaXJxX3N0YXR1
czsKQEAgLTE5MCw4ICsyMDgsMjAgQEAgc3RydWN0IHN0bTMyX2NyeXAgewogCXNpemVfdCAgICAg
ICAgICAgICAgICAgIGhlYWRlcl9pbjsKIAlzaXplX3QgICAgICAgICAgICAgICAgICBwYXlsb2Fk
X291dDsKIAorCS8qIERNQSBwcm9jZXNzIGZpZWxkcyAqLworCXN0cnVjdCBzY2F0dGVybGlzdCAg
ICAgICppbl9zZzsKKwlzdHJ1Y3Qgc2NhdHRlcmxpc3QgICAgICAqaGVhZGVyX3NnOwogCXN0cnVj
dCBzY2F0dGVybGlzdCAgICAgICpvdXRfc2c7CisJc2l6ZV90ICAgICAgICAgICAgICAgICAgaW5f
c2dfbGVuOworCXNpemVfdCAgICAgICAgICAgICAgICAgIGhlYWRlcl9zZ19sZW47CisJc2l6ZV90
ICAgICAgICAgICAgICAgICAgb3V0X3NnX2xlbjsKKwlzdHJ1Y3QgY29tcGxldGlvbglkbWFfY29t
cGxldGlvbjsKKworCXN0cnVjdCBkbWFfY2hhbiAgICAgICAgICpkbWFfbGNoX2luOworCXN0cnVj
dCBkbWFfY2hhbiAgICAgICAgICpkbWFfbGNoX291dDsKKwllbnVtIHN0bTMyX2RtYV9tb2RlICAg
ICBkbWFfbW9kZTsKIAorCS8qIElUIHByb2Nlc3MgZmllbGRzICovCiAJc3RydWN0IHNjYXR0ZXJf
d2FsayAgICAgaW5fd2FsazsKIAlzdHJ1Y3Qgc2NhdHRlcl93YWxrICAgICBvdXRfd2FsazsKIApA
QCAtMjkxLDEyICszMjEsMjAgQEAgc3RhdGljIGlubGluZSBpbnQgc3RtMzJfY3J5cF93YWl0X2Vu
YWJsZShzdHJ1Y3Qgc3RtMzJfY3J5cCAqY3J5cCkKIAkJCSEoc3RhdHVzICYgQ1JfQ1JZUEVOKSwg
MTAsIDEwMDAwMCk7CiB9CiAKK3N0YXRpYyBpbmxpbmUgaW50IHN0bTMyX2NyeXBfd2FpdF9pbnB1
dChzdHJ1Y3Qgc3RtMzJfY3J5cCAqY3J5cCkKK3sKKwl1MzIgc3RhdHVzOworCisJcmV0dXJuIHJl
YWRsX3JlbGF4ZWRfcG9sbF90aW1lb3V0X2F0b21pYyhjcnlwLT5yZWdzICsgY3J5cC0+Y2Fwcy0+
c3IsIHN0YXR1cywKKwkJCXN0YXR1cyAmIFNSX0lGTkYsIDEsIDEwKTsKK30KKwogc3RhdGljIGlu
bGluZSBpbnQgc3RtMzJfY3J5cF93YWl0X291dHB1dChzdHJ1Y3Qgc3RtMzJfY3J5cCAqY3J5cCkK
IHsKIAl1MzIgc3RhdHVzOwogCi0JcmV0dXJuIHJlYWRsX3JlbGF4ZWRfcG9sbF90aW1lb3V0KGNy
eXAtPnJlZ3MgKyBjcnlwLT5jYXBzLT5zciwgc3RhdHVzLAotCQkJc3RhdHVzICYgU1JfT0ZORSwg
MTAsIDEwMDAwMCk7CisJcmV0dXJuIHJlYWRsX3JlbGF4ZWRfcG9sbF90aW1lb3V0X2F0b21pYyhj
cnlwLT5yZWdzICsgY3J5cC0+Y2Fwcy0+c3IsIHN0YXR1cywKKwkJCXN0YXR1cyAmIFNSX09GTkUs
IDEsIDEwKTsKIH0KIAogc3RhdGljIGlubGluZSB2b2lkIHN0bTMyX2NyeXBfa2V5X3JlYWRfZW5h
YmxlKHN0cnVjdCBzdG0zMl9jcnlwICpjcnlwKQpAQCAtMzExLDggKzM0OSwxMyBAQCBzdGF0aWMg
aW5saW5lIHZvaWQgc3RtMzJfY3J5cF9rZXlfcmVhZF9kaXNhYmxlKHN0cnVjdCBzdG0zMl9jcnlw
ICpjcnlwKQogCQkgICAgICAgY3J5cC0+cmVncyArIGNyeXAtPmNhcHMtPmNyKTsKIH0KIAorc3Rh
dGljIHZvaWQgc3RtMzJfY3J5cF9pcnFfcmVhZF9kYXRhKHN0cnVjdCBzdG0zMl9jcnlwICpjcnlw
KTsKK3N0YXRpYyB2b2lkIHN0bTMyX2NyeXBfaXJxX3dyaXRlX2RhdGEoc3RydWN0IHN0bTMyX2Ny
eXAgKmNyeXApOworc3RhdGljIHZvaWQgc3RtMzJfY3J5cF9pcnFfd3JpdGVfZ2NtY2NtX2hlYWRl
cihzdHJ1Y3Qgc3RtMzJfY3J5cCAqY3J5cCk7CiBzdGF0aWMgaW50IHN0bTMyX2NyeXBfcmVhZF9h
dXRoX3RhZyhzdHJ1Y3Qgc3RtMzJfY3J5cCAqY3J5cCk7CiBzdGF0aWMgdm9pZCBzdG0zMl9jcnlw
X2ZpbmlzaF9yZXEoc3RydWN0IHN0bTMyX2NyeXAgKmNyeXAsIGludCBlcnIpOworc3RhdGljIGlu
dCBzdG0zMl9jcnlwX2RtYV9zdGFydChzdHJ1Y3Qgc3RtMzJfY3J5cCAqY3J5cCk7CitzdGF0aWMg
aW50IHN0bTMyX2NyeXBfaXRfc3RhcnQoc3RydWN0IHN0bTMyX2NyeXAgKmNyeXApOwogCiBzdGF0
aWMgc3RydWN0IHN0bTMyX2NyeXAgKnN0bTMyX2NyeXBfZmluZF9kZXYoc3RydWN0IHN0bTMyX2Ny
eXBfY3R4ICpjdHgpCiB7CkBAIC04MTMsMTEgKzg1NiwyMzggQEAgc3RhdGljIHZvaWQgc3RtMzJf
Y3J5cF9maW5pc2hfcmVxKHN0cnVjdCBzdG0zMl9jcnlwICpjcnlwLCBpbnQgZXJyKQogCWlmIChp
c19nY20oY3J5cCkgfHwgaXNfY2NtKGNyeXApKQogCQljcnlwdG9fZmluYWxpemVfYWVhZF9yZXF1
ZXN0KGNyeXAtPmVuZ2luZSwgY3J5cC0+YXJlcSwgZXJyKTsKIAllbHNlCi0JCWNyeXB0b19maW5h
bGl6ZV9za2NpcGhlcl9yZXF1ZXN0KGNyeXAtPmVuZ2luZSwgY3J5cC0+cmVxLAotCQkJCQkJICAg
ZXJyKTsKKwkJY3J5cHRvX2ZpbmFsaXplX3NrY2lwaGVyX3JlcXVlc3QoY3J5cC0+ZW5naW5lLCBj
cnlwLT5yZXEsIGVycik7Cit9CisKK3N0YXRpYyB2b2lkIHN0bTMyX2NyeXBfaGVhZGVyX2RtYV9j
YWxsYmFjayh2b2lkICpwYXJhbSkKK3sKKwlzdHJ1Y3Qgc3RtMzJfY3J5cCAqY3J5cCA9IChzdHJ1
Y3Qgc3RtMzJfY3J5cCAqKXBhcmFtOworCWludCByZXQ7CisJdTMyIHJlZzsKKworCWRtYV91bm1h
cF9zZyhjcnlwLT5kZXYsIGNyeXAtPmhlYWRlcl9zZywgY3J5cC0+aGVhZGVyX3NnX2xlbiwgRE1B
X1RPX0RFVklDRSk7CisKKwlyZWcgPSBzdG0zMl9jcnlwX3JlYWQoY3J5cCwgY3J5cC0+Y2Fwcy0+
ZG1hY3IpOworCXN0bTMyX2NyeXBfd3JpdGUoY3J5cCwgY3J5cC0+Y2Fwcy0+ZG1hY3IsIHJlZyAm
IH4oRE1BQ1JfRE9FTiB8IERNQUNSX0RJRU4pKTsKKworCWtmcmVlKGNyeXAtPmhlYWRlcl9zZyk7
CisKKwlyZWcgPSBzdG0zMl9jcnlwX3JlYWQoY3J5cCwgY3J5cC0+Y2Fwcy0+Y3IpOworCisJaWYg
KGNyeXAtPmhlYWRlcl9pbikgeworCQlzdG0zMl9jcnlwX3dyaXRlKGNyeXAsIGNyeXAtPmNhcHMt
PmNyLCByZWcgfCBDUl9DUllQRU4pOworCisJCXJldCA9IHN0bTMyX2NyeXBfd2FpdF9pbnB1dChj
cnlwKTsKKwkJaWYgKHJldCkgeworCQkJZGV2X2VycihjcnlwLT5kZXYsICJpbnB1dCBoZWFkZXIg
cmVhZHkgdGltZW91dCBhZnRlciBkbWFcbiIpOworCQkJc3RtMzJfY3J5cF9maW5pc2hfcmVxKGNy
eXAsIHJldCk7CisJCQlyZXR1cm47CisJCX0KKwkJc3RtMzJfY3J5cF9pcnFfd3JpdGVfZ2NtY2Nt
X2hlYWRlcihjcnlwKTsKKwkJV0FSTl9PTihjcnlwLT5oZWFkZXJfaW4pOworCX0KKworCWlmIChz
dG0zMl9jcnlwX2dldF9pbnB1dF90ZXh0X2xlbihjcnlwKSkgeworCQkvKiBQaGFzZSAzIDogcGF5
bG9hZCAqLworCQlyZWcgPSBzdG0zMl9jcnlwX3JlYWQoY3J5cCwgY3J5cC0+Y2Fwcy0+Y3IpOwor
CQlzdG0zMl9jcnlwX3dyaXRlKGNyeXAsIGNyeXAtPmNhcHMtPmNyLCByZWcgJiB+Q1JfQ1JZUEVO
KTsKKworCQlyZWcgJj0gfkNSX1BIX01BU0s7CisJCXJlZyB8PSBDUl9QSF9QQVlMT0FEIHwgQ1Jf
Q1JZUEVOOworCQlzdG0zMl9jcnlwX3dyaXRlKGNyeXAsIGNyeXAtPmNhcHMtPmNyLCByZWcpOwor
CisJCWlmIChjcnlwLT5mbGFncyAmIEZMR19JTl9PVVRfRE1BKSB7CisJCQlyZXQgPSBzdG0zMl9j
cnlwX2RtYV9zdGFydChjcnlwKTsKKwkJCWlmIChyZXQpCisJCQkJc3RtMzJfY3J5cF9maW5pc2hf
cmVxKGNyeXAsIHJldCk7CisJCX0gZWxzZSB7CisJCQlzdG0zMl9jcnlwX2l0X3N0YXJ0KGNyeXAp
OworCQl9CisJfSBlbHNlIHsKKwkJLyoKKwkJICogUGhhc2UgNCA6IHRhZy4KKwkJICogTm90aGlu
ZyB0byByZWFkLCBub3RoaW5nIHRvIHdyaXRlID0+IGVuZCByZXF1ZXN0CisJCSAqLworCQlzdG0z
Ml9jcnlwX2ZpbmlzaF9yZXEoY3J5cCwgMCk7CisJfQorfQorCitzdGF0aWMgdm9pZCBzdG0zMl9j
cnlwX2RtYV9jYWxsYmFjayh2b2lkICpwYXJhbSkKK3sKKwlzdHJ1Y3Qgc3RtMzJfY3J5cCAqY3J5
cCA9IChzdHJ1Y3Qgc3RtMzJfY3J5cCAqKXBhcmFtOworCWludCByZXQ7CisJdTMyIHJlZzsKKwor
CWNvbXBsZXRlKCZjcnlwLT5kbWFfY29tcGxldGlvbik7IC8qIGNvbXBsZXRpb24gdG8gaW5kaWNh
dGUgbm8gdGltZW91dCAqLworCisJZG1hX3N5bmNfc2dfZm9yX2RldmljZShjcnlwLT5kZXYsIGNy
eXAtPm91dF9zZywgY3J5cC0+b3V0X3NnX2xlbiwgRE1BX0ZST01fREVWSUNFKTsKKworCWlmIChj
cnlwLT5pbl9zZyAhPSBjcnlwLT5vdXRfc2cpCisJCWRtYV91bm1hcF9zZyhjcnlwLT5kZXYsIGNy
eXAtPmluX3NnLCBjcnlwLT5pbl9zZ19sZW4sIERNQV9UT19ERVZJQ0UpOworCisJZG1hX3VubWFw
X3NnKGNyeXAtPmRldiwgY3J5cC0+b3V0X3NnLCBjcnlwLT5vdXRfc2dfbGVuLCBETUFfRlJPTV9E
RVZJQ0UpOworCisJcmVnID0gc3RtMzJfY3J5cF9yZWFkKGNyeXAsIGNyeXAtPmNhcHMtPmRtYWNy
KTsKKwlzdG0zMl9jcnlwX3dyaXRlKGNyeXAsIGNyeXAtPmNhcHMtPmRtYWNyLCByZWcgJiB+KERN
QUNSX0RPRU4gfCBETUFDUl9ESUVOKSk7CisKKwlyZWcgPSBzdG0zMl9jcnlwX3JlYWQoY3J5cCwg
Y3J5cC0+Y2Fwcy0+Y3IpOworCisJaWYgKGlzX2djbShjcnlwKSB8fCBpc19jY20oY3J5cCkpIHsK
KwkJa2ZyZWUoY3J5cC0+aW5fc2cpOworCQlrZnJlZShjcnlwLT5vdXRfc2cpOworCX0gZWxzZSB7
CisJCWlmIChjcnlwLT5pbl9zZyAhPSBjcnlwLT5yZXEtPnNyYykKKwkJCWtmcmVlKGNyeXAtPmlu
X3NnKTsKKwkJaWYgKGNyeXAtPm91dF9zZyAhPSBjcnlwLT5yZXEtPmRzdCkKKwkJCWtmcmVlKGNy
eXAtPm91dF9zZyk7CisJfQorCisJaWYgKGNyeXAtPnBheWxvYWRfaW4pIHsKKwkJc3RtMzJfY3J5
cF93cml0ZShjcnlwLCBjcnlwLT5jYXBzLT5jciwgcmVnIHwgQ1JfQ1JZUEVOKTsKKworCQlyZXQg
PSBzdG0zMl9jcnlwX3dhaXRfaW5wdXQoY3J5cCk7CisJCWlmIChyZXQpIHsKKwkJCWRldl9lcnIo
Y3J5cC0+ZGV2LCAiaW5wdXQgcmVhZHkgdGltZW91dCBhZnRlciBkbWFcbiIpOworCQkJc3RtMzJf
Y3J5cF9maW5pc2hfcmVxKGNyeXAsIHJldCk7CisJCQlyZXR1cm47CisJCX0KKwkJc3RtMzJfY3J5
cF9pcnFfd3JpdGVfZGF0YShjcnlwKTsKKworCQlyZXQgPSBzdG0zMl9jcnlwX3dhaXRfb3V0cHV0
KGNyeXApOworCQlpZiAocmV0KSB7CisJCQlkZXZfZXJyKGNyeXAtPmRldiwgIm91dHB1dCByZWFk
eSB0aW1lb3V0IGFmdGVyIGRtYVxuIik7CisJCQlzdG0zMl9jcnlwX2ZpbmlzaF9yZXEoY3J5cCwg
cmV0KTsKKwkJCXJldHVybjsKKwkJfQorCQlzdG0zMl9jcnlwX2lycV9yZWFkX2RhdGEoY3J5cCk7
CisJfQorCisJc3RtMzJfY3J5cF9maW5pc2hfcmVxKGNyeXAsIDApOworfQorCitzdGF0aWMgaW50
IHN0bTMyX2NyeXBfaGVhZGVyX2RtYV9zdGFydChzdHJ1Y3Qgc3RtMzJfY3J5cCAqY3J5cCkKK3sK
KwlpbnQgcmV0OworCXN0cnVjdCBkbWFfYXN5bmNfdHhfZGVzY3JpcHRvciAqdHhfaW47CisJdTMy
IHJlZzsKKwlzaXplX3QgYWxpZ25fc2l6ZTsKKworCXJldCA9IGRtYV9tYXBfc2coY3J5cC0+ZGV2
LCBjcnlwLT5oZWFkZXJfc2csIGNyeXAtPmhlYWRlcl9zZ19sZW4sIERNQV9UT19ERVZJQ0UpOwor
CWlmICghcmV0KSB7CisJCWRldl9lcnIoY3J5cC0+ZGV2LCAiZG1hX21hcF9zZygpIGVycm9yXG4i
KTsKKwkJcmV0dXJuIC1FTk9NRU07CisJfQorCisJZG1hX3N5bmNfc2dfZm9yX2RldmljZShjcnlw
LT5kZXYsIGNyeXAtPmhlYWRlcl9zZywgY3J5cC0+aGVhZGVyX3NnX2xlbiwgRE1BX1RPX0RFVklD
RSk7CisKKwl0eF9pbiA9IGRtYWVuZ2luZV9wcmVwX3NsYXZlX3NnKGNyeXAtPmRtYV9sY2hfaW4s
IGNyeXAtPmhlYWRlcl9zZywgY3J5cC0+aGVhZGVyX3NnX2xlbiwKKwkJCQkJRE1BX01FTV9UT19E
RVYsIERNQV9QUkVQX0lOVEVSUlVQVCB8IERNQV9DVFJMX0FDSyk7CisJaWYgKCF0eF9pbikgewor
CQlkZXZfZXJyKGNyeXAtPmRldiwgIklOIHByZXBfc2xhdmVfc2coKSBmYWlsZWRcbiIpOworCQly
ZXR1cm4gLUVJTlZBTDsKKwl9CisKKwl0eF9pbi0+Y2FsbGJhY2tfcGFyYW0gPSBjcnlwOworCXR4
X2luLT5jYWxsYmFjayA9IHN0bTMyX2NyeXBfaGVhZGVyX2RtYV9jYWxsYmFjazsKKworCS8qIEFk
dmFuY2Ugc2NhdHRlcndhbGsgdG8gbm90IERNQSdlZCBkYXRhICovCisJYWxpZ25fc2l6ZSA9IEFM
SUdOX0RPV04oY3J5cC0+aGVhZGVyX2luLCBjcnlwLT5od19ibG9ja3NpemUpOworCXNjYXR0ZXJ3
YWxrX2NvcHljaHVua3MoTlVMTCwgJmNyeXAtPmluX3dhbGssIGFsaWduX3NpemUsIDIpOworCWNy
eXAtPmhlYWRlcl9pbiAtPSBhbGlnbl9zaXplOworCisJcmV0ID0gZG1hX3N1Ym1pdF9lcnJvcihk
bWFlbmdpbmVfc3VibWl0KHR4X2luKSk7CisJaWYgKHJldCA8IDApIHsKKwkJZGV2X2Vycihjcnlw
LT5kZXYsICJETUEgaW4gc3VibWl0IGZhaWxlZFxuIik7CisJCXJldHVybiByZXQ7CisJfQorCWRt
YV9hc3luY19pc3N1ZV9wZW5kaW5nKGNyeXAtPmRtYV9sY2hfaW4pOworCisJcmVnID0gc3RtMzJf
Y3J5cF9yZWFkKGNyeXAsIGNyeXAtPmNhcHMtPmRtYWNyKTsKKwlzdG0zMl9jcnlwX3dyaXRlKGNy
eXAsIGNyeXAtPmNhcHMtPmRtYWNyLCByZWcgfCBETUFDUl9ESUVOKTsKKworCXJldHVybiAwOwor
fQorCitzdGF0aWMgaW50IHN0bTMyX2NyeXBfZG1hX3N0YXJ0KHN0cnVjdCBzdG0zMl9jcnlwICpj
cnlwKQoreworCWludCByZXQ7CisJc2l6ZV90IGFsaWduX3NpemU7CisJc3RydWN0IGRtYV9hc3lu
Y190eF9kZXNjcmlwdG9yICp0eF9pbiwgKnR4X291dDsKKwl1MzIgcmVnOworCisJaWYgKGNyeXAt
PmluX3NnICE9IGNyeXAtPm91dF9zZykgeworCQlyZXQgPSBkbWFfbWFwX3NnKGNyeXAtPmRldiwg
Y3J5cC0+aW5fc2csIGNyeXAtPmluX3NnX2xlbiwgRE1BX1RPX0RFVklDRSk7CisJCWlmICghcmV0
KSB7CisJCQlkZXZfZXJyKGNyeXAtPmRldiwgImRtYV9tYXBfc2coKSBlcnJvclxuIik7CisJCQly
ZXR1cm4gLUVOT01FTTsKKwkJfQorCX0KKworCXJldCA9IGRtYV9tYXBfc2coY3J5cC0+ZGV2LCBj
cnlwLT5vdXRfc2csIGNyeXAtPm91dF9zZ19sZW4sIERNQV9GUk9NX0RFVklDRSk7CisJaWYgKCFy
ZXQpIHsKKwkJZGV2X2VycihjcnlwLT5kZXYsICJkbWFfbWFwX3NnKCkgZXJyb3JcbiIpOworCQly
ZXR1cm4gLUVOT01FTTsKKwl9CisKKwlkbWFfc3luY19zZ19mb3JfZGV2aWNlKGNyeXAtPmRldiwg
Y3J5cC0+aW5fc2csIGNyeXAtPmluX3NnX2xlbiwgRE1BX1RPX0RFVklDRSk7CisKKwl0eF9pbiA9
IGRtYWVuZ2luZV9wcmVwX3NsYXZlX3NnKGNyeXAtPmRtYV9sY2hfaW4sIGNyeXAtPmluX3NnLCBj
cnlwLT5pbl9zZ19sZW4sCisJCQkJCURNQV9NRU1fVE9fREVWLCBETUFfUFJFUF9JTlRFUlJVUFQg
fCBETUFfQ1RSTF9BQ0spOworCWlmICghdHhfaW4pIHsKKwkJZGV2X2VycihjcnlwLT5kZXYsICJJ
TiBwcmVwX3NsYXZlX3NnKCkgZmFpbGVkXG4iKTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCisJ
LyogTm8gY2FsbGJhY2sgbmVjZXNzYXJ5ICovCisJdHhfaW4tPmNhbGxiYWNrX3BhcmFtID0gY3J5
cDsKKwl0eF9pbi0+Y2FsbGJhY2sgPSBOVUxMOworCisJdHhfb3V0ID0gZG1hZW5naW5lX3ByZXBf
c2xhdmVfc2coY3J5cC0+ZG1hX2xjaF9vdXQsIGNyeXAtPm91dF9zZywgY3J5cC0+b3V0X3NnX2xl
biwKKwkJCQkJIERNQV9ERVZfVE9fTUVNLCBETUFfUFJFUF9JTlRFUlJVUFQgfCBETUFfQ1RSTF9B
Q0spOworCWlmICghdHhfb3V0KSB7CisJCWRldl9lcnIoY3J5cC0+ZGV2LCAiT1VUIHByZXBfc2xh
dmVfc2coKSBmYWlsZWRcbiIpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwlyZWluaXRfY29t
cGxldGlvbigmY3J5cC0+ZG1hX2NvbXBsZXRpb24pOworCXR4X291dC0+Y2FsbGJhY2sgPSBzdG0z
Ml9jcnlwX2RtYV9jYWxsYmFjazsKKwl0eF9vdXQtPmNhbGxiYWNrX3BhcmFtID0gY3J5cDsKKwor
CS8qIEFkdmFuY2Ugc2NhdHRlcndhbGsgdG8gbm90IERNQSdlZCBkYXRhICovCisJYWxpZ25fc2l6
ZSA9IEFMSUdOX0RPV04oY3J5cC0+cGF5bG9hZF9pbiwgY3J5cC0+aHdfYmxvY2tzaXplKTsKKwlz
Y2F0dGVyd2Fsa19jb3B5Y2h1bmtzKE5VTEwsICZjcnlwLT5pbl93YWxrLCBhbGlnbl9zaXplLCAy
KTsKKwljcnlwLT5wYXlsb2FkX2luIC09IGFsaWduX3NpemU7CisKKwlyZXQgPSBkbWFfc3VibWl0
X2Vycm9yKGRtYWVuZ2luZV9zdWJtaXQodHhfaW4pKTsKKwlpZiAocmV0IDwgMCkgeworCQlkZXZf
ZXJyKGNyeXAtPmRldiwgIkRNQSBpbiBzdWJtaXQgZmFpbGVkXG4iKTsKKwkJcmV0dXJuIHJldDsK
Kwl9CisJZG1hX2FzeW5jX2lzc3VlX3BlbmRpbmcoY3J5cC0+ZG1hX2xjaF9pbik7CisKKwkvKiBB
ZHZhbmNlIHNjYXR0ZXJ3YWxrIHRvIG5vdCBETUEnZWQgZGF0YSAqLworCXNjYXR0ZXJ3YWxrX2Nv
cHljaHVua3MoTlVMTCwgJmNyeXAtPm91dF93YWxrLCBhbGlnbl9zaXplLCAyKTsKKwljcnlwLT5w
YXlsb2FkX291dCAtPSBhbGlnbl9zaXplOworCXJldCA9IGRtYV9zdWJtaXRfZXJyb3IoZG1hZW5n
aW5lX3N1Ym1pdCh0eF9vdXQpKTsKKwlpZiAocmV0IDwgMCkgeworCQlkZXZfZXJyKGNyeXAtPmRl
diwgIkRNQSBvdXQgc3VibWl0IGZhaWxlZFxuIik7CisJCXJldHVybiByZXQ7CisJfQorCWRtYV9h
c3luY19pc3N1ZV9wZW5kaW5nKGNyeXAtPmRtYV9sY2hfb3V0KTsKKworCXJlZyA9IHN0bTMyX2Ny
eXBfcmVhZChjcnlwLCBjcnlwLT5jYXBzLT5kbWFjcik7CisJc3RtMzJfY3J5cF93cml0ZShjcnlw
LCBjcnlwLT5jYXBzLT5kbWFjciwgcmVnIHwgRE1BQ1JfRE9FTiB8IERNQUNSX0RJRU4pOworCisJ
aWYgKCF3YWl0X2Zvcl9jb21wbGV0aW9uX3RpbWVvdXQoJmNyeXAtPmRtYV9jb21wbGV0aW9uLCBt
c2Vjc190b19qaWZmaWVzKDEwMDApKSkgeworCQlkZXZfZXJyKGNyeXAtPmRldiwgIkRNQSBvdXQg
dGltZWQgb3V0XG4iKTsKKwkJZG1hZW5naW5lX3Rlcm1pbmF0ZV9zeW5jKGNyeXAtPmRtYV9sY2hf
b3V0KTsKKwkJcmV0dXJuIC1FVElNRURPVVQ7CisJfQorCisJcmV0dXJuIDA7CiB9CiAKLXN0YXRp
YyBpbnQgc3RtMzJfY3J5cF9jcHVfc3RhcnQoc3RydWN0IHN0bTMyX2NyeXAgKmNyeXApCitzdGF0
aWMgaW50IHN0bTMyX2NyeXBfaXRfc3RhcnQoc3RydWN0IHN0bTMyX2NyeXAgKmNyeXApCiB7CiAJ
LyogRW5hYmxlIGludGVycnVwdCBhbmQgbGV0IHRoZSBJUlEgaGFuZGxlciBkbyBldmVyeXRoaW5n
ICovCiAJc3RtMzJfY3J5cF93cml0ZShjcnlwLCBjcnlwLT5jYXBzLT5pbXNjLCBJTVNDUl9JTiB8
IElNU0NSX09VVCk7CkBAIC0xMTQ5LDEzICsxNDE5LDI1NCBAQCBzdGF0aWMgaW50IHN0bTMyX2Ny
eXBfdGRlc19jYmNfZGVjcnlwdChzdHJ1Y3Qgc2tjaXBoZXJfcmVxdWVzdCAqcmVxKQogCXJldHVy
biBzdG0zMl9jcnlwX2NyeXB0KHJlcSwgRkxHX1RERVMgfCBGTEdfQ0JDKTsKIH0KIAorc3RhdGlj
IGVudW0gc3RtMzJfZG1hX21vZGUgc3RtMzJfY3J5cF9kbWFfY2hlY2tfc2coc3RydWN0IHNjYXR0
ZXJsaXN0ICp0ZXN0X3NnLCBzaXplX3QgbGVuLAorCQkJCQkJICAgc2l6ZV90IGJsb2NrX3NpemUp
Cit7CisJc3RydWN0IHNjYXR0ZXJsaXN0ICpzZzsKKwlpbnQgaTsKKworCWlmIChsZW4gPD0gMTYp
CisJCXJldHVybiBOT19ETUE7IC8qIEZhc3RlciAqLworCisJZm9yX2VhY2hfc2codGVzdF9zZywg
c2csIHNnX25lbnRzKHRlc3Rfc2cpLCBpKSB7CisJCWlmICghSVNfQUxJR05FRChzZy0+bGVuZ3Ro
LCBibG9ja19zaXplKSAmJiAhc2dfaXNfbGFzdChzZykpCisJCQlyZXR1cm4gTk9fRE1BOworCisJ
CWlmIChzZy0+b2Zmc2V0ICUgc2l6ZW9mKHUzMikpCisJCQlyZXR1cm4gTk9fRE1BOworCisJCWlm
IChzZ19pc19sYXN0KHNnKSAmJiAhSVNfQUxJR05FRChzZy0+bGVuZ3RoLCBBRVNfQkxPQ0tfU0la
RSkpCisJCQlyZXR1cm4gRE1BX05FRURfU0dfVFJVTkM7CisJfQorCisJcmV0dXJuIERNQV9QTEFJ
Tl9TRzsKK30KKworc3RhdGljIGVudW0gc3RtMzJfZG1hX21vZGUgc3RtMzJfY3J5cF9kbWFfY2hl
Y2soc3RydWN0IHN0bTMyX2NyeXAgKmNyeXAsIHN0cnVjdCBzY2F0dGVybGlzdCAqaW5fc2csCisJ
CQkJCQlzdHJ1Y3Qgc2NhdHRlcmxpc3QgKm91dF9zZykKK3sKKwllbnVtIHN0bTMyX2RtYV9tb2Rl
IHJldCA9IERNQV9QTEFJTl9TRzsKKworCWlmICghaXNfYWVzKGNyeXApKQorCQlyZXR1cm4gTk9f
RE1BOworCisJaWYgKCFjcnlwLT5kbWFfbGNoX2luIHx8ICFjcnlwLT5kbWFfbGNoX291dCkKKwkJ
cmV0dXJuIE5PX0RNQTsKKworCXJldCA9IHN0bTMyX2NyeXBfZG1hX2NoZWNrX3NnKGluX3NnLCBj
cnlwLT5wYXlsb2FkX2luLCBBRVNfQkxPQ0tfU0laRSk7CisJaWYgKHJldCA9PSBOT19ETUEpCisJ
CXJldHVybiByZXQ7CisKKwlyZXQgPSBzdG0zMl9jcnlwX2RtYV9jaGVja19zZyhvdXRfc2csIGNy
eXAtPnBheWxvYWRfb3V0LCBBRVNfQkxPQ0tfU0laRSk7CisJaWYgKHJldCA9PSBOT19ETUEpCisJ
CXJldHVybiByZXQ7CisKKwkvKiBDaGVjayBDVFIgY291bnRlciBvdmVyZmxvdyAqLworCWlmIChp
c19hZXMoY3J5cCkgJiYgaXNfY3RyKGNyeXApKSB7CisJCXUzMiBjOworCQlfX2JlMzIgaXYzOwor
CisJCW1lbWNweSgmaXYzLCAmY3J5cC0+cmVxLT5pdlszICogc2l6ZW9mKHUzMildLCBzaXplb2Yo
aXYzKSk7CisJCWMgPSBiZTMyX3RvX2NwdShpdjMpOworCQlpZiAoKGMgKyBjcnlwLT5wYXlsb2Fk
X2luKSA8IGNyeXAtPnBheWxvYWRfaW4pCisJCQlyZXR1cm4gTk9fRE1BOworCX0KKworCS8qIFdv
cmthcm91bmQgKi8KKwlpZiAoaXNfYWVzKGNyeXApICYmIGlzX2N0cihjcnlwKSAmJiByZXQgPT0g
RE1BX05FRURfU0dfVFJVTkMpCisJCXJldHVybiBOT19ETUE7CisKKwlyZXR1cm4gcmV0OworfQor
CitzdGF0aWMgaW50IHN0bTMyX2NyeXBfdHJ1bmNhdGVfc2coc3RydWN0IHNjYXR0ZXJsaXN0ICoq
bmV3X3NnLCBzaXplX3QgKm5ld19zZ19sZW4sCisJCQkJICBzdHJ1Y3Qgc2NhdHRlcmxpc3QgKnNn
LCBvZmZfdCBza2lwLCBzaXplX3Qgc2l6ZSkKK3sKKwlzdHJ1Y3Qgc2NhdHRlcmxpc3QgKmN1cjsK
KwlzaXplX3QgYWxsb2Nfc2dfbGVuOworCisJKm5ld19zZ19sZW4gPSAwOworCisJaWYgKCFzZyB8
fCAhc2l6ZSkgeworCQkqbmV3X3NnID0gTlVMTDsKKwkJcmV0dXJuIDA7CisJfQorCisJYWxsb2Nf
c2dfbGVuID0gc2dfbmVudHNfZm9yX2xlbihzZywgc2tpcCArIHNpemUpOworCWlmIChhbGxvY19z
Z19sZW4gPCAwKQorCQlyZXR1cm4gYWxsb2Nfc2dfbGVuOworCisJLyogV2UgYWxsb2NhdGUgdG8g
bXVjaCBzZyBlbnRyeSwgYnV0IGl0IGlzIGVhc2llciAqLworCSpuZXdfc2cgPSBrbWFsbG9jX2Fy
cmF5KGFsbG9jX3NnX2xlbiwgc2l6ZW9mKHN0cnVjdCBzY2F0dGVybGlzdCksIEdGUF9LRVJORUwp
OworCWlmICghKm5ld19zZykKKwkJcmV0dXJuIC1FTk9NRU07CisKKwlzZ19pbml0X3RhYmxlKCpu
ZXdfc2csIGFsbG9jX3NnX2xlbik7CisKKwljdXIgPSAqbmV3X3NnOworCXdoaWxlIChzZyAmJiBz
aXplKSB7CisJCXVuc2lnbmVkIGludCBsZW4gPSBzZy0+bGVuZ3RoOworCQl1bnNpZ25lZCBpbnQg
b2Zmc2V0ID0gc2ctPm9mZnNldDsKKworCQlpZiAoc2tpcCA+IGxlbikgeworCQkJc2tpcCAtPSBs
ZW47CisJCQlzZyA9IHNnX25leHQoc2cpOworCQkJY29udGludWU7CisJCX0KKworCQlpZiAoc2tp
cCkgeworCQkJbGVuIC09IHNraXA7CisJCQlvZmZzZXQgKz0gc2tpcDsKKwkJCXNraXAgPSAwOwor
CQl9CisKKwkJaWYgKHNpemUgPCBsZW4pCisJCQlsZW4gPSBzaXplOworCisJCWlmIChsZW4gPiAw
KSB7CisJCQkoKm5ld19zZ19sZW4pKys7CisJCQlzaXplIC09IGxlbjsKKwkJCXNnX3NldF9wYWdl
KGN1ciwgc2dfcGFnZShzZyksIGxlbiwgb2Zmc2V0KTsKKwkJCWlmIChzaXplID09IDApCisJCQkJ
c2dfbWFya19lbmQoY3VyKTsKKwkJCWN1ciA9IHNnX25leHQoY3VyKTsKKwkJfQorCisJCXNnID0g
c2dfbmV4dChzZyk7CisJfQorCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgc3RtMzJfY3J5
cF9jaXBoZXJfcHJlcGFyZShzdHJ1Y3Qgc3RtMzJfY3J5cCAqY3J5cCwgc3RydWN0IHNjYXR0ZXJs
aXN0ICppbl9zZywKKwkJCQkgICAgIHN0cnVjdCBzY2F0dGVybGlzdCAqb3V0X3NnKQoreworCXNp
emVfdCBhbGlnbl9zaXplOworCisJY3J5cC0+ZG1hX21vZGUgPSBzdG0zMl9jcnlwX2RtYV9jaGVj
ayhjcnlwLCBpbl9zZywgb3V0X3NnKTsKKworCXNjYXR0ZXJ3YWxrX3N0YXJ0KCZjcnlwLT5pbl93
YWxrLCBpbl9zZyk7CisJc2NhdHRlcndhbGtfc3RhcnQoJmNyeXAtPm91dF93YWxrLCBvdXRfc2cp
OworCisJaWYgKGNyeXAtPmRtYV9tb2RlID09IE5PX0RNQSkgeworCQljcnlwLT5mbGFncyAmPSB+
RkxHX0lOX09VVF9ETUE7CisKKwkJaWYgKGlzX2N0cihjcnlwKSkKKwkJCW1lbXNldChjcnlwLT5s
YXN0X2N0ciwgMCwgc2l6ZW9mKGNyeXAtPmxhc3RfY3RyKSk7CisKKwl9IGVsc2UgaWYgKGNyeXAt
PmRtYV9tb2RlID09IERNQV9ORUVEX1NHX1RSVU5DKSB7CisJCWludCByZXQ7CisKKwkJY3J5cC0+
ZmxhZ3MgfD0gRkxHX0lOX09VVF9ETUE7CisKKwkJYWxpZ25fc2l6ZSA9IEFMSUdOX0RPV04oY3J5
cC0+cGF5bG9hZF9pbiwgY3J5cC0+aHdfYmxvY2tzaXplKTsKKwkJcmV0ID0gc3RtMzJfY3J5cF90
cnVuY2F0ZV9zZygmY3J5cC0+aW5fc2csICZjcnlwLT5pbl9zZ19sZW4sIGluX3NnLCAwLCBhbGln
bl9zaXplKTsKKwkJaWYgKHJldCkKKwkJCXJldHVybiByZXQ7CisKKwkJcmV0ID0gc3RtMzJfY3J5
cF90cnVuY2F0ZV9zZygmY3J5cC0+b3V0X3NnLCAmY3J5cC0+b3V0X3NnX2xlbiwgb3V0X3NnLCAw
LAorCQkJCQkgICAgIGFsaWduX3NpemUpOworCQlpZiAocmV0KSB7CisJCQlrZnJlZShjcnlwLT5p
bl9zZyk7CisJCQlyZXR1cm4gcmV0OworCQl9CisJfSBlbHNlIHsKKwkJY3J5cC0+ZmxhZ3MgfD0g
RkxHX0lOX09VVF9ETUE7CisKKwkJY3J5cC0+aW5fc2cgPSBpbl9zZzsKKwkJY3J5cC0+b3V0X3Nn
ID0gb3V0X3NnOworCisJCWNyeXAtPmluX3NnX2xlbiA9IHNnX25lbnRzX2Zvcl9sZW4oY3J5cC0+
aW5fc2csIGNyeXAtPnBheWxvYWRfaW4pOworCQlpZiAoY3J5cC0+aW5fc2dfbGVuIDwgMCkKKwkJ
CXJldHVybiBjcnlwLT5pbl9zZ19sZW47CisKKwkJY3J5cC0+b3V0X3NnX2xlbiA9IHNnX25lbnRz
X2Zvcl9sZW4ob3V0X3NnLCBjcnlwLT5wYXlsb2FkX291dCk7CisJCWlmIChjcnlwLT5vdXRfc2df
bGVuIDwgMCkKKwkJCXJldHVybiBjcnlwLT5vdXRfc2dfbGVuOworCX0KKworCXJldHVybiAwOwor
fQorCitzdGF0aWMgaW50IHN0bTMyX2NyeXBfYWVhZF9wcmVwYXJlKHN0cnVjdCBzdG0zMl9jcnlw
ICpjcnlwLCBzdHJ1Y3Qgc2NhdHRlcmxpc3QgKmluX3NnLAorCQkJCSAgIHN0cnVjdCBzY2F0dGVy
bGlzdCAqb3V0X3NnKQoreworCXNpemVfdCBhbGlnbl9zaXplOworCW9mZl90IHNraXA7CisJaW50
IHJldCwgcmV0MjsKKworCWNyeXAtPmhlYWRlcl9zZyA9IE5VTEw7CisJY3J5cC0+aW5fc2cgPSBO
VUxMOworCWNyeXAtPm91dF9zZyA9IE5VTEw7CisKKwlpZiAoIWNyeXAtPmRtYV9sY2hfaW4gfHwg
IWNyeXAtPmRtYV9sY2hfb3V0KSB7CisJCWNyeXAtPmRtYV9tb2RlID0gTk9fRE1BOworCQljcnlw
LT5mbGFncyAmPSB+KEZMR19JTl9PVVRfRE1BIHwgRkxHX0hFQURFUl9ETUEpOworCisJCXJldHVy
biAwOworCX0KKworCS8qIENDTSBod19pbml0IG1heSBoYXZlIGFkdmFuY2VkIGluIGhlYWRlciAq
LworCXNraXAgPSBjcnlwLT5hcmVxLT5hc3NvY2xlbiAtIGNyeXAtPmhlYWRlcl9pbjsKKworCWFs
aWduX3NpemUgPSBBTElHTl9ET1dOKGNyeXAtPmhlYWRlcl9pbiwgY3J5cC0+aHdfYmxvY2tzaXpl
KTsKKwlyZXQgPSBzdG0zMl9jcnlwX3RydW5jYXRlX3NnKCZjcnlwLT5oZWFkZXJfc2csICZjcnlw
LT5oZWFkZXJfc2dfbGVuLCBpbl9zZywgc2tpcCwKKwkJCQkgICAgIGFsaWduX3NpemUpOworCWlm
IChyZXQpCisJCXJldHVybiByZXQ7CisKKwlyZXQgPSBzdG0zMl9jcnlwX2RtYV9jaGVja19zZyhj
cnlwLT5oZWFkZXJfc2csIGFsaWduX3NpemUsIEFFU19CTE9DS19TSVpFKTsKKwlpZiAocmV0ID09
IE5PX0RNQSkgeworCQkvKiBXZSBjYW5ub3QgRE1BIHRoZSBoZWFkZXIgKi8KKwkJa2ZyZWUoY3J5
cC0+aGVhZGVyX3NnKTsKKwkJY3J5cC0+aGVhZGVyX3NnID0gTlVMTDsKKworCQljcnlwLT5mbGFn
cyAmPSB+RkxHX0hFQURFUl9ETUE7CisJfSBlbHNlIHsKKwkJY3J5cC0+ZmxhZ3MgfD0gRkxHX0hF
QURFUl9ETUE7CisJfQorCisJLyogTm93IHNraXAgYWxsIGhlYWRlciB0byBiZSBhdCBwYXlsb2Fk
IHN0YXJ0ICovCisJc2tpcCA9IGNyeXAtPmFyZXEtPmFzc29jbGVuOworCWFsaWduX3NpemUgPSBB
TElHTl9ET1dOKGNyeXAtPnBheWxvYWRfaW4sIGNyeXAtPmh3X2Jsb2Nrc2l6ZSk7CisJcmV0ID0g
c3RtMzJfY3J5cF90cnVuY2F0ZV9zZygmY3J5cC0+aW5fc2csICZjcnlwLT5pbl9zZ19sZW4sIGlu
X3NnLCBza2lwLCBhbGlnbl9zaXplKTsKKwlpZiAocmV0KSB7CisJCWtmcmVlKGNyeXAtPmhlYWRl
cl9zZyk7CisJCXJldHVybiByZXQ7CisJfQorCisJLyogRm9yIG91dCBidWZmZXIgYWxpZ25fc2l6
ZSBpcyBzYW1lIGFzIGluIGJ1ZmZlciAqLworCXJldCA9IHN0bTMyX2NyeXBfdHJ1bmNhdGVfc2co
JmNyeXAtPm91dF9zZywgJmNyeXAtPm91dF9zZ19sZW4sIG91dF9zZywgc2tpcCwgYWxpZ25fc2l6
ZSk7CisJaWYgKHJldCkgeworCQlrZnJlZShjcnlwLT5oZWFkZXJfc2cpOworCQlrZnJlZShjcnlw
LT5pbl9zZyk7CisJCXJldHVybiByZXQ7CisJfQorCisJcmV0ID0gc3RtMzJfY3J5cF9kbWFfY2hl
Y2tfc2coY3J5cC0+aW5fc2csIGFsaWduX3NpemUsIEFFU19CTE9DS19TSVpFKTsKKwlyZXQyID0g
c3RtMzJfY3J5cF9kbWFfY2hlY2tfc2coY3J5cC0+b3V0X3NnLCBhbGlnbl9zaXplLCBBRVNfQkxP
Q0tfU0laRSk7CisJaWYgKHJldCA9PSBOT19ETUEgfHwgcmV0MiA9PSBOT19ETUEpIHsKKwkJa2Zy
ZWUoY3J5cC0+aW5fc2cpOworCQljcnlwLT5pbl9zZyA9IE5VTEw7CisKKwkJa2ZyZWUoY3J5cC0+
b3V0X3NnKTsKKwkJY3J5cC0+b3V0X3NnID0gTlVMTDsKKworCQljcnlwLT5mbGFncyAmPSB+RkxH
X0lOX09VVF9ETUE7CisJfSBlbHNlIHsKKwkJY3J5cC0+ZmxhZ3MgfD0gRkxHX0lOX09VVF9ETUE7
CisJfQorCisJcmV0dXJuIDA7Cit9CisKIHN0YXRpYyBpbnQgc3RtMzJfY3J5cF9wcmVwYXJlX3Jl
cShzdHJ1Y3Qgc2tjaXBoZXJfcmVxdWVzdCAqcmVxLAogCQkJCSAgc3RydWN0IGFlYWRfcmVxdWVz
dCAqYXJlcSkKIHsKIAlzdHJ1Y3Qgc3RtMzJfY3J5cF9jdHggKmN0eDsKIAlzdHJ1Y3Qgc3RtMzJf
Y3J5cCAqY3J5cDsKIAlzdHJ1Y3Qgc3RtMzJfY3J5cF9yZXFjdHggKnJjdHg7Ci0Jc3RydWN0IHNj
YXR0ZXJsaXN0ICppbl9zZzsKKwlzdHJ1Y3Qgc2NhdHRlcmxpc3QgKmluX3NnLCAqb3V0X3NnOwog
CWludCByZXQ7CiAKIAlpZiAoIXJlcSAmJiAhYXJlcSkKQEAgLTExNjksOCArMTY4MCw2IEBAIHN0
YXRpYyBpbnQgc3RtMzJfY3J5cF9wcmVwYXJlX3JlcShzdHJ1Y3Qgc2tjaXBoZXJfcmVxdWVzdCAq
cmVxLAogCXJjdHggPSByZXEgPyBza2NpcGhlcl9yZXF1ZXN0X2N0eChyZXEpIDogYWVhZF9yZXF1
ZXN0X2N0eChhcmVxKTsKIAlyY3R4LT5tb2RlICY9IEZMR19NT0RFX01BU0s7CiAKLQljdHgtPmNy
eXAgPSBjcnlwOwotCiAJY3J5cC0+ZmxhZ3MgPSAoY3J5cC0+ZmxhZ3MgJiB+RkxHX01PREVfTUFT
SykgfCByY3R4LT5tb2RlOwogCWNyeXAtPmh3X2Jsb2Nrc2l6ZSA9IGlzX2FlcyhjcnlwKSA/IEFF
U19CTE9DS19TSVpFIDogREVTX0JMT0NLX1NJWkU7CiAJY3J5cC0+Y3R4ID0gY3R4OwpAQCAtMTE4
Miw2ICsxNjkxLDE1IEBAIHN0YXRpYyBpbnQgc3RtMzJfY3J5cF9wcmVwYXJlX3JlcShzdHJ1Y3Qg
c2tjaXBoZXJfcmVxdWVzdCAqcmVxLAogCQljcnlwLT5wYXlsb2FkX2luID0gcmVxLT5jcnlwdGxl
bjsKIAkJY3J5cC0+cGF5bG9hZF9vdXQgPSByZXEtPmNyeXB0bGVuOwogCQljcnlwLT5hdXRoc2l6
ZSA9IDA7CisKKwkJaW5fc2cgPSByZXEtPnNyYzsKKwkJb3V0X3NnID0gcmVxLT5kc3Q7CisKKwkJ
cmV0ID0gc3RtMzJfY3J5cF9jaXBoZXJfcHJlcGFyZShjcnlwLCBpbl9zZywgb3V0X3NnKTsKKwkJ
aWYgKHJldCkKKwkJCXJldHVybiByZXQ7CisKKwkJcmV0ID0gc3RtMzJfY3J5cF9od19pbml0KGNy
eXApOwogCX0gZWxzZSB7CiAJCS8qCiAJCSAqIExlbmd0aCBvZiBpbnB1dCBhbmQgb3V0cHV0IGRh
dGE6CkBAIC0xMjExLDIzICsxNzI5LDIyIEBAIHN0YXRpYyBpbnQgc3RtMzJfY3J5cF9wcmVwYXJl
X3JlcShzdHJ1Y3Qgc2tjaXBoZXJfcmVxdWVzdCAqcmVxLAogCQkJY3J5cC0+aGVhZGVyX2luID0g
YXJlcS0+YXNzb2NsZW47CiAJCQljcnlwLT5wYXlsb2FkX291dCA9IGNyeXAtPnBheWxvYWRfaW47
CiAJCX0KLQl9Ci0KLQlpbl9zZyA9IHJlcSA/IHJlcS0+c3JjIDogYXJlcS0+c3JjOwotCXNjYXR0
ZXJ3YWxrX3N0YXJ0KCZjcnlwLT5pbl93YWxrLCBpbl9zZyk7CiAKLQljcnlwLT5vdXRfc2cgPSBy
ZXEgPyByZXEtPmRzdCA6IGFyZXEtPmRzdDsKLQlzY2F0dGVyd2Fsa19zdGFydCgmY3J5cC0+b3V0
X3dhbGssIGNyeXAtPm91dF9zZyk7CisJCWluX3NnID0gYXJlcS0+c3JjOworCQlvdXRfc2cgPSBh
cmVxLT5kc3Q7CiAKLQlpZiAoaXNfZ2NtKGNyeXApIHx8IGlzX2NjbShjcnlwKSkgeworCQlzY2F0
dGVyd2Fsa19zdGFydCgmY3J5cC0+aW5fd2FsaywgaW5fc2cpOworCQlzY2F0dGVyd2Fsa19zdGFy
dCgmY3J5cC0+b3V0X3dhbGssIG91dF9zZyk7CiAJCS8qIEluIG91dHB1dCwganVtcCBhZnRlciBh
c3NvYyBkYXRhICovCiAJCXNjYXR0ZXJ3YWxrX2NvcHljaHVua3MoTlVMTCwgJmNyeXAtPm91dF93
YWxrLCBjcnlwLT5hcmVxLT5hc3NvY2xlbiwgMik7Ci0JfQogCi0JaWYgKGlzX2N0cihjcnlwKSkK
LQkJbWVtc2V0KGNyeXAtPmxhc3RfY3RyLCAwLCBzaXplb2YoY3J5cC0+bGFzdF9jdHIpKTsKKwkJ
cmV0ID0gc3RtMzJfY3J5cF9od19pbml0KGNyeXApOworCQlpZiAocmV0KQorCQkJcmV0dXJuIHJl
dDsKKworCQlyZXQgPSBzdG0zMl9jcnlwX2FlYWRfcHJlcGFyZShjcnlwLCBpbl9zZywgb3V0X3Nn
KTsKKwl9CiAKLQlyZXQgPSBzdG0zMl9jcnlwX2h3X2luaXQoY3J5cCk7CiAJcmV0dXJuIHJldDsK
IH0KIApAQCAtMTIzOSwxMiArMTc1NiwzNSBAQCBzdGF0aWMgaW50IHN0bTMyX2NyeXBfY2lwaGVy
X29uZV9yZXEoc3RydWN0IGNyeXB0b19lbmdpbmUgKmVuZ2luZSwgdm9pZCAqYXJlcSkKIAlzdHJ1
Y3Qgc3RtMzJfY3J5cF9jdHggKmN0eCA9IGNyeXB0b19za2NpcGhlcl9jdHgoCiAJCQljcnlwdG9f
c2tjaXBoZXJfcmVxdGZtKHJlcSkpOwogCXN0cnVjdCBzdG0zMl9jcnlwICpjcnlwID0gY3R4LT5j
cnlwOworCWludCByZXQ7CiAKIAlpZiAoIWNyeXApCiAJCXJldHVybiAtRU5PREVWOwogCi0JcmV0
dXJuIHN0bTMyX2NyeXBfcHJlcGFyZV9yZXEocmVxLCBOVUxMKSA/OgotCSAgICAgICBzdG0zMl9j
cnlwX2NwdV9zdGFydChjcnlwKTsKKwlyZXQgPSBzdG0zMl9jcnlwX3ByZXBhcmVfcmVxKHJlcSwg
TlVMTCk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCS8qIEF2b2lkIHRvIHVzZSBETUEg
aWYgcGVyaXBoZXJhbCAzMiBiaXQgY291bnRlciBpcyBhYm91dCB0byBvdmVyZmxvdyB3aXRoIGN0
cihhZXMpICovCisJaWYgKGlzX2FlcyhjcnlwKSAmJiBpc19jdHIoY3J5cCkpIHsKKwkJdTMyIGl2
X292ZXJmbG93WzRdOworCisJCW1lbWNweShpdl9vdmVyZmxvdywgcmVxLT5pdiwgc2l6ZW9mKF9f
YmUzMikgKiA0KTsKKwkJaXZfb3ZlcmZsb3dbM10gPSAweGZmZmZmZmZmIC0gYmUzMl90b19jcHUo
KF9fYmUzMilpdl9vdmVyZmxvd1szXSk7CisKKwkJaWYgKHJlcS0+c3JjLT5sZW5ndGggPiBpdl9v
dmVyZmxvd1szXSkKKwkJCWNyeXAtPmZsYWdzICY9IH5GTEdfSU5fT1VUX0RNQTsKKwl9CisKKwlp
ZiAoY3J5cC0+ZmxhZ3MgJiBGTEdfSU5fT1VUX0RNQSkKKwkJcmV0ID0gc3RtMzJfY3J5cF9kbWFf
c3RhcnQoY3J5cCk7CisJZWxzZQorCQlyZXQgPSBzdG0zMl9jcnlwX2l0X3N0YXJ0KGNyeXApOwor
CisJaWYgKHJldCA9PSAtRVRJTUVET1VUKQorCQlzdG0zMl9jcnlwX2ZpbmlzaF9yZXEoY3J5cCwg
cmV0KTsKKworCXJldHVybiByZXQ7CiB9CiAKIHN0YXRpYyBpbnQgc3RtMzJfY3J5cF9hZWFkX29u
ZV9yZXEoc3RydWN0IGNyeXB0b19lbmdpbmUgKmVuZ2luZSwgdm9pZCAqYXJlcSkKQEAgLTEyNjIs
MTMgKzE4MDIsMjAgQEAgc3RhdGljIGludCBzdG0zMl9jcnlwX2FlYWRfb25lX3JlcShzdHJ1Y3Qg
Y3J5cHRvX2VuZ2luZSAqZW5naW5lLCB2b2lkICphcmVxKQogCWlmIChlcnIpCiAJCXJldHVybiBl
cnI7CiAKLQlpZiAodW5saWtlbHkoIWNyeXAtPnBheWxvYWRfaW4gJiYgIWNyeXAtPmhlYWRlcl9p
bikpIHsKKwlpZiAoIXN0bTMyX2NyeXBfZ2V0X2lucHV0X3RleHRfbGVuKGNyeXApICYmICFjcnlw
LT5oZWFkZXJfaW4gJiYKKwkgICAgIShjcnlwLT5mbGFncyAmIEZMR19IRUFERVJfRE1BKSkgewog
CQkvKiBObyBpbnB1dCBkYXRhIHRvIHByb2Nlc3M6IGdldCB0YWcgYW5kIGZpbmlzaCAqLwogCQlz
dG0zMl9jcnlwX2ZpbmlzaF9yZXEoY3J5cCwgMCk7CiAJCXJldHVybiAwOwogCX0KIAotCXJldHVy
biBzdG0zMl9jcnlwX2NwdV9zdGFydChjcnlwKTsKKwlpZiAoY3J5cC0+ZmxhZ3MgJiBGTEdfSEVB
REVSX0RNQSkKKwkJcmV0dXJuIHN0bTMyX2NyeXBfaGVhZGVyX2RtYV9zdGFydChjcnlwKTsKKwor
CWlmICghY3J5cC0+aGVhZGVyX2luICYmIGNyeXAtPmZsYWdzICYgRkxHX0lOX09VVF9ETUEpCisJ
CXJldHVybiBzdG0zMl9jcnlwX2RtYV9zdGFydChjcnlwKTsKKworCXJldHVybiBzdG0zMl9jcnlw
X2l0X3N0YXJ0KGNyeXApOwogfQogCiBzdGF0aWMgaW50IHN0bTMyX2NyeXBfcmVhZF9hdXRoX3Rh
ZyhzdHJ1Y3Qgc3RtMzJfY3J5cCAqY3J5cCkKQEAgLTE2ODAsNiArMjIyNyw2NSBAQCBzdGF0aWMg
aXJxcmV0dXJuX3Qgc3RtMzJfY3J5cF9pcnEoaW50IGlycSwgdm9pZCAqYXJnKQogCXJldHVybiBJ
UlFfV0FLRV9USFJFQUQ7CiB9CiAKK3N0YXRpYyBpbnQgc3RtMzJfY3J5cF9kbWFfaW5pdChzdHJ1
Y3Qgc3RtMzJfY3J5cCAqY3J5cCkKK3sKKwlzdHJ1Y3QgZG1hX3NsYXZlX2NvbmZpZyBkbWFfY29u
ZjsKKwlzdHJ1Y3QgZG1hX2NoYW4gKmNoYW47CisJaW50IHJldDsKKworCW1lbXNldCgmZG1hX2Nv
bmYsIDAsIHNpemVvZihkbWFfY29uZikpOworCisJZG1hX2NvbmYuZGlyZWN0aW9uID0gRE1BX01F
TV9UT19ERVY7CisJZG1hX2NvbmYuZHN0X2FkZHIgPSBjcnlwLT5waHlzX2Jhc2UgKyBjcnlwLT5j
YXBzLT5kaW47CisJZG1hX2NvbmYuZHN0X2FkZHJfd2lkdGggPSBETUFfU0xBVkVfQlVTV0lEVEhf
NF9CWVRFUzsKKwlkbWFfY29uZi5kc3RfbWF4YnVyc3QgPSBDUllQX0RNQV9CVVJTVF9SRUc7CisJ
ZG1hX2NvbmYuZGV2aWNlX2ZjID0gZmFsc2U7CisKKwljaGFuID0gZG1hX3JlcXVlc3RfY2hhbihj
cnlwLT5kZXYsICJpbiIpOworCWlmIChJU19FUlIoY2hhbikpCisJCXJldHVybiBQVFJfRVJSKGNo
YW4pOworCisJY3J5cC0+ZG1hX2xjaF9pbiA9IGNoYW47CisJcmV0ID0gZG1hZW5naW5lX3NsYXZl
X2NvbmZpZyhjcnlwLT5kbWFfbGNoX2luLCAmZG1hX2NvbmYpOworCWlmIChyZXQpIHsKKwkJZG1h
X3JlbGVhc2VfY2hhbm5lbChjcnlwLT5kbWFfbGNoX2luKTsKKwkJY3J5cC0+ZG1hX2xjaF9pbiA9
IE5VTEw7CisJCWRldl9lcnIoY3J5cC0+ZGV2LCAiQ291bGRuJ3QgY29uZmlndXJlIERNQSBpbiBz
bGF2ZS5cbiIpOworCQlyZXR1cm4gcmV0OworCX0KKworCW1lbXNldCgmZG1hX2NvbmYsIDAsIHNp
emVvZihkbWFfY29uZikpOworCisJZG1hX2NvbmYuZGlyZWN0aW9uID0gRE1BX0RFVl9UT19NRU07
CisJZG1hX2NvbmYuc3JjX2FkZHIgPSBjcnlwLT5waHlzX2Jhc2UgKyBjcnlwLT5jYXBzLT5kb3V0
OworCWRtYV9jb25mLnNyY19hZGRyX3dpZHRoID0gRE1BX1NMQVZFX0JVU1dJRFRIXzRfQllURVM7
CisJZG1hX2NvbmYuc3JjX21heGJ1cnN0ID0gQ1JZUF9ETUFfQlVSU1RfUkVHOworCWRtYV9jb25m
LmRldmljZV9mYyA9IGZhbHNlOworCisJY2hhbiA9IGRtYV9yZXF1ZXN0X2NoYW4oY3J5cC0+ZGV2
LCAib3V0Iik7CisJaWYgKElTX0VSUihjaGFuKSkgeworCQlkbWFfcmVsZWFzZV9jaGFubmVsKGNy
eXAtPmRtYV9sY2hfaW4pOworCQljcnlwLT5kbWFfbGNoX2luID0gTlVMTDsKKwkJcmV0dXJuIFBU
Ul9FUlIoY2hhbik7CisJfQorCisJY3J5cC0+ZG1hX2xjaF9vdXQgPSBjaGFuOworCisJcmV0ID0g
ZG1hZW5naW5lX3NsYXZlX2NvbmZpZyhjcnlwLT5kbWFfbGNoX291dCwgJmRtYV9jb25mKTsKKwlp
ZiAocmV0KSB7CisJCWRtYV9yZWxlYXNlX2NoYW5uZWwoY3J5cC0+ZG1hX2xjaF9vdXQpOworCQlj
cnlwLT5kbWFfbGNoX291dCA9IE5VTEw7CisJCWRldl9lcnIoY3J5cC0+ZGV2LCAiQ291bGRuJ3Qg
Y29uZmlndXJlIERNQSBvdXQgc2xhdmUuXG4iKTsKKwkJZG1hX3JlbGVhc2VfY2hhbm5lbChjcnlw
LT5kbWFfbGNoX2luKTsKKwkJY3J5cC0+ZG1hX2xjaF9pbiA9IE5VTEw7CisJCXJldHVybiByZXQ7
CisJfQorCisJaW5pdF9jb21wbGV0aW9uKCZjcnlwLT5kbWFfY29tcGxldGlvbik7CisKKwlyZXR1
cm4gMDsKK30KKwogc3RhdGljIHN0cnVjdCBza2NpcGhlcl9lbmdpbmVfYWxnIGNyeXB0b19hbGdz
W10gPSB7CiB7CiAJLmJhc2UgPSB7CkBAIC0xOTAxLDYgKzI1MDcsNyBAQCBzdGF0aWMgY29uc3Qg
c3RydWN0IHN0bTMyX2NyeXBfY2FwcyB1eDUwMF9kYXRhID0gewogCS5zciA9IFVYNTAwX0NSWVBf
U1IsCiAJLmRpbiA9IFVYNTAwX0NSWVBfRElOLAogCS5kb3V0ID0gVVg1MDBfQ1JZUF9ET1VULAor
CS5kbWFjciA9IFVYNTAwX0NSWVBfRE1BQ1IsCiAJLmltc2MgPSBVWDUwMF9DUllQX0lNU0MsCiAJ
Lm1pcyA9IFVYNTAwX0NSWVBfTUlTLAogCS5rMWwgPSBVWDUwMF9DUllQX0sxTCwKQEAgLTE5MjMs
NiArMjUzMCw3IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3Qgc3RtMzJfY3J5cF9jYXBzIGY3X2RhdGEg
PSB7CiAJLnNyID0gQ1JZUF9TUiwKIAkuZGluID0gQ1JZUF9ESU4sCiAJLmRvdXQgPSBDUllQX0RP
VVQsCisJLmRtYWNyID0gQ1JZUF9ETUFDUiwKIAkuaW1zYyA9IENSWVBfSU1TQ1IsCiAJLm1pcyA9
IENSWVBfTUlTUiwKIAkuazFsID0gQ1JZUF9LMUxSLApAQCAtMTk0NSw2ICsyNTUzLDcgQEAgc3Rh
dGljIGNvbnN0IHN0cnVjdCBzdG0zMl9jcnlwX2NhcHMgbXAxX2RhdGEgPSB7CiAJLnNyID0gQ1JZ
UF9TUiwKIAkuZGluID0gQ1JZUF9ESU4sCiAJLmRvdXQgPSBDUllQX0RPVVQsCisJLmRtYWNyID0g
Q1JZUF9ETUFDUiwKIAkuaW1zYyA9IENSWVBfSU1TQ1IsCiAJLm1pcyA9IENSWVBfTUlTUiwKIAku
azFsID0gQ1JZUF9LMUxSLApAQCAtMTk4NSw2ICsyNTk0LDggQEAgc3RhdGljIGludCBzdG0zMl9j
cnlwX3Byb2JlKHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYpCiAJaWYgKElTX0VSUihjcnlw
LT5yZWdzKSkKIAkJcmV0dXJuIFBUUl9FUlIoY3J5cC0+cmVncyk7CiAKKwljcnlwLT5waHlzX2Jh
c2UgPSBwbGF0Zm9ybV9nZXRfcmVzb3VyY2UocGRldiwgSU9SRVNPVVJDRV9NRU0sIDApLT5zdGFy
dDsKKwogCWlycSA9IHBsYXRmb3JtX2dldF9pcnEocGRldiwgMCk7CiAJaWYgKGlycSA8IDApCiAJ
CXJldHVybiBpcnE7CkBAIC0yMDMwLDYgKzI2NDEsMTcgQEAgc3RhdGljIGludCBzdG0zMl9jcnlw
X3Byb2JlKHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYpCiAKIAlwbGF0Zm9ybV9zZXRfZHJ2
ZGF0YShwZGV2LCBjcnlwKTsKIAorCXJldCA9IHN0bTMyX2NyeXBfZG1hX2luaXQoY3J5cCk7CisJ
c3dpdGNoIChyZXQpIHsKKwljYXNlIDA6CisJCWJyZWFrOworCWNhc2UgLUVOT0RFVjoKKwkJZGV2
X2RiZyhkZXYsICJETUEgbW9kZSBub3QgYXZhaWxhYmxlXG4iKTsKKwkJYnJlYWs7CisJZGVmYXVs
dDoKKwkJZ290byBlcnJfZG1hOworCX0KKwogCXNwaW5fbG9jaygmY3J5cF9saXN0LmxvY2spOwog
CWxpc3RfYWRkKCZjcnlwLT5saXN0LCAmY3J5cF9saXN0LmRldl9saXN0KTsKIAlzcGluX3VubG9j
aygmY3J5cF9saXN0LmxvY2spOwpAQCAtMjA3NSw2ICsyNjk3LDEyIEBAIHN0YXRpYyBpbnQgc3Rt
MzJfY3J5cF9wcm9iZShzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2KQogCXNwaW5fbG9jaygm
Y3J5cF9saXN0LmxvY2spOwogCWxpc3RfZGVsKCZjcnlwLT5saXN0KTsKIAlzcGluX3VubG9jaygm
Y3J5cF9saXN0LmxvY2spOworCisJaWYgKGNyeXAtPmRtYV9sY2hfaW4pCisJCWRtYV9yZWxlYXNl
X2NoYW5uZWwoY3J5cC0+ZG1hX2xjaF9pbik7CisJaWYgKGNyeXAtPmRtYV9sY2hfb3V0KQorCQlk
bWFfcmVsZWFzZV9jaGFubmVsKGNyeXAtPmRtYV9sY2hfb3V0KTsKK2Vycl9kbWE6CiBlcnJfcnN0
OgogCXBtX3J1bnRpbWVfZGlzYWJsZShkZXYpOwogCXBtX3J1bnRpbWVfcHV0X25vaWRsZShkZXYp
OwpAQCAtMjEwNiw2ICsyNzM0LDEyIEBAIHN0YXRpYyBpbnQgc3RtMzJfY3J5cF9yZW1vdmUoc3Ry
dWN0IHBsYXRmb3JtX2RldmljZSAqcGRldikKIAlsaXN0X2RlbCgmY3J5cC0+bGlzdCk7CiAJc3Bp
bl91bmxvY2soJmNyeXBfbGlzdC5sb2NrKTsKIAorCWlmIChjcnlwLT5kbWFfbGNoX2luKQorCQlk
bWFfcmVsZWFzZV9jaGFubmVsKGNyeXAtPmRtYV9sY2hfaW4pOworCisJaWYgKGNyeXAtPmRtYV9s
Y2hfb3V0KQorCQlkbWFfcmVsZWFzZV9jaGFubmVsKGNyeXAtPmRtYV9sY2hfb3V0KTsKKwogCXBt
X3J1bnRpbWVfZGlzYWJsZShjcnlwLT5kZXYpOwogCXBtX3J1bnRpbWVfcHV0X25vaWRsZShjcnlw
LT5kZXYpOwogCi0tIAoyLjI1LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fCkxpbnV4LXN0bTMyIG1haWxpbmcgbGlzdApMaW51eC1zdG0zMkBzdC1tZC1t
YWlsbWFuLnN0b3JtcmVwbHkuY29tCmh0dHBzOi8vc3QtbWQtbWFpbG1hbi5zdG9ybXJlcGx5LmNv
bS9tYWlsbWFuL2xpc3RpbmZvL2xpbnV4LXN0bTMyCg==
