Return-Path: <linux-stm32-bounces@st-md-mailman.stormreply.com>
X-Original-To: lists+linux-stm32@lfdr.de
Delivered-To: lists+linux-stm32@lfdr.de
Received: from stm-ict-prod-mailman-01.stormreply.prv (st-md-mailman.stormreply.com [52.209.6.89])
	by mail.lfdr.de (Postfix) with ESMTPS id DB68496F884
	for <lists+linux-stm32@lfdr.de>; Fri,  6 Sep 2024 17:43:43 +0200 (CEST)
Received: from ip-172-31-3-47.eu-west-1.compute.internal (localhost [127.0.0.1])
	by stm-ict-prod-mailman-01.stormreply.prv (Postfix) with ESMTP id A5DC2C78013;
	Fri,  6 Sep 2024 15:43:43 +0000 (UTC)
Received: from mail-lf1-f44.google.com (mail-lf1-f44.google.com
 [209.85.167.44])
 (using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits))
 (No client certificate requested)
 by stm-ict-prod-mailman-01.stormreply.prv (Postfix) with ESMTPS id AF432C6DD9A
 for <linux-stm32@st-md-mailman.stormreply.com>;
 Fri,  6 Sep 2024 15:43:42 +0000 (UTC)
Received: by mail-lf1-f44.google.com with SMTP id
 2adb3069b0e04-5365b71a6bdso647505e87.2
 for <linux-stm32@st-md-mailman.stormreply.com>;
 Fri, 06 Sep 2024 08:43:42 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=baylibre-com.20230601.gappssmtp.com; s=20230601; t=1725637422; x=1726242222;
 darn=st-md-mailman.stormreply.com; 
 h=content-transfer-encoding:mime-version:references:in-reply-to
 :message-id:date:subject:cc:to:from:from:to:cc:subject:date
 :message-id:reply-to;
 bh=b1/fFRUU+25P2GomCGo4aejnJlCaSeDAp9CiqbWjjZ0=;
 b=y7SYvfTfDeall+/Ku9PoBU6H8CjZtIMK4B6C6GJq3B5hLlfK8hNOgsugqlfcjc2giP
 cuHmY5GqipWpa5nKETvnLQaR+GZVgvYnXwigmLDThdTplS3SXz334p8qK4yuQbpbe2mx
 8BQBLSZt09Ly1EvSTsIaAIY8ohe79vq5T08cOvHl1rspfvZ0AI+pJToOjRp+SVqZZqG7
 SVOZKfl+o+ZldJB1zkF8FkI1lYvcN9YMlaXcpqZGjNp5mhIKPbprZGReWS/KXxQWEn+k
 2CO1O7D0SYlQnlA5qtgNaeuB7+o86rwA1yBqNs5+3iyW4C94Xh4UpPDsQrMieFgEa7Lp
 FjVQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20230601; t=1725637422; x=1726242222;
 h=content-transfer-encoding:mime-version:references:in-reply-to
 :message-id:date:subject:cc:to:from:x-gm-message-state:from:to:cc
 :subject:date:message-id:reply-to;
 bh=b1/fFRUU+25P2GomCGo4aejnJlCaSeDAp9CiqbWjjZ0=;
 b=DPy0HUbfvifunP9BTHOa4DPsmSTD3/vt2mz8bkT0Swbz88tIeLtRN0Z6gS7lyOGVWq
 kRU1vhYMwN9EIahKPnSFeFHxhsGGP6fR/DaZ815WrN3JCtB6qf14BdsvIWlLrRA7fBw4
 AUd7qjte9RWq8aG5cekwvFTXIYINmbNMbXzp2JrRONt4R3NFIMt3TVsAYdYP/UlGWfD4
 xl2s/aXBoXc5nvBXKbLCmvwDj/crcGscBlgDP2YC989XIai8sBrGCB0Rpn21NMXylQ68
 Tghoc5IfXEEcdD5SeNgVSbHbyLCZozowOz/P5sGQyu7hnUEysFBB8NN51/haKcVtE6GM
 STCg==
X-Forwarded-Encrypted: i=1;
 AJvYcCU9nbo1YExZZ6OnPB3CW066xtMNr5PMK1EB6qZpWdiWi0H2kNnPuMpOqfNM6vbclb4uGwzUQFn0SOqGDw==@st-md-mailman.stormreply.com
X-Gm-Message-State: AOJu0YyqxE7708umpak8JeMd14Wy5YXoVRdbrT/Tc+6i0QwjZIZae4+u
 uoQwZYeuNw+Dj/A3PZ4UxM1hD62M+uee6h7w/QE3ee3ixjZfwtQHWQdw71bRNWg=
X-Google-Smtp-Source: AGHT+IEwAVt42CAMOm8BCF4HC8kI7GzUDeUy8A/uu3iMdkjUIGLc8QqQZ1X1k4z1Sgde7M8wWU9o6w==
X-Received: by 2002:a05:6512:695:b0:52e:97b3:42a1 with SMTP id
 2adb3069b0e04-536587b2c9emr1691117e87.24.1725637421568; 
 Fri, 06 Sep 2024 08:43:41 -0700 (PDT)
Received: from localhost (p5dc68d3d.dip0.t-ipconnect.de. [93.198.141.61])
 by smtp.gmail.com with ESMTPSA id
 a640c23a62f3a-a8a6236d02bsm290304766b.109.2024.09.06.08.43.41
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Fri, 06 Sep 2024 08:43:41 -0700 (PDT)
From: =?UTF-8?q?Uwe=20Kleine-K=C3=B6nig?= <u.kleine-koenig@baylibre.com>
To: linux-pwm@vger.kernel.org
Date: Fri,  6 Sep 2024 17:43:03 +0200
Message-ID: <c0afe400b52825e23de3ebdcbaa4229d6b38eeda.1725635013.git.u.kleine-koenig@baylibre.com>
X-Mailer: git-send-email 2.45.2
In-Reply-To: <cover.1725635013.git.u.kleine-koenig@baylibre.com>
References: <cover.1725635013.git.u.kleine-koenig@baylibre.com>
MIME-Version: 1.0
X-Developer-Signature: v=1; a=openpgp-sha256; l=17361;
 i=u.kleine-koenig@baylibre.com; h=from:subject:message-id;
 bh=M3GFH5+5sqMhLRnzVwBU9uU06zrJi6x0NMb/5nwhXhs=;
 b=owEBbQGS/pANAwAKAY+A+1h9Ev5OAcsmYgBm2yMTRxY5BNOybIKKevzGCqF/qAogLap2GxIlY
 7joanKnrpuJATMEAAEKAB0WIQQ/gaxpOnoeWYmt/tOPgPtYfRL+TgUCZtsjEwAKCRCPgPtYfRL+
 Th3NB/4xaiywUcCfTnbZoyjRzbCHoucIb+TOU/Wijt2BWKqcje55sfKBWCJdNDIRxkquOKy91y+
 ZbgyYDaADqSAKWSPHg7xuW30++RxaIeBS9MtgGprGNTFecrGuxXioQ2Dy1j3u7eBh9Xhrr2Bbci
 z8ypuKvBxYLJoljBCPv44U3xevMGTt73OT3Do3hvX9hy5t6LQ5zKHtHWz+rvP1GCefFQG8zB8nU
 P8GcRuPnKn1o0S2R/DPRoAD77CHeC7NewSizz7+GqHrkaB0nJFxVTY19utkK4IiWDo56kCL17ci
 8n/bkNCwf/FgJfH2Gqp5Nrvt8pTOVYYw/IPJFx6g3vdnFPzQ
X-Developer-Key: i=u.kleine-koenig@baylibre.com; a=openpgp;
 fpr=0D2511F322BFAB1C1580266BE2DCDD9132669BD6
Cc: Kent Gibson <warthog618@gmail.com>,
 Maxime Coquelin <mcoquelin.stm32@gmail.com>,
 David Lechner <dlechner@baylibre.com>,
 linux-stm32@st-md-mailman.stormreply.com
Subject: [Linux-stm32] [PATCH v4 7/7] pwm: stm32: Implementation of the
	waveform callbacks
X-BeenThere: linux-stm32@st-md-mailman.stormreply.com
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: <linux-stm32.st-md-mailman.stormreply.com>
List-Unsubscribe: <https://st-md-mailman.stormreply.com/mailman/options/linux-stm32>, 
 <mailto:linux-stm32-request@st-md-mailman.stormreply.com?subject=unsubscribe>
List-Archive: <http://st-md-mailman.stormreply.com/pipermail/linux-stm32/>
List-Post: <mailto:linux-stm32@st-md-mailman.stormreply.com>
List-Help: <mailto:linux-stm32-request@st-md-mailman.stormreply.com?subject=help>
List-Subscribe: <https://st-md-mailman.stormreply.com/mailman/listinfo/linux-stm32>, 
 <mailto:linux-stm32-request@st-md-mailman.stormreply.com?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: linux-stm32-bounces@st-md-mailman.stormreply.com
Sender: "Linux-stm32" <linux-stm32-bounces@st-md-mailman.stormreply.com>

Q29udmVydCB0aGUgc3RtMzIgcHdtIGRyaXZlciB0byB1c2UgdGhlIG5ldyBjYWxsYmFja3MgZm9y
IGhhcmR3YXJlCnByb2dyYW1taW5nLgoKU2lnbmVkLW9mZi1ieTogVXdlIEtsZWluZS1Lw7ZuaWcg
PHUua2xlaW5lLWtvZW5pZ0BiYXlsaWJyZS5jb20+Ci0tLQogZHJpdmVycy9wd20vcHdtLXN0bTMy
LmMgfCA2MTIgKysrKysrKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0tLQogMSBmaWxl
IGNoYW5nZWQsIDM5MSBpbnNlcnRpb25zKCspLCAyMjEgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9wd20vcHdtLXN0bTMyLmMgYi9kcml2ZXJzL3B3bS9wd20tc3RtMzIuYwppbmRl
eCBmODVlYjQxY2IwODQuLjE2NmYwODA3MDZkYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9wd20vcHdt
LXN0bTMyLmMKKysrIGIvZHJpdmVycy9wd20vcHdtLXN0bTMyLmMKQEAgLTUxLDYgKzUxLDM5MSBA
QCBzdGF0aWMgdTMyIGFjdGl2ZV9jaGFubmVscyhzdHJ1Y3Qgc3RtMzJfcHdtICpkZXYpCiAJcmV0
dXJuIGNjZXIgJiBUSU1fQ0NFUl9DQ1hFOwogfQogCitzdHJ1Y3Qgc3RtMzJfcHdtX3dhdmVmb3Jt
IHsKKwl1MzIgY2NlcjsKKwl1MzIgcHNjOworCXUzMiBhcnI7CisJdTMyIGNjcjsKK307CisKK3N0
YXRpYyBpbnQgc3RtMzJfcHdtX3JvdW5kX3dhdmVmb3JtX3RvaHcoc3RydWN0IHB3bV9jaGlwICpj
aGlwLAorCQkJCQkgc3RydWN0IHB3bV9kZXZpY2UgKnB3bSwKKwkJCQkJIGNvbnN0IHN0cnVjdCBw
d21fd2F2ZWZvcm0gKndmLAorCQkJCQkgdm9pZCAqX3dmaHcpCit7CisJc3RydWN0IHN0bTMyX3B3
bV93YXZlZm9ybSAqd2ZodyA9IF93Zmh3OworCXN0cnVjdCBzdG0zMl9wd20gKnByaXYgPSB0b19z
dG0zMl9wd21fZGV2KGNoaXApOworCXVuc2lnbmVkIGludCBjaCA9IHB3bS0+aHdwd207CisJdW5z
aWduZWQgbG9uZyByYXRlOworCXU2NCBjY3IsIGR1dHk7CisJaW50IHJldDsKKworCWlmICh3Zi0+
cGVyaW9kX2xlbmd0aF9ucyA9PSAwKSB7CisJCSp3Zmh3ID0gKHN0cnVjdCBzdG0zMl9wd21fd2F2
ZWZvcm0peworCQkJLmNjZXIgPSAwLAorCQl9OworCisJCXJldHVybiAwOworCX0KKworCXJldCA9
IGNsa19lbmFibGUocHJpdi0+Y2xrKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJd2Zo
dy0+Y2NlciA9IFRJTV9DQ0VSX0NDeEUoY2ggKyAxKTsKKwlpZiAocHJpdi0+aGF2ZV9jb21wbGVt
ZW50YXJ5X291dHB1dCkKKwkJd2Zody0+Y2NlciA9IFRJTV9DQ0VSX0NDeE5FKGNoICsgMSk7CisK
KwlyYXRlID0gY2xrX2dldF9yYXRlKHByaXYtPmNsayk7CisKKwlpZiAoYWN0aXZlX2NoYW5uZWxz
KHByaXYpICYgfigxIDw8IGNoICogNCkpIHsKKwkJdTY0IGFycjsKKworCQkvKgorCQkgKiBPdGhl
ciBjaGFubmVscyBhcmUgYWxyZWFkeSBlbmFibGVkLCBzbyB0aGUgY29uZmlndXJlZCBQU0MgYW5k
CisJCSAqIEFSUiBtdXN0IGJlIHVzZWQgZm9yIHRoaXMgY2hhbm5lbCwgdG9vLgorCQkgKi8KKwkJ
cmV0ID0gcmVnbWFwX3JlYWQocHJpdi0+cmVnbWFwLCBUSU1fUFNDLCAmd2Zody0+cHNjKTsKKwkJ
aWYgKHJldCkKKwkJCWdvdG8gb3V0OworCisJCXJldCA9IHJlZ21hcF9yZWFkKHByaXYtPnJlZ21h
cCwgVElNX0FSUiwgJndmaHctPmFycik7CisJCWlmIChyZXQpCisJCQlnb3RvIG91dDsKKworCQkv
KgorCQkgKiBjYWxjdWxhdGUgdGhlIGJlc3QgdmFsdWUgZm9yIEFSUiBmb3IgdGhlIGdpdmVuIFBT
QywgcmVmdXNlIGlmCisJCSAqIHRoZSByZXN1bHRpbmcgcGVyaW9kIGdldHMgYmlnZ2VyIHRoYW4g
dGhlIHJlcXVlc3RlZCBvbmUuCisJCSAqLworCQlhcnIgPSBtdWxfdTY0X3U2NF9kaXZfdTY0KHdm
LT5wZXJpb2RfbGVuZ3RoX25zLCByYXRlLAorCQkJCQkgICh1NjQpTlNFQ19QRVJfU0VDICogKHdm
aHctPnBzYyArIDEpKTsKKwkJaWYgKGFyciA8PSB3Zmh3LT5hcnIpIHsKKwkJCS8qCisJCQkgKiBy
ZXF1ZXN0ZWQgcGVyaW9kIGlzIHNtYWxsIHRoYW4gdGhlIGN1cnJlbnRseQorCQkJICogY29uZmln
dXJlZCBhbmQgdW5jaGFuZ2FibGUgcGVyaW9kLCByZXBvcnQgYmFjayB0aGUgc21hbGxlc3QKKwkJ
CSAqIHBvc3NpYmxlIHBlcmlvZCwgaS5lLiB0aGUgY3VycmVudCBzdGF0ZTsgSW5pdGlhbGl6ZQor
CQkJICogY2NyIHRvIGFueXRoaW5nIHZhbGlkLgorCQkJICovCisJCQl3Zmh3LT5jY3IgPSAwOwor
CQkJcmV0ID0gMTsKKwkJCWdvdG8gb3V0OworCQl9CisKKwl9IGVsc2UgeworCQkvKgorCQkgKiAu
cHJvYmUoKSBhc3NlcnRlZCB0aGF0IGNsa19nZXRfcmF0ZSgpIGlzIG5vdCBiaWdnZXIgdGhhbiAx
IEdIeiwgc28KKwkJICogdGhlIGNhbGN1bGF0aW9ucyBoZXJlIHdvbid0IG92ZXJmbG93LgorCQkg
KiBGaXJzdCB3ZSBuZWVkIHRvIGZpbmQgdGhlIG1pbmltYWwgdmFsdWUgZm9yIHByZXNjYWxlciBz
dWNoIHRoYXQKKwkJICoKKwkJICogICAgICAgIHBlcmlvZF9ucyAqIGNsa3JhdGUKKwkJICogICAt
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gPCBtYXhfYXJyICsgMQorCQkgKiAgIE5TRUNf
UEVSX1NFQyAqIChwcmVzY2FsZXIgKyAxKQorCQkgKgorCQkgKiBUaGlzIGVxdWF0aW9uIGlzIGVx
dWl2YWxlbnQgdG8KKwkJICoKKwkJICogICAgICAgIHBlcmlvZF9ucyAqIGNsa3JhdGUKKwkJICog
ICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIDwgcHJlc2NhbGVyICsgMQorCQkgKiAgIE5T
RUNfUEVSX1NFQyAqIChtYXhfYXJyICsgMSkKKwkJICoKKwkJICogVXNpbmcgaW50ZWdlciBkaXZp
c2lvbiBhbmQga25vd2luZyB0aGF0IHRoZSByaWdodCBoYW5kIHNpZGUgaXMKKwkJICogaW50ZWdl
ciwgdGhpcyBpcyBmdXJ0aGVyIGVxdWl2YWxlbnQgdG8KKwkJICoKKwkJICogICAocGVyaW9kX25z
ICogY2xrcmF0ZSkgLy8gKE5TRUNfUEVSX1NFQyAqIChtYXhfYXJyICsgMSkpIOKJpCBwcmVzY2Fs
ZXIKKwkJICovCisJCXU2NCBwc2MgPSBtdWxfdTY0X3U2NF9kaXZfdTY0KHdmLT5wZXJpb2RfbGVu
Z3RoX25zLCByYXRlLAorCQkJCQkgICAgICAodTY0KU5TRUNfUEVSX1NFQyAqICgodTY0KXByaXYt
Pm1heF9hcnIgKyAxKSk7CisJCXU2NCBhcnI7CisKKwkJd2Zody0+cHNjID0gbWluX3QodTY0LCBw
c2MsIE1BWF9USU1fUFNDKTsKKworCQlhcnIgPSBtdWxfdTY0X3U2NF9kaXZfdTY0KHdmLT5wZXJp
b2RfbGVuZ3RoX25zLCByYXRlLAorCQkJCQkgICh1NjQpTlNFQ19QRVJfU0VDICogKHdmaHctPnBz
YyArIDEpKTsKKwkJaWYgKCFhcnIpIHsKKwkJCS8qCisJCQkgKiByZXF1ZXN0ZWQgcGVyaW9kIGlz
IHRvbyBzbWFsbCwgcmVwb3J0IGJhY2sgdGhlIHNtYWxsZXN0CisJCQkgKiBwb3NzaWJsZSBwZXJp
b2QsIGkuZS4gQVJSID0gMC4gVGhlIG9ubHkgdmFsaWQgQ0NSCisJCQkgKiB2YWx1ZSBpcyB0aGVu
IHplcm8sIHRvby4KKwkJCSAqLworCQkJd2Zody0+YXJyID0gMDsKKwkJCXdmaHctPmNjciA9IDA7
CisJCQlyZXQgPSAxOworCQkJZ290byBvdXQ7CisJCX0KKworCQkvKgorCQkgKiBBUlIgaXMgbGlt
aXRlZCBpbnRlbnRpb25hbGx5IHRvIHZhbHVlcyBsZXNzIHRoYW4KKwkJICogcHJpdi0+bWF4X2Fy
ciB0byBhbGxvdyAxMDAlIGR1dHkgY3ljbGUuCisJCSAqLworCQl3Zmh3LT5hcnIgPSBtaW5fdCh1
NjQsIGFyciwgcHJpdi0+bWF4X2FycikgLSAxOworCX0KKworCWR1dHkgPSBtdWxfdTY0X3U2NF9k
aXZfdTY0KHdmLT5kdXR5X2xlbmd0aF9ucywgcmF0ZSwKKwkJCQkgICAodTY0KU5TRUNfUEVSX1NF
QyAqICh3Zmh3LT5wc2MgKyAxKSk7CisJZHV0eSA9IG1pbl90KHU2NCwgZHV0eSwgd2Zody0+YXJy
ICsgMSk7CisKKwlpZiAod2YtPmR1dHlfbGVuZ3RoX25zICYmIHdmLT5kdXR5X29mZnNldF9ucyAm
JgorCSAgICB3Zi0+ZHV0eV9sZW5ndGhfbnMgKyB3Zi0+ZHV0eV9vZmZzZXRfbnMgPj0gd2YtPnBl
cmlvZF9sZW5ndGhfbnMpIHsKKwkJd2Zody0+Y2NlciB8PSBUSU1fQ0NFUl9DQ3hQKGNoICsgMSk7
CisJCWlmIChwcml2LT5oYXZlX2NvbXBsZW1lbnRhcnlfb3V0cHV0KQorCQkJd2Zody0+Y2NlciB8
PSBUSU1fQ0NFUl9DQ3hOUChjaCArIDEpOworCisJCWNjciA9IHdmaHctPmFyciArIDEgLSBkdXR5
OworCX0gZWxzZSB7CisJCWNjciA9IGR1dHk7CisJfQorCisJd2Zody0+Y2NyID0gbWluX3QodTY0
LCBjY3IsIHdmaHctPmFyciArIDEpOworCisJZGV2X2RiZygmY2hpcC0+ZGV2LCAicHdtIyV1OiAl
bGxkLyVsbGQgWyslbGxkXSBAJWx1IC0+IENDRVI6ICUwOHgsIFBTQzogJTA4eCwgQVJSOiAlMDh4
LCBDQ1I6ICUwOHhcbiIsCisJCXB3bS0+aHdwd20sIHdmLT5kdXR5X2xlbmd0aF9ucywgd2YtPnBl
cmlvZF9sZW5ndGhfbnMsIHdmLT5kdXR5X29mZnNldF9ucywKKwkJcmF0ZSwgd2Zody0+Y2Nlciwg
d2Zody0+cHNjLCB3Zmh3LT5hcnIsIHdmaHctPmNjcik7CisKK291dDoKKwljbGtfZGlzYWJsZShw
cml2LT5jbGspOworCisJcmV0dXJuIHJldDsKK30KKworLyoKKyAqIFRoaXMgc2hvdWxkIGJlIG1v
dmVkIHRvIGxpYi9tYXRoL2RpdjY0LmMuIEN1cnJlbnRseSB0aGVyZSBhcmUgc29tZSBjaGFuZ2Vz
CisgKiBwZW5kaW5nIHRvIG11bF91NjRfdTY0X2Rpdl91NjQuIFV3ZSB3aWxsIGNhcmUgZm9yIHRo
YXQgd2hlbiB0aGUgZHVzdCBzZXR0bGVzLgorICovCitzdGF0aWMgdTY0IHN0bTMyX3B3bV9tdWxf
dTY0X3U2NF9kaXZfdTY0X3JvdW5kdXAodTY0IGEsIHU2NCBiLCB1NjQgYykKK3sKKwl1NjQgcmVz
ID0gbXVsX3U2NF91NjRfZGl2X3U2NChhLCBiLCBjKTsKKwkvKiBUaG9zZSBtdWx0aXBsaWNhdGlv
bnMgbWlnaHQgb3ZlcmZsb3cgYnV0IGl0IGRvZXNuJ3QgbWF0dGVyICovCisJdTY0IHJlbSA9IGEg
KiBiIC0gYyAqIHJlczsKKworCWlmIChyZW0pCisJCXJlcyArPSAxOworCisJcmV0dXJuIHJlczsK
K30KKworc3RhdGljIGludCBzdG0zMl9wd21fcm91bmRfd2F2ZWZvcm1fZnJvbWh3KHN0cnVjdCBw
d21fY2hpcCAqY2hpcCwKKwkJCQkJICAgc3RydWN0IHB3bV9kZXZpY2UgKnB3bSwKKwkJCQkJICAg
Y29uc3Qgdm9pZCAqX3dmaHcsCisJCQkJCSAgIHN0cnVjdCBwd21fd2F2ZWZvcm0gKndmKQorewor
CWNvbnN0IHN0cnVjdCBzdG0zMl9wd21fd2F2ZWZvcm0gKndmaHcgPSBfd2ZodzsKKwlzdHJ1Y3Qg
c3RtMzJfcHdtICpwcml2ID0gdG9fc3RtMzJfcHdtX2RldihjaGlwKTsKKwl1bnNpZ25lZCBpbnQg
Y2ggPSBwd20tPmh3cHdtOworCisJaWYgKHdmaHctPmNjZXIgJiBUSU1fQ0NFUl9DQ3hFKGNoICsg
MSkpIHsKKwkJdW5zaWduZWQgbG9uZyByYXRlID0gY2xrX2dldF9yYXRlKHByaXYtPmNsayk7CisJ
CXU2NCBjY3JfbnM7CisKKwkJLyogVGhlIHJlc3VsdCBkb2Vzbid0IG92ZXJmbG93IGZvciByYXRl
ID49IDE1MjU5ICovCisJCXdmLT5wZXJpb2RfbGVuZ3RoX25zID0gc3RtMzJfcHdtX211bF91NjRf
dTY0X2Rpdl91NjRfcm91bmR1cCgoKHU2NCl3Zmh3LT5wc2MgKyAxKSAqICh3Zmh3LT5hcnIgKyAx
KSwKKwkJCQkJCQkJCSAgICAgTlNFQ19QRVJfU0VDLCByYXRlKTsKKworCQljY3JfbnMgPSBzdG0z
Ml9wd21fbXVsX3U2NF91NjRfZGl2X3U2NF9yb3VuZHVwKCgodTY0KXdmaHctPnBzYyArIDEpICog
d2Zody0+Y2NyLAorCQkJCQkJCSAgICAgICBOU0VDX1BFUl9TRUMsIHJhdGUpOworCisJCWlmICh3
Zmh3LT5jY2VyICYgVElNX0NDRVJfQ0N4UChjaCArIDEpKSB7CisJCQl3Zi0+ZHV0eV9sZW5ndGhf
bnMgPQorCQkJCXN0bTMyX3B3bV9tdWxfdTY0X3U2NF9kaXZfdTY0X3JvdW5kdXAoKCh1NjQpd2Zo
dy0+cHNjICsgMSkgKiAod2Zody0+YXJyICsgMSAtIHdmaHctPmNjciksCisJCQkJCQkJCSAgICAg
IE5TRUNfUEVSX1NFQywgcmF0ZSk7CisKKwkJCXdmLT5kdXR5X29mZnNldF9ucyA9IGNjcl9uczsK
KwkJfSBlbHNlIHsKKwkJCXdmLT5kdXR5X2xlbmd0aF9ucyA9IGNjcl9uczsKKwkJCXdmLT5kdXR5
X29mZnNldF9ucyA9IDA7CisJCX0KKworCQlkZXZfZGJnKCZjaGlwLT5kZXYsICJwd20jJXU6IEND
RVI6ICUwOHgsIFBTQzogJTA4eCwgQVJSOiAlMDh4LCBDQ1I6ICUwOHggQCVsdSAtPiAlbGxkLyVs
bGQgWyslbGxkXVxuIiwKKwkJCXB3bS0+aHdwd20sIHdmaHctPmNjZXIsIHdmaHctPnBzYywgd2Zo
dy0+YXJyLCB3Zmh3LT5jY3IsIHJhdGUsCisJCQl3Zi0+ZHV0eV9sZW5ndGhfbnMsIHdmLT5wZXJp
b2RfbGVuZ3RoX25zLCB3Zi0+ZHV0eV9vZmZzZXRfbnMpOworCisJfSBlbHNlIHsKKwkJKndmID0g
KHN0cnVjdCBwd21fd2F2ZWZvcm0peworCQkJLnBlcmlvZF9sZW5ndGhfbnMgPSAwLAorCQl9Owor
CX0KKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IHN0bTMyX3B3bV9yZWFkX3dhdmVmb3Jt
KHN0cnVjdCBwd21fY2hpcCAqY2hpcCwKKwkJCQkgICAgIHN0cnVjdCBwd21fZGV2aWNlICpwd20s
CisJCQkJICAgICB2b2lkICpfd2ZodykKK3sKKwlzdHJ1Y3Qgc3RtMzJfcHdtX3dhdmVmb3JtICp3
Zmh3ID0gX3dmaHc7CisJc3RydWN0IHN0bTMyX3B3bSAqcHJpdiA9IHRvX3N0bTMyX3B3bV9kZXYo
Y2hpcCk7CisJdW5zaWduZWQgaW50IGNoID0gcHdtLT5od3B3bTsKKwlpbnQgcmV0OworCisJcmV0
ID0gY2xrX2VuYWJsZShwcml2LT5jbGspOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwly
ZXQgPSByZWdtYXBfcmVhZChwcml2LT5yZWdtYXAsIFRJTV9DQ0VSLCAmd2Zody0+Y2Nlcik7CisJ
aWYgKHJldCkKKwkJZ290byBvdXQ7CisKKwlpZiAod2Zody0+Y2NlciAmIFRJTV9DQ0VSX0NDeEUo
Y2ggKyAxKSkgeworCQlyZXQgPSByZWdtYXBfcmVhZChwcml2LT5yZWdtYXAsIFRJTV9QU0MsICZ3
Zmh3LT5wc2MpOworCQlpZiAocmV0KQorCQkJZ290byBvdXQ7CisKKwkJcmV0ID0gcmVnbWFwX3Jl
YWQocHJpdi0+cmVnbWFwLCBUSU1fQVJSLCAmd2Zody0+YXJyKTsKKwkJaWYgKHJldCkKKwkJCWdv
dG8gb3V0OworCisJCWlmICh3Zmh3LT5hcnIgPT0gVTMyX01BWCkKKwkJCXdmaHctPmFyciAtPSAx
OworCisJCXJldCA9IHJlZ21hcF9yZWFkKHByaXYtPnJlZ21hcCwgVElNX0NDUngoY2ggKyAxKSwg
JndmaHctPmNjcik7CisJCWlmIChyZXQpCisJCQlnb3RvIG91dDsKKworCQlpZiAod2Zody0+Y2Ny
ID4gd2Zody0+YXJyICsgMSkKKwkJCXdmaHctPmNjciA9IHdmaHctPmFyciArIDE7CisJfQorCitv
dXQ6CisJY2xrX2Rpc2FibGUocHJpdi0+Y2xrKTsKKworCXJldHVybiByZXQ7Cit9CisKK3N0YXRp
YyBpbnQgc3RtMzJfcHdtX3dyaXRlX3dhdmVmb3JtKHN0cnVjdCBwd21fY2hpcCAqY2hpcCwKKwkJ
CQkgICAgICBzdHJ1Y3QgcHdtX2RldmljZSAqcHdtLAorCQkJCSAgICAgIGNvbnN0IHZvaWQgKl93
Zmh3KQoreworCWNvbnN0IHN0cnVjdCBzdG0zMl9wd21fd2F2ZWZvcm0gKndmaHcgPSBfd2ZodzsK
KwlzdHJ1Y3Qgc3RtMzJfcHdtICpwcml2ID0gdG9fc3RtMzJfcHdtX2RldihjaGlwKTsKKwl1bnNp
Z25lZCBpbnQgY2ggPSBwd20tPmh3cHdtOworCWludCByZXQ7CisKKwlyZXQgPSBjbGtfZW5hYmxl
KHByaXYtPmNsayk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCWlmICh3Zmh3LT5jY2Vy
ICYgVElNX0NDRVJfQ0N4RShjaCArIDEpKSB7CisJCXUzMiBjY2VyLCBtYXNrOworCQl1bnNpZ25l
ZCBpbnQgc2hpZnQ7CisJCXUzMiBjY21yOworCisJCXJldCA9IHJlZ21hcF9yZWFkKHByaXYtPnJl
Z21hcCwgVElNX0NDRVIsICZjY2VyKTsKKwkJaWYgKHJldCkKKwkJCWdvdG8gb3V0OworCisJCS8q
IElmIHRoZXJlIGFyZSBvdGhlciBjaGFubmVscyBlbmFibGVkLCBkb24ndCB1cGRhdGUgUFNDIGFu
ZCBBUlIgKi8KKwkJaWYgKGNjZXIgJiB+VElNX0NDRVJfQ0N4RShjaCArIDEpICYgVElNX0NDRVJf
Q0NYRSkgeworCQkJdTMyIHBzYywgYXJyOworCisJCQlyZXQgPSByZWdtYXBfcmVhZChwcml2LT5y
ZWdtYXAsIFRJTV9QU0MsICZwc2MpOworCQkJaWYgKHJldCkKKwkJCQlnb3RvIG91dDsKKworCQkJ
aWYgKHBzYyAhPSB3Zmh3LT5wc2MpIHsKKwkJCQlyZXQgPSAtRUJVU1k7CisJCQkJZ290byBvdXQ7
CisJCQl9CisKKwkJCXJlZ21hcF9yZWFkKHByaXYtPnJlZ21hcCwgVElNX0FSUiwgJmFycik7CisJ
CQlpZiAocmV0KQorCQkJCWdvdG8gb3V0OworCisJCQlpZiAoYXJyICE9IHdmaHctPmFycikgewor
CQkJCXJldCA9IC1FQlVTWTsKKwkJCQlnb3RvIG91dDsKKwkJCX0KKwkJfSBlbHNlIHsKKwkJCXJl
dCA9IHJlZ21hcF93cml0ZShwcml2LT5yZWdtYXAsIFRJTV9QU0MsIHdmaHctPnBzYyk7CisJCQlp
ZiAocmV0KQorCQkJCWdvdG8gb3V0OworCisJCQlyZXQgPSByZWdtYXBfd3JpdGUocHJpdi0+cmVn
bWFwLCBUSU1fQVJSLCB3Zmh3LT5hcnIpOworCQkJaWYgKHJldCkKKwkJCQlnb3RvIG91dDsKKwor
CQkJcmV0ID0gcmVnbWFwX3NldF9iaXRzKHByaXYtPnJlZ21hcCwgVElNX0NSMSwgVElNX0NSMV9B
UlBFKTsKKwkJCWlmIChyZXQpCisJCQkJZ290byBvdXQ7CisKKwkJfQorCisJCS8qIHNldCBwb2xh
cml0eSAqLworCQltYXNrID0gVElNX0NDRVJfQ0N4UChjaCArIDEpIHwgVElNX0NDRVJfQ0N4TlAo
Y2ggKyAxKTsKKwkJcmV0ID0gcmVnbWFwX3VwZGF0ZV9iaXRzKHByaXYtPnJlZ21hcCwgVElNX0ND
RVIsIG1hc2ssIHdmaHctPmNjZXIpOworCQlpZiAocmV0KQorCQkJZ290byBvdXQ7CisKKwkJcmV0
ID0gcmVnbWFwX3dyaXRlKHByaXYtPnJlZ21hcCwgVElNX0NDUngoY2ggKyAxKSwgd2Zody0+Y2Ny
KTsKKwkJaWYgKHJldCkKKwkJCWdvdG8gb3V0OworCisJCS8qIENvbmZpZ3VyZSBvdXRwdXQgbW9k
ZSAqLworCQlzaGlmdCA9IChjaCAmIDB4MSkgKiBDQ01SX0NIQU5ORUxfU0hJRlQ7CisJCWNjbXIg
PSAoVElNX0NDTVJfUEUgfCBUSU1fQ0NNUl9NMSkgPDwgc2hpZnQ7CisJCW1hc2sgPSBDQ01SX0NI
QU5ORUxfTUFTSyA8PCBzaGlmdDsKKworCQlpZiAoY2ggPCAyKQorCQkJcmV0ID0gcmVnbWFwX3Vw
ZGF0ZV9iaXRzKHByaXYtPnJlZ21hcCwgVElNX0NDTVIxLCBtYXNrLCBjY21yKTsKKwkJZWxzZQor
CQkJcmV0ID0gcmVnbWFwX3VwZGF0ZV9iaXRzKHByaXYtPnJlZ21hcCwgVElNX0NDTVIyLCBtYXNr
LCBjY21yKTsKKwkJaWYgKHJldCkKKwkJCWdvdG8gb3V0OworCisJCXJldCA9IHJlZ21hcF9zZXRf
Yml0cyhwcml2LT5yZWdtYXAsIFRJTV9CRFRSLCBUSU1fQkRUUl9NT0UpOworCQlpZiAocmV0KQor
CQkJZ290byBvdXQ7CisKKwkJaWYgKCEoY2NlciAmIFRJTV9DQ0VSX0NDeEUoY2ggKyAxKSkpIHsK
KwkJCW1hc2sgPSBUSU1fQ0NFUl9DQ3hFKGNoICsgMSkgfCBUSU1fQ0NFUl9DQ3hORShjaCArIDEp
OworCisJCQlyZXQgPSBjbGtfZW5hYmxlKHByaXYtPmNsayk7CisJCQlpZiAocmV0KQorCQkJCWdv
dG8gb3V0OworCisJCQljY2VyID0gKGNjZXIgJiB+bWFzaykgfCAod2Zody0+Y2NlciAmIG1hc2sp
OworCQkJcmVnbWFwX3dyaXRlKHByaXYtPnJlZ21hcCwgVElNX0NDRVIsIGNjZXIpOworCisJCQkv
KiBNYWtlIHN1cmUgdGhhdCByZWdpc3RlcnMgYXJlIHVwZGF0ZWQgKi8KKwkJCXJlZ21hcF9zZXRf
Yml0cyhwcml2LT5yZWdtYXAsIFRJTV9FR1IsIFRJTV9FR1JfVUcpOworCisJCQkvKiBFbmFibGUg
Y29udHJvbGxlciAqLworCQkJcmVnbWFwX3NldF9iaXRzKHByaXYtPnJlZ21hcCwgVElNX0NSMSwg
VElNX0NSMV9DRU4pOworCQl9CisKKwl9IGVsc2UgeworCQkvKiBkaXNhYmxlIGNoYW5uZWwgKi8K
KwkJdTMyIG1hc2ssIGNjZXI7CisKKwkJbWFzayA9IFRJTV9DQ0VSX0NDeEUoY2ggKyAxKTsKKwkJ
aWYgKHByaXYtPmhhdmVfY29tcGxlbWVudGFyeV9vdXRwdXQpCisJCQltYXNrIHw9IFRJTV9DQ0VS
X0NDeE5FKGNoICsgMSk7CisKKwkJcmV0ID0gcmVnbWFwX3JlYWQocHJpdi0+cmVnbWFwLCBUSU1f
Q0NFUiwgJmNjZXIpOworCQlpZiAocmV0KQorCQkJZ290byBvdXQ7CisKKwkJaWYgKGNjZXIgJiBt
YXNrKSB7CisJCQljY2VyID0gY2NlciAmIH5tYXNrOworCisJCQlyZXQgPSByZWdtYXBfd3JpdGUo
cHJpdi0+cmVnbWFwLCBUSU1fQ0NFUiwgY2Nlcik7CisJCQlpZiAocmV0KQorCQkJCWdvdG8gb3V0
OworCisJCQlpZiAoIShjY2VyICYgVElNX0NDRVJfQ0NYRSkpIHsKKwkJCQkvKiBXaGVuIGFsbCBj
aGFubmVscyBhcmUgZGlzYWJsZWQsIHdlIGNhbiBkaXNhYmxlIHRoZSBjb250cm9sbGVyICovCisJ
CQkJcmV0ID0gcmVnbWFwX2NsZWFyX2JpdHMocHJpdi0+cmVnbWFwLCBUSU1fQ1IxLCBUSU1fQ1Ix
X0NFTik7CisJCQkJaWYgKHJldCkKKwkJCQkJZ290byBvdXQ7CisJCQl9CisKKwkJCWNsa19kaXNh
YmxlKHByaXYtPmNsayk7CisJCX0KKwl9CisKK291dDoKKwljbGtfZGlzYWJsZShwcml2LT5jbGsp
OworCisJcmV0dXJuIHJldDsKK30KKwogI2RlZmluZSBUSU1fQ0NFUl9DQzEyUCAoVElNX0NDRVJf
Q0MxUCB8IFRJTV9DQ0VSX0NDMlApCiAjZGVmaW5lIFRJTV9DQ0VSX0NDMTJFIChUSU1fQ0NFUl9D
QzFFIHwgVElNX0NDRVJfQ0MyRSkKICNkZWZpbmUgVElNX0NDRVJfQ0MzNFAgKFRJTV9DQ0VSX0ND
M1AgfCBUSU1fQ0NFUl9DQzRQKQpAQCAtMzA4LDIyOCArNjkzLDEzIEBAIHN0YXRpYyBpbnQgc3Rt
MzJfcHdtX2NhcHR1cmUoc3RydWN0IHB3bV9jaGlwICpjaGlwLCBzdHJ1Y3QgcHdtX2RldmljZSAq
cHdtLAogCXJldHVybiByZXQ7CiB9CiAKLXN0YXRpYyBpbnQgc3RtMzJfcHdtX2NvbmZpZyhzdHJ1
Y3Qgc3RtMzJfcHdtICpwcml2LCB1bnNpZ25lZCBpbnQgY2gsCi0JCQkgICAgdTY0IGR1dHlfbnMs
IHU2NCBwZXJpb2RfbnMpCi17Ci0JdW5zaWduZWQgbG9uZyBsb25nIHByZCwgZHR5OwotCXVuc2ln
bmVkIGxvbmcgbG9uZyBwcmVzY2FsZXI7Ci0JdTMyIGNjbXIsIG1hc2ssIHNoaWZ0OwotCi0JLyoK
LQkgKiAucHJvYmUoKSBhc3NlcnRlZCB0aGF0IGNsa19nZXRfcmF0ZSgpIGlzIG5vdCBiaWdnZXIg
dGhhbiAxIEdIeiwgc28KLQkgKiB0aGUgY2FsY3VsYXRpb25zIGhlcmUgd29uJ3Qgb3ZlcmZsb3cu
Ci0JICogRmlyc3Qgd2UgbmVlZCB0byBmaW5kIHRoZSBtaW5pbWFsIHZhbHVlIGZvciBwcmVzY2Fs
ZXIgc3VjaCB0aGF0Ci0JICoKLQkgKiAgICAgICAgcGVyaW9kX25zICogY2xrcmF0ZQotCSAqICAg
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIDwgbWF4X2FyciArIDEKLQkgKiAgIE5TRUNf
UEVSX1NFQyAqIChwcmVzY2FsZXIgKyAxKQotCSAqCi0JICogVGhpcyBlcXVhdGlvbiBpcyBlcXVp
dmFsZW50IHRvCi0JICoKLQkgKiAgICAgICAgcGVyaW9kX25zICogY2xrcmF0ZQotCSAqICAgLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSA8IHByZXNjYWxlciArIDEKLQkgKiAgIE5TRUNfUEVS
X1NFQyAqIChtYXhfYXJyICsgMSkKLQkgKgotCSAqIFVzaW5nIGludGVnZXIgZGl2aXNpb24gYW5k
IGtub3dpbmcgdGhhdCB0aGUgcmlnaHQgaGFuZCBzaWRlIGlzCi0JICogaW50ZWdlciwgdGhpcyBp
cyBmdXJ0aGVyIGVxdWl2YWxlbnQgdG8KLQkgKgotCSAqICAgKHBlcmlvZF9ucyAqIGNsa3JhdGUp
IC8vIChOU0VDX1BFUl9TRUMgKiAobWF4X2FyciArIDEpKSDiiaQgcHJlc2NhbGVyCi0JICovCi0K
LQlwcmVzY2FsZXIgPSBtdWxfdTY0X3U2NF9kaXZfdTY0KHBlcmlvZF9ucywgY2xrX2dldF9yYXRl
KHByaXYtPmNsayksCi0JCQkJCSh1NjQpTlNFQ19QRVJfU0VDICogKCh1NjQpcHJpdi0+bWF4X2Fy
ciArIDEpKTsKLQlpZiAocHJlc2NhbGVyID4gTUFYX1RJTV9QU0MpCi0JCXJldHVybiAtRUlOVkFM
OwotCi0JcHJkID0gbXVsX3U2NF91NjRfZGl2X3U2NChwZXJpb2RfbnMsIGNsa19nZXRfcmF0ZShw
cml2LT5jbGspLAotCQkJCSAgKHU2NClOU0VDX1BFUl9TRUMgKiAocHJlc2NhbGVyICsgMSkpOwot
CWlmICghcHJkKQotCQlyZXR1cm4gLUVJTlZBTDsKLQotCS8qCi0JICogQWxsIGNoYW5uZWxzIHNo
YXJlIHRoZSBzYW1lIHByZXNjYWxlciBhbmQgY291bnRlciBzbyB3aGVuIHR3bwotCSAqIGNoYW5u
ZWxzIGFyZSBhY3RpdmUgYXQgdGhlIHNhbWUgdGltZSB3ZSBjYW4ndCBjaGFuZ2UgdGhlbQotCSAq
LwotCWlmIChhY3RpdmVfY2hhbm5lbHMocHJpdikgJiB+KDEgPDwgY2ggKiA0KSkgewotCQl1MzIg
cHNjLCBhcnI7Ci0KLQkJcmVnbWFwX3JlYWQocHJpdi0+cmVnbWFwLCBUSU1fUFNDLCAmcHNjKTsK
LQkJcmVnbWFwX3JlYWQocHJpdi0+cmVnbWFwLCBUSU1fQVJSLCAmYXJyKTsKLQotCQlpZiAoKHBz
YyAhPSBwcmVzY2FsZXIpIHx8IChhcnIgIT0gcHJkIC0gMSkpCi0JCQlyZXR1cm4gLUVCVVNZOwot
CX0KLQotCXJlZ21hcF93cml0ZShwcml2LT5yZWdtYXAsIFRJTV9QU0MsIHByZXNjYWxlcik7Ci0J
cmVnbWFwX3dyaXRlKHByaXYtPnJlZ21hcCwgVElNX0FSUiwgcHJkIC0gMSk7Ci0JcmVnbWFwX3Nl
dF9iaXRzKHByaXYtPnJlZ21hcCwgVElNX0NSMSwgVElNX0NSMV9BUlBFKTsKLQotCS8qIENhbGN1
bGF0ZSB0aGUgZHV0eSBjeWNsZXMgKi8KLQlkdHkgPSBtdWxfdTY0X3U2NF9kaXZfdTY0KGR1dHlf
bnMsIGNsa19nZXRfcmF0ZShwcml2LT5jbGspLAotCQkJCSAgKHU2NClOU0VDX1BFUl9TRUMgKiAo
cHJlc2NhbGVyICsgMSkpOwotCi0JcmVnbWFwX3dyaXRlKHByaXYtPnJlZ21hcCwgVElNX0NDUngo
Y2ggKyAxKSwgZHR5KTsKLQotCS8qIENvbmZpZ3VyZSBvdXRwdXQgbW9kZSAqLwotCXNoaWZ0ID0g
KGNoICYgMHgxKSAqIENDTVJfQ0hBTk5FTF9TSElGVDsKLQljY21yID0gKFRJTV9DQ01SX1BFIHwg
VElNX0NDTVJfTTEpIDw8IHNoaWZ0OwotCW1hc2sgPSBDQ01SX0NIQU5ORUxfTUFTSyA8PCBzaGlm
dDsKLQotCWlmIChjaCA8IDIpCi0JCXJlZ21hcF91cGRhdGVfYml0cyhwcml2LT5yZWdtYXAsIFRJ
TV9DQ01SMSwgbWFzaywgY2Ntcik7Ci0JZWxzZQotCQlyZWdtYXBfdXBkYXRlX2JpdHMocHJpdi0+
cmVnbWFwLCBUSU1fQ0NNUjIsIG1hc2ssIGNjbXIpOwotCi0JcmVnbWFwX3NldF9iaXRzKHByaXYt
PnJlZ21hcCwgVElNX0JEVFIsIFRJTV9CRFRSX01PRSk7Ci0KLQlyZXR1cm4gMDsKLX0KLQotc3Rh
dGljIGludCBzdG0zMl9wd21fc2V0X3BvbGFyaXR5KHN0cnVjdCBzdG0zMl9wd20gKnByaXYsIHVu
c2lnbmVkIGludCBjaCwKLQkJCQkgIGVudW0gcHdtX3BvbGFyaXR5IHBvbGFyaXR5KQotewotCXUz
MiBtYXNrOwotCi0JbWFzayA9IFRJTV9DQ0VSX0NDeFAoY2ggKyAxKTsKLQlpZiAocHJpdi0+aGF2
ZV9jb21wbGVtZW50YXJ5X291dHB1dCkKLQkJbWFzayB8PSBUSU1fQ0NFUl9DQ3hOUChjaCArIDEp
OwotCi0JcmVnbWFwX3VwZGF0ZV9iaXRzKHByaXYtPnJlZ21hcCwgVElNX0NDRVIsIG1hc2ssCi0J
CQkgICBwb2xhcml0eSA9PSBQV01fUE9MQVJJVFlfTk9STUFMID8gMCA6IG1hc2spOwotCi0JcmV0
dXJuIDA7Ci19Ci0KLXN0YXRpYyBpbnQgc3RtMzJfcHdtX2VuYWJsZShzdHJ1Y3Qgc3RtMzJfcHdt
ICpwcml2LCB1bnNpZ25lZCBpbnQgY2gpCi17Ci0JdTMyIG1hc2s7Ci0JaW50IHJldDsKLQotCXJl
dCA9IGNsa19lbmFibGUocHJpdi0+Y2xrKTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OwotCi0J
LyogRW5hYmxlIGNoYW5uZWwgKi8KLQltYXNrID0gVElNX0NDRVJfQ0N4RShjaCArIDEpOwotCWlm
IChwcml2LT5oYXZlX2NvbXBsZW1lbnRhcnlfb3V0cHV0KQotCQltYXNrIHw9IFRJTV9DQ0VSX0ND
eE5FKGNoICsgMSk7Ci0KLQlyZWdtYXBfc2V0X2JpdHMocHJpdi0+cmVnbWFwLCBUSU1fQ0NFUiwg
bWFzayk7Ci0KLQkvKiBNYWtlIHN1cmUgdGhhdCByZWdpc3RlcnMgYXJlIHVwZGF0ZWQgKi8KLQly
ZWdtYXBfc2V0X2JpdHMocHJpdi0+cmVnbWFwLCBUSU1fRUdSLCBUSU1fRUdSX1VHKTsKLQotCS8q
IEVuYWJsZSBjb250cm9sbGVyICovCi0JcmVnbWFwX3NldF9iaXRzKHByaXYtPnJlZ21hcCwgVElN
X0NSMSwgVElNX0NSMV9DRU4pOwotCi0JcmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyB2b2lkIHN0bTMy
X3B3bV9kaXNhYmxlKHN0cnVjdCBzdG0zMl9wd20gKnByaXYsIHVuc2lnbmVkIGludCBjaCkKLXsK
LQl1MzIgbWFzazsKLQotCS8qIERpc2FibGUgY2hhbm5lbCAqLwotCW1hc2sgPSBUSU1fQ0NFUl9D
Q3hFKGNoICsgMSk7Ci0JaWYgKHByaXYtPmhhdmVfY29tcGxlbWVudGFyeV9vdXRwdXQpCi0JCW1h
c2sgfD0gVElNX0NDRVJfQ0N4TkUoY2ggKyAxKTsKLQotCXJlZ21hcF9jbGVhcl9iaXRzKHByaXYt
PnJlZ21hcCwgVElNX0NDRVIsIG1hc2spOwotCi0JLyogV2hlbiBhbGwgY2hhbm5lbHMgYXJlIGRp
c2FibGVkLCB3ZSBjYW4gZGlzYWJsZSB0aGUgY29udHJvbGxlciAqLwotCWlmICghYWN0aXZlX2No
YW5uZWxzKHByaXYpKQotCQlyZWdtYXBfY2xlYXJfYml0cyhwcml2LT5yZWdtYXAsIFRJTV9DUjEs
IFRJTV9DUjFfQ0VOKTsKLQotCWNsa19kaXNhYmxlKHByaXYtPmNsayk7Ci19Ci0KLXN0YXRpYyBp
bnQgc3RtMzJfcHdtX2FwcGx5KHN0cnVjdCBwd21fY2hpcCAqY2hpcCwgc3RydWN0IHB3bV9kZXZp
Y2UgKnB3bSwKLQkJCSAgIGNvbnN0IHN0cnVjdCBwd21fc3RhdGUgKnN0YXRlKQotewotCWJvb2wg
ZW5hYmxlZDsKLQlzdHJ1Y3Qgc3RtMzJfcHdtICpwcml2ID0gdG9fc3RtMzJfcHdtX2RldihjaGlw
KTsKLQlpbnQgcmV0OwotCi0JZW5hYmxlZCA9IHB3bS0+c3RhdGUuZW5hYmxlZDsKLQotCWlmICgh
c3RhdGUtPmVuYWJsZWQpIHsKLQkJaWYgKGVuYWJsZWQpCi0JCQlzdG0zMl9wd21fZGlzYWJsZShw
cml2LCBwd20tPmh3cHdtKTsKLQkJcmV0dXJuIDA7Ci0JfQotCi0JaWYgKHN0YXRlLT5wb2xhcml0
eSAhPSBwd20tPnN0YXRlLnBvbGFyaXR5KQotCQlzdG0zMl9wd21fc2V0X3BvbGFyaXR5KHByaXYs
IHB3bS0+aHdwd20sIHN0YXRlLT5wb2xhcml0eSk7Ci0KLQlyZXQgPSBzdG0zMl9wd21fY29uZmln
KHByaXYsIHB3bS0+aHdwd20sCi0JCQkgICAgICAgc3RhdGUtPmR1dHlfY3ljbGUsIHN0YXRlLT5w
ZXJpb2QpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KLQlpZiAoIWVuYWJsZWQgJiYgc3Rh
dGUtPmVuYWJsZWQpCi0JCXJldCA9IHN0bTMyX3B3bV9lbmFibGUocHJpdiwgcHdtLT5od3B3bSk7
Ci0KLQlyZXR1cm4gcmV0OwotfQotCi1zdGF0aWMgaW50IHN0bTMyX3B3bV9hcHBseV9sb2NrZWQo
c3RydWN0IHB3bV9jaGlwICpjaGlwLCBzdHJ1Y3QgcHdtX2RldmljZSAqcHdtLAotCQkJCSAgY29u
c3Qgc3RydWN0IHB3bV9zdGF0ZSAqc3RhdGUpCi17Ci0Jc3RydWN0IHN0bTMyX3B3bSAqcHJpdiA9
IHRvX3N0bTMyX3B3bV9kZXYoY2hpcCk7Ci0JaW50IHJldDsKLQotCS8qIHByb3RlY3QgY29tbW9u
IHByZXNjYWxlciBmb3IgYWxsIGFjdGl2ZSBjaGFubmVscyAqLwotCW11dGV4X2xvY2soJnByaXYt
PmxvY2spOwotCXJldCA9IHN0bTMyX3B3bV9hcHBseShjaGlwLCBwd20sIHN0YXRlKTsKLQltdXRl
eF91bmxvY2soJnByaXYtPmxvY2spOwotCi0JcmV0dXJuIHJldDsKLX0KLQotc3RhdGljIGludCBz
dG0zMl9wd21fZ2V0X3N0YXRlKHN0cnVjdCBwd21fY2hpcCAqY2hpcCwKLQkJCSAgICAgICBzdHJ1
Y3QgcHdtX2RldmljZSAqcHdtLCBzdHJ1Y3QgcHdtX3N0YXRlICpzdGF0ZSkKLXsKLQlzdHJ1Y3Qg
c3RtMzJfcHdtICpwcml2ID0gdG9fc3RtMzJfcHdtX2RldihjaGlwKTsKLQlpbnQgY2ggPSBwd20t
Pmh3cHdtOwotCXVuc2lnbmVkIGxvbmcgcmF0ZTsKLQl1MzIgY2NlciwgcHNjLCBhcnIsIGNjcjsK
LQl1NjQgZHR5LCBwcmQ7Ci0JaW50IHJldDsKLQotCW11dGV4X2xvY2soJnByaXYtPmxvY2spOwot
Ci0JcmV0ID0gcmVnbWFwX3JlYWQocHJpdi0+cmVnbWFwLCBUSU1fQ0NFUiwgJmNjZXIpOwotCWlm
IChyZXQpCi0JCWdvdG8gb3V0OwotCi0Jc3RhdGUtPmVuYWJsZWQgPSBjY2VyICYgVElNX0NDRVJf
Q0N4RShjaCArIDEpOwotCXN0YXRlLT5wb2xhcml0eSA9IChjY2VyICYgVElNX0NDRVJfQ0N4UChj
aCArIDEpKSA/Ci0JCQkgIFBXTV9QT0xBUklUWV9JTlZFUlNFRCA6IFBXTV9QT0xBUklUWV9OT1JN
QUw7Ci0JcmV0ID0gcmVnbWFwX3JlYWQocHJpdi0+cmVnbWFwLCBUSU1fUFNDLCAmcHNjKTsKLQlp
ZiAocmV0KQotCQlnb3RvIG91dDsKLQlyZXQgPSByZWdtYXBfcmVhZChwcml2LT5yZWdtYXAsIFRJ
TV9BUlIsICZhcnIpOwotCWlmIChyZXQpCi0JCWdvdG8gb3V0OwotCXJldCA9IHJlZ21hcF9yZWFk
KHByaXYtPnJlZ21hcCwgVElNX0NDUngoY2ggKyAxKSwgJmNjcik7Ci0JaWYgKHJldCkKLQkJZ290
byBvdXQ7Ci0KLQlyYXRlID0gY2xrX2dldF9yYXRlKHByaXYtPmNsayk7Ci0KLQlwcmQgPSAodTY0
KU5TRUNfUEVSX1NFQyAqIChwc2MgKyAxKSAqIChhcnIgKyAxKTsKLQlzdGF0ZS0+cGVyaW9kID0g
RElWX1JPVU5EX1VQX1VMTChwcmQsIHJhdGUpOwotCWR0eSA9ICh1NjQpTlNFQ19QRVJfU0VDICog
KHBzYyArIDEpICogY2NyOwotCXN0YXRlLT5kdXR5X2N5Y2xlID0gRElWX1JPVU5EX1VQX1VMTChk
dHksIHJhdGUpOwotCi1vdXQ6Ci0JbXV0ZXhfdW5sb2NrKCZwcml2LT5sb2NrKTsKLQlyZXR1cm4g
cmV0OwotfQotCiBzdGF0aWMgY29uc3Qgc3RydWN0IHB3bV9vcHMgc3RtMzJwd21fb3BzID0gewot
CS5hcHBseSA9IHN0bTMyX3B3bV9hcHBseV9sb2NrZWQsCi0JLmdldF9zdGF0ZSA9IHN0bTMyX3B3
bV9nZXRfc3RhdGUsCisJLnNpemVvZl93Zmh3ID0gc2l6ZW9mKHN0cnVjdCBzdG0zMl9wd21fd2F2
ZWZvcm0pLAorCS5yb3VuZF93YXZlZm9ybV90b2h3ID0gc3RtMzJfcHdtX3JvdW5kX3dhdmVmb3Jt
X3RvaHcsCisJLnJvdW5kX3dhdmVmb3JtX2Zyb21odyA9IHN0bTMyX3B3bV9yb3VuZF93YXZlZm9y
bV9mcm9taHcsCisJLnJlYWRfd2F2ZWZvcm0gPSBzdG0zMl9wd21fcmVhZF93YXZlZm9ybSwKKwku
d3JpdGVfd2F2ZWZvcm0gPSBzdG0zMl9wd21fd3JpdGVfd2F2ZWZvcm0sCisKIAkuY2FwdHVyZSA9
IElTX0VOQUJMRUQoQ09ORklHX0RNQV9FTkdJTkUpID8gc3RtMzJfcHdtX2NhcHR1cmUgOiBOVUxM
LAogfTsKIAotLSAKMi40NS4yCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fXwpMaW51eC1zdG0zMiBtYWlsaW5nIGxpc3QKTGludXgtc3RtMzJAc3QtbWQtbWFp
bG1hbi5zdG9ybXJlcGx5LmNvbQpodHRwczovL3N0LW1kLW1haWxtYW4uc3Rvcm1yZXBseS5jb20v
bWFpbG1hbi9saXN0aW5mby9saW51eC1zdG0zMgo=
