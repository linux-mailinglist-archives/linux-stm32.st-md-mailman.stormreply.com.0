Return-Path: <linux-stm32-bounces@st-md-mailman.stormreply.com>
X-Original-To: lists+linux-stm32@lfdr.de
Delivered-To: lists+linux-stm32@lfdr.de
Received: from stm-ict-prod-mailman-01.stormreply.prv (st-md-mailman.stormreply.com [52.209.6.89])
	by mail.lfdr.de (Postfix) with ESMTPS id C39E18250B6
	for <lists+linux-stm32@lfdr.de>; Fri,  5 Jan 2024 10:21:51 +0100 (CET)
Received: from ip-172-31-3-47.eu-west-1.compute.internal (localhost [127.0.0.1])
	by stm-ict-prod-mailman-01.stormreply.prv (Postfix) with ESMTP id 70CDAC6C83D;
	Fri,  5 Jan 2024 09:21:51 +0000 (UTC)
Received: from mx07-00178001.pphosted.com (mx08-00178001.pphosted.com
 [91.207.212.93])
 (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
 (No client certificate requested)
 by stm-ict-prod-mailman-01.stormreply.prv (Postfix) with ESMTPS id 4160EC6C83C
 for <linux-stm32@st-md-mailman.stormreply.com>;
 Fri,  5 Jan 2024 09:21:50 +0000 (UTC)
Received: from pps.filterd (m0046661.ppops.net [127.0.0.1])
 by mx07-00178001.pphosted.com (8.17.1.22/8.17.1.22) with ESMTP id
 4052xVtj026982; Fri, 5 Jan 2024 10:21:10 +0100
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=foss.st.com; h=
 message-id:date:mime-version:subject:to:cc:references:from
 :in-reply-to:content-type:content-transfer-encoding; s=
 selector1; bh=vW8CYyGIP/vC0L2YTygi0W0H7YOr9Bs1QNabt8ZBU1M=; b=Tv
 qDL3NSqwEnMohCzDKfiJx/4bDSTntsHCmJ93nwH9C+miyfsS9+R9rbUPshYJtqX5
 LPD0N2PGDrqjjg/XxQbBx/BGH5+SfgNjOvlHRAZmSDYKDDD9agRoJxf1WQFWGemP
 bflaXuetxu030U1SxNqX4Wo2V66XtPgnYpiydlRl4UkV41/Jm8b9wDP4pK233w0h
 ySbV4rDlpZsu67A4bp03GO5hR1yCZQe3XjWVm3+sucXT7r6ehFChl+GD5ZgttqCU
 VVuoblEAcqoHXRzLfGDAh8i9APGuDKwjlS5d6QqV5ZTrOLJF5HfI4WIamAX0cp78
 9Y/TxhvmDDQPmueDN8Iw==
Received: from beta.dmz-eu.st.com (beta.dmz-eu.st.com [164.129.1.35])
 by mx07-00178001.pphosted.com (PPS) with ESMTPS id 3ve9fd19g7-1
 (version=TLSv1.2 cipher=ECDHE-RSA-AES256-GCM-SHA384 bits=256 verify=NOT);
 Fri, 05 Jan 2024 10:21:10 +0100 (CET)
Received: from euls16034.sgp.st.com (euls16034.sgp.st.com [10.75.44.20])
 by beta.dmz-eu.st.com (STMicroelectronics) with ESMTP id 978ED10002A;
 Fri,  5 Jan 2024 10:21:09 +0100 (CET)
Received: from Webmail-eu.st.com (shfdag1node2.st.com [10.75.129.70])
 by euls16034.sgp.st.com (STMicroelectronics) with ESMTP id 830EE21861F;
 Fri,  5 Jan 2024 10:21:09 +0100 (CET)
Received: from [10.252.5.254] (10.252.5.254) by SHFDAG1NODE2.st.com
 (10.75.129.70) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256) id 15.1.2507.27; Fri, 5 Jan
 2024 10:21:09 +0100
Message-ID: <76b4dfd8-f8c2-41f1-96df-539b168f9e80@foss.st.com>
Date: Fri, 5 Jan 2024 10:21:08 +0100
MIME-Version: 1.0
User-Agent: Mozilla Thunderbird
Content-Language: en-US
To: Katya Orlova <e.orlova@ispras.ru>
References: <20231124100415.21713-1-e.orlova@ispras.ru>
From: Raphael Gallais-Pou <raphael.gallais-pou@foss.st.com>
In-Reply-To: <20231124100415.21713-1-e.orlova@ispras.ru>
X-Originating-IP: [10.252.5.254]
X-ClientProxiedBy: EQNCAS1NODE3.st.com (10.75.129.80) To SHFDAG1NODE2.st.com
 (10.75.129.70)
X-Proofpoint-Virus-Version: vendor=baseguard
 engine=ICAP:2.0.272,Aquarius:18.0.997,Hydra:6.0.619,FMLib:17.11.176.26
 definitions=2024-01-05_04,2024-01-05_01,2023-05-22_02
Cc: Daniel Vetter <daniel@ffwll.ch>,
 Yannick Fertre <yannick.fertre@foss.st.com>, dri-devel@lists.freedesktop.org,
 linux-kernel@vger.kernel.org, Maxime Coquelin <mcoquelin.stm32@gmail.com>,
 Philipp Zabel <p.zabel@pengutronix.de>, David Airlie <airlied@gmail.com>,
 linux-stm32@st-md-mailman.stormreply.com, linux-arm-kernel@lists.infradead.org,
 lvc-project@linuxtesting.org
Subject: Re: [Linux-stm32] [PATCH v2] drm/stm: Avoid use-after-free issues
 with crtc and plane
X-BeenThere: linux-stm32@st-md-mailman.stormreply.com
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: <linux-stm32.st-md-mailman.stormreply.com>
List-Unsubscribe: <https://st-md-mailman.stormreply.com/mailman/options/linux-stm32>, 
 <mailto:linux-stm32-request@st-md-mailman.stormreply.com?subject=unsubscribe>
List-Archive: <http://st-md-mailman.stormreply.com/pipermail/linux-stm32/>
List-Post: <mailto:linux-stm32@st-md-mailman.stormreply.com>
List-Help: <mailto:linux-stm32-request@st-md-mailman.stormreply.com?subject=help>
List-Subscribe: <https://st-md-mailman.stormreply.com/mailman/listinfo/linux-stm32>, 
 <mailto:linux-stm32-request@st-md-mailman.stormreply.com?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: linux-stm32-bounces@st-md-mailman.stormreply.com
Sender: "Linux-stm32" <linux-stm32-bounces@st-md-mailman.stormreply.com>

Ck9uIDExLzI0LzIzIDExOjA0LCBLYXR5YSBPcmxvdmEgd3JvdGU6Cj4gbHRkY19sb2FkKCkgY2Fs
bHMgZnVuY3Rpb25zIGRybV9jcnRjX2luaXRfd2l0aF9wbGFuZXMoKSwKPiBkcm1fdW5pdmVyc2Fs
X3BsYW5lX2luaXQoKSBhbmQgZHJtX2VuY29kZXJfaW5pdCgpLiBUaGVzZSBmdW5jdGlvbnMKPiBz
aG91bGQgbm90IGJlIGNhbGxlZCB3aXRoIHBhcmFtZXRlcnMgYWxsb2NhdGVkIHdpdGggZGV2bV9r
emFsbG9jKCkKPiB0byBhdm9pZCB1c2UtYWZ0ZXItZnJlZSBpc3N1ZXMgWzFdLgo+Cj4gVXNlIGFs
bG9jYXRpb25zIG1hbmFnZWQgYnkgdGhlIERSTSBmcmFtZXdvcmsuCj4KPiBGb3VuZCBieSBMaW51
eCBWZXJpZmljYXRpb24gQ2VudGVyIChsaW51eHRlc3Rpbmcub3JnKS4KPgo+IFsxXQo+IGh0dHBz
Oi8vbG9yZS5rZXJuZWwub3JnL2xrbWwvdTM2Nmk3NmUzcWhoM3JhNW94cnRuZ2p0bTJ1NWx0ZXJr
ZWtjejZ5MmprbmRodXh6bGlAZGl1am9uNGg3cXdiLwo+Cj4gU2lnbmVkLW9mZi1ieTogS2F0eWEg
T3Jsb3ZhIDxlLm9ybG92YUBpc3ByYXMucnU+Cj4gLS0tCj4gdjI6IHVzZSBhbGxvY2F0aW9ucyBt
YW5hZ2VkIGJ5IHRoZSBEUk0gYXMKPiBSYXBoYWVsIEdhbGxhaXMtUG91IDxyYXBoYWVsLmdhbGxh
aXMtcG91QGZvc3Muc3QuY29tPiBzdWdnZXN0ZWQuCj4gQWxzbyBhZGQgYSBmaXggZm9yIGVuY29k
ZXIuCj4gIGRyaXZlcnMvZ3B1L2RybS9zdG0vZHJ2LmMgIHwgIDMgKy0KPiAgZHJpdmVycy9ncHUv
ZHJtL3N0bS9sdGRjLmMgfCA2OCArKysrKysrKystLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LQo+ICAyIGZpbGVzIGNoYW5nZWQsIDE4IGluc2VydGlvbnMoKyksIDUzIGRlbGV0aW9ucygtKQo+
Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9zdG0vZHJ2LmMgYi9kcml2ZXJzL2dwdS9k
cm0vc3RtL2Rydi5jCj4gaW5kZXggZTg1MjNhYmVmMjdhLi4xNTJiZWMyYzAyMzggMTAwNjQ0Cj4g
LS0tIGEvZHJpdmVycy9ncHUvZHJtL3N0bS9kcnYuYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9z
dG0vZHJ2LmMKPiBAQCAtMjUsNiArMjUsNyBAQAo+ICAjaW5jbHVkZSA8ZHJtL2RybV9tb2R1bGUu
aD4KPiAgI2luY2x1ZGUgPGRybS9kcm1fcHJvYmVfaGVscGVyLmg+Cj4gICNpbmNsdWRlIDxkcm0v
ZHJtX3ZibGFuay5oPgo+ICsjaW5jbHVkZSA8ZHJtL2RybV9tYW5hZ2VkLmg+Cj4gIAo+ICAjaW5j
bHVkZSAibHRkYy5oIgo+ICAKPiBAQCAtNzUsNyArNzYsNyBAQCBzdGF0aWMgaW50IGRydl9sb2Fk
KHN0cnVjdCBkcm1fZGV2aWNlICpkZGV2KQo+ICAKPiAgCURSTV9ERUJVRygiJXNcbiIsIF9fZnVu
Y19fKTsKPiAgCj4gLQlsZGV2ID0gZGV2bV9remFsbG9jKGRkZXYtPmRldiwgc2l6ZW9mKCpsZGV2
KSwgR0ZQX0tFUk5FTCk7Cj4gKwlsZGV2ID0gZHJtbV9remFsbG9jKGRkZXYsIHNpemVvZigqbGRl
diksIEdGUF9LRVJORUwpOwo+ICAJaWYgKCFsZGV2KQo+ICAJCXJldHVybiAtRU5PTUVNOwo+ICAK
PiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3N0bS9sdGRjLmMgYi9kcml2ZXJzL2dwdS9k
cm0vc3RtL2x0ZGMuYwo+IGluZGV4IDU1NzZmZGFlNDk2Mi4uMDJhN2M4Mzc1ZjQ0IDEwMDY0NAo+
IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9zdG0vbHRkYy5jCj4gKysrIGIvZHJpdmVycy9ncHUvZHJt
L3N0bS9sdGRjLmMKPiBAQCAtMzYsNiArMzYsNyBAQAo+ICAjaW5jbHVkZSA8ZHJtL2RybV9wcm9i
ZV9oZWxwZXIuaD4KPiAgI2luY2x1ZGUgPGRybS9kcm1fc2ltcGxlX2ttc19oZWxwZXIuaD4KPiAg
I2luY2x1ZGUgPGRybS9kcm1fdmJsYW5rLmg+Cj4gKyNpbmNsdWRlIDxkcm0vZHJtX21hbmFnZWQu
aD4KPiAgCj4gICNpbmNsdWRlIDx2aWRlby92aWRlb21vZGUuaD4KPiAgCj4gQEAgLTExOTksNyAr
MTIwMCw2IEBAIHN0YXRpYyB2b2lkIGx0ZGNfY3J0Y19hdG9taWNfcHJpbnRfc3RhdGUoc3RydWN0
IGRybV9wcmludGVyICpwLAo+ICB9Cj4gIAo+ICBzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9jcnRj
X2Z1bmNzIGx0ZGNfY3J0Y19mdW5jcyA9IHsKPiAtCS5kZXN0cm95ID0gZHJtX2NydGNfY2xlYW51
cCwKPiAgCS5zZXRfY29uZmlnID0gZHJtX2F0b21pY19oZWxwZXJfc2V0X2NvbmZpZywKPiAgCS5w
YWdlX2ZsaXAgPSBkcm1fYXRvbWljX2hlbHBlcl9wYWdlX2ZsaXAsCj4gIAkucmVzZXQgPSBkcm1f
YXRvbWljX2hlbHBlcl9jcnRjX3Jlc2V0LAo+IEBAIC0xMjEyLDcgKzEyMTIsNiBAQCBzdGF0aWMg
Y29uc3Qgc3RydWN0IGRybV9jcnRjX2Z1bmNzIGx0ZGNfY3J0Y19mdW5jcyA9IHsKPiAgfTsKPiAg
Cj4gIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2NydGNfZnVuY3MgbHRkY19jcnRjX3dpdGhfY3Jj
X3N1cHBvcnRfZnVuY3MgPSB7Cj4gLQkuZGVzdHJveSA9IGRybV9jcnRjX2NsZWFudXAsCj4gIAku
c2V0X2NvbmZpZyA9IGRybV9hdG9taWNfaGVscGVyX3NldF9jb25maWcsCj4gIAkucGFnZV9mbGlw
ID0gZHJtX2F0b21pY19oZWxwZXJfcGFnZV9mbGlwLAo+ICAJLnJlc2V0ID0gZHJtX2F0b21pY19o
ZWxwZXJfY3J0Y19yZXNldCwKPiBAQCAtMTU0NSw3ICsxNTQ0LDYgQEAgc3RhdGljIHZvaWQgbHRk
Y19wbGFuZV9hdG9taWNfcHJpbnRfc3RhdGUoc3RydWN0IGRybV9wcmludGVyICpwLAo+ICBzdGF0
aWMgY29uc3Qgc3RydWN0IGRybV9wbGFuZV9mdW5jcyBsdGRjX3BsYW5lX2Z1bmNzID0gewo+ICAJ
LnVwZGF0ZV9wbGFuZSA9IGRybV9hdG9taWNfaGVscGVyX3VwZGF0ZV9wbGFuZSwKPiAgCS5kaXNh
YmxlX3BsYW5lID0gZHJtX2F0b21pY19oZWxwZXJfZGlzYWJsZV9wbGFuZSwKPiAtCS5kZXN0cm95
ID0gZHJtX3BsYW5lX2NsZWFudXAsCj4gIAkucmVzZXQgPSBkcm1fYXRvbWljX2hlbHBlcl9wbGFu
ZV9yZXNldCwKPiAgCS5hdG9taWNfZHVwbGljYXRlX3N0YXRlID0gZHJtX2F0b21pY19oZWxwZXJf
cGxhbmVfZHVwbGljYXRlX3N0YXRlLAo+ICAJLmF0b21pY19kZXN0cm95X3N0YXRlID0gZHJtX2F0
b21pY19oZWxwZXJfcGxhbmVfZGVzdHJveV9zdGF0ZSwKPiBAQCAtMTU3Miw3ICsxNTcwLDYgQEAg
c3RhdGljIHN0cnVjdCBkcm1fcGxhbmUgKmx0ZGNfcGxhbmVfY3JlYXRlKHN0cnVjdCBkcm1fZGV2
aWNlICpkZGV2LAo+ICAJY29uc3QgdTY0ICptb2RpZmllcnMgPSBsdGRjX2Zvcm1hdF9tb2RpZmll
cnM7Cj4gIAl1MzIgbG9mcyA9IGluZGV4ICogTEFZX09GUzsKPiAgCXUzMiB2YWw7Cj4gLQlpbnQg
cmV0Owo+ICAKPiAgCS8qIEFsbG9jYXRlIHRoZSBiaWdnZXN0IHNpemUgYWNjb3JkaW5nIHRvIHN1
cHBvcnRlZCBjb2xvciBmb3JtYXRzICovCj4gIAlmb3JtYXRzID0gZGV2bV9remFsbG9jKGRldiwg
KGxkZXYtPmNhcHMucGl4X2ZtdF9uYiArCj4gQEAgLTE2MTMsMTQgKzE2MTAsMTAgQEAgc3RhdGlj
IHN0cnVjdCBkcm1fcGxhbmUgKmx0ZGNfcGxhbmVfY3JlYXRlKHN0cnVjdCBkcm1fZGV2aWNlICpk
ZGV2LAo+ICAJCX0KPiAgCX0KPiAgCj4gLQlwbGFuZSA9IGRldm1fa3phbGxvYyhkZXYsIHNpemVv
ZigqcGxhbmUpLCBHRlBfS0VSTkVMKTsKPiAtCWlmICghcGxhbmUpCj4gLQkJcmV0dXJuIE5VTEw7
Cj4gLQo+IC0JcmV0ID0gZHJtX3VuaXZlcnNhbF9wbGFuZV9pbml0KGRkZXYsIHBsYW5lLCBwb3Nz
aWJsZV9jcnRjcywKPiAtCQkJCSAgICAgICAmbHRkY19wbGFuZV9mdW5jcywgZm9ybWF0cywgbmJf
Zm10LAo+IC0JCQkJICAgICAgIG1vZGlmaWVycywgdHlwZSwgTlVMTCk7Cj4gLQlpZiAocmV0IDwg
MCkKPiArCXBsYW5lID0gZHJtbV91bml2ZXJzYWxfcGxhbmVfYWxsb2MoZGRldiwgc3RydWN0IGRy
bV9wbGFuZSwgZGV2LAo+ICsJCQkJICAgICAgIHBvc3NpYmxlX2NydGNzLCAmbHRkY19wbGFuZV9m
dW5jcywgZm9ybWF0cywgbmJfZm10LAo+ICsJCQkJICAgICAgIG1vZGlmaWVycywgdHlwZSwgTlVM
TCk7CgpIaSBLYXR5YSwKClRoYW5rcyBmb3IgeW91ciBzdWJtaXNzaW9uLCBhbmQgc29ycnkgZm9y
IHRoZSBkZWxheS4KCgpUaGVyZSBpcyBzZXZlcmFsIGFsaWdubWVudCBzdHlsZSBwcm9ibGVtcywg
c3VjaCBhcyB0aGUgbGluZXMgYWJvdmUuCgpZb3UgY2FuIHVzZSAiLS1zdHJpY3QiIG9wdGlvbiB3
aXRoIGNoZWNrcGF0Y2ggc2NyaXB0IHRvIHNob3cgeW91IGFsbCB0aGUgZmF1bHR5CmFsaWdubWVu
dCBiZWZvcmUgc2VuZGluZyBhIHBhdGNoLgoKCk90aGVyIHRoYW4gdGhhdCB0aGlzIHBhdGNoIGxv
b2tzIHByZXR0eSBnb29kIHRvIG1lLgoKUmVnYXJkcywKClJhcGhhw6tsCgo+ICsJaWYgKElTX0VS
UihwbGFuZSkpCj4gIAkJcmV0dXJuIE5VTEw7Cj4gIAo+ICAJaWYgKGxkZXYtPmNhcHMueWNiY3Jf
aW5wdXQpIHsKPiBAQCAtMTY0MywxNSArMTYzNiw2IEBAIHN0YXRpYyBzdHJ1Y3QgZHJtX3BsYW5l
ICpsdGRjX3BsYW5lX2NyZWF0ZShzdHJ1Y3QgZHJtX2RldmljZSAqZGRldiwKPiAgCXJldHVybiBw
bGFuZTsKPiAgfQo+ICAKPiAtc3RhdGljIHZvaWQgbHRkY19wbGFuZV9kZXN0cm95X2FsbChzdHJ1
Y3QgZHJtX2RldmljZSAqZGRldikKPiAtewo+IC0Jc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsICpw
bGFuZV90ZW1wOwo+IC0KPiAtCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShwbGFuZSwgcGxhbmVf
dGVtcCwKPiAtCQkJCSAmZGRldi0+bW9kZV9jb25maWcucGxhbmVfbGlzdCwgaGVhZCkKPiAtCQlk
cm1fcGxhbmVfY2xlYW51cChwbGFuZSk7Cj4gLX0KPiAtCj4gIHN0YXRpYyBpbnQgbHRkY19jcnRj
X2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRkZXYsIHN0cnVjdCBkcm1fY3J0YyAqY3J0YykKPiAg
ewo+ICAJc3RydWN0IGx0ZGNfZGV2aWNlICpsZGV2ID0gZGRldi0+ZGV2X3ByaXZhdGU7Cj4gQEAg
LTE2NzcsMTQgKzE2NjEsMTQgQEAgc3RhdGljIGludCBsdGRjX2NydGNfaW5pdChzdHJ1Y3QgZHJt
X2RldmljZSAqZGRldiwgc3RydWN0IGRybV9jcnRjICpjcnRjKQo+ICAKPiAgCS8qIEluaXQgQ1JU
QyBhY2NvcmRpbmcgdG8gaXRzIGhhcmR3YXJlIGZlYXR1cmVzICovCj4gIAlpZiAobGRldi0+Y2Fw
cy5jcmMpCj4gLQkJcmV0ID0gZHJtX2NydGNfaW5pdF93aXRoX3BsYW5lcyhkZGV2LCBjcnRjLCBw
cmltYXJ5LCBOVUxMLAo+ICsJCXJldCA9IGRybW1fY3J0Y19pbml0X3dpdGhfcGxhbmVzKGRkZXYs
IGNydGMsIHByaW1hcnksIE5VTEwsCj4gIAkJCQkJCSZsdGRjX2NydGNfd2l0aF9jcmNfc3VwcG9y
dF9mdW5jcywgTlVMTCk7Cj4gIAllbHNlCj4gLQkJcmV0ID0gZHJtX2NydGNfaW5pdF93aXRoX3Bs
YW5lcyhkZGV2LCBjcnRjLCBwcmltYXJ5LCBOVUxMLAo+ICsJCXJldCA9IGRybW1fY3J0Y19pbml0
X3dpdGhfcGxhbmVzKGRkZXYsIGNydGMsIHByaW1hcnksIE5VTEwsCj4gIAkJCQkJCSZsdGRjX2Ny
dGNfZnVuY3MsIE5VTEwpOwo+ICAJaWYgKHJldCkgewo+ICAJCURSTV9FUlJPUigiQ2FuIG5vdCBp
bml0aWFsaXplIENSVENcbiIpOwo+IC0JCWdvdG8gY2xlYW51cDsKPiArCQlyZXR1cm4gcmV0Owo+
ICAJfQo+ICAKPiAgCWRybV9jcnRjX2hlbHBlcl9hZGQoY3J0YywgJmx0ZGNfY3J0Y19oZWxwZXJf
ZnVuY3MpOwo+IEBAIC0xNjk4LDkgKzE2ODIsOCBAQCBzdGF0aWMgaW50IGx0ZGNfY3J0Y19pbml0
KHN0cnVjdCBkcm1fZGV2aWNlICpkZGV2LCBzdHJ1Y3QgZHJtX2NydGMgKmNydGMpCj4gIAlmb3Ig
KGkgPSAxOyBpIDwgbGRldi0+Y2Fwcy5uYl9sYXllcnM7IGkrKykgewo+ICAJCW92ZXJsYXkgPSBs
dGRjX3BsYW5lX2NyZWF0ZShkZGV2LCBEUk1fUExBTkVfVFlQRV9PVkVSTEFZLCBpKTsKPiAgCQlp
ZiAoIW92ZXJsYXkpIHsKPiAtCQkJcmV0ID0gLUVOT01FTTsKPiAgCQkJRFJNX0VSUk9SKCJDYW4g
bm90IGNyZWF0ZSBvdmVybGF5IHBsYW5lICVkXG4iLCBpKTsKPiAtCQkJZ290byBjbGVhbnVwOwo+
ICsJCQlyZXR1cm4gLUVOT01FTTsKPiAgCQl9Cj4gIAkJaWYgKGxkZXYtPmNhcHMuZHluYW1pY196
b3JkZXIpCj4gIAkJCWRybV9wbGFuZV9jcmVhdGVfenBvc19wcm9wZXJ0eShvdmVybGF5LCBpLCAw
LCBsZGV2LT5jYXBzLm5iX2xheWVycyAtIDEpOwo+IEBAIC0xNzEzLDEwICsxNjk2LDYgQEAgc3Rh
dGljIGludCBsdGRjX2NydGNfaW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGRldiwgc3RydWN0IGRy
bV9jcnRjICpjcnRjKQo+ICAJfQo+ICAKPiAgCXJldHVybiAwOwo+IC0KPiAtY2xlYW51cDoKPiAt
CWx0ZGNfcGxhbmVfZGVzdHJveV9hbGwoZGRldik7Cj4gLQlyZXR1cm4gcmV0Owo+ICB9Cj4gIAo+
ICBzdGF0aWMgdm9pZCBsdGRjX2VuY29kZXJfZGlzYWJsZShzdHJ1Y3QgZHJtX2VuY29kZXIgKmVu
Y29kZXIpCj4gQEAgLTE3NzYsMjMgKzE3NTUsMTkgQEAgc3RhdGljIGludCBsdGRjX2VuY29kZXJf
aW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGRldiwgc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSkK
PiAgCXN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2RlcjsKPiAgCWludCByZXQ7Cj4gIAo+IC0JZW5j
b2RlciA9IGRldm1fa3phbGxvYyhkZGV2LT5kZXYsIHNpemVvZigqZW5jb2RlciksIEdGUF9LRVJO
RUwpOwo+IC0JaWYgKCFlbmNvZGVyKQo+IC0JCXJldHVybiAtRU5PTUVNOwo+ICsJZW5jb2RlciA9
IGRybW1fc2ltcGxlX2VuY29kZXJfYWxsb2MoZGRldiwgc3RydWN0IGRybV9lbmNvZGVyLCBkZXYs
Cj4gKwkJCQkJCQkJCQlEUk1fTU9ERV9FTkNPREVSX0RQSSk7Ck5pdDogYmFkIGFsaWdubWVudC4K
PiArCWlmIChJU19FUlIoZW5jb2RlcikpCj4gKwkJcmV0dXJuIFBUUl9FUlIoZW5jb2Rlcik7Cj4g
IAo+ICAJZW5jb2Rlci0+cG9zc2libGVfY3J0Y3MgPSBDUlRDX01BU0s7Cj4gIAllbmNvZGVyLT5w
b3NzaWJsZV9jbG9uZXMgPSAwOwkvKiBObyBjbG9uaW5nIHN1cHBvcnQgKi8KPiAgCj4gLQlkcm1f
c2ltcGxlX2VuY29kZXJfaW5pdChkZGV2LCBlbmNvZGVyLCBEUk1fTU9ERV9FTkNPREVSX0RQSSk7
Cj4gLQo+ICAJZHJtX2VuY29kZXJfaGVscGVyX2FkZChlbmNvZGVyLCAmbHRkY19lbmNvZGVyX2hl
bHBlcl9mdW5jcyk7Cj4gIAo+ICAJcmV0ID0gZHJtX2JyaWRnZV9hdHRhY2goZW5jb2RlciwgYnJp
ZGdlLCBOVUxMLCAwKTsKPiAtCWlmIChyZXQpIHsKPiAtCQlpZiAocmV0ICE9IC1FUFJPQkVfREVG
RVIpCj4gLQkJCWRybV9lbmNvZGVyX2NsZWFudXAoZW5jb2Rlcik7Cj4gKwlpZiAocmV0KQo+ICAJ
CXJldHVybiByZXQ7Cj4gLQl9Cj4gIAo+ICAJRFJNX0RFQlVHX0RSSVZFUigiQnJpZGdlIGVuY29k
ZXI6JWQgY3JlYXRlZFxuIiwgZW5jb2Rlci0+YmFzZS5pZCk7Cj4gIAo+IEBAIC0xOTYyLDggKzE5
MzcsNyBAQCBpbnQgbHRkY19sb2FkKHN0cnVjdCBkcm1fZGV2aWNlICpkZGV2KQo+ICAJCQlnb3Rv
IGVycjsKPiAgCj4gIAkJaWYgKHBhbmVsKSB7Cj4gLQkJCWJyaWRnZSA9IGRybV9wYW5lbF9icmlk
Z2VfYWRkX3R5cGVkKHBhbmVsLAo+IC0JCQkJCQkJICAgIERSTV9NT0RFX0NPTk5FQ1RPUl9EUEkp
Owo+ICsJCQlicmlkZ2UgPSBkcm1tX3BhbmVsX2JyaWRnZV9hZGQoZGRldiwgcGFuZWwpOwo+ICAJ
CQlpZiAoSVNfRVJSKGJyaWRnZSkpIHsKPiAgCQkJCURSTV9FUlJPUigicGFuZWwtYnJpZGdlIGVu
ZHBvaW50ICVkXG4iLCBpKTsKPiAgCQkJCXJldCA9IFBUUl9FUlIoYnJpZGdlKTsKPiBAQCAtMjA0
NSw3ICsyMDE5LDcgQEAgaW50IGx0ZGNfbG9hZChzdHJ1Y3QgZHJtX2RldmljZSAqZGRldikKPiAg
CQl9Cj4gIAl9Cj4gIAo+IC0JY3J0YyA9IGRldm1fa3phbGxvYyhkZXYsIHNpemVvZigqY3J0Yyks
IEdGUF9LRVJORUwpOwo+ICsJY3J0YyA9IGRybW1fa3phbGxvYyhkZGV2LCBzaXplb2YoKmNydGMp
LCBHRlBfS0VSTkVMKTsKPiAgCWlmICghY3J0Yykgewo+ICAJCURSTV9FUlJPUigiRmFpbGVkIHRv
IGFsbG9jYXRlIGNydGNcbiIpOwo+ICAJCXJldCA9IC1FTk9NRU07Cj4gQEAgLTIwNzIsOCArMjA0
Niw2IEBAIGludCBsdGRjX2xvYWQoc3RydWN0IGRybV9kZXZpY2UgKmRkZXYpCj4gIAo+ICAJcmV0
dXJuIDA7Cj4gIGVycjoKPiAtCWZvciAoaSA9IDA7IGkgPCBuYl9lbmRwb2ludHM7IGkrKykKPiAt
CQlkcm1fb2ZfcGFuZWxfYnJpZGdlX3JlbW92ZShkZGV2LT5kZXYtPm9mX25vZGUsIDAsIGkpOwo+
ICAKPiAgCWNsa19kaXNhYmxlX3VucHJlcGFyZShsZGV2LT5waXhlbF9jbGspOwo+ICAKPiBAQCAt
MjA4MiwxNiArMjA1NCw4IEBAIGludCBsdGRjX2xvYWQoc3RydWN0IGRybV9kZXZpY2UgKmRkZXYp
Cj4gIAo+ICB2b2lkIGx0ZGNfdW5sb2FkKHN0cnVjdCBkcm1fZGV2aWNlICpkZGV2KQo+ICB7Cj4g
LQlzdHJ1Y3QgZGV2aWNlICpkZXYgPSBkZGV2LT5kZXY7Cj4gLQlpbnQgbmJfZW5kcG9pbnRzLCBp
Owo+IC0KPiAgCURSTV9ERUJVR19EUklWRVIoIlxuIik7Cj4gIAo+IC0JbmJfZW5kcG9pbnRzID0g
b2ZfZ3JhcGhfZ2V0X2VuZHBvaW50X2NvdW50KGRldi0+b2Zfbm9kZSk7Cj4gLQo+IC0JZm9yIChp
ID0gMDsgaSA8IG5iX2VuZHBvaW50czsgaSsrKQo+IC0JCWRybV9vZl9wYW5lbF9icmlkZ2VfcmVt
b3ZlKGRkZXYtPmRldi0+b2Zfbm9kZSwgMCwgaSk7Cj4gLQo+ICAJcG1fcnVudGltZV9kaXNhYmxl
KGRkZXYtPmRldik7Cj4gIH0KPiAgCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fCkxpbnV4LXN0bTMyIG1haWxpbmcgbGlzdApMaW51eC1zdG0zMkBzdC1tZC1t
YWlsbWFuLnN0b3JtcmVwbHkuY29tCmh0dHBzOi8vc3QtbWQtbWFpbG1hbi5zdG9ybXJlcGx5LmNv
bS9tYWlsbWFuL2xpc3RpbmZvL2xpbnV4LXN0bTMyCg==
