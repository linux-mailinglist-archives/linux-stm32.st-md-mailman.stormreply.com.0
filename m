Return-Path: <linux-stm32-bounces@st-md-mailman.stormreply.com>
X-Original-To: lists+linux-stm32@lfdr.de
Delivered-To: lists+linux-stm32@lfdr.de
Received: from stm-ict-prod-mailman-01.stormreply.prv (st-md-mailman.stormreply.com [52.209.6.89])
	by mail.lfdr.de (Postfix) with ESMTPS id 0B94792A08C
	for <lists+linux-stm32@lfdr.de>; Mon,  8 Jul 2024 12:53:06 +0200 (CEST)
Received: from ip-172-31-3-47.eu-west-1.compute.internal (localhost [127.0.0.1])
	by stm-ict-prod-mailman-01.stormreply.prv (Postfix) with ESMTP id C2677C6DD96;
	Mon,  8 Jul 2024 10:53:05 +0000 (UTC)
Received: from mail-lf1-f49.google.com (mail-lf1-f49.google.com
 [209.85.167.49])
 (using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits))
 (No client certificate requested)
 by stm-ict-prod-mailman-01.stormreply.prv (Postfix) with ESMTPS id 08A06C78013
 for <linux-stm32@st-md-mailman.stormreply.com>;
 Mon,  8 Jul 2024 10:53:04 +0000 (UTC)
Received: by mail-lf1-f49.google.com with SMTP id
 2adb3069b0e04-52e99060b0dso4131041e87.1
 for <linux-stm32@st-md-mailman.stormreply.com>;
 Mon, 08 Jul 2024 03:53:04 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=baylibre-com.20230601.gappssmtp.com; s=20230601; t=1720435983; x=1721040783;
 darn=st-md-mailman.stormreply.com; 
 h=content-transfer-encoding:mime-version:references:in-reply-to
 :message-id:date:subject:cc:to:from:from:to:cc:subject:date
 :message-id:reply-to;
 bh=yzQ12MBO5tx4hCgekxUxY/qWko2QtfYvPcuwIh1kocA=;
 b=0RMjmqfAIgqmOJrMpsyY/kjxEYHo016VBmQ//ZME5lthSZlWKcHrjtFcFidpQbmRLg
 /mw/KV4L57Z39P27aQbKs1cMOycB+owgvqnLmcbDngxiCXGH8tUFpuNtR0CBaoHVqyUy
 VlONgN3meQAo2N/vkObezB7oe+nvRE705ZAIwx5NsMS/lbZjYgzey8wnUh0uy0TvPvj2
 ETVuyvF4y9LwmfelyDRueEKn4nRC2YCvhbuuZwX5o6eeGHdA84O6bCvlD884b+Q6P8aa
 Og0N+dBf5Lnbm8mgiGSk8Dq8gzpJcWyOl9QBi4thFnEl1sighCfy95uAKV17wpR3G/pV
 rECA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20230601; t=1720435983; x=1721040783;
 h=content-transfer-encoding:mime-version:references:in-reply-to
 :message-id:date:subject:cc:to:from:x-gm-message-state:from:to:cc
 :subject:date:message-id:reply-to;
 bh=yzQ12MBO5tx4hCgekxUxY/qWko2QtfYvPcuwIh1kocA=;
 b=BEIkoCP3To74e/3f40YfiLWbhp6tp6n0tPKccCaZcO6W5ob6QdjbgpuT1iN9/ZnyTT
 +hUlrSpk8PE9MFIN6uEO5fmAPAi7m87ZuFmhcJAIb1wpX4ThQITx8xAAPm578Pb9ikMJ
 SWRyfSkg+6IaqYNLd0D/e1U8/0Qsw6KcUE8Z4NBf2yRmTSUe8ID1+qoPrQ56DP7R6w4J
 oam5uy+HGwNxXSZjGA2zIOzZRk2288KgZZU27cIsWD7bfuiMBw1t4Ex+Iyn5H61dPd7m
 RZzFDoqIXIOV3G6G0lgy4U7h91s78O2fMRbQtED+D1x1+VyIpFfEU02yI4huoOCpUg/8
 e5fw==
X-Forwarded-Encrypted: i=1;
 AJvYcCX/292DM4IbCXD0g8J/am0TMocM5m+HlHrVb5ihd5cl3xO/VR2POI4rrlCawqE2SSTulvX/rvC/sq9ajyCO/ohZDWKBziMMpyugxcx5faADsOo+h9256fRU
X-Gm-Message-State: AOJu0YxPBS8s0jQqcUc9tmSCS3FD64+mvB3om7xhKo4mXuArZseD9GVP
 ZKDRKF466Rr3Bqpf9Hgw2CpgrzH1o9UJOUcTosObV/1zF+rbEQceu3gLCA+x0VY=
X-Google-Smtp-Source: AGHT+IHYHbku7YKCTGpHkQcjNl3Wy4XpBMGPUhc+THoxMvdm6tXgsUYD9cCVpSLXZH0OO8CQc1kJSQ==
X-Received: by 2002:a05:6512:312a:b0:52c:ccb4:ec70 with SMTP id
 2adb3069b0e04-52ea0632f20mr7976815e87.22.1720435983217; 
 Mon, 08 Jul 2024 03:53:03 -0700 (PDT)
Received: from localhost (p50915e7b.dip0.t-ipconnect.de. [80.145.94.123])
 by smtp.gmail.com with ESMTPSA id
 5b1f17b1804b1-4264a2ca5casm161986155e9.32.2024.07.08.03.53.02
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Mon, 08 Jul 2024 03:53:02 -0700 (PDT)
From: =?UTF-8?q?Uwe=20Kleine-K=C3=B6nig?= <u.kleine-koenig@baylibre.com>
To: linux-pwm@vger.kernel.org
Date: Mon,  8 Jul 2024 12:52:32 +0200
Message-ID: <69eb4b894ec82a0d53bc14450006a977d82551ec.1720435656.git.u.kleine-koenig@baylibre.com>
X-Mailer: git-send-email 2.43.0
In-Reply-To: <cover.1720435656.git.u.kleine-koenig@baylibre.com>
References: <cover.1720435656.git.u.kleine-koenig@baylibre.com>
MIME-Version: 1.0
X-Developer-Signature: v=1; a=openpgp-sha256; l=17011;
 i=u.kleine-koenig@baylibre.com; h=from:subject:message-id;
 bh=yhsRxTmP+cPE+8kUf176lTv2yrrTFVO2vxSx26zHd0I=;
 b=owEBbQGS/pANAwAKAY+A+1h9Ev5OAcsmYgBmi8T68q3i4AsqKv/3eD7+PVUgJ1AuvSqy1csHu
 PUxhL7FqsGJATMEAAEKAB0WIQQ/gaxpOnoeWYmt/tOPgPtYfRL+TgUCZovE+gAKCRCPgPtYfRL+
 TnmxB/48DbmWoYO+leRSz4W37BtI4ysuXyR392jO9nkgRve/c9SnkG3uBLhg/6QE7spnYoYbe0M
 KPJeGj09jNTwvCcgbISAZvMNyXPkGUgE2JsuLlVKXGCqG1VET81iKxdlGFxFU0xq7VuLvUTfbTB
 7VIAsOEXTvRjUz0Le9XvPqijxpbO0i+C3A7/dU8wvTLPnaU0LZLv5RsOjmQHue9A1BCwa79jmtN
 huhmVxha7Swm270SkzMaSjPNK3buIzx8no5wXG29nuZBFw86qWDWhbUByM1wEap5NPNWiy9azjc
 pz/3FFzKMMprILwMegbBznAx5C8xxK9cb0BscThbWYiT1iKa
X-Developer-Key: i=u.kleine-koenig@baylibre.com; a=openpgp;
 fpr=0D2511F322BFAB1C1580266BE2DCDD9132669BD6
Cc: linux-arm-kernel@lists.infradead.org,
 Maxime Coquelin <mcoquelin.stm32@gmail.com>,
 linux-stm32@st-md-mailman.stormreply.com
Subject: [Linux-stm32] [PATCH 6/6] pwm: stm32: Implementation of the
	waveform callbacks
X-BeenThere: linux-stm32@st-md-mailman.stormreply.com
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: <linux-stm32.st-md-mailman.stormreply.com>
List-Unsubscribe: <https://st-md-mailman.stormreply.com/mailman/options/linux-stm32>, 
 <mailto:linux-stm32-request@st-md-mailman.stormreply.com?subject=unsubscribe>
List-Archive: <http://st-md-mailman.stormreply.com/pipermail/linux-stm32/>
List-Post: <mailto:linux-stm32@st-md-mailman.stormreply.com>
List-Help: <mailto:linux-stm32-request@st-md-mailman.stormreply.com?subject=help>
List-Subscribe: <https://st-md-mailman.stormreply.com/mailman/listinfo/linux-stm32>, 
 <mailto:linux-stm32-request@st-md-mailman.stormreply.com?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: linux-stm32-bounces@st-md-mailman.stormreply.com
Sender: "Linux-stm32" <linux-stm32-bounces@st-md-mailman.stormreply.com>

Q29udmVydCB0aGUgc3RtMzIgcHdtIGRyaXZlciB0byB1c2UgdGhlIG5ldyBjYWxsYmFja3MgZm9y
IGhhcmR3YXJlCnByb2dyYW1taW5nLgoKU2lnbmVkLW9mZi1ieTogVXdlIEtsZWluZS1Lw7ZuaWcg
PHUua2xlaW5lLWtvZW5pZ0BiYXlsaWJyZS5jb20+Ci0tLQogZHJpdmVycy9wd20vcHdtLXN0bTMy
LmMgfCA2MDUgKysrKysrKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0tLQogMSBmaWxl
IGNoYW5nZWQsIDM4NCBpbnNlcnRpb25zKCspLCAyMjEgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9wd20vcHdtLXN0bTMyLmMgYi9kcml2ZXJzL3B3bS9wd20tc3RtMzIuYwppbmRl
eCBmZDc1NGE5OWNmMmUuLjRkZWRmYWJjZTYzYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9wd20vcHdt
LXN0bTMyLmMKKysrIGIvZHJpdmVycy9wd20vcHdtLXN0bTMyLmMKQEAgLTUxLDYgKzUxLDM4NCBA
QCBzdGF0aWMgdTMyIGFjdGl2ZV9jaGFubmVscyhzdHJ1Y3Qgc3RtMzJfcHdtICpkZXYpCiAJcmV0
dXJuIGNjZXIgJiBUSU1fQ0NFUl9DQ1hFOwogfQogCitzdHJ1Y3Qgc3RtMzJfcHdtX3dhdmVmb3Jt
IHsKKwl1MzIgY2NlcjsKKwl1MzIgcHNjOworCXUzMiBhcnI7CisJdTMyIGNjcjsKK307CisKK3N0
YXRpYyBpbnQgc3RtMzJfcHdtX3JvdW5kX3dhdmVmb3JtX3RvaHcoc3RydWN0IHB3bV9jaGlwICpj
aGlwLAorCQkJCQkgc3RydWN0IHB3bV9kZXZpY2UgKnB3bSwKKwkJCQkJIGNvbnN0IHN0cnVjdCBw
d21fd2F2ZWZvcm0gKndmLAorCQkJCQkgdm9pZCAqX3dmaHcpCit7CisJc3RydWN0IHN0bTMyX3B3
bV93YXZlZm9ybSAqd2ZodyA9IF93Zmh3OworCXN0cnVjdCBzdG0zMl9wd20gKnByaXYgPSB0b19z
dG0zMl9wd21fZGV2KGNoaXApOworCXVuc2lnbmVkIGludCBjaCA9IHB3bS0+aHdwd207CisJdW5z
aWduZWQgbG9uZyByYXRlOworCXU2NCBjY3IsIGR1dHk7CisJaW50IHJldDsKKworCWlmICh3Zi0+
cGVyaW9kX2xlbmd0aCA9PSAwKSB7CisJCSp3Zmh3ID0gKHN0cnVjdCBzdG0zMl9wd21fd2F2ZWZv
cm0peworCQkJLmNjZXIgPSAwLAorCQl9OworCisJCXJldHVybiAwOworCX0KKworCXJldCA9IGNs
a19lbmFibGUocHJpdi0+Y2xrKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJd2Zody0+
Y2NlciA9IFRJTV9DQ0VSX0NDeEUoY2ggKyAxKTsKKwlpZiAocHJpdi0+aGF2ZV9jb21wbGVtZW50
YXJ5X291dHB1dCkKKwkJd2Zody0+Y2NlciA9IFRJTV9DQ0VSX0NDeE5FKGNoKTsKKworCXJhdGUg
PSBjbGtfZ2V0X3JhdGUocHJpdi0+Y2xrKTsKKworCWlmIChhY3RpdmVfY2hhbm5lbHMocHJpdikg
JiB+KDEgPDwgY2ggKiA0KSkgeworCQl1NjQgYXJyOworCisJCS8qCisJCSAqIE90aGVyIGNoYW5u
ZWxzIGFyZSBhbHJlYWR5IGVuYWJsZWQsIHNvIHRoZSBjb25maWd1cmVkIFBTQyBhbmQKKwkJICog
QVJSIG11c3QgYmUgdXNlZCBmb3IgdGhpcyBjaGFubmVsLCB0b28uCisJCSAqLworCQlyZXQgPSBy
ZWdtYXBfcmVhZChwcml2LT5yZWdtYXAsIFRJTV9QU0MsICZ3Zmh3LT5wc2MpOworCQlpZiAocmV0
KQorCQkJZ290byBvdXQ7CisKKwkJcmV0ID0gcmVnbWFwX3JlYWQocHJpdi0+cmVnbWFwLCBUSU1f
QVJSLCAmd2Zody0+YXJyKTsKKwkJaWYgKHJldCkKKwkJCWdvdG8gb3V0OworCisJCS8qCisJCSAq
IGNhbGN1bGF0ZSB0aGUgYmVzdCB2YWx1ZSBmb3IgQVJSIGZvciB0aGUgZ2l2ZW4gUFNDLCByZWZ1
c2UgaWYKKwkJICogdGhlIHJlc3VsdGluZyBwZXJpb2QgZ2V0cyBiaWdnZXIgdGhhbiB0aGUgcmVx
dWVzdGVkIG9uZS4KKwkJICovCisJCWFyciA9IG11bF91NjRfdTY0X2Rpdl91NjQod2YtPnBlcmlv
ZF9sZW5ndGgsIHJhdGUsCisJCQkJCSAgKHU2NClOU0VDX1BFUl9TRUMgKiAod2Zody0+cHNjICsg
MSkpOworCQlpZiAoYXJyIDw9IHdmaHctPmFycikgeworCQkJLyoKKwkJCSAqIHJlcXVlc3RlZCBw
ZXJpb2QgaXMgc21hbGwgdGhhbiB0aGUgY3VycmVudGx5CisJCQkgKiBjb25maWd1cmVkIGFuZCB1
bmNoYW5nYWJsZSBwZXJpb2QsIHJlcG9ydCBiYWNrIHRoZSBzbWFsbGVzdAorCQkJICogcG9zc2li
bGUgcGVyaW9kLCBpLmUuIHRoZSBjdXJyZW50IHN0YXRlOyBJbml0aWFsaXplCisJCQkgKiBjY3Ig
dG8gYW55dGhpbmcgdmFsaWQuCisJCQkgKi8KKwkJCXdmaHctPmNjciA9IDA7CisJCQlyZXQgPSAx
OworCQkJZ290byBvdXQ7CisJCX0KKworCX0gZWxzZSB7CisJCS8qCisJCSAqIC5wcm9iZSgpIGFz
c2VydGVkIHRoYXQgY2xrX2dldF9yYXRlKCkgaXMgbm90IGJpZ2dlciB0aGFuIDEgR0h6LCBzbwor
CQkgKiB0aGUgY2FsY3VsYXRpb25zIGhlcmUgd29uJ3Qgb3ZlcmZsb3cuCisJCSAqIEZpcnN0IHdl
IG5lZWQgdG8gZmluZCB0aGUgbWluaW1hbCB2YWx1ZSBmb3IgcHJlc2NhbGVyIHN1Y2ggdGhhdAor
CQkgKgorCQkgKiAgICAgICAgcGVyaW9kX25zICogY2xrcmF0ZQorCQkgKiAgIC0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLSA8IG1heF9hcnIgKyAxCisJCSAqICAgTlNFQ19QRVJfU0VDICog
KHByZXNjYWxlciArIDEpCisJCSAqCisJCSAqIFRoaXMgZXF1YXRpb24gaXMgZXF1aXZhbGVudCB0
bworCQkgKgorCQkgKiAgICAgICAgcGVyaW9kX25zICogY2xrcmF0ZQorCQkgKiAgIC0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0gPCBwcmVzY2FsZXIgKyAxCisJCSAqICAgTlNFQ19QRVJfU0VD
ICogKG1heF9hcnIgKyAxKQorCQkgKgorCQkgKiBVc2luZyBpbnRlZ2VyIGRpdmlzaW9uIGFuZCBr
bm93aW5nIHRoYXQgdGhlIHJpZ2h0IGhhbmQgc2lkZSBpcworCQkgKiBpbnRlZ2VyLCB0aGlzIGlz
IGZ1cnRoZXIgZXF1aXZhbGVudCB0bworCQkgKgorCQkgKiAgIChwZXJpb2RfbnMgKiBjbGtyYXRl
KSAvLyAoTlNFQ19QRVJfU0VDICogKG1heF9hcnIgKyAxKSkg4omkIHByZXNjYWxlcgorCQkgKi8K
KwkJdTY0IHBzYyA9IG11bF91NjRfdTY0X2Rpdl91NjQod2YtPnBlcmlvZF9sZW5ndGgsIHJhdGUs
CisJCQkJCSAgICAgICh1NjQpTlNFQ19QRVJfU0VDICogKCh1NjQpcHJpdi0+bWF4X2FyciArIDEp
KTsKKwkJdTY0IGFycjsKKworCQl3Zmh3LT5wc2MgPSBtaW5fdCh1NjQsIHBzYywgTUFYX1RJTV9Q
U0MpOworCisJCWFyciA9IG11bF91NjRfdTY0X2Rpdl91NjQod2YtPnBlcmlvZF9sZW5ndGgsIHJh
dGUsCisJCQkJCSAgKHU2NClOU0VDX1BFUl9TRUMgKiAod2Zody0+cHNjICsgMSkpOworCQlpZiAo
IWFycikgeworCQkJLyoKKwkJCSAqIHJlcXVlc3RlZCBwZXJpb2QgaXMgdG9vIHNtYWxsLCByZXBv
cnQgYmFjayB0aGUgc21hbGxlc3QKKwkJCSAqIHBvc3NpYmxlIHBlcmlvZCwgaS5lLiBBUlIgPSAw
LiBUaGUgb25seSB2YWxpZCBDQ1IKKwkJCSAqIHZhbHVlIGlzIHRoZW4gemVybywgdG9vLgorCQkJ
ICovCisJCQl3Zmh3LT5hcnIgPSAwOworCQkJd2Zody0+Y2NyID0gMDsKKwkJCXJldCA9IDE7CisJ
CQlnb3RvIG91dDsKKwkJfQorCisJCS8qCisJCSAqIEFSUiBpcyBsaW1pdGVkIGludGVudGlvbmFs
bHkgdG8gdmFsdWVzIGxlc3MgdGhhbgorCQkgKiBwcml2LT5tYXhfYXJyIHRvIGFsbG93IDEwMCUg
ZHV0eSBjeWNsZS4KKwkJICovCisJCXdmaHctPmFyciA9IG1pbl90KHU2NCwgYXJyLCBwcml2LT5t
YXhfYXJyKSAtIDE7CisJfQorCisJZHV0eSA9IG11bF91NjRfdTY0X2Rpdl91NjQod2YtPmR1dHlf
bGVuZ3RoLCByYXRlLAorCQkJCSAgICh1NjQpTlNFQ19QRVJfU0VDICogKHdmaHctPnBzYyArIDEp
KTsKKwlkdXR5ID0gbWluX3QodTY0LCBkdXR5LCB3Zmh3LT5hcnIgKyAxKTsKKworCWlmICh3Zi0+
ZHV0eV9sZW5ndGggJiYgd2YtPmR1dHlfb2Zmc2V0ICYmCisJICAgIHdmLT5kdXR5X2xlbmd0aCAr
IHdmLT5kdXR5X29mZnNldCA+PSB3Zi0+cGVyaW9kX2xlbmd0aCkgeworCQl3Zmh3LT5jY2VyIHw9
IFRJTV9DQ0VSX0NDeFAoY2ggKyAxKTsKKwkJaWYgKHByaXYtPmhhdmVfY29tcGxlbWVudGFyeV9v
dXRwdXQpCisJCQl3Zmh3LT5jY2VyIHw9IFRJTV9DQ0VSX0NDeE5QKGNoICsgMSk7CisKKwkJY2Ny
ID0gd2Zody0+YXJyICsgMSAtIGR1dHk7CisJfSBlbHNlIHsKKwkJY2NyID0gZHV0eTsKKwl9CisK
Kwl3Zmh3LT5jY3IgPSBtaW5fdCh1NjQsIGNjciwgd2Zody0+YXJyICsgMSk7CisKKwlkZXZfZGJn
KCZjaGlwLT5kZXYsICJwd20jJXU6ICVsbGQvJWxsZCBbKyVsbGRdIEAlbHUgLT4gQ0NFUjogJTA4
eCwgUFNDOiAlMDh4LCBBUlI6ICUwOHgsIENDUjogJTA4eFxuIiwKKwkJcHdtLT5od3B3bSwgd2Yt
PmR1dHlfbGVuZ3RoLCB3Zi0+cGVyaW9kX2xlbmd0aCwgd2YtPmR1dHlfb2Zmc2V0LAorCQlyYXRl
LCB3Zmh3LT5jY2VyLCB3Zmh3LT5wc2MsIHdmaHctPmFyciwgd2Zody0+Y2NyKTsKKworb3V0Ogor
CWNsa19kaXNhYmxlKHByaXYtPmNsayk7CisKKwlyZXR1cm4gcmV0OworfQorCisvKgorICogVGhp
cyBzaG91bGQgYmUgbW92ZWQgdG8gbGliL21hdGgvZGl2NjQuYy4gQ3VycmVudGx5IHRoZXJlIGFy
ZSBzb21lIGNoYW5nZXMKKyAqIHBlbmRpbmcgdG8gbXVsX3U2NF91NjRfZGl2X3U2NC4gVXdlIHdp
bGwgY2FyZSBmb3IgdGhhdCB3aGVuIHRoZSBkdXN0IHNldHRsZXMuCisgKi8KK3N0YXRpYyB1NjQg
c3RtMzJfcHdtX211bF91NjRfdTY0X2Rpdl91NjRfcm91bmR1cCh1NjQgYSwgdTY0IGIsIHU2NCBj
KQoreworCXU2NCByZXMgPSBtdWxfdTY0X3U2NF9kaXZfdTY0KGEsIGIsIGMpOworCS8qIFRob3Nl
IG11bHRpcGxpY2F0aW9ucyBtaWdodCBvdmVyZmxvdyBidXQgaXQgZG9lc24ndCBtYXR0ZXIgKi8K
Kwl1NjQgcmVtID0gYSAqIGIgLSBjICogcmVzOworCisJaWYgKHJlbSkKKwkJcmVzICs9IDE7CisK
KwlyZXR1cm4gcmVzOworfQorCitzdGF0aWMgaW50IHN0bTMyX3B3bV9yb3VuZF93YXZlZm9ybV9m
cm9taHcoc3RydWN0IHB3bV9jaGlwICpjaGlwLAorCQkJCQkgICBzdHJ1Y3QgcHdtX2RldmljZSAq
cHdtLAorCQkJCQkgICBjb25zdCB2b2lkICpfd2ZodywKKwkJCQkJICAgc3RydWN0IHB3bV93YXZl
Zm9ybSAqd2YpCit7CisJY29uc3Qgc3RydWN0IHN0bTMyX3B3bV93YXZlZm9ybSAqd2ZodyA9IF93
Zmh3OworCXN0cnVjdCBzdG0zMl9wd20gKnByaXYgPSB0b19zdG0zMl9wd21fZGV2KGNoaXApOwor
CXVuc2lnbmVkIGludCBjaCA9IHB3bS0+aHdwd207CisKKwlpZiAod2Zody0+Y2NlciAmIFRJTV9D
Q0VSX0NDeEUoY2ggKyAxKSkgeworCQl1bnNpZ25lZCBsb25nIHJhdGUgPSBjbGtfZ2V0X3JhdGUo
cHJpdi0+Y2xrKTsKKwkJdTY0IGNjcl9uczsKKworCQkvKiBUaGUgcmVzdWx0IGRvZXNuJ3Qgb3Zl
cmZsb3cgZm9yIHJhdGUgPj0gMTUyNTkgKi8KKwkJd2YtPnBlcmlvZF9sZW5ndGggPSBzdG0zMl9w
d21fbXVsX3U2NF91NjRfZGl2X3U2NF9yb3VuZHVwKCgodTY0KXdmaHctPnBzYyArIDEpICogKHdm
aHctPmFyciArIDEpLCBOU0VDX1BFUl9TRUMsIHJhdGUpOworCisJCWNjcl9ucyA9IHN0bTMyX3B3
bV9tdWxfdTY0X3U2NF9kaXZfdTY0X3JvdW5kdXAoKCh1NjQpd2Zody0+cHNjICsgMSkgKiB3Zmh3
LT5jY3IsIE5TRUNfUEVSX1NFQywgcmF0ZSk7CisKKwkJaWYgKHdmaHctPmNjZXIgJiBUSU1fQ0NF
Ul9DQ3hQKGNoICsgMSkpIHsKKwkJCXdmLT5kdXR5X2xlbmd0aCA9CisJCQkJc3RtMzJfcHdtX211
bF91NjRfdTY0X2Rpdl91NjRfcm91bmR1cCgoKHU2NCl3Zmh3LT5wc2MgKyAxKSAqICh3Zmh3LT5h
cnIgKyAxIC0gd2Zody0+Y2NyKSwKKwkJCQkJCQkJICAgICAgTlNFQ19QRVJfU0VDLCByYXRlKTsK
KworCQkJd2YtPmR1dHlfb2Zmc2V0ID0gY2NyX25zOworCQl9IGVsc2UgeworCQkJd2YtPmR1dHlf
bGVuZ3RoID0gY2NyX25zOworCQkJd2YtPmR1dHlfb2Zmc2V0ID0gMDsKKwkJfQorCX0gZWxzZSB7
CisJCSp3ZiA9IChzdHJ1Y3QgcHdtX3dhdmVmb3JtKXsKKwkJCS5wZXJpb2RfbGVuZ3RoID0gMCwK
KwkJfTsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBzdG0zMl9wd21fcmVhZF93
YXZlZm9ybShzdHJ1Y3QgcHdtX2NoaXAgKmNoaXAsCisJCQkJICAgICBzdHJ1Y3QgcHdtX2Rldmlj
ZSAqcHdtLAorCQkJCSAgICAgdm9pZCAqX3dmaHcpCit7CisJc3RydWN0IHN0bTMyX3B3bV93YXZl
Zm9ybSAqd2ZodyA9IF93Zmh3OworCXN0cnVjdCBzdG0zMl9wd20gKnByaXYgPSB0b19zdG0zMl9w
d21fZGV2KGNoaXApOworCXVuc2lnbmVkIGludCBjaCA9IHB3bS0+aHdwd207CisJaW50IHJldDsK
KworCXJldCA9IGNsa19lbmFibGUocHJpdi0+Y2xrKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0
OworCisJcmV0ID0gcmVnbWFwX3JlYWQocHJpdi0+cmVnbWFwLCBUSU1fQ0NFUiwgJndmaHctPmNj
ZXIpOworCWlmIChyZXQpCisJCWdvdG8gb3V0OworCisJaWYgKHdmaHctPmNjZXIgJiBUSU1fQ0NF
Ul9DQ3hFKGNoICsgMSkpIHsKKwkJcmV0ID0gcmVnbWFwX3JlYWQocHJpdi0+cmVnbWFwLCBUSU1f
UFNDLCAmd2Zody0+cHNjKTsKKwkJaWYgKHJldCkKKwkJCWdvdG8gb3V0OworCisJCXJldCA9IHJl
Z21hcF9yZWFkKHByaXYtPnJlZ21hcCwgVElNX0FSUiwgJndmaHctPmFycik7CisJCWlmIChyZXQp
CisJCQlnb3RvIG91dDsKKworCQlpZiAod2Zody0+YXJyID09IFUzMl9NQVgpCisJCQl3Zmh3LT5h
cnIgLT0gMTsKKworCQlyZXQgPSByZWdtYXBfcmVhZChwcml2LT5yZWdtYXAsIFRJTV9DQ1J4KGNo
ICsgMSksICZ3Zmh3LT5jY3IpOworCQlpZiAocmV0KQorCQkJZ290byBvdXQ7CisKKwkJaWYgKHdm
aHctPmNjciA+IHdmaHctPmFyciArIDEpCisJCQl3Zmh3LT5jY3IgPSB3Zmh3LT5hcnIgKyAxOwor
CX0KKworb3V0OgorCWNsa19kaXNhYmxlKHByaXYtPmNsayk7CisKKwlyZXR1cm4gcmV0OworfQor
CitzdGF0aWMgaW50IHN0bTMyX3B3bV93cml0ZV93YXZlZm9ybShzdHJ1Y3QgcHdtX2NoaXAgKmNo
aXAsCisJCQkJICAgICAgc3RydWN0IHB3bV9kZXZpY2UgKnB3bSwKKwkJCQkgICAgICBjb25zdCB2
b2lkICpfd2ZodykKK3sKKwljb25zdCBzdHJ1Y3Qgc3RtMzJfcHdtX3dhdmVmb3JtICp3Zmh3ID0g
X3dmaHc7CisJc3RydWN0IHN0bTMyX3B3bSAqcHJpdiA9IHRvX3N0bTMyX3B3bV9kZXYoY2hpcCk7
CisJdW5zaWduZWQgaW50IGNoID0gcHdtLT5od3B3bTsKKwlpbnQgcmV0OworCisJcmV0ID0gY2xr
X2VuYWJsZShwcml2LT5jbGspOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlpZiAod2Zo
dy0+Y2NlciAmIFRJTV9DQ0VSX0NDeEUoY2ggKyAxKSkgeworCQl1MzIgY2NlciwgbWFzazsKKwkJ
dW5zaWduZWQgc2hpZnQ7CisJCXUzMiBjY21yOworCisJCXJldCA9IHJlZ21hcF9yZWFkKHByaXYt
PnJlZ21hcCwgVElNX0NDRVIsICZjY2VyKTsKKwkJaWYgKHJldCkKKwkJCWdvdG8gb3V0OworCisJ
CS8qIElmIHRoZXJlIGFyZSBvdGhlciBjaGFubmVscyBlbmFibGVkLCBkb24ndCB1cGRhdGUgUFND
IGFuZCBBUlIgKi8KKwkJaWYgKGNjZXIgJiB+VElNX0NDRVJfQ0N4RShjaCArIDEpICYgVElNX0ND
RVJfQ0NYRSkgeworCQkJdTMyIHBzYywgYXJyOworCisJCQlyZXQgPSByZWdtYXBfcmVhZChwcml2
LT5yZWdtYXAsIFRJTV9QU0MsICZwc2MpOworCQkJaWYgKHJldCkKKwkJCQlnb3RvIG91dDsKKwor
CQkJaWYgKHBzYyAhPSB3Zmh3LT5wc2MpIHsKKwkJCQlyZXQgPSAtRUJVU1k7CisJCQkJZ290byBv
dXQ7CisJCQl9CisKKwkJCXJlZ21hcF9yZWFkKHByaXYtPnJlZ21hcCwgVElNX0FSUiwgJmFycik7
CisJCQlpZiAocmV0KQorCQkJCWdvdG8gb3V0OworCisJCQlpZiAoYXJyICE9IHdmaHctPmFycikg
eworCQkJCXJldCA9IC1FQlVTWTsKKwkJCQlnb3RvIG91dDsKKwkJCX0KKwkJfSBlbHNlIHsKKwkJ
CXJldCA9IHJlZ21hcF93cml0ZShwcml2LT5yZWdtYXAsIFRJTV9QU0MsIHdmaHctPnBzYyk7CisJ
CQlpZiAocmV0KQorCQkJCWdvdG8gb3V0OworCisJCQlyZXQgPSByZWdtYXBfd3JpdGUocHJpdi0+
cmVnbWFwLCBUSU1fQVJSLCB3Zmh3LT5hcnIpOworCQkJaWYgKHJldCkKKwkJCQlnb3RvIG91dDsK
KworCQkJcmV0ID0gcmVnbWFwX3NldF9iaXRzKHByaXYtPnJlZ21hcCwgVElNX0NSMSwgVElNX0NS
MV9BUlBFKTsKKwkJCWlmIChyZXQpCisJCQkJZ290byBvdXQ7CisKKwkJfQorCisJCS8qIHNldCBw
b2xhcml0eSAqLworCQltYXNrID0gVElNX0NDRVJfQ0N4UChjaCArIDEpIHwgVElNX0NDRVJfQ0N4
TlAoY2ggKyAxKTsKKwkJcmV0ID0gcmVnbWFwX3VwZGF0ZV9iaXRzKHByaXYtPnJlZ21hcCwgVElN
X0NDRVIsIG1hc2ssIHdmaHctPmNjZXIpOworCQlpZiAocmV0KQorCQkJZ290byBvdXQ7CisKKwkJ
cmV0ID0gcmVnbWFwX3dyaXRlKHByaXYtPnJlZ21hcCwgVElNX0NDUngoY2ggKyAxKSwgd2Zody0+
Y2NyKTsKKwkJaWYgKHJldCkKKwkJCWdvdG8gb3V0OworCisJCS8qIENvbmZpZ3VyZSBvdXRwdXQg
bW9kZSAqLworCQlzaGlmdCA9IChjaCAmIDB4MSkgKiBDQ01SX0NIQU5ORUxfU0hJRlQ7CisJCWNj
bXIgPSAoVElNX0NDTVJfUEUgfCBUSU1fQ0NNUl9NMSkgPDwgc2hpZnQ7CisJCW1hc2sgPSBDQ01S
X0NIQU5ORUxfTUFTSyA8PCBzaGlmdDsKKworCQlpZiAoY2ggPCAyKQorCQkJcmV0ID0gcmVnbWFw
X3VwZGF0ZV9iaXRzKHByaXYtPnJlZ21hcCwgVElNX0NDTVIxLCBtYXNrLCBjY21yKTsKKwkJZWxz
ZQorCQkJcmV0ID0gcmVnbWFwX3VwZGF0ZV9iaXRzKHByaXYtPnJlZ21hcCwgVElNX0NDTVIyLCBt
YXNrLCBjY21yKTsKKwkJaWYgKHJldCkKKwkJCWdvdG8gb3V0OworCisJCXJldCA9IHJlZ21hcF9z
ZXRfYml0cyhwcml2LT5yZWdtYXAsIFRJTV9CRFRSLCBUSU1fQkRUUl9NT0UpOworCQlpZiAocmV0
KQorCQkJZ290byBvdXQ7CisKKwkJaWYgKCEoY2NlciAmIFRJTV9DQ0VSX0NDeEUoY2ggKyAxKSkp
IHsKKwkJCW1hc2sgPSBUSU1fQ0NFUl9DQ3hFKGNoICsgMSkgfCBUSU1fQ0NFUl9DQ3hORShjaCAr
IDEpOworCisJCQlyZXQgPSBjbGtfZW5hYmxlKHByaXYtPmNsayk7CisJCQlpZiAocmV0KQorCQkJ
CWdvdG8gb3V0OworCisJCQljY2VyID0gKGNjZXIgJiB+bWFzaykgfCAod2Zody0+Y2NlciAmIG1h
c2spOworCQkJcmVnbWFwX3dyaXRlKHByaXYtPnJlZ21hcCwgVElNX0NDRVIsIGNjZXIpOworCisJ
CQkvKiBNYWtlIHN1cmUgdGhhdCByZWdpc3RlcnMgYXJlIHVwZGF0ZWQgKi8KKwkJCXJlZ21hcF9z
ZXRfYml0cyhwcml2LT5yZWdtYXAsIFRJTV9FR1IsIFRJTV9FR1JfVUcpOworCisJCQkvKiBFbmFi
bGUgY29udHJvbGxlciAqLworCQkJcmVnbWFwX3NldF9iaXRzKHByaXYtPnJlZ21hcCwgVElNX0NS
MSwgVElNX0NSMV9DRU4pOworCQl9CisKKwl9IGVsc2UgeworCQkvKiBkaXNhYmxlIGNoYW5uZWwg
Ki8KKwkJdTMyIG1hc2ssIGNjZXI7CisKKwkJbWFzayA9IFRJTV9DQ0VSX0NDeEUoY2ggKyAxKTsK
KwkJaWYgKHByaXYtPmhhdmVfY29tcGxlbWVudGFyeV9vdXRwdXQpCisJCQltYXNrIHw9IFRJTV9D
Q0VSX0NDeE5FKGNoICsgMSk7CisKKwkJcmV0ID0gcmVnbWFwX3JlYWQocHJpdi0+cmVnbWFwLCBU
SU1fQ0NFUiwgJmNjZXIpOworCQlpZiAocmV0KQorCQkJZ290byBvdXQ7CisKKwkJaWYgKGNjZXIg
JiBtYXNrKSB7CisJCQljY2VyID0gY2NlciAmIH5tYXNrOworCisJCQlyZXQgPSByZWdtYXBfd3Jp
dGUocHJpdi0+cmVnbWFwLCBUSU1fQ0NFUiwgY2Nlcik7CisJCQlpZiAocmV0KQorCQkJCWdvdG8g
b3V0OworCisJCQlpZiAoIShjY2VyICYgVElNX0NDRVJfQ0NYRSkpIHsKKwkJCQkvKiBXaGVuIGFs
bCBjaGFubmVscyBhcmUgZGlzYWJsZWQsIHdlIGNhbiBkaXNhYmxlIHRoZSBjb250cm9sbGVyICov
CisJCQkJcmV0ID0gcmVnbWFwX2NsZWFyX2JpdHMocHJpdi0+cmVnbWFwLCBUSU1fQ1IxLCBUSU1f
Q1IxX0NFTik7CisJCQkJaWYgKHJldCkKKwkJCQkJZ290byBvdXQ7CisJCQl9CisKKwkJCWNsa19k
aXNhYmxlKHByaXYtPmNsayk7CisJCX0KKwl9CisKK291dDoKKwljbGtfZGlzYWJsZShwcml2LT5j
bGspOworCisJcmV0dXJuIHJldDsKK30KKwogI2RlZmluZSBUSU1fQ0NFUl9DQzEyUCAoVElNX0ND
RVJfQ0MxUCB8IFRJTV9DQ0VSX0NDMlApCiAjZGVmaW5lIFRJTV9DQ0VSX0NDMTJFIChUSU1fQ0NF
Ul9DQzFFIHwgVElNX0NDRVJfQ0MyRSkKICNkZWZpbmUgVElNX0NDRVJfQ0MzNFAgKFRJTV9DQ0VS
X0NDM1AgfCBUSU1fQ0NFUl9DQzRQKQpAQCAtMzA4LDIyOCArNjg2LDEzIEBAIHN0YXRpYyBpbnQg
c3RtMzJfcHdtX2NhcHR1cmUoc3RydWN0IHB3bV9jaGlwICpjaGlwLCBzdHJ1Y3QgcHdtX2Rldmlj
ZSAqcHdtLAogCXJldHVybiByZXQ7CiB9CiAKLXN0YXRpYyBpbnQgc3RtMzJfcHdtX2NvbmZpZyhz
dHJ1Y3Qgc3RtMzJfcHdtICpwcml2LCB1bnNpZ25lZCBpbnQgY2gsCi0JCQkgICAgdTY0IGR1dHlf
bnMsIHU2NCBwZXJpb2RfbnMpCi17Ci0JdW5zaWduZWQgbG9uZyBsb25nIHByZCwgZHR5OwotCXVu
c2lnbmVkIGxvbmcgbG9uZyBwcmVzY2FsZXI7Ci0JdTMyIGNjbXIsIG1hc2ssIHNoaWZ0OwotCi0J
LyoKLQkgKiAucHJvYmUoKSBhc3NlcnRlZCB0aGF0IGNsa19nZXRfcmF0ZSgpIGlzIG5vdCBiaWdn
ZXIgdGhhbiAxIEdIeiwgc28KLQkgKiB0aGUgY2FsY3VsYXRpb25zIGhlcmUgd29uJ3Qgb3ZlcmZs
b3cuCi0JICogRmlyc3Qgd2UgbmVlZCB0byBmaW5kIHRoZSBtaW5pbWFsIHZhbHVlIGZvciBwcmVz
Y2FsZXIgc3VjaCB0aGF0Ci0JICoKLQkgKiAgICAgICAgcGVyaW9kX25zICogY2xrcmF0ZQotCSAq
ICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIDwgbWF4X2FyciArIDEKLQkgKiAgIE5T
RUNfUEVSX1NFQyAqIChwcmVzY2FsZXIgKyAxKQotCSAqCi0JICogVGhpcyBlcXVhdGlvbiBpcyBl
cXVpdmFsZW50IHRvCi0JICoKLQkgKiAgICAgICAgcGVyaW9kX25zICogY2xrcmF0ZQotCSAqICAg
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSA8IHByZXNjYWxlciArIDEKLQkgKiAgIE5TRUNf
UEVSX1NFQyAqIChtYXhfYXJyICsgMSkKLQkgKgotCSAqIFVzaW5nIGludGVnZXIgZGl2aXNpb24g
YW5kIGtub3dpbmcgdGhhdCB0aGUgcmlnaHQgaGFuZCBzaWRlIGlzCi0JICogaW50ZWdlciwgdGhp
cyBpcyBmdXJ0aGVyIGVxdWl2YWxlbnQgdG8KLQkgKgotCSAqICAgKHBlcmlvZF9ucyAqIGNsa3Jh
dGUpIC8vIChOU0VDX1BFUl9TRUMgKiAobWF4X2FyciArIDEpKSDiiaQgcHJlc2NhbGVyCi0JICov
Ci0KLQlwcmVzY2FsZXIgPSBtdWxfdTY0X3U2NF9kaXZfdTY0KHBlcmlvZF9ucywgY2xrX2dldF9y
YXRlKHByaXYtPmNsayksCi0JCQkJCSh1NjQpTlNFQ19QRVJfU0VDICogKCh1NjQpcHJpdi0+bWF4
X2FyciArIDEpKTsKLQlpZiAocHJlc2NhbGVyID4gTUFYX1RJTV9QU0MpCi0JCXJldHVybiAtRUlO
VkFMOwotCi0JcHJkID0gbXVsX3U2NF91NjRfZGl2X3U2NChwZXJpb2RfbnMsIGNsa19nZXRfcmF0
ZShwcml2LT5jbGspLAotCQkJCSAgKHU2NClOU0VDX1BFUl9TRUMgKiAocHJlc2NhbGVyICsgMSkp
OwotCWlmICghcHJkKQotCQlyZXR1cm4gLUVJTlZBTDsKLQotCS8qCi0JICogQWxsIGNoYW5uZWxz
IHNoYXJlIHRoZSBzYW1lIHByZXNjYWxlciBhbmQgY291bnRlciBzbyB3aGVuIHR3bwotCSAqIGNo
YW5uZWxzIGFyZSBhY3RpdmUgYXQgdGhlIHNhbWUgdGltZSB3ZSBjYW4ndCBjaGFuZ2UgdGhlbQot
CSAqLwotCWlmIChhY3RpdmVfY2hhbm5lbHMocHJpdikgJiB+KDEgPDwgY2ggKiA0KSkgewotCQl1
MzIgcHNjLCBhcnI7Ci0KLQkJcmVnbWFwX3JlYWQocHJpdi0+cmVnbWFwLCBUSU1fUFNDLCAmcHNj
KTsKLQkJcmVnbWFwX3JlYWQocHJpdi0+cmVnbWFwLCBUSU1fQVJSLCAmYXJyKTsKLQotCQlpZiAo
KHBzYyAhPSBwcmVzY2FsZXIpIHx8IChhcnIgIT0gcHJkIC0gMSkpCi0JCQlyZXR1cm4gLUVCVVNZ
OwotCX0KLQotCXJlZ21hcF93cml0ZShwcml2LT5yZWdtYXAsIFRJTV9QU0MsIHByZXNjYWxlcik7
Ci0JcmVnbWFwX3dyaXRlKHByaXYtPnJlZ21hcCwgVElNX0FSUiwgcHJkIC0gMSk7Ci0JcmVnbWFw
X3NldF9iaXRzKHByaXYtPnJlZ21hcCwgVElNX0NSMSwgVElNX0NSMV9BUlBFKTsKLQotCS8qIENh
bGN1bGF0ZSB0aGUgZHV0eSBjeWNsZXMgKi8KLQlkdHkgPSBtdWxfdTY0X3U2NF9kaXZfdTY0KGR1
dHlfbnMsIGNsa19nZXRfcmF0ZShwcml2LT5jbGspLAotCQkJCSAgKHU2NClOU0VDX1BFUl9TRUMg
KiAocHJlc2NhbGVyICsgMSkpOwotCi0JcmVnbWFwX3dyaXRlKHByaXYtPnJlZ21hcCwgVElNX0ND
UngoY2ggKyAxKSwgZHR5KTsKLQotCS8qIENvbmZpZ3VyZSBvdXRwdXQgbW9kZSAqLwotCXNoaWZ0
ID0gKGNoICYgMHgxKSAqIENDTVJfQ0hBTk5FTF9TSElGVDsKLQljY21yID0gKFRJTV9DQ01SX1BF
IHwgVElNX0NDTVJfTTEpIDw8IHNoaWZ0OwotCW1hc2sgPSBDQ01SX0NIQU5ORUxfTUFTSyA8PCBz
aGlmdDsKLQotCWlmIChjaCA8IDIpCi0JCXJlZ21hcF91cGRhdGVfYml0cyhwcml2LT5yZWdtYXAs
IFRJTV9DQ01SMSwgbWFzaywgY2Ntcik7Ci0JZWxzZQotCQlyZWdtYXBfdXBkYXRlX2JpdHMocHJp
di0+cmVnbWFwLCBUSU1fQ0NNUjIsIG1hc2ssIGNjbXIpOwotCi0JcmVnbWFwX3NldF9iaXRzKHBy
aXYtPnJlZ21hcCwgVElNX0JEVFIsIFRJTV9CRFRSX01PRSk7Ci0KLQlyZXR1cm4gMDsKLX0KLQot
c3RhdGljIGludCBzdG0zMl9wd21fc2V0X3BvbGFyaXR5KHN0cnVjdCBzdG0zMl9wd20gKnByaXYs
IHVuc2lnbmVkIGludCBjaCwKLQkJCQkgIGVudW0gcHdtX3BvbGFyaXR5IHBvbGFyaXR5KQotewot
CXUzMiBtYXNrOwotCi0JbWFzayA9IFRJTV9DQ0VSX0NDeFAoY2ggKyAxKTsKLQlpZiAocHJpdi0+
aGF2ZV9jb21wbGVtZW50YXJ5X291dHB1dCkKLQkJbWFzayB8PSBUSU1fQ0NFUl9DQ3hOUChjaCAr
IDEpOwotCi0JcmVnbWFwX3VwZGF0ZV9iaXRzKHByaXYtPnJlZ21hcCwgVElNX0NDRVIsIG1hc2ss
Ci0JCQkgICBwb2xhcml0eSA9PSBQV01fUE9MQVJJVFlfTk9STUFMID8gMCA6IG1hc2spOwotCi0J
cmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyBpbnQgc3RtMzJfcHdtX2VuYWJsZShzdHJ1Y3Qgc3RtMzJf
cHdtICpwcml2LCB1bnNpZ25lZCBpbnQgY2gpCi17Ci0JdTMyIG1hc2s7Ci0JaW50IHJldDsKLQot
CXJldCA9IGNsa19lbmFibGUocHJpdi0+Y2xrKTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0Owot
Ci0JLyogRW5hYmxlIGNoYW5uZWwgKi8KLQltYXNrID0gVElNX0NDRVJfQ0N4RShjaCArIDEpOwot
CWlmIChwcml2LT5oYXZlX2NvbXBsZW1lbnRhcnlfb3V0cHV0KQotCQltYXNrIHw9IFRJTV9DQ0VS
X0NDeE5FKGNoKTsKLQotCXJlZ21hcF9zZXRfYml0cyhwcml2LT5yZWdtYXAsIFRJTV9DQ0VSLCBt
YXNrKTsKLQotCS8qIE1ha2Ugc3VyZSB0aGF0IHJlZ2lzdGVycyBhcmUgdXBkYXRlZCAqLwotCXJl
Z21hcF9zZXRfYml0cyhwcml2LT5yZWdtYXAsIFRJTV9FR1IsIFRJTV9FR1JfVUcpOwotCi0JLyog
RW5hYmxlIGNvbnRyb2xsZXIgKi8KLQlyZWdtYXBfc2V0X2JpdHMocHJpdi0+cmVnbWFwLCBUSU1f
Q1IxLCBUSU1fQ1IxX0NFTik7Ci0KLQlyZXR1cm4gMDsKLX0KLQotc3RhdGljIHZvaWQgc3RtMzJf
cHdtX2Rpc2FibGUoc3RydWN0IHN0bTMyX3B3bSAqcHJpdiwgdW5zaWduZWQgaW50IGNoKQotewot
CXUzMiBtYXNrOwotCi0JLyogRGlzYWJsZSBjaGFubmVsICovCi0JbWFzayA9IFRJTV9DQ0VSX0ND
eEUoY2ggKyAxKTsKLQlpZiAocHJpdi0+aGF2ZV9jb21wbGVtZW50YXJ5X291dHB1dCkKLQkJbWFz
ayB8PSBUSU1fQ0NFUl9DQ3hORShjaCArIDEpOwotCi0JcmVnbWFwX2NsZWFyX2JpdHMocHJpdi0+
cmVnbWFwLCBUSU1fQ0NFUiwgbWFzayk7Ci0KLQkvKiBXaGVuIGFsbCBjaGFubmVscyBhcmUgZGlz
YWJsZWQsIHdlIGNhbiBkaXNhYmxlIHRoZSBjb250cm9sbGVyICovCi0JaWYgKCFhY3RpdmVfY2hh
bm5lbHMocHJpdikpCi0JCXJlZ21hcF9jbGVhcl9iaXRzKHByaXYtPnJlZ21hcCwgVElNX0NSMSwg
VElNX0NSMV9DRU4pOwotCi0JY2xrX2Rpc2FibGUocHJpdi0+Y2xrKTsKLX0KLQotc3RhdGljIGlu
dCBzdG0zMl9wd21fYXBwbHkoc3RydWN0IHB3bV9jaGlwICpjaGlwLCBzdHJ1Y3QgcHdtX2Rldmlj
ZSAqcHdtLAotCQkJICAgY29uc3Qgc3RydWN0IHB3bV9zdGF0ZSAqc3RhdGUpCi17Ci0JYm9vbCBl
bmFibGVkOwotCXN0cnVjdCBzdG0zMl9wd20gKnByaXYgPSB0b19zdG0zMl9wd21fZGV2KGNoaXAp
OwotCWludCByZXQ7Ci0KLQllbmFibGVkID0gcHdtLT5zdGF0ZS5lbmFibGVkOwotCi0JaWYgKCFz
dGF0ZS0+ZW5hYmxlZCkgewotCQlpZiAoZW5hYmxlZCkKLQkJCXN0bTMyX3B3bV9kaXNhYmxlKHBy
aXYsIHB3bS0+aHdwd20pOwotCQlyZXR1cm4gMDsKLQl9Ci0KLQlpZiAoc3RhdGUtPnBvbGFyaXR5
ICE9IHB3bS0+c3RhdGUucG9sYXJpdHkpCi0JCXN0bTMyX3B3bV9zZXRfcG9sYXJpdHkocHJpdiwg
cHdtLT5od3B3bSwgc3RhdGUtPnBvbGFyaXR5KTsKLQotCXJldCA9IHN0bTMyX3B3bV9jb25maWco
cHJpdiwgcHdtLT5od3B3bSwKLQkJCSAgICAgICBzdGF0ZS0+ZHV0eV9jeWNsZSwgc3RhdGUtPnBl
cmlvZCk7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKLQotCWlmICghZW5hYmxlZCAmJiBzdGF0
ZS0+ZW5hYmxlZCkKLQkJcmV0ID0gc3RtMzJfcHdtX2VuYWJsZShwcml2LCBwd20tPmh3cHdtKTsK
LQotCXJldHVybiByZXQ7Ci19Ci0KLXN0YXRpYyBpbnQgc3RtMzJfcHdtX2FwcGx5X2xvY2tlZChz
dHJ1Y3QgcHdtX2NoaXAgKmNoaXAsIHN0cnVjdCBwd21fZGV2aWNlICpwd20sCi0JCQkJICBjb25z
dCBzdHJ1Y3QgcHdtX3N0YXRlICpzdGF0ZSkKLXsKLQlzdHJ1Y3Qgc3RtMzJfcHdtICpwcml2ID0g
dG9fc3RtMzJfcHdtX2RldihjaGlwKTsKLQlpbnQgcmV0OwotCi0JLyogcHJvdGVjdCBjb21tb24g
cHJlc2NhbGVyIGZvciBhbGwgYWN0aXZlIGNoYW5uZWxzICovCi0JbXV0ZXhfbG9jaygmcHJpdi0+
bG9jayk7Ci0JcmV0ID0gc3RtMzJfcHdtX2FwcGx5KGNoaXAsIHB3bSwgc3RhdGUpOwotCW11dGV4
X3VubG9jaygmcHJpdi0+bG9jayk7Ci0KLQlyZXR1cm4gcmV0OwotfQotCi1zdGF0aWMgaW50IHN0
bTMyX3B3bV9nZXRfc3RhdGUoc3RydWN0IHB3bV9jaGlwICpjaGlwLAotCQkJICAgICAgIHN0cnVj
dCBwd21fZGV2aWNlICpwd20sIHN0cnVjdCBwd21fc3RhdGUgKnN0YXRlKQotewotCXN0cnVjdCBz
dG0zMl9wd20gKnByaXYgPSB0b19zdG0zMl9wd21fZGV2KGNoaXApOwotCWludCBjaCA9IHB3bS0+
aHdwd207Ci0JdW5zaWduZWQgbG9uZyByYXRlOwotCXUzMiBjY2VyLCBwc2MsIGFyciwgY2NyOwot
CXU2NCBkdHksIHByZDsKLQlpbnQgcmV0OwotCi0JbXV0ZXhfbG9jaygmcHJpdi0+bG9jayk7Ci0K
LQlyZXQgPSByZWdtYXBfcmVhZChwcml2LT5yZWdtYXAsIFRJTV9DQ0VSLCAmY2Nlcik7Ci0JaWYg
KHJldCkKLQkJZ290byBvdXQ7Ci0KLQlzdGF0ZS0+ZW5hYmxlZCA9IGNjZXIgJiBUSU1fQ0NFUl9D
Q3hFKGNoICsgMSk7Ci0Jc3RhdGUtPnBvbGFyaXR5ID0gKGNjZXIgJiBUSU1fQ0NFUl9DQ3hQKGNo
ICsgMSkpID8KLQkJCSAgUFdNX1BPTEFSSVRZX0lOVkVSU0VEIDogUFdNX1BPTEFSSVRZX05PUk1B
TDsKLQlyZXQgPSByZWdtYXBfcmVhZChwcml2LT5yZWdtYXAsIFRJTV9QU0MsICZwc2MpOwotCWlm
IChyZXQpCi0JCWdvdG8gb3V0OwotCXJldCA9IHJlZ21hcF9yZWFkKHByaXYtPnJlZ21hcCwgVElN
X0FSUiwgJmFycik7Ci0JaWYgKHJldCkKLQkJZ290byBvdXQ7Ci0JcmV0ID0gcmVnbWFwX3JlYWQo
cHJpdi0+cmVnbWFwLCBUSU1fQ0NSeChjaCArIDEpLCAmY2NyKTsKLQlpZiAocmV0KQotCQlnb3Rv
IG91dDsKLQotCXJhdGUgPSBjbGtfZ2V0X3JhdGUocHJpdi0+Y2xrKTsKLQotCXByZCA9ICh1NjQp
TlNFQ19QRVJfU0VDICogKHBzYyArIDEpICogKGFyciArIDEpOwotCXN0YXRlLT5wZXJpb2QgPSBE
SVZfUk9VTkRfVVBfVUxMKHByZCwgcmF0ZSk7Ci0JZHR5ID0gKHU2NClOU0VDX1BFUl9TRUMgKiAo
cHNjICsgMSkgKiBjY3I7Ci0Jc3RhdGUtPmR1dHlfY3ljbGUgPSBESVZfUk9VTkRfVVBfVUxMKGR0
eSwgcmF0ZSk7Ci0KLW91dDoKLQltdXRleF91bmxvY2soJnByaXYtPmxvY2spOwotCXJldHVybiBy
ZXQ7Ci19Ci0KIHN0YXRpYyBjb25zdCBzdHJ1Y3QgcHdtX29wcyBzdG0zMnB3bV9vcHMgPSB7Ci0J
LmFwcGx5ID0gc3RtMzJfcHdtX2FwcGx5X2xvY2tlZCwKLQkuZ2V0X3N0YXRlID0gc3RtMzJfcHdt
X2dldF9zdGF0ZSwKKwkuc2l6ZW9mX3dmaHcgPSBzaXplb2Yoc3RydWN0IHN0bTMyX3B3bV93YXZl
Zm9ybSksCisJLnJvdW5kX3dhdmVmb3JtX3RvaHcgPSBzdG0zMl9wd21fcm91bmRfd2F2ZWZvcm1f
dG9odywKKwkucm91bmRfd2F2ZWZvcm1fZnJvbWh3ID0gc3RtMzJfcHdtX3JvdW5kX3dhdmVmb3Jt
X2Zyb21odywKKwkucmVhZF93YXZlZm9ybSA9IHN0bTMyX3B3bV9yZWFkX3dhdmVmb3JtLAorCS53
cml0ZV93YXZlZm9ybSA9IHN0bTMyX3B3bV93cml0ZV93YXZlZm9ybSwKKwogCS5jYXB0dXJlID0g
SVNfRU5BQkxFRChDT05GSUdfRE1BX0VOR0lORSkgPyBzdG0zMl9wd21fY2FwdHVyZSA6IE5VTEws
CiB9OwogCi0tIAoyLjQzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fCkxpbnV4LXN0bTMyIG1haWxpbmcgbGlzdApMaW51eC1zdG0zMkBzdC1tZC1tYWls
bWFuLnN0b3JtcmVwbHkuY29tCmh0dHBzOi8vc3QtbWQtbWFpbG1hbi5zdG9ybXJlcGx5LmNvbS9t
YWlsbWFuL2xpc3RpbmZvL2xpbnV4LXN0bTMyCg==
