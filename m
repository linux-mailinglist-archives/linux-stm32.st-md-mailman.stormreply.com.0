Return-Path: <linux-stm32-bounces@st-md-mailman.stormreply.com>
X-Original-To: lists+linux-stm32@lfdr.de
Delivered-To: lists+linux-stm32@lfdr.de
Received: from stm-ict-prod-mailman-01.stormreply.prv (st-md-mailman.stormreply.com [52.209.6.89])
	by mail.lfdr.de (Postfix) with ESMTPS id 592AD3E4678
	for <lists+linux-stm32@lfdr.de>; Mon,  9 Aug 2021 15:23:50 +0200 (CEST)
Received: from ip-172-31-3-76.eu-west-1.compute.internal (localhost [127.0.0.1])
	by stm-ict-prod-mailman-01.stormreply.prv (Postfix) with ESMTP id 082EFC57B51;
	Mon,  9 Aug 2021 13:23:50 +0000 (UTC)
Received: from mail-pj1-f54.google.com (mail-pj1-f54.google.com
 [209.85.216.54])
 (using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits))
 (No client certificate requested)
 by stm-ict-prod-mailman-01.stormreply.prv (Postfix) with ESMTPS id 13BFEC57B51
 for <linux-stm32@st-md-mailman.stormreply.com>;
 Mon,  9 Aug 2021 12:38:06 +0000 (UTC)
Received: by mail-pj1-f54.google.com with SMTP id
 mq2-20020a17090b3802b0290178911d298bso7038278pjb.1
 for <linux-stm32@st-md-mailman.stormreply.com>;
 Mon, 09 Aug 2021 05:38:06 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=iC6nRxYutj4Qd+3zrjWv9QR4N2QF+9IKJL/csb7nCYQ=;
 b=kwyd/DsV7+MFezAhMpM62FtPNdXWlJabEl4QyGRvfxNFAC+DUjZX2S54uIBcYPMxoa
 nQIiFyqRVXuN/pCmuFqofapIaMH9SXBoP0p+RA21V1aDx989/5B7nFBxP8ur0pylhkoD
 5qsehT0FnRDzEjL+vwQUnpK8i5/TQcE3/tuhV8P6J3meBqrcOn24jz6njVIQibHG4rxV
 beIjWiWZIwRbKV7VawhcAK/jH+DxzVVX4WYC6YYLobKvLnbFlzIX5ih5EpMFhlX0IrXw
 96r2JOyBNuXyr06JuQTtFf9Tx1xml6fNyrZc90q4eJexs68YcCHF1b8OrrjTyDOmWlQw
 oeAg==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=iC6nRxYutj4Qd+3zrjWv9QR4N2QF+9IKJL/csb7nCYQ=;
 b=Pfr53VWfOLY1cZ+z+Wxp8LX5AjGtNs/EUoKN6p/UR94rIabl2iYwmsTsCZsfczB5xK
 OpumA1ah9iksrK0FdljudWyHuYw48c0tw/QjzQtl21L6SPwM5HeWo/ZPl3iKMPS2F5++
 ukI/ga7Cua8P/rNAH+A/LCeqUE5oydhL7+mWQq0R4iNTuRn76r7Y+yXt+0dPTpW517Pf
 opaG1uJNRfUENdsXuuN9MpPq+egcKBemyBwJQKbg1ugTfNnN3vLMVkRRxMwMNGmWyVcI
 DS+GOwxrGFW3OqHyr2PWMaCvtbfq/DvfIQ/YXvfm3EWsgPvU9bFgkStAqWSHstmRKvp/
 jOSg==
X-Gm-Message-State: AOAM531jM3j9YR8zp0GNU7+U1Kt1GaFPWUB8PNZp4UvxyN7zx9DzS3ld
 ZXT1czqIfosQbSOk//N6FU0=
X-Google-Smtp-Source: ABdhPJznh0GY6/D5S3JF5qOuI9EQOTzr5tX6scc6J4ddPQ+f2OqR/HR/353GjcKax5DhR/FVy3tXWw==
X-Received: by 2002:a17:90b:1209:: with SMTP id
 gl9mr2613133pjb.148.1628512684367; 
 Mon, 09 Aug 2021 05:38:04 -0700 (PDT)
Received: from localhost.localdomain ([156.146.35.76])
 by smtp.gmail.com with ESMTPSA id e35sm22382177pjk.28.2021.08.09.05.37.58
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Mon, 09 Aug 2021 05:38:03 -0700 (PDT)
From: William Breathitt Gray <vilhelm.gray@gmail.com>
To: jic23@kernel.org
Date: Mon,  9 Aug 2021 21:37:27 +0900
Message-Id: <9844c0b2845fc001f64ebb0a4bc6d7fb7a08571a.1628511445.git.vilhelm.gray@gmail.com>
X-Mailer: git-send-email 2.32.0
In-Reply-To: <cover.1628511445.git.vilhelm.gray@gmail.com>
References: <cover.1628511445.git.vilhelm.gray@gmail.com>
MIME-Version: 1.0
X-Mailman-Approved-At: Mon, 09 Aug 2021 13:23:47 +0000
Cc: kamel.bouhara@bootlin.com, gwendal@chromium.org, david@lechnology.com,
 linux-iio@vger.kernel.org, patrick.havelange@essensium.com,
 alexandre.belloni@bootlin.com, mcoquelin.stm32@gmail.com,
 linux-kernel@vger.kernel.org, o.rempel@pengutronix.de,
 jarkko.nikula@linux.intel.com, Dan Carpenter <dan.carpenter@oracle.com>,
 kernel@pengutronix.de, William Breathitt Gray <vilhelm.gray@gmail.com>,
 fabrice.gasnier@st.com, syednwaris@gmail.com,
 linux-stm32@st-md-mailman.stormreply.com, linux-arm-kernel@lists.infradead.org,
 alexandre.torgue@st.com
Subject: [Linux-stm32] [PATCH v15 02/13] counter: Internalize sysfs
	interface code
X-BeenThere: linux-stm32@st-md-mailman.stormreply.com
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: <linux-stm32.st-md-mailman.stormreply.com>
List-Unsubscribe: <https://st-md-mailman.stormreply.com/mailman/options/linux-stm32>, 
 <mailto:linux-stm32-request@st-md-mailman.stormreply.com?subject=unsubscribe>
List-Archive: <http://st-md-mailman.stormreply.com/pipermail/linux-stm32/>
List-Post: <mailto:linux-stm32@st-md-mailman.stormreply.com>
List-Help: <mailto:linux-stm32-request@st-md-mailman.stormreply.com?subject=help>
List-Subscribe: <https://st-md-mailman.stormreply.com/mailman/listinfo/linux-stm32>, 
 <mailto:linux-stm32-request@st-md-mailman.stormreply.com?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: linux-stm32-bounces@st-md-mailman.stormreply.com
Sender: "Linux-stm32" <linux-stm32-bounces@st-md-mailman.stormreply.com>

VGhpcyBpcyBhIHJlaW1wbGVtZW50YXRpb24gb2YgdGhlIEdlbmVyaWMgQ291bnRlciBkcml2ZXIg
aW50ZXJmYWNlLgpUaGVyZSBhcmUgbm8gbW9kaWZpY2F0aW9ucyB0byB0aGUgQ291bnRlciBzdWJz
eXN0ZW0gdXNlcnNwYWNlIGludGVyZmFjZSwKc28gZXhpc3RpbmcgdXNlcnNwYWNlIGFwcGxpY2F0
aW9ucyBzaG91bGQgY29udGludWUgdG8gcnVuIHNlYW1sZXNzbHkuCgpUaGUgcHVycG9zZSBvZiB0
aGlzIHBhdGNoIGlzIHRvIGludGVybmFsaXplIHRoZSBzeXNmcyBpbnRlcmZhY2UgY29kZQphbW9u
ZyB0aGUgdmFyaW91cyBjb3VudGVyIGRyaXZlcnMgaW50byBhIHNoYXJlZCBtb2R1bGUuIENvdW50
ZXIgZHJpdmVycwpwYXNzIGFuZCB0YWtlIGRhdGEgbmF0aXZlbHkgKGkuZS4gdTgsIHU2NCwgZXRj
LikgYW5kIHRoZSBzaGFyZWQgY291bnRlcgptb2R1bGUgaGFuZGxlcyB0aGUgdHJhbnNsYXRpb24g
YmV0d2VlbiB0aGUgc3lzZnMgaW50ZXJmYWNlIGFuZCB0aGUKZGV2aWNlIGRyaXZlcnMuIFRoaXMg
Z3VhcmFudGVlcyBhIHN0YW5kYXJkIHVzZXJzcGFjZSBpbnRlcmZhY2UgZm9yIGFsbApjb3VudGVy
IGRyaXZlcnMsIGFuZCBoZWxwcyBnZW5lcmFsaXplIHRoZSBHZW5lcmljIENvdW50ZXIgZHJpdmVy
IEFCSSBpbgpvcmRlciB0byBzdXBwb3J0IHRoZSBHZW5lcmljIENvdW50ZXIgY2hyZGV2IGludGVy
ZmFjZSAoaW50cm9kdWNlZCBpbiBhCnN1YnNlcXVlbnQgcGF0Y2gpIHdpdGhvdXQgc2lnbmlmaWNh
bnQgY2hhbmdlcyB0byB0aGUgZXhpc3RpbmcgY291bnRlcgpkcml2ZXJzLgoKTm90ZSwgQ291bnRl
ciBkZXZpY2UgcmVnaXN0cmF0aW9uIGlzIHRoZSBzYW1lIGFzIGJlZm9yZTogZHJpdmVycwpwb3B1
bGF0ZSBhIHN0cnVjdCBjb3VudGVyX2RldmljZSB3aXRoIGNvbXBvbmVudHMgYW5kIGNhbGxiYWNr
cywgdGhlbgpwYXNzIHRoZSBzdHJ1Y3R1cmUgdG8gdGhlIGRldm1fY291bnRlcl9yZWdpc3RlciBm
dW5jdGlvbi4gSG93ZXZlciwKd2hhdCdzIGRpZmZlcmVudCBub3cgaXMgaG93IHRoZSBDb3VudGVy
IHN1YnN5c3RlbSBjb2RlIGhhbmRsZXMgdGhpcwpyZWdpc3RyYXRpb24gaW50ZXJuYWxseS4KCldo
ZXJlYXMgYmVmb3JlIGNhbGxiYWNrcyB3b3VsZCBpbnRlcmFjdCBkaXJlY3RseSB3aXRoIHN5c2Zz
IGRhdGEsIHRoaXMKaW50ZXJhY3Rpb24gaXMgbm93IGFic3RyYWN0ZWQgYW5kIGluc3RlYWQgY2Fs
bGJhY2tzIGludGVyYWN0IHdpdGggbmF0aXZlCkMgZGF0YSB0eXBlcy4gVGhlIGNvdW50ZXJfY29t
cCBzdHJ1Y3R1cmUgZm9ybXMgdGhlIGJhc2lzIGZvciBDb3VudGVyCmV4dGVuc2lvbnMuCgpUaGUg
Y291bnRlci1zeXNmcy5jIGZpbGUgY29udGFpbnMgdGhlIGNvZGUgdG8gcGFyc2UgdGhyb3VnaCB0
aGUKY291bnRlcl9kZXZpY2Ugc3RydWN0dXJlIGFuZCByZWdpc3RlciB0aGUgcmVxdWVzdGVkIGNv
bXBvbmVudHMgYW5kCmV4dGVuc2lvbnMuIEF0dHJpYnV0ZXMgYXJlIGNyZWF0ZWQgYW5kIHBvcHVs
YXRlZCBiYXNlZCBvbiB0eXBlLCB3aXRoCnJlc3BlY3RpdmUgdHJhbnNsYXRpb24gZnVuY3Rpb25z
IHRvIGhhbmRsZSB0aGUgbWFwcGluZyBiZXR3ZWVuIHN5c2ZzIGFuZAp0aGUgY291bnRlciBkcml2
ZXIgY2FsbGJhY2tzLgoKVGhlIHRyYW5zbGF0aW9uIHBlcmZvcm1lZCBmb3IgZWFjaCBhdHRyaWJ1
dGUgaXMgc3RyYWlnaHRmb3J3YXJkOiB0aGUKYXR0cmlidXRlIHR5cGUgYW5kIGRhdGEgaXMgcGFy
c2VkIGZyb20gdGhlIGNvdW50ZXJfYXR0cmlidXRlIHN0cnVjdHVyZSwKdGhlIHJlc3BlY3RpdmUg
Y291bnRlciBkcml2ZXIgcmVhZC93cml0ZSBjYWxsYmFjayBpcyBjYWxsZWQsIGFuZCBzeXNmcwpJ
L08gaXMgaGFuZGxlZCBiZWZvcmUgb3IgYWZ0ZXIgdGhlIGRyaXZlciByZWFkL3dyaXRlIGZ1bmN0
aW9uIGlzIGNhbGxlZC4KCkNjOiBKYXJra28gTmlrdWxhIDxqYXJra28ubmlrdWxhQGxpbnV4Lmlu
dGVsLmNvbT4KQ2M6IFBhdHJpY2sgSGF2ZWxhbmdlIDxwYXRyaWNrLmhhdmVsYW5nZUBlc3NlbnNp
dW0uY29tPgpDYzogS2FtZWwgQm91aGFyYSA8a2FtZWwuYm91aGFyYUBib290bGluLmNvbT4KQ2M6
IEZhYnJpY2UgR2FzbmllciA8ZmFicmljZS5nYXNuaWVyQHN0LmNvbT4KQ2M6IE1heGltZSBDb3F1
ZWxpbiA8bWNvcXVlbGluLnN0bTMyQGdtYWlsLmNvbT4KQ2M6IEFsZXhhbmRyZSBUb3JndWUgPGFs
ZXhhbmRyZS50b3JndWVAc3QuY29tPgpDYzogRGFuIENhcnBlbnRlciA8ZGFuLmNhcnBlbnRlckBv
cmFjbGUuY29tPgpBY2tlZC1ieTogU3llZCBOYXl5YXIgV2FyaXMgPHN5ZWRud2FyaXNAZ21haWwu
Y29tPgpSZXZpZXdlZC1ieTogRGF2aWQgTGVjaG5lciA8ZGF2aWRAbGVjaG5vbG9neS5jb20+ClRl
c3RlZC1ieTogRGF2aWQgTGVjaG5lciA8ZGF2aWRAbGVjaG5vbG9neS5jb20+ClNpZ25lZC1vZmYt
Ynk6IFdpbGxpYW0gQnJlYXRoaXR0IEdyYXkgPHZpbGhlbG0uZ3JheUBnbWFpbC5jb20+Ci0tLQog
TUFJTlRBSU5FUlMgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgICAgMSAtCiBkcml2ZXJz
L2NvdW50ZXIvMTA0LXF1YWQtOC5jICAgICAgICAgICAgfCAgNDQ5ICsrKy0tLS0KIGRyaXZlcnMv
Y291bnRlci9NYWtlZmlsZSAgICAgICAgICAgICAgICB8ICAgIDEgKwogZHJpdmVycy9jb3VudGVy
L2NvdW50ZXItY29yZS5jICAgICAgICAgIHwgIDE0MiArKysKIGRyaXZlcnMvY291bnRlci9jb3Vu
dGVyLXN5c2ZzLmMgICAgICAgICB8ICA4NTIgKysrKysrKysrKysrKwogZHJpdmVycy9jb3VudGVy
L2NvdW50ZXItc3lzZnMuaCAgICAgICAgIHwgICAxMyArCiBkcml2ZXJzL2NvdW50ZXIvY291bnRl
ci5jICAgICAgICAgICAgICAgfCAxNDk2IC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiBkcml2ZXJz
L2NvdW50ZXIvZnRtLXF1YWRkZWMuYyAgICAgICAgICAgfCAgIDYwICstCiBkcml2ZXJzL2NvdW50
ZXIvaW50ZWwtcWVwLmMgICAgICAgICAgICAgfCAgMTQ0ICstLQogZHJpdmVycy9jb3VudGVyL2lu
dGVycnVwdC1jbnQuYyAgICAgICAgIHwgICA2MiArLQogZHJpdmVycy9jb3VudGVyL21pY3JvY2hp
cC10Y2ItY2FwdHVyZS5jIHwgICA5MSArLQogZHJpdmVycy9jb3VudGVyL3N0bTMyLWxwdGltZXIt
Y250LmMgICAgIHwgIDIyNiArKy0tCiBkcml2ZXJzL2NvdW50ZXIvc3RtMzItdGltZXItY250LmMg
ICAgICAgfCAgMTc5ICsrLQogZHJpdmVycy9jb3VudGVyL3RpLWVxZXAuYyAgICAgICAgICAgICAg
IHwgIDE4MCArLS0KIGluY2x1ZGUvbGludXgvY291bnRlci5oICAgICAgICAgICAgICAgICB8ICA2
NTggKysrKystLS0tLQogaW5jbHVkZS9saW51eC9jb3VudGVyX2VudW0uaCAgICAgICAgICAgIHwg
ICA0NSAtCiAxNiBmaWxlcyBjaGFuZ2VkLCAxOTY1IGluc2VydGlvbnMoKyksIDI2MzQgZGVsZXRp
b25zKC0pCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9jb3VudGVyL2NvdW50ZXItY29yZS5j
CiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9jb3VudGVyL2NvdW50ZXItc3lzZnMuYwogY3Jl
YXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvY291bnRlci9jb3VudGVyLXN5c2ZzLmgKIGRlbGV0ZSBt
b2RlIDEwMDY0NCBkcml2ZXJzL2NvdW50ZXIvY291bnRlci5jCiBkZWxldGUgbW9kZSAxMDA2NDQg
aW5jbHVkZS9saW51eC9jb3VudGVyX2VudW0uaAoKZGlmZiAtLWdpdCBhL01BSU5UQUlORVJTIGIv
TUFJTlRBSU5FUlMKaW5kZXggZDA0NjRiODNiNWI1Li41ZDNmN2UwNWE1ODggMTAwNjQ0Ci0tLSBh
L01BSU5UQUlORVJTCisrKyBiL01BSU5UQUlORVJTCkBAIC00NzY0LDcgKzQ3NjQsNiBAQCBGOglE
b2N1bWVudGF0aW9uL0FCSS90ZXN0aW5nL3N5c2ZzLWJ1cy1jb3VudGVyCiBGOglEb2N1bWVudGF0
aW9uL2RyaXZlci1hcGkvZ2VuZXJpYy1jb3VudGVyLnJzdAogRjoJZHJpdmVycy9jb3VudGVyLwog
RjoJaW5jbHVkZS9saW51eC9jb3VudGVyLmgKLUY6CWluY2x1ZGUvbGludXgvY291bnRlcl9lbnVt
LmgKIAogQ1AyNjE1IEkyQyBEUklWRVIKIE06CUJlbmNlIENzw7Nrw6FzIDxiZW5jZTk4QHNjaC5i
bWUuaHU+CmRpZmYgLS1naXQgYS9kcml2ZXJzL2NvdW50ZXIvMTA0LXF1YWQtOC5jIGIvZHJpdmVy
cy9jb3VudGVyLzEwNC1xdWFkLTguYwppbmRleCAwY2FhNjA1MzdiMTQuLmM1ODdmMjk1ZDcyMCAx
MDA2NDQKLS0tIGEvZHJpdmVycy9jb3VudGVyLzEwNC1xdWFkLTguYworKysgYi9kcml2ZXJzL2Nv
dW50ZXIvMTA0LXF1YWQtOC5jCkBAIC0xMTcsNyArMTE3LDcgQEAgc3RhdGljIGludCBxdWFkOF9z
aWduYWxfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiB9CiAKIHN0YXRpYyBp
bnQgcXVhZDhfY291bnRfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0Jc3Ry
dWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB1bnNpZ25lZCBsb25nICp2YWwpCisJCQkgICAgc3Ry
dWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB1NjQgKnZhbCkKIHsKIAlzdHJ1Y3QgcXVhZDggKmNv
bnN0IHByaXYgPSBjb3VudGVyLT5wcml2OwogCWNvbnN0IGludCBiYXNlX29mZnNldCA9IHByaXYt
PmJhc2UgKyAyICogY291bnQtPmlkOwpAQCAtMTQ4LDcgKzE0OCw3IEBAIHN0YXRpYyBpbnQgcXVh
ZDhfY291bnRfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiB9CiAKIHN0YXRp
YyBpbnQgcXVhZDhfY291bnRfd3JpdGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAot
CXN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgdW5zaWduZWQgbG9uZyB2YWwpCisJCQkgICAg
IHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgdTY0IHZhbCkKIHsKIAlzdHJ1Y3QgcXVhZDgg
KmNvbnN0IHByaXYgPSBjb3VudGVyLT5wcml2OwogCWNvbnN0IGludCBiYXNlX29mZnNldCA9IHBy
aXYtPmJhc2UgKyAyICogY291bnQtPmlkOwpAQCAtMTg4LDIyICsxODgsMTYgQEAgc3RhdGljIGlu
dCBxdWFkOF9jb3VudF93cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAJcmV0
dXJuIDA7CiB9CiAKLWVudW0gcXVhZDhfY291bnRfZnVuY3Rpb24gewotCVFVQUQ4X0NPVU5UX0ZV
TkNUSU9OX1BVTFNFX0RJUkVDVElPTiA9IDAsCi0JUVVBRDhfQ09VTlRfRlVOQ1RJT05fUVVBRFJB
VFVSRV9YMSwKLQlRVUFEOF9DT1VOVF9GVU5DVElPTl9RVUFEUkFUVVJFX1gyLAotCVFVQUQ4X0NP
VU5UX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDQKLX07Ci0KIHN0YXRpYyBjb25zdCBlbnVtIGNvdW50
ZXJfZnVuY3Rpb24gcXVhZDhfY291bnRfZnVuY3Rpb25zX2xpc3RbXSA9IHsKLQlbUVVBRDhfQ09V
TlRfRlVOQ1RJT05fUFVMU0VfRElSRUNUSU9OXSA9IENPVU5URVJfRlVOQ1RJT05fUFVMU0VfRElS
RUNUSU9OLAotCVtRVUFEOF9DT1VOVF9GVU5DVElPTl9RVUFEUkFUVVJFX1gxXSA9IENPVU5URVJf
RlVOQ1RJT05fUVVBRFJBVFVSRV9YMV9BLAotCVtRVUFEOF9DT1VOVF9GVU5DVElPTl9RVUFEUkFU
VVJFX1gyXSA9IENPVU5URVJfRlVOQ1RJT05fUVVBRFJBVFVSRV9YMl9BLAotCVtRVUFEOF9DT1VO
VF9GVU5DVElPTl9RVUFEUkFUVVJFX1g0XSA9IENPVU5URVJfRlVOQ1RJT05fUVVBRFJBVFVSRV9Y
NAorCUNPVU5URVJfRlVOQ1RJT05fUFVMU0VfRElSRUNUSU9OLAorCUNPVU5URVJfRlVOQ1RJT05f
UVVBRFJBVFVSRV9YMV9BLAorCUNPVU5URVJfRlVOQ1RJT05fUVVBRFJBVFVSRV9YMl9BLAorCUNP
VU5URVJfRlVOQ1RJT05fUVVBRFJBVFVSRV9YNCwKIH07CiAKLXN0YXRpYyBpbnQgcXVhZDhfZnVu
Y3Rpb25fZ2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQlzdHJ1Y3QgY291bnRl
cl9jb3VudCAqY291bnQsIHNpemVfdCAqZnVuY3Rpb24pCitzdGF0aWMgaW50IHF1YWQ4X2Z1bmN0
aW9uX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJICAgICAgIHN0cnVj
dCBjb3VudGVyX2NvdW50ICpjb3VudCwKKwkJCSAgICAgICBlbnVtIGNvdW50ZXJfZnVuY3Rpb24g
KmZ1bmN0aW9uKQogewogCXN0cnVjdCBxdWFkOCAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7
CiAJY29uc3QgaW50IGlkID0gY291bnQtPmlkOwpAQCAtMjEzLDI1ICsyMDcsMjYgQEAgc3RhdGlj
IGludCBxdWFkOF9mdW5jdGlvbl9nZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAog
CWlmIChwcml2LT5xdWFkcmF0dXJlX21vZGVbaWRdKQogCQlzd2l0Y2ggKHByaXYtPnF1YWRyYXR1
cmVfc2NhbGVbaWRdKSB7CiAJCWNhc2UgMDoKLQkJCSpmdW5jdGlvbiA9IFFVQUQ4X0NPVU5UX0ZV
TkNUSU9OX1FVQURSQVRVUkVfWDE7CisJCQkqZnVuY3Rpb24gPSBDT1VOVEVSX0ZVTkNUSU9OX1FV
QURSQVRVUkVfWDFfQTsKIAkJCWJyZWFrOwogCQljYXNlIDE6Ci0JCQkqZnVuY3Rpb24gPSBRVUFE
OF9DT1VOVF9GVU5DVElPTl9RVUFEUkFUVVJFX1gyOworCQkJKmZ1bmN0aW9uID0gQ09VTlRFUl9G
VU5DVElPTl9RVUFEUkFUVVJFX1gyX0E7CiAJCQlicmVhazsKIAkJY2FzZSAyOgotCQkJKmZ1bmN0
aW9uID0gUVVBRDhfQ09VTlRfRlVOQ1RJT05fUVVBRFJBVFVSRV9YNDsKKwkJCSpmdW5jdGlvbiA9
IENPVU5URVJfRlVOQ1RJT05fUVVBRFJBVFVSRV9YNDsKIAkJCWJyZWFrOwogCQl9CiAJZWxzZQot
CQkqZnVuY3Rpb24gPSBRVUFEOF9DT1VOVF9GVU5DVElPTl9QVUxTRV9ESVJFQ1RJT047CisJCSpm
dW5jdGlvbiA9IENPVU5URVJfRlVOQ1RJT05fUFVMU0VfRElSRUNUSU9OOwogCiAJbXV0ZXhfdW5s
b2NrKCZwcml2LT5sb2NrKTsKIAogCXJldHVybiAwOwogfQogCi1zdGF0aWMgaW50IHF1YWQ4X2Z1
bmN0aW9uX3NldChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0Jc3RydWN0IGNvdW50
ZXJfY291bnQgKmNvdW50LCBzaXplX3QgZnVuY3Rpb24pCitzdGF0aWMgaW50IHF1YWQ4X2Z1bmN0
aW9uX3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQlzdHJ1Y3QgY291
bnRlcl9jb3VudCAqY291bnQsCisJCQkJZW51bSBjb3VudGVyX2Z1bmN0aW9uIGZ1bmN0aW9uKQog
ewogCXN0cnVjdCBxdWFkOCAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7CiAJY29uc3QgaW50
IGlkID0gY291bnQtPmlkOwpAQCAtMjQ3LDcgKzI0Miw3IEBAIHN0YXRpYyBpbnQgcXVhZDhfZnVu
Y3Rpb25fc2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKIAltb2RlX2NmZyA9IHBy
aXYtPmNvdW50X21vZGVbaWRdIDw8IDE7CiAJaWRyX2NmZyA9IHByaXYtPmluZGV4X3BvbGFyaXR5
W2lkXSA8PCAxOwogCi0JaWYgKGZ1bmN0aW9uID09IFFVQUQ4X0NPVU5UX0ZVTkNUSU9OX1BVTFNF
X0RJUkVDVElPTikgeworCWlmIChmdW5jdGlvbiA9PSBDT1VOVEVSX0ZVTkNUSU9OX1BVTFNFX0RJ
UkVDVElPTikgewogCQkqcXVhZHJhdHVyZV9tb2RlID0gMDsKIAogCQkvKiBRdWFkcmF0dXJlIHNj
YWxpbmcgb25seSBhdmFpbGFibGUgaW4gcXVhZHJhdHVyZSBtb2RlICovCkBAIC0yNjMsMTUgKzI1
OCwxNSBAQCBzdGF0aWMgaW50IHF1YWQ4X2Z1bmN0aW9uX3NldChzdHJ1Y3QgY291bnRlcl9kZXZp
Y2UgKmNvdW50ZXIsCiAJCSpxdWFkcmF0dXJlX21vZGUgPSAxOwogCiAJCXN3aXRjaCAoZnVuY3Rp
b24pIHsKLQkJY2FzZSBRVUFEOF9DT1VOVF9GVU5DVElPTl9RVUFEUkFUVVJFX1gxOgorCQljYXNl
IENPVU5URVJfRlVOQ1RJT05fUVVBRFJBVFVSRV9YMV9BOgogCQkJKnNjYWxlID0gMDsKIAkJCW1v
ZGVfY2ZnIHw9IFFVQUQ4X0NNUl9RVUFEUkFUVVJFX1gxOwogCQkJYnJlYWs7Ci0JCWNhc2UgUVVB
RDhfQ09VTlRfRlVOQ1RJT05fUVVBRFJBVFVSRV9YMjoKKwkJY2FzZSBDT1VOVEVSX0ZVTkNUSU9O
X1FVQURSQVRVUkVfWDJfQToKIAkJCSpzY2FsZSA9IDE7CiAJCQltb2RlX2NmZyB8PSBRVUFEOF9D
TVJfUVVBRFJBVFVSRV9YMjsKIAkJCWJyZWFrOwotCQljYXNlIFFVQUQ4X0NPVU5UX0ZVTkNUSU9O
X1FVQURSQVRVUkVfWDQ6CisJCWNhc2UgQ09VTlRFUl9GVU5DVElPTl9RVUFEUkFUVVJFX1g0Ogog
CQkJKnNjYWxlID0gMjsKIAkJCW1vZGVfY2ZnIHw9IFFVQUQ4X0NNUl9RVUFEUkFUVVJFX1g0Owog
CQkJYnJlYWs7CkBAIC0yOTAsOCArMjg1LDkgQEAgc3RhdGljIGludCBxdWFkOF9mdW5jdGlvbl9z
ZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAogCXJldHVybiAwOwogfQogCi1zdGF0
aWMgdm9pZCBxdWFkOF9kaXJlY3Rpb25fZ2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRl
ciwKLQlzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIGVudW0gY291bnRlcl9jb3VudF9kaXJl
Y3Rpb24gKmRpcmVjdGlvbikKK3N0YXRpYyBpbnQgcXVhZDhfZGlyZWN0aW9uX3JlYWQoc3RydWN0
IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCXN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3Vu
dCwKKwkJCQllbnVtIGNvdW50ZXJfY291bnRfZGlyZWN0aW9uICpkaXJlY3Rpb24pCiB7CiAJY29u
c3Qgc3RydWN0IHF1YWQ4ICpjb25zdCBwcml2ID0gY291bnRlci0+cHJpdjsKIAl1bnNpZ25lZCBp
bnQgdWRfZmxhZzsKQEAgLTMwMiw3NiArMjk4LDc0IEBAIHN0YXRpYyB2b2lkIHF1YWQ4X2RpcmVj
dGlvbl9nZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAogCiAJKmRpcmVjdGlvbiA9
ICh1ZF9mbGFnKSA/IENPVU5URVJfQ09VTlRfRElSRUNUSU9OX0ZPUldBUkQgOgogCQlDT1VOVEVS
X0NPVU5UX0RJUkVDVElPTl9CQUNLV0FSRDsKLX0KIAotZW51bSBxdWFkOF9zeW5hcHNlX2FjdGlv
biB7Ci0JUVVBRDhfU1lOQVBTRV9BQ1RJT05fTk9ORSA9IDAsCi0JUVVBRDhfU1lOQVBTRV9BQ1RJ
T05fUklTSU5HX0VER0UsCi0JUVVBRDhfU1lOQVBTRV9BQ1RJT05fRkFMTElOR19FREdFLAotCVFV
QUQ4X1NZTkFQU0VfQUNUSU9OX0JPVEhfRURHRVMKLX07CisJcmV0dXJuIDA7Cit9CiAKIHN0YXRp
YyBjb25zdCBlbnVtIGNvdW50ZXJfc3luYXBzZV9hY3Rpb24gcXVhZDhfaW5kZXhfYWN0aW9uc19s
aXN0W10gPSB7Ci0JW1FVQUQ4X1NZTkFQU0VfQUNUSU9OX05PTkVdID0gQ09VTlRFUl9TWU5BUFNF
X0FDVElPTl9OT05FLAotCVtRVUFEOF9TWU5BUFNFX0FDVElPTl9SSVNJTkdfRURHRV0gPSBDT1VO
VEVSX1NZTkFQU0VfQUNUSU9OX1JJU0lOR19FREdFCisJQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9O
T05FLAorCUNPVU5URVJfU1lOQVBTRV9BQ1RJT05fUklTSU5HX0VER0UsCiB9OwogCiBzdGF0aWMg
Y29uc3QgZW51bSBjb3VudGVyX3N5bmFwc2VfYWN0aW9uIHF1YWQ4X3N5bmFwc2VfYWN0aW9uc19s
aXN0W10gPSB7Ci0JW1FVQUQ4X1NZTkFQU0VfQUNUSU9OX05PTkVdID0gQ09VTlRFUl9TWU5BUFNF
X0FDVElPTl9OT05FLAotCVtRVUFEOF9TWU5BUFNFX0FDVElPTl9SSVNJTkdfRURHRV0gPSBDT1VO
VEVSX1NZTkFQU0VfQUNUSU9OX1JJU0lOR19FREdFLAotCVtRVUFEOF9TWU5BUFNFX0FDVElPTl9G
QUxMSU5HX0VER0VdID0gQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9GQUxMSU5HX0VER0UsCi0JW1FV
QUQ4X1NZTkFQU0VfQUNUSU9OX0JPVEhfRURHRVNdID0gQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9C
T1RIX0VER0VTCisJQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9OT05FLAorCUNPVU5URVJfU1lOQVBT
RV9BQ1RJT05fUklTSU5HX0VER0UsCisJQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9GQUxMSU5HX0VE
R0UsCisJQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9CT1RIX0VER0VTLAogfTsKIAotc3RhdGljIGlu
dCBxdWFkOF9hY3Rpb25fZ2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQlzdHJ1
Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHN0cnVjdCBjb3VudGVyX3N5bmFwc2UgKnN5bmFwc2Us
Ci0Jc2l6ZV90ICphY3Rpb24pCitzdGF0aWMgaW50IHF1YWQ4X2FjdGlvbl9yZWFkKHN0cnVjdCBj
b3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCSAgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNv
dW50LAorCQkJICAgICBzdHJ1Y3QgY291bnRlcl9zeW5hcHNlICpzeW5hcHNlLAorCQkJICAgICBl
bnVtIGNvdW50ZXJfc3luYXBzZV9hY3Rpb24gKmFjdGlvbikKIHsKIAlzdHJ1Y3QgcXVhZDggKmNv
bnN0IHByaXYgPSBjb3VudGVyLT5wcml2OwogCWludCBlcnI7Ci0Jc2l6ZV90IGZ1bmN0aW9uID0g
MDsKKwllbnVtIGNvdW50ZXJfZnVuY3Rpb24gZnVuY3Rpb247CiAJY29uc3Qgc2l6ZV90IHNpZ25h
bF9hX2lkID0gY291bnQtPnN5bmFwc2VzWzBdLnNpZ25hbC0+aWQ7CiAJZW51bSBjb3VudGVyX2Nv
dW50X2RpcmVjdGlvbiBkaXJlY3Rpb247CiAKIAkvKiBIYW5kbGUgSW5kZXggc2lnbmFscyAqLwog
CWlmIChzeW5hcHNlLT5zaWduYWwtPmlkID49IDE2KSB7CiAJCWlmIChwcml2LT5wcmVzZXRfZW5h
YmxlW2NvdW50LT5pZF0pCi0JCQkqYWN0aW9uID0gUVVBRDhfU1lOQVBTRV9BQ1RJT05fUklTSU5H
X0VER0U7CisJCQkqYWN0aW9uID0gQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9SSVNJTkdfRURHRTsK
IAkJZWxzZQotCQkJKmFjdGlvbiA9IFFVQUQ4X1NZTkFQU0VfQUNUSU9OX05PTkU7CisJCQkqYWN0
aW9uID0gQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9OT05FOwogCiAJCXJldHVybiAwOwogCX0KIAot
CWVyciA9IHF1YWQ4X2Z1bmN0aW9uX2dldChjb3VudGVyLCBjb3VudCwgJmZ1bmN0aW9uKTsKKwll
cnIgPSBxdWFkOF9mdW5jdGlvbl9yZWFkKGNvdW50ZXIsIGNvdW50LCAmZnVuY3Rpb24pOwogCWlm
IChlcnIpCiAJCXJldHVybiBlcnI7CiAKIAkvKiBEZWZhdWx0IGFjdGlvbiBtb2RlICovCi0JKmFj
dGlvbiA9IFFVQUQ4X1NZTkFQU0VfQUNUSU9OX05PTkU7CisJKmFjdGlvbiA9IENPVU5URVJfU1lO
QVBTRV9BQ1RJT05fTk9ORTsKIAogCS8qIERldGVybWluZSBhY3Rpb24gbW9kZSBiYXNlZCBvbiBj
dXJyZW50IGNvdW50IGZ1bmN0aW9uIG1vZGUgKi8KIAlzd2l0Y2ggKGZ1bmN0aW9uKSB7Ci0JY2Fz
ZSBRVUFEOF9DT1VOVF9GVU5DVElPTl9QVUxTRV9ESVJFQ1RJT046CisJY2FzZSBDT1VOVEVSX0ZV
TkNUSU9OX1BVTFNFX0RJUkVDVElPTjoKIAkJaWYgKHN5bmFwc2UtPnNpZ25hbC0+aWQgPT0gc2ln
bmFsX2FfaWQpCi0JCQkqYWN0aW9uID0gUVVBRDhfU1lOQVBTRV9BQ1RJT05fUklTSU5HX0VER0U7
CisJCQkqYWN0aW9uID0gQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9SSVNJTkdfRURHRTsKIAkJcmV0
dXJuIDA7Ci0JY2FzZSBRVUFEOF9DT1VOVF9GVU5DVElPTl9RVUFEUkFUVVJFX1gxOgorCWNhc2Ug
Q09VTlRFUl9GVU5DVElPTl9RVUFEUkFUVVJFX1gxX0E6CiAJCWlmIChzeW5hcHNlLT5zaWduYWwt
PmlkID09IHNpZ25hbF9hX2lkKSB7Ci0JCQlxdWFkOF9kaXJlY3Rpb25fZ2V0KGNvdW50ZXIsIGNv
dW50LCAmZGlyZWN0aW9uKTsKKwkJCWVyciA9IHF1YWQ4X2RpcmVjdGlvbl9yZWFkKGNvdW50ZXIs
IGNvdW50LCAmZGlyZWN0aW9uKTsKKwkJCWlmIChlcnIpCisJCQkJcmV0dXJuIGVycjsKIAogCQkJ
aWYgKGRpcmVjdGlvbiA9PSBDT1VOVEVSX0NPVU5UX0RJUkVDVElPTl9GT1JXQVJEKQotCQkJCSph
Y3Rpb24gPSBRVUFEOF9TWU5BUFNFX0FDVElPTl9SSVNJTkdfRURHRTsKKwkJCQkqYWN0aW9uID0g
Q09VTlRFUl9TWU5BUFNFX0FDVElPTl9SSVNJTkdfRURHRTsKIAkJCWVsc2UKLQkJCQkqYWN0aW9u
ID0gUVVBRDhfU1lOQVBTRV9BQ1RJT05fRkFMTElOR19FREdFOworCQkJCSphY3Rpb24gPSBDT1VO
VEVSX1NZTkFQU0VfQUNUSU9OX0ZBTExJTkdfRURHRTsKIAkJfQogCQlyZXR1cm4gMDsKLQljYXNl
IFFVQUQ4X0NPVU5UX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDI6CisJY2FzZSBDT1VOVEVSX0ZVTkNU
SU9OX1FVQURSQVRVUkVfWDJfQToKIAkJaWYgKHN5bmFwc2UtPnNpZ25hbC0+aWQgPT0gc2lnbmFs
X2FfaWQpCi0JCQkqYWN0aW9uID0gUVVBRDhfU1lOQVBTRV9BQ1RJT05fQk9USF9FREdFUzsKKwkJ
CSphY3Rpb24gPSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX0JPVEhfRURHRVM7CiAJCXJldHVybiAw
OwotCWNhc2UgUVVBRDhfQ09VTlRfRlVOQ1RJT05fUVVBRFJBVFVSRV9YNDoKLQkJKmFjdGlvbiA9
IFFVQUQ4X1NZTkFQU0VfQUNUSU9OX0JPVEhfRURHRVM7CisJY2FzZSBDT1VOVEVSX0ZVTkNUSU9O
X1FVQURSQVRVUkVfWDQ6CisJCSphY3Rpb24gPSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX0JPVEhf
RURHRVM7CiAJCXJldHVybiAwOwogCWRlZmF1bHQ6CiAJCS8qIHNob3VsZCBuZXZlciByZWFjaCB0
aGlzIHBhdGggKi8KQEAgLTM4Myw5ICszNzcsOSBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGNvdW50
ZXJfb3BzIHF1YWQ4X29wcyA9IHsKIAkuc2lnbmFsX3JlYWQgPSBxdWFkOF9zaWduYWxfcmVhZCwK
IAkuY291bnRfcmVhZCA9IHF1YWQ4X2NvdW50X3JlYWQsCiAJLmNvdW50X3dyaXRlID0gcXVhZDhf
Y291bnRfd3JpdGUsCi0JLmZ1bmN0aW9uX2dldCA9IHF1YWQ4X2Z1bmN0aW9uX2dldCwKLQkuZnVu
Y3Rpb25fc2V0ID0gcXVhZDhfZnVuY3Rpb25fc2V0LAotCS5hY3Rpb25fZ2V0ID0gcXVhZDhfYWN0
aW9uX2dldAorCS5mdW5jdGlvbl9yZWFkID0gcXVhZDhfZnVuY3Rpb25fcmVhZCwKKwkuZnVuY3Rp
b25fd3JpdGUgPSBxdWFkOF9mdW5jdGlvbl93cml0ZSwKKwkuYWN0aW9uX3JlYWQgPSBxdWFkOF9h
Y3Rpb25fcmVhZAogfTsKIAogc3RhdGljIGNvbnN0IGNoYXIgKmNvbnN0IHF1YWQ4X2luZGV4X3Bv
bGFyaXR5X21vZGVzW10gPSB7CkBAIC0zOTQsNyArMzg4LDggQEAgc3RhdGljIGNvbnN0IGNoYXIg
KmNvbnN0IHF1YWQ4X2luZGV4X3BvbGFyaXR5X21vZGVzW10gPSB7CiB9OwogCiBzdGF0aWMgaW50
IHF1YWQ4X2luZGV4X3BvbGFyaXR5X2dldChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIs
Ci0Jc3RydWN0IGNvdW50ZXJfc2lnbmFsICpzaWduYWwsIHNpemVfdCAqaW5kZXhfcG9sYXJpdHkp
CisJCQkJICAgIHN0cnVjdCBjb3VudGVyX3NpZ25hbCAqc2lnbmFsLAorCQkJCSAgICB1MzIgKmlu
ZGV4X3BvbGFyaXR5KQogewogCWNvbnN0IHN0cnVjdCBxdWFkOCAqY29uc3QgcHJpdiA9IGNvdW50
ZXItPnByaXY7CiAJY29uc3Qgc2l6ZV90IGNoYW5uZWxfaWQgPSBzaWduYWwtPmlkIC0gMTY7CkBA
IC00MDUsNyArNDAwLDggQEAgc3RhdGljIGludCBxdWFkOF9pbmRleF9wb2xhcml0eV9nZXQoc3Ry
dWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAogfQogCiBzdGF0aWMgaW50IHF1YWQ4X2luZGV4
X3BvbGFyaXR5X3NldChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0Jc3RydWN0IGNv
dW50ZXJfc2lnbmFsICpzaWduYWwsIHNpemVfdCBpbmRleF9wb2xhcml0eSkKKwkJCQkgICAgc3Ry
dWN0IGNvdW50ZXJfc2lnbmFsICpzaWduYWwsCisJCQkJICAgIHUzMiBpbmRleF9wb2xhcml0eSkK
IHsKIAlzdHJ1Y3QgcXVhZDggKmNvbnN0IHByaXYgPSBjb3VudGVyLT5wcml2OwogCWNvbnN0IHNp
emVfdCBjaGFubmVsX2lkID0gc2lnbmFsLT5pZCAtIDE2OwpAQCAtNDI2LDIwICs0MjIsMTQgQEAg
c3RhdGljIGludCBxdWFkOF9pbmRleF9wb2xhcml0eV9zZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNl
ICpjb3VudGVyLAogCXJldHVybiAwOwogfQogCi1zdGF0aWMgc3RydWN0IGNvdW50ZXJfc2lnbmFs
X2VudW1fZXh0IHF1YWQ4X2luZGV4X3BvbF9lbnVtID0gewotCS5pdGVtcyA9IHF1YWQ4X2luZGV4
X3BvbGFyaXR5X21vZGVzLAotCS5udW1faXRlbXMgPSBBUlJBWV9TSVpFKHF1YWQ4X2luZGV4X3Bv
bGFyaXR5X21vZGVzKSwKLQkuZ2V0ID0gcXVhZDhfaW5kZXhfcG9sYXJpdHlfZ2V0LAotCS5zZXQg
PSBxdWFkOF9pbmRleF9wb2xhcml0eV9zZXQKLX07Ci0KIHN0YXRpYyBjb25zdCBjaGFyICpjb25z
dCBxdWFkOF9zeW5jaHJvbm91c19tb2Rlc1tdID0gewogCSJub24tc3luY2hyb25vdXMiLAogCSJz
eW5jaHJvbm91cyIKIH07CiAKIHN0YXRpYyBpbnQgcXVhZDhfc3luY2hyb25vdXNfbW9kZV9nZXQo
c3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCXN0cnVjdCBjb3VudGVyX3NpZ25hbCAq
c2lnbmFsLCBzaXplX3QgKnN5bmNocm9ub3VzX21vZGUpCisJCQkJICAgICAgc3RydWN0IGNvdW50
ZXJfc2lnbmFsICpzaWduYWwsCisJCQkJICAgICAgdTMyICpzeW5jaHJvbm91c19tb2RlKQogewog
CWNvbnN0IHN0cnVjdCBxdWFkOCAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7CiAJY29uc3Qg
c2l6ZV90IGNoYW5uZWxfaWQgPSBzaWduYWwtPmlkIC0gMTY7CkBAIC00NTAsNyArNDQwLDggQEAg
c3RhdGljIGludCBxdWFkOF9zeW5jaHJvbm91c19tb2RlX2dldChzdHJ1Y3QgY291bnRlcl9kZXZp
Y2UgKmNvdW50ZXIsCiB9CiAKIHN0YXRpYyBpbnQgcXVhZDhfc3luY2hyb25vdXNfbW9kZV9zZXQo
c3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCXN0cnVjdCBjb3VudGVyX3NpZ25hbCAq
c2lnbmFsLCBzaXplX3Qgc3luY2hyb25vdXNfbW9kZSkKKwkJCQkgICAgICBzdHJ1Y3QgY291bnRl
cl9zaWduYWwgKnNpZ25hbCwKKwkJCQkgICAgICB1MzIgc3luY2hyb25vdXNfbW9kZSkKIHsKIAlz
dHJ1Y3QgcXVhZDggKmNvbnN0IHByaXYgPSBjb3VudGVyLT5wcml2OwogCWNvbnN0IHNpemVfdCBj
aGFubmVsX2lkID0gc2lnbmFsLT5pZCAtIDE2OwpAQCAtNDc3LDIyICs0NjgsMTggQEAgc3RhdGlj
IGludCBxdWFkOF9zeW5jaHJvbm91c19tb2RlX3NldChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNv
dW50ZXIsCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBzdHJ1Y3QgY291bnRlcl9zaWduYWxfZW51
bV9leHQgcXVhZDhfc3luX21vZGVfZW51bSA9IHsKLQkuaXRlbXMgPSBxdWFkOF9zeW5jaHJvbm91
c19tb2RlcywKLQkubnVtX2l0ZW1zID0gQVJSQVlfU0laRShxdWFkOF9zeW5jaHJvbm91c19tb2Rl
cyksCi0JLmdldCA9IHF1YWQ4X3N5bmNocm9ub3VzX21vZGVfZ2V0LAotCS5zZXQgPSBxdWFkOF9z
eW5jaHJvbm91c19tb2RlX3NldAotfTsKLQotc3RhdGljIHNzaXplX3QgcXVhZDhfY291bnRfZmxv
b3JfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0Jc3RydWN0IGNvdW50ZXJf
Y291bnQgKmNvdW50LCB2b2lkICpwcml2YXRlLCBjaGFyICpidWYpCitzdGF0aWMgaW50IHF1YWQ4
X2NvdW50X2Zsb29yX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCSAg
c3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB1NjQgKmZsb29yKQogewogCS8qIE9ubHkgYSBm
bG9vciBvZiAwIGlzIHN1cHBvcnRlZCAqLwotCXJldHVybiBzcHJpbnRmKGJ1ZiwgIjBcbiIpOwor
CSpmbG9vciA9IDA7CisKKwlyZXR1cm4gMDsKIH0KIAotc3RhdGljIGludCBxdWFkOF9jb3VudF9t
b2RlX2dldChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0Jc3RydWN0IGNvdW50ZXJf
Y291bnQgKmNvdW50LCBzaXplX3QgKmNudF9tb2RlKQorc3RhdGljIGludCBxdWFkOF9jb3VudF9t
b2RlX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCSBzdHJ1Y3QgY291
bnRlcl9jb3VudCAqY291bnQsCisJCQkJIGVudW0gY291bnRlcl9jb3VudF9tb2RlICpjbnRfbW9k
ZSkKIHsKIAljb25zdCBzdHJ1Y3QgcXVhZDggKmNvbnN0IHByaXYgPSBjb3VudGVyLT5wcml2Owog
CkBAIC01MTUsMjYgKzUwMiwyOCBAQCBzdGF0aWMgaW50IHF1YWQ4X2NvdW50X21vZGVfZ2V0KHN0
cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKIAlyZXR1cm4gMDsKIH0KIAotc3RhdGljIGlu
dCBxdWFkOF9jb3VudF9tb2RlX3NldChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0J
c3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCBzaXplX3QgY250X21vZGUpCitzdGF0aWMgaW50
IHF1YWQ4X2NvdW50X21vZGVfd3JpdGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAor
CQkJCSAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAorCQkJCSAgZW51bSBjb3VudGVyX2Nv
dW50X21vZGUgY250X21vZGUpCiB7CiAJc3RydWN0IHF1YWQ4ICpjb25zdCBwcml2ID0gY291bnRl
ci0+cHJpdjsKKwl1bnNpZ25lZCBpbnQgY291bnRfbW9kZTsKIAl1bnNpZ25lZCBpbnQgbW9kZV9j
Zmc7CiAJY29uc3QgaW50IGJhc2Vfb2Zmc2V0ID0gcHJpdi0+YmFzZSArIDIgKiBjb3VudC0+aWQg
KyAxOwogCiAJLyogTWFwIEdlbmVyaWMgQ291bnRlciBjb3VudCBtb2RlIHRvIDEwNC1RVUFELTgg
Y291bnQgbW9kZSAqLwogCXN3aXRjaCAoY250X21vZGUpIHsKIAljYXNlIENPVU5URVJfQ09VTlRf
TU9ERV9OT1JNQUw6Ci0JCWNudF9tb2RlID0gMDsKKwkJY291bnRfbW9kZSA9IDA7CiAJCWJyZWFr
OwogCWNhc2UgQ09VTlRFUl9DT1VOVF9NT0RFX1JBTkdFX0xJTUlUOgotCQljbnRfbW9kZSA9IDE7
CisJCWNvdW50X21vZGUgPSAxOwogCQlicmVhazsKIAljYXNlIENPVU5URVJfQ09VTlRfTU9ERV9O
T05fUkVDWUNMRToKLQkJY250X21vZGUgPSAyOworCQljb3VudF9tb2RlID0gMjsKIAkJYnJlYWs7
CiAJY2FzZSBDT1VOVEVSX0NPVU5UX01PREVfTU9EVUxPX046Ci0JCWNudF9tb2RlID0gMzsKKwkJ
Y291bnRfbW9kZSA9IDM7CiAJCWJyZWFrOwogCWRlZmF1bHQ6CiAJCS8qIHNob3VsZCBuZXZlciBy
ZWFjaCB0aGlzIHBhdGggKi8KQEAgLTU0MywxMCArNTMyLDEwIEBAIHN0YXRpYyBpbnQgcXVhZDhf
Y291bnRfbW9kZV9zZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAogCiAJbXV0ZXhf
bG9jaygmcHJpdi0+bG9jayk7CiAKLQlwcml2LT5jb3VudF9tb2RlW2NvdW50LT5pZF0gPSBjbnRf
bW9kZTsKKwlwcml2LT5jb3VudF9tb2RlW2NvdW50LT5pZF0gPSBjb3VudF9tb2RlOwogCiAJLyog
U2V0IGNvdW50IG1vZGUgY29uZmlndXJhdGlvbiB2YWx1ZSAqLwotCW1vZGVfY2ZnID0gY250X21v
ZGUgPDwgMTsKKwltb2RlX2NmZyA9IGNvdW50X21vZGUgPDwgMTsKIAogCS8qIEFkZCBxdWFkcmF0
dXJlIG1vZGUgY29uZmlndXJhdGlvbiAqLwogCWlmIChwcml2LT5xdWFkcmF0dXJlX21vZGVbY291
bnQtPmlkXSkKQEAgLTU2MCw1NiArNTQ5LDM1IEBAIHN0YXRpYyBpbnQgcXVhZDhfY291bnRfbW9k
ZV9zZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAogCXJldHVybiAwOwogfQogCi1z
dGF0aWMgc3RydWN0IGNvdW50ZXJfY291bnRfZW51bV9leHQgcXVhZDhfY250X21vZGVfZW51bSA9
IHsKLQkuaXRlbXMgPSBjb3VudGVyX2NvdW50X21vZGVfc3RyLAotCS5udW1faXRlbXMgPSBBUlJB
WV9TSVpFKGNvdW50ZXJfY291bnRfbW9kZV9zdHIpLAotCS5nZXQgPSBxdWFkOF9jb3VudF9tb2Rl
X2dldCwKLQkuc2V0ID0gcXVhZDhfY291bnRfbW9kZV9zZXQKLX07Ci0KLXN0YXRpYyBzc2l6ZV90
IHF1YWQ4X2NvdW50X2RpcmVjdGlvbl9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRl
ciwKLQlzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHZvaWQgKnByaXYsIGNoYXIgKmJ1ZikK
LXsKLQllbnVtIGNvdW50ZXJfY291bnRfZGlyZWN0aW9uIGRpcjsKLQotCXF1YWQ4X2RpcmVjdGlv
bl9nZXQoY291bnRlciwgY291bnQsICZkaXIpOwotCi0JcmV0dXJuIHNwcmludGYoYnVmLCAiJXNc
biIsIGNvdW50ZXJfY291bnRfZGlyZWN0aW9uX3N0cltkaXJdKTsKLX0KLQotc3RhdGljIHNzaXpl
X3QgcXVhZDhfY291bnRfZW5hYmxlX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVy
LAotCXN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgdm9pZCAqcHJpdmF0ZSwgY2hhciAqYnVm
KQorc3RhdGljIGludCBxdWFkOF9jb3VudF9lbmFibGVfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZp
Y2UgKmNvdW50ZXIsCisJCQkJICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB1OCAqZW5h
YmxlKQogewogCWNvbnN0IHN0cnVjdCBxdWFkOCAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7
CiAKLQlyZXR1cm4gc3ByaW50ZihidWYsICIldVxuIiwgcHJpdi0+YWJfZW5hYmxlW2NvdW50LT5p
ZF0pOworCSplbmFibGUgPSBwcml2LT5hYl9lbmFibGVbY291bnQtPmlkXTsKKworCXJldHVybiAw
OwogfQogCi1zdGF0aWMgc3NpemVfdCBxdWFkOF9jb3VudF9lbmFibGVfd3JpdGUoc3RydWN0IGNv
dW50ZXJfZGV2aWNlICpjb3VudGVyLAotCXN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgdm9p
ZCAqcHJpdmF0ZSwgY29uc3QgY2hhciAqYnVmLCBzaXplX3QgbGVuKQorc3RhdGljIGludCBxdWFk
OF9jb3VudF9lbmFibGVfd3JpdGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJ
CSAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHU4IGVuYWJsZSkKIHsKIAlzdHJ1Y3Qg
cXVhZDggKmNvbnN0IHByaXYgPSBjb3VudGVyLT5wcml2OwogCWNvbnN0IGludCBiYXNlX29mZnNl
dCA9IHByaXYtPmJhc2UgKyAyICogY291bnQtPmlkOwotCWludCBlcnI7Ci0JYm9vbCBhYl9lbmFi
bGU7CiAJdW5zaWduZWQgaW50IGlvcl9jZmc7CiAKLQllcnIgPSBrc3RydG9ib29sKGJ1ZiwgJmFi
X2VuYWJsZSk7Ci0JaWYgKGVycikKLQkJcmV0dXJuIGVycjsKLQogCW11dGV4X2xvY2soJnByaXYt
PmxvY2spOwogCi0JcHJpdi0+YWJfZW5hYmxlW2NvdW50LT5pZF0gPSBhYl9lbmFibGU7CisJcHJp
di0+YWJfZW5hYmxlW2NvdW50LT5pZF0gPSBlbmFibGU7CiAKLQlpb3JfY2ZnID0gYWJfZW5hYmxl
IHwgcHJpdi0+cHJlc2V0X2VuYWJsZVtjb3VudC0+aWRdIDw8IDE7CisJaW9yX2NmZyA9IGVuYWJs
ZSB8IHByaXYtPnByZXNldF9lbmFibGVbY291bnQtPmlkXSA8PCAxOwogCiAJLyogTG9hZCBJL08g
Y29udHJvbCBjb25maWd1cmF0aW9uICovCiAJb3V0YihRVUFEOF9DVFJfSU9SIHwgaW9yX2NmZywg
YmFzZV9vZmZzZXQgKyAxKTsKIAogCW11dGV4X3VubG9jaygmcHJpdi0+bG9jayk7CiAKLQlyZXR1
cm4gbGVuOworCXJldHVybiAwOwogfQogCiBzdGF0aWMgY29uc3QgY2hhciAqY29uc3QgcXVhZDhf
bm9pc2VfZXJyb3Jfc3RhdGVzW10gPSB7CkBAIC02MTgsNyArNTg2LDcgQEAgc3RhdGljIGNvbnN0
IGNoYXIgKmNvbnN0IHF1YWQ4X25vaXNlX2Vycm9yX3N0YXRlc1tdID0gewogfTsKIAogc3RhdGlj
IGludCBxdWFkOF9lcnJvcl9ub2lzZV9nZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVy
LAotCXN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgc2l6ZV90ICpub2lzZV9lcnJvcikKKwkJ
CQkgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB1MzIgKm5vaXNlX2Vycm9yKQogewogCWNv
bnN0IHN0cnVjdCBxdWFkOCAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7CiAJY29uc3QgaW50
IGJhc2Vfb2Zmc2V0ID0gcHJpdi0+YmFzZSArIDIgKiBjb3VudC0+aWQgKyAxOwpAQCAtNjI4LDE4
ICs1OTYsMTQgQEAgc3RhdGljIGludCBxdWFkOF9lcnJvcl9ub2lzZV9nZXQoc3RydWN0IGNvdW50
ZXJfZGV2aWNlICpjb3VudGVyLAogCXJldHVybiAwOwogfQogCi1zdGF0aWMgc3RydWN0IGNvdW50
ZXJfY291bnRfZW51bV9leHQgcXVhZDhfZXJyb3Jfbm9pc2VfZW51bSA9IHsKLQkuaXRlbXMgPSBx
dWFkOF9ub2lzZV9lcnJvcl9zdGF0ZXMsCi0JLm51bV9pdGVtcyA9IEFSUkFZX1NJWkUocXVhZDhf
bm9pc2VfZXJyb3Jfc3RhdGVzKSwKLQkuZ2V0ID0gcXVhZDhfZXJyb3Jfbm9pc2VfZ2V0Ci19Owot
Ci1zdGF0aWMgc3NpemVfdCBxdWFkOF9jb3VudF9wcmVzZXRfcmVhZChzdHJ1Y3QgY291bnRlcl9k
ZXZpY2UgKmNvdW50ZXIsCi0Jc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB2b2lkICpwcml2
YXRlLCBjaGFyICpidWYpCitzdGF0aWMgaW50IHF1YWQ4X2NvdW50X3ByZXNldF9yZWFkKHN0cnVj
dCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAq
Y291bnQsIHU2NCAqcHJlc2V0KQogewogCWNvbnN0IHN0cnVjdCBxdWFkOCAqY29uc3QgcHJpdiA9
IGNvdW50ZXItPnByaXY7CiAKLQlyZXR1cm4gc3ByaW50ZihidWYsICIldVxuIiwgcHJpdi0+cHJl
c2V0W2NvdW50LT5pZF0pOworCSpwcmVzZXQgPSBwcml2LT5wcmVzZXRbY291bnQtPmlkXTsKKwor
CXJldHVybiAwOwogfQogCiBzdGF0aWMgdm9pZCBxdWFkOF9wcmVzZXRfcmVnaXN0ZXJfc2V0KHN0
cnVjdCBxdWFkOCAqY29uc3QgcHJpdiwgY29uc3QgaW50IGlkLApAQCAtNjU4LDE2ICs2MjIsMTAg
QEAgc3RhdGljIHZvaWQgcXVhZDhfcHJlc2V0X3JlZ2lzdGVyX3NldChzdHJ1Y3QgcXVhZDggKmNv
bnN0IHByaXYsIGNvbnN0IGludCBpZCwKIAkJb3V0YihwcmVzZXQgPj4gKDggKiBpKSwgYmFzZV9v
ZmZzZXQpOwogfQogCi1zdGF0aWMgc3NpemVfdCBxdWFkOF9jb3VudF9wcmVzZXRfd3JpdGUoc3Ry
dWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCXN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3Vu
dCwgdm9pZCAqcHJpdmF0ZSwgY29uc3QgY2hhciAqYnVmLCBzaXplX3QgbGVuKQorc3RhdGljIGlu
dCBxdWFkOF9jb3VudF9wcmVzZXRfd3JpdGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVy
LAorCQkJCSAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHU2NCBwcmVzZXQpCiB7CiAJ
c3RydWN0IHF1YWQ4ICpjb25zdCBwcml2ID0gY291bnRlci0+cHJpdjsKLQl1bnNpZ25lZCBpbnQg
cHJlc2V0OwotCWludCByZXQ7Ci0KLQlyZXQgPSBrc3RydG91aW50KGJ1ZiwgMCwgJnByZXNldCk7
Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKIAogCS8qIE9ubHkgMjQtYml0IHZhbHVlcyBhcmUg
c3VwcG9ydGVkICovCiAJaWYgKHByZXNldCA+IDB4RkZGRkZGKQpAQCAtNjc5LDExICs2MzcsMTEg
QEAgc3RhdGljIHNzaXplX3QgcXVhZDhfY291bnRfcHJlc2V0X3dyaXRlKHN0cnVjdCBjb3VudGVy
X2RldmljZSAqY291bnRlciwKIAogCW11dGV4X3VubG9jaygmcHJpdi0+bG9jayk7CiAKLQlyZXR1
cm4gbGVuOworCXJldHVybiAwOwogfQogCi1zdGF0aWMgc3NpemVfdCBxdWFkOF9jb3VudF9jZWls
aW5nX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCXN0cnVjdCBjb3VudGVy
X2NvdW50ICpjb3VudCwgdm9pZCAqcHJpdmF0ZSwgY2hhciAqYnVmKQorc3RhdGljIGludCBxdWFk
OF9jb3VudF9jZWlsaW5nX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJ
CSAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHU2NCAqY2VpbGluZykKIHsKIAlzdHJ1
Y3QgcXVhZDggKmNvbnN0IHByaXYgPSBjb3VudGVyLT5wcml2OwogCkBAIC02OTMsMjYgKzY1MSwy
MyBAQCBzdGF0aWMgc3NpemVfdCBxdWFkOF9jb3VudF9jZWlsaW5nX3JlYWQoc3RydWN0IGNvdW50
ZXJfZGV2aWNlICpjb3VudGVyLAogCXN3aXRjaCAocHJpdi0+Y291bnRfbW9kZVtjb3VudC0+aWRd
KSB7CiAJY2FzZSAxOgogCWNhc2UgMzoKLQkJbXV0ZXhfdW5sb2NrKCZwcml2LT5sb2NrKTsKLQkJ
cmV0dXJuIHNwcmludGYoYnVmLCAiJXVcbiIsIHByaXYtPnByZXNldFtjb3VudC0+aWRdKTsKKwkJ
KmNlaWxpbmcgPSBwcml2LT5wcmVzZXRbY291bnQtPmlkXTsKKwkJYnJlYWs7CisJZGVmYXVsdDoK
KwkJLyogQnkgZGVmYXVsdCAweDFGRkZGRkYgKDI1IGJpdHMgdW5zaWduZWQpIGlzIG1heGltdW0g
Y291bnQgKi8KKwkJKmNlaWxpbmcgPSAweDFGRkZGRkY7CisJCWJyZWFrOwogCX0KIAogCW11dGV4
X3VubG9jaygmcHJpdi0+bG9jayk7CiAKLQkvKiBCeSBkZWZhdWx0IDB4MUZGRkZGRiAoMjUgYml0
cyB1bnNpZ25lZCkgaXMgbWF4aW11bSBjb3VudCAqLwotCXJldHVybiBzcHJpbnRmKGJ1ZiwgIjMz
NTU0NDMxXG4iKTsKKwlyZXR1cm4gMDsKIH0KIAotc3RhdGljIHNzaXplX3QgcXVhZDhfY291bnRf
Y2VpbGluZ193cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0Jc3RydWN0IGNv
dW50ZXJfY291bnQgKmNvdW50LCB2b2lkICpwcml2YXRlLCBjb25zdCBjaGFyICpidWYsIHNpemVf
dCBsZW4pCitzdGF0aWMgaW50IHF1YWQ4X2NvdW50X2NlaWxpbmdfd3JpdGUoc3RydWN0IGNvdW50
ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCSAgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50
LCB1NjQgY2VpbGluZykKIHsKIAlzdHJ1Y3QgcXVhZDggKmNvbnN0IHByaXYgPSBjb3VudGVyLT5w
cml2OwotCXVuc2lnbmVkIGludCBjZWlsaW5nOwotCWludCByZXQ7Ci0KLQlyZXQgPSBrc3RydG91
aW50KGJ1ZiwgMCwgJmNlaWxpbmcpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7CiAKIAkvKiBP
bmx5IDI0LWJpdCB2YWx1ZXMgYXJlIHN1cHBvcnRlZCAqLwogCWlmIChjZWlsaW5nID4gMHhGRkZG
RkYpCkBAIC03MjYsNyArNjgxLDcgQEAgc3RhdGljIHNzaXplX3QgcXVhZDhfY291bnRfY2VpbGlu
Z193cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAJY2FzZSAzOgogCQlxdWFk
OF9wcmVzZXRfcmVnaXN0ZXJfc2V0KHByaXYsIGNvdW50LT5pZCwgY2VpbGluZyk7CiAJCW11dGV4
X3VubG9jaygmcHJpdi0+bG9jayk7Ci0JCXJldHVybiBsZW47CisJCXJldHVybiAwOwogCX0KIAog
CW11dGV4X3VubG9jaygmcHJpdi0+bG9jayk7CkBAIC03MzQsMjcgKzY4OSwyNSBAQCBzdGF0aWMg
c3NpemVfdCBxdWFkOF9jb3VudF9jZWlsaW5nX3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAq
Y291bnRlciwKIAlyZXR1cm4gLUVJTlZBTDsKIH0KIAotc3RhdGljIHNzaXplX3QgcXVhZDhfY291
bnRfcHJlc2V0X2VuYWJsZV9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQlz
dHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHZvaWQgKnByaXZhdGUsIGNoYXIgKmJ1ZikKK3N0
YXRpYyBpbnQgcXVhZDhfY291bnRfcHJlc2V0X2VuYWJsZV9yZWFkKHN0cnVjdCBjb3VudGVyX2Rl
dmljZSAqY291bnRlciwKKwkJCQkJICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCisJCQkJ
CSAgdTggKnByZXNldF9lbmFibGUpCiB7CiAJY29uc3Qgc3RydWN0IHF1YWQ4ICpjb25zdCBwcml2
ID0gY291bnRlci0+cHJpdjsKIAotCXJldHVybiBzcHJpbnRmKGJ1ZiwgIiV1XG4iLCAhcHJpdi0+
cHJlc2V0X2VuYWJsZVtjb3VudC0+aWRdKTsKKwkqcHJlc2V0X2VuYWJsZSA9ICFwcml2LT5wcmVz
ZXRfZW5hYmxlW2NvdW50LT5pZF07CisKKwlyZXR1cm4gMDsKIH0KIAotc3RhdGljIHNzaXplX3Qg
cXVhZDhfY291bnRfcHJlc2V0X2VuYWJsZV93cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNv
dW50ZXIsCi0Jc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB2b2lkICpwcml2YXRlLCBjb25z
dCBjaGFyICpidWYsIHNpemVfdCBsZW4pCitzdGF0aWMgaW50IHF1YWQ4X2NvdW50X3ByZXNldF9l
bmFibGVfd3JpdGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCQkgICBzdHJ1
Y3QgY291bnRlcl9jb3VudCAqY291bnQsCisJCQkJCSAgIHU4IHByZXNldF9lbmFibGUpCiB7CiAJ
c3RydWN0IHF1YWQ4ICpjb25zdCBwcml2ID0gY291bnRlci0+cHJpdjsKIAljb25zdCBpbnQgYmFz
ZV9vZmZzZXQgPSBwcml2LT5iYXNlICsgMiAqIGNvdW50LT5pZCArIDE7Ci0JYm9vbCBwcmVzZXRf
ZW5hYmxlOwotCWludCByZXQ7CiAJdW5zaWduZWQgaW50IGlvcl9jZmc7CiAKLQlyZXQgPSBrc3Ry
dG9ib29sKGJ1ZiwgJnByZXNldF9lbmFibGUpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0K
IAkvKiBQcmVzZXQgZW5hYmxlIGlzIGFjdGl2ZSBsb3cgaW4gSW5wdXQvT3V0cHV0IENvbnRyb2wg
cmVnaXN0ZXIgKi8KIAlwcmVzZXRfZW5hYmxlID0gIXByZXNldF9lbmFibGU7CiAKQEAgLTc2Miwy
NSArNzE1LDI0IEBAIHN0YXRpYyBzc2l6ZV90IHF1YWQ4X2NvdW50X3ByZXNldF9lbmFibGVfd3Jp
dGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAogCiAJcHJpdi0+cHJlc2V0X2VuYWJs
ZVtjb3VudC0+aWRdID0gcHJlc2V0X2VuYWJsZTsKIAotCWlvcl9jZmcgPSBwcml2LT5hYl9lbmFi
bGVbY291bnQtPmlkXSB8ICh1bnNpZ25lZCBpbnQpcHJlc2V0X2VuYWJsZSA8PCAxOworCWlvcl9j
ZmcgPSBwcml2LT5hYl9lbmFibGVbY291bnQtPmlkXSB8IHByZXNldF9lbmFibGUgPDwgMTsKIAog
CS8qIExvYWQgSS9PIGNvbnRyb2wgY29uZmlndXJhdGlvbiB0byBJbnB1dCAvIE91dHB1dCBDb250
cm9sIFJlZ2lzdGVyICovCiAJb3V0YihRVUFEOF9DVFJfSU9SIHwgaW9yX2NmZywgYmFzZV9vZmZz
ZXQpOwogCiAJbXV0ZXhfdW5sb2NrKCZwcml2LT5sb2NrKTsKIAotCXJldHVybiBsZW47CisJcmV0
dXJuIDA7CiB9CiAKLXN0YXRpYyBzc2l6ZV90IHF1YWQ4X3NpZ25hbF9jYWJsZV9mYXVsdF9yZWFk
KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQkJICAgICBzdHJ1Y3QgY291bnRl
cl9zaWduYWwgKnNpZ25hbCwKLQkJCQkJICAgICB2b2lkICpwcml2YXRlLCBjaGFyICpidWYpCitz
dGF0aWMgaW50IHF1YWQ4X3NpZ25hbF9jYWJsZV9mYXVsdF9yZWFkKHN0cnVjdCBjb3VudGVyX2Rl
dmljZSAqY291bnRlciwKKwkJCQkJIHN0cnVjdCBjb3VudGVyX3NpZ25hbCAqc2lnbmFsLAorCQkJ
CQkgdTggKmNhYmxlX2ZhdWx0KQogewogCXN0cnVjdCBxdWFkOCAqY29uc3QgcHJpdiA9IGNvdW50
ZXItPnByaXY7CiAJY29uc3Qgc2l6ZV90IGNoYW5uZWxfaWQgPSBzaWduYWwtPmlkIC8gMjsKIAli
b29sIGRpc2FibGVkOwogCXVuc2lnbmVkIGludCBzdGF0dXM7Ci0JdW5zaWduZWQgaW50IGZhdWx0
OwogCiAJbXV0ZXhfbG9jaygmcHJpdi0+bG9jayk7CiAKQEAgLTc5NywzNiArNzQ5LDMxIEBAIHN0
YXRpYyBzc2l6ZV90IHF1YWQ4X3NpZ25hbF9jYWJsZV9mYXVsdF9yZWFkKHN0cnVjdCBjb3VudGVy
X2RldmljZSAqY291bnRlciwKIAltdXRleF91bmxvY2soJnByaXYtPmxvY2spOwogCiAJLyogTWFz
ayByZXNwZWN0aXZlIGNoYW5uZWwgYW5kIGludmVydCBsb2dpYyAqLwotCWZhdWx0ID0gIShzdGF0
dXMgJiBCSVQoY2hhbm5lbF9pZCkpOworCSpjYWJsZV9mYXVsdCA9ICEoc3RhdHVzICYgQklUKGNo
YW5uZWxfaWQpKTsKIAotCXJldHVybiBzcHJpbnRmKGJ1ZiwgIiV1XG4iLCBmYXVsdCk7CisJcmV0
dXJuIDA7CiB9CiAKLXN0YXRpYyBzc2l6ZV90IHF1YWQ4X3NpZ25hbF9jYWJsZV9mYXVsdF9lbmFi
bGVfcmVhZCgKLQlzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsIHN0cnVjdCBjb3VudGVy
X3NpZ25hbCAqc2lnbmFsLAotCXZvaWQgKnByaXZhdGUsIGNoYXIgKmJ1ZikKK3N0YXRpYyBpbnQg
cXVhZDhfc2lnbmFsX2NhYmxlX2ZhdWx0X2VuYWJsZV9yZWFkKHN0cnVjdCBjb3VudGVyX2Rldmlj
ZSAqY291bnRlciwKKwkJCQkJCXN0cnVjdCBjb3VudGVyX3NpZ25hbCAqc2lnbmFsLAorCQkJCQkJ
dTggKmVuYWJsZSkKIHsKIAljb25zdCBzdHJ1Y3QgcXVhZDggKmNvbnN0IHByaXYgPSBjb3VudGVy
LT5wcml2OwogCWNvbnN0IHNpemVfdCBjaGFubmVsX2lkID0gc2lnbmFsLT5pZCAvIDI7Ci0JY29u
c3QgdW5zaWduZWQgaW50IGVuYiA9ICEhKHByaXYtPmNhYmxlX2ZhdWx0X2VuYWJsZSAmIEJJVChj
aGFubmVsX2lkKSk7CiAKLQlyZXR1cm4gc3ByaW50ZihidWYsICIldVxuIiwgZW5iKTsKKwkqZW5h
YmxlID0gISEocHJpdi0+Y2FibGVfZmF1bHRfZW5hYmxlICYgQklUKGNoYW5uZWxfaWQpKTsKKwor
CXJldHVybiAwOwogfQogCi1zdGF0aWMgc3NpemVfdCBxdWFkOF9zaWduYWxfY2FibGVfZmF1bHRf
ZW5hYmxlX3dyaXRlKAotCXN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwgc3RydWN0IGNv
dW50ZXJfc2lnbmFsICpzaWduYWwsCi0Jdm9pZCAqcHJpdmF0ZSwgY29uc3QgY2hhciAqYnVmLCBz
aXplX3QgbGVuKQorc3RhdGljIGludCBxdWFkOF9zaWduYWxfY2FibGVfZmF1bHRfZW5hYmxlX3dy
aXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkJCSBzdHJ1Y3QgY291bnRl
cl9zaWduYWwgKnNpZ25hbCwKKwkJCQkJCSB1OCBlbmFibGUpCiB7CiAJc3RydWN0IHF1YWQ4ICpj
b25zdCBwcml2ID0gY291bnRlci0+cHJpdjsKIAljb25zdCBzaXplX3QgY2hhbm5lbF9pZCA9IHNp
Z25hbC0+aWQgLyAyOwotCWJvb2wgZW5hYmxlOwotCWludCByZXQ7CiAJdW5zaWduZWQgaW50IGNh
YmxlX2ZhdWx0X2VuYWJsZTsKIAotCXJldCA9IGtzdHJ0b2Jvb2woYnVmLCAmZW5hYmxlKTsKLQlp
ZiAocmV0KQotCQlyZXR1cm4gcmV0OwotCiAJbXV0ZXhfbG9jaygmcHJpdi0+bG9jayk7CiAKIAlp
ZiAoZW5hYmxlKQpAQCAtODQxLDMxICs3ODgsMjcgQEAgc3RhdGljIHNzaXplX3QgcXVhZDhfc2ln
bmFsX2NhYmxlX2ZhdWx0X2VuYWJsZV93cml0ZSgKIAogCW11dGV4X3VubG9jaygmcHJpdi0+bG9j
ayk7CiAKLQlyZXR1cm4gbGVuOworCXJldHVybiAwOwogfQogCi1zdGF0aWMgc3NpemVfdCBxdWFk
OF9zaWduYWxfZmNrX3ByZXNjYWxlcl9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRl
ciwKLQlzdHJ1Y3QgY291bnRlcl9zaWduYWwgKnNpZ25hbCwgdm9pZCAqcHJpdmF0ZSwgY2hhciAq
YnVmKQorc3RhdGljIGludCBxdWFkOF9zaWduYWxfZmNrX3ByZXNjYWxlcl9yZWFkKHN0cnVjdCBj
b3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkJICAgc3RydWN0IGNvdW50ZXJfc2lnbmFsICpz
aWduYWwsCisJCQkJCSAgIHU4ICpwcmVzY2FsZXIpCiB7CiAJY29uc3Qgc3RydWN0IHF1YWQ4ICpj
b25zdCBwcml2ID0gY291bnRlci0+cHJpdjsKLQljb25zdCBzaXplX3QgY2hhbm5lbF9pZCA9IHNp
Z25hbC0+aWQgLyAyOwogCi0JcmV0dXJuIHNwcmludGYoYnVmLCAiJXVcbiIsIHByaXYtPmZja19w
cmVzY2FsZXJbY2hhbm5lbF9pZF0pOworCSpwcmVzY2FsZXIgPSBwcml2LT5mY2tfcHJlc2NhbGVy
W3NpZ25hbC0+aWQgLyAyXTsKKworCXJldHVybiAwOwogfQogCi1zdGF0aWMgc3NpemVfdCBxdWFk
OF9zaWduYWxfZmNrX3ByZXNjYWxlcl93cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50
ZXIsCi0Jc3RydWN0IGNvdW50ZXJfc2lnbmFsICpzaWduYWwsIHZvaWQgKnByaXZhdGUsIGNvbnN0
IGNoYXIgKmJ1ZiwKLQlzaXplX3QgbGVuKQorc3RhdGljIGludCBxdWFkOF9zaWduYWxfZmNrX3By
ZXNjYWxlcl93cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJCSAgICBz
dHJ1Y3QgY291bnRlcl9zaWduYWwgKnNpZ25hbCwKKwkJCQkJICAgIHU4IHByZXNjYWxlcikKIHsK
IAlzdHJ1Y3QgcXVhZDggKmNvbnN0IHByaXYgPSBjb3VudGVyLT5wcml2OwogCWNvbnN0IHNpemVf
dCBjaGFubmVsX2lkID0gc2lnbmFsLT5pZCAvIDI7CiAJY29uc3QgaW50IGJhc2Vfb2Zmc2V0ID0g
cHJpdi0+YmFzZSArIDIgKiBjaGFubmVsX2lkOwotCXU4IHByZXNjYWxlcjsKLQlpbnQgcmV0Owot
Ci0JcmV0ID0ga3N0cnRvdTgoYnVmLCAwLCAmcHJlc2NhbGVyKTsKLQlpZiAocmV0KQotCQlyZXR1
cm4gcmV0OwogCiAJbXV0ZXhfbG9jaygmcHJpdi0+bG9jayk7CiAKQEAgLTg4MSwzMSArODI0LDMw
IEBAIHN0YXRpYyBzc2l6ZV90IHF1YWQ4X3NpZ25hbF9mY2tfcHJlc2NhbGVyX3dyaXRlKHN0cnVj
dCBjb3VudGVyX2RldmljZSAqY291bnRlciwKIAogCW11dGV4X3VubG9jaygmcHJpdi0+bG9jayk7
CiAKLQlyZXR1cm4gbGVuOworCXJldHVybiAwOwogfQogCi1zdGF0aWMgY29uc3Qgc3RydWN0IGNv
dW50ZXJfc2lnbmFsX2V4dCBxdWFkOF9zaWduYWxfZXh0W10gPSB7Ci0JewotCQkubmFtZSA9ICJj
YWJsZV9mYXVsdCIsCi0JCS5yZWFkID0gcXVhZDhfc2lnbmFsX2NhYmxlX2ZhdWx0X3JlYWQKLQl9
LAotCXsKLQkJLm5hbWUgPSAiY2FibGVfZmF1bHRfZW5hYmxlIiwKLQkJLnJlYWQgPSBxdWFkOF9z
aWduYWxfY2FibGVfZmF1bHRfZW5hYmxlX3JlYWQsCi0JCS53cml0ZSA9IHF1YWQ4X3NpZ25hbF9j
YWJsZV9mYXVsdF9lbmFibGVfd3JpdGUKLQl9LAotCXsKLQkJLm5hbWUgPSAiZmlsdGVyX2Nsb2Nr
X3ByZXNjYWxlciIsCi0JCS5yZWFkID0gcXVhZDhfc2lnbmFsX2Zja19wcmVzY2FsZXJfcmVhZCwK
LQkJLndyaXRlID0gcXVhZDhfc2lnbmFsX2Zja19wcmVzY2FsZXJfd3JpdGUKLQl9CitzdGF0aWMg
c3RydWN0IGNvdW50ZXJfY29tcCBxdWFkOF9zaWduYWxfZXh0W10gPSB7CisJQ09VTlRFUl9DT01Q
X1NJR05BTF9CT09MKCJjYWJsZV9mYXVsdCIsIHF1YWQ4X3NpZ25hbF9jYWJsZV9mYXVsdF9yZWFk
LAorCQkJCSBOVUxMKSwKKwlDT1VOVEVSX0NPTVBfU0lHTkFMX0JPT0woImNhYmxlX2ZhdWx0X2Vu
YWJsZSIsCisJCQkJIHF1YWQ4X3NpZ25hbF9jYWJsZV9mYXVsdF9lbmFibGVfcmVhZCwKKwkJCQkg
cXVhZDhfc2lnbmFsX2NhYmxlX2ZhdWx0X2VuYWJsZV93cml0ZSksCisJQ09VTlRFUl9DT01QX1NJ
R05BTF9VOCgiZmlsdGVyX2Nsb2NrX3ByZXNjYWxlciIsCisJCQkgICAgICAgcXVhZDhfc2lnbmFs
X2Zja19wcmVzY2FsZXJfcmVhZCwKKwkJCSAgICAgICBxdWFkOF9zaWduYWxfZmNrX3ByZXNjYWxl
cl93cml0ZSkKIH07CiAKLXN0YXRpYyBjb25zdCBzdHJ1Y3QgY291bnRlcl9zaWduYWxfZXh0IHF1
YWQ4X2luZGV4X2V4dFtdID0gewotCUNPVU5URVJfU0lHTkFMX0VOVU0oImluZGV4X3BvbGFyaXR5
IiwgJnF1YWQ4X2luZGV4X3BvbF9lbnVtKSwKLQlDT1VOVEVSX1NJR05BTF9FTlVNX0FWQUlMQUJM
RSgiaW5kZXhfcG9sYXJpdHkiLAkmcXVhZDhfaW5kZXhfcG9sX2VudW0pLAotCUNPVU5URVJfU0lH
TkFMX0VOVU0oInN5bmNocm9ub3VzX21vZGUiLCAmcXVhZDhfc3luX21vZGVfZW51bSksCi0JQ09V
TlRFUl9TSUdOQUxfRU5VTV9BVkFJTEFCTEUoInN5bmNocm9ub3VzX21vZGUiLCAmcXVhZDhfc3lu
X21vZGVfZW51bSkKK3N0YXRpYyBERUZJTkVfQ09VTlRFUl9FTlVNKHF1YWQ4X2luZGV4X3BvbF9l
bnVtLCBxdWFkOF9pbmRleF9wb2xhcml0eV9tb2Rlcyk7CitzdGF0aWMgREVGSU5FX0NPVU5URVJf
RU5VTShxdWFkOF9zeW5jaF9tb2RlX2VudW0sIHF1YWQ4X3N5bmNocm9ub3VzX21vZGVzKTsKKwor
c3RhdGljIHN0cnVjdCBjb3VudGVyX2NvbXAgcXVhZDhfaW5kZXhfZXh0W10gPSB7CisJQ09VTlRF
Ul9DT01QX1NJR05BTF9FTlVNKCJpbmRleF9wb2xhcml0eSIsIHF1YWQ4X2luZGV4X3BvbGFyaXR5
X2dldCwKKwkJCQkgcXVhZDhfaW5kZXhfcG9sYXJpdHlfc2V0LAorCQkJCSBxdWFkOF9pbmRleF9w
b2xfZW51bSksCisJQ09VTlRFUl9DT01QX1NJR05BTF9FTlVNKCJzeW5jaHJvbm91c19tb2RlIiwg
cXVhZDhfc3luY2hyb25vdXNfbW9kZV9nZXQsCisJCQkJIHF1YWQ4X3N5bmNocm9ub3VzX21vZGVf
c2V0LAorCQkJCSBxdWFkOF9zeW5jaF9tb2RlX2VudW0pLAogfTsKIAogI2RlZmluZSBRVUFEOF9R
VUFEX1NJR05BTChfaWQsIF9uYW1lKSB7CQlcCkBAIC05NzQsMzkgKzkxNiwzMCBAQCBzdGF0aWMg
c3RydWN0IGNvdW50ZXJfc3luYXBzZSBxdWFkOF9jb3VudF9zeW5hcHNlc1tdWzNdID0gewogCVFV
QUQ4X0NPVU5UX1NZTkFQU0VTKDYpLCBRVUFEOF9DT1VOVF9TWU5BUFNFUyg3KQogfTsKIAotc3Rh
dGljIGNvbnN0IHN0cnVjdCBjb3VudGVyX2NvdW50X2V4dCBxdWFkOF9jb3VudF9leHRbXSA9IHsK
LQl7Ci0JCS5uYW1lID0gImNlaWxpbmciLAotCQkucmVhZCA9IHF1YWQ4X2NvdW50X2NlaWxpbmdf
cmVhZCwKLQkJLndyaXRlID0gcXVhZDhfY291bnRfY2VpbGluZ193cml0ZQotCX0sCi0JewotCQku
bmFtZSA9ICJmbG9vciIsCi0JCS5yZWFkID0gcXVhZDhfY291bnRfZmxvb3JfcmVhZAotCX0sCi0J
Q09VTlRFUl9DT1VOVF9FTlVNKCJjb3VudF9tb2RlIiwgJnF1YWQ4X2NudF9tb2RlX2VudW0pLAot
CUNPVU5URVJfQ09VTlRfRU5VTV9BVkFJTEFCTEUoImNvdW50X21vZGUiLCAmcXVhZDhfY250X21v
ZGVfZW51bSksCi0JewotCQkubmFtZSA9ICJkaXJlY3Rpb24iLAotCQkucmVhZCA9IHF1YWQ4X2Nv
dW50X2RpcmVjdGlvbl9yZWFkCi0JfSwKLQl7Ci0JCS5uYW1lID0gImVuYWJsZSIsCi0JCS5yZWFk
ID0gcXVhZDhfY291bnRfZW5hYmxlX3JlYWQsCi0JCS53cml0ZSA9IHF1YWQ4X2NvdW50X2VuYWJs
ZV93cml0ZQotCX0sCi0JQ09VTlRFUl9DT1VOVF9FTlVNKCJlcnJvcl9ub2lzZSIsICZxdWFkOF9l
cnJvcl9ub2lzZV9lbnVtKSwKLQlDT1VOVEVSX0NPVU5UX0VOVU1fQVZBSUxBQkxFKCJlcnJvcl9u
b2lzZSIsICZxdWFkOF9lcnJvcl9ub2lzZV9lbnVtKSwKLQl7Ci0JCS5uYW1lID0gInByZXNldCIs
Ci0JCS5yZWFkID0gcXVhZDhfY291bnRfcHJlc2V0X3JlYWQsCi0JCS53cml0ZSA9IHF1YWQ4X2Nv
dW50X3ByZXNldF93cml0ZQotCX0sCi0JewotCQkubmFtZSA9ICJwcmVzZXRfZW5hYmxlIiwKLQkJ
LnJlYWQgPSBxdWFkOF9jb3VudF9wcmVzZXRfZW5hYmxlX3JlYWQsCi0JCS53cml0ZSA9IHF1YWQ4
X2NvdW50X3ByZXNldF9lbmFibGVfd3JpdGUKLQl9CitzdGF0aWMgY29uc3QgZW51bSBjb3VudGVy
X2NvdW50X21vZGUgcXVhZDhfY250X21vZGVzW10gPSB7CisJQ09VTlRFUl9DT1VOVF9NT0RFX05P
Uk1BTCwKKwlDT1VOVEVSX0NPVU5UX01PREVfUkFOR0VfTElNSVQsCisJQ09VTlRFUl9DT1VOVF9N
T0RFX05PTl9SRUNZQ0xFLAorCUNPVU5URVJfQ09VTlRfTU9ERV9NT0RVTE9fTiwKK307CisKK3N0
YXRpYyBERUZJTkVfQ09VTlRFUl9BVkFJTEFCTEUocXVhZDhfY291bnRfbW9kZV9hdmFpbGFibGUs
IHF1YWQ4X2NudF9tb2Rlcyk7CisKK3N0YXRpYyBERUZJTkVfQ09VTlRFUl9FTlVNKHF1YWQ4X2Vy
cm9yX25vaXNlX2VudW0sIHF1YWQ4X25vaXNlX2Vycm9yX3N0YXRlcyk7CisKK3N0YXRpYyBzdHJ1
Y3QgY291bnRlcl9jb21wIHF1YWQ4X2NvdW50X2V4dFtdID0geworCUNPVU5URVJfQ09NUF9DRUlM
SU5HKHF1YWQ4X2NvdW50X2NlaWxpbmdfcmVhZCwKKwkJCSAgICAgcXVhZDhfY291bnRfY2VpbGlu
Z193cml0ZSksCisJQ09VTlRFUl9DT01QX0ZMT09SKHF1YWQ4X2NvdW50X2Zsb29yX3JlYWQsIE5V
TEwpLAorCUNPVU5URVJfQ09NUF9DT1VOVF9NT0RFKHF1YWQ4X2NvdW50X21vZGVfcmVhZCwgcXVh
ZDhfY291bnRfbW9kZV93cml0ZSwKKwkJCQlxdWFkOF9jb3VudF9tb2RlX2F2YWlsYWJsZSksCisJ
Q09VTlRFUl9DT01QX0RJUkVDVElPTihxdWFkOF9kaXJlY3Rpb25fcmVhZCksCisJQ09VTlRFUl9D
T01QX0VOQUJMRShxdWFkOF9jb3VudF9lbmFibGVfcmVhZCwgcXVhZDhfY291bnRfZW5hYmxlX3dy
aXRlKSwKKwlDT1VOVEVSX0NPTVBfQ09VTlRfRU5VTSgiZXJyb3Jfbm9pc2UiLCBxdWFkOF9lcnJv
cl9ub2lzZV9nZXQsIE5VTEwsCisJCQkJcXVhZDhfZXJyb3Jfbm9pc2VfZW51bSksCisJQ09VTlRF
Ul9DT01QX1BSRVNFVChxdWFkOF9jb3VudF9wcmVzZXRfcmVhZCwgcXVhZDhfY291bnRfcHJlc2V0
X3dyaXRlKSwKKwlDT1VOVEVSX0NPTVBfUFJFU0VUX0VOQUJMRShxdWFkOF9jb3VudF9wcmVzZXRf
ZW5hYmxlX3JlYWQsCisJCQkJICAgcXVhZDhfY291bnRfcHJlc2V0X2VuYWJsZV93cml0ZSksCiB9
OwogCiAjZGVmaW5lIFFVQUQ4X0NPVU5UKF9pZCwgX2NudG5hbWUpIHsJCQkJCVwKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvY291bnRlci9NYWtlZmlsZSBiL2RyaXZlcnMvY291bnRlci9NYWtlZmlsZQpp
bmRleCAxOTc0MmU2ZjVlM2UuLjFhYjdlMDg3ZmRjMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9jb3Vu
dGVyL01ha2VmaWxlCisrKyBiL2RyaXZlcnMvY291bnRlci9NYWtlZmlsZQpAQCAtNCw2ICs0LDcg
QEAKICMKIAogb2JqLSQoQ09ORklHX0NPVU5URVIpICs9IGNvdW50ZXIubworY291bnRlci15IDo9
IGNvdW50ZXItY29yZS5vIGNvdW50ZXItc3lzZnMubwogCiBvYmotJChDT05GSUdfMTA0X1FVQURf
OCkJKz0gMTA0LXF1YWQtOC5vCiBvYmotJChDT05GSUdfSU5URVJSVVBUX0NOVCkJCSs9IGludGVy
cnVwdC1jbnQubwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9jb3VudGVyL2NvdW50ZXItY29yZS5jIGIv
ZHJpdmVycy9jb3VudGVyL2NvdW50ZXItY29yZS5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4
IDAwMDAwMDAwMDAwMC4uYzUzM2E2ZmYxMmNmCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9j
b3VudGVyL2NvdW50ZXItY29yZS5jCkBAIC0wLDAgKzEsMTQyIEBACisvLyBTUERYLUxpY2Vuc2Ut
SWRlbnRpZmllcjogR1BMLTIuMAorLyoKKyAqIEdlbmVyaWMgQ291bnRlciBpbnRlcmZhY2UKKyAq
IENvcHlyaWdodCAoQykgMjAyMCBXaWxsaWFtIEJyZWF0aGl0dCBHcmF5CisgKi8KKyNpbmNsdWRl
IDxsaW51eC9jb3VudGVyLmg+CisjaW5jbHVkZSA8bGludXgvZGV2aWNlLmg+CisjaW5jbHVkZSA8
bGludXgvZXhwb3J0Lmg+CisjaW5jbHVkZSA8bGludXgvZ2ZwLmg+CisjaW5jbHVkZSA8bGludXgv
aWRyLmg+CisjaW5jbHVkZSA8bGludXgvaW5pdC5oPgorI2luY2x1ZGUgPGxpbnV4L21vZHVsZS5o
PgorCisjaW5jbHVkZSAiY291bnRlci1zeXNmcy5oIgorCisvKiBQcm92aWRlcyBhIHVuaXF1ZSBJ
RCBmb3IgZWFjaCBjb3VudGVyIGRldmljZSAqLworc3RhdGljIERFRklORV9JREEoY291bnRlcl9p
ZGEpOworCitzdGF0aWMgdm9pZCBjb3VudGVyX2RldmljZV9yZWxlYXNlKHN0cnVjdCBkZXZpY2Ug
KmRldikKK3sKKwlpZGFfZnJlZSgmY291bnRlcl9pZGEsIGRldi0+aWQpOworfQorCitzdGF0aWMg
c3RydWN0IGRldmljZV90eXBlIGNvdW50ZXJfZGV2aWNlX3R5cGUgPSB7CisJLm5hbWUgPSAiY291
bnRlcl9kZXZpY2UiLAorCS5yZWxlYXNlID0gY291bnRlcl9kZXZpY2VfcmVsZWFzZSwKK307CisK
K3N0YXRpYyBzdHJ1Y3QgYnVzX3R5cGUgY291bnRlcl9idXNfdHlwZSA9IHsKKwkubmFtZSA9ICJj
b3VudGVyIiwKKwkuZGV2X25hbWUgPSAiY291bnRlciIsCit9OworCisvKioKKyAqIGNvdW50ZXJf
cmVnaXN0ZXIgLSByZWdpc3RlciBDb3VudGVyIHRvIHRoZSBzeXN0ZW0KKyAqIEBjb3VudGVyOglw
b2ludGVyIHRvIENvdW50ZXIgdG8gcmVnaXN0ZXIKKyAqCisgKiBUaGlzIGZ1bmN0aW9uIHJlZ2lz
dGVycyBhIENvdW50ZXIgdG8gdGhlIHN5c3RlbS4gQSBzeXNmcyAiY291bnRlciIgZGlyZWN0b3J5
CisgKiB3aWxsIGJlIGNyZWF0ZWQgYW5kIHBvcHVsYXRlZCB3aXRoIHN5c2ZzIGF0dHJpYnV0ZXMg
Y29ycmVsYXRpbmcgd2l0aCB0aGUKKyAqIENvdW50ZXIgU2lnbmFscywgU3luYXBzZXMsIGFuZCBD
b3VudHMgcmVzcGVjdGl2ZWx5LgorICovCitpbnQgY291bnRlcl9yZWdpc3RlcihzdHJ1Y3QgY291
bnRlcl9kZXZpY2UgKmNvbnN0IGNvdW50ZXIpCit7CisJc3RydWN0IGRldmljZSAqY29uc3QgZGV2
ID0gJmNvdW50ZXItPmRldjsKKwlpbnQgaWQ7CisJaW50IGVycjsKKworCS8qIEFjcXVpcmUgdW5p
cXVlIElEICovCisJaWQgPSBpZGFfYWxsb2MoJmNvdW50ZXJfaWRhLCBHRlBfS0VSTkVMKTsKKwlp
ZiAoaWQgPCAwKQorCQlyZXR1cm4gaWQ7CisKKwkvKiBDb25maWd1cmUgZGV2aWNlIHN0cnVjdHVy
ZSBmb3IgQ291bnRlciAqLworCWRldi0+aWQgPSBpZDsKKwlkZXYtPnR5cGUgPSAmY291bnRlcl9k
ZXZpY2VfdHlwZTsKKwlkZXYtPmJ1cyA9ICZjb3VudGVyX2J1c190eXBlOworCWlmIChjb3VudGVy
LT5wYXJlbnQpIHsKKwkJZGV2LT5wYXJlbnQgPSBjb3VudGVyLT5wYXJlbnQ7CisJCWRldi0+b2Zf
bm9kZSA9IGNvdW50ZXItPnBhcmVudC0+b2Zfbm9kZTsKKwl9CisJZGV2aWNlX2luaXRpYWxpemUo
ZGV2KTsKKwlkZXZfc2V0X2RydmRhdGEoZGV2LCBjb3VudGVyKTsKKworCS8qIEFkZCBDb3VudGVy
IHN5c2ZzIGF0dHJpYnV0ZXMgKi8KKwllcnIgPSBjb3VudGVyX3N5c2ZzX2FkZChjb3VudGVyKTsK
KwlpZiAoZXJyIDwgMCkKKwkJZ290byBlcnJfZnJlZV9pZDsKKworCS8qIEFkZCBkZXZpY2UgdG8g
c3lzdGVtICovCisJZXJyID0gZGV2aWNlX2FkZChkZXYpOworCWlmIChlcnIgPCAwKQorCQlnb3Rv
IGVycl9mcmVlX2lkOworCisJcmV0dXJuIDA7CisKK2Vycl9mcmVlX2lkOgorCXB1dF9kZXZpY2Uo
ZGV2KTsKKwlyZXR1cm4gZXJyOworfQorRVhQT1JUX1NZTUJPTF9HUEwoY291bnRlcl9yZWdpc3Rl
cik7CisKKy8qKgorICogY291bnRlcl91bnJlZ2lzdGVyIC0gdW5yZWdpc3RlciBDb3VudGVyIGZy
b20gdGhlIHN5c3RlbQorICogQGNvdW50ZXI6CXBvaW50ZXIgdG8gQ291bnRlciB0byB1bnJlZ2lz
dGVyCisgKgorICogVGhlIENvdW50ZXIgaXMgdW5yZWdpc3RlcmVkIGZyb20gdGhlIHN5c3RlbS4K
KyAqLwordm9pZCBjb3VudGVyX3VucmVnaXN0ZXIoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb25z
dCBjb3VudGVyKQoreworCWlmICghY291bnRlcikKKwkJcmV0dXJuOworCisJZGV2aWNlX3VucmVn
aXN0ZXIoJmNvdW50ZXItPmRldik7Cit9CitFWFBPUlRfU1lNQk9MX0dQTChjb3VudGVyX3VucmVn
aXN0ZXIpOworCitzdGF0aWMgdm9pZCBkZXZtX2NvdW50ZXJfcmVsZWFzZSh2b2lkICpjb3VudGVy
KQoreworCWNvdW50ZXJfdW5yZWdpc3Rlcihjb3VudGVyKTsKK30KKworLyoqCisgKiBkZXZtX2Nv
dW50ZXJfcmVnaXN0ZXIgLSBSZXNvdXJjZS1tYW5hZ2VkIGNvdW50ZXJfcmVnaXN0ZXIKKyAqIEBk
ZXY6CWRldmljZSB0byBhbGxvY2F0ZSBjb3VudGVyX2RldmljZSBmb3IKKyAqIEBjb3VudGVyOglw
b2ludGVyIHRvIENvdW50ZXIgdG8gcmVnaXN0ZXIKKyAqCisgKiBNYW5hZ2VkIGNvdW50ZXJfcmVn
aXN0ZXIuIFRoZSBDb3VudGVyIHJlZ2lzdGVyZWQgd2l0aCB0aGlzIGZ1bmN0aW9uIGlzCisgKiBh
dXRvbWF0aWNhbGx5IHVucmVnaXN0ZXJlZCBvbiBkcml2ZXIgZGV0YWNoLiBUaGlzIGZ1bmN0aW9u
IGNhbGxzCisgKiBjb3VudGVyX3JlZ2lzdGVyIGludGVybmFsbHkuIFJlZmVyIHRvIHRoYXQgZnVu
Y3Rpb24gZm9yIG1vcmUgaW5mb3JtYXRpb24uCisgKgorICogUkVUVVJOUzoKKyAqIDAgb24gc3Vj
Y2VzcywgbmVnYXRpdmUgZXJyb3IgbnVtYmVyIG9uIGZhaWx1cmUuCisgKi8KK2ludCBkZXZtX2Nv
dW50ZXJfcmVnaXN0ZXIoc3RydWN0IGRldmljZSAqZGV2LAorCQkJICBzdHJ1Y3QgY291bnRlcl9k
ZXZpY2UgKmNvbnN0IGNvdW50ZXIpCit7CisJaW50IGVycjsKKworCWVyciA9IGNvdW50ZXJfcmVn
aXN0ZXIoY291bnRlcik7CisJaWYgKGVyciA8IDApCisJCXJldHVybiBlcnI7CisKKwlyZXR1cm4g
ZGV2bV9hZGRfYWN0aW9uX29yX3Jlc2V0KGRldiwgZGV2bV9jb3VudGVyX3JlbGVhc2UsIGNvdW50
ZXIpOworfQorRVhQT1JUX1NZTUJPTF9HUEwoZGV2bV9jb3VudGVyX3JlZ2lzdGVyKTsKKworc3Rh
dGljIGludCBfX2luaXQgY291bnRlcl9pbml0KHZvaWQpCit7CisJcmV0dXJuIGJ1c19yZWdpc3Rl
cigmY291bnRlcl9idXNfdHlwZSk7Cit9CisKK3N0YXRpYyB2b2lkIF9fZXhpdCBjb3VudGVyX2V4
aXQodm9pZCkKK3sKKwlidXNfdW5yZWdpc3RlcigmY291bnRlcl9idXNfdHlwZSk7Cit9CisKK3N1
YnN5c19pbml0Y2FsbChjb3VudGVyX2luaXQpOworbW9kdWxlX2V4aXQoY291bnRlcl9leGl0KTsK
KworTU9EVUxFX0FVVEhPUigiV2lsbGlhbSBCcmVhdGhpdHQgR3JheSA8dmlsaGVsbS5ncmF5QGdt
YWlsLmNvbT4iKTsKK01PRFVMRV9ERVNDUklQVElPTigiR2VuZXJpYyBDb3VudGVyIGludGVyZmFj
ZSIpOworTU9EVUxFX0xJQ0VOU0UoIkdQTCB2MiIpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9jb3Vu
dGVyL2NvdW50ZXItc3lzZnMuYyBiL2RyaXZlcnMvY291bnRlci9jb3VudGVyLXN5c2ZzLmMKbmV3
IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi5kYmI1MDdjOWRhMTEKLS0tIC9k
ZXYvbnVsbAorKysgYi9kcml2ZXJzL2NvdW50ZXIvY291bnRlci1zeXNmcy5jCkBAIC0wLDAgKzEs
ODUyIEBACisvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMAorLyoKKyAqIEdlbmVy
aWMgQ291bnRlciBzeXNmcyBpbnRlcmZhY2UKKyAqIENvcHlyaWdodCAoQykgMjAyMCBXaWxsaWFt
IEJyZWF0aGl0dCBHcmF5CisgKi8KKyNpbmNsdWRlIDxsaW51eC9jb3VudGVyLmg+CisjaW5jbHVk
ZSA8bGludXgvZGV2aWNlLmg+CisjaW5jbHVkZSA8bGludXgvZXJyLmg+CisjaW5jbHVkZSA8bGlu
dXgvZ2ZwLmg+CisjaW5jbHVkZSA8bGludXgva2VybmVsLmg+CisjaW5jbHVkZSA8bGludXgva3N0
cnRveC5oPgorI2luY2x1ZGUgPGxpbnV4L2xpc3QuaD4KKyNpbmNsdWRlIDxsaW51eC9zdHJpbmcu
aD4KKyNpbmNsdWRlIDxsaW51eC9zeXNmcy5oPgorI2luY2x1ZGUgPGxpbnV4L3R5cGVzLmg+CisK
KyNpbmNsdWRlICJjb3VudGVyLXN5c2ZzLmgiCisKKy8qKgorICogc3RydWN0IGNvdW50ZXJfYXR0
cmlidXRlIC0gQ291bnRlciBzeXNmcyBhdHRyaWJ1dGUKKyAqIEBkZXZfYXR0cjoJZGV2aWNlIGF0
dHJpYnV0ZSBmb3Igc3lzZnMKKyAqIEBsOgkJbm9kZSB0byBhZGQgQ291bnRlciBhdHRyaWJ1dGUg
dG8gYXR0cmlidXRlIGdyb3VwIGxpc3QKKyAqIEBjb21wOglDb3VudGVyIGNvbXBvbmVudCBjYWxs
YmFja3MgYW5kIGRhdGEKKyAqIEBzY29wZToJQ291bnRlciBzY29wZSBvZiB0aGUgYXR0cmlidXRl
CisgKiBAcGFyZW50Oglwb2ludGVyIHRvIHRoZSBwYXJlbnQgY29tcG9uZW50CisgKi8KK3N0cnVj
dCBjb3VudGVyX2F0dHJpYnV0ZSB7CisJc3RydWN0IGRldmljZV9hdHRyaWJ1dGUgZGV2X2F0dHI7
CisJc3RydWN0IGxpc3RfaGVhZCBsOworCisJc3RydWN0IGNvdW50ZXJfY29tcCBjb21wOworCWVu
dW0gY291bnRlcl9zY29wZSBzY29wZTsKKwl2b2lkICpwYXJlbnQ7Cit9OworCisjZGVmaW5lIHRv
X2NvdW50ZXJfYXR0cmlidXRlKF9kZXZfYXR0cikgXAorCWNvbnRhaW5lcl9vZihfZGV2X2F0dHIs
IHN0cnVjdCBjb3VudGVyX2F0dHJpYnV0ZSwgZGV2X2F0dHIpCisKKy8qKgorICogc3RydWN0IGNv
dW50ZXJfYXR0cmlidXRlX2dyb3VwIC0gY29udGFpbmVyIGZvciBhdHRyaWJ1dGUgZ3JvdXAKKyAq
IEBuYW1lOgluYW1lIG9mIHRoZSBhdHRyaWJ1dGUgZ3JvdXAKKyAqIEBhdHRyX2xpc3Q6CWxpc3Qg
dG8ga2VlcCB0cmFjayBvZiBjcmVhdGVkIGF0dHJpYnV0ZXMKKyAqIEBudW1fYXR0cjoJbnVtYmVy
IG9mIGF0dHJpYnV0ZXMKKyAqLworc3RydWN0IGNvdW50ZXJfYXR0cmlidXRlX2dyb3VwIHsKKwlj
b25zdCBjaGFyICpuYW1lOworCXN0cnVjdCBsaXN0X2hlYWQgYXR0cl9saXN0OworCXNpemVfdCBu
dW1fYXR0cjsKK307CisKK3N0YXRpYyBjb25zdCBjaGFyICpjb25zdCBjb3VudGVyX2Z1bmN0aW9u
X3N0cltdID0geworCVtDT1VOVEVSX0ZVTkNUSU9OX0lOQ1JFQVNFXSA9ICJpbmNyZWFzZSIsCisJ
W0NPVU5URVJfRlVOQ1RJT05fREVDUkVBU0VdID0gImRlY3JlYXNlIiwKKwlbQ09VTlRFUl9GVU5D
VElPTl9QVUxTRV9ESVJFQ1RJT05dID0gInB1bHNlLWRpcmVjdGlvbiIsCisJW0NPVU5URVJfRlVO
Q1RJT05fUVVBRFJBVFVSRV9YMV9BXSA9ICJxdWFkcmF0dXJlIHgxIGEiLAorCVtDT1VOVEVSX0ZV
TkNUSU9OX1FVQURSQVRVUkVfWDFfQl0gPSAicXVhZHJhdHVyZSB4MSBiIiwKKwlbQ09VTlRFUl9G
VU5DVElPTl9RVUFEUkFUVVJFX1gyX0FdID0gInF1YWRyYXR1cmUgeDIgYSIsCisJW0NPVU5URVJf
RlVOQ1RJT05fUVVBRFJBVFVSRV9YMl9CXSA9ICJxdWFkcmF0dXJlIHgyIGIiLAorCVtDT1VOVEVS
X0ZVTkNUSU9OX1FVQURSQVRVUkVfWDRdID0gInF1YWRyYXR1cmUgeDQiCit9OworCitzdGF0aWMg
Y29uc3QgY2hhciAqY29uc3QgY291bnRlcl9zaWduYWxfdmFsdWVfc3RyW10gPSB7CisJW0NPVU5U
RVJfU0lHTkFMX0xFVkVMX0xPV10gPSAibG93IiwKKwlbQ09VTlRFUl9TSUdOQUxfTEVWRUxfSElH
SF0gPSAiaGlnaCIKK307CisKK3N0YXRpYyBjb25zdCBjaGFyICpjb25zdCBjb3VudGVyX3N5bmFw
c2VfYWN0aW9uX3N0cltdID0geworCVtDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX05PTkVdID0gIm5v
bmUiLAorCVtDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX1JJU0lOR19FREdFXSA9ICJyaXNpbmcgZWRn
ZSIsCisJW0NPVU5URVJfU1lOQVBTRV9BQ1RJT05fRkFMTElOR19FREdFXSA9ICJmYWxsaW5nIGVk
Z2UiLAorCVtDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX0JPVEhfRURHRVNdID0gImJvdGggZWRnZXMi
Cit9OworCitzdGF0aWMgY29uc3QgY2hhciAqY29uc3QgY291bnRlcl9jb3VudF9kaXJlY3Rpb25f
c3RyW10gPSB7CisJW0NPVU5URVJfQ09VTlRfRElSRUNUSU9OX0ZPUldBUkRdID0gImZvcndhcmQi
LAorCVtDT1VOVEVSX0NPVU5UX0RJUkVDVElPTl9CQUNLV0FSRF0gPSAiYmFja3dhcmQiCit9Owor
CitzdGF0aWMgY29uc3QgY2hhciAqY29uc3QgY291bnRlcl9jb3VudF9tb2RlX3N0cltdID0gewor
CVtDT1VOVEVSX0NPVU5UX01PREVfTk9STUFMXSA9ICJub3JtYWwiLAorCVtDT1VOVEVSX0NPVU5U
X01PREVfUkFOR0VfTElNSVRdID0gInJhbmdlIGxpbWl0IiwKKwlbQ09VTlRFUl9DT1VOVF9NT0RF
X05PTl9SRUNZQ0xFXSA9ICJub24tcmVjeWNsZSIsCisJW0NPVU5URVJfQ09VTlRfTU9ERV9NT0RV
TE9fTl0gPSAibW9kdWxvLW4iCit9OworCitzdGF0aWMgc3NpemVfdCBjb3VudGVyX2NvbXBfdThf
c2hvdyhzdHJ1Y3QgZGV2aWNlICpkZXYsCisJCQkJICAgIHN0cnVjdCBkZXZpY2VfYXR0cmlidXRl
ICphdHRyLCBjaGFyICpidWYpCit7CisJY29uc3Qgc3RydWN0IGNvdW50ZXJfYXR0cmlidXRlICpj
b25zdCBhID0gdG9fY291bnRlcl9hdHRyaWJ1dGUoYXR0cik7CisJc3RydWN0IGNvdW50ZXJfZGV2
aWNlICpjb25zdCBjb3VudGVyID0gZGV2X2dldF9kcnZkYXRhKGRldik7CisJaW50IGVycjsKKwl1
OCBkYXRhID0gMDsKKworCXN3aXRjaCAoYS0+c2NvcGUpIHsKKwljYXNlIENPVU5URVJfU0NPUEVf
REVWSUNFOgorCQllcnIgPSBhLT5jb21wLmRldmljZV91OF9yZWFkKGNvdW50ZXIsICZkYXRhKTsK
KwkJYnJlYWs7CisJY2FzZSBDT1VOVEVSX1NDT1BFX1NJR05BTDoKKwkJZXJyID0gYS0+Y29tcC5z
aWduYWxfdThfcmVhZChjb3VudGVyLCBhLT5wYXJlbnQsICZkYXRhKTsKKwkJYnJlYWs7CisJY2Fz
ZSBDT1VOVEVSX1NDT1BFX0NPVU5UOgorCQllcnIgPSBhLT5jb21wLmNvdW50X3U4X3JlYWQoY291
bnRlciwgYS0+cGFyZW50LCAmZGF0YSk7CisJCWJyZWFrOworCWRlZmF1bHQ6CisJCXJldHVybiAt
RUlOVkFMOworCX0KKwlpZiAoZXJyIDwgMCkKKwkJcmV0dXJuIGVycjsKKworCWlmIChhLT5jb21w
LnR5cGUgPT0gQ09VTlRFUl9DT01QX0JPT0wpCisJCS8qIGRhdGEgc2hvdWxkIGFscmVhZHkgYmUg
Ym9vbGVhbiBidXQgZW5zdXJlIGp1c3QgdG8gYmUgc2FmZSAqLworCQlkYXRhID0gISFkYXRhOwor
CisJcmV0dXJuIHNwcmludGYoYnVmLCAiJXVcbiIsICh1bnNpZ25lZCBpbnQpZGF0YSk7Cit9CisK
K3N0YXRpYyBzc2l6ZV90IGNvdW50ZXJfY29tcF91OF9zdG9yZShzdHJ1Y3QgZGV2aWNlICpkZXYs
CisJCQkJICAgICBzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSAqYXR0ciwKKwkJCQkgICAgIGNvbnN0
IGNoYXIgKmJ1Ziwgc2l6ZV90IGxlbikKK3sKKwljb25zdCBzdHJ1Y3QgY291bnRlcl9hdHRyaWJ1
dGUgKmNvbnN0IGEgPSB0b19jb3VudGVyX2F0dHJpYnV0ZShhdHRyKTsKKwlzdHJ1Y3QgY291bnRl
cl9kZXZpY2UgKmNvbnN0IGNvdW50ZXIgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsKKwlpbnQgZXJy
OworCWJvb2wgYm9vbF9kYXRhID0gMDsKKwl1OCBkYXRhID0gMDsKKworCWlmIChhLT5jb21wLnR5
cGUgPT0gQ09VTlRFUl9DT01QX0JPT0wpIHsKKwkJZXJyID0ga3N0cnRvYm9vbChidWYsICZib29s
X2RhdGEpOworCQlkYXRhID0gYm9vbF9kYXRhOworCX0gZWxzZQorCQllcnIgPSBrc3RydG91OChi
dWYsIDAsICZkYXRhKTsKKwlpZiAoZXJyIDwgMCkKKwkJcmV0dXJuIGVycjsKKworCXN3aXRjaCAo
YS0+c2NvcGUpIHsKKwljYXNlIENPVU5URVJfU0NPUEVfREVWSUNFOgorCQllcnIgPSBhLT5jb21w
LmRldmljZV91OF93cml0ZShjb3VudGVyLCBkYXRhKTsKKwkJYnJlYWs7CisJY2FzZSBDT1VOVEVS
X1NDT1BFX1NJR05BTDoKKwkJZXJyID0gYS0+Y29tcC5zaWduYWxfdThfd3JpdGUoY291bnRlciwg
YS0+cGFyZW50LCBkYXRhKTsKKwkJYnJlYWs7CisJY2FzZSBDT1VOVEVSX1NDT1BFX0NPVU5UOgor
CQllcnIgPSBhLT5jb21wLmNvdW50X3U4X3dyaXRlKGNvdW50ZXIsIGEtPnBhcmVudCwgZGF0YSk7
CisJCWJyZWFrOworCWRlZmF1bHQ6CisJCXJldHVybiAtRUlOVkFMOworCX0KKwlpZiAoZXJyIDwg
MCkKKwkJcmV0dXJuIGVycjsKKworCXJldHVybiBsZW47Cit9CisKK3N0YXRpYyBzc2l6ZV90IGNv
dW50ZXJfY29tcF91MzJfc2hvdyhzdHJ1Y3QgZGV2aWNlICpkZXYsCisJCQkJICAgICBzdHJ1Y3Qg
ZGV2aWNlX2F0dHJpYnV0ZSAqYXR0ciwgY2hhciAqYnVmKQoreworCWNvbnN0IHN0cnVjdCBjb3Vu
dGVyX2F0dHJpYnV0ZSAqY29uc3QgYSA9IHRvX2NvdW50ZXJfYXR0cmlidXRlKGF0dHIpOworCXN0
cnVjdCBjb3VudGVyX2RldmljZSAqY29uc3QgY291bnRlciA9IGRldl9nZXRfZHJ2ZGF0YShkZXYp
OworCWNvbnN0IHN0cnVjdCBjb3VudGVyX2F2YWlsYWJsZSAqY29uc3QgYXZhaWwgPSBhLT5jb21w
LnByaXY7CisJaW50IGVycjsKKwl1MzIgZGF0YSA9IDA7CisKKwlzd2l0Y2ggKGEtPnNjb3BlKSB7
CisJY2FzZSBDT1VOVEVSX1NDT1BFX0RFVklDRToKKwkJZXJyID0gYS0+Y29tcC5kZXZpY2VfdTMy
X3JlYWQoY291bnRlciwgJmRhdGEpOworCQlicmVhazsKKwljYXNlIENPVU5URVJfU0NPUEVfU0lH
TkFMOgorCQllcnIgPSBhLT5jb21wLnNpZ25hbF91MzJfcmVhZChjb3VudGVyLCBhLT5wYXJlbnQs
ICZkYXRhKTsKKwkJYnJlYWs7CisJY2FzZSBDT1VOVEVSX1NDT1BFX0NPVU5UOgorCQlpZiAoYS0+
Y29tcC50eXBlID09IENPVU5URVJfQ09NUF9TWU5BUFNFX0FDVElPTikKKwkJCWVyciA9IGEtPmNv
bXAuYWN0aW9uX3JlYWQoY291bnRlciwgYS0+cGFyZW50LAorCQkJCQkJICBhLT5jb21wLnByaXYs
ICZkYXRhKTsKKwkJZWxzZQorCQkJZXJyID0gYS0+Y29tcC5jb3VudF91MzJfcmVhZChjb3VudGVy
LCBhLT5wYXJlbnQsICZkYXRhKTsKKwkJYnJlYWs7CisJZGVmYXVsdDoKKwkJcmV0dXJuIC1FSU5W
QUw7CisJfQorCWlmIChlcnIgPCAwKQorCQlyZXR1cm4gZXJyOworCisJc3dpdGNoIChhLT5jb21w
LnR5cGUpIHsKKwljYXNlIENPVU5URVJfQ09NUF9GVU5DVElPTjoKKwkJcmV0dXJuIHN5c2ZzX2Vt
aXQoYnVmLCAiJXNcbiIsIGNvdW50ZXJfZnVuY3Rpb25fc3RyW2RhdGFdKTsKKwljYXNlIENPVU5U
RVJfQ09NUF9TSUdOQUxfTEVWRUw6CisJCXJldHVybiBzeXNmc19lbWl0KGJ1ZiwgIiVzXG4iLCBj
b3VudGVyX3NpZ25hbF92YWx1ZV9zdHJbZGF0YV0pOworCWNhc2UgQ09VTlRFUl9DT01QX1NZTkFQ
U0VfQUNUSU9OOgorCQlyZXR1cm4gc3lzZnNfZW1pdChidWYsICIlc1xuIiwgY291bnRlcl9zeW5h
cHNlX2FjdGlvbl9zdHJbZGF0YV0pOworCWNhc2UgQ09VTlRFUl9DT01QX0VOVU06CisJCXJldHVy
biBzeXNmc19lbWl0KGJ1ZiwgIiVzXG4iLCBhdmFpbC0+c3Ryc1tkYXRhXSk7CisJY2FzZSBDT1VO
VEVSX0NPTVBfQ09VTlRfRElSRUNUSU9OOgorCQlyZXR1cm4gc3lzZnNfZW1pdChidWYsICIlc1xu
IiwgY291bnRlcl9jb3VudF9kaXJlY3Rpb25fc3RyW2RhdGFdKTsKKwljYXNlIENPVU5URVJfQ09N
UF9DT1VOVF9NT0RFOgorCQlyZXR1cm4gc3lzZnNfZW1pdChidWYsICIlc1xuIiwgY291bnRlcl9j
b3VudF9tb2RlX3N0cltkYXRhXSk7CisJZGVmYXVsdDoKKwkJcmV0dXJuIHNwcmludGYoYnVmLCAi
JXVcbiIsICh1bnNpZ25lZCBpbnQpZGF0YSk7CisJfQorfQorCitzdGF0aWMgaW50IGNvdW50ZXJf
ZmluZF9lbnVtKHUzMiAqY29uc3QgZW51bV9pdGVtLCBjb25zdCB1MzIgKmNvbnN0IGVudW1zLAor
CQkJICAgICBjb25zdCBzaXplX3QgbnVtX2VudW1zLCBjb25zdCBjaGFyICpjb25zdCBidWYsCisJ
CQkgICAgIGNvbnN0IGNoYXIgKmNvbnN0IHN0cmluZ19hcnJheVtdKQoreworCXNpemVfdCBpbmRl
eDsKKworCWZvciAoaW5kZXggPSAwOyBpbmRleCA8IG51bV9lbnVtczsgaW5kZXgrKykgeworCQkq
ZW51bV9pdGVtID0gZW51bXNbaW5kZXhdOworCQlpZiAoc3lzZnNfc3RyZXEoYnVmLCBzdHJpbmdf
YXJyYXlbKmVudW1faXRlbV0pKQorCQkJcmV0dXJuIDA7CisJfQorCisJcmV0dXJuIC1FSU5WQUw7
Cit9CisKK3N0YXRpYyBzc2l6ZV90IGNvdW50ZXJfY29tcF91MzJfc3RvcmUoc3RydWN0IGRldmlj
ZSAqZGV2LAorCQkJCSAgICAgIHN0cnVjdCBkZXZpY2VfYXR0cmlidXRlICphdHRyLAorCQkJCSAg
ICAgIGNvbnN0IGNoYXIgKmJ1Ziwgc2l6ZV90IGxlbikKK3sKKwljb25zdCBzdHJ1Y3QgY291bnRl
cl9hdHRyaWJ1dGUgKmNvbnN0IGEgPSB0b19jb3VudGVyX2F0dHJpYnV0ZShhdHRyKTsKKwlzdHJ1
Y3QgY291bnRlcl9kZXZpY2UgKmNvbnN0IGNvdW50ZXIgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsK
KwlzdHJ1Y3QgY291bnRlcl9jb3VudCAqY29uc3QgY291bnQgPSBhLT5wYXJlbnQ7CisJc3RydWN0
IGNvdW50ZXJfc3luYXBzZSAqY29uc3Qgc3luYXBzZSA9IGEtPmNvbXAucHJpdjsKKwljb25zdCBz
dHJ1Y3QgY291bnRlcl9hdmFpbGFibGUgKmNvbnN0IGF2YWlsID0gYS0+Y29tcC5wcml2OworCWlu
dCBlcnI7CisJdTMyIGRhdGEgPSAwOworCisJc3dpdGNoIChhLT5jb21wLnR5cGUpIHsKKwljYXNl
IENPVU5URVJfQ09NUF9GVU5DVElPTjoKKwkJZXJyID0gY291bnRlcl9maW5kX2VudW0oJmRhdGEs
IGNvdW50LT5mdW5jdGlvbnNfbGlzdCwKKwkJCQkJY291bnQtPm51bV9mdW5jdGlvbnMsIGJ1ZiwK
KwkJCQkJY291bnRlcl9mdW5jdGlvbl9zdHIpOworCQlicmVhazsKKwljYXNlIENPVU5URVJfQ09N
UF9TWU5BUFNFX0FDVElPTjoKKwkJZXJyID0gY291bnRlcl9maW5kX2VudW0oJmRhdGEsIHN5bmFw
c2UtPmFjdGlvbnNfbGlzdCwKKwkJCQkJc3luYXBzZS0+bnVtX2FjdGlvbnMsIGJ1ZiwKKwkJCQkJ
Y291bnRlcl9zeW5hcHNlX2FjdGlvbl9zdHIpOworCQlicmVhazsKKwljYXNlIENPVU5URVJfQ09N
UF9FTlVNOgorCQllcnIgPSBfX3N5c2ZzX21hdGNoX3N0cmluZyhhdmFpbC0+c3RycywgYXZhaWwt
Pm51bV9pdGVtcywgYnVmKTsKKwkJZGF0YSA9IGVycjsKKwkJYnJlYWs7CisJY2FzZSBDT1VOVEVS
X0NPTVBfQ09VTlRfTU9ERToKKwkJZXJyID0gY291bnRlcl9maW5kX2VudW0oJmRhdGEsIGF2YWls
LT5lbnVtcywgYXZhaWwtPm51bV9pdGVtcywKKwkJCQkJYnVmLCBjb3VudGVyX2NvdW50X21vZGVf
c3RyKTsKKwkJYnJlYWs7CisJZGVmYXVsdDoKKwkJZXJyID0ga3N0cnRvdTMyKGJ1ZiwgMCwgJmRh
dGEpOworCQlicmVhazsKKwl9CisJaWYgKGVyciA8IDApCisJCXJldHVybiBlcnI7CisKKwlzd2l0
Y2ggKGEtPnNjb3BlKSB7CisJY2FzZSBDT1VOVEVSX1NDT1BFX0RFVklDRToKKwkJZXJyID0gYS0+
Y29tcC5kZXZpY2VfdTMyX3dyaXRlKGNvdW50ZXIsIGRhdGEpOworCQlicmVhazsKKwljYXNlIENP
VU5URVJfU0NPUEVfU0lHTkFMOgorCQllcnIgPSBhLT5jb21wLnNpZ25hbF91MzJfd3JpdGUoY291
bnRlciwgYS0+cGFyZW50LCBkYXRhKTsKKwkJYnJlYWs7CisJY2FzZSBDT1VOVEVSX1NDT1BFX0NP
VU5UOgorCQlpZiAoYS0+Y29tcC50eXBlID09IENPVU5URVJfQ09NUF9TWU5BUFNFX0FDVElPTikK
KwkJCWVyciA9IGEtPmNvbXAuYWN0aW9uX3dyaXRlKGNvdW50ZXIsIGNvdW50LCBzeW5hcHNlLAor
CQkJCQkJICAgZGF0YSk7CisJCWVsc2UKKwkJCWVyciA9IGEtPmNvbXAuY291bnRfdTMyX3dyaXRl
KGNvdW50ZXIsIGNvdW50LCBkYXRhKTsKKwkJYnJlYWs7CisJZGVmYXVsdDoKKwkJcmV0dXJuIC1F
SU5WQUw7CisJfQorCWlmIChlcnIgPCAwKQorCQlyZXR1cm4gZXJyOworCisJcmV0dXJuIGxlbjsK
K30KKworc3RhdGljIHNzaXplX3QgY291bnRlcl9jb21wX3U2NF9zaG93KHN0cnVjdCBkZXZpY2Ug
KmRldiwKKwkJCQkgICAgIHN0cnVjdCBkZXZpY2VfYXR0cmlidXRlICphdHRyLCBjaGFyICpidWYp
Cit7CisJY29uc3Qgc3RydWN0IGNvdW50ZXJfYXR0cmlidXRlICpjb25zdCBhID0gdG9fY291bnRl
cl9hdHRyaWJ1dGUoYXR0cik7CisJc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb25zdCBjb3VudGVy
ID0gZGV2X2dldF9kcnZkYXRhKGRldik7CisJaW50IGVycjsKKwl1NjQgZGF0YSA9IDA7CisKKwlz
d2l0Y2ggKGEtPnNjb3BlKSB7CisJY2FzZSBDT1VOVEVSX1NDT1BFX0RFVklDRToKKwkJZXJyID0g
YS0+Y29tcC5kZXZpY2VfdTY0X3JlYWQoY291bnRlciwgJmRhdGEpOworCQlicmVhazsKKwljYXNl
IENPVU5URVJfU0NPUEVfU0lHTkFMOgorCQllcnIgPSBhLT5jb21wLnNpZ25hbF91NjRfcmVhZChj
b3VudGVyLCBhLT5wYXJlbnQsICZkYXRhKTsKKwkJYnJlYWs7CisJY2FzZSBDT1VOVEVSX1NDT1BF
X0NPVU5UOgorCQllcnIgPSBhLT5jb21wLmNvdW50X3U2NF9yZWFkKGNvdW50ZXIsIGEtPnBhcmVu
dCwgJmRhdGEpOworCQlicmVhazsKKwlkZWZhdWx0OgorCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisJ
aWYgKGVyciA8IDApCisJCXJldHVybiBlcnI7CisKKwlyZXR1cm4gc3ByaW50ZihidWYsICIlbGx1
XG4iLCAodW5zaWduZWQgbG9uZyBsb25nKWRhdGEpOworfQorCitzdGF0aWMgc3NpemVfdCBjb3Vu
dGVyX2NvbXBfdTY0X3N0b3JlKHN0cnVjdCBkZXZpY2UgKmRldiwKKwkJCQkgICAgICBzdHJ1Y3Qg
ZGV2aWNlX2F0dHJpYnV0ZSAqYXR0ciwKKwkJCQkgICAgICBjb25zdCBjaGFyICpidWYsIHNpemVf
dCBsZW4pCit7CisJY29uc3Qgc3RydWN0IGNvdW50ZXJfYXR0cmlidXRlICpjb25zdCBhID0gdG9f
Y291bnRlcl9hdHRyaWJ1dGUoYXR0cik7CisJc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb25zdCBj
b3VudGVyID0gZGV2X2dldF9kcnZkYXRhKGRldik7CisJaW50IGVycjsKKwl1NjQgZGF0YSA9IDA7
CisKKwllcnIgPSBrc3RydG91NjQoYnVmLCAwLCAmZGF0YSk7CisJaWYgKGVyciA8IDApCisJCXJl
dHVybiBlcnI7CisKKwlzd2l0Y2ggKGEtPnNjb3BlKSB7CisJY2FzZSBDT1VOVEVSX1NDT1BFX0RF
VklDRToKKwkJZXJyID0gYS0+Y29tcC5kZXZpY2VfdTY0X3dyaXRlKGNvdW50ZXIsIGRhdGEpOwor
CQlicmVhazsKKwljYXNlIENPVU5URVJfU0NPUEVfU0lHTkFMOgorCQllcnIgPSBhLT5jb21wLnNp
Z25hbF91NjRfd3JpdGUoY291bnRlciwgYS0+cGFyZW50LCBkYXRhKTsKKwkJYnJlYWs7CisJY2Fz
ZSBDT1VOVEVSX1NDT1BFX0NPVU5UOgorCQllcnIgPSBhLT5jb21wLmNvdW50X3U2NF93cml0ZShj
b3VudGVyLCBhLT5wYXJlbnQsIGRhdGEpOworCQlicmVhazsKKwlkZWZhdWx0OgorCQlyZXR1cm4g
LUVJTlZBTDsKKwl9CisJaWYgKGVyciA8IDApCisJCXJldHVybiBlcnI7CisKKwlyZXR1cm4gbGVu
OworfQorCitzdGF0aWMgc3NpemVfdCBlbnVtc19hdmFpbGFibGVfc2hvdyhjb25zdCB1MzIgKmNv
bnN0IGVudW1zLAorCQkJCSAgICBjb25zdCBzaXplX3QgbnVtX2VudW1zLAorCQkJCSAgICBjb25z
dCBjaGFyICpjb25zdCBzdHJzW10sIGNoYXIgKmJ1ZikKK3sKKwlzaXplX3QgbGVuID0gMDsKKwlz
aXplX3QgaW5kZXg7CisKKwlmb3IgKGluZGV4ID0gMDsgaW5kZXggPCBudW1fZW51bXM7IGluZGV4
KyspCisJCWxlbiArPSBzeXNmc19lbWl0X2F0KGJ1ZiwgbGVuLCAiJXNcbiIsIHN0cnNbZW51bXNb
aW5kZXhdXSk7CisKKwlyZXR1cm4gbGVuOworfQorCitzdGF0aWMgc3NpemVfdCBzdHJzX2F2YWls
YWJsZV9zaG93KGNvbnN0IHN0cnVjdCBjb3VudGVyX2F2YWlsYWJsZSAqY29uc3QgYXZhaWwsCisJ
CQkJICAgY2hhciAqYnVmKQoreworCXNpemVfdCBsZW4gPSAwOworCXNpemVfdCBpbmRleDsKKwor
CWZvciAoaW5kZXggPSAwOyBpbmRleCA8IGF2YWlsLT5udW1faXRlbXM7IGluZGV4KyspCisJCWxl
biArPSBzeXNmc19lbWl0X2F0KGJ1ZiwgbGVuLCAiJXNcbiIsIGF2YWlsLT5zdHJzW2luZGV4XSk7
CisKKwlyZXR1cm4gbGVuOworfQorCitzdGF0aWMgc3NpemVfdCBjb3VudGVyX2NvbXBfYXZhaWxh
YmxlX3Nob3coc3RydWN0IGRldmljZSAqZGV2LAorCQkJCQkgICBzdHJ1Y3QgZGV2aWNlX2F0dHJp
YnV0ZSAqYXR0ciwKKwkJCQkJICAgY2hhciAqYnVmKQoreworCWNvbnN0IHN0cnVjdCBjb3VudGVy
X2F0dHJpYnV0ZSAqY29uc3QgYSA9IHRvX2NvdW50ZXJfYXR0cmlidXRlKGF0dHIpOworCWNvbnN0
IHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb25zdCBjb3VudCA9IGEtPnBhcmVudDsKKwljb25zdCBz
dHJ1Y3QgY291bnRlcl9zeW5hcHNlICpjb25zdCBzeW5hcHNlID0gYS0+Y29tcC5wcml2OworCWNv
bnN0IHN0cnVjdCBjb3VudGVyX2F2YWlsYWJsZSAqY29uc3QgYXZhaWwgPSBhLT5jb21wLnByaXY7
CisKKwlzd2l0Y2ggKGEtPmNvbXAudHlwZSkgeworCWNhc2UgQ09VTlRFUl9DT01QX0ZVTkNUSU9O
OgorCQlyZXR1cm4gZW51bXNfYXZhaWxhYmxlX3Nob3coY291bnQtPmZ1bmN0aW9uc19saXN0LAor
CQkJCQkgICAgY291bnQtPm51bV9mdW5jdGlvbnMsCisJCQkJCSAgICBjb3VudGVyX2Z1bmN0aW9u
X3N0ciwgYnVmKTsKKwljYXNlIENPVU5URVJfQ09NUF9TWU5BUFNFX0FDVElPTjoKKwkJcmV0dXJu
IGVudW1zX2F2YWlsYWJsZV9zaG93KHN5bmFwc2UtPmFjdGlvbnNfbGlzdCwKKwkJCQkJICAgIHN5
bmFwc2UtPm51bV9hY3Rpb25zLAorCQkJCQkgICAgY291bnRlcl9zeW5hcHNlX2FjdGlvbl9zdHIs
IGJ1Zik7CisJY2FzZSBDT1VOVEVSX0NPTVBfRU5VTToKKwkJcmV0dXJuIHN0cnNfYXZhaWxhYmxl
X3Nob3coYXZhaWwsIGJ1Zik7CisJY2FzZSBDT1VOVEVSX0NPTVBfQ09VTlRfTU9ERToKKwkJcmV0
dXJuIGVudW1zX2F2YWlsYWJsZV9zaG93KGF2YWlsLT5lbnVtcywgYXZhaWwtPm51bV9pdGVtcywK
KwkJCQkJICAgIGNvdW50ZXJfY291bnRfbW9kZV9zdHIsIGJ1Zik7CisJZGVmYXVsdDoKKwkJcmV0
dXJuIC1FSU5WQUw7CisJfQorfQorCitzdGF0aWMgaW50IGNvdW50ZXJfYXZhaWxfYXR0cl9jcmVh
dGUoc3RydWN0IGRldmljZSAqY29uc3QgZGV2LAorCXN0cnVjdCBjb3VudGVyX2F0dHJpYnV0ZV9n
cm91cCAqY29uc3QgZ3JvdXAsCisJY29uc3Qgc3RydWN0IGNvdW50ZXJfY29tcCAqY29uc3QgY29t
cCwgdm9pZCAqY29uc3QgcGFyZW50KQoreworCXN0cnVjdCBjb3VudGVyX2F0dHJpYnV0ZSAqY291
bnRlcl9hdHRyOworCXN0cnVjdCBkZXZpY2VfYXR0cmlidXRlICpkZXZfYXR0cjsKKworCS8qIEFs
bG9jYXRlIENvdW50ZXIgYXR0cmlidXRlICovCisJY291bnRlcl9hdHRyID0gZGV2bV9remFsbG9j
KGRldiwgc2l6ZW9mKCpjb3VudGVyX2F0dHIpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWNvdW50ZXJf
YXR0cikKKwkJcmV0dXJuIC1FTk9NRU07CisKKwkvKiBDb25maWd1cmUgQ291bnRlciBhdHRyaWJ1
dGUgKi8KKwljb3VudGVyX2F0dHItPmNvbXAudHlwZSA9IGNvbXAtPnR5cGU7CisJY291bnRlcl9h
dHRyLT5jb21wLnByaXYgPSBjb21wLT5wcml2OworCWNvdW50ZXJfYXR0ci0+cGFyZW50ID0gcGFy
ZW50OworCisJLyogSW5pdGlhbGl6ZSBzeXNmcyBhdHRyaWJ1dGUgKi8KKwlkZXZfYXR0ciA9ICZj
b3VudGVyX2F0dHItPmRldl9hdHRyOworCXN5c2ZzX2F0dHJfaW5pdCgmZGV2X2F0dHItPmF0dHIp
OworCisJLyogQ29uZmlndXJlIGRldmljZSBhdHRyaWJ1dGUgKi8KKwlkZXZfYXR0ci0+YXR0ci5u
YW1lID0gZGV2bV9rYXNwcmludGYoZGV2LCBHRlBfS0VSTkVMLCAiJXNfYXZhaWxhYmxlIiwKKwkJ
CQkJICAgICBjb21wLT5uYW1lKTsKKwlpZiAoIWRldl9hdHRyLT5hdHRyLm5hbWUpCisJCXJldHVy
biAtRU5PTUVNOworCWRldl9hdHRyLT5hdHRyLm1vZGUgPSAwNDQ0OworCWRldl9hdHRyLT5zaG93
ID0gY291bnRlcl9jb21wX2F2YWlsYWJsZV9zaG93OworCisJLyogU3RvcmUgbGlzdCBub2RlICov
CisJbGlzdF9hZGQoJmNvdW50ZXJfYXR0ci0+bCwgJmdyb3VwLT5hdHRyX2xpc3QpOworCWdyb3Vw
LT5udW1fYXR0cisrOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgY291bnRlcl9hdHRy
X2NyZWF0ZShzdHJ1Y3QgZGV2aWNlICpjb25zdCBkZXYsCisJCQkgICAgICAgc3RydWN0IGNvdW50
ZXJfYXR0cmlidXRlX2dyb3VwICpjb25zdCBncm91cCwKKwkJCSAgICAgICBjb25zdCBzdHJ1Y3Qg
Y291bnRlcl9jb21wICpjb25zdCBjb21wLAorCQkJICAgICAgIGNvbnN0IGVudW0gY291bnRlcl9z
Y29wZSBzY29wZSwKKwkJCSAgICAgICB2b2lkICpjb25zdCBwYXJlbnQpCit7CisJc3RydWN0IGNv
dW50ZXJfYXR0cmlidXRlICpjb3VudGVyX2F0dHI7CisJc3RydWN0IGRldmljZV9hdHRyaWJ1dGUg
KmRldl9hdHRyOworCisJLyogQWxsb2NhdGUgQ291bnRlciBhdHRyaWJ1dGUgKi8KKwljb3VudGVy
X2F0dHIgPSBkZXZtX2t6YWxsb2MoZGV2LCBzaXplb2YoKmNvdW50ZXJfYXR0ciksIEdGUF9LRVJO
RUwpOworCWlmICghY291bnRlcl9hdHRyKQorCQlyZXR1cm4gLUVOT01FTTsKKworCS8qIENvbmZp
Z3VyZSBDb3VudGVyIGF0dHJpYnV0ZSAqLworCWNvdW50ZXJfYXR0ci0+Y29tcCA9ICpjb21wOwor
CWNvdW50ZXJfYXR0ci0+c2NvcGUgPSBzY29wZTsKKwljb3VudGVyX2F0dHItPnBhcmVudCA9IHBh
cmVudDsKKworCS8qIENvbmZpZ3VyZSBkZXZpY2UgYXR0cmlidXRlICovCisJZGV2X2F0dHIgPSAm
Y291bnRlcl9hdHRyLT5kZXZfYXR0cjsKKwlzeXNmc19hdHRyX2luaXQoJmRldl9hdHRyLT5hdHRy
KTsKKwlkZXZfYXR0ci0+YXR0ci5uYW1lID0gY29tcC0+bmFtZTsKKwlzd2l0Y2ggKGNvbXAtPnR5
cGUpIHsKKwljYXNlIENPVU5URVJfQ09NUF9VODoKKwljYXNlIENPVU5URVJfQ09NUF9CT09MOgor
CQlpZiAoY29tcC0+ZGV2aWNlX3U4X3JlYWQpIHsKKwkJCWRldl9hdHRyLT5hdHRyLm1vZGUgfD0g
MDQ0NDsKKwkJCWRldl9hdHRyLT5zaG93ID0gY291bnRlcl9jb21wX3U4X3Nob3c7CisJCX0KKwkJ
aWYgKGNvbXAtPmRldmljZV91OF93cml0ZSkgeworCQkJZGV2X2F0dHItPmF0dHIubW9kZSB8PSAw
MjAwOworCQkJZGV2X2F0dHItPnN0b3JlID0gY291bnRlcl9jb21wX3U4X3N0b3JlOworCQl9CisJ
CWJyZWFrOworCWNhc2UgQ09VTlRFUl9DT01QX1NJR05BTF9MRVZFTDoKKwljYXNlIENPVU5URVJf
Q09NUF9GVU5DVElPTjoKKwljYXNlIENPVU5URVJfQ09NUF9TWU5BUFNFX0FDVElPTjoKKwljYXNl
IENPVU5URVJfQ09NUF9FTlVNOgorCWNhc2UgQ09VTlRFUl9DT01QX0NPVU5UX0RJUkVDVElPTjoK
KwljYXNlIENPVU5URVJfQ09NUF9DT1VOVF9NT0RFOgorCQlpZiAoY29tcC0+ZGV2aWNlX3UzMl9y
ZWFkKSB7CisJCQlkZXZfYXR0ci0+YXR0ci5tb2RlIHw9IDA0NDQ7CisJCQlkZXZfYXR0ci0+c2hv
dyA9IGNvdW50ZXJfY29tcF91MzJfc2hvdzsKKwkJfQorCQlpZiAoY29tcC0+ZGV2aWNlX3UzMl93
cml0ZSkgeworCQkJZGV2X2F0dHItPmF0dHIubW9kZSB8PSAwMjAwOworCQkJZGV2X2F0dHItPnN0
b3JlID0gY291bnRlcl9jb21wX3UzMl9zdG9yZTsKKwkJfQorCQlicmVhazsKKwljYXNlIENPVU5U
RVJfQ09NUF9VNjQ6CisJCWlmIChjb21wLT5kZXZpY2VfdTY0X3JlYWQpIHsKKwkJCWRldl9hdHRy
LT5hdHRyLm1vZGUgfD0gMDQ0NDsKKwkJCWRldl9hdHRyLT5zaG93ID0gY291bnRlcl9jb21wX3U2
NF9zaG93OworCQl9CisJCWlmIChjb21wLT5kZXZpY2VfdTY0X3dyaXRlKSB7CisJCQlkZXZfYXR0
ci0+YXR0ci5tb2RlIHw9IDAyMDA7CisJCQlkZXZfYXR0ci0+c3RvcmUgPSBjb3VudGVyX2NvbXBf
dTY0X3N0b3JlOworCQl9CisJCWJyZWFrOworCWRlZmF1bHQ6CisJCXJldHVybiAtRUlOVkFMOwor
CX0KKworCS8qIFN0b3JlIGxpc3Qgbm9kZSAqLworCWxpc3RfYWRkKCZjb3VudGVyX2F0dHItPmws
ICZncm91cC0+YXR0cl9saXN0KTsKKwlncm91cC0+bnVtX2F0dHIrKzsKKworCS8qIENyZWF0ZSAi
Kl9hdmFpbGFibGUiIGF0dHJpYnV0ZSBpZiBuZWVkZWQgKi8KKwlzd2l0Y2ggKGNvbXAtPnR5cGUp
IHsKKwljYXNlIENPVU5URVJfQ09NUF9GVU5DVElPTjoKKwljYXNlIENPVU5URVJfQ09NUF9TWU5B
UFNFX0FDVElPTjoKKwljYXNlIENPVU5URVJfQ09NUF9FTlVNOgorCWNhc2UgQ09VTlRFUl9DT01Q
X0NPVU5UX01PREU6CisJCXJldHVybiBjb3VudGVyX2F2YWlsX2F0dHJfY3JlYXRlKGRldiwgZ3Jv
dXAsIGNvbXAsIHBhcmVudCk7CisJZGVmYXVsdDoKKwkJcmV0dXJuIDA7CisJfQorfQorCitzdGF0
aWMgc3NpemVfdCBjb3VudGVyX2NvbXBfbmFtZV9zaG93KHN0cnVjdCBkZXZpY2UgKmRldiwKKwkJ
CQkgICAgICBzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSAqYXR0ciwgY2hhciAqYnVmKQoreworCXJl
dHVybiBzeXNmc19lbWl0KGJ1ZiwgIiVzXG4iLCB0b19jb3VudGVyX2F0dHJpYnV0ZShhdHRyKS0+
Y29tcC5uYW1lKTsKK30KKworc3RhdGljIGludCBjb3VudGVyX25hbWVfYXR0cl9jcmVhdGUoc3Ry
dWN0IGRldmljZSAqY29uc3QgZGV2LAorCQkJCSAgICBzdHJ1Y3QgY291bnRlcl9hdHRyaWJ1dGVf
Z3JvdXAgKmNvbnN0IGdyb3VwLAorCQkJCSAgICBjb25zdCBjaGFyICpjb25zdCBuYW1lKQorewor
CXN0cnVjdCBjb3VudGVyX2F0dHJpYnV0ZSAqY291bnRlcl9hdHRyOworCisJLyogQWxsb2NhdGUg
Q291bnRlciBhdHRyaWJ1dGUgKi8KKwljb3VudGVyX2F0dHIgPSBkZXZtX2t6YWxsb2MoZGV2LCBz
aXplb2YoKmNvdW50ZXJfYXR0ciksIEdGUF9LRVJORUwpOworCWlmICghY291bnRlcl9hdHRyKQor
CQlyZXR1cm4gLUVOT01FTTsKKworCS8qIENvbmZpZ3VyZSBDb3VudGVyIGF0dHJpYnV0ZSAqLwor
CWNvdW50ZXJfYXR0ci0+Y29tcC5uYW1lID0gbmFtZTsKKworCS8qIENvbmZpZ3VyZSBkZXZpY2Ug
YXR0cmlidXRlICovCisJc3lzZnNfYXR0cl9pbml0KCZjb3VudGVyX2F0dHItPmRldl9hdHRyLmF0
dHIpOworCWNvdW50ZXJfYXR0ci0+ZGV2X2F0dHIuYXR0ci5uYW1lID0gIm5hbWUiOworCWNvdW50
ZXJfYXR0ci0+ZGV2X2F0dHIuYXR0ci5tb2RlID0gMDQ0NDsKKwljb3VudGVyX2F0dHItPmRldl9h
dHRyLnNob3cgPSBjb3VudGVyX2NvbXBfbmFtZV9zaG93OworCisJLyogU3RvcmUgbGlzdCBub2Rl
ICovCisJbGlzdF9hZGQoJmNvdW50ZXJfYXR0ci0+bCwgJmdyb3VwLT5hdHRyX2xpc3QpOworCWdy
b3VwLT5udW1fYXR0cisrOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgY291bnRl
cl9jb21wIGNvdW50ZXJfc2lnbmFsX2NvbXAgPSB7CisJLnR5cGUgPSBDT1VOVEVSX0NPTVBfU0lH
TkFMX0xFVkVMLAorCS5uYW1lID0gInNpZ25hbCIsCit9OworCitzdGF0aWMgaW50IGNvdW50ZXJf
c2lnbmFsX2F0dHJzX2NyZWF0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvbnN0IGNvdW50ZXIs
CisJc3RydWN0IGNvdW50ZXJfYXR0cmlidXRlX2dyb3VwICpjb25zdCBjYXR0cl9ncm91cCwKKwlz
dHJ1Y3QgY291bnRlcl9zaWduYWwgKmNvbnN0IHNpZ25hbCkKK3sKKwljb25zdCBlbnVtIGNvdW50
ZXJfc2NvcGUgc2NvcGUgPSBDT1VOVEVSX1NDT1BFX1NJR05BTDsKKwlzdHJ1Y3QgZGV2aWNlICpj
b25zdCBkZXYgPSAmY291bnRlci0+ZGV2OworCWludCBlcnI7CisJc3RydWN0IGNvdW50ZXJfY29t
cCBjb21wOworCXNpemVfdCBpOworCisJLyogQ3JlYXRlIG1haW4gU2lnbmFsIGF0dHJpYnV0ZSAq
LworCWNvbXAgPSBjb3VudGVyX3NpZ25hbF9jb21wOworCWNvbXAuc2lnbmFsX3UzMl9yZWFkID0g
Y291bnRlci0+b3BzLT5zaWduYWxfcmVhZDsKKwllcnIgPSBjb3VudGVyX2F0dHJfY3JlYXRlKGRl
diwgY2F0dHJfZ3JvdXAsICZjb21wLCBzY29wZSwgc2lnbmFsKTsKKwlpZiAoZXJyIDwgMCkKKwkJ
cmV0dXJuIGVycjsKKworCS8qIENyZWF0ZSBTaWduYWwgbmFtZSBhdHRyaWJ1dGUgKi8KKwllcnIg
PSBjb3VudGVyX25hbWVfYXR0cl9jcmVhdGUoZGV2LCBjYXR0cl9ncm91cCwgc2lnbmFsLT5uYW1l
KTsKKwlpZiAoZXJyIDwgMCkKKwkJcmV0dXJuIGVycjsKKworCS8qIENyZWF0ZSBhbiBhdHRyaWJ1
dGUgZm9yIGVhY2ggZXh0ZW5zaW9uICovCisJZm9yIChpID0gMDsgaSA8IHNpZ25hbC0+bnVtX2V4
dDsgaSsrKSB7CisJCWVyciA9IGNvdW50ZXJfYXR0cl9jcmVhdGUoZGV2LCBjYXR0cl9ncm91cCwg
c2lnbmFsLT5leHQgKyBpLAorCQkJCQkgIHNjb3BlLCBzaWduYWwpOworCQlpZiAoZXJyIDwgMCkK
KwkJCXJldHVybiBlcnI7CisJfQorCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgY291bnRl
cl9zeXNmc19zaWduYWxzX2FkZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvbnN0IGNvdW50ZXIs
CisJc3RydWN0IGNvdW50ZXJfYXR0cmlidXRlX2dyb3VwICpjb25zdCBncm91cHMpCit7CisJc2l6
ZV90IGk7CisJaW50IGVycjsKKworCS8qIEFkZCBlYWNoIFNpZ25hbCAqLworCWZvciAoaSA9IDA7
IGkgPCBjb3VudGVyLT5udW1fc2lnbmFsczsgaSsrKSB7CisJCS8qIEdlbmVyYXRlIFNpZ25hbCBh
dHRyaWJ1dGUgZGlyZWN0b3J5IG5hbWUgKi8KKwkJZ3JvdXBzW2ldLm5hbWUgPSBkZXZtX2thc3By
aW50ZigmY291bnRlci0+ZGV2LCBHRlBfS0VSTkVMLAorCQkJCQkJInNpZ25hbCV6dSIsIGkpOwor
CQlpZiAoIWdyb3Vwc1tpXS5uYW1lKQorCQkJcmV0dXJuIC1FTk9NRU07CisKKwkJLyogQ3JlYXRl
IGFsbCBhdHRyaWJ1dGVzIGFzc29jaWF0ZWQgd2l0aCBTaWduYWwgKi8KKwkJZXJyID0gY291bnRl
cl9zaWduYWxfYXR0cnNfY3JlYXRlKGNvdW50ZXIsIGdyb3VwcyArIGksCisJCQkJCQkgIGNvdW50
ZXItPnNpZ25hbHMgKyBpKTsKKwkJaWYgKGVyciA8IDApCisJCQlyZXR1cm4gZXJyOworCX0KKwor
CXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGNvdW50ZXJfc3lzZnNfc3luYXBzZXNfYWRkKHN0
cnVjdCBjb3VudGVyX2RldmljZSAqY29uc3QgY291bnRlciwKKwlzdHJ1Y3QgY291bnRlcl9hdHRy
aWJ1dGVfZ3JvdXAgKmNvbnN0IGdyb3VwLAorCXN0cnVjdCBjb3VudGVyX2NvdW50ICpjb25zdCBj
b3VudCkKK3sKKwlzaXplX3QgaTsKKworCS8qIEFkZCBlYWNoIFN5bmFwc2UgKi8KKwlmb3IgKGkg
PSAwOyBpIDwgY291bnQtPm51bV9zeW5hcHNlczsgaSsrKSB7CisJCXN0cnVjdCBkZXZpY2UgKmNv
bnN0IGRldiA9ICZjb3VudGVyLT5kZXY7CisJCXN0cnVjdCBjb3VudGVyX3N5bmFwc2UgKnN5bmFw
c2U7CisJCXNpemVfdCBpZDsKKwkJc3RydWN0IGNvdW50ZXJfY29tcCBjb21wOworCQlpbnQgZXJy
OworCisJCXN5bmFwc2UgPSBjb3VudC0+c3luYXBzZXMgKyBpOworCisJCS8qIEdlbmVyYXRlIFN5
bmFwc2UgYWN0aW9uIG5hbWUgKi8KKwkJaWQgPSBzeW5hcHNlLT5zaWduYWwgLSBjb3VudGVyLT5z
aWduYWxzOworCQljb21wLm5hbWUgPSBkZXZtX2thc3ByaW50ZihkZXYsIEdGUF9LRVJORUwsICJz
aWduYWwlenVfYWN0aW9uIiwKKwkJCQkJICAgaWQpOworCQlpZiAoIWNvbXAubmFtZSkKKwkJCXJl
dHVybiAtRU5PTUVNOworCisJCS8qIENyZWF0ZSBhY3Rpb24gYXR0cmlidXRlICovCisJCWNvbXAu
dHlwZSA9IENPVU5URVJfQ09NUF9TWU5BUFNFX0FDVElPTjsKKwkJY29tcC5hY3Rpb25fcmVhZCA9
IGNvdW50ZXItPm9wcy0+YWN0aW9uX3JlYWQ7CisJCWNvbXAuYWN0aW9uX3dyaXRlID0gY291bnRl
ci0+b3BzLT5hY3Rpb25fd3JpdGU7CisJCWNvbXAucHJpdiA9IHN5bmFwc2U7CisJCWVyciA9IGNv
dW50ZXJfYXR0cl9jcmVhdGUoZGV2LCBncm91cCwgJmNvbXAsCisJCQkJCSAgQ09VTlRFUl9TQ09Q
RV9DT1VOVCwgY291bnQpOworCQlpZiAoZXJyIDwgMCkKKwkJCXJldHVybiBlcnI7CisJfQorCisJ
cmV0dXJuIDA7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgY291bnRlcl9jb21wIGNvdW50ZXJfY291bnRf
Y29tcCA9CisJQ09VTlRFUl9DT01QX0NPVU5UX1U2NCgiY291bnQiLCBOVUxMLCBOVUxMKTsKKwor
c3RhdGljIHN0cnVjdCBjb3VudGVyX2NvbXAgY291bnRlcl9mdW5jdGlvbl9jb21wID0geworCS50
eXBlID0gQ09VTlRFUl9DT01QX0ZVTkNUSU9OLAorCS5uYW1lID0gImZ1bmN0aW9uIiwKK307CisK
K3N0YXRpYyBpbnQgY291bnRlcl9jb3VudF9hdHRyc19jcmVhdGUoc3RydWN0IGNvdW50ZXJfZGV2
aWNlICpjb25zdCBjb3VudGVyLAorCXN0cnVjdCBjb3VudGVyX2F0dHJpYnV0ZV9ncm91cCAqY29u
c3QgY2F0dHJfZ3JvdXAsCisJc3RydWN0IGNvdW50ZXJfY291bnQgKmNvbnN0IGNvdW50KQorewor
CWNvbnN0IGVudW0gY291bnRlcl9zY29wZSBzY29wZSA9IENPVU5URVJfU0NPUEVfQ09VTlQ7CisJ
c3RydWN0IGRldmljZSAqY29uc3QgZGV2ID0gJmNvdW50ZXItPmRldjsKKwlpbnQgZXJyOworCXN0
cnVjdCBjb3VudGVyX2NvbXAgY29tcDsKKwlzaXplX3QgaTsKKworCS8qIENyZWF0ZSBtYWluIENv
dW50IGF0dHJpYnV0ZSAqLworCWNvbXAgPSBjb3VudGVyX2NvdW50X2NvbXA7CisJY29tcC5jb3Vu
dF91NjRfcmVhZCA9IGNvdW50ZXItPm9wcy0+Y291bnRfcmVhZDsKKwljb21wLmNvdW50X3U2NF93
cml0ZSA9IGNvdW50ZXItPm9wcy0+Y291bnRfd3JpdGU7CisJZXJyID0gY291bnRlcl9hdHRyX2Ny
ZWF0ZShkZXYsIGNhdHRyX2dyb3VwLCAmY29tcCwgc2NvcGUsIGNvdW50KTsKKwlpZiAoZXJyIDwg
MCkKKwkJcmV0dXJuIGVycjsKKworCS8qIENyZWF0ZSBDb3VudCBuYW1lIGF0dHJpYnV0ZSAqLwor
CWVyciA9IGNvdW50ZXJfbmFtZV9hdHRyX2NyZWF0ZShkZXYsIGNhdHRyX2dyb3VwLCBjb3VudC0+
bmFtZSk7CisJaWYgKGVyciA8IDApCisJCXJldHVybiBlcnI7CisKKwkvKiBDcmVhdGUgQ291bnQg
ZnVuY3Rpb24gYXR0cmlidXRlICovCisJY29tcCA9IGNvdW50ZXJfZnVuY3Rpb25fY29tcDsKKwlj
b21wLmNvdW50X3UzMl9yZWFkID0gY291bnRlci0+b3BzLT5mdW5jdGlvbl9yZWFkOworCWNvbXAu
Y291bnRfdTMyX3dyaXRlID0gY291bnRlci0+b3BzLT5mdW5jdGlvbl93cml0ZTsKKwllcnIgPSBj
b3VudGVyX2F0dHJfY3JlYXRlKGRldiwgY2F0dHJfZ3JvdXAsICZjb21wLCBzY29wZSwgY291bnQp
OworCWlmIChlcnIgPCAwKQorCQlyZXR1cm4gZXJyOworCisJLyogQ3JlYXRlIGFuIGF0dHJpYnV0
ZSBmb3IgZWFjaCBleHRlbnNpb24gKi8KKwlmb3IgKGkgPSAwOyBpIDwgY291bnQtPm51bV9leHQ7
IGkrKykgeworCQllcnIgPSBjb3VudGVyX2F0dHJfY3JlYXRlKGRldiwgY2F0dHJfZ3JvdXAsIGNv
dW50LT5leHQgKyBpLAorCQkJCQkgIHNjb3BlLCBjb3VudCk7CisJCWlmIChlcnIgPCAwKQorCQkJ
cmV0dXJuIGVycjsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBjb3VudGVyX3N5
c2ZzX2NvdW50c19hZGQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb25zdCBjb3VudGVyLAorCXN0
cnVjdCBjb3VudGVyX2F0dHJpYnV0ZV9ncm91cCAqY29uc3QgZ3JvdXBzKQoreworCXNpemVfdCBp
OworCXN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudDsKKwlpbnQgZXJyOworCisJLyogQWRkIGVh
Y2ggQ291bnQgKi8KKwlmb3IgKGkgPSAwOyBpIDwgY291bnRlci0+bnVtX2NvdW50czsgaSsrKSB7
CisJCWNvdW50ID0gY291bnRlci0+Y291bnRzICsgaTsKKworCQkvKiBHZW5lcmF0ZSBDb3VudCBh
dHRyaWJ1dGUgZGlyZWN0b3J5IG5hbWUgKi8KKwkJZ3JvdXBzW2ldLm5hbWUgPSBkZXZtX2thc3By
aW50ZigmY291bnRlci0+ZGV2LCBHRlBfS0VSTkVMLAorCQkJCQkJImNvdW50JXp1IiwgaSk7CisJ
CWlmICghZ3JvdXBzW2ldLm5hbWUpCisJCQlyZXR1cm4gLUVOT01FTTsKKworCQkvKiBBZGQgc3lz
ZnMgYXR0cmlidXRlcyBvZiB0aGUgU3luYXBzZXMgKi8KKwkJZXJyID0gY291bnRlcl9zeXNmc19z
eW5hcHNlc19hZGQoY291bnRlciwgZ3JvdXBzICsgaSwgY291bnQpOworCQlpZiAoZXJyIDwgMCkK
KwkJCXJldHVybiBlcnI7CisKKwkJLyogQ3JlYXRlIGFsbCBhdHRyaWJ1dGVzIGFzc29jaWF0ZWQg
d2l0aCBDb3VudCAqLworCQllcnIgPSBjb3VudGVyX2NvdW50X2F0dHJzX2NyZWF0ZShjb3VudGVy
LCBncm91cHMgKyBpLCBjb3VudCk7CisJCWlmIChlcnIgPCAwKQorCQkJcmV0dXJuIGVycjsKKwl9
CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBjb3VudGVyX251bV9zaWduYWxzX3JlYWQo
c3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLCB1OCAqdmFsKQoreworCSp2YWwgPSBjb3Vu
dGVyLT5udW1fc2lnbmFsczsKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBjb3VudGVyX251
bV9jb3VudHNfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsIHU4ICp2YWwpCit7
CisJKnZhbCA9IGNvdW50ZXItPm51bV9jb3VudHM7CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBz
dHJ1Y3QgY291bnRlcl9jb21wIGNvdW50ZXJfbnVtX3NpZ25hbHNfY29tcCA9CisJQ09VTlRFUl9D
T01QX0RFVklDRV9VOCgibnVtX3NpZ25hbHMiLCBjb3VudGVyX251bV9zaWduYWxzX3JlYWQsIE5V
TEwpOworCitzdGF0aWMgc3RydWN0IGNvdW50ZXJfY29tcCBjb3VudGVyX251bV9jb3VudHNfY29t
cCA9CisJQ09VTlRFUl9DT01QX0RFVklDRV9VOCgibnVtX2NvdW50cyIsIGNvdW50ZXJfbnVtX2Nv
dW50c19yZWFkLCBOVUxMKTsKKworc3RhdGljIGludCBjb3VudGVyX3N5c2ZzX2F0dHJfYWRkKHN0
cnVjdCBjb3VudGVyX2RldmljZSAqY29uc3QgY291bnRlciwKKwkJCQkgIHN0cnVjdCBjb3VudGVy
X2F0dHJpYnV0ZV9ncm91cCAqY2F0dHJfZ3JvdXApCit7CisJY29uc3QgZW51bSBjb3VudGVyX3Nj
b3BlIHNjb3BlID0gQ09VTlRFUl9TQ09QRV9ERVZJQ0U7CisJc3RydWN0IGRldmljZSAqY29uc3Qg
ZGV2ID0gJmNvdW50ZXItPmRldjsKKwlpbnQgZXJyOworCXNpemVfdCBpOworCisJLyogQWRkIFNp
Z25hbHMgc3lzZnMgYXR0cmlidXRlcyAqLworCWVyciA9IGNvdW50ZXJfc3lzZnNfc2lnbmFsc19h
ZGQoY291bnRlciwgY2F0dHJfZ3JvdXApOworCWlmIChlcnIgPCAwKQorCQlyZXR1cm4gZXJyOwor
CWNhdHRyX2dyb3VwICs9IGNvdW50ZXItPm51bV9zaWduYWxzOworCisJLyogQWRkIENvdW50cyBz
eXNmcyBhdHRyaWJ1dGVzICovCisJZXJyID0gY291bnRlcl9zeXNmc19jb3VudHNfYWRkKGNvdW50
ZXIsIGNhdHRyX2dyb3VwKTsKKwlpZiAoZXJyIDwgMCkKKwkJcmV0dXJuIGVycjsKKwljYXR0cl9n
cm91cCArPSBjb3VudGVyLT5udW1fY291bnRzOworCisJLyogQ3JlYXRlIG5hbWUgYXR0cmlidXRl
ICovCisJZXJyID0gY291bnRlcl9uYW1lX2F0dHJfY3JlYXRlKGRldiwgY2F0dHJfZ3JvdXAsIGNv
dW50ZXItPm5hbWUpOworCWlmIChlcnIgPCAwKQorCQlyZXR1cm4gZXJyOworCisJLyogQ3JlYXRl
IG51bV9zaWduYWxzIGF0dHJpYnV0ZSAqLworCWVyciA9IGNvdW50ZXJfYXR0cl9jcmVhdGUoZGV2
LCBjYXR0cl9ncm91cCwgJmNvdW50ZXJfbnVtX3NpZ25hbHNfY29tcCwKKwkJCQkgIHNjb3BlLCBO
VUxMKTsKKwlpZiAoZXJyIDwgMCkKKwkJcmV0dXJuIGVycjsKKworCS8qIENyZWF0ZSBudW1fY291
bnRzIGF0dHJpYnV0ZSAqLworCWVyciA9IGNvdW50ZXJfYXR0cl9jcmVhdGUoZGV2LCBjYXR0cl9n
cm91cCwgJmNvdW50ZXJfbnVtX2NvdW50c19jb21wLAorCQkJCSAgc2NvcGUsIE5VTEwpOworCWlm
IChlcnIgPCAwKQorCQlyZXR1cm4gZXJyOworCisJLyogQ3JlYXRlIGFuIGF0dHJpYnV0ZSBmb3Ig
ZWFjaCBleHRlbnNpb24gKi8KKwlmb3IgKGkgPSAwOyBpIDwgY291bnRlci0+bnVtX2V4dDsgaSsr
KSB7CisJCWVyciA9IGNvdW50ZXJfYXR0cl9jcmVhdGUoZGV2LCBjYXR0cl9ncm91cCwgY291bnRl
ci0+ZXh0ICsgaSwKKwkJCQkJICBzY29wZSwgTlVMTCk7CisJCWlmIChlcnIgPCAwKQorCQkJcmV0
dXJuIGVycjsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworLyoqCisgKiBjb3VudGVyX3N5c2ZzX2Fk
ZCAtIEFkZHMgQ291bnRlciBzeXNmcyBhdHRyaWJ1dGVzIHRvIHRoZSBkZXZpY2Ugc3RydWN0dXJl
CisgKiBAY291bnRlcjoJUG9pbnRlciB0byB0aGUgQ291bnRlciBkZXZpY2Ugc3RydWN0dXJlCisg
KgorICogQ291bnRlciBzeXNmcyBhdHRyaWJ1dGVzIGFyZSBjcmVhdGVkIGFuZCBhZGRlZCB0byB0
aGUgcmVzcGVjdGl2ZSBkZXZpY2UKKyAqIHN0cnVjdHVyZSBmb3IgbGF0ZXIgcmVnaXN0cmF0aW9u
IHRvIHRoZSBzeXN0ZW0uIFJlc291cmNlLW1hbmFnZWQgbWVtb3J5CisgKiBhbGxvY2F0aW9uIGlz
IHBlcmZvcm1lZCBieSB0aGlzIGZ1bmN0aW9uLCBhbmQgdGhpcyBtZW1vcnkgc2hvdWxkIGJlIGZy
ZWVkCisgKiB3aGVuIG5vIGxvbmdlciBuZWVkZWQgKGF1dG9tYXRpY2FsbHkgYnkgYSBkZXZpY2Vf
dW5yZWdpc3RlciBjYWxsLCBvcgorICogbWFudWFsbHkgYnkgYSBkZXZyZXNfcmVsZWFzZV9hbGwg
Y2FsbCkuCisgKi8KK2ludCBjb3VudGVyX3N5c2ZzX2FkZChzdHJ1Y3QgY291bnRlcl9kZXZpY2Ug
KmNvbnN0IGNvdW50ZXIpCit7CisJc3RydWN0IGRldmljZSAqY29uc3QgZGV2ID0gJmNvdW50ZXIt
PmRldjsKKwljb25zdCBzaXplX3QgbnVtX2dyb3VwcyA9IGNvdW50ZXItPm51bV9zaWduYWxzICsg
Y291bnRlci0+bnVtX2NvdW50cyArIDE7CisJc3RydWN0IGNvdW50ZXJfYXR0cmlidXRlX2dyb3Vw
ICpjYXR0cl9ncm91cHM7CisJc2l6ZV90IGksIGo7CisJaW50IGVycjsKKwlzdHJ1Y3QgYXR0cmli
dXRlX2dyb3VwICpncm91cHM7CisJc3RydWN0IGNvdW50ZXJfYXR0cmlidXRlICpwOworCisJLyog
QWxsb2NhdGUgc3BhY2UgZm9yIGF0dHJpYnV0ZSBncm91cHMgKHNpZ25hbHMsIGNvdW50cywgYW5k
IGV4dCkgKi8KKwljYXR0cl9ncm91cHMgPSBkZXZtX2tjYWxsb2MoZGV2LCBudW1fZ3JvdXBzLCBz
aXplb2YoKmNhdHRyX2dyb3VwcyksCisJCQkJICAgIEdGUF9LRVJORUwpOworCWlmICghY2F0dHJf
Z3JvdXBzKQorCQlyZXR1cm4gLUVOT01FTTsKKworCS8qIEluaXRpYWxpemUgYXR0cmlidXRlIGxp
c3RzICovCisJZm9yIChpID0gMDsgaSA8IG51bV9ncm91cHM7IGkrKykKKwkJSU5JVF9MSVNUX0hF
QUQoJmNhdHRyX2dyb3Vwc1tpXS5hdHRyX2xpc3QpOworCisJLyogQWRkIENvdW50ZXIgZGV2aWNl
IHN5c2ZzIGF0dHJpYnV0ZXMgKi8KKwllcnIgPSBjb3VudGVyX3N5c2ZzX2F0dHJfYWRkKGNvdW50
ZXIsIGNhdHRyX2dyb3Vwcyk7CisJaWYgKGVyciA8IDApCisJCXJldHVybiBlcnI7CisKKwkvKiBB
bGxvY2F0ZSBhdHRyaWJ1dGUgZ3JvdXAgcG9pbnRlcnMgZm9yIGFzc29jaWF0aW9uIHdpdGggZGV2
aWNlICovCisJZGV2LT5ncm91cHMgPSBkZXZtX2tjYWxsb2MoZGV2LCBudW1fZ3JvdXBzICsgMSwg
c2l6ZW9mKCpkZXYtPmdyb3VwcyksCisJCQkJICAgR0ZQX0tFUk5FTCk7CisJaWYgKCFkZXYtPmdy
b3VwcykKKwkJcmV0dXJuIC1FTk9NRU07CisKKwkvKiBBbGxvY2F0ZSBzcGFjZSBmb3IgYXR0cmli
dXRlIGdyb3VwcyAqLworCWdyb3VwcyA9IGRldm1fa2NhbGxvYyhkZXYsIG51bV9ncm91cHMsIHNp
emVvZigqZ3JvdXBzKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFncm91cHMpCisJCXJldHVybiAtRU5P
TUVNOworCisJLyogUHJlcGFyZSBlYWNoIGdyb3VwIG9mIGF0dHJpYnV0ZXMgZm9yIGFzc29jaWF0
aW9uICovCisJZm9yIChpID0gMDsgaSA8IG51bV9ncm91cHM7IGkrKykgeworCQlncm91cHNbaV0u
bmFtZSA9IGNhdHRyX2dyb3Vwc1tpXS5uYW1lOworCisJCS8qIEFsbG9jYXRlIHNwYWNlIGZvciBh
dHRyaWJ1dGUgcG9pbnRlcnMgKi8KKwkJZ3JvdXBzW2ldLmF0dHJzID0gZGV2bV9rY2FsbG9jKGRl
diwKKwkJCQkJICAgICAgIGNhdHRyX2dyb3Vwc1tpXS5udW1fYXR0ciArIDEsCisJCQkJCSAgICAg
ICBzaXplb2YoKmdyb3Vwc1tpXS5hdHRycyksCisJCQkJCSAgICAgICBHRlBfS0VSTkVMKTsKKwkJ
aWYgKCFncm91cHNbaV0uYXR0cnMpCisJCQlyZXR1cm4gLUVOT01FTTsKKworCQkvKiBBZGQgYXR0
cmlidXRlIHBvaW50ZXJzIHRvIGF0dHJpYnV0ZSBncm91cCAqLworCQlqID0gMDsKKwkJbGlzdF9m
b3JfZWFjaF9lbnRyeShwLCAmY2F0dHJfZ3JvdXBzW2ldLmF0dHJfbGlzdCwgbCkKKwkJCWdyb3Vw
c1tpXS5hdHRyc1tqKytdID0gJnAtPmRldl9hdHRyLmF0dHI7CisKKwkJLyogQXNzb2NpYXRlIGF0
dHJpYnV0ZSBncm91cCAqLworCQlkZXYtPmdyb3Vwc1tpXSA9ICZncm91cHNbaV07CisJfQorCisJ
cmV0dXJuIDA7Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2NvdW50ZXIvY291bnRlci1zeXNmcy5o
IGIvZHJpdmVycy9jb3VudGVyL2NvdW50ZXItc3lzZnMuaApuZXcgZmlsZSBtb2RlIDEwMDY0NApp
bmRleCAwMDAwMDAwMDAwMDAuLjE0ZmU1NjZhY2EwZQotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZl
cnMvY291bnRlci9jb3VudGVyLXN5c2ZzLmgKQEAgLTAsMCArMSwxMyBAQAorLyogU1BEWC1MaWNl
bnNlLUlkZW50aWZpZXI6IEdQTC0yLjAgKi8KKy8qCisgKiBDb3VudGVyIHN5c2ZzIGludGVyZmFj
ZQorICogQ29weXJpZ2h0IChDKSAyMDIwIFdpbGxpYW0gQnJlYXRoaXR0IEdyYXkKKyAqLworI2lm
bmRlZiBfQ09VTlRFUl9TWVNGU19IXworI2RlZmluZSBfQ09VTlRFUl9TWVNGU19IXworCisjaW5j
bHVkZSA8bGludXgvY291bnRlci5oPgorCitpbnQgY291bnRlcl9zeXNmc19hZGQoc3RydWN0IGNv
dW50ZXJfZGV2aWNlICpjb25zdCBjb3VudGVyKTsKKworI2VuZGlmIC8qIF9DT1VOVEVSX1NZU0ZT
X0hfICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2NvdW50ZXIvY291bnRlci5jIGIvZHJpdmVycy9j
b3VudGVyL2NvdW50ZXIuYwpkZWxldGVkIGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggZGU5MjFlOGEz
ZjcyLi4wMDAwMDAwMDAwMDAKLS0tIGEvZHJpdmVycy9jb3VudGVyL2NvdW50ZXIuYworKysgL2Rl
di9udWxsCkBAIC0xLDE0OTYgKzAsMCBAQAotLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQ
TC0yLjAKLS8qCi0gKiBHZW5lcmljIENvdW50ZXIgaW50ZXJmYWNlCi0gKiBDb3B5cmlnaHQgKEMp
IDIwMTggV2lsbGlhbSBCcmVhdGhpdHQgR3JheQotICovCi0jaW5jbHVkZSA8bGludXgvY291bnRl
ci5oPgotI2luY2x1ZGUgPGxpbnV4L2RldmljZS5oPgotI2luY2x1ZGUgPGxpbnV4L2Vyci5oPgot
I2luY2x1ZGUgPGxpbnV4L2V4cG9ydC5oPgotI2luY2x1ZGUgPGxpbnV4L2ZzLmg+Ci0jaW5jbHVk
ZSA8bGludXgvZ2ZwLmg+Ci0jaW5jbHVkZSA8bGludXgvaWRyLmg+Ci0jaW5jbHVkZSA8bGludXgv
aW5pdC5oPgotI2luY2x1ZGUgPGxpbnV4L2tlcm5lbC5oPgotI2luY2x1ZGUgPGxpbnV4L2xpc3Qu
aD4KLSNpbmNsdWRlIDxsaW51eC9tb2R1bGUuaD4KLSNpbmNsdWRlIDxsaW51eC9wcmludGsuaD4K
LSNpbmNsdWRlIDxsaW51eC9zbGFiLmg+Ci0jaW5jbHVkZSA8bGludXgvc3RyaW5nLmg+Ci0jaW5j
bHVkZSA8bGludXgvc3lzZnMuaD4KLSNpbmNsdWRlIDxsaW51eC90eXBlcy5oPgotCi1jb25zdCBj
aGFyICpjb25zdCBjb3VudGVyX2NvdW50X2RpcmVjdGlvbl9zdHJbMl0gPSB7Ci0JW0NPVU5URVJf
Q09VTlRfRElSRUNUSU9OX0ZPUldBUkRdID0gImZvcndhcmQiLAotCVtDT1VOVEVSX0NPVU5UX0RJ
UkVDVElPTl9CQUNLV0FSRF0gPSAiYmFja3dhcmQiCi19OwotRVhQT1JUX1NZTUJPTF9HUEwoY291
bnRlcl9jb3VudF9kaXJlY3Rpb25fc3RyKTsKLQotY29uc3QgY2hhciAqY29uc3QgY291bnRlcl9j
b3VudF9tb2RlX3N0cls0XSA9IHsKLQlbQ09VTlRFUl9DT1VOVF9NT0RFX05PUk1BTF0gPSAibm9y
bWFsIiwKLQlbQ09VTlRFUl9DT1VOVF9NT0RFX1JBTkdFX0xJTUlUXSA9ICJyYW5nZSBsaW1pdCIs
Ci0JW0NPVU5URVJfQ09VTlRfTU9ERV9OT05fUkVDWUNMRV0gPSAibm9uLXJlY3ljbGUiLAotCVtD
T1VOVEVSX0NPVU5UX01PREVfTU9EVUxPX05dID0gIm1vZHVsby1uIgotfTsKLUVYUE9SVF9TWU1C
T0xfR1BMKGNvdW50ZXJfY291bnRfbW9kZV9zdHIpOwotCi1zc2l6ZV90IGNvdW50ZXJfc2lnbmFs
X2VudW1fcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkJIHN0cnVjdCBj
b3VudGVyX3NpZ25hbCAqc2lnbmFsLCB2b2lkICpwcml2LAotCQkJCSBjaGFyICpidWYpCi17Ci0J
Y29uc3Qgc3RydWN0IGNvdW50ZXJfc2lnbmFsX2VudW1fZXh0ICpjb25zdCBlID0gcHJpdjsKLQlp
bnQgZXJyOwotCXNpemVfdCBpbmRleDsKLQotCWlmICghZS0+Z2V0KQotCQlyZXR1cm4gLUVJTlZB
TDsKLQotCWVyciA9IGUtPmdldChjb3VudGVyLCBzaWduYWwsICZpbmRleCk7Ci0JaWYgKGVycikK
LQkJcmV0dXJuIGVycjsKLQotCWlmIChpbmRleCA+PSBlLT5udW1faXRlbXMpCi0JCXJldHVybiAt
RUlOVkFMOwotCi0JcmV0dXJuIHNwcmludGYoYnVmLCAiJXNcbiIsIGUtPml0ZW1zW2luZGV4XSk7
Ci19Ci1FWFBPUlRfU1lNQk9MX0dQTChjb3VudGVyX3NpZ25hbF9lbnVtX3JlYWQpOwotCi1zc2l6
ZV90IGNvdW50ZXJfc2lnbmFsX2VudW1fd3JpdGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3Vu
dGVyLAotCQkJCSAgc3RydWN0IGNvdW50ZXJfc2lnbmFsICpzaWduYWwsIHZvaWQgKnByaXYsCi0J
CQkJICBjb25zdCBjaGFyICpidWYsIHNpemVfdCBsZW4pCi17Ci0JY29uc3Qgc3RydWN0IGNvdW50
ZXJfc2lnbmFsX2VudW1fZXh0ICpjb25zdCBlID0gcHJpdjsKLQlzc2l6ZV90IGluZGV4OwotCWlu
dCBlcnI7Ci0KLQlpZiAoIWUtPnNldCkKLQkJcmV0dXJuIC1FSU5WQUw7Ci0KLQlpbmRleCA9IF9f
c3lzZnNfbWF0Y2hfc3RyaW5nKGUtPml0ZW1zLCBlLT5udW1faXRlbXMsIGJ1Zik7Ci0JaWYgKGlu
ZGV4IDwgMCkKLQkJcmV0dXJuIGluZGV4OwotCi0JZXJyID0gZS0+c2V0KGNvdW50ZXIsIHNpZ25h
bCwgaW5kZXgpOwotCWlmIChlcnIpCi0JCXJldHVybiBlcnI7Ci0KLQlyZXR1cm4gbGVuOwotfQot
RVhQT1JUX1NZTUJPTF9HUEwoY291bnRlcl9zaWduYWxfZW51bV93cml0ZSk7Ci0KLXNzaXplX3Qg
Y291bnRlcl9zaWduYWxfZW51bV9hdmFpbGFibGVfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2Ug
KmNvdW50ZXIsCi0JCQkJCSAgIHN0cnVjdCBjb3VudGVyX3NpZ25hbCAqc2lnbmFsLAotCQkJCQkg
ICB2b2lkICpwcml2LCBjaGFyICpidWYpCi17Ci0JY29uc3Qgc3RydWN0IGNvdW50ZXJfc2lnbmFs
X2VudW1fZXh0ICpjb25zdCBlID0gcHJpdjsKLQlzaXplX3QgaTsKLQlzaXplX3QgbGVuID0gMDsK
LQotCWlmICghZS0+bnVtX2l0ZW1zKQotCQlyZXR1cm4gMDsKLQotCWZvciAoaSA9IDA7IGkgPCBl
LT5udW1faXRlbXM7IGkrKykKLQkJbGVuICs9IHNwcmludGYoYnVmICsgbGVuLCAiJXNcbiIsIGUt
Pml0ZW1zW2ldKTsKLQotCXJldHVybiBsZW47Ci19Ci1FWFBPUlRfU1lNQk9MX0dQTChjb3VudGVy
X3NpZ25hbF9lbnVtX2F2YWlsYWJsZV9yZWFkKTsKLQotc3NpemVfdCBjb3VudGVyX2NvdW50X2Vu
dW1fcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkJc3RydWN0IGNvdW50
ZXJfY291bnQgKmNvdW50LCB2b2lkICpwcml2LAotCQkJCWNoYXIgKmJ1ZikKLXsKLQljb25zdCBz
dHJ1Y3QgY291bnRlcl9jb3VudF9lbnVtX2V4dCAqY29uc3QgZSA9IHByaXY7Ci0JaW50IGVycjsK
LQlzaXplX3QgaW5kZXg7Ci0KLQlpZiAoIWUtPmdldCkKLQkJcmV0dXJuIC1FSU5WQUw7Ci0KLQll
cnIgPSBlLT5nZXQoY291bnRlciwgY291bnQsICZpbmRleCk7Ci0JaWYgKGVycikKLQkJcmV0dXJu
IGVycjsKLQotCWlmIChpbmRleCA+PSBlLT5udW1faXRlbXMpCi0JCXJldHVybiAtRUlOVkFMOwot
Ci0JcmV0dXJuIHNwcmludGYoYnVmLCAiJXNcbiIsIGUtPml0ZW1zW2luZGV4XSk7Ci19Ci1FWFBP
UlRfU1lNQk9MX0dQTChjb3VudGVyX2NvdW50X2VudW1fcmVhZCk7Ci0KLXNzaXplX3QgY291bnRl
cl9jb3VudF9lbnVtX3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQkg
c3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB2b2lkICpwcml2LAotCQkJCSBjb25zdCBjaGFy
ICpidWYsIHNpemVfdCBsZW4pCi17Ci0JY29uc3Qgc3RydWN0IGNvdW50ZXJfY291bnRfZW51bV9l
eHQgKmNvbnN0IGUgPSBwcml2OwotCXNzaXplX3QgaW5kZXg7Ci0JaW50IGVycjsKLQotCWlmICgh
ZS0+c2V0KQotCQlyZXR1cm4gLUVJTlZBTDsKLQotCWluZGV4ID0gX19zeXNmc19tYXRjaF9zdHJp
bmcoZS0+aXRlbXMsIGUtPm51bV9pdGVtcywgYnVmKTsKLQlpZiAoaW5kZXggPCAwKQotCQlyZXR1
cm4gaW5kZXg7Ci0KLQllcnIgPSBlLT5zZXQoY291bnRlciwgY291bnQsIGluZGV4KTsKLQlpZiAo
ZXJyKQotCQlyZXR1cm4gZXJyOwotCi0JcmV0dXJuIGxlbjsKLX0KLUVYUE9SVF9TWU1CT0xfR1BM
KGNvdW50ZXJfY291bnRfZW51bV93cml0ZSk7Ci0KLXNzaXplX3QgY291bnRlcl9jb3VudF9lbnVt
X2F2YWlsYWJsZV9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQkJICBz
dHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCi0JCQkJCSAgdm9pZCAqcHJpdiwgY2hhciAqYnVm
KQotewotCWNvbnN0IHN0cnVjdCBjb3VudGVyX2NvdW50X2VudW1fZXh0ICpjb25zdCBlID0gcHJp
djsKLQlzaXplX3QgaTsKLQlzaXplX3QgbGVuID0gMDsKLQotCWlmICghZS0+bnVtX2l0ZW1zKQot
CQlyZXR1cm4gMDsKLQotCWZvciAoaSA9IDA7IGkgPCBlLT5udW1faXRlbXM7IGkrKykKLQkJbGVu
ICs9IHNwcmludGYoYnVmICsgbGVuLCAiJXNcbiIsIGUtPml0ZW1zW2ldKTsKLQotCXJldHVybiBs
ZW47Ci19Ci1FWFBPUlRfU1lNQk9MX0dQTChjb3VudGVyX2NvdW50X2VudW1fYXZhaWxhYmxlX3Jl
YWQpOwotCi1zc2l6ZV90IGNvdW50ZXJfZGV2aWNlX2VudW1fcmVhZChzdHJ1Y3QgY291bnRlcl9k
ZXZpY2UgKmNvdW50ZXIsIHZvaWQgKnByaXYsCi0JCQkJIGNoYXIgKmJ1ZikKLXsKLQljb25zdCBz
dHJ1Y3QgY291bnRlcl9kZXZpY2VfZW51bV9leHQgKmNvbnN0IGUgPSBwcml2OwotCWludCBlcnI7
Ci0Jc2l6ZV90IGluZGV4OwotCi0JaWYgKCFlLT5nZXQpCi0JCXJldHVybiAtRUlOVkFMOwotCi0J
ZXJyID0gZS0+Z2V0KGNvdW50ZXIsICZpbmRleCk7Ci0JaWYgKGVycikKLQkJcmV0dXJuIGVycjsK
LQotCWlmIChpbmRleCA+PSBlLT5udW1faXRlbXMpCi0JCXJldHVybiAtRUlOVkFMOwotCi0JcmV0
dXJuIHNwcmludGYoYnVmLCAiJXNcbiIsIGUtPml0ZW1zW2luZGV4XSk7Ci19Ci1FWFBPUlRfU1lN
Qk9MX0dQTChjb3VudGVyX2RldmljZV9lbnVtX3JlYWQpOwotCi1zc2l6ZV90IGNvdW50ZXJfZGV2
aWNlX2VudW1fd3JpdGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLCB2b2lkICpwcml2
LAotCQkJCSAgY29uc3QgY2hhciAqYnVmLCBzaXplX3QgbGVuKQotewotCWNvbnN0IHN0cnVjdCBj
b3VudGVyX2RldmljZV9lbnVtX2V4dCAqY29uc3QgZSA9IHByaXY7Ci0Jc3NpemVfdCBpbmRleDsK
LQlpbnQgZXJyOwotCi0JaWYgKCFlLT5zZXQpCi0JCXJldHVybiAtRUlOVkFMOwotCi0JaW5kZXgg
PSBfX3N5c2ZzX21hdGNoX3N0cmluZyhlLT5pdGVtcywgZS0+bnVtX2l0ZW1zLCBidWYpOwotCWlm
IChpbmRleCA8IDApCi0JCXJldHVybiBpbmRleDsKLQotCWVyciA9IGUtPnNldChjb3VudGVyLCBp
bmRleCk7Ci0JaWYgKGVycikKLQkJcmV0dXJuIGVycjsKLQotCXJldHVybiBsZW47Ci19Ci1FWFBP
UlRfU1lNQk9MX0dQTChjb3VudGVyX2RldmljZV9lbnVtX3dyaXRlKTsKLQotc3NpemVfdCBjb3Vu
dGVyX2RldmljZV9lbnVtX2F2YWlsYWJsZV9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291
bnRlciwKLQkJCQkJICAgdm9pZCAqcHJpdiwgY2hhciAqYnVmKQotewotCWNvbnN0IHN0cnVjdCBj
b3VudGVyX2RldmljZV9lbnVtX2V4dCAqY29uc3QgZSA9IHByaXY7Ci0Jc2l6ZV90IGk7Ci0Jc2l6
ZV90IGxlbiA9IDA7Ci0KLQlpZiAoIWUtPm51bV9pdGVtcykKLQkJcmV0dXJuIDA7Ci0KLQlmb3Ig
KGkgPSAwOyBpIDwgZS0+bnVtX2l0ZW1zOyBpKyspCi0JCWxlbiArPSBzcHJpbnRmKGJ1ZiArIGxl
biwgIiVzXG4iLCBlLT5pdGVtc1tpXSk7Ci0KLQlyZXR1cm4gbGVuOwotfQotRVhQT1JUX1NZTUJP
TF9HUEwoY291bnRlcl9kZXZpY2VfZW51bV9hdmFpbGFibGVfcmVhZCk7Ci0KLXN0cnVjdCBjb3Vu
dGVyX2F0dHJfcGFybSB7Ci0Jc3RydWN0IGNvdW50ZXJfZGV2aWNlX2F0dHJfZ3JvdXAgKmdyb3Vw
OwotCWNvbnN0IGNoYXIgKnByZWZpeDsKLQljb25zdCBjaGFyICpuYW1lOwotCXNzaXplX3QgKCpz
aG93KShzdHJ1Y3QgZGV2aWNlICpkZXYsIHN0cnVjdCBkZXZpY2VfYXR0cmlidXRlICphdHRyLAot
CQkJY2hhciAqYnVmKTsKLQlzc2l6ZV90ICgqc3RvcmUpKHN0cnVjdCBkZXZpY2UgKmRldiwgc3Ry
dWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIsCi0JCQkgY29uc3QgY2hhciAqYnVmLCBzaXplX3Qg
bGVuKTsKLQl2b2lkICpjb21wb25lbnQ7Ci19OwotCi1zdHJ1Y3QgY291bnRlcl9kZXZpY2VfYXR0
ciB7Ci0Jc3RydWN0IGRldmljZV9hdHRyaWJ1dGUgZGV2X2F0dHI7Ci0Jc3RydWN0IGxpc3RfaGVh
ZCBsOwotCXZvaWQgKmNvbXBvbmVudDsKLX07Ci0KLXN0YXRpYyBpbnQgY291bnRlcl9hdHRyaWJ1
dGVfY3JlYXRlKGNvbnN0IHN0cnVjdCBjb3VudGVyX2F0dHJfcGFybSAqY29uc3QgcGFybSkKLXsK
LQlzdHJ1Y3QgY291bnRlcl9kZXZpY2VfYXR0ciAqY291bnRlcl9hdHRyOwotCXN0cnVjdCBkZXZp
Y2VfYXR0cmlidXRlICpkZXZfYXR0cjsKLQlpbnQgZXJyOwotCXN0cnVjdCBsaXN0X2hlYWQgKmNv
bnN0IGF0dHJfbGlzdCA9ICZwYXJtLT5ncm91cC0+YXR0cl9saXN0OwotCi0JLyogQWxsb2NhdGUg
YSBDb3VudGVyIGRldmljZSBhdHRyaWJ1dGUgKi8KLQljb3VudGVyX2F0dHIgPSBremFsbG9jKHNp
emVvZigqY291bnRlcl9hdHRyKSwgR0ZQX0tFUk5FTCk7Ci0JaWYgKCFjb3VudGVyX2F0dHIpCi0J
CXJldHVybiAtRU5PTUVNOwotCWRldl9hdHRyID0gJmNvdW50ZXJfYXR0ci0+ZGV2X2F0dHI7Ci0K
LQlzeXNmc19hdHRyX2luaXQoJmRldl9hdHRyLT5hdHRyKTsKLQotCS8qIENvbmZpZ3VyZSBkZXZp
Y2UgYXR0cmlidXRlICovCi0JZGV2X2F0dHItPmF0dHIubmFtZSA9IGthc3ByaW50ZihHRlBfS0VS
TkVMLCAiJXMlcyIsIHBhcm0tPnByZWZpeCwKLQkJCQkJcGFybS0+bmFtZSk7Ci0JaWYgKCFkZXZf
YXR0ci0+YXR0ci5uYW1lKSB7Ci0JCWVyciA9IC1FTk9NRU07Ci0JCWdvdG8gZXJyX2ZyZWVfY291
bnRlcl9hdHRyOwotCX0KLQlpZiAocGFybS0+c2hvdykgewotCQlkZXZfYXR0ci0+YXR0ci5tb2Rl
IHw9IDA0NDQ7Ci0JCWRldl9hdHRyLT5zaG93ID0gcGFybS0+c2hvdzsKLQl9Ci0JaWYgKHBhcm0t
PnN0b3JlKSB7Ci0JCWRldl9hdHRyLT5hdHRyLm1vZGUgfD0gMDIwMDsKLQkJZGV2X2F0dHItPnN0
b3JlID0gcGFybS0+c3RvcmU7Ci0JfQotCi0JLyogU3RvcmUgYXNzb2NpYXRlZCBDb3VudGVyIGNv
bXBvbmVudCB3aXRoIGF0dHJpYnV0ZSAqLwotCWNvdW50ZXJfYXR0ci0+Y29tcG9uZW50ID0gcGFy
bS0+Y29tcG9uZW50OwotCi0JLyogS2VlcCB0cmFjayBvZiB0aGUgYXR0cmlidXRlIGZvciBsYXRl
ciBjbGVhbnVwICovCi0JbGlzdF9hZGQoJmNvdW50ZXJfYXR0ci0+bCwgYXR0cl9saXN0KTsKLQlw
YXJtLT5ncm91cC0+bnVtX2F0dHIrKzsKLQotCXJldHVybiAwOwotCi1lcnJfZnJlZV9jb3VudGVy
X2F0dHI6Ci0Ja2ZyZWUoY291bnRlcl9hdHRyKTsKLQlyZXR1cm4gZXJyOwotfQotCi0jZGVmaW5l
IHRvX2NvdW50ZXJfYXR0cihfZGV2X2F0dHIpIFwKLQljb250YWluZXJfb2YoX2Rldl9hdHRyLCBz
dHJ1Y3QgY291bnRlcl9kZXZpY2VfYXR0ciwgZGV2X2F0dHIpCi0KLXN0cnVjdCBjb3VudGVyX3Np
Z25hbF91bml0IHsKLQlzdHJ1Y3QgY291bnRlcl9zaWduYWwgKnNpZ25hbDsKLX07Ci0KLXN0YXRp
YyBjb25zdCBjaGFyICpjb25zdCBjb3VudGVyX3NpZ25hbF9sZXZlbF9zdHJbXSA9IHsKLQlbQ09V
TlRFUl9TSUdOQUxfTEVWRUxfTE9XXSA9ICJsb3ciLAotCVtDT1VOVEVSX1NJR05BTF9MRVZFTF9I
SUdIXSA9ICJoaWdoIgotfTsKLQotc3RhdGljIHNzaXplX3QgY291bnRlcl9zaWduYWxfc2hvdyhz
dHJ1Y3QgZGV2aWNlICpkZXYsCi0JCQkJICAgc3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIs
IGNoYXIgKmJ1ZikKLXsKLQlzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvbnN0IGNvdW50ZXIgPSBk
ZXZfZ2V0X2RydmRhdGEoZGV2KTsKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9kZXZpY2VfYXR0ciAq
Y29uc3QgZGV2YXR0ciA9IHRvX2NvdW50ZXJfYXR0cihhdHRyKTsKLQljb25zdCBzdHJ1Y3QgY291
bnRlcl9zaWduYWxfdW5pdCAqY29uc3QgY29tcG9uZW50ID0gZGV2YXR0ci0+Y29tcG9uZW50Owot
CXN0cnVjdCBjb3VudGVyX3NpZ25hbCAqY29uc3Qgc2lnbmFsID0gY29tcG9uZW50LT5zaWduYWw7
Ci0JaW50IGVycjsKLQllbnVtIGNvdW50ZXJfc2lnbmFsX2xldmVsIGxldmVsOwotCi0JZXJyID0g
Y291bnRlci0+b3BzLT5zaWduYWxfcmVhZChjb3VudGVyLCBzaWduYWwsICZsZXZlbCk7Ci0JaWYg
KGVycikKLQkJcmV0dXJuIGVycjsKLQotCXJldHVybiBzcHJpbnRmKGJ1ZiwgIiVzXG4iLCBjb3Vu
dGVyX3NpZ25hbF9sZXZlbF9zdHJbbGV2ZWxdKTsKLX0KLQotc3RydWN0IGNvdW50ZXJfbmFtZV91
bml0IHsKLQljb25zdCBjaGFyICpuYW1lOwotfTsKLQotc3RhdGljIHNzaXplX3QgY291bnRlcl9k
ZXZpY2VfYXR0cl9uYW1lX3Nob3coc3RydWN0IGRldmljZSAqZGV2LAotCQkJCQkgICAgIHN0cnVj
dCBkZXZpY2VfYXR0cmlidXRlICphdHRyLAotCQkJCQkgICAgIGNoYXIgKmJ1ZikKLXsKLQljb25z
dCBzdHJ1Y3QgY291bnRlcl9uYW1lX3VuaXQgKmNvbnN0IGNvbXAgPSB0b19jb3VudGVyX2F0dHIo
YXR0ciktPmNvbXBvbmVudDsKLQotCXJldHVybiBzcHJpbnRmKGJ1ZiwgIiVzXG4iLCBjb21wLT5u
YW1lKTsKLX0KLQotc3RhdGljIGludCBjb3VudGVyX25hbWVfYXR0cmlidXRlX2NyZWF0ZSgKLQlz
dHJ1Y3QgY291bnRlcl9kZXZpY2VfYXR0cl9ncm91cCAqY29uc3QgZ3JvdXAsCi0JY29uc3QgY2hh
ciAqY29uc3QgbmFtZSkKLXsKLQlzdHJ1Y3QgY291bnRlcl9uYW1lX3VuaXQgKm5hbWVfY29tcDsK
LQlzdHJ1Y3QgY291bnRlcl9hdHRyX3Bhcm0gcGFybTsKLQlpbnQgZXJyOwotCi0JLyogU2tpcCBp
ZiBubyBuYW1lICovCi0JaWYgKCFuYW1lKQotCQlyZXR1cm4gMDsKLQotCS8qIEFsbG9jYXRlIG5h
bWUgYXR0cmlidXRlIGNvbXBvbmVudCAqLwotCW5hbWVfY29tcCA9IGttYWxsb2Moc2l6ZW9mKCpu
YW1lX2NvbXApLCBHRlBfS0VSTkVMKTsKLQlpZiAoIW5hbWVfY29tcCkKLQkJcmV0dXJuIC1FTk9N
RU07Ci0JbmFtZV9jb21wLT5uYW1lID0gbmFtZTsKLQotCS8qIEFsbG9jYXRlIFNpZ25hbCBuYW1l
IGF0dHJpYnV0ZSAqLwotCXBhcm0uZ3JvdXAgPSBncm91cDsKLQlwYXJtLnByZWZpeCA9ICIiOwot
CXBhcm0ubmFtZSA9ICJuYW1lIjsKLQlwYXJtLnNob3cgPSBjb3VudGVyX2RldmljZV9hdHRyX25h
bWVfc2hvdzsKLQlwYXJtLnN0b3JlID0gTlVMTDsKLQlwYXJtLmNvbXBvbmVudCA9IG5hbWVfY29t
cDsKLQllcnIgPSBjb3VudGVyX2F0dHJpYnV0ZV9jcmVhdGUoJnBhcm0pOwotCWlmIChlcnIpCi0J
CWdvdG8gZXJyX2ZyZWVfbmFtZV9jb21wOwotCi0JcmV0dXJuIDA7Ci0KLWVycl9mcmVlX25hbWVf
Y29tcDoKLQlrZnJlZShuYW1lX2NvbXApOwotCXJldHVybiBlcnI7Ci19Ci0KLXN0cnVjdCBjb3Vu
dGVyX3NpZ25hbF9leHRfdW5pdCB7Ci0Jc3RydWN0IGNvdW50ZXJfc2lnbmFsICpzaWduYWw7Ci0J
Y29uc3Qgc3RydWN0IGNvdW50ZXJfc2lnbmFsX2V4dCAqZXh0OwotfTsKLQotc3RhdGljIHNzaXpl
X3QgY291bnRlcl9zaWduYWxfZXh0X3Nob3coc3RydWN0IGRldmljZSAqZGV2LAotCQkJCSAgICAg
ICBzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSAqYXR0ciwgY2hhciAqYnVmKQotewotCWNvbnN0IHN0
cnVjdCBjb3VudGVyX2RldmljZV9hdHRyICpjb25zdCBkZXZhdHRyID0gdG9fY291bnRlcl9hdHRy
KGF0dHIpOwotCWNvbnN0IHN0cnVjdCBjb3VudGVyX3NpZ25hbF9leHRfdW5pdCAqY29uc3QgY29t
cCA9IGRldmF0dHItPmNvbXBvbmVudDsKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9zaWduYWxfZXh0
ICpjb25zdCBleHQgPSBjb21wLT5leHQ7Ci0KLQlyZXR1cm4gZXh0LT5yZWFkKGRldl9nZXRfZHJ2
ZGF0YShkZXYpLCBjb21wLT5zaWduYWwsIGV4dC0+cHJpdiwgYnVmKTsKLX0KLQotc3RhdGljIHNz
aXplX3QgY291bnRlcl9zaWduYWxfZXh0X3N0b3JlKHN0cnVjdCBkZXZpY2UgKmRldiwKLQkJCQkJ
c3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIsCi0JCQkJCWNvbnN0IGNoYXIgKmJ1Ziwgc2l6
ZV90IGxlbikKLXsKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9kZXZpY2VfYXR0ciAqY29uc3QgZGV2
YXR0ciA9IHRvX2NvdW50ZXJfYXR0cihhdHRyKTsKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9zaWdu
YWxfZXh0X3VuaXQgKmNvbnN0IGNvbXAgPSBkZXZhdHRyLT5jb21wb25lbnQ7Ci0JY29uc3Qgc3Ry
dWN0IGNvdW50ZXJfc2lnbmFsX2V4dCAqY29uc3QgZXh0ID0gY29tcC0+ZXh0OwotCi0JcmV0dXJu
IGV4dC0+d3JpdGUoZGV2X2dldF9kcnZkYXRhKGRldiksIGNvbXAtPnNpZ25hbCwgZXh0LT5wcml2
LCBidWYsCi0JCWxlbik7Ci19Ci0KLXN0YXRpYyB2b2lkIGNvdW50ZXJfZGV2aWNlX2F0dHJfbGlz
dF9mcmVlKHN0cnVjdCBsaXN0X2hlYWQgKmF0dHJfbGlzdCkKLXsKLQlzdHJ1Y3QgY291bnRlcl9k
ZXZpY2VfYXR0ciAqcCwgKm47Ci0KLQlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUocCwgbiwgYXR0
cl9saXN0LCBsKSB7Ci0JCS8qIGZyZWUgYXR0cmlidXRlIG5hbWUgYW5kIGFzc29jaWF0ZWQgY29t
cG9uZW50IG1lbW9yeSAqLwotCQlrZnJlZShwLT5kZXZfYXR0ci5hdHRyLm5hbWUpOwotCQlrZnJl
ZShwLT5jb21wb25lbnQpOwotCQlsaXN0X2RlbCgmcC0+bCk7Ci0JCWtmcmVlKHApOwotCX0KLX0K
LQotc3RhdGljIGludCBjb3VudGVyX3NpZ25hbF9leHRfcmVnaXN0ZXIoCi0Jc3RydWN0IGNvdW50
ZXJfZGV2aWNlX2F0dHJfZ3JvdXAgKmNvbnN0IGdyb3VwLAotCXN0cnVjdCBjb3VudGVyX3NpZ25h
bCAqY29uc3Qgc2lnbmFsKQotewotCWNvbnN0IHNpemVfdCBudW1fZXh0ID0gc2lnbmFsLT5udW1f
ZXh0OwotCXNpemVfdCBpOwotCWNvbnN0IHN0cnVjdCBjb3VudGVyX3NpZ25hbF9leHQgKmV4dDsK
LQlzdHJ1Y3QgY291bnRlcl9zaWduYWxfZXh0X3VuaXQgKnNpZ25hbF9leHRfY29tcDsKLQlzdHJ1
Y3QgY291bnRlcl9hdHRyX3Bhcm0gcGFybTsKLQlpbnQgZXJyOwotCi0JLyogQ3JlYXRlIGFuIGF0
dHJpYnV0ZSBmb3IgZWFjaCBleHRlbnNpb24gKi8KLQlmb3IgKGkgPSAwIDsgaSA8IG51bV9leHQ7
IGkrKykgewotCQlleHQgPSBzaWduYWwtPmV4dCArIGk7Ci0KLQkJLyogQWxsb2NhdGUgc2lnbmFs
X2V4dCBhdHRyaWJ1dGUgY29tcG9uZW50ICovCi0JCXNpZ25hbF9leHRfY29tcCA9IGttYWxsb2Mo
c2l6ZW9mKCpzaWduYWxfZXh0X2NvbXApLCBHRlBfS0VSTkVMKTsKLQkJaWYgKCFzaWduYWxfZXh0
X2NvbXApIHsKLQkJCWVyciA9IC1FTk9NRU07Ci0JCQlnb3RvIGVycl9mcmVlX2F0dHJfbGlzdDsK
LQkJfQotCQlzaWduYWxfZXh0X2NvbXAtPnNpZ25hbCA9IHNpZ25hbDsKLQkJc2lnbmFsX2V4dF9j
b21wLT5leHQgPSBleHQ7Ci0KLQkJLyogQWxsb2NhdGUgYSBDb3VudGVyIGRldmljZSBhdHRyaWJ1
dGUgKi8KLQkJcGFybS5ncm91cCA9IGdyb3VwOwotCQlwYXJtLnByZWZpeCA9ICIiOwotCQlwYXJt
Lm5hbWUgPSBleHQtPm5hbWU7Ci0JCXBhcm0uc2hvdyA9IChleHQtPnJlYWQpID8gY291bnRlcl9z
aWduYWxfZXh0X3Nob3cgOiBOVUxMOwotCQlwYXJtLnN0b3JlID0gKGV4dC0+d3JpdGUpID8gY291
bnRlcl9zaWduYWxfZXh0X3N0b3JlIDogTlVMTDsKLQkJcGFybS5jb21wb25lbnQgPSBzaWduYWxf
ZXh0X2NvbXA7Ci0JCWVyciA9IGNvdW50ZXJfYXR0cmlidXRlX2NyZWF0ZSgmcGFybSk7Ci0JCWlm
IChlcnIpIHsKLQkJCWtmcmVlKHNpZ25hbF9leHRfY29tcCk7Ci0JCQlnb3RvIGVycl9mcmVlX2F0
dHJfbGlzdDsKLQkJfQotCX0KLQotCXJldHVybiAwOwotCi1lcnJfZnJlZV9hdHRyX2xpc3Q6Ci0J
Y291bnRlcl9kZXZpY2VfYXR0cl9saXN0X2ZyZWUoJmdyb3VwLT5hdHRyX2xpc3QpOwotCXJldHVy
biBlcnI7Ci19Ci0KLXN0YXRpYyBpbnQgY291bnRlcl9zaWduYWxfYXR0cmlidXRlc19jcmVhdGUo
Ci0Jc3RydWN0IGNvdW50ZXJfZGV2aWNlX2F0dHJfZ3JvdXAgKmNvbnN0IGdyb3VwLAotCWNvbnN0
IHN0cnVjdCBjb3VudGVyX2RldmljZSAqY29uc3QgY291bnRlciwKLQlzdHJ1Y3QgY291bnRlcl9z
aWduYWwgKmNvbnN0IHNpZ25hbCkKLXsKLQlzdHJ1Y3QgY291bnRlcl9zaWduYWxfdW5pdCAqc2ln
bmFsX2NvbXA7Ci0Jc3RydWN0IGNvdW50ZXJfYXR0cl9wYXJtIHBhcm07Ci0JaW50IGVycjsKLQot
CS8qIEFsbG9jYXRlIFNpZ25hbCBhdHRyaWJ1dGUgY29tcG9uZW50ICovCi0Jc2lnbmFsX2NvbXAg
PSBrbWFsbG9jKHNpemVvZigqc2lnbmFsX2NvbXApLCBHRlBfS0VSTkVMKTsKLQlpZiAoIXNpZ25h
bF9jb21wKQotCQlyZXR1cm4gLUVOT01FTTsKLQlzaWduYWxfY29tcC0+c2lnbmFsID0gc2lnbmFs
OwotCi0JLyogQ3JlYXRlIG1haW4gU2lnbmFsIGF0dHJpYnV0ZSAqLwotCXBhcm0uZ3JvdXAgPSBn
cm91cDsKLQlwYXJtLnByZWZpeCA9ICIiOwotCXBhcm0ubmFtZSA9ICJzaWduYWwiOwotCXBhcm0u
c2hvdyA9IChjb3VudGVyLT5vcHMtPnNpZ25hbF9yZWFkKSA/IGNvdW50ZXJfc2lnbmFsX3Nob3cg
OiBOVUxMOwotCXBhcm0uc3RvcmUgPSBOVUxMOwotCXBhcm0uY29tcG9uZW50ID0gc2lnbmFsX2Nv
bXA7Ci0JZXJyID0gY291bnRlcl9hdHRyaWJ1dGVfY3JlYXRlKCZwYXJtKTsKLQlpZiAoZXJyKSB7
Ci0JCWtmcmVlKHNpZ25hbF9jb21wKTsKLQkJcmV0dXJuIGVycjsKLQl9Ci0KLQkvKiBDcmVhdGUg
U2lnbmFsIG5hbWUgYXR0cmlidXRlICovCi0JZXJyID0gY291bnRlcl9uYW1lX2F0dHJpYnV0ZV9j
cmVhdGUoZ3JvdXAsIHNpZ25hbC0+bmFtZSk7Ci0JaWYgKGVycikKLQkJZ290byBlcnJfZnJlZV9h
dHRyX2xpc3Q7Ci0KLQkvKiBSZWdpc3RlciBTaWduYWwgZXh0ZW5zaW9uIGF0dHJpYnV0ZXMgKi8K
LQllcnIgPSBjb3VudGVyX3NpZ25hbF9leHRfcmVnaXN0ZXIoZ3JvdXAsIHNpZ25hbCk7Ci0JaWYg
KGVycikKLQkJZ290byBlcnJfZnJlZV9hdHRyX2xpc3Q7Ci0KLQlyZXR1cm4gMDsKLQotZXJyX2Zy
ZWVfYXR0cl9saXN0OgotCWNvdW50ZXJfZGV2aWNlX2F0dHJfbGlzdF9mcmVlKCZncm91cC0+YXR0
cl9saXN0KTsKLQlyZXR1cm4gZXJyOwotfQotCi1zdGF0aWMgaW50IGNvdW50ZXJfc2lnbmFsc19y
ZWdpc3RlcigKLQlzdHJ1Y3QgY291bnRlcl9kZXZpY2VfYXR0cl9ncm91cCAqY29uc3QgZ3JvdXBz
X2xpc3QsCi0JY29uc3Qgc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb25zdCBjb3VudGVyKQotewot
CWNvbnN0IHNpemVfdCBudW1fc2lnbmFscyA9IGNvdW50ZXItPm51bV9zaWduYWxzOwotCXNpemVf
dCBpOwotCXN0cnVjdCBjb3VudGVyX3NpZ25hbCAqc2lnbmFsOwotCWNvbnN0IGNoYXIgKm5hbWU7
Ci0JaW50IGVycjsKLQotCS8qIFJlZ2lzdGVyIGVhY2ggU2lnbmFsICovCi0JZm9yIChpID0gMDsg
aSA8IG51bV9zaWduYWxzOyBpKyspIHsKLQkJc2lnbmFsID0gY291bnRlci0+c2lnbmFscyArIGk7
Ci0KLQkJLyogR2VuZXJhdGUgU2lnbmFsIGF0dHJpYnV0ZSBkaXJlY3RvcnkgbmFtZSAqLwotCQlu
YW1lID0ga2FzcHJpbnRmKEdGUF9LRVJORUwsICJzaWduYWwlZCIsIHNpZ25hbC0+aWQpOwotCQlp
ZiAoIW5hbWUpIHsKLQkJCWVyciA9IC1FTk9NRU07Ci0JCQlnb3RvIGVycl9mcmVlX2F0dHJfZ3Jv
dXBzOwotCQl9Ci0JCWdyb3Vwc19saXN0W2ldLmF0dHJfZ3JvdXAubmFtZSA9IG5hbWU7Ci0KLQkJ
LyogQ3JlYXRlIGFsbCBhdHRyaWJ1dGVzIGFzc29jaWF0ZWQgd2l0aCBTaWduYWwgKi8KLQkJZXJy
ID0gY291bnRlcl9zaWduYWxfYXR0cmlidXRlc19jcmVhdGUoZ3JvdXBzX2xpc3QgKyBpLCBjb3Vu
dGVyLAotCQkJCQkJICAgICAgIHNpZ25hbCk7Ci0JCWlmIChlcnIpCi0JCQlnb3RvIGVycl9mcmVl
X2F0dHJfZ3JvdXBzOwotCX0KLQotCXJldHVybiAwOwotCi1lcnJfZnJlZV9hdHRyX2dyb3VwczoK
LQlkbyB7Ci0JCWtmcmVlKGdyb3Vwc19saXN0W2ldLmF0dHJfZ3JvdXAubmFtZSk7Ci0JCWNvdW50
ZXJfZGV2aWNlX2F0dHJfbGlzdF9mcmVlKCZncm91cHNfbGlzdFtpXS5hdHRyX2xpc3QpOwotCX0g
d2hpbGUgKGktLSk7Ci0JcmV0dXJuIGVycjsKLX0KLQotc3RhdGljIGNvbnN0IGNoYXIgKmNvbnN0
IGNvdW50ZXJfc3luYXBzZV9hY3Rpb25fc3RyW10gPSB7Ci0JW0NPVU5URVJfU1lOQVBTRV9BQ1RJ
T05fTk9ORV0gPSAibm9uZSIsCi0JW0NPVU5URVJfU1lOQVBTRV9BQ1RJT05fUklTSU5HX0VER0Vd
ID0gInJpc2luZyBlZGdlIiwKLQlbQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9GQUxMSU5HX0VER0Vd
ID0gImZhbGxpbmcgZWRnZSIsCi0JW0NPVU5URVJfU1lOQVBTRV9BQ1RJT05fQk9USF9FREdFU10g
PSAiYm90aCBlZGdlcyIKLX07Ci0KLXN0cnVjdCBjb3VudGVyX2FjdGlvbl91bml0IHsKLQlzdHJ1
Y3QgY291bnRlcl9zeW5hcHNlICpzeW5hcHNlOwotCXN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3Vu
dDsKLX07Ci0KLXN0YXRpYyBzc2l6ZV90IGNvdW50ZXJfYWN0aW9uX3Nob3coc3RydWN0IGRldmlj
ZSAqZGV2LAotCQkJCSAgIHN0cnVjdCBkZXZpY2VfYXR0cmlidXRlICphdHRyLCBjaGFyICpidWYp
Ci17Ci0JY29uc3Qgc3RydWN0IGNvdW50ZXJfZGV2aWNlX2F0dHIgKmNvbnN0IGRldmF0dHIgPSB0
b19jb3VudGVyX2F0dHIoYXR0cik7Ci0JaW50IGVycjsKLQlzdHJ1Y3QgY291bnRlcl9kZXZpY2Ug
KmNvbnN0IGNvdW50ZXIgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsKLQljb25zdCBzdHJ1Y3QgY291
bnRlcl9hY3Rpb25fdW5pdCAqY29uc3QgY29tcG9uZW50ID0gZGV2YXR0ci0+Y29tcG9uZW50Owot
CXN0cnVjdCBjb3VudGVyX2NvdW50ICpjb25zdCBjb3VudCA9IGNvbXBvbmVudC0+Y291bnQ7Ci0J
c3RydWN0IGNvdW50ZXJfc3luYXBzZSAqY29uc3Qgc3luYXBzZSA9IGNvbXBvbmVudC0+c3luYXBz
ZTsKLQlzaXplX3QgYWN0aW9uX2luZGV4OwotCWVudW0gY291bnRlcl9zeW5hcHNlX2FjdGlvbiBh
Y3Rpb247Ci0KLQllcnIgPSBjb3VudGVyLT5vcHMtPmFjdGlvbl9nZXQoY291bnRlciwgY291bnQs
IHN5bmFwc2UsICZhY3Rpb25faW5kZXgpOwotCWlmIChlcnIpCi0JCXJldHVybiBlcnI7Ci0KLQlz
eW5hcHNlLT5hY3Rpb24gPSBhY3Rpb25faW5kZXg7Ci0KLQlhY3Rpb24gPSBzeW5hcHNlLT5hY3Rp
b25zX2xpc3RbYWN0aW9uX2luZGV4XTsKLQlyZXR1cm4gc3ByaW50ZihidWYsICIlc1xuIiwgY291
bnRlcl9zeW5hcHNlX2FjdGlvbl9zdHJbYWN0aW9uXSk7Ci19Ci0KLXN0YXRpYyBzc2l6ZV90IGNv
dW50ZXJfYWN0aW9uX3N0b3JlKHN0cnVjdCBkZXZpY2UgKmRldiwKLQkJCQkgICAgc3RydWN0IGRl
dmljZV9hdHRyaWJ1dGUgKmF0dHIsCi0JCQkJICAgIGNvbnN0IGNoYXIgKmJ1Ziwgc2l6ZV90IGxl
bikKLXsKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9kZXZpY2VfYXR0ciAqY29uc3QgZGV2YXR0ciA9
IHRvX2NvdW50ZXJfYXR0cihhdHRyKTsKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9hY3Rpb25fdW5p
dCAqY29uc3QgY29tcG9uZW50ID0gZGV2YXR0ci0+Y29tcG9uZW50OwotCXN0cnVjdCBjb3VudGVy
X3N5bmFwc2UgKmNvbnN0IHN5bmFwc2UgPSBjb21wb25lbnQtPnN5bmFwc2U7Ci0Jc2l6ZV90IGFj
dGlvbl9pbmRleDsKLQljb25zdCBzaXplX3QgbnVtX2FjdGlvbnMgPSBzeW5hcHNlLT5udW1fYWN0
aW9uczsKLQllbnVtIGNvdW50ZXJfc3luYXBzZV9hY3Rpb24gYWN0aW9uOwotCWludCBlcnI7Ci0J
c3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb25zdCBjb3VudGVyID0gZGV2X2dldF9kcnZkYXRhKGRl
dik7Ci0Jc3RydWN0IGNvdW50ZXJfY291bnQgKmNvbnN0IGNvdW50ID0gY29tcG9uZW50LT5jb3Vu
dDsKLQotCS8qIEZpbmQgcmVxdWVzdGVkIGFjdGlvbiBtb2RlICovCi0JZm9yIChhY3Rpb25faW5k
ZXggPSAwOyBhY3Rpb25faW5kZXggPCBudW1fYWN0aW9uczsgYWN0aW9uX2luZGV4KyspIHsKLQkJ
YWN0aW9uID0gc3luYXBzZS0+YWN0aW9uc19saXN0W2FjdGlvbl9pbmRleF07Ci0JCWlmIChzeXNm
c19zdHJlcShidWYsIGNvdW50ZXJfc3luYXBzZV9hY3Rpb25fc3RyW2FjdGlvbl0pKQotCQkJYnJl
YWs7Ci0JfQotCS8qIElmIHJlcXVlc3RlZCBhY3Rpb24gbW9kZSBub3QgZm91bmQgKi8KLQlpZiAo
YWN0aW9uX2luZGV4ID49IG51bV9hY3Rpb25zKQotCQlyZXR1cm4gLUVJTlZBTDsKLQotCWVyciA9
IGNvdW50ZXItPm9wcy0+YWN0aW9uX3NldChjb3VudGVyLCBjb3VudCwgc3luYXBzZSwgYWN0aW9u
X2luZGV4KTsKLQlpZiAoZXJyKQotCQlyZXR1cm4gZXJyOwotCi0Jc3luYXBzZS0+YWN0aW9uID0g
YWN0aW9uX2luZGV4OwotCi0JcmV0dXJuIGxlbjsKLX0KLQotc3RydWN0IGNvdW50ZXJfYWN0aW9u
X2F2YWlsX3VuaXQgewotCWNvbnN0IGVudW0gY291bnRlcl9zeW5hcHNlX2FjdGlvbiAqYWN0aW9u
c19saXN0OwotCXNpemVfdCBudW1fYWN0aW9uczsKLX07Ci0KLXN0YXRpYyBzc2l6ZV90IGNvdW50
ZXJfc3luYXBzZV9hY3Rpb25fYXZhaWxhYmxlX3Nob3coc3RydWN0IGRldmljZSAqZGV2LAotCXN0
cnVjdCBkZXZpY2VfYXR0cmlidXRlICphdHRyLCBjaGFyICpidWYpCi17Ci0JY29uc3Qgc3RydWN0
IGNvdW50ZXJfZGV2aWNlX2F0dHIgKmNvbnN0IGRldmF0dHIgPSB0b19jb3VudGVyX2F0dHIoYXR0
cik7Ci0JY29uc3Qgc3RydWN0IGNvdW50ZXJfYWN0aW9uX2F2YWlsX3VuaXQgKmNvbnN0IGNvbXBv
bmVudCA9IGRldmF0dHItPmNvbXBvbmVudDsKLQlzaXplX3QgaTsKLQllbnVtIGNvdW50ZXJfc3lu
YXBzZV9hY3Rpb24gYWN0aW9uOwotCXNzaXplX3QgbGVuID0gMDsKLQotCWZvciAoaSA9IDA7IGkg
PCBjb21wb25lbnQtPm51bV9hY3Rpb25zOyBpKyspIHsKLQkJYWN0aW9uID0gY29tcG9uZW50LT5h
Y3Rpb25zX2xpc3RbaV07Ci0JCWxlbiArPSBzcHJpbnRmKGJ1ZiArIGxlbiwgIiVzXG4iLAotCQkJ
ICAgICAgIGNvdW50ZXJfc3luYXBzZV9hY3Rpb25fc3RyW2FjdGlvbl0pOwotCX0KLQotCXJldHVy
biBsZW47Ci19Ci0KLXN0YXRpYyBpbnQgY291bnRlcl9zeW5hcHNlc19yZWdpc3RlcigKLQlzdHJ1
Y3QgY291bnRlcl9kZXZpY2VfYXR0cl9ncm91cCAqY29uc3QgZ3JvdXAsCi0JY29uc3Qgc3RydWN0
IGNvdW50ZXJfZGV2aWNlICpjb25zdCBjb3VudGVyLAotCXN0cnVjdCBjb3VudGVyX2NvdW50ICpj
b25zdCBjb3VudCwgY29uc3QgY2hhciAqY29uc3QgY291bnRfYXR0cl9uYW1lKQotewotCXNpemVf
dCBpOwotCXN0cnVjdCBjb3VudGVyX3N5bmFwc2UgKnN5bmFwc2U7Ci0JY29uc3QgY2hhciAqcHJl
Zml4OwotCXN0cnVjdCBjb3VudGVyX2FjdGlvbl91bml0ICphY3Rpb25fY29tcDsKLQlzdHJ1Y3Qg
Y291bnRlcl9hdHRyX3Bhcm0gcGFybTsKLQlpbnQgZXJyOwotCXN0cnVjdCBjb3VudGVyX2FjdGlv
bl9hdmFpbF91bml0ICphdmFpbF9jb21wOwotCi0JLyogUmVnaXN0ZXIgZWFjaCBTeW5hcHNlICov
Ci0JZm9yIChpID0gMDsgaSA8IGNvdW50LT5udW1fc3luYXBzZXM7IGkrKykgewotCQlzeW5hcHNl
ID0gY291bnQtPnN5bmFwc2VzICsgaTsKLQotCQkvKiBHZW5lcmF0ZSBhdHRyaWJ1dGUgcHJlZml4
ICovCi0JCXByZWZpeCA9IGthc3ByaW50ZihHRlBfS0VSTkVMLCAic2lnbmFsJWRfIiwKLQkJCQkg
ICBzeW5hcHNlLT5zaWduYWwtPmlkKTsKLQkJaWYgKCFwcmVmaXgpIHsKLQkJCWVyciA9IC1FTk9N
RU07Ci0JCQlnb3RvIGVycl9mcmVlX2F0dHJfbGlzdDsKLQkJfQotCi0JCS8qIEFsbG9jYXRlIGFj
dGlvbiBhdHRyaWJ1dGUgY29tcG9uZW50ICovCi0JCWFjdGlvbl9jb21wID0ga21hbGxvYyhzaXpl
b2YoKmFjdGlvbl9jb21wKSwgR0ZQX0tFUk5FTCk7Ci0JCWlmICghYWN0aW9uX2NvbXApIHsKLQkJ
CWVyciA9IC1FTk9NRU07Ci0JCQlnb3RvIGVycl9mcmVlX3ByZWZpeDsKLQkJfQotCQlhY3Rpb25f
Y29tcC0+c3luYXBzZSA9IHN5bmFwc2U7Ci0JCWFjdGlvbl9jb21wLT5jb3VudCA9IGNvdW50Owot
Ci0JCS8qIENyZWF0ZSBhY3Rpb24gYXR0cmlidXRlICovCi0JCXBhcm0uZ3JvdXAgPSBncm91cDsK
LQkJcGFybS5wcmVmaXggPSBwcmVmaXg7Ci0JCXBhcm0ubmFtZSA9ICJhY3Rpb24iOwotCQlwYXJt
LnNob3cgPSAoY291bnRlci0+b3BzLT5hY3Rpb25fZ2V0KSA/IGNvdW50ZXJfYWN0aW9uX3Nob3cg
OiBOVUxMOwotCQlwYXJtLnN0b3JlID0gKGNvdW50ZXItPm9wcy0+YWN0aW9uX3NldCkgPyBjb3Vu
dGVyX2FjdGlvbl9zdG9yZSA6IE5VTEw7Ci0JCXBhcm0uY29tcG9uZW50ID0gYWN0aW9uX2NvbXA7
Ci0JCWVyciA9IGNvdW50ZXJfYXR0cmlidXRlX2NyZWF0ZSgmcGFybSk7Ci0JCWlmIChlcnIpIHsK
LQkJCWtmcmVlKGFjdGlvbl9jb21wKTsKLQkJCWdvdG8gZXJyX2ZyZWVfcHJlZml4OwotCQl9Ci0K
LQkJLyogQWxsb2NhdGUgYWN0aW9uIGF2YWlsYWJsZSBhdHRyaWJ1dGUgY29tcG9uZW50ICovCi0J
CWF2YWlsX2NvbXAgPSBrbWFsbG9jKHNpemVvZigqYXZhaWxfY29tcCksIEdGUF9LRVJORUwpOwot
CQlpZiAoIWF2YWlsX2NvbXApIHsKLQkJCWVyciA9IC1FTk9NRU07Ci0JCQlnb3RvIGVycl9mcmVl
X3ByZWZpeDsKLQkJfQotCQlhdmFpbF9jb21wLT5hY3Rpb25zX2xpc3QgPSBzeW5hcHNlLT5hY3Rp
b25zX2xpc3Q7Ci0JCWF2YWlsX2NvbXAtPm51bV9hY3Rpb25zID0gc3luYXBzZS0+bnVtX2FjdGlv
bnM7Ci0KLQkJLyogQ3JlYXRlIGFjdGlvbl9hdmFpbGFibGUgYXR0cmlidXRlICovCi0JCXBhcm0u
Z3JvdXAgPSBncm91cDsKLQkJcGFybS5wcmVmaXggPSBwcmVmaXg7Ci0JCXBhcm0ubmFtZSA9ICJh
Y3Rpb25fYXZhaWxhYmxlIjsKLQkJcGFybS5zaG93ID0gY291bnRlcl9zeW5hcHNlX2FjdGlvbl9h
dmFpbGFibGVfc2hvdzsKLQkJcGFybS5zdG9yZSA9IE5VTEw7Ci0JCXBhcm0uY29tcG9uZW50ID0g
YXZhaWxfY29tcDsKLQkJZXJyID0gY291bnRlcl9hdHRyaWJ1dGVfY3JlYXRlKCZwYXJtKTsKLQkJ
aWYgKGVycikgewotCQkJa2ZyZWUoYXZhaWxfY29tcCk7Ci0JCQlnb3RvIGVycl9mcmVlX3ByZWZp
eDsKLQkJfQotCi0JCWtmcmVlKHByZWZpeCk7Ci0JfQotCi0JcmV0dXJuIDA7Ci0KLWVycl9mcmVl
X3ByZWZpeDoKLQlrZnJlZShwcmVmaXgpOwotZXJyX2ZyZWVfYXR0cl9saXN0OgotCWNvdW50ZXJf
ZGV2aWNlX2F0dHJfbGlzdF9mcmVlKCZncm91cC0+YXR0cl9saXN0KTsKLQlyZXR1cm4gZXJyOwot
fQotCi1zdHJ1Y3QgY291bnRlcl9jb3VudF91bml0IHsKLQlzdHJ1Y3QgY291bnRlcl9jb3VudCAq
Y291bnQ7Ci19OwotCi1zdGF0aWMgc3NpemVfdCBjb3VudGVyX2NvdW50X3Nob3coc3RydWN0IGRl
dmljZSAqZGV2LAotCQkJCSAgc3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIsCi0JCQkJICBj
aGFyICpidWYpCi17Ci0Jc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb25zdCBjb3VudGVyID0gZGV2
X2dldF9kcnZkYXRhKGRldik7Ci0JY29uc3Qgc3RydWN0IGNvdW50ZXJfZGV2aWNlX2F0dHIgKmNv
bnN0IGRldmF0dHIgPSB0b19jb3VudGVyX2F0dHIoYXR0cik7Ci0JY29uc3Qgc3RydWN0IGNvdW50
ZXJfY291bnRfdW5pdCAqY29uc3QgY29tcG9uZW50ID0gZGV2YXR0ci0+Y29tcG9uZW50OwotCXN0
cnVjdCBjb3VudGVyX2NvdW50ICpjb25zdCBjb3VudCA9IGNvbXBvbmVudC0+Y291bnQ7Ci0JaW50
IGVycjsKLQl1bnNpZ25lZCBsb25nIHZhbDsKLQotCWVyciA9IGNvdW50ZXItPm9wcy0+Y291bnRf
cmVhZChjb3VudGVyLCBjb3VudCwgJnZhbCk7Ci0JaWYgKGVycikKLQkJcmV0dXJuIGVycjsKLQot
CXJldHVybiBzcHJpbnRmKGJ1ZiwgIiVsdVxuIiwgdmFsKTsKLX0KLQotc3RhdGljIHNzaXplX3Qg
Y291bnRlcl9jb3VudF9zdG9yZShzdHJ1Y3QgZGV2aWNlICpkZXYsCi0JCQkJICAgc3RydWN0IGRl
dmljZV9hdHRyaWJ1dGUgKmF0dHIsCi0JCQkJICAgY29uc3QgY2hhciAqYnVmLCBzaXplX3QgbGVu
KQotewotCXN0cnVjdCBjb3VudGVyX2RldmljZSAqY29uc3QgY291bnRlciA9IGRldl9nZXRfZHJ2
ZGF0YShkZXYpOwotCWNvbnN0IHN0cnVjdCBjb3VudGVyX2RldmljZV9hdHRyICpjb25zdCBkZXZh
dHRyID0gdG9fY291bnRlcl9hdHRyKGF0dHIpOwotCWNvbnN0IHN0cnVjdCBjb3VudGVyX2NvdW50
X3VuaXQgKmNvbnN0IGNvbXBvbmVudCA9IGRldmF0dHItPmNvbXBvbmVudDsKLQlzdHJ1Y3QgY291
bnRlcl9jb3VudCAqY29uc3QgY291bnQgPSBjb21wb25lbnQtPmNvdW50OwotCWludCBlcnI7Ci0J
dW5zaWduZWQgbG9uZyB2YWw7Ci0KLQllcnIgPSBrc3RydG91bChidWYsIDAsICZ2YWwpOwotCWlm
IChlcnIpCi0JCXJldHVybiBlcnI7Ci0KLQllcnIgPSBjb3VudGVyLT5vcHMtPmNvdW50X3dyaXRl
KGNvdW50ZXIsIGNvdW50LCB2YWwpOwotCWlmIChlcnIpCi0JCXJldHVybiBlcnI7Ci0KLQlyZXR1
cm4gbGVuOwotfQotCi1zdGF0aWMgY29uc3QgY2hhciAqY29uc3QgY291bnRlcl9mdW5jdGlvbl9z
dHJbXSA9IHsKLQlbQ09VTlRFUl9GVU5DVElPTl9JTkNSRUFTRV0gPSAiaW5jcmVhc2UiLAotCVtD
T1VOVEVSX0ZVTkNUSU9OX0RFQ1JFQVNFXSA9ICJkZWNyZWFzZSIsCi0JW0NPVU5URVJfRlVOQ1RJ
T05fUFVMU0VfRElSRUNUSU9OXSA9ICJwdWxzZS1kaXJlY3Rpb24iLAotCVtDT1VOVEVSX0ZVTkNU
SU9OX1FVQURSQVRVUkVfWDFfQV0gPSAicXVhZHJhdHVyZSB4MSBhIiwKLQlbQ09VTlRFUl9GVU5D
VElPTl9RVUFEUkFUVVJFX1gxX0JdID0gInF1YWRyYXR1cmUgeDEgYiIsCi0JW0NPVU5URVJfRlVO
Q1RJT05fUVVBRFJBVFVSRV9YMl9BXSA9ICJxdWFkcmF0dXJlIHgyIGEiLAotCVtDT1VOVEVSX0ZV
TkNUSU9OX1FVQURSQVRVUkVfWDJfQl0gPSAicXVhZHJhdHVyZSB4MiBiIiwKLQlbQ09VTlRFUl9G
VU5DVElPTl9RVUFEUkFUVVJFX1g0XSA9ICJxdWFkcmF0dXJlIHg0IgotfTsKLQotc3RhdGljIHNz
aXplX3QgY291bnRlcl9mdW5jdGlvbl9zaG93KHN0cnVjdCBkZXZpY2UgKmRldiwKLQkJCQkgICAg
IHN0cnVjdCBkZXZpY2VfYXR0cmlidXRlICphdHRyLCBjaGFyICpidWYpCi17Ci0JaW50IGVycjsK
LQlzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvbnN0IGNvdW50ZXIgPSBkZXZfZ2V0X2RydmRhdGEo
ZGV2KTsKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9kZXZpY2VfYXR0ciAqY29uc3QgZGV2YXR0ciA9
IHRvX2NvdW50ZXJfYXR0cihhdHRyKTsKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9jb3VudF91bml0
ICpjb25zdCBjb21wb25lbnQgPSBkZXZhdHRyLT5jb21wb25lbnQ7Ci0Jc3RydWN0IGNvdW50ZXJf
Y291bnQgKmNvbnN0IGNvdW50ID0gY29tcG9uZW50LT5jb3VudDsKLQlzaXplX3QgZnVuY19pbmRl
eDsKLQllbnVtIGNvdW50ZXJfZnVuY3Rpb24gZnVuY3Rpb247Ci0KLQllcnIgPSBjb3VudGVyLT5v
cHMtPmZ1bmN0aW9uX2dldChjb3VudGVyLCBjb3VudCwgJmZ1bmNfaW5kZXgpOwotCWlmIChlcnIp
Ci0JCXJldHVybiBlcnI7Ci0KLQljb3VudC0+ZnVuY3Rpb24gPSBmdW5jX2luZGV4OwotCi0JZnVu
Y3Rpb24gPSBjb3VudC0+ZnVuY3Rpb25zX2xpc3RbZnVuY19pbmRleF07Ci0JcmV0dXJuIHNwcmlu
dGYoYnVmLCAiJXNcbiIsIGNvdW50ZXJfZnVuY3Rpb25fc3RyW2Z1bmN0aW9uXSk7Ci19Ci0KLXN0
YXRpYyBzc2l6ZV90IGNvdW50ZXJfZnVuY3Rpb25fc3RvcmUoc3RydWN0IGRldmljZSAqZGV2LAot
CQkJCSAgICAgIHN0cnVjdCBkZXZpY2VfYXR0cmlidXRlICphdHRyLAotCQkJCSAgICAgIGNvbnN0
IGNoYXIgKmJ1Ziwgc2l6ZV90IGxlbikKLXsKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9kZXZpY2Vf
YXR0ciAqY29uc3QgZGV2YXR0ciA9IHRvX2NvdW50ZXJfYXR0cihhdHRyKTsKLQljb25zdCBzdHJ1
Y3QgY291bnRlcl9jb3VudF91bml0ICpjb25zdCBjb21wb25lbnQgPSBkZXZhdHRyLT5jb21wb25l
bnQ7Ci0Jc3RydWN0IGNvdW50ZXJfY291bnQgKmNvbnN0IGNvdW50ID0gY29tcG9uZW50LT5jb3Vu
dDsKLQljb25zdCBzaXplX3QgbnVtX2Z1bmN0aW9ucyA9IGNvdW50LT5udW1fZnVuY3Rpb25zOwot
CXNpemVfdCBmdW5jX2luZGV4OwotCWVudW0gY291bnRlcl9mdW5jdGlvbiBmdW5jdGlvbjsKLQlp
bnQgZXJyOwotCXN0cnVjdCBjb3VudGVyX2RldmljZSAqY29uc3QgY291bnRlciA9IGRldl9nZXRf
ZHJ2ZGF0YShkZXYpOwotCi0JLyogRmluZCByZXF1ZXN0ZWQgQ291bnQgZnVuY3Rpb24gbW9kZSAq
LwotCWZvciAoZnVuY19pbmRleCA9IDA7IGZ1bmNfaW5kZXggPCBudW1fZnVuY3Rpb25zOyBmdW5j
X2luZGV4KyspIHsKLQkJZnVuY3Rpb24gPSBjb3VudC0+ZnVuY3Rpb25zX2xpc3RbZnVuY19pbmRl
eF07Ci0JCWlmIChzeXNmc19zdHJlcShidWYsIGNvdW50ZXJfZnVuY3Rpb25fc3RyW2Z1bmN0aW9u
XSkpCi0JCQlicmVhazsKLQl9Ci0JLyogUmV0dXJuIGVycm9yIGlmIHJlcXVlc3RlZCBDb3VudCBm
dW5jdGlvbiBtb2RlIG5vdCBmb3VuZCAqLwotCWlmIChmdW5jX2luZGV4ID49IG51bV9mdW5jdGlv
bnMpCi0JCXJldHVybiAtRUlOVkFMOwotCi0JZXJyID0gY291bnRlci0+b3BzLT5mdW5jdGlvbl9z
ZXQoY291bnRlciwgY291bnQsIGZ1bmNfaW5kZXgpOwotCWlmIChlcnIpCi0JCXJldHVybiBlcnI7
Ci0KLQljb3VudC0+ZnVuY3Rpb24gPSBmdW5jX2luZGV4OwotCi0JcmV0dXJuIGxlbjsKLX0KLQot
c3RydWN0IGNvdW50ZXJfY291bnRfZXh0X3VuaXQgewotCXN0cnVjdCBjb3VudGVyX2NvdW50ICpj
b3VudDsKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9jb3VudF9leHQgKmV4dDsKLX07Ci0KLXN0YXRp
YyBzc2l6ZV90IGNvdW50ZXJfY291bnRfZXh0X3Nob3coc3RydWN0IGRldmljZSAqZGV2LAotCQkJ
CSAgICAgIHN0cnVjdCBkZXZpY2VfYXR0cmlidXRlICphdHRyLCBjaGFyICpidWYpCi17Ci0JY29u
c3Qgc3RydWN0IGNvdW50ZXJfZGV2aWNlX2F0dHIgKmNvbnN0IGRldmF0dHIgPSB0b19jb3VudGVy
X2F0dHIoYXR0cik7Ci0JY29uc3Qgc3RydWN0IGNvdW50ZXJfY291bnRfZXh0X3VuaXQgKmNvbnN0
IGNvbXAgPSBkZXZhdHRyLT5jb21wb25lbnQ7Ci0JY29uc3Qgc3RydWN0IGNvdW50ZXJfY291bnRf
ZXh0ICpjb25zdCBleHQgPSBjb21wLT5leHQ7Ci0KLQlyZXR1cm4gZXh0LT5yZWFkKGRldl9nZXRf
ZHJ2ZGF0YShkZXYpLCBjb21wLT5jb3VudCwgZXh0LT5wcml2LCBidWYpOwotfQotCi1zdGF0aWMg
c3NpemVfdCBjb3VudGVyX2NvdW50X2V4dF9zdG9yZShzdHJ1Y3QgZGV2aWNlICpkZXYsCi0JCQkJ
ICAgICAgIHN0cnVjdCBkZXZpY2VfYXR0cmlidXRlICphdHRyLAotCQkJCSAgICAgICBjb25zdCBj
aGFyICpidWYsIHNpemVfdCBsZW4pCi17Ci0JY29uc3Qgc3RydWN0IGNvdW50ZXJfZGV2aWNlX2F0
dHIgKmNvbnN0IGRldmF0dHIgPSB0b19jb3VudGVyX2F0dHIoYXR0cik7Ci0JY29uc3Qgc3RydWN0
IGNvdW50ZXJfY291bnRfZXh0X3VuaXQgKmNvbnN0IGNvbXAgPSBkZXZhdHRyLT5jb21wb25lbnQ7
Ci0JY29uc3Qgc3RydWN0IGNvdW50ZXJfY291bnRfZXh0ICpjb25zdCBleHQgPSBjb21wLT5leHQ7
Ci0KLQlyZXR1cm4gZXh0LT53cml0ZShkZXZfZ2V0X2RydmRhdGEoZGV2KSwgY29tcC0+Y291bnQs
IGV4dC0+cHJpdiwgYnVmLAotCQlsZW4pOwotfQotCi1zdGF0aWMgaW50IGNvdW50ZXJfY291bnRf
ZXh0X3JlZ2lzdGVyKAotCXN0cnVjdCBjb3VudGVyX2RldmljZV9hdHRyX2dyb3VwICpjb25zdCBn
cm91cCwKLQlzdHJ1Y3QgY291bnRlcl9jb3VudCAqY29uc3QgY291bnQpCi17Ci0Jc2l6ZV90IGk7
Ci0JY29uc3Qgc3RydWN0IGNvdW50ZXJfY291bnRfZXh0ICpleHQ7Ci0Jc3RydWN0IGNvdW50ZXJf
Y291bnRfZXh0X3VuaXQgKmNvdW50X2V4dF9jb21wOwotCXN0cnVjdCBjb3VudGVyX2F0dHJfcGFy
bSBwYXJtOwotCWludCBlcnI7Ci0KLQkvKiBDcmVhdGUgYW4gYXR0cmlidXRlIGZvciBlYWNoIGV4
dGVuc2lvbiAqLwotCWZvciAoaSA9IDAgOyBpIDwgY291bnQtPm51bV9leHQ7IGkrKykgewotCQll
eHQgPSBjb3VudC0+ZXh0ICsgaTsKLQotCQkvKiBBbGxvY2F0ZSBjb3VudF9leHQgYXR0cmlidXRl
IGNvbXBvbmVudCAqLwotCQljb3VudF9leHRfY29tcCA9IGttYWxsb2Moc2l6ZW9mKCpjb3VudF9l
eHRfY29tcCksIEdGUF9LRVJORUwpOwotCQlpZiAoIWNvdW50X2V4dF9jb21wKSB7Ci0JCQllcnIg
PSAtRU5PTUVNOwotCQkJZ290byBlcnJfZnJlZV9hdHRyX2xpc3Q7Ci0JCX0KLQkJY291bnRfZXh0
X2NvbXAtPmNvdW50ID0gY291bnQ7Ci0JCWNvdW50X2V4dF9jb21wLT5leHQgPSBleHQ7Ci0KLQkJ
LyogQWxsb2NhdGUgY291bnRfZXh0IGF0dHJpYnV0ZSAqLwotCQlwYXJtLmdyb3VwID0gZ3JvdXA7
Ci0JCXBhcm0ucHJlZml4ID0gIiI7Ci0JCXBhcm0ubmFtZSA9IGV4dC0+bmFtZTsKLQkJcGFybS5z
aG93ID0gKGV4dC0+cmVhZCkgPyBjb3VudGVyX2NvdW50X2V4dF9zaG93IDogTlVMTDsKLQkJcGFy
bS5zdG9yZSA9IChleHQtPndyaXRlKSA/IGNvdW50ZXJfY291bnRfZXh0X3N0b3JlIDogTlVMTDsK
LQkJcGFybS5jb21wb25lbnQgPSBjb3VudF9leHRfY29tcDsKLQkJZXJyID0gY291bnRlcl9hdHRy
aWJ1dGVfY3JlYXRlKCZwYXJtKTsKLQkJaWYgKGVycikgewotCQkJa2ZyZWUoY291bnRfZXh0X2Nv
bXApOwotCQkJZ290byBlcnJfZnJlZV9hdHRyX2xpc3Q7Ci0JCX0KLQl9Ci0KLQlyZXR1cm4gMDsK
LQotZXJyX2ZyZWVfYXR0cl9saXN0OgotCWNvdW50ZXJfZGV2aWNlX2F0dHJfbGlzdF9mcmVlKCZn
cm91cC0+YXR0cl9saXN0KTsKLQlyZXR1cm4gZXJyOwotfQotCi1zdHJ1Y3QgY291bnRlcl9mdW5j
X2F2YWlsX3VuaXQgewotCWNvbnN0IGVudW0gY291bnRlcl9mdW5jdGlvbiAqZnVuY3Rpb25zX2xp
c3Q7Ci0Jc2l6ZV90IG51bV9mdW5jdGlvbnM7Ci19OwotCi1zdGF0aWMgc3NpemVfdCBjb3VudGVy
X2Z1bmN0aW9uX2F2YWlsYWJsZV9zaG93KHN0cnVjdCBkZXZpY2UgKmRldiwKLQlzdHJ1Y3QgZGV2
aWNlX2F0dHJpYnV0ZSAqYXR0ciwgY2hhciAqYnVmKQotewotCWNvbnN0IHN0cnVjdCBjb3VudGVy
X2RldmljZV9hdHRyICpjb25zdCBkZXZhdHRyID0gdG9fY291bnRlcl9hdHRyKGF0dHIpOwotCWNv
bnN0IHN0cnVjdCBjb3VudGVyX2Z1bmNfYXZhaWxfdW5pdCAqY29uc3QgY29tcG9uZW50ID0gZGV2
YXR0ci0+Y29tcG9uZW50OwotCWNvbnN0IGVudW0gY291bnRlcl9mdW5jdGlvbiAqY29uc3QgZnVu
Y19saXN0ID0gY29tcG9uZW50LT5mdW5jdGlvbnNfbGlzdDsKLQljb25zdCBzaXplX3QgbnVtX2Z1
bmN0aW9ucyA9IGNvbXBvbmVudC0+bnVtX2Z1bmN0aW9uczsKLQlzaXplX3QgaTsKLQllbnVtIGNv
dW50ZXJfZnVuY3Rpb24gZnVuY3Rpb247Ci0Jc3NpemVfdCBsZW4gPSAwOwotCi0JZm9yIChpID0g
MDsgaSA8IG51bV9mdW5jdGlvbnM7IGkrKykgewotCQlmdW5jdGlvbiA9IGZ1bmNfbGlzdFtpXTsK
LQkJbGVuICs9IHNwcmludGYoYnVmICsgbGVuLCAiJXNcbiIsCi0JCQkgICAgICAgY291bnRlcl9m
dW5jdGlvbl9zdHJbZnVuY3Rpb25dKTsKLQl9Ci0KLQlyZXR1cm4gbGVuOwotfQotCi1zdGF0aWMg
aW50IGNvdW50ZXJfY291bnRfYXR0cmlidXRlc19jcmVhdGUoCi0Jc3RydWN0IGNvdW50ZXJfZGV2
aWNlX2F0dHJfZ3JvdXAgKmNvbnN0IGdyb3VwLAotCWNvbnN0IHN0cnVjdCBjb3VudGVyX2Rldmlj
ZSAqY29uc3QgY291bnRlciwKLQlzdHJ1Y3QgY291bnRlcl9jb3VudCAqY29uc3QgY291bnQpCi17
Ci0Jc3RydWN0IGNvdW50ZXJfY291bnRfdW5pdCAqY291bnRfY29tcDsKLQlzdHJ1Y3QgY291bnRl
cl9hdHRyX3Bhcm0gcGFybTsKLQlpbnQgZXJyOwotCXN0cnVjdCBjb3VudGVyX2NvdW50X3VuaXQg
KmZ1bmNfY29tcDsKLQlzdHJ1Y3QgY291bnRlcl9mdW5jX2F2YWlsX3VuaXQgKmF2YWlsX2NvbXA7
Ci0KLQkvKiBBbGxvY2F0ZSBjb3VudCBhdHRyaWJ1dGUgY29tcG9uZW50ICovCi0JY291bnRfY29t
cCA9IGttYWxsb2Moc2l6ZW9mKCpjb3VudF9jb21wKSwgR0ZQX0tFUk5FTCk7Ci0JaWYgKCFjb3Vu
dF9jb21wKQotCQlyZXR1cm4gLUVOT01FTTsKLQljb3VudF9jb21wLT5jb3VudCA9IGNvdW50Owot
Ci0JLyogQ3JlYXRlIG1haW4gQ291bnQgYXR0cmlidXRlICovCi0JcGFybS5ncm91cCA9IGdyb3Vw
OwotCXBhcm0ucHJlZml4ID0gIiI7Ci0JcGFybS5uYW1lID0gImNvdW50IjsKLQlwYXJtLnNob3cg
PSAoY291bnRlci0+b3BzLT5jb3VudF9yZWFkKSA/IGNvdW50ZXJfY291bnRfc2hvdyA6IE5VTEw7
Ci0JcGFybS5zdG9yZSA9IChjb3VudGVyLT5vcHMtPmNvdW50X3dyaXRlKSA/IGNvdW50ZXJfY291
bnRfc3RvcmUgOiBOVUxMOwotCXBhcm0uY29tcG9uZW50ID0gY291bnRfY29tcDsKLQllcnIgPSBj
b3VudGVyX2F0dHJpYnV0ZV9jcmVhdGUoJnBhcm0pOwotCWlmIChlcnIpIHsKLQkJa2ZyZWUoY291
bnRfY29tcCk7Ci0JCXJldHVybiBlcnI7Ci0JfQotCi0JLyogQWxsb2NhdGUgZnVuY3Rpb24gYXR0
cmlidXRlIGNvbXBvbmVudCAqLwotCWZ1bmNfY29tcCA9IGttYWxsb2Moc2l6ZW9mKCpmdW5jX2Nv
bXApLCBHRlBfS0VSTkVMKTsKLQlpZiAoIWZ1bmNfY29tcCkgewotCQllcnIgPSAtRU5PTUVNOwot
CQlnb3RvIGVycl9mcmVlX2F0dHJfbGlzdDsKLQl9Ci0JZnVuY19jb21wLT5jb3VudCA9IGNvdW50
OwotCi0JLyogQ3JlYXRlIENvdW50IGZ1bmN0aW9uIGF0dHJpYnV0ZSAqLwotCXBhcm0uZ3JvdXAg
PSBncm91cDsKLQlwYXJtLnByZWZpeCA9ICIiOwotCXBhcm0ubmFtZSA9ICJmdW5jdGlvbiI7Ci0J
cGFybS5zaG93ID0gKGNvdW50ZXItPm9wcy0+ZnVuY3Rpb25fZ2V0KSA/IGNvdW50ZXJfZnVuY3Rp
b25fc2hvdyA6IE5VTEw7Ci0JcGFybS5zdG9yZSA9IChjb3VudGVyLT5vcHMtPmZ1bmN0aW9uX3Nl
dCkgPyBjb3VudGVyX2Z1bmN0aW9uX3N0b3JlIDogTlVMTDsKLQlwYXJtLmNvbXBvbmVudCA9IGZ1
bmNfY29tcDsKLQllcnIgPSBjb3VudGVyX2F0dHJpYnV0ZV9jcmVhdGUoJnBhcm0pOwotCWlmIChl
cnIpIHsKLQkJa2ZyZWUoZnVuY19jb21wKTsKLQkJZ290byBlcnJfZnJlZV9hdHRyX2xpc3Q7Ci0J
fQotCi0JLyogQWxsb2NhdGUgZnVuY3Rpb24gYXZhaWxhYmxlIGF0dHJpYnV0ZSBjb21wb25lbnQg
Ki8KLQlhdmFpbF9jb21wID0ga21hbGxvYyhzaXplb2YoKmF2YWlsX2NvbXApLCBHRlBfS0VSTkVM
KTsKLQlpZiAoIWF2YWlsX2NvbXApIHsKLQkJZXJyID0gLUVOT01FTTsKLQkJZ290byBlcnJfZnJl
ZV9hdHRyX2xpc3Q7Ci0JfQotCWF2YWlsX2NvbXAtPmZ1bmN0aW9uc19saXN0ID0gY291bnQtPmZ1
bmN0aW9uc19saXN0OwotCWF2YWlsX2NvbXAtPm51bV9mdW5jdGlvbnMgPSBjb3VudC0+bnVtX2Z1
bmN0aW9uczsKLQotCS8qIENyZWF0ZSBDb3VudCBmdW5jdGlvbl9hdmFpbGFibGUgYXR0cmlidXRl
ICovCi0JcGFybS5ncm91cCA9IGdyb3VwOwotCXBhcm0ucHJlZml4ID0gIiI7Ci0JcGFybS5uYW1l
ID0gImZ1bmN0aW9uX2F2YWlsYWJsZSI7Ci0JcGFybS5zaG93ID0gY291bnRlcl9mdW5jdGlvbl9h
dmFpbGFibGVfc2hvdzsKLQlwYXJtLnN0b3JlID0gTlVMTDsKLQlwYXJtLmNvbXBvbmVudCA9IGF2
YWlsX2NvbXA7Ci0JZXJyID0gY291bnRlcl9hdHRyaWJ1dGVfY3JlYXRlKCZwYXJtKTsKLQlpZiAo
ZXJyKSB7Ci0JCWtmcmVlKGF2YWlsX2NvbXApOwotCQlnb3RvIGVycl9mcmVlX2F0dHJfbGlzdDsK
LQl9Ci0KLQkvKiBDcmVhdGUgQ291bnQgbmFtZSBhdHRyaWJ1dGUgKi8KLQllcnIgPSBjb3VudGVy
X25hbWVfYXR0cmlidXRlX2NyZWF0ZShncm91cCwgY291bnQtPm5hbWUpOwotCWlmIChlcnIpCi0J
CWdvdG8gZXJyX2ZyZWVfYXR0cl9saXN0OwotCi0JLyogUmVnaXN0ZXIgQ291bnQgZXh0ZW5zaW9u
IGF0dHJpYnV0ZXMgKi8KLQllcnIgPSBjb3VudGVyX2NvdW50X2V4dF9yZWdpc3Rlcihncm91cCwg
Y291bnQpOwotCWlmIChlcnIpCi0JCWdvdG8gZXJyX2ZyZWVfYXR0cl9saXN0OwotCi0JcmV0dXJu
IDA7Ci0KLWVycl9mcmVlX2F0dHJfbGlzdDoKLQljb3VudGVyX2RldmljZV9hdHRyX2xpc3RfZnJl
ZSgmZ3JvdXAtPmF0dHJfbGlzdCk7Ci0JcmV0dXJuIGVycjsKLX0KLQotc3RhdGljIGludCBjb3Vu
dGVyX2NvdW50c19yZWdpc3RlcigKLQlzdHJ1Y3QgY291bnRlcl9kZXZpY2VfYXR0cl9ncm91cCAq
Y29uc3QgZ3JvdXBzX2xpc3QsCi0JY29uc3Qgc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb25zdCBj
b3VudGVyKQotewotCXNpemVfdCBpOwotCXN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudDsKLQlj
b25zdCBjaGFyICpuYW1lOwotCWludCBlcnI7Ci0KLQkvKiBSZWdpc3RlciBlYWNoIENvdW50ICov
Ci0JZm9yIChpID0gMDsgaSA8IGNvdW50ZXItPm51bV9jb3VudHM7IGkrKykgewotCQljb3VudCA9
IGNvdW50ZXItPmNvdW50cyArIGk7Ci0KLQkJLyogR2VuZXJhdGUgQ291bnQgYXR0cmlidXRlIGRp
cmVjdG9yeSBuYW1lICovCi0JCW5hbWUgPSBrYXNwcmludGYoR0ZQX0tFUk5FTCwgImNvdW50JWQi
LCBjb3VudC0+aWQpOwotCQlpZiAoIW5hbWUpIHsKLQkJCWVyciA9IC1FTk9NRU07Ci0JCQlnb3Rv
IGVycl9mcmVlX2F0dHJfZ3JvdXBzOwotCQl9Ci0JCWdyb3Vwc19saXN0W2ldLmF0dHJfZ3JvdXAu
bmFtZSA9IG5hbWU7Ci0KLQkJLyogUmVnaXN0ZXIgdGhlIFN5bmFwc2VzIGFzc29jaWF0ZWQgd2l0
aCBlYWNoIENvdW50ICovCi0JCWVyciA9IGNvdW50ZXJfc3luYXBzZXNfcmVnaXN0ZXIoZ3JvdXBz
X2xpc3QgKyBpLCBjb3VudGVyLCBjb3VudCwKLQkJCQkJCW5hbWUpOwotCQlpZiAoZXJyKQotCQkJ
Z290byBlcnJfZnJlZV9hdHRyX2dyb3VwczsKLQotCQkvKiBDcmVhdGUgYWxsIGF0dHJpYnV0ZXMg
YXNzb2NpYXRlZCB3aXRoIENvdW50ICovCi0JCWVyciA9IGNvdW50ZXJfY291bnRfYXR0cmlidXRl
c19jcmVhdGUoZ3JvdXBzX2xpc3QgKyBpLCBjb3VudGVyLAotCQkJCQkJICAgICAgY291bnQpOwot
CQlpZiAoZXJyKQotCQkJZ290byBlcnJfZnJlZV9hdHRyX2dyb3VwczsKLQl9Ci0KLQlyZXR1cm4g
MDsKLQotZXJyX2ZyZWVfYXR0cl9ncm91cHM6Ci0JZG8gewotCQlrZnJlZShncm91cHNfbGlzdFtp
XS5hdHRyX2dyb3VwLm5hbWUpOwotCQljb3VudGVyX2RldmljZV9hdHRyX2xpc3RfZnJlZSgmZ3Jv
dXBzX2xpc3RbaV0uYXR0cl9saXN0KTsKLQl9IHdoaWxlIChpLS0pOwotCXJldHVybiBlcnI7Ci19
Ci0KLXN0cnVjdCBjb3VudGVyX3NpemVfdW5pdCB7Ci0Jc2l6ZV90IHNpemU7Ci19OwotCi1zdGF0
aWMgc3NpemVfdCBjb3VudGVyX2RldmljZV9hdHRyX3NpemVfc2hvdyhzdHJ1Y3QgZGV2aWNlICpk
ZXYsCi0JCQkJCSAgICAgc3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIsCi0JCQkJCSAgICAg
Y2hhciAqYnVmKQotewotCWNvbnN0IHN0cnVjdCBjb3VudGVyX3NpemVfdW5pdCAqY29uc3QgY29t
cCA9IHRvX2NvdW50ZXJfYXR0cihhdHRyKS0+Y29tcG9uZW50OwotCi0JcmV0dXJuIHNwcmludGYo
YnVmLCAiJXp1XG4iLCBjb21wLT5zaXplKTsKLX0KLQotc3RhdGljIGludCBjb3VudGVyX3NpemVf
YXR0cmlidXRlX2NyZWF0ZSgKLQlzdHJ1Y3QgY291bnRlcl9kZXZpY2VfYXR0cl9ncm91cCAqY29u
c3QgZ3JvdXAsCi0JY29uc3Qgc2l6ZV90IHNpemUsIGNvbnN0IGNoYXIgKmNvbnN0IG5hbWUpCi17
Ci0Jc3RydWN0IGNvdW50ZXJfc2l6ZV91bml0ICpzaXplX2NvbXA7Ci0Jc3RydWN0IGNvdW50ZXJf
YXR0cl9wYXJtIHBhcm07Ci0JaW50IGVycjsKLQotCS8qIEFsbG9jYXRlIHNpemUgYXR0cmlidXRl
IGNvbXBvbmVudCAqLwotCXNpemVfY29tcCA9IGttYWxsb2Moc2l6ZW9mKCpzaXplX2NvbXApLCBH
RlBfS0VSTkVMKTsKLQlpZiAoIXNpemVfY29tcCkKLQkJcmV0dXJuIC1FTk9NRU07Ci0Jc2l6ZV9j
b21wLT5zaXplID0gc2l6ZTsKLQotCXBhcm0uZ3JvdXAgPSBncm91cDsKLQlwYXJtLnByZWZpeCA9
ICIiOwotCXBhcm0ubmFtZSA9IG5hbWU7Ci0JcGFybS5zaG93ID0gY291bnRlcl9kZXZpY2VfYXR0
cl9zaXplX3Nob3c7Ci0JcGFybS5zdG9yZSA9IE5VTEw7Ci0JcGFybS5jb21wb25lbnQgPSBzaXpl
X2NvbXA7Ci0JZXJyID0gY291bnRlcl9hdHRyaWJ1dGVfY3JlYXRlKCZwYXJtKTsKLQlpZiAoZXJy
KQotCQlnb3RvIGVycl9mcmVlX3NpemVfY29tcDsKLQotCXJldHVybiAwOwotCi1lcnJfZnJlZV9z
aXplX2NvbXA6Ci0Ja2ZyZWUoc2l6ZV9jb21wKTsKLQlyZXR1cm4gZXJyOwotfQotCi1zdHJ1Y3Qg
Y291bnRlcl9leHRfdW5pdCB7Ci0JY29uc3Qgc3RydWN0IGNvdW50ZXJfZGV2aWNlX2V4dCAqZXh0
OwotfTsKLQotc3RhdGljIHNzaXplX3QgY291bnRlcl9kZXZpY2VfZXh0X3Nob3coc3RydWN0IGRl
dmljZSAqZGV2LAotCQkJCSAgICAgICBzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSAqYXR0ciwgY2hh
ciAqYnVmKQotewotCWNvbnN0IHN0cnVjdCBjb3VudGVyX2RldmljZV9hdHRyICpjb25zdCBkZXZh
dHRyID0gdG9fY291bnRlcl9hdHRyKGF0dHIpOwotCWNvbnN0IHN0cnVjdCBjb3VudGVyX2V4dF91
bml0ICpjb25zdCBjb21wb25lbnQgPSBkZXZhdHRyLT5jb21wb25lbnQ7Ci0JY29uc3Qgc3RydWN0
IGNvdW50ZXJfZGV2aWNlX2V4dCAqY29uc3QgZXh0ID0gY29tcG9uZW50LT5leHQ7Ci0KLQlyZXR1
cm4gZXh0LT5yZWFkKGRldl9nZXRfZHJ2ZGF0YShkZXYpLCBleHQtPnByaXYsIGJ1Zik7Ci19Ci0K
LXN0YXRpYyBzc2l6ZV90IGNvdW50ZXJfZGV2aWNlX2V4dF9zdG9yZShzdHJ1Y3QgZGV2aWNlICpk
ZXYsCi0JCQkJCXN0cnVjdCBkZXZpY2VfYXR0cmlidXRlICphdHRyLAotCQkJCQljb25zdCBjaGFy
ICpidWYsIHNpemVfdCBsZW4pCi17Ci0JY29uc3Qgc3RydWN0IGNvdW50ZXJfZGV2aWNlX2F0dHIg
KmNvbnN0IGRldmF0dHIgPSB0b19jb3VudGVyX2F0dHIoYXR0cik7Ci0JY29uc3Qgc3RydWN0IGNv
dW50ZXJfZXh0X3VuaXQgKmNvbnN0IGNvbXBvbmVudCA9IGRldmF0dHItPmNvbXBvbmVudDsKLQlj
b25zdCBzdHJ1Y3QgY291bnRlcl9kZXZpY2VfZXh0ICpjb25zdCBleHQgPSBjb21wb25lbnQtPmV4
dDsKLQotCXJldHVybiBleHQtPndyaXRlKGRldl9nZXRfZHJ2ZGF0YShkZXYpLCBleHQtPnByaXYs
IGJ1ZiwgbGVuKTsKLX0KLQotc3RhdGljIGludCBjb3VudGVyX2RldmljZV9leHRfcmVnaXN0ZXIo
Ci0Jc3RydWN0IGNvdW50ZXJfZGV2aWNlX2F0dHJfZ3JvdXAgKmNvbnN0IGdyb3VwLAotCXN0cnVj
dCBjb3VudGVyX2RldmljZSAqY29uc3QgY291bnRlcikKLXsKLQlzaXplX3QgaTsKLQlzdHJ1Y3Qg
Y291bnRlcl9leHRfdW5pdCAqZXh0X2NvbXA7Ci0Jc3RydWN0IGNvdW50ZXJfYXR0cl9wYXJtIHBh
cm07Ci0JaW50IGVycjsKLQotCS8qIENyZWF0ZSBhbiBhdHRyaWJ1dGUgZm9yIGVhY2ggZXh0ZW5z
aW9uICovCi0JZm9yIChpID0gMCA7IGkgPCBjb3VudGVyLT5udW1fZXh0OyBpKyspIHsKLQkJLyog
QWxsb2NhdGUgZXh0ZW5zaW9uIGF0dHJpYnV0ZSBjb21wb25lbnQgKi8KLQkJZXh0X2NvbXAgPSBr
bWFsbG9jKHNpemVvZigqZXh0X2NvbXApLCBHRlBfS0VSTkVMKTsKLQkJaWYgKCFleHRfY29tcCkg
ewotCQkJZXJyID0gLUVOT01FTTsKLQkJCWdvdG8gZXJyX2ZyZWVfYXR0cl9saXN0OwotCQl9Ci0K
LQkJZXh0X2NvbXAtPmV4dCA9IGNvdW50ZXItPmV4dCArIGk7Ci0KLQkJLyogQWxsb2NhdGUgZXh0
ZW5zaW9uIGF0dHJpYnV0ZSAqLwotCQlwYXJtLmdyb3VwID0gZ3JvdXA7Ci0JCXBhcm0ucHJlZml4
ID0gIiI7Ci0JCXBhcm0ubmFtZSA9IGNvdW50ZXItPmV4dFtpXS5uYW1lOwotCQlwYXJtLnNob3cg
PSAoY291bnRlci0+ZXh0W2ldLnJlYWQpID8gY291bnRlcl9kZXZpY2VfZXh0X3Nob3cgOiBOVUxM
OwotCQlwYXJtLnN0b3JlID0gKGNvdW50ZXItPmV4dFtpXS53cml0ZSkgPyBjb3VudGVyX2Rldmlj
ZV9leHRfc3RvcmUgOiBOVUxMOwotCQlwYXJtLmNvbXBvbmVudCA9IGV4dF9jb21wOwotCQllcnIg
PSBjb3VudGVyX2F0dHJpYnV0ZV9jcmVhdGUoJnBhcm0pOwotCQlpZiAoZXJyKSB7Ci0JCQlrZnJl
ZShleHRfY29tcCk7Ci0JCQlnb3RvIGVycl9mcmVlX2F0dHJfbGlzdDsKLQkJfQotCX0KLQotCXJl
dHVybiAwOwotCi1lcnJfZnJlZV9hdHRyX2xpc3Q6Ci0JY291bnRlcl9kZXZpY2VfYXR0cl9saXN0
X2ZyZWUoJmdyb3VwLT5hdHRyX2xpc3QpOwotCXJldHVybiBlcnI7Ci19Ci0KLXN0YXRpYyBpbnQg
Y291bnRlcl9nbG9iYWxfYXR0cl9yZWdpc3RlcigKLQlzdHJ1Y3QgY291bnRlcl9kZXZpY2VfYXR0
cl9ncm91cCAqY29uc3QgZ3JvdXAsCi0Jc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb25zdCBjb3Vu
dGVyKQotewotCWludCBlcnI7Ci0KLQkvKiBDcmVhdGUgbmFtZSBhdHRyaWJ1dGUgKi8KLQllcnIg
PSBjb3VudGVyX25hbWVfYXR0cmlidXRlX2NyZWF0ZShncm91cCwgY291bnRlci0+bmFtZSk7Ci0J
aWYgKGVycikKLQkJcmV0dXJuIGVycjsKLQotCS8qIENyZWF0ZSBudW1fY291bnRzIGF0dHJpYnV0
ZSAqLwotCWVyciA9IGNvdW50ZXJfc2l6ZV9hdHRyaWJ1dGVfY3JlYXRlKGdyb3VwLCBjb3VudGVy
LT5udW1fY291bnRzLAotCQkJCQkgICAgIm51bV9jb3VudHMiKTsKLQlpZiAoZXJyKQotCQlnb3Rv
IGVycl9mcmVlX2F0dHJfbGlzdDsKLQotCS8qIENyZWF0ZSBudW1fc2lnbmFscyBhdHRyaWJ1dGUg
Ki8KLQllcnIgPSBjb3VudGVyX3NpemVfYXR0cmlidXRlX2NyZWF0ZShncm91cCwgY291bnRlci0+
bnVtX3NpZ25hbHMsCi0JCQkJCSAgICAibnVtX3NpZ25hbHMiKTsKLQlpZiAoZXJyKQotCQlnb3Rv
IGVycl9mcmVlX2F0dHJfbGlzdDsKLQotCS8qIFJlZ2lzdGVyIENvdW50ZXIgZGV2aWNlIGV4dGVu
c2lvbiBhdHRyaWJ1dGVzICovCi0JZXJyID0gY291bnRlcl9kZXZpY2VfZXh0X3JlZ2lzdGVyKGdy
b3VwLCBjb3VudGVyKTsKLQlpZiAoZXJyKQotCQlnb3RvIGVycl9mcmVlX2F0dHJfbGlzdDsKLQot
CXJldHVybiAwOwotCi1lcnJfZnJlZV9hdHRyX2xpc3Q6Ci0JY291bnRlcl9kZXZpY2VfYXR0cl9s
aXN0X2ZyZWUoJmdyb3VwLT5hdHRyX2xpc3QpOwotCXJldHVybiBlcnI7Ci19Ci0KLXN0YXRpYyB2
b2lkIGNvdW50ZXJfZGV2aWNlX2dyb3Vwc19saXN0X2ZyZWUoCi0Jc3RydWN0IGNvdW50ZXJfZGV2
aWNlX2F0dHJfZ3JvdXAgKmNvbnN0IGdyb3Vwc19saXN0LAotCWNvbnN0IHNpemVfdCBudW1fZ3Jv
dXBzKQotewotCXN0cnVjdCBjb3VudGVyX2RldmljZV9hdHRyX2dyb3VwICpncm91cDsKLQlzaXpl
X3QgaTsKLQotCS8qIGxvb3AgdGhyb3VnaCBhbGwgYXR0cmlidXRlIGdyb3VwcyAoc2lnbmFscywg
Y291bnRzLCBnbG9iYWwsIGV0Yy4pICovCi0JZm9yIChpID0gMDsgaSA8IG51bV9ncm91cHM7IGkr
KykgewotCQlncm91cCA9IGdyb3Vwc19saXN0ICsgaTsKLQotCQkvKiBmcmVlIGFsbCBhdHRyaWJ1
dGUgZ3JvdXAgYW5kIGFzc29jaWF0ZWQgYXR0cmlidXRlcyBtZW1vcnkgKi8KLQkJa2ZyZWUoZ3Jv
dXAtPmF0dHJfZ3JvdXAubmFtZSk7Ci0JCWtmcmVlKGdyb3VwLT5hdHRyX2dyb3VwLmF0dHJzKTsK
LQkJY291bnRlcl9kZXZpY2VfYXR0cl9saXN0X2ZyZWUoJmdyb3VwLT5hdHRyX2xpc3QpOwotCX0K
LQotCWtmcmVlKGdyb3Vwc19saXN0KTsKLX0KLQotc3RhdGljIGludCBjb3VudGVyX2RldmljZV9n
cm91cHNfbGlzdF9wcmVwYXJlKAotCXN0cnVjdCBjb3VudGVyX2RldmljZSAqY29uc3QgY291bnRl
cikKLXsKLQljb25zdCBzaXplX3QgdG90YWxfbnVtX2dyb3VwcyA9Ci0JCWNvdW50ZXItPm51bV9z
aWduYWxzICsgY291bnRlci0+bnVtX2NvdW50cyArIDE7Ci0Jc3RydWN0IGNvdW50ZXJfZGV2aWNl
X2F0dHJfZ3JvdXAgKmdyb3Vwc19saXN0OwotCXNpemVfdCBpOwotCWludCBlcnI7Ci0Jc2l6ZV90
IG51bV9ncm91cHMgPSAwOwotCi0JLyogQWxsb2NhdGUgc3BhY2UgZm9yIGF0dHJpYnV0ZSBncm91
cHMgKHNpZ25hbHMsIGNvdW50cywgYW5kIGV4dCkgKi8KLQlncm91cHNfbGlzdCA9IGtjYWxsb2Mo
dG90YWxfbnVtX2dyb3Vwcywgc2l6ZW9mKCpncm91cHNfbGlzdCksCi0JCQkgICAgICBHRlBfS0VS
TkVMKTsKLQlpZiAoIWdyb3Vwc19saXN0KQotCQlyZXR1cm4gLUVOT01FTTsKLQotCS8qIEluaXRp
YWxpemUgYXR0cmlidXRlIGxpc3RzICovCi0JZm9yIChpID0gMDsgaSA8IHRvdGFsX251bV9ncm91
cHM7IGkrKykKLQkJSU5JVF9MSVNUX0hFQUQoJmdyb3Vwc19saXN0W2ldLmF0dHJfbGlzdCk7Ci0K
LQkvKiBSZWdpc3RlciBTaWduYWxzICovCi0JZXJyID0gY291bnRlcl9zaWduYWxzX3JlZ2lzdGVy
KGdyb3Vwc19saXN0LCBjb3VudGVyKTsKLQlpZiAoZXJyKQotCQlnb3RvIGVycl9mcmVlX2dyb3Vw
c19saXN0OwotCW51bV9ncm91cHMgKz0gY291bnRlci0+bnVtX3NpZ25hbHM7Ci0KLQkvKiBSZWdp
c3RlciBDb3VudHMgYW5kIHJlc3BlY3RpdmUgU3luYXBzZXMgKi8KLQllcnIgPSBjb3VudGVyX2Nv
dW50c19yZWdpc3Rlcihncm91cHNfbGlzdCArIG51bV9ncm91cHMsIGNvdW50ZXIpOwotCWlmIChl
cnIpCi0JCWdvdG8gZXJyX2ZyZWVfZ3JvdXBzX2xpc3Q7Ci0JbnVtX2dyb3VwcyArPSBjb3VudGVy
LT5udW1fY291bnRzOwotCi0JLyogUmVnaXN0ZXIgQ291bnRlciBnbG9iYWwgYXR0cmlidXRlcyAq
LwotCWVyciA9IGNvdW50ZXJfZ2xvYmFsX2F0dHJfcmVnaXN0ZXIoZ3JvdXBzX2xpc3QgKyBudW1f
Z3JvdXBzLCBjb3VudGVyKTsKLQlpZiAoZXJyKQotCQlnb3RvIGVycl9mcmVlX2dyb3Vwc19saXN0
OwotCW51bV9ncm91cHMrKzsKLQotCS8qIFN0b3JlIGdyb3Vwc19saXN0IGluIGRldmljZV9zdGF0
ZSAqLwotCWNvdW50ZXItPmRldmljZV9zdGF0ZS0+Z3JvdXBzX2xpc3QgPSBncm91cHNfbGlzdDsK
LQljb3VudGVyLT5kZXZpY2Vfc3RhdGUtPm51bV9ncm91cHMgPSBudW1fZ3JvdXBzOwotCi0JcmV0
dXJuIDA7Ci0KLWVycl9mcmVlX2dyb3Vwc19saXN0OgotCWNvdW50ZXJfZGV2aWNlX2dyb3Vwc19s
aXN0X2ZyZWUoZ3JvdXBzX2xpc3QsIG51bV9ncm91cHMpOwotCXJldHVybiBlcnI7Ci19Ci0KLXN0
YXRpYyBpbnQgY291bnRlcl9kZXZpY2VfZ3JvdXBzX3ByZXBhcmUoCi0Jc3RydWN0IGNvdW50ZXJf
ZGV2aWNlX3N0YXRlICpjb25zdCBkZXZpY2Vfc3RhdGUpCi17Ci0Jc2l6ZV90IGksIGo7Ci0Jc3Ry
dWN0IGNvdW50ZXJfZGV2aWNlX2F0dHJfZ3JvdXAgKmdyb3VwOwotCWludCBlcnI7Ci0Jc3RydWN0
IGNvdW50ZXJfZGV2aWNlX2F0dHIgKnA7Ci0KLQkvKiBBbGxvY2F0ZSBhdHRyaWJ1dGUgZ3JvdXBz
IGZvciBhc3NvY2lhdGlvbiB3aXRoIGRldmljZSAqLwotCWRldmljZV9zdGF0ZS0+Z3JvdXBzID0g
a2NhbGxvYyhkZXZpY2Vfc3RhdGUtPm51bV9ncm91cHMgKyAxLAotCQkJCSAgICAgICBzaXplb2Yo
KmRldmljZV9zdGF0ZS0+Z3JvdXBzKSwKLQkJCQkgICAgICAgR0ZQX0tFUk5FTCk7Ci0JaWYgKCFk
ZXZpY2Vfc3RhdGUtPmdyb3VwcykKLQkJcmV0dXJuIC1FTk9NRU07Ci0KLQkvKiBQcmVwYXJlIGVh
Y2ggZ3JvdXAgb2YgYXR0cmlidXRlcyBmb3IgYXNzb2NpYXRpb24gKi8KLQlmb3IgKGkgPSAwOyBp
IDwgZGV2aWNlX3N0YXRlLT5udW1fZ3JvdXBzOyBpKyspIHsKLQkJZ3JvdXAgPSBkZXZpY2Vfc3Rh
dGUtPmdyb3Vwc19saXN0ICsgaTsKLQotCQkvKiBBbGxvY2F0ZSBzcGFjZSBmb3IgYXR0cmlidXRl
IHBvaW50ZXJzIGluIGF0dHJpYnV0ZSBncm91cCAqLwotCQlncm91cC0+YXR0cl9ncm91cC5hdHRy
cyA9IGtjYWxsb2MoZ3JvdXAtPm51bV9hdHRyICsgMSwKLQkJCXNpemVvZigqZ3JvdXAtPmF0dHJf
Z3JvdXAuYXR0cnMpLCBHRlBfS0VSTkVMKTsKLQkJaWYgKCFncm91cC0+YXR0cl9ncm91cC5hdHRy
cykgewotCQkJZXJyID0gLUVOT01FTTsKLQkJCWdvdG8gZXJyX2ZyZWVfZ3JvdXBzOwotCQl9Ci0K
LQkJLyogQWRkIGF0dHJpYnV0ZSBwb2ludGVycyB0byBhdHRyaWJ1dGUgZ3JvdXAgKi8KLQkJaiA9
IDA7Ci0JCWxpc3RfZm9yX2VhY2hfZW50cnkocCwgJmdyb3VwLT5hdHRyX2xpc3QsIGwpCi0JCQln
cm91cC0+YXR0cl9ncm91cC5hdHRyc1tqKytdID0gJnAtPmRldl9hdHRyLmF0dHI7Ci0KLQkJLyog
R3JvdXAgYXR0cmlidXRlcyBpbiBhdHRyaWJ1dGUgZ3JvdXAgKi8KLQkJZGV2aWNlX3N0YXRlLT5n
cm91cHNbaV0gPSAmZ3JvdXAtPmF0dHJfZ3JvdXA7Ci0JfQotCS8qIEFzc29jaWF0ZSBhdHRyaWJ1
dGVzIHdpdGggZGV2aWNlICovCi0JZGV2aWNlX3N0YXRlLT5kZXYuZ3JvdXBzID0gZGV2aWNlX3N0
YXRlLT5ncm91cHM7Ci0KLQlyZXR1cm4gMDsKLQotZXJyX2ZyZWVfZ3JvdXBzOgotCWRvIHsKLQkJ
Z3JvdXAgPSBkZXZpY2Vfc3RhdGUtPmdyb3Vwc19saXN0ICsgaTsKLQkJa2ZyZWUoZ3JvdXAtPmF0
dHJfZ3JvdXAuYXR0cnMpOwotCQlncm91cC0+YXR0cl9ncm91cC5hdHRycyA9IE5VTEw7Ci0JfSB3
aGlsZSAoaS0tKTsKLQlrZnJlZShkZXZpY2Vfc3RhdGUtPmdyb3Vwcyk7Ci0JcmV0dXJuIGVycjsK
LX0KLQotLyogUHJvdmlkZXMgYSB1bmlxdWUgSUQgZm9yIGVhY2ggY291bnRlciBkZXZpY2UgKi8K
LXN0YXRpYyBERUZJTkVfSURBKGNvdW50ZXJfaWRhKTsKLQotc3RhdGljIHZvaWQgY291bnRlcl9k
ZXZpY2VfcmVsZWFzZShzdHJ1Y3QgZGV2aWNlICpkZXYpCi17Ci0Jc3RydWN0IGNvdW50ZXJfZGV2
aWNlICpjb25zdCBjb3VudGVyID0gZGV2X2dldF9kcnZkYXRhKGRldik7Ci0Jc3RydWN0IGNvdW50
ZXJfZGV2aWNlX3N0YXRlICpjb25zdCBkZXZpY2Vfc3RhdGUgPSBjb3VudGVyLT5kZXZpY2Vfc3Rh
dGU7Ci0KLQlrZnJlZShkZXZpY2Vfc3RhdGUtPmdyb3Vwcyk7Ci0JY291bnRlcl9kZXZpY2VfZ3Jv
dXBzX2xpc3RfZnJlZShkZXZpY2Vfc3RhdGUtPmdyb3Vwc19saXN0LAotCQkJCQlkZXZpY2Vfc3Rh
dGUtPm51bV9ncm91cHMpOwotCWlkYV9zaW1wbGVfcmVtb3ZlKCZjb3VudGVyX2lkYSwgZGV2aWNl
X3N0YXRlLT5pZCk7Ci0Ja2ZyZWUoZGV2aWNlX3N0YXRlKTsKLX0KLQotc3RhdGljIHN0cnVjdCBk
ZXZpY2VfdHlwZSBjb3VudGVyX2RldmljZV90eXBlID0gewotCS5uYW1lID0gImNvdW50ZXJfZGV2
aWNlIiwKLQkucmVsZWFzZSA9IGNvdW50ZXJfZGV2aWNlX3JlbGVhc2UKLX07Ci0KLXN0YXRpYyBz
dHJ1Y3QgYnVzX3R5cGUgY291bnRlcl9idXNfdHlwZSA9IHsKLQkubmFtZSA9ICJjb3VudGVyIgot
fTsKLQotLyoqCi0gKiBjb3VudGVyX3JlZ2lzdGVyIC0gcmVnaXN0ZXIgQ291bnRlciB0byB0aGUg
c3lzdGVtCi0gKiBAY291bnRlcjoJcG9pbnRlciB0byBDb3VudGVyIHRvIHJlZ2lzdGVyCi0gKgot
ICogVGhpcyBmdW5jdGlvbiByZWdpc3RlcnMgYSBDb3VudGVyIHRvIHRoZSBzeXN0ZW0uIEEgc3lz
ZnMgImNvdW50ZXIiIGRpcmVjdG9yeQotICogd2lsbCBiZSBjcmVhdGVkIGFuZCBwb3B1bGF0ZWQg
d2l0aCBzeXNmcyBhdHRyaWJ1dGVzIGNvcnJlbGF0aW5nIHdpdGggdGhlCi0gKiBDb3VudGVyIFNp
Z25hbHMsIFN5bmFwc2VzLCBhbmQgQ291bnRzIHJlc3BlY3RpdmVseS4KLSAqLwotaW50IGNvdW50
ZXJfcmVnaXN0ZXIoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb25zdCBjb3VudGVyKQotewotCXN0
cnVjdCBjb3VudGVyX2RldmljZV9zdGF0ZSAqZGV2aWNlX3N0YXRlOwotCWludCBlcnI7Ci0KLQkv
KiBBbGxvY2F0ZSBpbnRlcm5hbCBzdGF0ZSBjb250YWluZXIgZm9yIENvdW50ZXIgZGV2aWNlICov
Ci0JZGV2aWNlX3N0YXRlID0ga3phbGxvYyhzaXplb2YoKmRldmljZV9zdGF0ZSksIEdGUF9LRVJO
RUwpOwotCWlmICghZGV2aWNlX3N0YXRlKQotCQlyZXR1cm4gLUVOT01FTTsKLQljb3VudGVyLT5k
ZXZpY2Vfc3RhdGUgPSBkZXZpY2Vfc3RhdGU7Ci0KLQkvKiBBY3F1aXJlIHVuaXF1ZSBJRCAqLwot
CWRldmljZV9zdGF0ZS0+aWQgPSBpZGFfc2ltcGxlX2dldCgmY291bnRlcl9pZGEsIDAsIDAsIEdG
UF9LRVJORUwpOwotCWlmIChkZXZpY2Vfc3RhdGUtPmlkIDwgMCkgewotCQllcnIgPSBkZXZpY2Vf
c3RhdGUtPmlkOwotCQlnb3RvIGVycl9mcmVlX2RldmljZV9zdGF0ZTsKLQl9Ci0KLQkvKiBDb25m
aWd1cmUgZGV2aWNlIHN0cnVjdHVyZSBmb3IgQ291bnRlciAqLwotCWRldmljZV9zdGF0ZS0+ZGV2
LnR5cGUgPSAmY291bnRlcl9kZXZpY2VfdHlwZTsKLQlkZXZpY2Vfc3RhdGUtPmRldi5idXMgPSAm
Y291bnRlcl9idXNfdHlwZTsKLQlpZiAoY291bnRlci0+cGFyZW50KSB7Ci0JCWRldmljZV9zdGF0
ZS0+ZGV2LnBhcmVudCA9IGNvdW50ZXItPnBhcmVudDsKLQkJZGV2aWNlX3N0YXRlLT5kZXYub2Zf
bm9kZSA9IGNvdW50ZXItPnBhcmVudC0+b2Zfbm9kZTsKLQl9Ci0JZGV2X3NldF9uYW1lKCZkZXZp
Y2Vfc3RhdGUtPmRldiwgImNvdW50ZXIlZCIsIGRldmljZV9zdGF0ZS0+aWQpOwotCWRldmljZV9p
bml0aWFsaXplKCZkZXZpY2Vfc3RhdGUtPmRldik7Ci0JZGV2X3NldF9kcnZkYXRhKCZkZXZpY2Vf
c3RhdGUtPmRldiwgY291bnRlcik7Ci0KLQkvKiBQcmVwYXJlIGRldmljZSBhdHRyaWJ1dGVzICov
Ci0JZXJyID0gY291bnRlcl9kZXZpY2VfZ3JvdXBzX2xpc3RfcHJlcGFyZShjb3VudGVyKTsKLQlp
ZiAoZXJyKQotCQlnb3RvIGVycl9mcmVlX2lkOwotCi0JLyogT3JnYW5pemUgZGV2aWNlIGF0dHJp
YnV0ZXMgdG8gZ3JvdXBzIGFuZCBtYXRjaCB0byBkZXZpY2UgKi8KLQllcnIgPSBjb3VudGVyX2Rl
dmljZV9ncm91cHNfcHJlcGFyZShkZXZpY2Vfc3RhdGUpOwotCWlmIChlcnIpCi0JCWdvdG8gZXJy
X2ZyZWVfZ3JvdXBzX2xpc3Q7Ci0KLQkvKiBBZGQgZGV2aWNlIHRvIHN5c3RlbSAqLwotCWVyciA9
IGRldmljZV9hZGQoJmRldmljZV9zdGF0ZS0+ZGV2KTsKLQlpZiAoZXJyKQotCQlnb3RvIGVycl9m
cmVlX2dyb3VwczsKLQotCXJldHVybiAwOwotCi1lcnJfZnJlZV9ncm91cHM6Ci0Ja2ZyZWUoZGV2
aWNlX3N0YXRlLT5ncm91cHMpOwotZXJyX2ZyZWVfZ3JvdXBzX2xpc3Q6Ci0JY291bnRlcl9kZXZp
Y2VfZ3JvdXBzX2xpc3RfZnJlZShkZXZpY2Vfc3RhdGUtPmdyb3Vwc19saXN0LAotCQkJCQlkZXZp
Y2Vfc3RhdGUtPm51bV9ncm91cHMpOwotZXJyX2ZyZWVfaWQ6Ci0JaWRhX3NpbXBsZV9yZW1vdmUo
JmNvdW50ZXJfaWRhLCBkZXZpY2Vfc3RhdGUtPmlkKTsKLWVycl9mcmVlX2RldmljZV9zdGF0ZToK
LQlrZnJlZShkZXZpY2Vfc3RhdGUpOwotCXJldHVybiBlcnI7Ci19Ci1FWFBPUlRfU1lNQk9MX0dQ
TChjb3VudGVyX3JlZ2lzdGVyKTsKLQotLyoqCi0gKiBjb3VudGVyX3VucmVnaXN0ZXIgLSB1bnJl
Z2lzdGVyIENvdW50ZXIgZnJvbSB0aGUgc3lzdGVtCi0gKiBAY291bnRlcjoJcG9pbnRlciB0byBD
b3VudGVyIHRvIHVucmVnaXN0ZXIKLSAqCi0gKiBUaGUgQ291bnRlciBpcyB1bnJlZ2lzdGVyZWQg
ZnJvbSB0aGUgc3lzdGVtOyBhbGwgYWxsb2NhdGVkIG1lbW9yeSBpcyBmcmVlZC4KLSAqLwotdm9p
ZCBjb3VudGVyX3VucmVnaXN0ZXIoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb25zdCBjb3VudGVy
KQotewotCWlmIChjb3VudGVyKQotCQlkZXZpY2VfZGVsKCZjb3VudGVyLT5kZXZpY2Vfc3RhdGUt
PmRldik7Ci19Ci1FWFBPUlRfU1lNQk9MX0dQTChjb3VudGVyX3VucmVnaXN0ZXIpOwotCi1zdGF0
aWMgdm9pZCBkZXZtX2NvdW50ZXJfdW5yZWcoc3RydWN0IGRldmljZSAqZGV2LCB2b2lkICpyZXMp
Ci17Ci0JY291bnRlcl91bnJlZ2lzdGVyKCooc3RydWN0IGNvdW50ZXJfZGV2aWNlICoqKXJlcyk7
Ci19Ci0KLS8qKgotICogZGV2bV9jb3VudGVyX3JlZ2lzdGVyIC0gUmVzb3VyY2UtbWFuYWdlZCBj
b3VudGVyX3JlZ2lzdGVyCi0gKiBAZGV2OglkZXZpY2UgdG8gYWxsb2NhdGUgY291bnRlcl9kZXZp
Y2UgZm9yCi0gKiBAY291bnRlcjoJcG9pbnRlciB0byBDb3VudGVyIHRvIHJlZ2lzdGVyCi0gKgot
ICogTWFuYWdlZCBjb3VudGVyX3JlZ2lzdGVyLiBUaGUgQ291bnRlciByZWdpc3RlcmVkIHdpdGgg
dGhpcyBmdW5jdGlvbiBpcwotICogYXV0b21hdGljYWxseSB1bnJlZ2lzdGVyZWQgb24gZHJpdmVy
IGRldGFjaC4gVGhpcyBmdW5jdGlvbiBjYWxscwotICogY291bnRlcl9yZWdpc3RlciBpbnRlcm5h
bGx5LiBSZWZlciB0byB0aGF0IGZ1bmN0aW9uIGZvciBtb3JlIGluZm9ybWF0aW9uLgotICoKLSAq
IElmIGFuIENvdW50ZXIgcmVnaXN0ZXJlZCB3aXRoIHRoaXMgZnVuY3Rpb24gbmVlZHMgdG8gYmUg
dW5yZWdpc3RlcmVkCi0gKiBzZXBhcmF0ZWx5LCBkZXZtX2NvdW50ZXJfdW5yZWdpc3RlciBtdXN0
IGJlIHVzZWQuCi0gKgotICogUkVUVVJOUzoKLSAqIDAgb24gc3VjY2VzcywgbmVnYXRpdmUgZXJy
b3IgbnVtYmVyIG9uIGZhaWx1cmUuCi0gKi8KLWludCBkZXZtX2NvdW50ZXJfcmVnaXN0ZXIoc3Ry
dWN0IGRldmljZSAqZGV2LAotCQkJICBzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvbnN0IGNvdW50
ZXIpCi17Ci0Jc3RydWN0IGNvdW50ZXJfZGV2aWNlICoqcHRyOwotCWludCByZXQ7Ci0KLQlwdHIg
PSBkZXZyZXNfYWxsb2MoZGV2bV9jb3VudGVyX3VucmVnLCBzaXplb2YoKnB0ciksIEdGUF9LRVJO
RUwpOwotCWlmICghcHRyKQotCQlyZXR1cm4gLUVOT01FTTsKLQotCXJldCA9IGNvdW50ZXJfcmVn
aXN0ZXIoY291bnRlcik7Ci0JaWYgKCFyZXQpIHsKLQkJKnB0ciA9IGNvdW50ZXI7Ci0JCWRldnJl
c19hZGQoZGV2LCBwdHIpOwotCX0gZWxzZSB7Ci0JCWRldnJlc19mcmVlKHB0cik7Ci0JfQotCi0J
cmV0dXJuIHJldDsKLX0KLUVYUE9SVF9TWU1CT0xfR1BMKGRldm1fY291bnRlcl9yZWdpc3Rlcik7
Ci0KLXN0YXRpYyBpbnQgZGV2bV9jb3VudGVyX21hdGNoKHN0cnVjdCBkZXZpY2UgKmRldiwgdm9p
ZCAqcmVzLCB2b2lkICpkYXRhKQotewotCXN0cnVjdCBjb3VudGVyX2RldmljZSAqKnIgPSByZXM7
Ci0KLQlpZiAoIXIgfHwgISpyKSB7Ci0JCVdBUk5fT04oIXIgfHwgISpyKTsKLQkJcmV0dXJuIDA7
Ci0JfQotCi0JcmV0dXJuICpyID09IGRhdGE7Ci19Ci0KLS8qKgotICogZGV2bV9jb3VudGVyX3Vu
cmVnaXN0ZXIgLSBSZXNvdXJjZS1tYW5hZ2VkIGNvdW50ZXJfdW5yZWdpc3RlcgotICogQGRldjoJ
ZGV2aWNlIHRoaXMgY291bnRlcl9kZXZpY2UgYmVsb25ncyB0bwotICogQGNvdW50ZXI6CXBvaW50
ZXIgdG8gQ291bnRlciBhc3NvY2lhdGVkIHdpdGggdGhlIGRldmljZQotICoKLSAqIFVucmVnaXN0
ZXIgQ291bnRlciByZWdpc3RlcmVkIHdpdGggZGV2bV9jb3VudGVyX3JlZ2lzdGVyLgotICovCi12
b2lkIGRldm1fY291bnRlcl91bnJlZ2lzdGVyKHN0cnVjdCBkZXZpY2UgKmRldiwKLQkJCSAgICAg
c3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb25zdCBjb3VudGVyKQotewotCWludCByYzsKLQotCXJj
ID0gZGV2cmVzX3JlbGVhc2UoZGV2LCBkZXZtX2NvdW50ZXJfdW5yZWcsIGRldm1fY291bnRlcl9t
YXRjaCwKLQkJCSAgICBjb3VudGVyKTsKLQlXQVJOX09OKHJjKTsKLX0KLUVYUE9SVF9TWU1CT0xf
R1BMKGRldm1fY291bnRlcl91bnJlZ2lzdGVyKTsKLQotc3RhdGljIGludCBfX2luaXQgY291bnRl
cl9pbml0KHZvaWQpCi17Ci0JcmV0dXJuIGJ1c19yZWdpc3RlcigmY291bnRlcl9idXNfdHlwZSk7
Ci19Ci0KLXN0YXRpYyB2b2lkIF9fZXhpdCBjb3VudGVyX2V4aXQodm9pZCkKLXsKLQlidXNfdW5y
ZWdpc3RlcigmY291bnRlcl9idXNfdHlwZSk7Ci19Ci0KLXN1YnN5c19pbml0Y2FsbChjb3VudGVy
X2luaXQpOwotbW9kdWxlX2V4aXQoY291bnRlcl9leGl0KTsKLQotTU9EVUxFX0FVVEhPUigiV2ls
bGlhbSBCcmVhdGhpdHQgR3JheSA8dmlsaGVsbS5ncmF5QGdtYWlsLmNvbT4iKTsKLU1PRFVMRV9E
RVNDUklQVElPTigiR2VuZXJpYyBDb3VudGVyIGludGVyZmFjZSIpOwotTU9EVUxFX0xJQ0VOU0Uo
IkdQTCB2MiIpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9jb3VudGVyL2Z0bS1xdWFkZGVjLmMgYi9k
cml2ZXJzL2NvdW50ZXIvZnRtLXF1YWRkZWMuYwppbmRleCA1M2MxNWY4NDkwOWIuLjVlZjA0Nzg3
MDljZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9jb3VudGVyL2Z0bS1xdWFkZGVjLmMKKysrIGIvZHJp
dmVycy9jb3VudGVyL2Z0bS1xdWFkZGVjLmMKQEAgLTE0LDYgKzE0LDcgQEAKICNpbmNsdWRlIDxs
aW51eC9tdXRleC5oPgogI2luY2x1ZGUgPGxpbnV4L2NvdW50ZXIuaD4KICNpbmNsdWRlIDxsaW51
eC9iaXRmaWVsZC5oPgorI2luY2x1ZGUgPGxpbnV4L3R5cGVzLmg+CiAKICNkZWZpbmUgRlRNX0ZJ
RUxEX1VQREFURShmdG0sIG9mZnNldCwgbWFzaywgdmFsKQkJCVwKIAkoewkJCQkJCQkJXApAQCAt
MTE1LDggKzExNiw3IEBAIHN0YXRpYyB2b2lkIGZ0bV9xdWFkZGVjX2Rpc2FibGUodm9pZCAqZnRt
KQogfQogCiBzdGF0aWMgaW50IGZ0bV9xdWFkZGVjX2dldF9wcmVzY2FsZXIoc3RydWN0IGNvdW50
ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCSAgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50
LAotCQkJCSAgICAgc2l6ZV90ICpjbnRfbW9kZSkKKwkJCQkgICAgIHN0cnVjdCBjb3VudGVyX2Nv
dW50ICpjb3VudCwgdTMyICpjbnRfbW9kZSkKIHsKIAlzdHJ1Y3QgZnRtX3F1YWRkZWMgKmZ0bSA9
IGNvdW50ZXItPnByaXY7CiAJdWludDMyX3Qgc2NmbGFnczsKQEAgLTEyOSw4ICsxMjksNyBAQCBz
dGF0aWMgaW50IGZ0bV9xdWFkZGVjX2dldF9wcmVzY2FsZXIoc3RydWN0IGNvdW50ZXJfZGV2aWNl
ICpjb3VudGVyLAogfQogCiBzdGF0aWMgaW50IGZ0bV9xdWFkZGVjX3NldF9wcmVzY2FsZXIoc3Ry
dWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCSAgICAgc3RydWN0IGNvdW50ZXJfY291
bnQgKmNvdW50LAotCQkJCSAgICAgc2l6ZV90IGNudF9tb2RlKQorCQkJCSAgICAgc3RydWN0IGNv
dW50ZXJfY291bnQgKmNvdW50LCB1MzIgY250X21vZGUpCiB7CiAJc3RydWN0IGZ0bV9xdWFkZGVj
ICpmdG0gPSBjb3VudGVyLT5wcml2OwogCkBAIC0xNTEsMzMgKzE1MCwxNyBAQCBzdGF0aWMgY29u
c3QgY2hhciAqIGNvbnN0IGZ0bV9xdWFkZGVjX3ByZXNjYWxlcltdID0gewogCSIxIiwgIjIiLCAi
NCIsICI4IiwgIjE2IiwgIjMyIiwgIjY0IiwgIjEyOCIKIH07CiAKLXN0YXRpYyBzdHJ1Y3QgY291
bnRlcl9jb3VudF9lbnVtX2V4dCBmdG1fcXVhZGRlY19wcmVzY2FsZXJfZW51bSA9IHsKLQkuaXRl
bXMgPSBmdG1fcXVhZGRlY19wcmVzY2FsZXIsCi0JLm51bV9pdGVtcyA9IEFSUkFZX1NJWkUoZnRt
X3F1YWRkZWNfcHJlc2NhbGVyKSwKLQkuZ2V0ID0gZnRtX3F1YWRkZWNfZ2V0X3ByZXNjYWxlciwK
LQkuc2V0ID0gZnRtX3F1YWRkZWNfc2V0X3ByZXNjYWxlcgotfTsKLQotZW51bSBmdG1fcXVhZGRl
Y19zeW5hcHNlX2FjdGlvbiB7Ci0JRlRNX1FVQURERUNfU1lOQVBTRV9BQ1RJT05fQk9USF9FREdF
UywKLX07Ci0KIHN0YXRpYyBjb25zdCBlbnVtIGNvdW50ZXJfc3luYXBzZV9hY3Rpb24gZnRtX3F1
YWRkZWNfc3luYXBzZV9hY3Rpb25zW10gPSB7Ci0JW0ZUTV9RVUFEREVDX1NZTkFQU0VfQUNUSU9O
X0JPVEhfRURHRVNdID0KIAlDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX0JPVEhfRURHRVMKIH07CiAK
LWVudW0gZnRtX3F1YWRkZWNfY291bnRfZnVuY3Rpb24gewotCUZUTV9RVUFEREVDX0NPVU5UX0VO
Q09ERVJfTU9ERV8xLAotfTsKLQogc3RhdGljIGNvbnN0IGVudW0gY291bnRlcl9mdW5jdGlvbiBm
dG1fcXVhZGRlY19jb3VudF9mdW5jdGlvbnNbXSA9IHsKLQlbRlRNX1FVQURERUNfQ09VTlRfRU5D
T0RFUl9NT0RFXzFdID0gQ09VTlRFUl9GVU5DVElPTl9RVUFEUkFUVVJFX1g0CisJQ09VTlRFUl9G
VU5DVElPTl9RVUFEUkFUVVJFX1g0CiB9OwogCiBzdGF0aWMgaW50IGZ0bV9xdWFkZGVjX2NvdW50
X3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAogCQkJCSAgc3RydWN0IGNvdW50
ZXJfY291bnQgKmNvdW50LAotCQkJCSAgdW5zaWduZWQgbG9uZyAqdmFsKQorCQkJCSAgdTY0ICp2
YWwpCiB7CiAJc3RydWN0IGZ0bV9xdWFkZGVjICpjb25zdCBmdG0gPSBjb3VudGVyLT5wcml2Owog
CXVpbnQzMl90IGNudHZhbDsKQEAgLTE5MSw3ICsxNzQsNyBAQCBzdGF0aWMgaW50IGZ0bV9xdWFk
ZGVjX2NvdW50X3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAogCiBzdGF0aWMg
aW50IGZ0bV9xdWFkZGVjX2NvdW50X3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRl
ciwKIAkJCQkgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCi0JCQkJICAgY29uc3QgdW5z
aWduZWQgbG9uZyB2YWwpCisJCQkJICAgY29uc3QgdTY0IHZhbCkKIHsKIAlzdHJ1Y3QgZnRtX3F1
YWRkZWMgKmNvbnN0IGZ0bSA9IGNvdW50ZXItPnByaXY7CiAKQEAgLTIwNSwyMSArMTg4LDIxIEBA
IHN0YXRpYyBpbnQgZnRtX3F1YWRkZWNfY291bnRfd3JpdGUoc3RydWN0IGNvdW50ZXJfZGV2aWNl
ICpjb3VudGVyLAogCXJldHVybiAwOwogfQogCi1zdGF0aWMgaW50IGZ0bV9xdWFkZGVjX2NvdW50
X2Z1bmN0aW9uX2dldChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkJCSAgc3Ry
dWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkJCQkgIHNpemVfdCAqZnVuY3Rpb24pCitzdGF0
aWMgaW50IGZ0bV9xdWFkZGVjX2NvdW50X2Z1bmN0aW9uX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2
aWNlICpjb3VudGVyLAorCQkJCQkgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCisJCQkJ
CSAgIGVudW0gY291bnRlcl9mdW5jdGlvbiAqZnVuY3Rpb24pCiB7Ci0JKmZ1bmN0aW9uID0gRlRN
X1FVQURERUNfQ09VTlRfRU5DT0RFUl9NT0RFXzE7CisJKmZ1bmN0aW9uID0gQ09VTlRFUl9GVU5D
VElPTl9RVUFEUkFUVVJFX1g0OwogCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBpbnQgZnRtX3F1
YWRkZWNfYWN0aW9uX2dldChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkJICBz
dHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCi0JCQkJICBzdHJ1Y3QgY291bnRlcl9zeW5hcHNl
ICpzeW5hcHNlLAotCQkJCSAgc2l6ZV90ICphY3Rpb24pCitzdGF0aWMgaW50IGZ0bV9xdWFkZGVj
X2FjdGlvbl9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkgICBzdHJ1
Y3QgY291bnRlcl9jb3VudCAqY291bnQsCisJCQkJICAgc3RydWN0IGNvdW50ZXJfc3luYXBzZSAq
c3luYXBzZSwKKwkJCQkgICBlbnVtIGNvdW50ZXJfc3luYXBzZV9hY3Rpb24gKmFjdGlvbikKIHsK
LQkqYWN0aW9uID0gRlRNX1FVQURERUNfU1lOQVBTRV9BQ1RJT05fQk9USF9FREdFUzsKKwkqYWN0
aW9uID0gQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9CT1RIX0VER0VTOwogCiAJcmV0dXJuIDA7CiB9
CkBAIC0yMjcsOCArMjEwLDggQEAgc3RhdGljIGludCBmdG1fcXVhZGRlY19hY3Rpb25fZ2V0KHN0
cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKIHN0YXRpYyBjb25zdCBzdHJ1Y3QgY291bnRl
cl9vcHMgZnRtX3F1YWRkZWNfY250X29wcyA9IHsKIAkuY291bnRfcmVhZCA9IGZ0bV9xdWFkZGVj
X2NvdW50X3JlYWQsCiAJLmNvdW50X3dyaXRlID0gZnRtX3F1YWRkZWNfY291bnRfd3JpdGUsCi0J
LmZ1bmN0aW9uX2dldCA9IGZ0bV9xdWFkZGVjX2NvdW50X2Z1bmN0aW9uX2dldCwKLQkuYWN0aW9u
X2dldCA9IGZ0bV9xdWFkZGVjX2FjdGlvbl9nZXQsCisJLmZ1bmN0aW9uX3JlYWQgPSBmdG1fcXVh
ZGRlY19jb3VudF9mdW5jdGlvbl9yZWFkLAorCS5hY3Rpb25fcmVhZCA9IGZ0bV9xdWFkZGVjX2Fj
dGlvbl9yZWFkLAogfTsKIAogc3RhdGljIHN0cnVjdCBjb3VudGVyX3NpZ25hbCBmdG1fcXVhZGRl
Y19zaWduYWxzW10gPSB7CkBAIC0yNTUsOSArMjM4LDEyIEBAIHN0YXRpYyBzdHJ1Y3QgY291bnRl
cl9zeW5hcHNlIGZ0bV9xdWFkZGVjX2NvdW50X3N5bmFwc2VzW10gPSB7CiAJfQogfTsKIAotc3Rh
dGljIGNvbnN0IHN0cnVjdCBjb3VudGVyX2NvdW50X2V4dCBmdG1fcXVhZGRlY19jb3VudF9leHRb
XSA9IHsKLQlDT1VOVEVSX0NPVU5UX0VOVU0oInByZXNjYWxlciIsICZmdG1fcXVhZGRlY19wcmVz
Y2FsZXJfZW51bSksCi0JQ09VTlRFUl9DT1VOVF9FTlVNX0FWQUlMQUJMRSgicHJlc2NhbGVyIiwg
JmZ0bV9xdWFkZGVjX3ByZXNjYWxlcl9lbnVtKSwKK3N0YXRpYyBERUZJTkVfQ09VTlRFUl9FTlVN
KGZ0bV9xdWFkZGVjX3ByZXNjYWxlcl9lbnVtLCBmdG1fcXVhZGRlY19wcmVzY2FsZXIpOworCitz
dGF0aWMgc3RydWN0IGNvdW50ZXJfY29tcCBmdG1fcXVhZGRlY19jb3VudF9leHRbXSA9IHsKKwlD
T1VOVEVSX0NPTVBfQ09VTlRfRU5VTSgicHJlc2NhbGVyIiwgZnRtX3F1YWRkZWNfZ2V0X3ByZXNj
YWxlciwKKwkJCQlmdG1fcXVhZGRlY19zZXRfcHJlc2NhbGVyLAorCQkJCWZ0bV9xdWFkZGVjX3By
ZXNjYWxlcl9lbnVtKSwKIH07CiAKIHN0YXRpYyBzdHJ1Y3QgY291bnRlcl9jb3VudCBmdG1fcXVh
ZGRlY19jb3VudHMgPSB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2NvdW50ZXIvaW50ZWwtcWVwLmMg
Yi9kcml2ZXJzL2NvdW50ZXIvaW50ZWwtcWVwLmMKaW5kZXggOGE2ODQ3ZDVmYjJiLi42OTZmNjhi
YzkzYmMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvY291bnRlci9pbnRlbC1xZXAuYworKysgYi9kcml2
ZXJzL2NvdW50ZXIvaW50ZWwtcWVwLmMKQEAgLTYyLDEzICs2Miw2IEBACiAKICNkZWZpbmUgSU5U
RUxfUUVQX0NMS19QRVJJT0RfTlMJCTEwCiAKLSNkZWZpbmUgSU5URUxfUUVQX0NPVU5URVJfRVhU
X1JXKF9uYW1lKQkJCQlcCi17CQkJCQkJCQlcCi0JLm5hbWUgPSAjX25hbWUsCQkJCQkJXAotCS5y
ZWFkID0gX25hbWUjI19yZWFkLAkJCQkJXAotCS53cml0ZSA9IF9uYW1lIyNfd3JpdGUsCQkJCQlc
Ci19Ci0KIHN0cnVjdCBpbnRlbF9xZXAgewogCXN0cnVjdCBjb3VudGVyX2RldmljZSBjb3VudGVy
OwogCXN0cnVjdCBtdXRleCBsb2NrOwpAQCAtMTE0LDggKzEwNyw3IEBAIHN0YXRpYyB2b2lkIGlu
dGVsX3FlcF9pbml0KHN0cnVjdCBpbnRlbF9xZXAgKnFlcCkKIH0KIAogc3RhdGljIGludCBpbnRl
bF9xZXBfY291bnRfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkJc3Ry
dWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkJCXVuc2lnbmVkIGxvbmcgKnZhbCkKKwkJCQlz
dHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHU2NCAqdmFsKQogewogCXN0cnVjdCBpbnRlbF9x
ZXAgKmNvbnN0IHFlcCA9IGNvdW50ZXItPnByaXY7CiAKQEAgLTEzMCwxMSArMTIyLDExIEBAIHN0
YXRpYyBjb25zdCBlbnVtIGNvdW50ZXJfZnVuY3Rpb24gaW50ZWxfcWVwX2NvdW50X2Z1bmN0aW9u
c1tdID0gewogCUNPVU5URVJfRlVOQ1RJT05fUVVBRFJBVFVSRV9YNCwKIH07CiAKLXN0YXRpYyBp
bnQgaW50ZWxfcWVwX2Z1bmN0aW9uX2dldChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIs
Ci0JCQkJICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCi0JCQkJICBzaXplX3QgKmZ1bmN0
aW9uKQorc3RhdGljIGludCBpbnRlbF9xZXBfZnVuY3Rpb25fcmVhZChzdHJ1Y3QgY291bnRlcl9k
ZXZpY2UgKmNvdW50ZXIsCisJCQkJICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAorCQkJ
CSAgIGVudW0gY291bnRlcl9mdW5jdGlvbiAqZnVuY3Rpb24pCiB7Ci0JKmZ1bmN0aW9uID0gMDsK
KwkqZnVuY3Rpb24gPSBDT1VOVEVSX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDQ7CiAKIAlyZXR1cm4g
MDsKIH0KQEAgLTE0MywxOSArMTM1LDE5IEBAIHN0YXRpYyBjb25zdCBlbnVtIGNvdW50ZXJfc3lu
YXBzZV9hY3Rpb24gaW50ZWxfcWVwX3N5bmFwc2VfYWN0aW9uc1tdID0gewogCUNPVU5URVJfU1lO
QVBTRV9BQ1RJT05fQk9USF9FREdFUywKIH07CiAKLXN0YXRpYyBpbnQgaW50ZWxfcWVwX2FjdGlv
bl9nZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCXN0cnVjdCBjb3VudGVy
X2NvdW50ICpjb3VudCwKLQkJCQlzdHJ1Y3QgY291bnRlcl9zeW5hcHNlICpzeW5hcHNlLAotCQkJ
CXNpemVfdCAqYWN0aW9uKQorc3RhdGljIGludCBpbnRlbF9xZXBfYWN0aW9uX3JlYWQoc3RydWN0
IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCSBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291
bnQsCisJCQkJIHN0cnVjdCBjb3VudGVyX3N5bmFwc2UgKnN5bmFwc2UsCisJCQkJIGVudW0gY291
bnRlcl9zeW5hcHNlX2FjdGlvbiAqYWN0aW9uKQogewotCSphY3Rpb24gPSAwOworCSphY3Rpb24g
PSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX0JPVEhfRURHRVM7CiAJcmV0dXJuIDA7CiB9CiAKIHN0
YXRpYyBjb25zdCBzdHJ1Y3QgY291bnRlcl9vcHMgaW50ZWxfcWVwX2NvdW50ZXJfb3BzID0gewog
CS5jb3VudF9yZWFkID0gaW50ZWxfcWVwX2NvdW50X3JlYWQsCi0JLmZ1bmN0aW9uX2dldCA9IGlu
dGVsX3FlcF9mdW5jdGlvbl9nZXQsCi0JLmFjdGlvbl9nZXQgPSBpbnRlbF9xZXBfYWN0aW9uX2dl
dCwKKwkuZnVuY3Rpb25fcmVhZCA9IGludGVsX3FlcF9mdW5jdGlvbl9yZWFkLAorCS5hY3Rpb25f
cmVhZCA9IGludGVsX3FlcF9hY3Rpb25fcmVhZCwKIH07CiAKICNkZWZpbmUgSU5URUxfUUVQX1NJ
R05BTChfaWQsIF9uYW1lKSB7CQkJCVwKQEAgLTE4MSwzMSArMTczLDI3IEBAIHN0YXRpYyBzdHJ1
Y3QgY291bnRlcl9zeW5hcHNlIGludGVsX3FlcF9jb3VudF9zeW5hcHNlc1tdID0gewogCUlOVEVM
X1FFUF9TWU5BUFNFKDIpLAogfTsKIAotc3RhdGljIHNzaXplX3QgY2VpbGluZ19yZWFkKHN0cnVj
dCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCSAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAq
Y291bnQsCi0JCQkgICAgdm9pZCAqcHJpdiwgY2hhciAqYnVmKQorc3RhdGljIGludCBpbnRlbF9x
ZXBfY2VpbGluZ19yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkgIHN0
cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgdTY0ICpjZWlsaW5nKQogewogCXN0cnVjdCBpbnRl
bF9xZXAgKnFlcCA9IGNvdW50ZXItPnByaXY7Ci0JdTMyIHJlZzsKIAogCXBtX3J1bnRpbWVfZ2V0
X3N5bmMocWVwLT5kZXYpOwotCXJlZyA9IGludGVsX3FlcF9yZWFkbChxZXAsIElOVEVMX1FFUE1B
WCk7CisJKmNlaWxpbmcgPSBpbnRlbF9xZXBfcmVhZGwocWVwLCBJTlRFTF9RRVBNQVgpOwogCXBt
X3J1bnRpbWVfcHV0KHFlcC0+ZGV2KTsKIAotCXJldHVybiBzeXNmc19lbWl0KGJ1ZiwgIiV1XG4i
LCByZWcpOworCXJldHVybiAwOwogfQogCi1zdGF0aWMgc3NpemVfdCBjZWlsaW5nX3dyaXRlKHN0
cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCSAgICAgc3RydWN0IGNvdW50ZXJfY291
bnQgKmNvdW50LAotCQkJICAgICB2b2lkICpwcml2LCBjb25zdCBjaGFyICpidWYsIHNpemVfdCBs
ZW4pCitzdGF0aWMgaW50IGludGVsX3FlcF9jZWlsaW5nX3dyaXRlKHN0cnVjdCBjb3VudGVyX2Rl
dmljZSAqY291bnRlciwKKwkJCQkgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHU2NCBt
YXgpCiB7CiAJc3RydWN0IGludGVsX3FlcCAqcWVwID0gY291bnRlci0+cHJpdjsKLQl1MzIgbWF4
OwotCWludCByZXQ7CisJaW50IHJldCA9IDA7CiAKLQlyZXQgPSBrc3RydG91MzIoYnVmLCAwLCAm
bWF4KTsKLQlpZiAocmV0IDwgMCkKLQkJcmV0dXJuIHJldDsKKwkvKiBJbnRlbCBRRVAgY2VpbGlu
ZyBjb25maWd1cmF0aW9uIG9ubHkgc3VwcG9ydHMgMzItYml0IHZhbHVlcyAqLworCWlmIChtYXgg
IT0gKHUzMiltYXgpCisJCXJldHVybiAtRVJBTkdFOwogCiAJbXV0ZXhfbG9jaygmcWVwLT5sb2Nr
KTsKIAlpZiAocWVwLT5lbmFibGVkKSB7CkBAIC0yMTYsMzQgKzIwNCwyOCBAQCBzdGF0aWMgc3Np
emVfdCBjZWlsaW5nX3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKIAlwbV9y
dW50aW1lX2dldF9zeW5jKHFlcC0+ZGV2KTsKIAlpbnRlbF9xZXBfd3JpdGVsKHFlcCwgSU5URUxf
UUVQTUFYLCBtYXgpOwogCXBtX3J1bnRpbWVfcHV0KHFlcC0+ZGV2KTsKLQlyZXQgPSBsZW47CiAK
IG91dDoKIAltdXRleF91bmxvY2soJnFlcC0+bG9jayk7CiAJcmV0dXJuIHJldDsKIH0KIAotc3Rh
dGljIHNzaXplX3QgZW5hYmxlX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAot
CQkJICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkJICAgdm9pZCAqcHJpdiwgY2hh
ciAqYnVmKQorc3RhdGljIGludCBpbnRlbF9xZXBfZW5hYmxlX3JlYWQoc3RydWN0IGNvdW50ZXJf
ZGV2aWNlICpjb3VudGVyLAorCQkJCSBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHU4ICpl
bmFibGUpCiB7CiAJc3RydWN0IGludGVsX3FlcCAqcWVwID0gY291bnRlci0+cHJpdjsKIAotCXJl
dHVybiBzeXNmc19lbWl0KGJ1ZiwgIiV1XG4iLCBxZXAtPmVuYWJsZWQpOworCSplbmFibGUgPSBx
ZXAtPmVuYWJsZWQ7CisKKwlyZXR1cm4gMDsKIH0KIAotc3RhdGljIHNzaXplX3QgZW5hYmxlX3dy
aXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCSAgICBzdHJ1Y3QgY291bnRl
cl9jb3VudCAqY291bnQsCi0JCQkgICAgdm9pZCAqcHJpdiwgY29uc3QgY2hhciAqYnVmLCBzaXpl
X3QgbGVuKQorc3RhdGljIGludCBpbnRlbF9xZXBfZW5hYmxlX3dyaXRlKHN0cnVjdCBjb3VudGVy
X2RldmljZSAqY291bnRlciwKKwkJCQkgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgdTgg
dmFsKQogewogCXN0cnVjdCBpbnRlbF9xZXAgKnFlcCA9IGNvdW50ZXItPnByaXY7CiAJdTMyIHJl
ZzsKLQlib29sIHZhbCwgY2hhbmdlZDsKLQlpbnQgcmV0OwotCi0JcmV0ID0ga3N0cnRvYm9vbChi
dWYsICZ2YWwpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7CisJYm9vbCBjaGFuZ2VkOwogCiAJ
bXV0ZXhfbG9jaygmcWVwLT5sb2NrKTsKIAljaGFuZ2VkID0gdmFsIF4gcWVwLT5lbmFibGVkOwpA
QCAtMjY3LDEyICsyNDksMTIgQEAgc3RhdGljIHNzaXplX3QgZW5hYmxlX3dyaXRlKHN0cnVjdCBj
b3VudGVyX2RldmljZSAqY291bnRlciwKIAogb3V0OgogCW11dGV4X3VubG9jaygmcWVwLT5sb2Nr
KTsKLQlyZXR1cm4gbGVuOworCXJldHVybiAwOwogfQogCi1zdGF0aWMgc3NpemVfdCBzcGlrZV9m
aWx0ZXJfbnNfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkJICAgIHN0
cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKLQkJCQkgICAgdm9pZCAqcHJpdiwgY2hhciAqYnVm
KQorc3RhdGljIGludCBpbnRlbF9xZXBfc3Bpa2VfZmlsdGVyX25zX3JlYWQoc3RydWN0IGNvdW50
ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCQkgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwK
KwkJCQkJICB1NjQgKmxlbmd0aCkKIHsKIAlzdHJ1Y3QgaW50ZWxfcWVwICpxZXAgPSBjb3VudGVy
LT5wcml2OwogCXUzMiByZWc7CkBAIC0yODEsMjYgKzI2MywyNCBAQCBzdGF0aWMgc3NpemVfdCBz
cGlrZV9maWx0ZXJfbnNfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAJcmVn
ID0gaW50ZWxfcWVwX3JlYWRsKHFlcCwgSU5URUxfUUVQQ09OKTsKIAlpZiAoIShyZWcgJiBJTlRF
TF9RRVBDT05fRkxUX0VOKSkgewogCQlwbV9ydW50aW1lX3B1dChxZXAtPmRldik7Ci0JCXJldHVy
biBzeXNmc19lbWl0KGJ1ZiwgIjBcbiIpOworCQlyZXR1cm4gMDsKIAl9CiAJcmVnID0gSU5URUxf
UUVQRkxUX01BWF9DT1VOVChpbnRlbF9xZXBfcmVhZGwocWVwLCBJTlRFTF9RRVBGTFQpKTsKIAlw
bV9ydW50aW1lX3B1dChxZXAtPmRldik7CiAKLQlyZXR1cm4gc3lzZnNfZW1pdChidWYsICIldVxu
IiwgKHJlZyArIDIpICogSU5URUxfUUVQX0NMS19QRVJJT0RfTlMpOworCSpsZW5ndGggPSAocmVn
ICsgMikgKiBJTlRFTF9RRVBfQ0xLX1BFUklPRF9OUzsKKworCXJldHVybiAwOwogfQogCi1zdGF0
aWMgc3NpemVfdCBzcGlrZV9maWx0ZXJfbnNfd3JpdGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpj
b3VudGVyLAotCQkJCSAgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkJCSAgICAg
dm9pZCAqcHJpdiwgY29uc3QgY2hhciAqYnVmLCBzaXplX3QgbGVuKQorc3RhdGljIGludCBpbnRl
bF9xZXBfc3Bpa2VfZmlsdGVyX25zX3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRl
ciwKKwkJCQkJICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAorCQkJCQkgICB1NjQgbGVu
Z3RoKQogewogCXN0cnVjdCBpbnRlbF9xZXAgKnFlcCA9IGNvdW50ZXItPnByaXY7Ci0JdTMyIHJl
ZywgbGVuZ3RoOworCXUzMiByZWc7CiAJYm9vbCBlbmFibGU7Ci0JaW50IHJldDsKLQotCXJldCA9
IGtzdHJ0b3UzMihidWYsIDAsICZsZW5ndGgpOwotCWlmIChyZXQgPCAwKQotCQlyZXR1cm4gcmV0
OworCWludCByZXQgPSAwOwogCiAJLyoKIAkgKiBTcGlrZSBmaWx0ZXIgbGVuZ3RoIGlzIChNQVhf
Q09VTlQgKyAyKSBjbG9jayBwZXJpb2RzLgpAQCAtMzM2LDE2ICszMTYsMTUgQEAgc3RhdGljIHNz
aXplX3Qgc3Bpa2VfZmlsdGVyX25zX3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRl
ciwKIAlpbnRlbF9xZXBfd3JpdGVsKHFlcCwgSU5URUxfUUVQRkxULCBsZW5ndGgpOwogCWludGVs
X3FlcF93cml0ZWwocWVwLCBJTlRFTF9RRVBDT04sIHJlZyk7CiAJcG1fcnVudGltZV9wdXQocWVw
LT5kZXYpOwotCXJldCA9IGxlbjsKIAogb3V0OgogCW11dGV4X3VubG9jaygmcWVwLT5sb2NrKTsK
IAlyZXR1cm4gcmV0OwogfQogCi1zdGF0aWMgc3NpemVfdCBwcmVzZXRfZW5hYmxlX3JlYWQoc3Ry
dWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCSAgc3RydWN0IGNvdW50ZXJfY291bnQg
KmNvdW50LAotCQkJCSAgdm9pZCAqcHJpdiwgY2hhciAqYnVmKQorc3RhdGljIGludCBpbnRlbF9x
ZXBfcHJlc2V0X2VuYWJsZV9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJ
CQkJc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAorCQkJCQl1OCAqcHJlc2V0X2VuYWJsZSkK
IHsKIAlzdHJ1Y3QgaW50ZWxfcWVwICpxZXAgPSBjb3VudGVyLT5wcml2OwogCXUzMiByZWc7CkBA
IC0zNTMsMjEgKzMzMiwxOCBAQCBzdGF0aWMgc3NpemVfdCBwcmVzZXRfZW5hYmxlX3JlYWQoc3Ry
dWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAogCXBtX3J1bnRpbWVfZ2V0X3N5bmMocWVwLT5k
ZXYpOwogCXJlZyA9IGludGVsX3FlcF9yZWFkbChxZXAsIElOVEVMX1FFUENPTik7CiAJcG1fcnVu
dGltZV9wdXQocWVwLT5kZXYpOwotCXJldHVybiBzeXNmc19lbWl0KGJ1ZiwgIiV1XG4iLCAhKHJl
ZyAmIElOVEVMX1FFUENPTl9DT1VOVF9SU1RfTU9ERSkpOworCisJKnByZXNldF9lbmFibGUgPSAh
KHJlZyAmIElOVEVMX1FFUENPTl9DT1VOVF9SU1RfTU9ERSk7CisKKwlyZXR1cm4gMDsKIH0KIAot
c3RhdGljIHNzaXplX3QgcHJlc2V0X2VuYWJsZV93cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2Ug
KmNvdW50ZXIsCi0JCQkJICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkJCSAgIHZv
aWQgKnByaXYsIGNvbnN0IGNoYXIgKmJ1Ziwgc2l6ZV90IGxlbikKK3N0YXRpYyBpbnQgaW50ZWxf
cWVwX3ByZXNldF9lbmFibGVfd3JpdGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAor
CQkJCQkgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB1OCB2YWwpCiB7CiAJc3RydWN0IGlu
dGVsX3FlcCAqcWVwID0gY291bnRlci0+cHJpdjsKIAl1MzIgcmVnOwotCWJvb2wgdmFsOwotCWlu
dCByZXQ7Ci0KLQlyZXQgPSBrc3RydG9ib29sKGJ1ZiwgJnZhbCk7Ci0JaWYgKHJldCkKLQkJcmV0
dXJuIHJldDsKKwlpbnQgcmV0ID0gMDsKIAogCW11dGV4X2xvY2soJnFlcC0+bG9jayk7CiAJaWYg
KHFlcC0+ZW5hYmxlZCkgewpAQCAtMzg0LDcgKzM2MCw2IEBAIHN0YXRpYyBzc2l6ZV90IHByZXNl
dF9lbmFibGVfd3JpdGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAogCiAJaW50ZWxf
cWVwX3dyaXRlbChxZXAsIElOVEVMX1FFUENPTiwgcmVnKTsKIAlwbV9ydW50aW1lX3B1dChxZXAt
PmRldik7Ci0JcmV0ID0gbGVuOwogCiBvdXQ6CiAJbXV0ZXhfdW5sb2NrKCZxZXAtPmxvY2spOwpA
QCAtMzkyLDExICszNjcsMTQgQEAgc3RhdGljIHNzaXplX3QgcHJlc2V0X2VuYWJsZV93cml0ZShz
dHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAJcmV0dXJuIHJldDsKIH0KIAotc3RhdGlj
IGNvbnN0IHN0cnVjdCBjb3VudGVyX2NvdW50X2V4dCBpbnRlbF9xZXBfY291bnRfZXh0W10gPSB7
Ci0JSU5URUxfUUVQX0NPVU5URVJfRVhUX1JXKGNlaWxpbmcpLAotCUlOVEVMX1FFUF9DT1VOVEVS
X0VYVF9SVyhlbmFibGUpLAotCUlOVEVMX1FFUF9DT1VOVEVSX0VYVF9SVyhzcGlrZV9maWx0ZXJf
bnMpLAotCUlOVEVMX1FFUF9DT1VOVEVSX0VYVF9SVyhwcmVzZXRfZW5hYmxlKQorc3RhdGljIHN0
cnVjdCBjb3VudGVyX2NvbXAgaW50ZWxfcWVwX2NvdW50X2V4dFtdID0geworCUNPVU5URVJfQ09N
UF9FTkFCTEUoaW50ZWxfcWVwX2VuYWJsZV9yZWFkLCBpbnRlbF9xZXBfZW5hYmxlX3dyaXRlKSwK
KwlDT1VOVEVSX0NPTVBfQ0VJTElORyhpbnRlbF9xZXBfY2VpbGluZ19yZWFkLCBpbnRlbF9xZXBf
Y2VpbGluZ193cml0ZSksCisJQ09VTlRFUl9DT01QX1BSRVNFVF9FTkFCTEUoaW50ZWxfcWVwX3By
ZXNldF9lbmFibGVfcmVhZCwKKwkJCQkgICBpbnRlbF9xZXBfcHJlc2V0X2VuYWJsZV93cml0ZSks
CisJQ09VTlRFUl9DT01QX0NPVU5UX1U2NCgic3Bpa2VfZmlsdGVyX25zIiwKKwkJCSAgICAgICBp
bnRlbF9xZXBfc3Bpa2VfZmlsdGVyX25zX3JlYWQsCisJCQkgICAgICAgaW50ZWxfcWVwX3NwaWtl
X2ZpbHRlcl9uc193cml0ZSksCiB9OwogCiBzdGF0aWMgc3RydWN0IGNvdW50ZXJfY291bnQgaW50
ZWxfcWVwX2NvdW50ZXJfY291bnRbXSA9IHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvY291bnRlci9p
bnRlcnJ1cHQtY250LmMgYi9kcml2ZXJzL2NvdW50ZXIvaW50ZXJydXB0LWNudC5jCmluZGV4IDFk
ZTQyNDNkYjQ4OC4uODUxNGE4N2ZjYmVlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2NvdW50ZXIvaW50
ZXJydXB0LWNudC5jCisrKyBiL2RyaXZlcnMvY291bnRlci9pbnRlcnJ1cHQtY250LmMKQEAgLTEw
LDYgKzEwLDcgQEAKICNpbmNsdWRlIDxsaW51eC9tb2RfZGV2aWNldGFibGUuaD4KICNpbmNsdWRl
IDxsaW51eC9tb2R1bGUuaD4KICNpbmNsdWRlIDxsaW51eC9wbGF0Zm9ybV9kZXZpY2UuaD4KKyNp
bmNsdWRlIDxsaW51eC90eXBlcy5oPgogCiAjZGVmaW5lIElOVEVSUlVQVF9DTlRfTkFNRSAiaW50
ZXJydXB0LWNudCIKIApAQCAtMzMsMzAgKzM0LDIzIEBAIHN0YXRpYyBpcnFyZXR1cm5fdCBpbnRl
cnJ1cHRfY250X2lzcihpbnQgaXJxLCB2b2lkICpkZXZfaWQpCiAJcmV0dXJuIElSUV9IQU5ETEVE
OwogfQogCi1zdGF0aWMgc3NpemVfdCBpbnRlcnJ1cHRfY250X2VuYWJsZV9yZWFkKHN0cnVjdCBj
b3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQkJIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3Vu
dCwKLQkJCQkJIHZvaWQgKnByaXZhdGUsIGNoYXIgKmJ1ZikKK3N0YXRpYyBpbnQgaW50ZXJydXB0
X2NudF9lbmFibGVfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJICAg
ICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHU4ICplbmFibGUpCiB7CiAJc3RydWN0IGlu
dGVycnVwdF9jbnRfcHJpdiAqcHJpdiA9IGNvdW50ZXItPnByaXY7CiAKLQlyZXR1cm4gc3lzZnNf
ZW1pdChidWYsICIlZFxuIiwgcHJpdi0+ZW5hYmxlZCk7CisJKmVuYWJsZSA9IHByaXYtPmVuYWJs
ZWQ7CisKKwlyZXR1cm4gMDsKIH0KIAotc3RhdGljIHNzaXplX3QgaW50ZXJydXB0X2NudF9lbmFi
bGVfd3JpdGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCQkgIHN0cnVjdCBj
b3VudGVyX2NvdW50ICpjb3VudCwKLQkJCQkJICB2b2lkICpwcml2YXRlLCBjb25zdCBjaGFyICpi
dWYsCi0JCQkJCSAgc2l6ZV90IGxlbikKK3N0YXRpYyBpbnQgaW50ZXJydXB0X2NudF9lbmFibGVf
d3JpdGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCSAgICAgIHN0cnVjdCBj
b3VudGVyX2NvdW50ICpjb3VudCwgdTggZW5hYmxlKQogewogCXN0cnVjdCBpbnRlcnJ1cHRfY250
X3ByaXYgKnByaXYgPSBjb3VudGVyLT5wcml2OwotCWJvb2wgZW5hYmxlOwotCXNzaXplX3QgcmV0
OwotCi0JcmV0ID0ga3N0cnRvYm9vbChidWYsICZlbmFibGUpOwotCWlmIChyZXQpCi0JCXJldHVy
biByZXQ7CiAKIAlpZiAocHJpdi0+ZW5hYmxlZCA9PSBlbmFibGUpCi0JCXJldHVybiBsZW47CisJ
CXJldHVybiAwOwogCiAJaWYgKGVuYWJsZSkgewogCQlwcml2LT5lbmFibGVkID0gdHJ1ZTsKQEAg
LTY2LDMzICs2MCwzMCBAQCBzdGF0aWMgc3NpemVfdCBpbnRlcnJ1cHRfY250X2VuYWJsZV93cml0
ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAJCXByaXYtPmVuYWJsZWQgPSBmYWxz
ZTsKIAl9CiAKLQlyZXR1cm4gbGVuOworCXJldHVybiAwOwogfQogCi1zdGF0aWMgY29uc3Qgc3Ry
dWN0IGNvdW50ZXJfY291bnRfZXh0IGludGVycnVwdF9jbnRfZXh0W10gPSB7Ci0JewotCQkubmFt
ZSA9ICJlbmFibGUiLAotCQkucmVhZCA9IGludGVycnVwdF9jbnRfZW5hYmxlX3JlYWQsCi0JCS53
cml0ZSA9IGludGVycnVwdF9jbnRfZW5hYmxlX3dyaXRlLAotCX0sCitzdGF0aWMgc3RydWN0IGNv
dW50ZXJfY29tcCBpbnRlcnJ1cHRfY250X2V4dFtdID0geworCUNPVU5URVJfQ09NUF9FTkFCTEUo
aW50ZXJydXB0X2NudF9lbmFibGVfcmVhZCwKKwkJCSAgICBpbnRlcnJ1cHRfY250X2VuYWJsZV93
cml0ZSksCiB9OwogCiBzdGF0aWMgY29uc3QgZW51bSBjb3VudGVyX3N5bmFwc2VfYWN0aW9uIGlu
dGVycnVwdF9jbnRfc3luYXBzZV9hY3Rpb25zW10gPSB7CiAJQ09VTlRFUl9TWU5BUFNFX0FDVElP
Tl9SSVNJTkdfRURHRSwKIH07CiAKLXN0YXRpYyBpbnQgaW50ZXJydXB0X2NudF9hY3Rpb25fZ2V0
KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQkgICAgc3RydWN0IGNvdW50ZXJf
Y291bnQgKmNvdW50LAotCQkJCSAgICBzdHJ1Y3QgY291bnRlcl9zeW5hcHNlICpzeW5hcHNlLAot
CQkJCSAgICBzaXplX3QgKmFjdGlvbikKK3N0YXRpYyBpbnQgaW50ZXJydXB0X2NudF9hY3Rpb25f
cmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJICAgICBzdHJ1Y3QgY291
bnRlcl9jb3VudCAqY291bnQsCisJCQkJICAgICBzdHJ1Y3QgY291bnRlcl9zeW5hcHNlICpzeW5h
cHNlLAorCQkJCSAgICAgZW51bSBjb3VudGVyX3N5bmFwc2VfYWN0aW9uICphY3Rpb24pCiB7Ci0J
KmFjdGlvbiA9IDA7CisJKmFjdGlvbiA9IENPVU5URVJfU1lOQVBTRV9BQ1RJT05fUklTSU5HX0VE
R0U7CiAKIAlyZXR1cm4gMDsKIH0KIAogc3RhdGljIGludCBpbnRlcnJ1cHRfY250X3JlYWQoc3Ry
dWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJICAgICAgc3RydWN0IGNvdW50ZXJfY291
bnQgKmNvdW50LCB1bnNpZ25lZCBsb25nICp2YWwpCisJCQkgICAgICBzdHJ1Y3QgY291bnRlcl9j
b3VudCAqY291bnQsIHU2NCAqdmFsKQogewogCXN0cnVjdCBpbnRlcnJ1cHRfY250X3ByaXYgKnBy
aXYgPSBjb3VudGVyLT5wcml2OwogCkBAIC0xMDIsOCArOTMsNyBAQCBzdGF0aWMgaW50IGludGVy
cnVwdF9jbnRfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiB9CiAKIHN0YXRp
YyBpbnQgaW50ZXJydXB0X2NudF93cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIs
Ci0JCQkgICAgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkJICAgICAgIGNvbnN0
IHVuc2lnbmVkIGxvbmcgdmFsKQorCQkJICAgICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3Vu
dCwgY29uc3QgdTY0IHZhbCkKIHsKIAlzdHJ1Y3QgaW50ZXJydXB0X2NudF9wcml2ICpwcml2ID0g
Y291bnRlci0+cHJpdjsKIApAQCAtMTE5LDExICsxMDksMTEgQEAgc3RhdGljIGNvbnN0IGVudW0g
Y291bnRlcl9mdW5jdGlvbiBpbnRlcnJ1cHRfY250X2Z1bmN0aW9uc1tdID0gewogCUNPVU5URVJf
RlVOQ1RJT05fSU5DUkVBU0UsCiB9OwogCi1zdGF0aWMgaW50IGludGVycnVwdF9jbnRfZnVuY3Rp
b25fZ2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQkgICAgICBzdHJ1Y3Qg
Y291bnRlcl9jb3VudCAqY291bnQsCi0JCQkJICAgICAgc2l6ZV90ICpmdW5jdGlvbikKK3N0YXRp
YyBpbnQgaW50ZXJydXB0X2NudF9mdW5jdGlvbl9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAq
Y291bnRlciwKKwkJCQkgICAgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAorCQkJCSAg
ICAgICBlbnVtIGNvdW50ZXJfZnVuY3Rpb24gKmZ1bmN0aW9uKQogewotCSpmdW5jdGlvbiA9IDA7
CisJKmZ1bmN0aW9uID0gQ09VTlRFUl9GVU5DVElPTl9JTkNSRUFTRTsKIAogCXJldHVybiAwOwog
fQpAQCAtMTQ4LDEwICsxMzgsMTAgQEAgc3RhdGljIGludCBpbnRlcnJ1cHRfY250X3NpZ25hbF9y
ZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKIH0KIAogc3RhdGljIGNvbnN0IHN0
cnVjdCBjb3VudGVyX29wcyBpbnRlcnJ1cHRfY250X29wcyA9IHsKLQkuYWN0aW9uX2dldCA9IGlu
dGVycnVwdF9jbnRfYWN0aW9uX2dldCwKKwkuYWN0aW9uX3JlYWQgPSBpbnRlcnJ1cHRfY250X2Fj
dGlvbl9yZWFkLAogCS5jb3VudF9yZWFkID0gaW50ZXJydXB0X2NudF9yZWFkLAogCS5jb3VudF93
cml0ZSA9IGludGVycnVwdF9jbnRfd3JpdGUsCi0JLmZ1bmN0aW9uX2dldCA9IGludGVycnVwdF9j
bnRfZnVuY3Rpb25fZ2V0LAorCS5mdW5jdGlvbl9yZWFkID0gaW50ZXJydXB0X2NudF9mdW5jdGlv
bl9yZWFkLAogCS5zaWduYWxfcmVhZCAgPSBpbnRlcnJ1cHRfY250X3NpZ25hbF9yZWFkLAogfTsK
IApkaWZmIC0tZ2l0IGEvZHJpdmVycy9jb3VudGVyL21pY3JvY2hpcC10Y2ItY2FwdHVyZS5jIGIv
ZHJpdmVycy9jb3VudGVyL21pY3JvY2hpcC10Y2ItY2FwdHVyZS5jCmluZGV4IDFhYTcwYjljNDgz
My4uNzllMGM4NGEzYjgxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2NvdW50ZXIvbWljcm9jaGlwLXRj
Yi1jYXB0dXJlLmMKKysrIGIvZHJpdmVycy9jb3VudGVyL21pY3JvY2hpcC10Y2ItY2FwdHVyZS5j
CkBAIC0zMiwyOCArMzIsMTYgQEAgc3RydWN0IG1jaHBfdGNfZGF0YSB7CiAJYm9vbCB0cmlnX2lu
dmVydGVkOwogfTsKIAotZW51bSBtY2hwX3RjX2NvdW50X2Z1bmN0aW9uIHsKLQlNQ0hQX1RDX0ZV
TkNUSU9OX0lOQ1JFQVNFLAotCU1DSFBfVENfRlVOQ1RJT05fUVVBRFJBVFVSRSwKLX07Ci0KIHN0
YXRpYyBjb25zdCBlbnVtIGNvdW50ZXJfZnVuY3Rpb24gbWNocF90Y19jb3VudF9mdW5jdGlvbnNb
XSA9IHsKLQlbTUNIUF9UQ19GVU5DVElPTl9JTkNSRUFTRV0gPSBDT1VOVEVSX0ZVTkNUSU9OX0lO
Q1JFQVNFLAotCVtNQ0hQX1RDX0ZVTkNUSU9OX1FVQURSQVRVUkVdID0gQ09VTlRFUl9GVU5DVElP
Tl9RVUFEUkFUVVJFX1g0LAotfTsKLQotZW51bSBtY2hwX3RjX3N5bmFwc2VfYWN0aW9uIHsKLQlN
Q0hQX1RDX1NZTkFQU0VfQUNUSU9OX05PTkUgPSAwLAotCU1DSFBfVENfU1lOQVBTRV9BQ1RJT05f
UklTSU5HX0VER0UsCi0JTUNIUF9UQ19TWU5BUFNFX0FDVElPTl9GQUxMSU5HX0VER0UsCi0JTUNI
UF9UQ19TWU5BUFNFX0FDVElPTl9CT1RIX0VER0UKKwlDT1VOVEVSX0ZVTkNUSU9OX0lOQ1JFQVNF
LAorCUNPVU5URVJfRlVOQ1RJT05fUVVBRFJBVFVSRV9YNCwKIH07CiAKIHN0YXRpYyBjb25zdCBl
bnVtIGNvdW50ZXJfc3luYXBzZV9hY3Rpb24gbWNocF90Y19zeW5hcHNlX2FjdGlvbnNbXSA9IHsK
LQlbTUNIUF9UQ19TWU5BUFNFX0FDVElPTl9OT05FXSA9IENPVU5URVJfU1lOQVBTRV9BQ1RJT05f
Tk9ORSwKLQlbTUNIUF9UQ19TWU5BUFNFX0FDVElPTl9SSVNJTkdfRURHRV0gPSBDT1VOVEVSX1NZ
TkFQU0VfQUNUSU9OX1JJU0lOR19FREdFLAotCVtNQ0hQX1RDX1NZTkFQU0VfQUNUSU9OX0ZBTExJ
TkdfRURHRV0gPSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX0ZBTExJTkdfRURHRSwKLQlbTUNIUF9U
Q19TWU5BUFNFX0FDVElPTl9CT1RIX0VER0VdID0gQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9CT1RI
X0VER0VTLAorCUNPVU5URVJfU1lOQVBTRV9BQ1RJT05fTk9ORSwKKwlDT1VOVEVSX1NZTkFQU0Vf
QUNUSU9OX1JJU0lOR19FREdFLAorCUNPVU5URVJfU1lOQVBTRV9BQ1RJT05fRkFMTElOR19FREdF
LAorCUNPVU5URVJfU1lOQVBTRV9BQ1RJT05fQk9USF9FREdFUywKIH07CiAKIHN0YXRpYyBzdHJ1
Y3QgY291bnRlcl9zaWduYWwgbWNocF90Y19jb3VudF9zaWduYWxzW10gPSB7CkBAIC04MCwyMyAr
NjgsMjMgQEAgc3RhdGljIHN0cnVjdCBjb3VudGVyX3N5bmFwc2UgbWNocF90Y19jb3VudF9zeW5h
cHNlc1tdID0gewogCX0KIH07CiAKLXN0YXRpYyBpbnQgbWNocF90Y19jb3VudF9mdW5jdGlvbl9n
ZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCSAgICAgIHN0cnVjdCBjb3Vu
dGVyX2NvdW50ICpjb3VudCwKLQkJCQkgICAgICBzaXplX3QgKmZ1bmN0aW9uKQorc3RhdGljIGlu
dCBtY2hwX3RjX2NvdW50X2Z1bmN0aW9uX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3Vu
dGVyLAorCQkJCSAgICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCisJCQkJICAgICAg
IGVudW0gY291bnRlcl9mdW5jdGlvbiAqZnVuY3Rpb24pCiB7CiAJc3RydWN0IG1jaHBfdGNfZGF0
YSAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7CiAKIAlpZiAocHJpdi0+cWRlY19tb2RlKQot
CQkqZnVuY3Rpb24gPSBNQ0hQX1RDX0ZVTkNUSU9OX1FVQURSQVRVUkU7CisJCSpmdW5jdGlvbiA9
IENPVU5URVJfRlVOQ1RJT05fUVVBRFJBVFVSRV9YNDsKIAllbHNlCi0JCSpmdW5jdGlvbiA9IE1D
SFBfVENfRlVOQ1RJT05fSU5DUkVBU0U7CisJCSpmdW5jdGlvbiA9IENPVU5URVJfRlVOQ1RJT05f
SU5DUkVBU0U7CiAKIAlyZXR1cm4gMDsKIH0KIAotc3RhdGljIGludCBtY2hwX3RjX2NvdW50X2Z1
bmN0aW9uX3NldChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkJICAgICAgc3Ry
dWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkJCSAgICAgIHNpemVfdCBmdW5jdGlvbikKK3N0
YXRpYyBpbnQgbWNocF90Y19jb3VudF9mdW5jdGlvbl93cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZp
Y2UgKmNvdW50ZXIsCisJCQkJCXN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKKwkJCQkJZW51
bSBjb3VudGVyX2Z1bmN0aW9uIGZ1bmN0aW9uKQogewogCXN0cnVjdCBtY2hwX3RjX2RhdGEgKmNv
bnN0IHByaXYgPSBjb3VudGVyLT5wcml2OwogCXUzMiBibXIsIGNtcjsKQEAgLTEwOCw3ICs5Niw3
IEBAIHN0YXRpYyBpbnQgbWNocF90Y19jb3VudF9mdW5jdGlvbl9zZXQoc3RydWN0IGNvdW50ZXJf
ZGV2aWNlICpjb3VudGVyLAogCWNtciAmPSB+QVRNRUxfVENfV0FWRTsKIAogCXN3aXRjaCAoZnVu
Y3Rpb24pIHsKLQljYXNlIE1DSFBfVENfRlVOQ1RJT05fSU5DUkVBU0U6CisJY2FzZSBDT1VOVEVS
X0ZVTkNUSU9OX0lOQ1JFQVNFOgogCQlwcml2LT5xZGVjX21vZGUgPSAwOwogCQkvKiBTZXQgaGln
aGVzdCByYXRlIGJhc2VkIG9uIHdoZXRoZXIgc29jIGhhcyBnY2xrIG9yIG5vdCAqLwogCQlibXIg
Jj0gfihBVE1FTF9UQ19RREVOIHwgQVRNRUxfVENfUE9TRU4pOwpAQCAtMTIwLDcgKzEwOCw3IEBA
IHN0YXRpYyBpbnQgbWNocF90Y19jb3VudF9mdW5jdGlvbl9zZXQoc3RydWN0IGNvdW50ZXJfZGV2
aWNlICpjb3VudGVyLAogCQljbXIgfD0gIEFUTUVMX1RDX0NNUl9NQVNLOwogCQljbXIgJj0gfihB
VE1FTF9UQ19BQkVUUkcgfCBBVE1FTF9UQ19YQzApOwogCQlicmVhazsKLQljYXNlIE1DSFBfVENf
RlVOQ1RJT05fUVVBRFJBVFVSRToKKwljYXNlIENPVU5URVJfRlVOQ1RJT05fUVVBRFJBVFVSRV9Y
NDoKIAkJaWYgKCFwcml2LT50Y19jZmctPmhhc19xZGVjKQogCQkJcmV0dXJuIC1FSU5WQUw7CiAJ
CS8qIEluIFFERUMgbW9kZSBzZXR0aW5ncyBib3RoIGNoYW5uZWxzIDAgYW5kIDEgYXJlIHJlcXVp
cmVkICovCkBAIC0xNzYsMTAgKzE2NCwxMCBAQCBzdGF0aWMgaW50IG1jaHBfdGNfY291bnRfc2ln
bmFsX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAogCXJldHVybiAwOwogfQog
Ci1zdGF0aWMgaW50IG1jaHBfdGNfY291bnRfYWN0aW9uX2dldChzdHJ1Y3QgY291bnRlcl9kZXZp
Y2UgKmNvdW50ZXIsCi0JCQkJICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKLQkJCQkg
ICAgc3RydWN0IGNvdW50ZXJfc3luYXBzZSAqc3luYXBzZSwKLQkJCQkgICAgc2l6ZV90ICphY3Rp
b24pCitzdGF0aWMgaW50IG1jaHBfdGNfY291bnRfYWN0aW9uX3JlYWQoc3RydWN0IGNvdW50ZXJf
ZGV2aWNlICpjb3VudGVyLAorCQkJCSAgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAor
CQkJCSAgICAgc3RydWN0IGNvdW50ZXJfc3luYXBzZSAqc3luYXBzZSwKKwkJCQkgICAgIGVudW0g
Y291bnRlcl9zeW5hcHNlX2FjdGlvbiAqYWN0aW9uKQogewogCXN0cnVjdCBtY2hwX3RjX2RhdGEg
KmNvbnN0IHByaXYgPSBjb3VudGVyLT5wcml2OwogCXUzMiBjbXI7CkBAIC0xODgsMjYgKzE3Niwy
NiBAQCBzdGF0aWMgaW50IG1jaHBfdGNfY291bnRfYWN0aW9uX2dldChzdHJ1Y3QgY291bnRlcl9k
ZXZpY2UgKmNvdW50ZXIsCiAKIAlzd2l0Y2ggKGNtciAmIEFUTUVMX1RDX0VUUkdFREcpIHsKIAlk
ZWZhdWx0OgotCQkqYWN0aW9uID0gTUNIUF9UQ19TWU5BUFNFX0FDVElPTl9OT05FOworCQkqYWN0
aW9uID0gQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9OT05FOwogCQlicmVhazsKIAljYXNlIEFUTUVM
X1RDX0VUUkdFREdfUklTSU5HOgotCQkqYWN0aW9uID0gTUNIUF9UQ19TWU5BUFNFX0FDVElPTl9S
SVNJTkdfRURHRTsKKwkJKmFjdGlvbiA9IENPVU5URVJfU1lOQVBTRV9BQ1RJT05fUklTSU5HX0VE
R0U7CiAJCWJyZWFrOwogCWNhc2UgQVRNRUxfVENfRVRSR0VER19GQUxMSU5HOgotCQkqYWN0aW9u
ID0gTUNIUF9UQ19TWU5BUFNFX0FDVElPTl9GQUxMSU5HX0VER0U7CisJCSphY3Rpb24gPSBDT1VO
VEVSX1NZTkFQU0VfQUNUSU9OX0ZBTExJTkdfRURHRTsKIAkJYnJlYWs7CiAJY2FzZSBBVE1FTF9U
Q19FVFJHRURHX0JPVEg6Ci0JCSphY3Rpb24gPSBNQ0hQX1RDX1NZTkFQU0VfQUNUSU9OX0JPVEhf
RURHRTsKKwkJKmFjdGlvbiA9IENPVU5URVJfU1lOQVBTRV9BQ1RJT05fQk9USF9FREdFUzsKIAkJ
YnJlYWs7CiAJfQogCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBpbnQgbWNocF90Y19jb3VudF9h
Y3Rpb25fc2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQkgICAgc3RydWN0
IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkJCSAgICBzdHJ1Y3QgY291bnRlcl9zeW5hcHNlICpz
eW5hcHNlLAotCQkJCSAgICBzaXplX3QgYWN0aW9uKQorc3RhdGljIGludCBtY2hwX3RjX2NvdW50
X2FjdGlvbl93cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJICAgICAg
c3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAorCQkJCSAgICAgIHN0cnVjdCBjb3VudGVyX3N5
bmFwc2UgKnN5bmFwc2UsCisJCQkJICAgICAgZW51bSBjb3VudGVyX3N5bmFwc2VfYWN0aW9uIGFj
dGlvbikKIHsKIAlzdHJ1Y3QgbWNocF90Y19kYXRhICpjb25zdCBwcml2ID0gY291bnRlci0+cHJp
djsKIAl1MzIgZWRnZSA9IEFUTUVMX1RDX0VUUkdFREdfTk9ORTsKQEAgLTIxNywxNiArMjA1LDE2
IEBAIHN0YXRpYyBpbnQgbWNocF90Y19jb3VudF9hY3Rpb25fc2V0KHN0cnVjdCBjb3VudGVyX2Rl
dmljZSAqY291bnRlciwKIAkJcmV0dXJuIC1FSU5WQUw7CiAKIAlzd2l0Y2ggKGFjdGlvbikgewot
CWNhc2UgTUNIUF9UQ19TWU5BUFNFX0FDVElPTl9OT05FOgorCWNhc2UgQ09VTlRFUl9TWU5BUFNF
X0FDVElPTl9OT05FOgogCQllZGdlID0gQVRNRUxfVENfRVRSR0VER19OT05FOwogCQlicmVhazsK
LQljYXNlIE1DSFBfVENfU1lOQVBTRV9BQ1RJT05fUklTSU5HX0VER0U6CisJY2FzZSBDT1VOVEVS
X1NZTkFQU0VfQUNUSU9OX1JJU0lOR19FREdFOgogCQllZGdlID0gQVRNRUxfVENfRVRSR0VER19S
SVNJTkc7CiAJCWJyZWFrOwotCWNhc2UgTUNIUF9UQ19TWU5BUFNFX0FDVElPTl9GQUxMSU5HX0VE
R0U6CisJY2FzZSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX0ZBTExJTkdfRURHRToKIAkJZWRnZSA9
IEFUTUVMX1RDX0VUUkdFREdfRkFMTElORzsKIAkJYnJlYWs7Ci0JY2FzZSBNQ0hQX1RDX1NZTkFQ
U0VfQUNUSU9OX0JPVEhfRURHRToKKwljYXNlIENPVU5URVJfU1lOQVBTRV9BQ1RJT05fQk9USF9F
REdFUzoKIAkJZWRnZSA9IEFUTUVMX1RDX0VUUkdFREdfQk9USDsKIAkJYnJlYWs7CiAJZGVmYXVs
dDoKQEAgLTI0MCw4ICsyMjgsNyBAQCBzdGF0aWMgaW50IG1jaHBfdGNfY291bnRfYWN0aW9uX3Nl
dChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiB9CiAKIHN0YXRpYyBpbnQgbWNocF90
Y19jb3VudF9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCSAgICAgIHN0
cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKLQkJCSAgICAgIHVuc2lnbmVkIGxvbmcgKnZhbCkK
KwkJCSAgICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgdTY0ICp2YWwpCiB7CiAJc3Ry
dWN0IG1jaHBfdGNfZGF0YSAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7CiAJdTMyIGNudDsK
QEAgLTI2NCwxMiArMjUxLDEyIEBAIHN0YXRpYyBzdHJ1Y3QgY291bnRlcl9jb3VudCBtY2hwX3Rj
X2NvdW50c1tdID0gewogfTsKIAogc3RhdGljIGNvbnN0IHN0cnVjdCBjb3VudGVyX29wcyBtY2hw
X3RjX29wcyA9IHsKLQkuc2lnbmFsX3JlYWQgID0gbWNocF90Y19jb3VudF9zaWduYWxfcmVhZCwK
LQkuY291bnRfcmVhZCAgID0gbWNocF90Y19jb3VudF9yZWFkLAotCS5mdW5jdGlvbl9nZXQgPSBt
Y2hwX3RjX2NvdW50X2Z1bmN0aW9uX2dldCwKLQkuZnVuY3Rpb25fc2V0ID0gbWNocF90Y19jb3Vu
dF9mdW5jdGlvbl9zZXQsCi0JLmFjdGlvbl9nZXQgICA9IG1jaHBfdGNfY291bnRfYWN0aW9uX2dl
dCwKLQkuYWN0aW9uX3NldCAgID0gbWNocF90Y19jb3VudF9hY3Rpb25fc2V0CisJLnNpZ25hbF9y
ZWFkICAgID0gbWNocF90Y19jb3VudF9zaWduYWxfcmVhZCwKKwkuY291bnRfcmVhZCAgICAgPSBt
Y2hwX3RjX2NvdW50X3JlYWQsCisJLmZ1bmN0aW9uX3JlYWQgID0gbWNocF90Y19jb3VudF9mdW5j
dGlvbl9yZWFkLAorCS5mdW5jdGlvbl93cml0ZSA9IG1jaHBfdGNfY291bnRfZnVuY3Rpb25fd3Jp
dGUsCisJLmFjdGlvbl9yZWFkICAgID0gbWNocF90Y19jb3VudF9hY3Rpb25fcmVhZCwKKwkuYWN0
aW9uX3dyaXRlICAgPSBtY2hwX3RjX2NvdW50X2FjdGlvbl93cml0ZQogfTsKIAogc3RhdGljIGNv
bnN0IHN0cnVjdCBhdG1lbF90Y2JfY29uZmlnIHRjYl9ybTkyMDBfY29uZmlnID0gewpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9jb3VudGVyL3N0bTMyLWxwdGltZXItY250LmMgYi9kcml2ZXJzL2NvdW50
ZXIvc3RtMzItbHB0aW1lci1jbnQuYwppbmRleCAxMzY1Njk1N2M0NWYuLjIzZDQzYjcxZjllNCAx
MDA2NDQKLS0tIGEvZHJpdmVycy9jb3VudGVyL3N0bTMyLWxwdGltZXItY250LmMKKysrIGIvZHJp
dmVycy9jb3VudGVyL3N0bTMyLWxwdGltZXItY250LmMKQEAgLTE3LDYgKzE3LDcgQEAKICNpbmNs
dWRlIDxsaW51eC9tb2R1bGUuaD4KICNpbmNsdWRlIDxsaW51eC9waW5jdHJsL2NvbnN1bWVyLmg+
CiAjaW5jbHVkZSA8bGludXgvcGxhdGZvcm1fZGV2aWNlLmg+CisjaW5jbHVkZSA8bGludXgvdHlw
ZXMuaD4KIAogc3RydWN0IHN0bTMyX2xwdGltX2NudCB7CiAJc3RydWN0IGNvdW50ZXJfZGV2aWNl
IGNvdW50ZXI7CkBAIC0xMDcsMTEgKzEwOCw3IEBAIHN0YXRpYyBpbnQgc3RtMzJfbHB0aW1fc2V0
dXAoc3RydWN0IHN0bTMyX2xwdGltX2NudCAqcHJpdiwgaW50IGVuYWJsZSkKIAlyZXR1cm4gcmVn
bWFwX3VwZGF0ZV9iaXRzKHByaXYtPnJlZ21hcCwgU1RNMzJfTFBUSU1fQ0ZHUiwgbWFzaywgdmFs
KTsKIH0KIAotLyoqCi0gKiBlbnVtIHN0bTMyX2xwdGltX2NudF9mdW5jdGlvbiAtIGVudW1lcmF0
ZXMgTFBUaW1lciBjb3VudGVyICYgZW5jb2RlciBtb2RlcwotICogQFNUTTMyX0xQVElNX0NPVU5U
RVJfSU5DUkVBU0U6IHVwIGNvdW50IG9uIElOMSByaXNpbmcsIGZhbGxpbmcgb3IgYm90aCBlZGdl
cwotICogQFNUTTMyX0xQVElNX0VOQ09ERVJfQk9USF9FREdFOiBjb3VudCBvbiBib3RoIGVkZ2Vz
IChJTjEgJiBJTjIgcXVhZHJhdHVyZSkKLSAqCisvKgogICogSW4gbm9uLXF1YWRyYXR1cmUgbW9k
ZSwgZGV2aWNlIGNvdW50cyB1cCBvbiBhY3RpdmUgZWRnZS4KICAqIEluIHF1YWRyYXR1cmUgbW9k
ZSwgZW5jb2RlciBjb3VudGluZyBzY2VuYXJpb3MgYXJlIGFzIGZvbGxvd3M6CiAgKiArLS0tLS0t
LS0tKy0tLS0tLS0tLS0rLS0tLS0tLS0tLS0tLS0tLS0tLS0rLS0tLS0tLS0tLS0tLS0tLS0tLS0r
CkBAIC0xMjksMzMgKzEyNiwyMCBAQCBzdGF0aWMgaW50IHN0bTMyX2xwdGltX3NldHVwKHN0cnVj
dCBzdG0zMl9scHRpbV9jbnQgKnByaXYsIGludCBlbmFibGUpCiAgKiB8IGVkZ2VzICAgfCBMb3cg
IC0+ICB8ICAgVXAgICAgIHwgICBEb3duICB8ICAgRG93biAgIHwgICBVcCAgICB8CiAgKiArLS0t
LS0tLS0tKy0tLS0tLS0tLS0rLS0tLS0tLS0tLSstLS0tLS0tLS0rLS0tLS0tLS0tLSstLS0tLS0t
LS0rCiAgKi8KLWVudW0gc3RtMzJfbHB0aW1fY250X2Z1bmN0aW9uIHsKLQlTVE0zMl9MUFRJTV9D
T1VOVEVSX0lOQ1JFQVNFLAotCVNUTTMyX0xQVElNX0VOQ09ERVJfQk9USF9FREdFLAotfTsKLQog
c3RhdGljIGNvbnN0IGVudW0gY291bnRlcl9mdW5jdGlvbiBzdG0zMl9scHRpbV9jbnRfZnVuY3Rp
b25zW10gPSB7Ci0JW1NUTTMyX0xQVElNX0NPVU5URVJfSU5DUkVBU0VdID0gQ09VTlRFUl9GVU5D
VElPTl9JTkNSRUFTRSwKLQlbU1RNMzJfTFBUSU1fRU5DT0RFUl9CT1RIX0VER0VdID0gQ09VTlRF
Ul9GVU5DVElPTl9RVUFEUkFUVVJFX1g0LAotfTsKLQotZW51bSBzdG0zMl9scHRpbV9zeW5hcHNl
X2FjdGlvbiB7Ci0JU1RNMzJfTFBUSU1fU1lOQVBTRV9BQ1RJT05fUklTSU5HX0VER0UsCi0JU1RN
MzJfTFBUSU1fU1lOQVBTRV9BQ1RJT05fRkFMTElOR19FREdFLAotCVNUTTMyX0xQVElNX1NZTkFQ
U0VfQUNUSU9OX0JPVEhfRURHRVMsCi0JU1RNMzJfTFBUSU1fU1lOQVBTRV9BQ1RJT05fTk9ORSwK
KwlDT1VOVEVSX0ZVTkNUSU9OX0lOQ1JFQVNFLAorCUNPVU5URVJfRlVOQ1RJT05fUVVBRFJBVFVS
RV9YNCwKIH07CiAKIHN0YXRpYyBjb25zdCBlbnVtIGNvdW50ZXJfc3luYXBzZV9hY3Rpb24gc3Rt
MzJfbHB0aW1fY250X3N5bmFwc2VfYWN0aW9uc1tdID0gewotCS8qIEluZGV4IG11c3QgbWF0Y2gg
d2l0aCBzdG0zMl9scHRpbV9jbnRfcG9sYXJpdHlbXSAocHJpdi0+cG9sYXJpdHkpICovCi0JW1NU
TTMyX0xQVElNX1NZTkFQU0VfQUNUSU9OX1JJU0lOR19FREdFXSA9IENPVU5URVJfU1lOQVBTRV9B
Q1RJT05fUklTSU5HX0VER0UsCi0JW1NUTTMyX0xQVElNX1NZTkFQU0VfQUNUSU9OX0ZBTExJTkdf
RURHRV0gPSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX0ZBTExJTkdfRURHRSwKLQlbU1RNMzJfTFBU
SU1fU1lOQVBTRV9BQ1RJT05fQk9USF9FREdFU10gPSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX0JP
VEhfRURHRVMsCi0JW1NUTTMyX0xQVElNX1NZTkFQU0VfQUNUSU9OX05PTkVdID0gQ09VTlRFUl9T
WU5BUFNFX0FDVElPTl9OT05FLAorCUNPVU5URVJfU1lOQVBTRV9BQ1RJT05fUklTSU5HX0VER0Us
CisJQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9GQUxMSU5HX0VER0UsCisJQ09VTlRFUl9TWU5BUFNF
X0FDVElPTl9CT1RIX0VER0VTLAorCUNPVU5URVJfU1lOQVBTRV9BQ1RJT05fTk9ORSwKIH07CiAK
IHN0YXRpYyBpbnQgc3RtMzJfbHB0aW1fY250X3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpj
b3VudGVyLAotCQkJCXN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgdW5zaWduZWQgbG9uZyAq
dmFsKQorCQkJCXN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgdTY0ICp2YWwpCiB7CiAJc3Ry
dWN0IHN0bTMyX2xwdGltX2NudCAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7CiAJdTMyIGNu
dDsKQEAgLTE3MCwyOCArMTU0LDI4IEBAIHN0YXRpYyBpbnQgc3RtMzJfbHB0aW1fY250X3JlYWQo
c3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAogCXJldHVybiAwOwogfQogCi1zdGF0aWMg
aW50IHN0bTMyX2xwdGltX2NudF9mdW5jdGlvbl9nZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpj
b3VudGVyLAotCQkJCQlzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCi0JCQkJCXNpemVfdCAq
ZnVuY3Rpb24pCitzdGF0aWMgaW50IHN0bTMyX2xwdGltX2NudF9mdW5jdGlvbl9yZWFkKHN0cnVj
dCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkJIHN0cnVjdCBjb3VudGVyX2NvdW50ICpj
b3VudCwKKwkJCQkJIGVudW0gY291bnRlcl9mdW5jdGlvbiAqZnVuY3Rpb24pCiB7CiAJc3RydWN0
IHN0bTMyX2xwdGltX2NudCAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7CiAKIAlpZiAoIXBy
aXYtPnF1YWRyYXR1cmVfbW9kZSkgewotCQkqZnVuY3Rpb24gPSBTVE0zMl9MUFRJTV9DT1VOVEVS
X0lOQ1JFQVNFOworCQkqZnVuY3Rpb24gPSBDT1VOVEVSX0ZVTkNUSU9OX0lOQ1JFQVNFOwogCQly
ZXR1cm4gMDsKIAl9CiAKLQlpZiAocHJpdi0+cG9sYXJpdHkgPT0gU1RNMzJfTFBUSU1fU1lOQVBT
RV9BQ1RJT05fQk9USF9FREdFUykgewotCQkqZnVuY3Rpb24gPSBTVE0zMl9MUFRJTV9FTkNPREVS
X0JPVEhfRURHRTsKKwlpZiAocHJpdi0+cG9sYXJpdHkgPT0gMikgeworCQkqZnVuY3Rpb24gPSBD
T1VOVEVSX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDQ7CiAJCXJldHVybiAwOwogCX0KIAogCXJldHVy
biAtRUlOVkFMOwogfQogCi1zdGF0aWMgaW50IHN0bTMyX2xwdGltX2NudF9mdW5jdGlvbl9zZXQo
c3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCQlzdHJ1Y3QgY291bnRlcl9jb3Vu
dCAqY291bnQsCi0JCQkJCXNpemVfdCBmdW5jdGlvbikKK3N0YXRpYyBpbnQgc3RtMzJfbHB0aW1f
Y250X2Z1bmN0aW9uX3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkJ
ICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCisJCQkJCSAgZW51bSBjb3VudGVyX2Z1bmN0
aW9uIGZ1bmN0aW9uKQogewogCXN0cnVjdCBzdG0zMl9scHRpbV9jbnQgKmNvbnN0IHByaXYgPSBj
b3VudGVyLT5wcml2OwogCkBAIC0xOTksMTIgKzE4MywxMiBAQCBzdGF0aWMgaW50IHN0bTMyX2xw
dGltX2NudF9mdW5jdGlvbl9zZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAogCQly
ZXR1cm4gLUVCVVNZOwogCiAJc3dpdGNoIChmdW5jdGlvbikgewotCWNhc2UgU1RNMzJfTFBUSU1f
Q09VTlRFUl9JTkNSRUFTRToKKwljYXNlIENPVU5URVJfRlVOQ1RJT05fSU5DUkVBU0U6CiAJCXBy
aXYtPnF1YWRyYXR1cmVfbW9kZSA9IDA7CiAJCXJldHVybiAwOwotCWNhc2UgU1RNMzJfTFBUSU1f
RU5DT0RFUl9CT1RIX0VER0U6CisJY2FzZSBDT1VOVEVSX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDQ6
CiAJCXByaXYtPnF1YWRyYXR1cmVfbW9kZSA9IDE7Ci0JCXByaXYtPnBvbGFyaXR5ID0gU1RNMzJf
TFBUSU1fU1lOQVBTRV9BQ1RJT05fQk9USF9FREdFUzsKKwkJcHJpdi0+cG9sYXJpdHkgPSAyOwog
CQlyZXR1cm4gMDsKIAlkZWZhdWx0OgogCQkvKiBzaG91bGQgbmV2ZXIgcmVhY2ggdGhpcyBwYXRo
ICovCkBAIC0yMTIsOSArMTk2LDkgQEAgc3RhdGljIGludCBzdG0zMl9scHRpbV9jbnRfZnVuY3Rp
b25fc2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKIAl9CiB9CiAKLXN0YXRpYyBz
c2l6ZV90IHN0bTMyX2xwdGltX2NudF9lbmFibGVfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2Ug
KmNvdW50ZXIsCi0JCQkJCSAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKLQkJCQkJICAg
dm9pZCAqcHJpdmF0ZSwgY2hhciAqYnVmKQorc3RhdGljIGludCBzdG0zMl9scHRpbV9jbnRfZW5h
YmxlX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCSAgICAgICBzdHJ1
Y3QgY291bnRlcl9jb3VudCAqY291bnQsCisJCQkJICAgICAgIHU4ICplbmFibGUpCiB7CiAJc3Ry
dWN0IHN0bTMyX2xwdGltX2NudCAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7CiAJaW50IHJl
dDsKQEAgLTIyMywyMiArMjA3LDE4IEBAIHN0YXRpYyBzc2l6ZV90IHN0bTMyX2xwdGltX2NudF9l
bmFibGVfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAJaWYgKHJldCA8IDAp
CiAJCXJldHVybiByZXQ7CiAKLQlyZXR1cm4gc2NucHJpbnRmKGJ1ZiwgUEFHRV9TSVpFLCAiJXVc
biIsIHJldCk7CisJKmVuYWJsZSA9IHJldDsKKworCXJldHVybiAwOwogfQogCi1zdGF0aWMgc3Np
emVfdCBzdG0zMl9scHRpbV9jbnRfZW5hYmxlX3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAq
Y291bnRlciwKLQkJCQkJICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKLQkJCQkJICAg
IHZvaWQgKnByaXZhdGUsCi0JCQkJCSAgICBjb25zdCBjaGFyICpidWYsIHNpemVfdCBsZW4pCitz
dGF0aWMgaW50IHN0bTMyX2xwdGltX2NudF9lbmFibGVfd3JpdGUoc3RydWN0IGNvdW50ZXJfZGV2
aWNlICpjb3VudGVyLAorCQkJCQlzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCisJCQkJCXU4
IGVuYWJsZSkKIHsKIAlzdHJ1Y3Qgc3RtMzJfbHB0aW1fY250ICpjb25zdCBwcml2ID0gY291bnRl
ci0+cHJpdjsKLQlib29sIGVuYWJsZTsKIAlpbnQgcmV0OwogCi0JcmV0ID0ga3N0cnRvYm9vbChi
dWYsICZlbmFibGUpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KIAkvKiBDaGVjayBub2Jv
ZHkgdXNlcyB0aGUgdGltZXIsIG9yIGFscmVhZHkgZGlzYWJsZWQvZW5hYmxlZCAqLwogCXJldCA9
IHN0bTMyX2xwdGltX2lzX2VuYWJsZWQocHJpdik7CiAJaWYgKChyZXQgPCAwKSB8fCAoIXJldCAm
JiAhZW5hYmxlKSkKQEAgLTI1NCwxMjIgKzIzNCwxNDIgQEAgc3RhdGljIHNzaXplX3Qgc3RtMzJf
bHB0aW1fY250X2VuYWJsZV93cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAJ
aWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIAotCXJldHVybiBsZW47CisJcmV0dXJuIDA7CiB9CiAK
LXN0YXRpYyBzc2l6ZV90IHN0bTMyX2xwdGltX2NudF9jZWlsaW5nX3JlYWQoc3RydWN0IGNvdW50
ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCQkgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50
LAotCQkJCQkgICAgdm9pZCAqcHJpdmF0ZSwgY2hhciAqYnVmKQorc3RhdGljIGludCBzdG0zMl9s
cHRpbV9jbnRfY2VpbGluZ19yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJ
CQkJc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAorCQkJCQl1NjQgKmNlaWxpbmcpCiB7CiAJ
c3RydWN0IHN0bTMyX2xwdGltX2NudCAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7CiAKLQly
ZXR1cm4gc25wcmludGYoYnVmLCBQQUdFX1NJWkUsICIldVxuIiwgcHJpdi0+Y2VpbGluZyk7CisJ
KmNlaWxpbmcgPSBwcml2LT5jZWlsaW5nOworCisJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBzc2l6
ZV90IHN0bTMyX2xwdGltX2NudF9jZWlsaW5nX3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAq
Y291bnRlciwKLQkJCQkJICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCi0JCQkJCSAg
ICAgdm9pZCAqcHJpdmF0ZSwKLQkJCQkJICAgICBjb25zdCBjaGFyICpidWYsIHNpemVfdCBsZW4p
CitzdGF0aWMgaW50IHN0bTMyX2xwdGltX2NudF9jZWlsaW5nX3dyaXRlKHN0cnVjdCBjb3VudGVy
X2RldmljZSAqY291bnRlciwKKwkJCQkJIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKKwkJ
CQkJIHU2NCBjZWlsaW5nKQogewogCXN0cnVjdCBzdG0zMl9scHRpbV9jbnQgKmNvbnN0IHByaXYg
PSBjb3VudGVyLT5wcml2OwotCXVuc2lnbmVkIGludCBjZWlsaW5nOwotCWludCByZXQ7CiAKIAlp
ZiAoc3RtMzJfbHB0aW1faXNfZW5hYmxlZChwcml2KSkKIAkJcmV0dXJuIC1FQlVTWTsKIAotCXJl
dCA9IGtzdHJ0b3VpbnQoYnVmLCAwLCAmY2VpbGluZyk7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJl
dDsKLQogCWlmIChjZWlsaW5nID4gU1RNMzJfTFBUSU1fTUFYX0FSUikKIAkJcmV0dXJuIC1FUkFO
R0U7CiAKIAlwcml2LT5jZWlsaW5nID0gY2VpbGluZzsKIAotCXJldHVybiBsZW47CisJcmV0dXJu
IDA7CiB9CiAKLXN0YXRpYyBjb25zdCBzdHJ1Y3QgY291bnRlcl9jb3VudF9leHQgc3RtMzJfbHB0
aW1fY250X2V4dFtdID0gewotCXsKLQkJLm5hbWUgPSAiZW5hYmxlIiwKLQkJLnJlYWQgPSBzdG0z
Ml9scHRpbV9jbnRfZW5hYmxlX3JlYWQsCi0JCS53cml0ZSA9IHN0bTMyX2xwdGltX2NudF9lbmFi
bGVfd3JpdGUKLQl9LAotCXsKLQkJLm5hbWUgPSAiY2VpbGluZyIsCi0JCS5yZWFkID0gc3RtMzJf
bHB0aW1fY250X2NlaWxpbmdfcmVhZCwKLQkJLndyaXRlID0gc3RtMzJfbHB0aW1fY250X2NlaWxp
bmdfd3JpdGUKLQl9LAorc3RhdGljIHN0cnVjdCBjb3VudGVyX2NvbXAgc3RtMzJfbHB0aW1fY250
X2V4dFtdID0geworCUNPVU5URVJfQ09NUF9FTkFCTEUoc3RtMzJfbHB0aW1fY250X2VuYWJsZV9y
ZWFkLAorCQkJICAgIHN0bTMyX2xwdGltX2NudF9lbmFibGVfd3JpdGUpLAorCUNPVU5URVJfQ09N
UF9DRUlMSU5HKHN0bTMyX2xwdGltX2NudF9jZWlsaW5nX3JlYWQsCisJCQkgICAgIHN0bTMyX2xw
dGltX2NudF9jZWlsaW5nX3dyaXRlKSwKIH07CiAKLXN0YXRpYyBpbnQgc3RtMzJfbHB0aW1fY250
X2FjdGlvbl9nZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCSAgICAgIHN0
cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKLQkJCQkgICAgICBzdHJ1Y3QgY291bnRlcl9zeW5h
cHNlICpzeW5hcHNlLAotCQkJCSAgICAgIHNpemVfdCAqYWN0aW9uKQorc3RhdGljIGludCBzdG0z
Ml9scHRpbV9jbnRfYWN0aW9uX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAor
CQkJCSAgICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCisJCQkJICAgICAgIHN0cnVj
dCBjb3VudGVyX3N5bmFwc2UgKnN5bmFwc2UsCisJCQkJICAgICAgIGVudW0gY291bnRlcl9zeW5h
cHNlX2FjdGlvbiAqYWN0aW9uKQogewogCXN0cnVjdCBzdG0zMl9scHRpbV9jbnQgKmNvbnN0IHBy
aXYgPSBjb3VudGVyLT5wcml2OwotCXNpemVfdCBmdW5jdGlvbjsKKwllbnVtIGNvdW50ZXJfZnVu
Y3Rpb24gZnVuY3Rpb247CiAJaW50IGVycjsKIAotCWVyciA9IHN0bTMyX2xwdGltX2NudF9mdW5j
dGlvbl9nZXQoY291bnRlciwgY291bnQsICZmdW5jdGlvbik7CisJZXJyID0gc3RtMzJfbHB0aW1f
Y250X2Z1bmN0aW9uX3JlYWQoY291bnRlciwgY291bnQsICZmdW5jdGlvbik7CiAJaWYgKGVycikK
IAkJcmV0dXJuIGVycjsKIAogCXN3aXRjaCAoZnVuY3Rpb24pIHsKLQljYXNlIFNUTTMyX0xQVElN
X0NPVU5URVJfSU5DUkVBU0U6CisJY2FzZSBDT1VOVEVSX0ZVTkNUSU9OX0lOQ1JFQVNFOgogCQkv
KiBMUCBUaW1lciBhY3RzIGFzIHVwLWNvdW50ZXIgb24gaW5wdXQgMSAqLwotCQlpZiAoc3luYXBz
ZS0+c2lnbmFsLT5pZCA9PSBjb3VudC0+c3luYXBzZXNbMF0uc2lnbmFsLT5pZCkKLQkJCSphY3Rp
b24gPSBwcml2LT5wb2xhcml0eTsKLQkJZWxzZQotCQkJKmFjdGlvbiA9IFNUTTMyX0xQVElNX1NZ
TkFQU0VfQUNUSU9OX05PTkU7Ci0JCXJldHVybiAwOwotCWNhc2UgU1RNMzJfTFBUSU1fRU5DT0RF
Ul9CT1RIX0VER0U6Ci0JCSphY3Rpb24gPSBwcml2LT5wb2xhcml0eTsKLQkJcmV0dXJuIDA7CisJ
CWlmIChzeW5hcHNlLT5zaWduYWwtPmlkICE9IGNvdW50LT5zeW5hcHNlc1swXS5zaWduYWwtPmlk
KSB7CisJCQkqYWN0aW9uID0gQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9OT05FOworCQkJcmV0dXJu
IDA7CisJCX0KKworCQlzd2l0Y2ggKHByaXYtPnBvbGFyaXR5KSB7CisJCWNhc2UgMDoKKwkJCSph
Y3Rpb24gPSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX1JJU0lOR19FREdFOworCQkJcmV0dXJuIDA7
CisJCWNhc2UgMToKKwkJCSphY3Rpb24gPSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX0ZBTExJTkdf
RURHRTsKKwkJCXJldHVybiAwOworCQljYXNlIDI6CisJCQkqYWN0aW9uID0gQ09VTlRFUl9TWU5B
UFNFX0FDVElPTl9CT1RIX0VER0VTOworCQkJcmV0dXJuIDA7CisJCWRlZmF1bHQ6CisJCQkvKiBz
aG91bGQgbmV2ZXIgcmVhY2ggdGhpcyBwYXRoICovCisJCQlyZXR1cm4gLUVJTlZBTDsKKwkJfQor
CWNhc2UgQ09VTlRFUl9GVU5DVElPTl9RVUFEUkFUVVJFX1g0OgorCQlzd2l0Y2ggKHByaXYtPnBv
bGFyaXR5KSB7CisJCWNhc2UgMDoKKwkJCSphY3Rpb24gPSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9O
X1JJU0lOR19FREdFOworCQkJcmV0dXJuIDA7CisJCWNhc2UgMToKKwkJCSphY3Rpb24gPSBDT1VO
VEVSX1NZTkFQU0VfQUNUSU9OX0ZBTExJTkdfRURHRTsKKwkJCXJldHVybiAwOworCQljYXNlIDI6
CisJCQkqYWN0aW9uID0gQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9CT1RIX0VER0VTOworCQkJcmV0
dXJuIDA7CisJCWRlZmF1bHQ6CisJCQkvKiBzaG91bGQgbmV2ZXIgcmVhY2ggdGhpcyBwYXRoICov
CisJCQlyZXR1cm4gLUVJTlZBTDsKKwkJfQogCWRlZmF1bHQ6CiAJCS8qIHNob3VsZCBuZXZlciBy
ZWFjaCB0aGlzIHBhdGggKi8KIAkJcmV0dXJuIC1FSU5WQUw7CiAJfQogfQogCi1zdGF0aWMgaW50
IHN0bTMyX2xwdGltX2NudF9hY3Rpb25fc2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRl
ciwKLQkJCQkgICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCi0JCQkJICAgICAgc3Ry
dWN0IGNvdW50ZXJfc3luYXBzZSAqc3luYXBzZSwKLQkJCQkgICAgICBzaXplX3QgYWN0aW9uKQor
c3RhdGljIGludCBzdG0zMl9scHRpbV9jbnRfYWN0aW9uX3dyaXRlKHN0cnVjdCBjb3VudGVyX2Rl
dmljZSAqY291bnRlciwKKwkJCQkJc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAorCQkJCQlz
dHJ1Y3QgY291bnRlcl9zeW5hcHNlICpzeW5hcHNlLAorCQkJCQllbnVtIGNvdW50ZXJfc3luYXBz
ZV9hY3Rpb24gYWN0aW9uKQogewogCXN0cnVjdCBzdG0zMl9scHRpbV9jbnQgKmNvbnN0IHByaXYg
PSBjb3VudGVyLT5wcml2OwotCXNpemVfdCBmdW5jdGlvbjsKKwllbnVtIGNvdW50ZXJfZnVuY3Rp
b24gZnVuY3Rpb247CiAJaW50IGVycjsKIAogCWlmIChzdG0zMl9scHRpbV9pc19lbmFibGVkKHBy
aXYpKQogCQlyZXR1cm4gLUVCVVNZOwogCi0JZXJyID0gc3RtMzJfbHB0aW1fY250X2Z1bmN0aW9u
X2dldChjb3VudGVyLCBjb3VudCwgJmZ1bmN0aW9uKTsKKwllcnIgPSBzdG0zMl9scHRpbV9jbnRf
ZnVuY3Rpb25fcmVhZChjb3VudGVyLCBjb3VudCwgJmZ1bmN0aW9uKTsKIAlpZiAoZXJyKQogCQly
ZXR1cm4gZXJyOwogCiAJLyogb25seSBzZXQgcG9sYXJpdHkgd2hlbiBpbiBjb3VudGVyIG1vZGUg
KG9uIGlucHV0IDEpICovCi0JaWYgKGZ1bmN0aW9uID09IFNUTTMyX0xQVElNX0NPVU5URVJfSU5D
UkVBU0UKLQkgICAgJiYgc3luYXBzZS0+c2lnbmFsLT5pZCA9PSBjb3VudC0+c3luYXBzZXNbMF0u
c2lnbmFsLT5pZCkgewotCQlzd2l0Y2ggKGFjdGlvbikgewotCQljYXNlIFNUTTMyX0xQVElNX1NZ
TkFQU0VfQUNUSU9OX1JJU0lOR19FREdFOgotCQljYXNlIFNUTTMyX0xQVElNX1NZTkFQU0VfQUNU
SU9OX0ZBTExJTkdfRURHRToKLQkJY2FzZSBTVE0zMl9MUFRJTV9TWU5BUFNFX0FDVElPTl9CT1RI
X0VER0VTOgotCQkJcHJpdi0+cG9sYXJpdHkgPSBhY3Rpb247Ci0JCQlyZXR1cm4gMDsKLQkJfQot
CX0KKwlpZiAoZnVuY3Rpb24gIT0gQ09VTlRFUl9GVU5DVElPTl9JTkNSRUFTRQorCSAgICB8fCBz
eW5hcHNlLT5zaWduYWwtPmlkICE9IGNvdW50LT5zeW5hcHNlc1swXS5zaWduYWwtPmlkKQorCQly
ZXR1cm4gLUVJTlZBTDsKIAotCXJldHVybiAtRUlOVkFMOworCXN3aXRjaCAoYWN0aW9uKSB7CisJ
Y2FzZSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX1JJU0lOR19FREdFOgorCQlwcml2LT5wb2xhcml0
eSA9IDA7CisJCXJldHVybiAwOworCWNhc2UgQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9GQUxMSU5H
X0VER0U6CisJCXByaXYtPnBvbGFyaXR5ID0gMTsKKwkJcmV0dXJuIDA7CisJY2FzZSBDT1VOVEVS
X1NZTkFQU0VfQUNUSU9OX0JPVEhfRURHRVM6CisJCXByaXYtPnBvbGFyaXR5ID0gMjsKKwkJcmV0
dXJuIDA7CisJZGVmYXVsdDoKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQogfQogCiBzdGF0aWMgY29u
c3Qgc3RydWN0IGNvdW50ZXJfb3BzIHN0bTMyX2xwdGltX2NudF9vcHMgPSB7CiAJLmNvdW50X3Jl
YWQgPSBzdG0zMl9scHRpbV9jbnRfcmVhZCwKLQkuZnVuY3Rpb25fZ2V0ID0gc3RtMzJfbHB0aW1f
Y250X2Z1bmN0aW9uX2dldCwKLQkuZnVuY3Rpb25fc2V0ID0gc3RtMzJfbHB0aW1fY250X2Z1bmN0
aW9uX3NldCwKLQkuYWN0aW9uX2dldCA9IHN0bTMyX2xwdGltX2NudF9hY3Rpb25fZ2V0LAotCS5h
Y3Rpb25fc2V0ID0gc3RtMzJfbHB0aW1fY250X2FjdGlvbl9zZXQsCisJLmZ1bmN0aW9uX3JlYWQg
PSBzdG0zMl9scHRpbV9jbnRfZnVuY3Rpb25fcmVhZCwKKwkuZnVuY3Rpb25fd3JpdGUgPSBzdG0z
Ml9scHRpbV9jbnRfZnVuY3Rpb25fd3JpdGUsCisJLmFjdGlvbl9yZWFkID0gc3RtMzJfbHB0aW1f
Y250X2FjdGlvbl9yZWFkLAorCS5hY3Rpb25fd3JpdGUgPSBzdG0zMl9scHRpbV9jbnRfYWN0aW9u
X3dyaXRlLAogfTsKIAogc3RhdGljIHN0cnVjdCBjb3VudGVyX3NpZ25hbCBzdG0zMl9scHRpbV9j
bnRfc2lnbmFsc1tdID0gewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9jb3VudGVyL3N0bTMyLXRpbWVy
LWNudC5jIGIvZHJpdmVycy9jb3VudGVyL3N0bTMyLXRpbWVyLWNudC5jCmluZGV4IDNmYjBkZWJk
NzQyNS4uOGIzNzU5MDk2ZDA0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2NvdW50ZXIvc3RtMzItdGlt
ZXItY250LmMKKysrIGIvZHJpdmVycy9jb3VudGVyL3N0bTMyLXRpbWVyLWNudC5jCkBAIC0xMyw2
ICsxMyw3IEBACiAjaW5jbHVkZSA8bGludXgvbW9kdWxlLmg+CiAjaW5jbHVkZSA8bGludXgvcGlu
Y3RybC9jb25zdW1lci5oPgogI2luY2x1ZGUgPGxpbnV4L3BsYXRmb3JtX2RldmljZS5oPgorI2lu
Y2x1ZGUgPGxpbnV4L3R5cGVzLmg+CiAKICNkZWZpbmUgVElNX0NDTVJfQ0NYUwkoQklUKDgpIHwg
QklUKDApKQogI2RlZmluZSBUSU1fQ0NNUl9NQVNLCShUSU1fQ0NNUl9DQzFTIHwgVElNX0NDTVJf
Q0MyUyB8IFwKQEAgLTM2LDI5ICszNywxNSBAQCBzdHJ1Y3Qgc3RtMzJfdGltZXJfY250IHsKIAlz
dHJ1Y3Qgc3RtMzJfdGltZXJfcmVncyBiYWs7CiB9OwogCi0vKioKLSAqIGVudW0gc3RtMzJfY291
bnRfZnVuY3Rpb24gLSBlbnVtZXJhdGVzIHN0bTMyIHRpbWVyIGNvdW50ZXIgZW5jb2RlciBtb2Rl
cwotICogQFNUTTMyX0NPVU5UX1NMQVZFX01PREVfRElTQUJMRUQ6IGNvdW50cyBvbiBpbnRlcm5h
bCBjbG9jayB3aGVuIENFTj0xCi0gKiBAU1RNMzJfQ09VTlRfRU5DT0RFUl9NT0RFXzE6IGNvdW50
cyBUSTFGUDEgZWRnZXMsIGRlcGVuZGluZyBvbiBUSTJGUDIgbGV2ZWwKLSAqIEBTVE0zMl9DT1VO
VF9FTkNPREVSX01PREVfMjogY291bnRzIFRJMkZQMiBlZGdlcywgZGVwZW5kaW5nIG9uIFRJMUZQ
MSBsZXZlbAotICogQFNUTTMyX0NPVU5UX0VOQ09ERVJfTU9ERV8zOiBjb3VudHMgb24gYm90aCBU
STFGUDEgYW5kIFRJMkZQMiBlZGdlcwotICovCi1lbnVtIHN0bTMyX2NvdW50X2Z1bmN0aW9uIHsK
LQlTVE0zMl9DT1VOVF9TTEFWRV9NT0RFX0RJU0FCTEVELAotCVNUTTMyX0NPVU5UX0VOQ09ERVJf
TU9ERV8xLAotCVNUTTMyX0NPVU5UX0VOQ09ERVJfTU9ERV8yLAotCVNUTTMyX0NPVU5UX0VOQ09E
RVJfTU9ERV8zLAotfTsKLQogc3RhdGljIGNvbnN0IGVudW0gY291bnRlcl9mdW5jdGlvbiBzdG0z
Ml9jb3VudF9mdW5jdGlvbnNbXSA9IHsKLQlbU1RNMzJfQ09VTlRfU0xBVkVfTU9ERV9ESVNBQkxF
RF0gPSBDT1VOVEVSX0ZVTkNUSU9OX0lOQ1JFQVNFLAotCVtTVE0zMl9DT1VOVF9FTkNPREVSX01P
REVfMV0gPSBDT1VOVEVSX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDJfQSwKLQlbU1RNMzJfQ09VTlRf
RU5DT0RFUl9NT0RFXzJdID0gQ09VTlRFUl9GVU5DVElPTl9RVUFEUkFUVVJFX1gyX0IsCi0JW1NU
TTMyX0NPVU5UX0VOQ09ERVJfTU9ERV8zXSA9IENPVU5URVJfRlVOQ1RJT05fUVVBRFJBVFVSRV9Y
NCwKKwlDT1VOVEVSX0ZVTkNUSU9OX0lOQ1JFQVNFLAorCUNPVU5URVJfRlVOQ1RJT05fUVVBRFJB
VFVSRV9YMl9BLAorCUNPVU5URVJfRlVOQ1RJT05fUVVBRFJBVFVSRV9YMl9CLAorCUNPVU5URVJf
RlVOQ1RJT05fUVVBRFJBVFVSRV9YNCwKIH07CiAKIHN0YXRpYyBpbnQgc3RtMzJfY291bnRfcmVh
ZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkgICAgc3RydWN0IGNvdW50ZXJf
Y291bnQgKmNvdW50LCB1bnNpZ25lZCBsb25nICp2YWwpCisJCQkgICAgc3RydWN0IGNvdW50ZXJf
Y291bnQgKmNvdW50LCB1NjQgKnZhbCkKIHsKIAlzdHJ1Y3Qgc3RtMzJfdGltZXJfY250ICpjb25z
dCBwcml2ID0gY291bnRlci0+cHJpdjsKIAl1MzIgY250OwpAQCAtNzAsOCArNTcsNyBAQCBzdGF0
aWMgaW50IHN0bTMyX2NvdW50X3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAog
fQogCiBzdGF0aWMgaW50IHN0bTMyX2NvdW50X3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAq
Y291bnRlciwKLQkJCSAgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkJICAgICBj
b25zdCB1bnNpZ25lZCBsb25nIHZhbCkKKwkJCSAgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNv
dW50LCBjb25zdCB1NjQgdmFsKQogewogCXN0cnVjdCBzdG0zMl90aW1lcl9jbnQgKmNvbnN0IHBy
aXYgPSBjb3VudGVyLT5wcml2OwogCXUzMiBjZWlsaW5nOwpAQCAtODMsOSArNjksOSBAQCBzdGF0
aWMgaW50IHN0bTMyX2NvdW50X3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwK
IAlyZXR1cm4gcmVnbWFwX3dyaXRlKHByaXYtPnJlZ21hcCwgVElNX0NOVCwgdmFsKTsKIH0KIAot
c3RhdGljIGludCBzdG0zMl9jb3VudF9mdW5jdGlvbl9nZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNl
ICpjb3VudGVyLAotCQkJCSAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCi0JCQkJICAg
IHNpemVfdCAqZnVuY3Rpb24pCitzdGF0aWMgaW50IHN0bTMyX2NvdW50X2Z1bmN0aW9uX3JlYWQo
c3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCSAgICAgc3RydWN0IGNvdW50ZXJf
Y291bnQgKmNvdW50LAorCQkJCSAgICAgZW51bSBjb3VudGVyX2Z1bmN0aW9uICpmdW5jdGlvbikK
IHsKIAlzdHJ1Y3Qgc3RtMzJfdGltZXJfY250ICpjb25zdCBwcml2ID0gY291bnRlci0+cHJpdjsK
IAl1MzIgc21jcjsKQEAgLTk0LDQwICs4MCw0MCBAQCBzdGF0aWMgaW50IHN0bTMyX2NvdW50X2Z1
bmN0aW9uX2dldChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAKIAlzd2l0Y2ggKHNt
Y3IgJiBUSU1fU01DUl9TTVMpIHsKIAljYXNlIDA6Ci0JCSpmdW5jdGlvbiA9IFNUTTMyX0NPVU5U
X1NMQVZFX01PREVfRElTQUJMRUQ7CisJCSpmdW5jdGlvbiA9IENPVU5URVJfRlVOQ1RJT05fSU5D
UkVBU0U7CiAJCXJldHVybiAwOwogCWNhc2UgMToKLQkJKmZ1bmN0aW9uID0gU1RNMzJfQ09VTlRf
RU5DT0RFUl9NT0RFXzE7CisJCSpmdW5jdGlvbiA9IENPVU5URVJfRlVOQ1RJT05fUVVBRFJBVFVS
RV9YMl9BOwogCQlyZXR1cm4gMDsKIAljYXNlIDI6Ci0JCSpmdW5jdGlvbiA9IFNUTTMyX0NPVU5U
X0VOQ09ERVJfTU9ERV8yOworCQkqZnVuY3Rpb24gPSBDT1VOVEVSX0ZVTkNUSU9OX1FVQURSQVRV
UkVfWDJfQjsKIAkJcmV0dXJuIDA7CiAJY2FzZSAzOgotCQkqZnVuY3Rpb24gPSBTVE0zMl9DT1VO
VF9FTkNPREVSX01PREVfMzsKKwkJKmZ1bmN0aW9uID0gQ09VTlRFUl9GVU5DVElPTl9RVUFEUkFU
VVJFX1g0OwogCQlyZXR1cm4gMDsKIAlkZWZhdWx0OgogCQlyZXR1cm4gLUVJTlZBTDsKIAl9CiB9
CiAKLXN0YXRpYyBpbnQgc3RtMzJfY291bnRfZnVuY3Rpb25fc2V0KHN0cnVjdCBjb3VudGVyX2Rl
dmljZSAqY291bnRlciwKLQkJCQkgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkJ
CSAgICBzaXplX3QgZnVuY3Rpb24pCitzdGF0aWMgaW50IHN0bTMyX2NvdW50X2Z1bmN0aW9uX3dy
aXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkgICAgICBzdHJ1Y3QgY291
bnRlcl9jb3VudCAqY291bnQsCisJCQkJICAgICAgZW51bSBjb3VudGVyX2Z1bmN0aW9uIGZ1bmN0
aW9uKQogewogCXN0cnVjdCBzdG0zMl90aW1lcl9jbnQgKmNvbnN0IHByaXYgPSBjb3VudGVyLT5w
cml2OwogCXUzMiBjcjEsIHNtczsKIAogCXN3aXRjaCAoZnVuY3Rpb24pIHsKLQljYXNlIFNUTTMy
X0NPVU5UX1NMQVZFX01PREVfRElTQUJMRUQ6CisJY2FzZSBDT1VOVEVSX0ZVTkNUSU9OX0lOQ1JF
QVNFOgogCQlzbXMgPSAwOwogCQlicmVhazsKLQljYXNlIFNUTTMyX0NPVU5UX0VOQ09ERVJfTU9E
RV8xOgorCWNhc2UgQ09VTlRFUl9GVU5DVElPTl9RVUFEUkFUVVJFX1gyX0E6CiAJCXNtcyA9IDE7
CiAJCWJyZWFrOwotCWNhc2UgU1RNMzJfQ09VTlRfRU5DT0RFUl9NT0RFXzI6CisJY2FzZSBDT1VO
VEVSX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDJfQjoKIAkJc21zID0gMjsKIAkJYnJlYWs7Ci0JY2Fz
ZSBTVE0zMl9DT1VOVF9FTkNPREVSX01PREVfMzoKKwljYXNlIENPVU5URVJfRlVOQ1RJT05fUVVB
RFJBVFVSRV9YNDoKIAkJc21zID0gMzsKIAkJYnJlYWs7CiAJZGVmYXVsdDoKQEAgLTE1MCw0NCAr
MTM2LDM3IEBAIHN0YXRpYyBpbnQgc3RtMzJfY291bnRfZnVuY3Rpb25fc2V0KHN0cnVjdCBjb3Vu
dGVyX2RldmljZSAqY291bnRlciwKIAlyZXR1cm4gMDsKIH0KIAotc3RhdGljIHNzaXplX3Qgc3Rt
MzJfY291bnRfZGlyZWN0aW9uX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAor
c3RhdGljIGludCBzdG0zMl9jb3VudF9kaXJlY3Rpb25fcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZp
Y2UgKmNvdW50ZXIsCiAJCQkJICAgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkJ
CSAgICAgIHZvaWQgKnByaXZhdGUsIGNoYXIgKmJ1ZikKKwkJCQkgICAgICBlbnVtIGNvdW50ZXJf
Y291bnRfZGlyZWN0aW9uICpkaXJlY3Rpb24pCiB7CiAJc3RydWN0IHN0bTMyX3RpbWVyX2NudCAq
Y29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7Ci0JY29uc3QgY2hhciAqZGlyZWN0aW9uOwogCXUz
MiBjcjE7CiAKIAlyZWdtYXBfcmVhZChwcml2LT5yZWdtYXAsIFRJTV9DUjEsICZjcjEpOwotCWRp
cmVjdGlvbiA9IChjcjEgJiBUSU1fQ1IxX0RJUikgPyAiYmFja3dhcmQiIDogImZvcndhcmQiOwor
CSpkaXJlY3Rpb24gPSAoY3IxICYgVElNX0NSMV9ESVIpID8gQ09VTlRFUl9DT1VOVF9ESVJFQ1RJ
T05fQkFDS1dBUkQgOgorCQlDT1VOVEVSX0NPVU5UX0RJUkVDVElPTl9GT1JXQVJEOwogCi0JcmV0
dXJuIHNjbnByaW50ZihidWYsIFBBR0VfU0laRSwgIiVzXG4iLCBkaXJlY3Rpb24pOworCXJldHVy
biAwOwogfQogCi1zdGF0aWMgc3NpemVfdCBzdG0zMl9jb3VudF9jZWlsaW5nX3JlYWQoc3RydWN0
IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCQlzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291
bnQsCi0JCQkJCXZvaWQgKnByaXZhdGUsIGNoYXIgKmJ1ZikKK3N0YXRpYyBpbnQgc3RtMzJfY291
bnRfY2VpbGluZ19yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkgICAg
c3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB1NjQgKmNlaWxpbmcpCiB7CiAJc3RydWN0IHN0
bTMyX3RpbWVyX2NudCAqY29uc3QgcHJpdiA9IGNvdW50ZXItPnByaXY7CiAJdTMyIGFycjsKIAog
CXJlZ21hcF9yZWFkKHByaXYtPnJlZ21hcCwgVElNX0FSUiwgJmFycik7CiAKLQlyZXR1cm4gc25w
cmludGYoYnVmLCBQQUdFX1NJWkUsICIldVxuIiwgYXJyKTsKKwkqY2VpbGluZyA9IGFycjsKKwor
CXJldHVybiAwOwogfQogCi1zdGF0aWMgc3NpemVfdCBzdG0zMl9jb3VudF9jZWlsaW5nX3dyaXRl
KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQkJIHN0cnVjdCBjb3VudGVyX2Nv
dW50ICpjb3VudCwKLQkJCQkJIHZvaWQgKnByaXZhdGUsCi0JCQkJCSBjb25zdCBjaGFyICpidWYs
IHNpemVfdCBsZW4pCitzdGF0aWMgaW50IHN0bTMyX2NvdW50X2NlaWxpbmdfd3JpdGUoc3RydWN0
IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCSAgICAgc3RydWN0IGNvdW50ZXJfY291bnQg
KmNvdW50LCB1NjQgY2VpbGluZykKIHsKIAlzdHJ1Y3Qgc3RtMzJfdGltZXJfY250ICpjb25zdCBw
cml2ID0gY291bnRlci0+cHJpdjsKLQl1bnNpZ25lZCBpbnQgY2VpbGluZzsKLQlpbnQgcmV0Owot
Ci0JcmV0ID0ga3N0cnRvdWludChidWYsIDAsICZjZWlsaW5nKTsKLQlpZiAocmV0KQotCQlyZXR1
cm4gcmV0OwogCiAJaWYgKGNlaWxpbmcgPiBwcml2LT5tYXhfYXJyKQogCQlyZXR1cm4gLUVSQU5H
RTsKQEAgLTE5NiwzNCArMTc1LDI3IEBAIHN0YXRpYyBzc2l6ZV90IHN0bTMyX2NvdW50X2NlaWxp
bmdfd3JpdGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAogCXJlZ21hcF91cGRhdGVf
Yml0cyhwcml2LT5yZWdtYXAsIFRJTV9DUjEsIFRJTV9DUjFfQVJQRSwgMCk7CiAJcmVnbWFwX3dy
aXRlKHByaXYtPnJlZ21hcCwgVElNX0FSUiwgY2VpbGluZyk7CiAKLQlyZXR1cm4gbGVuOworCXJl
dHVybiAwOwogfQogCi1zdGF0aWMgc3NpemVfdCBzdG0zMl9jb3VudF9lbmFibGVfcmVhZChzdHJ1
Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkJICAgICAgIHN0cnVjdCBjb3VudGVyX2Nv
dW50ICpjb3VudCwKLQkJCQkgICAgICAgdm9pZCAqcHJpdmF0ZSwgY2hhciAqYnVmKQorc3RhdGlj
IGludCBzdG0zMl9jb3VudF9lbmFibGVfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50
ZXIsCisJCQkJICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB1OCAqZW5hYmxlKQogewog
CXN0cnVjdCBzdG0zMl90aW1lcl9jbnQgKmNvbnN0IHByaXYgPSBjb3VudGVyLT5wcml2OwogCXUz
MiBjcjE7CiAKIAlyZWdtYXBfcmVhZChwcml2LT5yZWdtYXAsIFRJTV9DUjEsICZjcjEpOwogCi0J
cmV0dXJuIHNjbnByaW50ZihidWYsIFBBR0VfU0laRSwgIiVkXG4iLCAoYm9vbCkoY3IxICYgVElN
X0NSMV9DRU4pKTsKKwkqZW5hYmxlID0gY3IxICYgVElNX0NSMV9DRU47CisKKwlyZXR1cm4gMDsK
IH0KIAotc3RhdGljIHNzaXplX3Qgc3RtMzJfY291bnRfZW5hYmxlX3dyaXRlKHN0cnVjdCBjb3Vu
dGVyX2RldmljZSAqY291bnRlciwKLQkJCQkJc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAot
CQkJCQl2b2lkICpwcml2YXRlLAotCQkJCQljb25zdCBjaGFyICpidWYsIHNpemVfdCBsZW4pCitz
dGF0aWMgaW50IHN0bTMyX2NvdW50X2VuYWJsZV93cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2Ug
KmNvdW50ZXIsCisJCQkJICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgdTggZW5hYmxl
KQogewogCXN0cnVjdCBzdG0zMl90aW1lcl9jbnQgKmNvbnN0IHByaXYgPSBjb3VudGVyLT5wcml2
OwotCWludCBlcnI7CiAJdTMyIGNyMTsKLQlib29sIGVuYWJsZTsKLQotCWVyciA9IGtzdHJ0b2Jv
b2woYnVmLCAmZW5hYmxlKTsKLQlpZiAoZXJyKQotCQlyZXR1cm4gZXJyOwogCiAJaWYgKGVuYWJs
ZSkgewogCQlyZWdtYXBfcmVhZChwcml2LT5yZWdtYXAsIFRJTV9DUjEsICZjcjEpOwpAQCAtMjQy
LDcwICsyMTQsNTUgQEAgc3RhdGljIHNzaXplX3Qgc3RtMzJfY291bnRfZW5hYmxlX3dyaXRlKHN0
cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKIAkvKiBLZWVwIGVuYWJsZWQgc3RhdGUgdG8g
cHJvcGVybHkgaGFuZGxlIGxvdyBwb3dlciBzdGF0ZXMgKi8KIAlwcml2LT5lbmFibGVkID0gZW5h
YmxlOwogCi0JcmV0dXJuIGxlbjsKKwlyZXR1cm4gMDsKIH0KIAotc3RhdGljIGNvbnN0IHN0cnVj
dCBjb3VudGVyX2NvdW50X2V4dCBzdG0zMl9jb3VudF9leHRbXSA9IHsKLQl7Ci0JCS5uYW1lID0g
ImRpcmVjdGlvbiIsCi0JCS5yZWFkID0gc3RtMzJfY291bnRfZGlyZWN0aW9uX3JlYWQsCi0JfSwK
LQl7Ci0JCS5uYW1lID0gImVuYWJsZSIsCi0JCS5yZWFkID0gc3RtMzJfY291bnRfZW5hYmxlX3Jl
YWQsCi0JCS53cml0ZSA9IHN0bTMyX2NvdW50X2VuYWJsZV93cml0ZQotCX0sCi0JewotCQkubmFt
ZSA9ICJjZWlsaW5nIiwKLQkJLnJlYWQgPSBzdG0zMl9jb3VudF9jZWlsaW5nX3JlYWQsCi0JCS53
cml0ZSA9IHN0bTMyX2NvdW50X2NlaWxpbmdfd3JpdGUKLQl9LAotfTsKLQotZW51bSBzdG0zMl9z
eW5hcHNlX2FjdGlvbiB7Ci0JU1RNMzJfU1lOQVBTRV9BQ1RJT05fTk9ORSwKLQlTVE0zMl9TWU5B
UFNFX0FDVElPTl9CT1RIX0VER0VTCitzdGF0aWMgc3RydWN0IGNvdW50ZXJfY29tcCBzdG0zMl9j
b3VudF9leHRbXSA9IHsKKwlDT1VOVEVSX0NPTVBfRElSRUNUSU9OKHN0bTMyX2NvdW50X2RpcmVj
dGlvbl9yZWFkKSwKKwlDT1VOVEVSX0NPTVBfRU5BQkxFKHN0bTMyX2NvdW50X2VuYWJsZV9yZWFk
LCBzdG0zMl9jb3VudF9lbmFibGVfd3JpdGUpLAorCUNPVU5URVJfQ09NUF9DRUlMSU5HKHN0bTMy
X2NvdW50X2NlaWxpbmdfcmVhZCwKKwkJCSAgICAgc3RtMzJfY291bnRfY2VpbGluZ193cml0ZSks
CiB9OwogCiBzdGF0aWMgY29uc3QgZW51bSBjb3VudGVyX3N5bmFwc2VfYWN0aW9uIHN0bTMyX3N5
bmFwc2VfYWN0aW9uc1tdID0gewotCVtTVE0zMl9TWU5BUFNFX0FDVElPTl9OT05FXSA9IENPVU5U
RVJfU1lOQVBTRV9BQ1RJT05fTk9ORSwKLQlbU1RNMzJfU1lOQVBTRV9BQ1RJT05fQk9USF9FREdF
U10gPSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX0JPVEhfRURHRVMKKwlDT1VOVEVSX1NZTkFQU0Vf
QUNUSU9OX05PTkUsCisJQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9CT1RIX0VER0VTCiB9OwogCi1z
dGF0aWMgaW50IHN0bTMyX2FjdGlvbl9nZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVy
LAotCQkJICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKLQkJCSAgICBzdHJ1Y3QgY291
bnRlcl9zeW5hcHNlICpzeW5hcHNlLAotCQkJICAgIHNpemVfdCAqYWN0aW9uKQorc3RhdGljIGlu
dCBzdG0zMl9hY3Rpb25fcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkg
ICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKKwkJCSAgICAgc3RydWN0IGNvdW50ZXJf
c3luYXBzZSAqc3luYXBzZSwKKwkJCSAgICAgZW51bSBjb3VudGVyX3N5bmFwc2VfYWN0aW9uICph
Y3Rpb24pCiB7Ci0Jc2l6ZV90IGZ1bmN0aW9uOworCWVudW0gY291bnRlcl9mdW5jdGlvbiBmdW5j
dGlvbjsKIAlpbnQgZXJyOwogCi0JZXJyID0gc3RtMzJfY291bnRfZnVuY3Rpb25fZ2V0KGNvdW50
ZXIsIGNvdW50LCAmZnVuY3Rpb24pOworCWVyciA9IHN0bTMyX2NvdW50X2Z1bmN0aW9uX3JlYWQo
Y291bnRlciwgY291bnQsICZmdW5jdGlvbik7CiAJaWYgKGVycikKIAkJcmV0dXJuIGVycjsKIAog
CXN3aXRjaCAoZnVuY3Rpb24pIHsKLQljYXNlIFNUTTMyX0NPVU5UX1NMQVZFX01PREVfRElTQUJM
RUQ6CisJY2FzZSBDT1VOVEVSX0ZVTkNUSU9OX0lOQ1JFQVNFOgogCQkvKiBjb3VudHMgb24gaW50
ZXJuYWwgY2xvY2sgd2hlbiBDRU49MSAqLwotCQkqYWN0aW9uID0gU1RNMzJfU1lOQVBTRV9BQ1RJ
T05fTk9ORTsKKwkJKmFjdGlvbiA9IENPVU5URVJfU1lOQVBTRV9BQ1RJT05fTk9ORTsKIAkJcmV0
dXJuIDA7Ci0JY2FzZSBTVE0zMl9DT1VOVF9FTkNPREVSX01PREVfMToKKwljYXNlIENPVU5URVJf
RlVOQ1RJT05fUVVBRFJBVFVSRV9YMl9BOgogCQkvKiBjb3VudHMgdXAvZG93biBvbiBUSTFGUDEg
ZWRnZSBkZXBlbmRpbmcgb24gVEkyRlAyIGxldmVsICovCiAJCWlmIChzeW5hcHNlLT5zaWduYWwt
PmlkID09IGNvdW50LT5zeW5hcHNlc1swXS5zaWduYWwtPmlkKQotCQkJKmFjdGlvbiA9IFNUTTMy
X1NZTkFQU0VfQUNUSU9OX0JPVEhfRURHRVM7CisJCQkqYWN0aW9uID0gQ09VTlRFUl9TWU5BUFNF
X0FDVElPTl9CT1RIX0VER0VTOwogCQllbHNlCi0JCQkqYWN0aW9uID0gU1RNMzJfU1lOQVBTRV9B
Q1RJT05fTk9ORTsKKwkJCSphY3Rpb24gPSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX05PTkU7CiAJ
CXJldHVybiAwOwotCWNhc2UgU1RNMzJfQ09VTlRfRU5DT0RFUl9NT0RFXzI6CisJY2FzZSBDT1VO
VEVSX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDJfQjoKIAkJLyogY291bnRzIHVwL2Rvd24gb24gVEky
RlAyIGVkZ2UgZGVwZW5kaW5nIG9uIFRJMUZQMSBsZXZlbCAqLwogCQlpZiAoc3luYXBzZS0+c2ln
bmFsLT5pZCA9PSBjb3VudC0+c3luYXBzZXNbMV0uc2lnbmFsLT5pZCkKLQkJCSphY3Rpb24gPSBT
VE0zMl9TWU5BUFNFX0FDVElPTl9CT1RIX0VER0VTOworCQkJKmFjdGlvbiA9IENPVU5URVJfU1lO
QVBTRV9BQ1RJT05fQk9USF9FREdFUzsKIAkJZWxzZQotCQkJKmFjdGlvbiA9IFNUTTMyX1NZTkFQ
U0VfQUNUSU9OX05PTkU7CisJCQkqYWN0aW9uID0gQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9OT05F
OwogCQlyZXR1cm4gMDsKLQljYXNlIFNUTTMyX0NPVU5UX0VOQ09ERVJfTU9ERV8zOgorCWNhc2Ug
Q09VTlRFUl9GVU5DVElPTl9RVUFEUkFUVVJFX1g0OgogCQkvKiBjb3VudHMgdXAvZG93biBvbiBi
b3RoIFRJMUZQMSBhbmQgVEkyRlAyIGVkZ2VzICovCi0JCSphY3Rpb24gPSBTVE0zMl9TWU5BUFNF
X0FDVElPTl9CT1RIX0VER0VTOworCQkqYWN0aW9uID0gQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9C
T1RIX0VER0VTOwogCQlyZXR1cm4gMDsKIAlkZWZhdWx0OgogCQlyZXR1cm4gLUVJTlZBTDsKQEAg
LTMxNSw5ICsyNzIsOSBAQCBzdGF0aWMgaW50IHN0bTMyX2FjdGlvbl9nZXQoc3RydWN0IGNvdW50
ZXJfZGV2aWNlICpjb3VudGVyLAogc3RhdGljIGNvbnN0IHN0cnVjdCBjb3VudGVyX29wcyBzdG0z
Ml90aW1lcl9jbnRfb3BzID0gewogCS5jb3VudF9yZWFkID0gc3RtMzJfY291bnRfcmVhZCwKIAku
Y291bnRfd3JpdGUgPSBzdG0zMl9jb3VudF93cml0ZSwKLQkuZnVuY3Rpb25fZ2V0ID0gc3RtMzJf
Y291bnRfZnVuY3Rpb25fZ2V0LAotCS5mdW5jdGlvbl9zZXQgPSBzdG0zMl9jb3VudF9mdW5jdGlv
bl9zZXQsCi0JLmFjdGlvbl9nZXQgPSBzdG0zMl9hY3Rpb25fZ2V0LAorCS5mdW5jdGlvbl9yZWFk
ID0gc3RtMzJfY291bnRfZnVuY3Rpb25fcmVhZCwKKwkuZnVuY3Rpb25fd3JpdGUgPSBzdG0zMl9j
b3VudF9mdW5jdGlvbl93cml0ZSwKKwkuYWN0aW9uX3JlYWQgPSBzdG0zMl9hY3Rpb25fcmVhZCwK
IH07CiAKIHN0YXRpYyBzdHJ1Y3QgY291bnRlcl9zaWduYWwgc3RtMzJfc2lnbmFsc1tdID0gewpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9jb3VudGVyL3RpLWVxZXAuYyBiL2RyaXZlcnMvY291bnRlci90
aS1lcWVwLmMKaW5kZXggOTRmZTU4YmIzZWFiLi4wOTgxN2M5NTNmOWEgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvY291bnRlci90aS1lcWVwLmMKKysrIGIvZHJpdmVycy9jb3VudGVyL3RpLWVxZXAuYwpA
QCAtMTMsNiArMTMsNyBAQAogI2luY2x1ZGUgPGxpbnV4L3BsYXRmb3JtX2RldmljZS5oPgogI2lu
Y2x1ZGUgPGxpbnV4L3BtX3J1bnRpbWUuaD4KICNpbmNsdWRlIDxsaW51eC9yZWdtYXAuaD4KKyNp
bmNsdWRlIDxsaW51eC90eXBlcy5oPgogCiAvKiAzMi1iaXQgcmVnaXN0ZXJzICovCiAjZGVmaW5l
IFFQT1NDTlQJCTB4MApAQCAtNzMsMTkgKzc0LDEzIEBAIGVudW0gewogfTsKIAogLyogUG9zaXRp
b24gQ291bnRlciBJbnB1dCBNb2RlcyAqLwotZW51bSB7CitlbnVtIHRpX2VxZXBfY291bnRfZnVu
YyB7CiAJVElfRVFFUF9DT1VOVF9GVU5DX1FVQURfQ09VTlQsCiAJVElfRVFFUF9DT1VOVF9GVU5D
X0RJUl9DT1VOVCwKIAlUSV9FUUVQX0NPVU5UX0ZVTkNfVVBfQ09VTlQsCiAJVElfRVFFUF9DT1VO
VF9GVU5DX0RPV05fQ09VTlQsCiB9OwogCi1lbnVtIHsKLQlUSV9FUUVQX1NZTkFQU0VfQUNUSU9O
X0JPVEhfRURHRVMsCi0JVElfRVFFUF9TWU5BUFNFX0FDVElPTl9SSVNJTkdfRURHRSwKLQlUSV9F
UUVQX1NZTkFQU0VfQUNUSU9OX05PTkUsCi19OwotCiBzdHJ1Y3QgdGlfZXFlcF9jbnQgewogCXN0
cnVjdCBjb3VudGVyX2RldmljZSBjb3VudGVyOwogCXN0cnVjdCByZWdtYXAgKnJlZ21hcDMyOwpA
QCAtOTMsNyArODgsNyBAQCBzdHJ1Y3QgdGlfZXFlcF9jbnQgewogfTsKIAogc3RhdGljIGludCB0
aV9lcWVwX2NvdW50X3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJICAg
ICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB1bnNpZ25lZCBsb25nICp2YWwpCisJCQkg
ICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHU2NCAqdmFsKQogewogCXN0cnVjdCB0
aV9lcWVwX2NudCAqcHJpdiA9IGNvdW50ZXItPnByaXY7CiAJdTMyIGNudDsKQEAgLTEwNSw3ICsx
MDAsNyBAQCBzdGF0aWMgaW50IHRpX2VxZXBfY291bnRfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZp
Y2UgKmNvdW50ZXIsCiB9CiAKIHN0YXRpYyBpbnQgdGlfZXFlcF9jb3VudF93cml0ZShzdHJ1Y3Qg
Y291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkgICAgICAgc3RydWN0IGNvdW50ZXJfY291bnQg
KmNvdW50LCB1bnNpZ25lZCBsb25nIHZhbCkKKwkJCSAgICAgICBzdHJ1Y3QgY291bnRlcl9jb3Vu
dCAqY291bnQsIHU2NCB2YWwpCiB7CiAJc3RydWN0IHRpX2VxZXBfY250ICpwcml2ID0gY291bnRl
ci0+cHJpdjsKIAl1MzIgbWF4OwpAQCAtMTE3LDY0ICsxMTIsMTAwIEBAIHN0YXRpYyBpbnQgdGlf
ZXFlcF9jb3VudF93cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCiAJcmV0dXJu
IHJlZ21hcF93cml0ZShwcml2LT5yZWdtYXAzMiwgUVBPU0NOVCwgdmFsKTsKIH0KIAotc3RhdGlj
IGludCB0aV9lcWVwX2Z1bmN0aW9uX2dldChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIs
Ci0JCQkJc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCBzaXplX3QgKmZ1bmN0aW9uKQorc3Rh
dGljIGludCB0aV9lcWVwX2Z1bmN0aW9uX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3Vu
dGVyLAorCQkJCSBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCisJCQkJIGVudW0gY291bnRl
cl9mdW5jdGlvbiAqZnVuY3Rpb24pCiB7CiAJc3RydWN0IHRpX2VxZXBfY250ICpwcml2ID0gY291
bnRlci0+cHJpdjsKIAl1MzIgcWRlY2N0bDsKIAogCXJlZ21hcF9yZWFkKHByaXYtPnJlZ21hcDE2
LCBRREVDQ1RMLCAmcWRlY2N0bCk7Ci0JKmZ1bmN0aW9uID0gKHFkZWNjdGwgJiBRREVDQ1RMX1FT
UkMpID4+IFFERUNDVExfUVNSQ19TSElGVDsKKworCXN3aXRjaCAoKHFkZWNjdGwgJiBRREVDQ1RM
X1FTUkMpID4+IFFERUNDVExfUVNSQ19TSElGVCkgeworCWNhc2UgVElfRVFFUF9DT1VOVF9GVU5D
X1FVQURfQ09VTlQ6CisJCSpmdW5jdGlvbiA9IENPVU5URVJfRlVOQ1RJT05fUVVBRFJBVFVSRV9Y
NDsKKwkJYnJlYWs7CisJY2FzZSBUSV9FUUVQX0NPVU5UX0ZVTkNfRElSX0NPVU5UOgorCQkqZnVu
Y3Rpb24gPSBDT1VOVEVSX0ZVTkNUSU9OX1BVTFNFX0RJUkVDVElPTjsKKwkJYnJlYWs7CisJY2Fz
ZSBUSV9FUUVQX0NPVU5UX0ZVTkNfVVBfQ09VTlQ6CisJCSpmdW5jdGlvbiA9IENPVU5URVJfRlVO
Q1RJT05fSU5DUkVBU0U7CisJCWJyZWFrOworCWNhc2UgVElfRVFFUF9DT1VOVF9GVU5DX0RPV05f
Q09VTlQ6CisJCSpmdW5jdGlvbiA9IENPVU5URVJfRlVOQ1RJT05fREVDUkVBU0U7CisJCWJyZWFr
OworCX0KIAogCXJldHVybiAwOwogfQogCi1zdGF0aWMgaW50IHRpX2VxZXBfZnVuY3Rpb25fc2V0
KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQlzdHJ1Y3QgY291bnRlcl9jb3Vu
dCAqY291bnQsIHNpemVfdCBmdW5jdGlvbikKK3N0YXRpYyBpbnQgdGlfZXFlcF9mdW5jdGlvbl93
cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJICBzdHJ1Y3QgY291bnRl
cl9jb3VudCAqY291bnQsCisJCQkJICBlbnVtIGNvdW50ZXJfZnVuY3Rpb24gZnVuY3Rpb24pCiB7
CiAJc3RydWN0IHRpX2VxZXBfY250ICpwcml2ID0gY291bnRlci0+cHJpdjsKKwllbnVtIHRpX2Vx
ZXBfY291bnRfZnVuYyBxc3JjOworCisJc3dpdGNoIChmdW5jdGlvbikgeworCWNhc2UgQ09VTlRF
Ul9GVU5DVElPTl9RVUFEUkFUVVJFX1g0OgorCQlxc3JjID0gVElfRVFFUF9DT1VOVF9GVU5DX1FV
QURfQ09VTlQ7CisJCWJyZWFrOworCWNhc2UgQ09VTlRFUl9GVU5DVElPTl9QVUxTRV9ESVJFQ1RJ
T046CisJCXFzcmMgPSBUSV9FUUVQX0NPVU5UX0ZVTkNfRElSX0NPVU5UOworCQlicmVhazsKKwlj
YXNlIENPVU5URVJfRlVOQ1RJT05fSU5DUkVBU0U6CisJCXFzcmMgPSBUSV9FUUVQX0NPVU5UX0ZV
TkNfVVBfQ09VTlQ7CisJCWJyZWFrOworCWNhc2UgQ09VTlRFUl9GVU5DVElPTl9ERUNSRUFTRToK
KwkJcXNyYyA9IFRJX0VRRVBfQ09VTlRfRlVOQ19ET1dOX0NPVU5UOworCQlicmVhazsKKwlkZWZh
dWx0OgorCQkvKiBzaG91bGQgbmV2ZXIgcmVhY2ggdGhpcyBwYXRoICovCisJCXJldHVybiAtRUlO
VkFMOworCX0KIAogCXJldHVybiByZWdtYXBfd3JpdGVfYml0cyhwcml2LT5yZWdtYXAxNiwgUURF
Q0NUTCwgUURFQ0NUTF9RU1JDLAotCQkJCSBmdW5jdGlvbiA8PCBRREVDQ1RMX1FTUkNfU0hJRlQp
OworCQkJCSBxc3JjIDw8IFFERUNDVExfUVNSQ19TSElGVCk7CiB9CiAKLXN0YXRpYyBpbnQgdGlf
ZXFlcF9hY3Rpb25fZ2V0KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCSAgICAg
IHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwKLQkJCSAgICAgIHN0cnVjdCBjb3VudGVyX3N5
bmFwc2UgKnN5bmFwc2UsIHNpemVfdCAqYWN0aW9uKQorc3RhdGljIGludCB0aV9lcWVwX2FjdGlv
bl9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCSAgICAgICBzdHJ1Y3Qg
Y291bnRlcl9jb3VudCAqY291bnQsCisJCQkgICAgICAgc3RydWN0IGNvdW50ZXJfc3luYXBzZSAq
c3luYXBzZSwKKwkJCSAgICAgICBlbnVtIGNvdW50ZXJfc3luYXBzZV9hY3Rpb24gKmFjdGlvbikK
IHsKIAlzdHJ1Y3QgdGlfZXFlcF9jbnQgKnByaXYgPSBjb3VudGVyLT5wcml2OwotCXNpemVfdCBm
dW5jdGlvbjsKKwllbnVtIGNvdW50ZXJfZnVuY3Rpb24gZnVuY3Rpb247CiAJdTMyIHFkZWNjdGw7
CiAJaW50IGVycjsKIAotCWVyciA9IHRpX2VxZXBfZnVuY3Rpb25fZ2V0KGNvdW50ZXIsIGNvdW50
LCAmZnVuY3Rpb24pOworCWVyciA9IHRpX2VxZXBfZnVuY3Rpb25fcmVhZChjb3VudGVyLCBjb3Vu
dCwgJmZ1bmN0aW9uKTsKIAlpZiAoZXJyKQogCQlyZXR1cm4gZXJyOwogCiAJc3dpdGNoIChmdW5j
dGlvbikgewotCWNhc2UgVElfRVFFUF9DT1VOVF9GVU5DX1FVQURfQ09VTlQ6CisJY2FzZSBDT1VO
VEVSX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDQ6CiAJCS8qIEluIHF1YWRyYXR1cmUgbW9kZSwgdGhl
IHJpc2luZyBhbmQgZmFsbGluZyBlZGdlIG9mIGJvdGgKIAkJICogUUVQQSBhbmQgUUVQQiB0cmln
Z2VyIFFDTEsuCiAJCSAqLwotCQkqYWN0aW9uID0gVElfRVFFUF9TWU5BUFNFX0FDVElPTl9CT1RI
X0VER0VTOworCQkqYWN0aW9uID0gQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9CT1RIX0VER0VTOwog
CQlyZXR1cm4gMDsKLQljYXNlIFRJX0VRRVBfQ09VTlRfRlVOQ19ESVJfQ09VTlQ6CisJY2FzZSBD
T1VOVEVSX0ZVTkNUSU9OX1BVTFNFX0RJUkVDVElPTjoKIAkJLyogSW4gZGlyZWN0aW9uLWNvdW50
IG1vZGUgb25seSByaXNpbmcgZWRnZSBvZiBRRVBBIGlzIGNvdW50ZWQKIAkJICogYW5kIFFFUEIg
Z2l2ZXMgZGlyZWN0aW9uLgogCQkgKi8KIAkJc3dpdGNoIChzeW5hcHNlLT5zaWduYWwtPmlkKSB7
CiAJCWNhc2UgVElfRVFFUF9TSUdOQUxfUUVQQToKLQkJCSphY3Rpb24gPSBUSV9FUUVQX1NZTkFQ
U0VfQUNUSU9OX1JJU0lOR19FREdFOworCQkJKmFjdGlvbiA9IENPVU5URVJfU1lOQVBTRV9BQ1RJ
T05fUklTSU5HX0VER0U7CiAJCQlyZXR1cm4gMDsKIAkJY2FzZSBUSV9FUUVQX1NJR05BTF9RRVBC
OgotCQkJKmFjdGlvbiA9IFRJX0VRRVBfU1lOQVBTRV9BQ1RJT05fTk9ORTsKKwkJCSphY3Rpb24g
PSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX05PTkU7CiAJCQlyZXR1cm4gMDsKIAkJZGVmYXVsdDoK
IAkJCS8qIHNob3VsZCBuZXZlciByZWFjaCB0aGlzIHBhdGggKi8KIAkJCXJldHVybiAtRUlOVkFM
OwogCQl9Ci0JY2FzZSBUSV9FUUVQX0NPVU5UX0ZVTkNfVVBfQ09VTlQ6Ci0JY2FzZSBUSV9FUUVQ
X0NPVU5UX0ZVTkNfRE9XTl9DT1VOVDoKKwljYXNlIENPVU5URVJfRlVOQ1RJT05fSU5DUkVBU0U6
CisJY2FzZSBDT1VOVEVSX0ZVTkNUSU9OX0RFQ1JFQVNFOgogCQkvKiBJbiB1cC9kb3duLWNvdW50
IG1vZGVzIG9ubHkgUUVQQSBpcyBjb3VudGVkIGFuZCBRRVBCIGlzIG5vdAogCQkgKiB1c2VkLgog
CQkgKi8KQEAgLTE4NSwxMiArMjE2LDEyIEBAIHN0YXRpYyBpbnQgdGlfZXFlcF9hY3Rpb25fZ2V0
KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKIAkJCQlyZXR1cm4gZXJyOwogCiAJCQlp
ZiAocWRlY2N0bCAmIFFERUNDVExfWENSKQotCQkJCSphY3Rpb24gPSBUSV9FUUVQX1NZTkFQU0Vf
QUNUSU9OX0JPVEhfRURHRVM7CisJCQkJKmFjdGlvbiA9IENPVU5URVJfU1lOQVBTRV9BQ1RJT05f
Qk9USF9FREdFUzsKIAkJCWVsc2UKLQkJCQkqYWN0aW9uID0gVElfRVFFUF9TWU5BUFNFX0FDVElP
Tl9SSVNJTkdfRURHRTsKKwkJCQkqYWN0aW9uID0gQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9SSVNJ
TkdfRURHRTsKIAkJCXJldHVybiAwOwogCQljYXNlIFRJX0VRRVBfU0lHTkFMX1FFUEI6Ci0JCQkq
YWN0aW9uID0gVElfRVFFUF9TWU5BUFNFX0FDVElPTl9OT05FOworCQkJKmFjdGlvbiA9IENPVU5U
RVJfU1lOQVBTRV9BQ1RJT05fTk9ORTsKIAkJCXJldHVybiAwOwogCQlkZWZhdWx0OgogCQkJLyog
c2hvdWxkIG5ldmVyIHJlYWNoIHRoaXMgcGF0aCAqLwpAQCAtMjA1LDgyICsyMzYsNjcgQEAgc3Rh
dGljIGludCB0aV9lcWVwX2FjdGlvbl9nZXQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVy
LAogc3RhdGljIGNvbnN0IHN0cnVjdCBjb3VudGVyX29wcyB0aV9lcWVwX2NvdW50ZXJfb3BzID0g
ewogCS5jb3VudF9yZWFkCT0gdGlfZXFlcF9jb3VudF9yZWFkLAogCS5jb3VudF93cml0ZQk9IHRp
X2VxZXBfY291bnRfd3JpdGUsCi0JLmZ1bmN0aW9uX2dldAk9IHRpX2VxZXBfZnVuY3Rpb25fZ2V0
LAotCS5mdW5jdGlvbl9zZXQJPSB0aV9lcWVwX2Z1bmN0aW9uX3NldCwKLQkuYWN0aW9uX2dldAk9
IHRpX2VxZXBfYWN0aW9uX2dldCwKKwkuZnVuY3Rpb25fcmVhZAk9IHRpX2VxZXBfZnVuY3Rpb25f
cmVhZCwKKwkuZnVuY3Rpb25fd3JpdGUJPSB0aV9lcWVwX2Z1bmN0aW9uX3dyaXRlLAorCS5hY3Rp
b25fcmVhZAk9IHRpX2VxZXBfYWN0aW9uX3JlYWQsCiB9OwogCi1zdGF0aWMgc3NpemVfdCB0aV9l
cWVwX3Bvc2l0aW9uX2NlaWxpbmdfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIs
Ci0JCQkJCSAgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkJCQkgICAgIHZvaWQg
KmV4dF9wcml2LCBjaGFyICpidWYpCitzdGF0aWMgaW50IHRpX2VxZXBfcG9zaXRpb25fY2VpbGlu
Z19yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkJIHN0cnVjdCBjb3Vu
dGVyX2NvdW50ICpjb3VudCwKKwkJCQkJIHU2NCAqY2VpbGluZykKIHsKIAlzdHJ1Y3QgdGlfZXFl
cF9jbnQgKnByaXYgPSBjb3VudGVyLT5wcml2OwogCXUzMiBxcG9zbWF4OwogCiAJcmVnbWFwX3Jl
YWQocHJpdi0+cmVnbWFwMzIsIFFQT1NNQVgsICZxcG9zbWF4KTsKIAotCXJldHVybiBzcHJpbnRm
KGJ1ZiwgIiV1XG4iLCBxcG9zbWF4KTsKKwkqY2VpbGluZyA9IHFwb3NtYXg7CisKKwlyZXR1cm4g
MDsKIH0KIAotc3RhdGljIHNzaXplX3QgdGlfZXFlcF9wb3NpdGlvbl9jZWlsaW5nX3dyaXRlKHN0
cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQkJICAgICAgc3RydWN0IGNvdW50ZXJf
Y291bnQgKmNvdW50LAotCQkJCQkgICAgICB2b2lkICpleHRfcHJpdiwgY29uc3QgY2hhciAqYnVm
LAotCQkJCQkgICAgICBzaXplX3QgbGVuKQorc3RhdGljIGludCB0aV9lcWVwX3Bvc2l0aW9uX2Nl
aWxpbmdfd3JpdGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCQkgIHN0cnVj
dCBjb3VudGVyX2NvdW50ICpjb3VudCwKKwkJCQkJICB1NjQgY2VpbGluZykKIHsKIAlzdHJ1Y3Qg
dGlfZXFlcF9jbnQgKnByaXYgPSBjb3VudGVyLT5wcml2OwotCWludCBlcnI7Ci0JdTMyIHJlczsK
IAotCWVyciA9IGtzdHJ0b3VpbnQoYnVmLCAwLCAmcmVzKTsKLQlpZiAoZXJyIDwgMCkKLQkJcmV0
dXJuIGVycjsKKwlpZiAoY2VpbGluZyAhPSAodTMyKWNlaWxpbmcpCisJCXJldHVybiAtRVJBTkdF
OwogCi0JcmVnbWFwX3dyaXRlKHByaXYtPnJlZ21hcDMyLCBRUE9TTUFYLCByZXMpOworCXJlZ21h
cF93cml0ZShwcml2LT5yZWdtYXAzMiwgUVBPU01BWCwgY2VpbGluZyk7CiAKLQlyZXR1cm4gbGVu
OworCXJldHVybiAwOwogfQogCi1zdGF0aWMgc3NpemVfdCB0aV9lcWVwX3Bvc2l0aW9uX2VuYWJs
ZV9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQkJICAgIHN0cnVjdCBj
b3VudGVyX2NvdW50ICpjb3VudCwKLQkJCQkJICAgIHZvaWQgKmV4dF9wcml2LCBjaGFyICpidWYp
CitzdGF0aWMgaW50IHRpX2VxZXBfcG9zaXRpb25fZW5hYmxlX3JlYWQoc3RydWN0IGNvdW50ZXJf
ZGV2aWNlICpjb3VudGVyLAorCQkJCQlzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHU4ICpl
bmFibGUpCiB7CiAJc3RydWN0IHRpX2VxZXBfY250ICpwcml2ID0gY291bnRlci0+cHJpdjsKIAl1
MzIgcWVwY3RsOwogCiAJcmVnbWFwX3JlYWQocHJpdi0+cmVnbWFwMTYsIFFFUENUTCwgJnFlcGN0
bCk7CiAKLQlyZXR1cm4gc3ByaW50ZihidWYsICIldVxuIiwgISEocWVwY3RsICYgUUVQQ1RMX1BI
RU4pKTsKKwkqZW5hYmxlID0gISEocWVwY3RsICYgUUVQQ1RMX1BIRU4pOworCisJcmV0dXJuIDA7
CiB9CiAKLXN0YXRpYyBzc2l6ZV90IHRpX2VxZXBfcG9zaXRpb25fZW5hYmxlX3dyaXRlKHN0cnVj
dCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQkJICAgICBzdHJ1Y3QgY291bnRlcl9jb3Vu
dCAqY291bnQsCi0JCQkJCSAgICAgdm9pZCAqZXh0X3ByaXYsIGNvbnN0IGNoYXIgKmJ1ZiwKLQkJ
CQkJICAgICBzaXplX3QgbGVuKQorc3RhdGljIGludCB0aV9lcWVwX3Bvc2l0aW9uX2VuYWJsZV93
cml0ZShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJCSBzdHJ1Y3QgY291bnRl
cl9jb3VudCAqY291bnQsIHU4IGVuYWJsZSkKIHsKIAlzdHJ1Y3QgdGlfZXFlcF9jbnQgKnByaXYg
PSBjb3VudGVyLT5wcml2OwotCWludCBlcnI7Ci0JYm9vbCByZXM7Ci0KLQllcnIgPSBrc3RydG9i
b29sKGJ1ZiwgJnJlcyk7Ci0JaWYgKGVyciA8IDApCi0JCXJldHVybiBlcnI7CiAKLQlyZWdtYXBf
d3JpdGVfYml0cyhwcml2LT5yZWdtYXAxNiwgUUVQQ1RMLCBRRVBDVExfUEhFTiwgcmVzID8gLTEg
OiAwKTsKKwlyZWdtYXBfd3JpdGVfYml0cyhwcml2LT5yZWdtYXAxNiwgUUVQQ1RMLCBRRVBDVExf
UEhFTiwgZW5hYmxlID8gLTEgOiAwKTsKIAotCXJldHVybiBsZW47CisJcmV0dXJuIDA7CiB9CiAK
LXN0YXRpYyBzdHJ1Y3QgY291bnRlcl9jb3VudF9leHQgdGlfZXFlcF9wb3NpdGlvbl9leHRbXSA9
IHsKLQl7Ci0JCS5uYW1lCT0gImNlaWxpbmciLAotCQkucmVhZAk9IHRpX2VxZXBfcG9zaXRpb25f
Y2VpbGluZ19yZWFkLAotCQkud3JpdGUJPSB0aV9lcWVwX3Bvc2l0aW9uX2NlaWxpbmdfd3JpdGUs
Ci0JfSwKLQl7Ci0JCS5uYW1lCT0gImVuYWJsZSIsCi0JCS5yZWFkCT0gdGlfZXFlcF9wb3NpdGlv
bl9lbmFibGVfcmVhZCwKLQkJLndyaXRlCT0gdGlfZXFlcF9wb3NpdGlvbl9lbmFibGVfd3JpdGUs
Ci0JfSwKK3N0YXRpYyBzdHJ1Y3QgY291bnRlcl9jb21wIHRpX2VxZXBfcG9zaXRpb25fZXh0W10g
PSB7CisJQ09VTlRFUl9DT01QX0NFSUxJTkcodGlfZXFlcF9wb3NpdGlvbl9jZWlsaW5nX3JlYWQs
CisJCQkgICAgIHRpX2VxZXBfcG9zaXRpb25fY2VpbGluZ193cml0ZSksCisJQ09VTlRFUl9DT01Q
X0VOQUJMRSh0aV9lcWVwX3Bvc2l0aW9uX2VuYWJsZV9yZWFkLAorCQkJICAgIHRpX2VxZXBfcG9z
aXRpb25fZW5hYmxlX3dyaXRlKSwKIH07CiAKIHN0YXRpYyBzdHJ1Y3QgY291bnRlcl9zaWduYWwg
dGlfZXFlcF9zaWduYWxzW10gPSB7CkBAIC0yOTUsMTYgKzMxMSwxNiBAQCBzdGF0aWMgc3RydWN0
IGNvdW50ZXJfc2lnbmFsIHRpX2VxZXBfc2lnbmFsc1tdID0gewogfTsKIAogc3RhdGljIGNvbnN0
IGVudW0gY291bnRlcl9mdW5jdGlvbiB0aV9lcWVwX3Bvc2l0aW9uX2Z1bmN0aW9uc1tdID0gewot
CVtUSV9FUUVQX0NPVU5UX0ZVTkNfUVVBRF9DT1VOVF0JPSBDT1VOVEVSX0ZVTkNUSU9OX1FVQURS
QVRVUkVfWDQsCi0JW1RJX0VRRVBfQ09VTlRfRlVOQ19ESVJfQ09VTlRdCT0gQ09VTlRFUl9GVU5D
VElPTl9QVUxTRV9ESVJFQ1RJT04sCi0JW1RJX0VRRVBfQ09VTlRfRlVOQ19VUF9DT1VOVF0JPSBD
T1VOVEVSX0ZVTkNUSU9OX0lOQ1JFQVNFLAotCVtUSV9FUUVQX0NPVU5UX0ZVTkNfRE9XTl9DT1VO
VF0JPSBDT1VOVEVSX0ZVTkNUSU9OX0RFQ1JFQVNFLAorCUNPVU5URVJfRlVOQ1RJT05fUVVBRFJB
VFVSRV9YNCwKKwlDT1VOVEVSX0ZVTkNUSU9OX1BVTFNFX0RJUkVDVElPTiwKKwlDT1VOVEVSX0ZV
TkNUSU9OX0lOQ1JFQVNFLAorCUNPVU5URVJfRlVOQ1RJT05fREVDUkVBU0UsCiB9OwogCiBzdGF0
aWMgY29uc3QgZW51bSBjb3VudGVyX3N5bmFwc2VfYWN0aW9uIHRpX2VxZXBfcG9zaXRpb25fc3lu
YXBzZV9hY3Rpb25zW10gPSB7Ci0JW1RJX0VRRVBfU1lOQVBTRV9BQ1RJT05fQk9USF9FREdFU10J
PSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9OX0JPVEhfRURHRVMsCi0JW1RJX0VRRVBfU1lOQVBTRV9B
Q1RJT05fUklTSU5HX0VER0VdCT0gQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9SSVNJTkdfRURHRSwK
LQlbVElfRVFFUF9TWU5BUFNFX0FDVElPTl9OT05FXQkJPSBDT1VOVEVSX1NZTkFQU0VfQUNUSU9O
X05PTkUsCisJQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9CT1RIX0VER0VTLAorCUNPVU5URVJfU1lO
QVBTRV9BQ1RJT05fUklTSU5HX0VER0UsCisJQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9OT05FLAog
fTsKIAogc3RhdGljIHN0cnVjdCBjb3VudGVyX3N5bmFwc2UgdGlfZXFlcF9wb3NpdGlvbl9zeW5h
cHNlc1tdID0gewpkaWZmIC0tZ2l0IGEvaW5jbHVkZS9saW51eC9jb3VudGVyLmggYi9pbmNsdWRl
L2xpbnV4L2NvdW50ZXIuaAppbmRleCBkMTZjZTI4MTliNDguLmI2OTI3N2Y1YzRjNSAxMDA2NDQK
LS0tIGEvaW5jbHVkZS9saW51eC9jb3VudGVyLmgKKysrIGIvaW5jbHVkZS9saW51eC9jb3VudGVy
LmgKQEAgLTYsNDIgKzYsMTg0IEBACiAjaWZuZGVmIF9DT1VOVEVSX0hfCiAjZGVmaW5lIF9DT1VO
VEVSX0hfCiAKLSNpbmNsdWRlIDxsaW51eC9jb3VudGVyX2VudW0uaD4KICNpbmNsdWRlIDxsaW51
eC9kZXZpY2UuaD4KKyNpbmNsdWRlIDxsaW51eC9rZXJuZWwuaD4KICNpbmNsdWRlIDxsaW51eC90
eXBlcy5oPgogCitzdHJ1Y3QgY291bnRlcl9kZXZpY2U7CitzdHJ1Y3QgY291bnRlcl9jb3VudDsK
K3N0cnVjdCBjb3VudGVyX3N5bmFwc2U7CitzdHJ1Y3QgY291bnRlcl9zaWduYWw7CisKK2VudW0g
Y291bnRlcl9jb21wX3R5cGUgeworCUNPVU5URVJfQ09NUF9VOCwKKwlDT1VOVEVSX0NPTVBfVTY0
LAorCUNPVU5URVJfQ09NUF9CT09MLAorCUNPVU5URVJfQ09NUF9TSUdOQUxfTEVWRUwsCisJQ09V
TlRFUl9DT01QX0ZVTkNUSU9OLAorCUNPVU5URVJfQ09NUF9TWU5BUFNFX0FDVElPTiwKKwlDT1VO
VEVSX0NPTVBfRU5VTSwKKwlDT1VOVEVSX0NPTVBfQ09VTlRfRElSRUNUSU9OLAorCUNPVU5URVJf
Q09NUF9DT1VOVF9NT0RFLAorfTsKKworZW51bSBjb3VudGVyX3Njb3BlIHsKKwlDT1VOVEVSX1ND
T1BFX0RFVklDRSwKKwlDT1VOVEVSX1NDT1BFX1NJR05BTCwKKwlDT1VOVEVSX1NDT1BFX0NPVU5U
LAorfTsKKwogZW51bSBjb3VudGVyX2NvdW50X2RpcmVjdGlvbiB7Ci0JQ09VTlRFUl9DT1VOVF9E
SVJFQ1RJT05fRk9SV0FSRCA9IDAsCi0JQ09VTlRFUl9DT1VOVF9ESVJFQ1RJT05fQkFDS1dBUkQK
KwlDT1VOVEVSX0NPVU5UX0RJUkVDVElPTl9GT1JXQVJELAorCUNPVU5URVJfQ09VTlRfRElSRUNU
SU9OX0JBQ0tXQVJELAogfTsKLWV4dGVybiBjb25zdCBjaGFyICpjb25zdCBjb3VudGVyX2NvdW50
X2RpcmVjdGlvbl9zdHJbMl07CiAKIGVudW0gY291bnRlcl9jb3VudF9tb2RlIHsKLQlDT1VOVEVS
X0NPVU5UX01PREVfTk9STUFMID0gMCwKKwlDT1VOVEVSX0NPVU5UX01PREVfTk9STUFMLAogCUNP
VU5URVJfQ09VTlRfTU9ERV9SQU5HRV9MSU1JVCwKIAlDT1VOVEVSX0NPVU5UX01PREVfTk9OX1JF
Q1lDTEUsCi0JQ09VTlRFUl9DT1VOVF9NT0RFX01PRFVMT19OCisJQ09VTlRFUl9DT1VOVF9NT0RF
X01PRFVMT19OLAogfTsKLWV4dGVybiBjb25zdCBjaGFyICpjb25zdCBjb3VudGVyX2NvdW50X21v
ZGVfc3RyWzRdOwogCi1zdHJ1Y3QgY291bnRlcl9kZXZpY2U7Ci1zdHJ1Y3QgY291bnRlcl9zaWdu
YWw7CitlbnVtIGNvdW50ZXJfZnVuY3Rpb24geworCUNPVU5URVJfRlVOQ1RJT05fSU5DUkVBU0Us
CisJQ09VTlRFUl9GVU5DVElPTl9ERUNSRUFTRSwKKwlDT1VOVEVSX0ZVTkNUSU9OX1BVTFNFX0RJ
UkVDVElPTiwKKwlDT1VOVEVSX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDFfQSwKKwlDT1VOVEVSX0ZV
TkNUSU9OX1FVQURSQVRVUkVfWDFfQiwKKwlDT1VOVEVSX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDJf
QSwKKwlDT1VOVEVSX0ZVTkNUSU9OX1FVQURSQVRVUkVfWDJfQiwKKwlDT1VOVEVSX0ZVTkNUSU9O
X1FVQURSQVRVUkVfWDQsCit9OworCitlbnVtIGNvdW50ZXJfc2lnbmFsX2xldmVsIHsKKwlDT1VO
VEVSX1NJR05BTF9MRVZFTF9MT1csCisJQ09VTlRFUl9TSUdOQUxfTEVWRUxfSElHSCwKK307CisK
K2VudW0gY291bnRlcl9zeW5hcHNlX2FjdGlvbiB7CisJQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9O
T05FLAorCUNPVU5URVJfU1lOQVBTRV9BQ1RJT05fUklTSU5HX0VER0UsCisJQ09VTlRFUl9TWU5B
UFNFX0FDVElPTl9GQUxMSU5HX0VER0UsCisJQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9CT1RIX0VE
R0VTLAorfTsKIAogLyoqCi0gKiBzdHJ1Y3QgY291bnRlcl9zaWduYWxfZXh0IC0gQ291bnRlciBT
aWduYWwgZXh0ZW5zaW9ucwotICogQG5hbWU6CWF0dHJpYnV0ZSBuYW1lCi0gKiBAcmVhZDoJcmVh
ZCBjYWxsYmFjayBmb3IgdGhpcyBhdHRyaWJ1dGU7IG1heSBiZSBOVUxMCi0gKiBAd3JpdGU6CXdy
aXRlIGNhbGxiYWNrIGZvciB0aGlzIGF0dHJpYnV0ZTsgbWF5IGJlIE5VTEwKLSAqIEBwcml2Oglk
YXRhIHByaXZhdGUgdG8gdGhlIGRyaXZlcgorICogc3RydWN0IGNvdW50ZXJfY29tcCAtIENvdW50
ZXIgY29tcG9uZW50IG5vZGUKKyAqIEB0eXBlOgkJQ291bnRlciBjb21wb25lbnQgZGF0YSB0eXBl
CisgKiBAbmFtZToJCWRldmljZS1zcGVjaWZpYyBjb21wb25lbnQgbmFtZQorICogQHByaXY6CQlj
b21wb25lbnQtcmVsZXZhbnQgZGF0YQorICogQGFjdGlvbl9yZWFkCQlTeW5hcHNlIGFjdGlvbiBt
b2RlIHJlYWQgY2FsbGJhY2suIFRoZSByZWFkIHZhbHVlIG9mIHRoZQorICoJCQlyZXNwZWN0aXZl
IFN5bmFwc2UgYWN0aW9uIG1vZGUgc2hvdWxkIGJlIHBhc3NlZCBiYWNrIHZpYQorICoJCQl0aGUg
YWN0aW9uIHBhcmFtZXRlci4KKyAqIEBkZXZpY2VfdThfcmVhZAlEZXZpY2UgdTggY29tcG9uZW50
IHJlYWQgY2FsbGJhY2suIFRoZSByZWFkIHZhbHVlIG9mIHRoZQorICoJCQlyZXNwZWN0aXZlIERl
dmljZSB1OCBjb21wb25lbnQgc2hvdWxkIGJlIHBhc3NlZCBiYWNrIHZpYQorICoJCQl0aGUgdmFs
IHBhcmFtZXRlci4KKyAqIEBjb3VudF91OF9yZWFkCUNvdW50IHU4IGNvbXBvbmVudCByZWFkIGNh
bGxiYWNrLiBUaGUgcmVhZCB2YWx1ZSBvZiB0aGUKKyAqCQkJcmVzcGVjdGl2ZSBDb3VudCB1OCBj
b21wb25lbnQgc2hvdWxkIGJlIHBhc3NlZCBiYWNrIHZpYQorICoJCQl0aGUgdmFsIHBhcmFtZXRl
ci4KKyAqIEBzaWduYWxfdThfcmVhZAlTaWduYWwgdTggY29tcG9uZW50IHJlYWQgY2FsbGJhY2su
IFRoZSByZWFkIHZhbHVlIG9mIHRoZQorICoJCQlyZXNwZWN0aXZlIFNpZ25hbCB1OCBjb21wb25l
bnQgc2hvdWxkIGJlIHBhc3NlZCBiYWNrIHZpYQorICoJCQl0aGUgdmFsIHBhcmFtZXRlci4KKyAq
IEBkZXZpY2VfdTMyX3JlYWQJRGV2aWNlIHUzMiBjb21wb25lbnQgcmVhZCBjYWxsYmFjay4gVGhl
IHJlYWQgdmFsdWUgb2YKKyAqCQkJdGhlIHJlc3BlY3RpdmUgRGV2aWNlIHUzMiBjb21wb25lbnQg
c2hvdWxkIGJlIHBhc3NlZAorICoJCQliYWNrIHZpYSB0aGUgdmFsIHBhcmFtZXRlci4KKyAqIEBj
b3VudF91MzJfcmVhZAlDb3VudCB1MzIgY29tcG9uZW50IHJlYWQgY2FsbGJhY2suIFRoZSByZWFk
IHZhbHVlIG9mIHRoZQorICoJCQlyZXNwZWN0aXZlIENvdW50IHUzMiBjb21wb25lbnQgc2hvdWxk
IGJlIHBhc3NlZCBiYWNrIHZpYQorICoJCQl0aGUgdmFsIHBhcmFtZXRlci4KKyAqIEBzaWduYWxf
dTMyX3JlYWQJU2lnbmFsIHUzMiBjb21wb25lbnQgcmVhZCBjYWxsYmFjay4gVGhlIHJlYWQgdmFs
dWUgb2YKKyAqCQkJdGhlIHJlc3BlY3RpdmUgU2lnbmFsIHUzMiBjb21wb25lbnQgc2hvdWxkIGJl
IHBhc3NlZAorICoJCQliYWNrIHZpYSB0aGUgdmFsIHBhcmFtZXRlci4KKyAqIEBkZXZpY2VfdTY0
X3JlYWQJRGV2aWNlIHU2NCBjb21wb25lbnQgcmVhZCBjYWxsYmFjay4gVGhlIHJlYWQgdmFsdWUg
b2YKKyAqCQkJdGhlIHJlc3BlY3RpdmUgRGV2aWNlIHU2NCBjb21wb25lbnQgc2hvdWxkIGJlIHBh
c3NlZAorICoJCQliYWNrIHZpYSB0aGUgdmFsIHBhcmFtZXRlci4KKyAqIEBjb3VudF91NjRfcmVh
ZAlDb3VudCB1NjQgY29tcG9uZW50IHJlYWQgY2FsbGJhY2suIFRoZSByZWFkIHZhbHVlIG9mIHRo
ZQorICoJCQlyZXNwZWN0aXZlIENvdW50IHU2NCBjb21wb25lbnQgc2hvdWxkIGJlIHBhc3NlZCBi
YWNrIHZpYQorICoJCQl0aGUgdmFsIHBhcmFtZXRlci4KKyAqIEBzaWduYWxfdTY0X3JlYWQJU2ln
bmFsIHU2NCBjb21wb25lbnQgcmVhZCBjYWxsYmFjay4gVGhlIHJlYWQgdmFsdWUgb2YKKyAqCQkJ
dGhlIHJlc3BlY3RpdmUgU2lnbmFsIHU2NCBjb21wb25lbnQgc2hvdWxkIGJlIHBhc3NlZAorICoJ
CQliYWNrIHZpYSB0aGUgdmFsIHBhcmFtZXRlci4KKyAqIEBhY3Rpb25fd3JpdGUJU3luYXBzZSBh
Y3Rpb24gbW9kZSB3cml0ZSBjYWxsYmFjay4gVGhlIHdyaXRlIHZhbHVlIG9mCisgKgkJCXRoZSBy
ZXNwZWN0aXZlIFN5bmFwc2UgYWN0aW9uIG1vZGUgaXMgcGFzc2VkIHZpYSB0aGUKKyAqCQkJYWN0
aW9uIHBhcmFtZXRlci4KKyAqIEBkZXZpY2VfdThfd3JpdGUJRGV2aWNlIHU4IGNvbXBvbmVudCB3
cml0ZSBjYWxsYmFjay4gVGhlIHdyaXRlIHZhbHVlIG9mCisgKgkJCXRoZSByZXNwZWN0aXZlIERl
dmljZSB1OCBjb21wb25lbnQgaXMgcGFzc2VkIHZpYSB0aGUgdmFsCisgKgkJCXBhcmFtZXRlci4K
KyAqIEBjb3VudF91OF93cml0ZQlDb3VudCB1OCBjb21wb25lbnQgd3JpdGUgY2FsbGJhY2suIFRo
ZSB3cml0ZSB2YWx1ZSBvZgorICoJCQl0aGUgcmVzcGVjdGl2ZSBDb3VudCB1OCBjb21wb25lbnQg
aXMgcGFzc2VkIHZpYSB0aGUgdmFsCisgKgkJCXBhcmFtZXRlci4KKyAqIEBzaWduYWxfdThfd3Jp
dGUJU2lnbmFsIHU4IGNvbXBvbmVudCB3cml0ZSBjYWxsYmFjay4gVGhlIHdyaXRlIHZhbHVlIG9m
CisgKgkJCXRoZSByZXNwZWN0aXZlIFNpZ25hbCB1OCBjb21wb25lbnQgaXMgcGFzc2VkIHZpYSB0
aGUgdmFsCisgKgkJCXBhcmFtZXRlci4KKyAqIEBkZXZpY2VfdTMyX3dyaXRlCURldmljZSB1MzIg
Y29tcG9uZW50IHdyaXRlIGNhbGxiYWNrLiBUaGUgd3JpdGUgdmFsdWUgb2YKKyAqCQkJdGhlIHJl
c3BlY3RpdmUgRGV2aWNlIHUzMiBjb21wb25lbnQgaXMgcGFzc2VkIHZpYSB0aGUKKyAqCQkJdmFs
IHBhcmFtZXRlci4KKyAqIEBjb3VudF91MzJfd3JpdGUJQ291bnQgdTMyIGNvbXBvbmVudCB3cml0
ZSBjYWxsYmFjay4gVGhlIHdyaXRlIHZhbHVlIG9mCisgKgkJCXRoZSByZXNwZWN0aXZlIENvdW50
IHUzMiBjb21wb25lbnQgaXMgcGFzc2VkIHZpYSB0aGUgdmFsCisgKgkJCXBhcmFtZXRlci4KKyAq
IEBzaWduYWxfdTMyX3dyaXRlCVNpZ25hbCB1MzIgY29tcG9uZW50IHdyaXRlIGNhbGxiYWNrLiBU
aGUgd3JpdGUgdmFsdWUgb2YKKyAqCQkJdGhlIHJlc3BlY3RpdmUgU2lnbmFsIHUzMiBjb21wb25l
bnQgaXMgcGFzc2VkIHZpYSB0aGUKKyAqCQkJdmFsIHBhcmFtZXRlci4KKyAqIEBkZXZpY2VfdTY0
X3dyaXRlCURldmljZSB1NjQgY29tcG9uZW50IHdyaXRlIGNhbGxiYWNrLiBUaGUgd3JpdGUgdmFs
dWUgb2YKKyAqCQkJdGhlIHJlc3BlY3RpdmUgRGV2aWNlIHU2NCBjb21wb25lbnQgaXMgcGFzc2Vk
IHZpYSB0aGUKKyAqCQkJdmFsIHBhcmFtZXRlci4KKyAqIEBjb3VudF91NjRfd3JpdGUJQ291bnQg
dTY0IGNvbXBvbmVudCB3cml0ZSBjYWxsYmFjay4gVGhlIHdyaXRlIHZhbHVlIG9mCisgKgkJCXRo
ZSByZXNwZWN0aXZlIENvdW50IHU2NCBjb21wb25lbnQgaXMgcGFzc2VkIHZpYSB0aGUgdmFsCisg
KgkJCXBhcmFtZXRlci4KKyAqIEBzaWduYWxfdTY0X3dyaXRlCVNpZ25hbCB1NjQgY29tcG9uZW50
IHdyaXRlIGNhbGxiYWNrLiBUaGUgd3JpdGUgdmFsdWUgb2YKKyAqCQkJdGhlIHJlc3BlY3RpdmUg
U2lnbmFsIHU2NCBjb21wb25lbnQgaXMgcGFzc2VkIHZpYSB0aGUKKyAqCQkJdmFsIHBhcmFtZXRl
ci4KICAqLwotc3RydWN0IGNvdW50ZXJfc2lnbmFsX2V4dCB7CitzdHJ1Y3QgY291bnRlcl9jb21w
IHsKKwllbnVtIGNvdW50ZXJfY29tcF90eXBlIHR5cGU7CiAJY29uc3QgY2hhciAqbmFtZTsKLQlz
c2l6ZV90ICgqcmVhZCkoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJc3RydWN0
IGNvdW50ZXJfc2lnbmFsICpzaWduYWwsIHZvaWQgKnByaXYsIGNoYXIgKmJ1Zik7Ci0Jc3NpemVf
dCAoKndyaXRlKShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCQkgc3RydWN0IGNv
dW50ZXJfc2lnbmFsICpzaWduYWwsIHZvaWQgKnByaXYsCi0JCQkgY29uc3QgY2hhciAqYnVmLCBz
aXplX3QgbGVuKTsKIAl2b2lkICpwcml2OworCXVuaW9uIHsKKwkJaW50ICgqYWN0aW9uX3JlYWQp
KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkgICBzdHJ1Y3QgY291bnRlcl9j
b3VudCAqY291bnQsCisJCQkJICAgc3RydWN0IGNvdW50ZXJfc3luYXBzZSAqc3luYXBzZSwKKwkJ
CQkgICBlbnVtIGNvdW50ZXJfc3luYXBzZV9hY3Rpb24gKmFjdGlvbik7CisJCWludCAoKmRldmlj
ZV91OF9yZWFkKShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsIHU4ICp2YWwpOworCQlp
bnQgKCpjb3VudF91OF9yZWFkKShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJ
ICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHU4ICp2YWwpOworCQlpbnQgKCpzaWdu
YWxfdThfcmVhZCkoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCSAgICAgIHN0
cnVjdCBjb3VudGVyX3NpZ25hbCAqc2lnbmFsLCB1OCAqdmFsKTsKKwkJaW50ICgqZGV2aWNlX3Uz
Ml9yZWFkKShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJICAgICAgIHUzMiAq
dmFsKTsKKwkJaW50ICgqY291bnRfdTMyX3JlYWQpKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291
bnRlciwKKwkJCQkgICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHUzMiAqdmFsKTsK
KwkJaW50ICgqc2lnbmFsX3UzMl9yZWFkKShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIs
CisJCQkJICAgICAgIHN0cnVjdCBjb3VudGVyX3NpZ25hbCAqc2lnbmFsLCB1MzIgKnZhbCk7CisJ
CWludCAoKmRldmljZV91NjRfcmVhZCkoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAor
CQkJCSAgICAgICB1NjQgKnZhbCk7CisJCWludCAoKmNvdW50X3U2NF9yZWFkKShzdHJ1Y3QgY291
bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJICAgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNv
dW50LCB1NjQgKnZhbCk7CisJCWludCAoKnNpZ25hbF91NjRfcmVhZCkoc3RydWN0IGNvdW50ZXJf
ZGV2aWNlICpjb3VudGVyLAorCQkJCSAgICAgICBzdHJ1Y3QgY291bnRlcl9zaWduYWwgKnNpZ25h
bCwgdTY0ICp2YWwpOworCX07CisJdW5pb24geworCQlpbnQgKCphY3Rpb25fd3JpdGUpKHN0cnVj
dCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkgICAgc3RydWN0IGNvdW50ZXJfY291bnQg
KmNvdW50LAorCQkJCSAgICBzdHJ1Y3QgY291bnRlcl9zeW5hcHNlICpzeW5hcHNlLAorCQkJCSAg
ICBlbnVtIGNvdW50ZXJfc3luYXBzZV9hY3Rpb24gYWN0aW9uKTsKKwkJaW50ICgqZGV2aWNlX3U4
X3dyaXRlKShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsIHU4IHZhbCk7CisJCWludCAo
KmNvdW50X3U4X3dyaXRlKShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJICAg
ICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB1OCB2YWwpOworCQlpbnQgKCpzaWduYWxf
dThfd3JpdGUpKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkgICAgICAgc3Ry
dWN0IGNvdW50ZXJfc2lnbmFsICpzaWduYWwsIHU4IHZhbCk7CisJCWludCAoKmRldmljZV91MzJf
d3JpdGUpKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKKwkJCQkJdTMyIHZhbCk7CisJ
CWludCAoKmNvdW50X3UzMl93cml0ZSkoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAor
CQkJCSAgICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHUzMiB2YWwpOworCQlpbnQg
KCpzaWduYWxfdTMyX3dyaXRlKShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkJ
CXN0cnVjdCBjb3VudGVyX3NpZ25hbCAqc2lnbmFsLCB1MzIgdmFsKTsKKwkJaW50ICgqZGV2aWNl
X3U2NF93cml0ZSkoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJCQl1NjQgdmFs
KTsKKwkJaW50ICgqY291bnRfdTY0X3dyaXRlKShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50
ZXIsCisJCQkJICAgICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgdTY0IHZhbCk7CisJ
CWludCAoKnNpZ25hbF91NjRfd3JpdGUpKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwK
KwkJCQkJc3RydWN0IGNvdW50ZXJfc2lnbmFsICpzaWduYWwsIHU2NCB2YWwpOworCX07CiB9Owog
CiAvKioKQEAgLTUxLDI0OCArMTkzLDUyIEBAIHN0cnVjdCBjb3VudGVyX3NpZ25hbF9leHQgewog
ICoJCWFzIGl0IGFwcGVhcnMgaW4gdGhlIGRhdGFzaGVldCBkb2N1bWVudGF0aW9uCiAgKiBAZXh0
OglvcHRpb25hbCBhcnJheSBvZiBDb3VudGVyIFNpZ25hbCBleHRlbnNpb25zCiAgKiBAbnVtX2V4
dDoJbnVtYmVyIG9mIENvdW50ZXIgU2lnbmFsIGV4dGVuc2lvbnMgc3BlY2lmaWVkIGluIEBleHQK
LSAqIEBwcml2OglvcHRpb25hbCBwcml2YXRlIGRhdGEgc3VwcGxpZWQgYnkgZHJpdmVyCiAgKi8K
IHN0cnVjdCBjb3VudGVyX3NpZ25hbCB7CiAJaW50IGlkOwogCWNvbnN0IGNoYXIgKm5hbWU7CiAK
LQljb25zdCBzdHJ1Y3QgY291bnRlcl9zaWduYWxfZXh0ICpleHQ7CisJc3RydWN0IGNvdW50ZXJf
Y29tcCAqZXh0OwogCXNpemVfdCBudW1fZXh0OwotCi0Jdm9pZCAqcHJpdjsKLX07Ci0KLS8qKgot
ICogc3RydWN0IGNvdW50ZXJfc2lnbmFsX2VudW1fZXh0IC0gU2lnbmFsIGVudW0gZXh0ZW5zaW9u
IGF0dHJpYnV0ZQotICogQGl0ZW1zOglBcnJheSBvZiBzdHJpbmdzCi0gKiBAbnVtX2l0ZW1zOglO
dW1iZXIgb2YgaXRlbXMgc3BlY2lmaWVkIGluIEBpdGVtcwotICogQHNldDoJU2V0IGNhbGxiYWNr
IGZ1bmN0aW9uOyBtYXkgYmUgTlVMTAotICogQGdldDoJR2V0IGNhbGxiYWNrIGZ1bmN0aW9uOyBt
YXkgYmUgTlVMTAotICoKLSAqIFRoZSBjb3VudGVyX3NpZ25hbF9lbnVtX2V4dCBzdHJ1Y3R1cmUg
Y2FuIGJlIHVzZWQgdG8gaW1wbGVtZW50IGVudW0gc3R5bGUKLSAqIFNpZ25hbCBleHRlbnNpb24g
YXR0cmlidXRlcy4gRW51bSBzdHlsZSBhdHRyaWJ1dGVzIGFyZSB0aG9zZSB3aGljaCBoYXZlIGEg
c2V0Ci0gKiBvZiBzdHJpbmdzIHRoYXQgbWFwIHRvIHVuc2lnbmVkIGludGVnZXIgdmFsdWVzLiBU
aGUgR2VuZXJpYyBDb3VudGVyIFNpZ25hbAotICogZW51bSBleHRlbnNpb24gaGVscGVyIGNvZGUg
dGFrZXMgY2FyZSBvZiBtYXBwaW5nIGJldHdlZW4gdmFsdWUgYW5kIHN0cmluZywgYXMKLSAqIHdl
bGwgYXMgZ2VuZXJhdGluZyBhICJfYXZhaWxhYmxlIiBmaWxlIHdoaWNoIGNvbnRhaW5zIGEgbGlz
dCBvZiBhbGwgYXZhaWxhYmxlCi0gKiBpdGVtcy4gVGhlIGdldCBjYWxsYmFjayBpcyB1c2VkIHRv
IHF1ZXJ5IHRoZSBjdXJyZW50bHkgYWN0aXZlIGl0ZW07IHRoZSBpbmRleAotICogb2YgdGhlIGl0
ZW0gd2l0aGluIHRoZSByZXNwZWN0aXZlIGl0ZW1zIGFycmF5IGlzIHJldHVybmVkIHZpYSB0aGUg
J2l0ZW0nCi0gKiBwYXJhbWV0ZXIuIFRoZSBzZXQgY2FsbGJhY2sgaXMgY2FsbGVkIHdoZW4gdGhl
IGF0dHJpYnV0ZSBpcyB1cGRhdGVkOyB0aGUKLSAqICdpdGVtJyBwYXJhbWV0ZXIgY29udGFpbnMg
dGhlIGluZGV4IG9mIHRoZSBuZXdseSBhY3RpdmF0ZWQgaXRlbSB3aXRoaW4gdGhlCi0gKiByZXNw
ZWN0aXZlIGl0ZW1zIGFycmF5LgotICovCi1zdHJ1Y3QgY291bnRlcl9zaWduYWxfZW51bV9leHQg
ewotCWNvbnN0IGNoYXIgKiBjb25zdCAqaXRlbXM7Ci0Jc2l6ZV90IG51bV9pdGVtczsKLQlpbnQg
KCpnZXQpKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJICAgc3RydWN0IGNvdW50
ZXJfc2lnbmFsICpzaWduYWwsIHNpemVfdCAqaXRlbSk7Ci0JaW50ICgqc2V0KShzdHJ1Y3QgY291
bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0JCSAgIHN0cnVjdCBjb3VudGVyX3NpZ25hbCAqc2lnbmFs
LCBzaXplX3QgaXRlbSk7Ci19OwotCi0vKioKLSAqIENPVU5URVJfU0lHTkFMX0VOVU0oKSAtIElu
aXRpYWxpemUgU2lnbmFsIGVudW0gZXh0ZW5zaW9uCi0gKiBAX25hbWU6CUF0dHJpYnV0ZSBuYW1l
Ci0gKiBAX2U6CQlQb2ludGVyIHRvIGEgY291bnRlcl9zaWduYWxfZW51bV9leHQgc3RydWN0dXJl
Ci0gKgotICogVGhpcyBzaG91bGQgdXN1YWxseSBiZSB1c2VkIHRvZ2V0aGVyIHdpdGggQ09VTlRF
Ul9TSUdOQUxfRU5VTV9BVkFJTEFCTEUoKQotICovCi0jZGVmaW5lIENPVU5URVJfU0lHTkFMX0VO
VU0oX25hbWUsIF9lKSBcCi17IFwKLQkubmFtZSA9IChfbmFtZSksIFwKLQkucmVhZCA9IGNvdW50
ZXJfc2lnbmFsX2VudW1fcmVhZCwgXAotCS53cml0ZSA9IGNvdW50ZXJfc2lnbmFsX2VudW1fd3Jp
dGUsIFwKLQkucHJpdiA9IChfZSkgXAotfQotCi0vKioKLSAqIENPVU5URVJfU0lHTkFMX0VOVU1f
QVZBSUxBQkxFKCkgLSBJbml0aWFsaXplIFNpZ25hbCBlbnVtIGF2YWlsYWJsZSBleHRlbnNpb24K
LSAqIEBfbmFtZToJQXR0cmlidXRlIG5hbWUgKCJfYXZhaWxhYmxlIiB3aWxsIGJlIGFwcGVuZGVk
IHRvIHRoZSBuYW1lKQotICogQF9lOgkJUG9pbnRlciB0byBhIGNvdW50ZXJfc2lnbmFsX2VudW1f
ZXh0IHN0cnVjdHVyZQotICoKLSAqIENyZWF0ZXMgYSByZWFkIG9ubHkgYXR0cmlidXRlIHRoYXQg
bGlzdHMgYWxsIHRoZSBhdmFpbGFibGUgZW51bSBpdGVtcyBpbiBhCi0gKiBuZXdsaW5lIHNlcGFy
YXRlZCBsaXN0LiBUaGlzIHNob3VsZCB1c3VhbGx5IGJlIHVzZWQgdG9nZXRoZXIgd2l0aAotICog
Q09VTlRFUl9TSUdOQUxfRU5VTSgpCi0gKi8KLSNkZWZpbmUgQ09VTlRFUl9TSUdOQUxfRU5VTV9B
VkFJTEFCTEUoX25hbWUsIF9lKSBcCi17IFwKLQkubmFtZSA9IChfbmFtZSAiX2F2YWlsYWJsZSIp
LCBcCi0JLnJlYWQgPSBjb3VudGVyX3NpZ25hbF9lbnVtX2F2YWlsYWJsZV9yZWFkLCBcCi0JLnBy
aXYgPSAoX2UpIFwKLX0KLQotZW51bSBjb3VudGVyX3N5bmFwc2VfYWN0aW9uIHsKLQlDT1VOVEVS
X1NZTkFQU0VfQUNUSU9OX05PTkUgPSAwLAotCUNPVU5URVJfU1lOQVBTRV9BQ1RJT05fUklTSU5H
X0VER0UsCi0JQ09VTlRFUl9TWU5BUFNFX0FDVElPTl9GQUxMSU5HX0VER0UsCi0JQ09VTlRFUl9T
WU5BUFNFX0FDVElPTl9CT1RIX0VER0VTCiB9OwogCiAvKioKICAqIHN0cnVjdCBjb3VudGVyX3N5
bmFwc2UgLSBDb3VudGVyIFN5bmFwc2Ugbm9kZQotICogQGFjdGlvbjoJCWluZGV4IG9mIGN1cnJl
bnQgYWN0aW9uIG1vZGUKICAqIEBhY3Rpb25zX2xpc3Q6CWFycmF5IG9mIGF2YWlsYWJsZSBhY3Rp
b24gbW9kZXMKICAqIEBudW1fYWN0aW9uczoJbnVtYmVyIG9mIGFjdGlvbiBtb2RlcyBzcGVjaWZp
ZWQgaW4gQGFjdGlvbnNfbGlzdAogICogQHNpZ25hbDoJCXBvaW50ZXIgdG8gYXNzb2NpYXRlZCBz
aWduYWwKICAqLwogc3RydWN0IGNvdW50ZXJfc3luYXBzZSB7Ci0Jc2l6ZV90IGFjdGlvbjsKIAlj
b25zdCBlbnVtIGNvdW50ZXJfc3luYXBzZV9hY3Rpb24gKmFjdGlvbnNfbGlzdDsKIAlzaXplX3Qg
bnVtX2FjdGlvbnM7CiAKIAlzdHJ1Y3QgY291bnRlcl9zaWduYWwgKnNpZ25hbDsKIH07CiAKLXN0
cnVjdCBjb3VudGVyX2NvdW50OwotCi0vKioKLSAqIHN0cnVjdCBjb3VudGVyX2NvdW50X2V4dCAt
IENvdW50ZXIgQ291bnQgZXh0ZW5zaW9uCi0gKiBAbmFtZToJYXR0cmlidXRlIG5hbWUKLSAqIEBy
ZWFkOglyZWFkIGNhbGxiYWNrIGZvciB0aGlzIGF0dHJpYnV0ZTsgbWF5IGJlIE5VTEwKLSAqIEB3
cml0ZToJd3JpdGUgY2FsbGJhY2sgZm9yIHRoaXMgYXR0cmlidXRlOyBtYXkgYmUgTlVMTAotICog
QHByaXY6CWRhdGEgcHJpdmF0ZSB0byB0aGUgZHJpdmVyCi0gKi8KLXN0cnVjdCBjb3VudGVyX2Nv
dW50X2V4dCB7Ci0JY29uc3QgY2hhciAqbmFtZTsKLQlzc2l6ZV90ICgqcmVhZCkoc3RydWN0IGNv
dW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCB2
b2lkICpwcml2LCBjaGFyICpidWYpOwotCXNzaXplX3QgKCp3cml0ZSkoc3RydWN0IGNvdW50ZXJf
ZGV2aWNlICpjb3VudGVyLAotCQkJIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwgdm9pZCAq
cHJpdiwKLQkJCSBjb25zdCBjaGFyICpidWYsIHNpemVfdCBsZW4pOwotCXZvaWQgKnByaXY7Ci19
OwotCi1lbnVtIGNvdW50ZXJfZnVuY3Rpb24gewotCUNPVU5URVJfRlVOQ1RJT05fSU5DUkVBU0Ug
PSAwLAotCUNPVU5URVJfRlVOQ1RJT05fREVDUkVBU0UsCi0JQ09VTlRFUl9GVU5DVElPTl9QVUxT
RV9ESVJFQ1RJT04sCi0JQ09VTlRFUl9GVU5DVElPTl9RVUFEUkFUVVJFX1gxX0EsCi0JQ09VTlRF
Ul9GVU5DVElPTl9RVUFEUkFUVVJFX1gxX0IsCi0JQ09VTlRFUl9GVU5DVElPTl9RVUFEUkFUVVJF
X1gyX0EsCi0JQ09VTlRFUl9GVU5DVElPTl9RVUFEUkFUVVJFX1gyX0IsCi0JQ09VTlRFUl9GVU5D
VElPTl9RVUFEUkFUVVJFX1g0Ci19OwotCiAvKioKICAqIHN0cnVjdCBjb3VudGVyX2NvdW50IC0g
Q291bnRlciBDb3VudCBub2RlCiAgKiBAaWQ6CQkJdW5pcXVlIElEIHVzZWQgdG8gaWRlbnRpZnkg
Q291bnQKICAqIEBuYW1lOgkJZGV2aWNlLXNwZWNpZmljIENvdW50IG5hbWU7IGlkZWFsbHksIHRo
aXMgc2hvdWxkIG1hdGNoCiAgKgkJCXRoZSBuYW1lIGFzIGl0IGFwcGVhcnMgaW4gdGhlIGRhdGFz
aGVldCBkb2N1bWVudGF0aW9uCi0gKiBAZnVuY3Rpb246CQlpbmRleCBvZiBjdXJyZW50IGZ1bmN0
aW9uIG1vZGUKICAqIEBmdW5jdGlvbnNfbGlzdDoJYXJyYXkgYXZhaWxhYmxlIGZ1bmN0aW9uIG1v
ZGVzCiAgKiBAbnVtX2Z1bmN0aW9uczoJbnVtYmVyIG9mIGZ1bmN0aW9uIG1vZGVzIHNwZWNpZmll
ZCBpbiBAZnVuY3Rpb25zX2xpc3QKICAqIEBzeW5hcHNlczoJCWFycmF5IG9mIHN5bmFwc2VzIGZv
ciBpbml0aWFsaXphdGlvbgogICogQG51bV9zeW5hcHNlczoJbnVtYmVyIG9mIHN5bmFwc2VzIHNw
ZWNpZmllZCBpbiBAc3luYXBzZXMKICAqIEBleHQ6CQlvcHRpb25hbCBhcnJheSBvZiBDb3VudGVy
IENvdW50IGV4dGVuc2lvbnMKICAqIEBudW1fZXh0OgkJbnVtYmVyIG9mIENvdW50ZXIgQ291bnQg
ZXh0ZW5zaW9ucyBzcGVjaWZpZWQgaW4gQGV4dAotICogQHByaXY6CQlvcHRpb25hbCBwcml2YXRl
IGRhdGEgc3VwcGxpZWQgYnkgZHJpdmVyCiAgKi8KIHN0cnVjdCBjb3VudGVyX2NvdW50IHsKIAlp
bnQgaWQ7CiAJY29uc3QgY2hhciAqbmFtZTsKIAotCXNpemVfdCBmdW5jdGlvbjsKIAljb25zdCBl
bnVtIGNvdW50ZXJfZnVuY3Rpb24gKmZ1bmN0aW9uc19saXN0OwogCXNpemVfdCBudW1fZnVuY3Rp
b25zOwogCiAJc3RydWN0IGNvdW50ZXJfc3luYXBzZSAqc3luYXBzZXM7CiAJc2l6ZV90IG51bV9z
eW5hcHNlczsKIAotCWNvbnN0IHN0cnVjdCBjb3VudGVyX2NvdW50X2V4dCAqZXh0OworCXN0cnVj
dCBjb3VudGVyX2NvbXAgKmV4dDsKIAlzaXplX3QgbnVtX2V4dDsKLQotCXZvaWQgKnByaXY7Ci19
OwotCi0vKioKLSAqIHN0cnVjdCBjb3VudGVyX2NvdW50X2VudW1fZXh0IC0gQ291bnQgZW51bSBl
eHRlbnNpb24gYXR0cmlidXRlCi0gKiBAaXRlbXM6CUFycmF5IG9mIHN0cmluZ3MKLSAqIEBudW1f
aXRlbXM6CU51bWJlciBvZiBpdGVtcyBzcGVjaWZpZWQgaW4gQGl0ZW1zCi0gKiBAc2V0OglTZXQg
Y2FsbGJhY2sgZnVuY3Rpb247IG1heSBiZSBOVUxMCi0gKiBAZ2V0OglHZXQgY2FsbGJhY2sgZnVu
Y3Rpb247IG1heSBiZSBOVUxMCi0gKgotICogVGhlIGNvdW50ZXJfY291bnRfZW51bV9leHQgc3Ry
dWN0dXJlIGNhbiBiZSB1c2VkIHRvIGltcGxlbWVudCBlbnVtIHN0eWxlCi0gKiBDb3VudCBleHRl
bnNpb24gYXR0cmlidXRlcy4gRW51bSBzdHlsZSBhdHRyaWJ1dGVzIGFyZSB0aG9zZSB3aGljaCBo
YXZlIGEgc2V0Ci0gKiBvZiBzdHJpbmdzIHRoYXQgbWFwIHRvIHVuc2lnbmVkIGludGVnZXIgdmFs
dWVzLiBUaGUgR2VuZXJpYyBDb3VudGVyIENvdW50Ci0gKiBlbnVtIGV4dGVuc2lvbiBoZWxwZXIg
Y29kZSB0YWtlcyBjYXJlIG9mIG1hcHBpbmcgYmV0d2VlbiB2YWx1ZSBhbmQgc3RyaW5nLCBhcwot
ICogd2VsbCBhcyBnZW5lcmF0aW5nIGEgIl9hdmFpbGFibGUiIGZpbGUgd2hpY2ggY29udGFpbnMg
YSBsaXN0IG9mIGFsbCBhdmFpbGFibGUKLSAqIGl0ZW1zLiBUaGUgZ2V0IGNhbGxiYWNrIGlzIHVz
ZWQgdG8gcXVlcnkgdGhlIGN1cnJlbnRseSBhY3RpdmUgaXRlbTsgdGhlIGluZGV4Ci0gKiBvZiB0
aGUgaXRlbSB3aXRoaW4gdGhlIHJlc3BlY3RpdmUgaXRlbXMgYXJyYXkgaXMgcmV0dXJuZWQgdmlh
IHRoZSAnaXRlbScKLSAqIHBhcmFtZXRlci4gVGhlIHNldCBjYWxsYmFjayBpcyBjYWxsZWQgd2hl
biB0aGUgYXR0cmlidXRlIGlzIHVwZGF0ZWQ7IHRoZQotICogJ2l0ZW0nIHBhcmFtZXRlciBjb250
YWlucyB0aGUgaW5kZXggb2YgdGhlIG5ld2x5IGFjdGl2YXRlZCBpdGVtIHdpdGhpbiB0aGUKLSAq
IHJlc3BlY3RpdmUgaXRlbXMgYXJyYXkuCi0gKi8KLXN0cnVjdCBjb3VudGVyX2NvdW50X2VudW1f
ZXh0IHsKLQljb25zdCBjaGFyICogY29uc3QgKml0ZW1zOwotCXNpemVfdCBudW1faXRlbXM7Ci0J
aW50ICgqZ2V0KShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsIHN0cnVjdCBjb3VudGVy
X2NvdW50ICpjb3VudCwKLQkJICAgc2l6ZV90ICppdGVtKTsKLQlpbnQgKCpzZXQpKHN0cnVjdCBj
b3VudGVyX2RldmljZSAqY291bnRlciwgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkg
ICBzaXplX3QgaXRlbSk7Ci19OwotCi0vKioKLSAqIENPVU5URVJfQ09VTlRfRU5VTSgpIC0gSW5p
dGlhbGl6ZSBDb3VudCBlbnVtIGV4dGVuc2lvbgotICogQF9uYW1lOglBdHRyaWJ1dGUgbmFtZQot
ICogQF9lOgkJUG9pbnRlciB0byBhIGNvdW50ZXJfY291bnRfZW51bV9leHQgc3RydWN0dXJlCi0g
KgotICogVGhpcyBzaG91bGQgdXN1YWxseSBiZSB1c2VkIHRvZ2V0aGVyIHdpdGggQ09VTlRFUl9D
T1VOVF9FTlVNX0FWQUlMQUJMRSgpCi0gKi8KLSNkZWZpbmUgQ09VTlRFUl9DT1VOVF9FTlVNKF9u
YW1lLCBfZSkgXAoteyBcCi0JLm5hbWUgPSAoX25hbWUpLCBcCi0JLnJlYWQgPSBjb3VudGVyX2Nv
dW50X2VudW1fcmVhZCwgXAotCS53cml0ZSA9IGNvdW50ZXJfY291bnRfZW51bV93cml0ZSwgXAot
CS5wcml2ID0gKF9lKSBcCi19Ci0KLS8qKgotICogQ09VTlRFUl9DT1VOVF9FTlVNX0FWQUlMQUJM
RSgpIC0gSW5pdGlhbGl6ZSBDb3VudCBlbnVtIGF2YWlsYWJsZSBleHRlbnNpb24KLSAqIEBfbmFt
ZToJQXR0cmlidXRlIG5hbWUgKCJfYXZhaWxhYmxlIiB3aWxsIGJlIGFwcGVuZGVkIHRvIHRoZSBu
YW1lKQotICogQF9lOgkJUG9pbnRlciB0byBhIGNvdW50ZXJfY291bnRfZW51bV9leHQgc3RydWN0
dXJlCi0gKgotICogQ3JlYXRlcyBhIHJlYWQgb25seSBhdHRyaWJ1dGUgdGhhdCBsaXN0cyBhbGwg
dGhlIGF2YWlsYWJsZSBlbnVtIGl0ZW1zIGluIGEKLSAqIG5ld2xpbmUgc2VwYXJhdGVkIGxpc3Qu
IFRoaXMgc2hvdWxkIHVzdWFsbHkgYmUgdXNlZCB0b2dldGhlciB3aXRoCi0gKiBDT1VOVEVSX0NP
VU5UX0VOVU0oKQotICovCi0jZGVmaW5lIENPVU5URVJfQ09VTlRfRU5VTV9BVkFJTEFCTEUoX25h
bWUsIF9lKSBcCi17IFwKLQkubmFtZSA9IChfbmFtZSAiX2F2YWlsYWJsZSIpLCBcCi0JLnJlYWQg
PSBjb3VudGVyX2NvdW50X2VudW1fYXZhaWxhYmxlX3JlYWQsIFwKLQkucHJpdiA9IChfZSkgXAot
fQotCi0vKioKLSAqIHN0cnVjdCBjb3VudGVyX2RldmljZV9hdHRyX2dyb3VwIC0gaW50ZXJuYWwg
Y29udGFpbmVyIGZvciBhdHRyaWJ1dGUgZ3JvdXAKLSAqIEBhdHRyX2dyb3VwOglDb3VudGVyIHN5
c2ZzIGF0dHJpYnV0ZXMgZ3JvdXAKLSAqIEBhdHRyX2xpc3Q6CWxpc3QgdG8ga2VlcCB0cmFjayBv
ZiBjcmVhdGVkIENvdW50ZXIgc3lzZnMgYXR0cmlidXRlcwotICogQG51bV9hdHRyOgludW1iZXIg
b2YgQ291bnRlciBzeXNmcyBhdHRyaWJ1dGVzCi0gKi8KLXN0cnVjdCBjb3VudGVyX2RldmljZV9h
dHRyX2dyb3VwIHsKLQlzdHJ1Y3QgYXR0cmlidXRlX2dyb3VwIGF0dHJfZ3JvdXA7Ci0Jc3RydWN0
IGxpc3RfaGVhZCBhdHRyX2xpc3Q7Ci0Jc2l6ZV90IG51bV9hdHRyOwotfTsKLQotLyoqCi0gKiBz
dHJ1Y3QgY291bnRlcl9kZXZpY2Vfc3RhdGUgLSBpbnRlcm5hbCBzdGF0ZSBjb250YWluZXIgZm9y
IGEgQ291bnRlciBkZXZpY2UKLSAqIEBpZDoJCQl1bmlxdWUgSUQgdXNlZCB0byBpZGVudGlmeSB0
aGUgQ291bnRlcgotICogQGRldjoJCWludGVybmFsIGRldmljZSBzdHJ1Y3R1cmUKLSAqIEBncm91
cHNfbGlzdDoJYXR0cmlidXRlIGdyb3VwcyBsaXN0IChmb3IgU2lnbmFscywgQ291bnRzLCBhbmQg
ZXh0KQotICogQG51bV9ncm91cHM6CQludW1iZXIgb2YgYXR0cmlidXRlIGdyb3VwcyBjb250YWlu
ZXJzCi0gKiBAZ3JvdXBzOgkJQ291bnRlciBzeXNmcyBhdHRyaWJ1dGUgZ3JvdXBzICh0byBwb3B1
bGF0ZSBAZGV2Lmdyb3VwcykKLSAqLwotc3RydWN0IGNvdW50ZXJfZGV2aWNlX3N0YXRlIHsKLQlp
bnQgaWQ7Ci0Jc3RydWN0IGRldmljZSBkZXY7Ci0Jc3RydWN0IGNvdW50ZXJfZGV2aWNlX2F0dHJf
Z3JvdXAgKmdyb3Vwc19saXN0OwotCXNpemVfdCBudW1fZ3JvdXBzOwotCWNvbnN0IHN0cnVjdCBh
dHRyaWJ1dGVfZ3JvdXAgKipncm91cHM7Ci19OwotCi1lbnVtIGNvdW50ZXJfc2lnbmFsX2xldmVs
IHsKLQlDT1VOVEVSX1NJR05BTF9MRVZFTF9MT1csCi0JQ09VTlRFUl9TSUdOQUxfTEVWRUxfSElH
SCwKIH07CiAKIC8qKgpAQCAtMzA2LDExNyArMjUyLDQ3IEBAIGVudW0gY291bnRlcl9zaWduYWxf
bGV2ZWwgewogICogQGNvdW50X3dyaXRlOglvcHRpb25hbCB3cml0ZSBjYWxsYmFjayBmb3IgQ291
bnQgYXR0cmlidXRlLiBUaGUgd3JpdGUKICAqCQkJdmFsdWUgZm9yIHRoZSByZXNwZWN0aXZlIENv
dW50IGlzIHBhc3NlZCBpbiB2aWEgdGhlIHZhbAogICoJCQlwYXJhbWV0ZXIuCi0gKiBAZnVuY3Rp
b25fZ2V0OglmdW5jdGlvbiB0byBnZXQgdGhlIGN1cnJlbnQgY291bnQgZnVuY3Rpb24gbW9kZS4g
UmV0dXJucwotICoJCQkwIG9uIHN1Y2Nlc3MgYW5kIG5lZ2F0aXZlIGVycm9yIGNvZGUgb24gZXJy
b3IuIFRoZSBpbmRleAotICoJCQlvZiB0aGUgcmVzcGVjdGl2ZSBDb3VudCdzIHJldHVybmVkIGZ1
bmN0aW9uIG1vZGUgc2hvdWxkCi0gKgkJCWJlIHBhc3NlZCBiYWNrIHZpYSB0aGUgZnVuY3Rpb24g
cGFyYW1ldGVyLgotICogQGZ1bmN0aW9uX3NldDoJZnVuY3Rpb24gdG8gc2V0IHRoZSBjb3VudCBm
dW5jdGlvbiBtb2RlLiBmdW5jdGlvbiBpcyB0aGUKLSAqCQkJaW5kZXggb2YgdGhlIHJlcXVlc3Rl
ZCBmdW5jdGlvbiBtb2RlIGZyb20gdGhlIHJlc3BlY3RpdmUKLSAqCQkJQ291bnQncyBmdW5jdGlv
bnNfbGlzdCBhcnJheS4KLSAqIEBhY3Rpb25fZ2V0OgkJZnVuY3Rpb24gdG8gZ2V0IHRoZSBjdXJy
ZW50IGFjdGlvbiBtb2RlLiBSZXR1cm5zIDAgb24KLSAqCQkJc3VjY2VzcyBhbmQgbmVnYXRpdmUg
ZXJyb3IgY29kZSBvbiBlcnJvci4gVGhlIGluZGV4IG9mCi0gKgkJCXRoZSByZXNwZWN0aXZlIFN5
bmFwc2UncyByZXR1cm5lZCBhY3Rpb24gbW9kZSBzaG91bGQgYmUKLSAqCQkJcGFzc2VkIGJhY2sg
dmlhIHRoZSBhY3Rpb24gcGFyYW1ldGVyLgotICogQGFjdGlvbl9zZXQ6CQlmdW5jdGlvbiB0byBz
ZXQgdGhlIGFjdGlvbiBtb2RlLiBhY3Rpb24gaXMgdGhlIGluZGV4IG9mCi0gKgkJCXRoZSByZXF1
ZXN0ZWQgYWN0aW9uIG1vZGUgZnJvbSB0aGUgcmVzcGVjdGl2ZSBTeW5hcHNlJ3MKLSAqCQkJYWN0
aW9uc19saXN0IGFycmF5LgorICogQGZ1bmN0aW9uX3JlYWQ6CXJlYWQgY2FsbGJhY2sgdGhlIENv
dW50IGZ1bmN0aW9uIG1vZGVzLiBUaGUgcmVhZAorICoJCQlmdW5jdGlvbiBtb2RlIG9mIHRoZSBy
ZXNwZWN0aXZlIENvdW50IHNob3VsZCBiZSBwYXNzZWQKKyAqCQkJYmFjayB2aWEgdGhlIGZ1bmN0
aW9uIHBhcmFtZXRlci4KKyAqIEBmdW5jdGlvbl93cml0ZToJd3JpdGUgY2FsbGJhY2sgZm9yIENv
dW50IGZ1bmN0aW9uIG1vZGVzLiBUaGUgZnVuY3Rpb24KKyAqCQkJbW9kZSB0byB3cml0ZSBmb3Ig
dGhlIHJlc3BlY3RpdmUgQ291bnQgaXMgcGFzc2VkIGluIHZpYQorICoJCQl0aGUgZnVuY3Rpb24g
cGFyYW1ldGVyLgorICogQGFjdGlvbl9yZWFkOglyZWFkIGNhbGxiYWNrIHRoZSBTeW5hcHNlIGFj
dGlvbiBtb2Rlcy4gVGhlIHJlYWQgYWN0aW9uCisgKgkJCW1vZGUgb2YgdGhlIHJlc3BlY3RpdmUg
U3luYXBzZSBzaG91bGQgYmUgcGFzc2VkIGJhY2sgdmlhCisgKgkJCXRoZSBhY3Rpb24gcGFyYW1l
dGVyLgorICogQGFjdGlvbl93cml0ZToJd3JpdGUgY2FsbGJhY2sgZm9yIFN5bmFwc2UgYWN0aW9u
IG1vZGVzLiBUaGUgYWN0aW9uIG1vZGUKKyAqCQkJdG8gd3JpdGUgZm9yIHRoZSByZXNwZWN0aXZl
IFN5bmFwc2UgaXMgcGFzc2VkIGluIHZpYSB0aGUKKyAqCQkJYWN0aW9uIHBhcmFtZXRlci4KICAq
Lwogc3RydWN0IGNvdW50ZXJfb3BzIHsKIAlpbnQgKCpzaWduYWxfcmVhZCkoc3RydWN0IGNvdW50
ZXJfZGV2aWNlICpjb3VudGVyLAogCQkJICAgc3RydWN0IGNvdW50ZXJfc2lnbmFsICpzaWduYWws
CiAJCQkgICBlbnVtIGNvdW50ZXJfc2lnbmFsX2xldmVsICpsZXZlbCk7CiAJaW50ICgqY291bnRf
cmVhZCkoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJICBzdHJ1Y3QgY291bnRl
cl9jb3VudCAqY291bnQsIHVuc2lnbmVkIGxvbmcgKnZhbCk7CisJCQkgIHN0cnVjdCBjb3VudGVy
X2NvdW50ICpjb3VudCwgdTY0ICp2YWx1ZSk7CiAJaW50ICgqY291bnRfd3JpdGUpKHN0cnVjdCBj
b3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCSAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3Vu
dCwgdW5zaWduZWQgbG9uZyB2YWwpOwotCWludCAoKmZ1bmN0aW9uX2dldCkoc3RydWN0IGNvdW50
ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudCwg
c2l6ZV90ICpmdW5jdGlvbik7Ci0JaW50ICgqZnVuY3Rpb25fc2V0KShzdHJ1Y3QgY291bnRlcl9k
ZXZpY2UgKmNvdW50ZXIsCi0JCQkgICAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LCBzaXpl
X3QgZnVuY3Rpb24pOwotCWludCAoKmFjdGlvbl9nZXQpKHN0cnVjdCBjb3VudGVyX2RldmljZSAq
Y291bnRlciwKLQkJCSAgc3RydWN0IGNvdW50ZXJfY291bnQgKmNvdW50LAotCQkJICBzdHJ1Y3Qg
Y291bnRlcl9zeW5hcHNlICpzeW5hcHNlLCBzaXplX3QgKmFjdGlvbik7Ci0JaW50ICgqYWN0aW9u
X3NldCkoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJICBzdHJ1Y3QgY291bnRl
cl9jb3VudCAqY291bnQsCi0JCQkgIHN0cnVjdCBjb3VudGVyX3N5bmFwc2UgKnN5bmFwc2UsIHNp
emVfdCBhY3Rpb24pOwotfTsKLQotLyoqCi0gKiBzdHJ1Y3QgY291bnRlcl9kZXZpY2VfZXh0IC0g
Q291bnRlciBkZXZpY2UgZXh0ZW5zaW9uCi0gKiBAbmFtZToJYXR0cmlidXRlIG5hbWUKLSAqIEBy
ZWFkOglyZWFkIGNhbGxiYWNrIGZvciB0aGlzIGF0dHJpYnV0ZTsgbWF5IGJlIE5VTEwKLSAqIEB3
cml0ZToJd3JpdGUgY2FsbGJhY2sgZm9yIHRoaXMgYXR0cmlidXRlOyBtYXkgYmUgTlVMTAotICog
QHByaXY6CWRhdGEgcHJpdmF0ZSB0byB0aGUgZHJpdmVyCi0gKi8KLXN0cnVjdCBjb3VudGVyX2Rl
dmljZV9leHQgewotCWNvbnN0IGNoYXIgKm5hbWU7Ci0Jc3NpemVfdCAoKnJlYWQpKHN0cnVjdCBj
b3VudGVyX2RldmljZSAqY291bnRlciwgdm9pZCAqcHJpdiwgY2hhciAqYnVmKTsKLQlzc2l6ZV90
ICgqd3JpdGUpKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwgdm9pZCAqcHJpdiwKLQkJ
CSBjb25zdCBjaGFyICpidWYsIHNpemVfdCBsZW4pOwotCXZvaWQgKnByaXY7CisJCQkgICBzdHJ1
Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHU2NCB2YWx1ZSk7CisJaW50ICgqZnVuY3Rpb25fcmVh
ZCkoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJICAgICBzdHJ1Y3QgY291bnRl
cl9jb3VudCAqY291bnQsCisJCQkgICAgIGVudW0gY291bnRlcl9mdW5jdGlvbiAqZnVuY3Rpb24p
OworCWludCAoKmZ1bmN0aW9uX3dyaXRlKShzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIs
CisJCQkgICAgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsCisJCQkgICAgICBlbnVtIGNv
dW50ZXJfZnVuY3Rpb24gZnVuY3Rpb24pOworCWludCAoKmFjdGlvbl9yZWFkKShzdHJ1Y3QgY291
bnRlcl9kZXZpY2UgKmNvdW50ZXIsCisJCQkgICBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQs
CisJCQkgICBzdHJ1Y3QgY291bnRlcl9zeW5hcHNlICpzeW5hcHNlLAorCQkJICAgZW51bSBjb3Vu
dGVyX3N5bmFwc2VfYWN0aW9uICphY3Rpb24pOworCWludCAoKmFjdGlvbl93cml0ZSkoc3RydWN0
IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAorCQkJICAgIHN0cnVjdCBjb3VudGVyX2NvdW50ICpj
b3VudCwKKwkJCSAgICBzdHJ1Y3QgY291bnRlcl9zeW5hcHNlICpzeW5hcHNlLAorCQkJICAgIGVu
dW0gY291bnRlcl9zeW5hcHNlX2FjdGlvbiBhY3Rpb24pOwogfTsKIAotLyoqCi0gKiBzdHJ1Y3Qg
Y291bnRlcl9kZXZpY2VfZW51bV9leHQgLSBDb3VudGVyIGVudW0gZXh0ZW5zaW9uIGF0dHJpYnV0
ZQotICogQGl0ZW1zOglBcnJheSBvZiBzdHJpbmdzCi0gKiBAbnVtX2l0ZW1zOglOdW1iZXIgb2Yg
aXRlbXMgc3BlY2lmaWVkIGluIEBpdGVtcwotICogQHNldDoJU2V0IGNhbGxiYWNrIGZ1bmN0aW9u
OyBtYXkgYmUgTlVMTAotICogQGdldDoJR2V0IGNhbGxiYWNrIGZ1bmN0aW9uOyBtYXkgYmUgTlVM
TAotICoKLSAqIFRoZSBjb3VudGVyX2RldmljZV9lbnVtX2V4dCBzdHJ1Y3R1cmUgY2FuIGJlIHVz
ZWQgdG8gaW1wbGVtZW50IGVudW0gc3R5bGUKLSAqIENvdW50ZXIgZXh0ZW5zaW9uIGF0dHJpYnV0
ZXMuIEVudW0gc3R5bGUgYXR0cmlidXRlcyBhcmUgdGhvc2Ugd2hpY2ggaGF2ZSBhCi0gKiBzZXQg
b2Ygc3RyaW5ncyB0aGF0IG1hcCB0byB1bnNpZ25lZCBpbnRlZ2VyIHZhbHVlcy4gVGhlIEdlbmVy
aWMgQ291bnRlciBlbnVtCi0gKiBleHRlbnNpb24gaGVscGVyIGNvZGUgdGFrZXMgY2FyZSBvZiBt
YXBwaW5nIGJldHdlZW4gdmFsdWUgYW5kIHN0cmluZywgYXMgd2VsbAotICogYXMgZ2VuZXJhdGlu
ZyBhICJfYXZhaWxhYmxlIiBmaWxlIHdoaWNoIGNvbnRhaW5zIGEgbGlzdCBvZiBhbGwgYXZhaWxh
YmxlCi0gKiBpdGVtcy4gVGhlIGdldCBjYWxsYmFjayBpcyB1c2VkIHRvIHF1ZXJ5IHRoZSBjdXJy
ZW50bHkgYWN0aXZlIGl0ZW07IHRoZSBpbmRleAotICogb2YgdGhlIGl0ZW0gd2l0aGluIHRoZSBy
ZXNwZWN0aXZlIGl0ZW1zIGFycmF5IGlzIHJldHVybmVkIHZpYSB0aGUgJ2l0ZW0nCi0gKiBwYXJh
bWV0ZXIuIFRoZSBzZXQgY2FsbGJhY2sgaXMgY2FsbGVkIHdoZW4gdGhlIGF0dHJpYnV0ZSBpcyB1
cGRhdGVkOyB0aGUKLSAqICdpdGVtJyBwYXJhbWV0ZXIgY29udGFpbnMgdGhlIGluZGV4IG9mIHRo
ZSBuZXdseSBhY3RpdmF0ZWQgaXRlbSB3aXRoaW4gdGhlCi0gKiByZXNwZWN0aXZlIGl0ZW1zIGFy
cmF5LgotICovCi1zdHJ1Y3QgY291bnRlcl9kZXZpY2VfZW51bV9leHQgewotCWNvbnN0IGNoYXIg
KiBjb25zdCAqaXRlbXM7Ci0Jc2l6ZV90IG51bV9pdGVtczsKLQlpbnQgKCpnZXQpKHN0cnVjdCBj
b3VudGVyX2RldmljZSAqY291bnRlciwgc2l6ZV90ICppdGVtKTsKLQlpbnQgKCpzZXQpKHN0cnVj
dCBjb3VudGVyX2RldmljZSAqY291bnRlciwgc2l6ZV90IGl0ZW0pOwotfTsKLQotLyoqCi0gKiBD
T1VOVEVSX0RFVklDRV9FTlVNKCkgLSBJbml0aWFsaXplIENvdW50ZXIgZW51bSBleHRlbnNpb24K
LSAqIEBfbmFtZToJQXR0cmlidXRlIG5hbWUKLSAqIEBfZToJCVBvaW50ZXIgdG8gYSBjb3VudGVy
X2RldmljZV9lbnVtX2V4dCBzdHJ1Y3R1cmUKLSAqCi0gKiBUaGlzIHNob3VsZCB1c3VhbGx5IGJl
IHVzZWQgdG9nZXRoZXIgd2l0aCBDT1VOVEVSX0RFVklDRV9FTlVNX0FWQUlMQUJMRSgpCi0gKi8K
LSNkZWZpbmUgQ09VTlRFUl9ERVZJQ0VfRU5VTShfbmFtZSwgX2UpIFwKLXsgXAotCS5uYW1lID0g
KF9uYW1lKSwgXAotCS5yZWFkID0gY291bnRlcl9kZXZpY2VfZW51bV9yZWFkLCBcCi0JLndyaXRl
ID0gY291bnRlcl9kZXZpY2VfZW51bV93cml0ZSwgXAotCS5wcml2ID0gKF9lKSBcCi19Ci0KLS8q
KgotICogQ09VTlRFUl9ERVZJQ0VfRU5VTV9BVkFJTEFCTEUoKSAtIEluaXRpYWxpemUgQ291bnRl
ciBlbnVtIGF2YWlsYWJsZSBleHRlbnNpb24KLSAqIEBfbmFtZToJQXR0cmlidXRlIG5hbWUgKCJf
YXZhaWxhYmxlIiB3aWxsIGJlIGFwcGVuZGVkIHRvIHRoZSBuYW1lKQotICogQF9lOgkJUG9pbnRl
ciB0byBhIGNvdW50ZXJfZGV2aWNlX2VudW1fZXh0IHN0cnVjdHVyZQotICoKLSAqIENyZWF0ZXMg
YSByZWFkIG9ubHkgYXR0cmlidXRlIHRoYXQgbGlzdHMgYWxsIHRoZSBhdmFpbGFibGUgZW51bSBp
dGVtcyBpbiBhCi0gKiBuZXdsaW5lIHNlcGFyYXRlZCBsaXN0LiBUaGlzIHNob3VsZCB1c3VhbGx5
IGJlIHVzZWQgdG9nZXRoZXIgd2l0aAotICogQ09VTlRFUl9ERVZJQ0VfRU5VTSgpCi0gKi8KLSNk
ZWZpbmUgQ09VTlRFUl9ERVZJQ0VfRU5VTV9BVkFJTEFCTEUoX25hbWUsIF9lKSBcCi17IFwKLQku
bmFtZSA9IChfbmFtZSAiX2F2YWlsYWJsZSIpLCBcCi0JLnJlYWQgPSBjb3VudGVyX2RldmljZV9l
bnVtX2F2YWlsYWJsZV9yZWFkLCBcCi0JLnByaXYgPSAoX2UpIFwKLX0KLQogLyoqCiAgKiBzdHJ1
Y3QgY291bnRlcl9kZXZpY2UgLSBDb3VudGVyIGRhdGEgc3RydWN0dXJlCiAgKiBAbmFtZToJCW5h
bWUgb2YgdGhlIGRldmljZSBhcyBpdCBhcHBlYXJzIGluIHRoZSBkYXRhc2hlZXQKICAqIEBwYXJl
bnQ6CQlvcHRpb25hbCBwYXJlbnQgZGV2aWNlIHByb3ZpZGluZyB0aGUgY291bnRlcnMKLSAqIEBk
ZXZpY2Vfc3RhdGU6CWludGVybmFsIGRldmljZSBzdGF0ZSBjb250YWluZXIKICAqIEBvcHM6CQlj
YWxsYmFja3MgZnJvbSBkcml2ZXIKICAqIEBzaWduYWxzOgkJYXJyYXkgb2YgU2lnbmFscwogICog
QG51bV9zaWduYWxzOgludW1iZXIgb2YgU2lnbmFscyBzcGVjaWZpZWQgaW4gQHNpZ25hbHMKQEAg
LTQyNSwxMSArMzAxLDExIEBAIHN0cnVjdCBjb3VudGVyX2RldmljZV9lbnVtX2V4dCB7CiAgKiBA
ZXh0OgkJb3B0aW9uYWwgYXJyYXkgb2YgQ291bnRlciBkZXZpY2UgZXh0ZW5zaW9ucwogICogQG51
bV9leHQ6CQludW1iZXIgb2YgQ291bnRlciBkZXZpY2UgZXh0ZW5zaW9ucyBzcGVjaWZpZWQgaW4g
QGV4dAogICogQHByaXY6CQlvcHRpb25hbCBwcml2YXRlIGRhdGEgc3VwcGxpZWQgYnkgZHJpdmVy
CisgKiBAZGV2OgkJaW50ZXJuYWwgZGV2aWNlIHN0cnVjdHVyZQogICovCiBzdHJ1Y3QgY291bnRl
cl9kZXZpY2UgewogCWNvbnN0IGNoYXIgKm5hbWU7CiAJc3RydWN0IGRldmljZSAqcGFyZW50Owot
CXN0cnVjdCBjb3VudGVyX2RldmljZV9zdGF0ZSAqZGV2aWNlX3N0YXRlOwogCiAJY29uc3Qgc3Ry
dWN0IGNvdW50ZXJfb3BzICpvcHM7CiAKQEAgLTQzOCwxNyArMzE0LDE1OSBAQCBzdHJ1Y3QgY291
bnRlcl9kZXZpY2UgewogCXN0cnVjdCBjb3VudGVyX2NvdW50ICpjb3VudHM7CiAJc2l6ZV90IG51
bV9jb3VudHM7CiAKLQljb25zdCBzdHJ1Y3QgY291bnRlcl9kZXZpY2VfZXh0ICpleHQ7CisJc3Ry
dWN0IGNvdW50ZXJfY29tcCAqZXh0OwogCXNpemVfdCBudW1fZXh0OwogCiAJdm9pZCAqcHJpdjsK
KworCXN0cnVjdCBkZXZpY2UgZGV2OwogfTsKIAogaW50IGNvdW50ZXJfcmVnaXN0ZXIoc3RydWN0
IGNvdW50ZXJfZGV2aWNlICpjb25zdCBjb3VudGVyKTsKIHZvaWQgY291bnRlcl91bnJlZ2lzdGVy
KHN0cnVjdCBjb3VudGVyX2RldmljZSAqY29uc3QgY291bnRlcik7CiBpbnQgZGV2bV9jb3VudGVy
X3JlZ2lzdGVyKHN0cnVjdCBkZXZpY2UgKmRldiwKIAkJCSAgc3RydWN0IGNvdW50ZXJfZGV2aWNl
ICpjb25zdCBjb3VudGVyKTsKLXZvaWQgZGV2bV9jb3VudGVyX3VucmVnaXN0ZXIoc3RydWN0IGRl
dmljZSAqZGV2LAotCQkJICAgICBzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvbnN0IGNvdW50ZXIp
OworCisjZGVmaW5lIENPVU5URVJfQ09NUF9ERVZJQ0VfVTgoX25hbWUsIF9yZWFkLCBfd3JpdGUp
IFwKK3sgXAorCS50eXBlID0gQ09VTlRFUl9DT01QX1U4LCBcCisJLm5hbWUgPSAoX25hbWUpLCBc
CisJLmRldmljZV91OF9yZWFkID0gKF9yZWFkKSwgXAorCS5kZXZpY2VfdThfd3JpdGUgPSAoX3dy
aXRlKSwgXAorfQorI2RlZmluZSBDT1VOVEVSX0NPTVBfQ09VTlRfVTgoX25hbWUsIF9yZWFkLCBf
d3JpdGUpIFwKK3sgXAorCS50eXBlID0gQ09VTlRFUl9DT01QX1U4LCBcCisJLm5hbWUgPSAoX25h
bWUpLCBcCisJLmNvdW50X3U4X3JlYWQgPSAoX3JlYWQpLCBcCisJLmNvdW50X3U4X3dyaXRlID0g
KF93cml0ZSksIFwKK30KKyNkZWZpbmUgQ09VTlRFUl9DT01QX1NJR05BTF9VOChfbmFtZSwgX3Jl
YWQsIF93cml0ZSkgXAoreyBcCisJLnR5cGUgPSBDT1VOVEVSX0NPTVBfVTgsIFwKKwkubmFtZSA9
IChfbmFtZSksIFwKKwkuc2lnbmFsX3U4X3JlYWQgPSAoX3JlYWQpLCBcCisJLnNpZ25hbF91OF93
cml0ZSA9IChfd3JpdGUpLCBcCit9CisKKyNkZWZpbmUgQ09VTlRFUl9DT01QX0RFVklDRV9VNjQo
X25hbWUsIF9yZWFkLCBfd3JpdGUpIFwKK3sgXAorCS50eXBlID0gQ09VTlRFUl9DT01QX1U2NCwg
XAorCS5uYW1lID0gKF9uYW1lKSwgXAorCS5kZXZpY2VfdTY0X3JlYWQgPSAoX3JlYWQpLCBcCisJ
LmRldmljZV91NjRfd3JpdGUgPSAoX3dyaXRlKSwgXAorfQorI2RlZmluZSBDT1VOVEVSX0NPTVBf
Q09VTlRfVTY0KF9uYW1lLCBfcmVhZCwgX3dyaXRlKSBcCit7IFwKKwkudHlwZSA9IENPVU5URVJf
Q09NUF9VNjQsIFwKKwkubmFtZSA9IChfbmFtZSksIFwKKwkuY291bnRfdTY0X3JlYWQgPSAoX3Jl
YWQpLCBcCisJLmNvdW50X3U2NF93cml0ZSA9IChfd3JpdGUpLCBcCit9CisjZGVmaW5lIENPVU5U
RVJfQ09NUF9TSUdOQUxfVTY0KF9uYW1lLCBfcmVhZCwgX3dyaXRlKSBcCit7IFwKKwkudHlwZSA9
IENPVU5URVJfQ09NUF9VNjQsIFwKKwkubmFtZSA9IChfbmFtZSksIFwKKwkuc2lnbmFsX3U2NF9y
ZWFkID0gKF9yZWFkKSwgXAorCS5zaWduYWxfdTY0X3dyaXRlID0gKF93cml0ZSksIFwKK30KKwor
I2RlZmluZSBDT1VOVEVSX0NPTVBfREVWSUNFX0JPT0woX25hbWUsIF9yZWFkLCBfd3JpdGUpIFwK
K3sgXAorCS50eXBlID0gQ09VTlRFUl9DT01QX0JPT0wsIFwKKwkubmFtZSA9IChfbmFtZSksIFwK
KwkuZGV2aWNlX3U4X3JlYWQgPSAoX3JlYWQpLCBcCisJLmRldmljZV91OF93cml0ZSA9IChfd3Jp
dGUpLCBcCit9CisjZGVmaW5lIENPVU5URVJfQ09NUF9DT1VOVF9CT09MKF9uYW1lLCBfcmVhZCwg
X3dyaXRlKSBcCit7IFwKKwkudHlwZSA9IENPVU5URVJfQ09NUF9CT09MLCBcCisJLm5hbWUgPSAo
X25hbWUpLCBcCisJLmNvdW50X3U4X3JlYWQgPSAoX3JlYWQpLCBcCisJLmNvdW50X3U4X3dyaXRl
ID0gKF93cml0ZSksIFwKK30KKyNkZWZpbmUgQ09VTlRFUl9DT01QX1NJR05BTF9CT09MKF9uYW1l
LCBfcmVhZCwgX3dyaXRlKSBcCit7IFwKKwkudHlwZSA9IENPVU5URVJfQ09NUF9CT09MLCBcCisJ
Lm5hbWUgPSAoX25hbWUpLCBcCisJLnNpZ25hbF91OF9yZWFkID0gKF9yZWFkKSwgXAorCS5zaWdu
YWxfdThfd3JpdGUgPSAoX3dyaXRlKSwgXAorfQorCitzdHJ1Y3QgY291bnRlcl9hdmFpbGFibGUg
eworCXVuaW9uIHsKKwkJY29uc3QgdTMyICplbnVtczsKKwkJY29uc3QgY2hhciAqY29uc3QgKnN0
cnM7CisJfTsKKwlzaXplX3QgbnVtX2l0ZW1zOworfTsKKworI2RlZmluZSBERUZJTkVfQ09VTlRF
Ul9BVkFJTEFCTEUoX25hbWUsIF9lbnVtcykgXAorCXN0cnVjdCBjb3VudGVyX2F2YWlsYWJsZSBf
bmFtZSA9IHsgXAorCQkuZW51bXMgPSAoX2VudW1zKSwgXAorCQkubnVtX2l0ZW1zID0gQVJSQVlf
U0laRShfZW51bXMpLCBcCisJfQorCisjZGVmaW5lIERFRklORV9DT1VOVEVSX0VOVU0oX25hbWUs
IF9zdHJzKSBcCisJc3RydWN0IGNvdW50ZXJfYXZhaWxhYmxlIF9uYW1lID0geyBcCisJCS5zdHJz
ID0gKF9zdHJzKSwgXAorCQkubnVtX2l0ZW1zID0gQVJSQVlfU0laRShfc3RycyksIFwKKwl9CisK
KyNkZWZpbmUgQ09VTlRFUl9DT01QX0RFVklDRV9FTlVNKF9uYW1lLCBfZ2V0LCBfc2V0LCBfYXZh
aWxhYmxlKSBcCit7IFwKKwkudHlwZSA9IENPVU5URVJfQ09NUF9FTlVNLCBcCisJLm5hbWUgPSAo
X25hbWUpLCBcCisJLmRldmljZV91MzJfcmVhZCA9IChfZ2V0KSwgXAorCS5kZXZpY2VfdTMyX3dy
aXRlID0gKF9zZXQpLCBcCisJLnByaXYgPSAmKF9hdmFpbGFibGUpLCBcCit9CisjZGVmaW5lIENP
VU5URVJfQ09NUF9DT1VOVF9FTlVNKF9uYW1lLCBfZ2V0LCBfc2V0LCBfYXZhaWxhYmxlKSBcCit7
IFwKKwkudHlwZSA9IENPVU5URVJfQ09NUF9FTlVNLCBcCisJLm5hbWUgPSAoX25hbWUpLCBcCisJ
LmNvdW50X3UzMl9yZWFkID0gKF9nZXQpLCBcCisJLmNvdW50X3UzMl93cml0ZSA9IChfc2V0KSwg
XAorCS5wcml2ID0gJihfYXZhaWxhYmxlKSwgXAorfQorI2RlZmluZSBDT1VOVEVSX0NPTVBfU0lH
TkFMX0VOVU0oX25hbWUsIF9nZXQsIF9zZXQsIF9hdmFpbGFibGUpIFwKK3sgXAorCS50eXBlID0g
Q09VTlRFUl9DT01QX0VOVU0sIFwKKwkubmFtZSA9IChfbmFtZSksIFwKKwkuc2lnbmFsX3UzMl9y
ZWFkID0gKF9nZXQpLCBcCisJLnNpZ25hbF91MzJfd3JpdGUgPSAoX3NldCksIFwKKwkucHJpdiA9
ICYoX2F2YWlsYWJsZSksIFwKK30KKworI2RlZmluZSBDT1VOVEVSX0NPTVBfQ0VJTElORyhfcmVh
ZCwgX3dyaXRlKSBcCisJQ09VTlRFUl9DT01QX0NPVU5UX1U2NCgiY2VpbGluZyIsIF9yZWFkLCBf
d3JpdGUpCisKKyNkZWZpbmUgQ09VTlRFUl9DT01QX0NPVU5UX01PREUoX3JlYWQsIF93cml0ZSwg
X2F2YWlsYWJsZSkgXAoreyBcCisJLnR5cGUgPSBDT1VOVEVSX0NPTVBfQ09VTlRfTU9ERSwgXAor
CS5uYW1lID0gImNvdW50X21vZGUiLCBcCisJLmNvdW50X3UzMl9yZWFkID0gKF9yZWFkKSwgXAor
CS5jb3VudF91MzJfd3JpdGUgPSAoX3dyaXRlKSwgXAorCS5wcml2ID0gJihfYXZhaWxhYmxlKSwg
XAorfQorCisjZGVmaW5lIENPVU5URVJfQ09NUF9ESVJFQ1RJT04oX3JlYWQpIFwKK3sgXAorCS50
eXBlID0gQ09VTlRFUl9DT01QX0NPVU5UX0RJUkVDVElPTiwgXAorCS5uYW1lID0gImRpcmVjdGlv
biIsIFwKKwkuY291bnRfdTMyX3JlYWQgPSAoX3JlYWQpLCBcCit9CisKKyNkZWZpbmUgQ09VTlRF
Ul9DT01QX0VOQUJMRShfcmVhZCwgX3dyaXRlKSBcCisJQ09VTlRFUl9DT01QX0NPVU5UX0JPT0wo
ImVuYWJsZSIsIF9yZWFkLCBfd3JpdGUpCisKKyNkZWZpbmUgQ09VTlRFUl9DT01QX0ZMT09SKF9y
ZWFkLCBfd3JpdGUpIFwKKwlDT1VOVEVSX0NPTVBfQ09VTlRfVTY0KCJmbG9vciIsIF9yZWFkLCBf
d3JpdGUpCisKKyNkZWZpbmUgQ09VTlRFUl9DT01QX1BSRVNFVChfcmVhZCwgX3dyaXRlKSBcCisJ
Q09VTlRFUl9DT01QX0NPVU5UX1U2NCgicHJlc2V0IiwgX3JlYWQsIF93cml0ZSkKKworI2RlZmlu
ZSBDT1VOVEVSX0NPTVBfUFJFU0VUX0VOQUJMRShfcmVhZCwgX3dyaXRlKSBcCisJQ09VTlRFUl9D
T01QX0NPVU5UX0JPT0woInByZXNldF9lbmFibGUiLCBfcmVhZCwgX3dyaXRlKQogCiAjZW5kaWYg
LyogX0NPVU5URVJfSF8gKi8KZGlmZiAtLWdpdCBhL2luY2x1ZGUvbGludXgvY291bnRlcl9lbnVt
LmggYi9pbmNsdWRlL2xpbnV4L2NvdW50ZXJfZW51bS5oCmRlbGV0ZWQgZmlsZSBtb2RlIDEwMDY0
NAppbmRleCA5ZjkxNzI5OGE4OGYuLjAwMDAwMDAwMDAwMAotLS0gYS9pbmNsdWRlL2xpbnV4L2Nv
dW50ZXJfZW51bS5oCisrKyAvZGV2L251bGwKQEAgLTEsNDUgKzAsMCBAQAotLyogU1BEWC1MaWNl
bnNlLUlkZW50aWZpZXI6IEdQTC0yLjAgKi8KLS8qCi0gKiBDb3VudGVyIGludGVyZmFjZSBlbnVt
IGZ1bmN0aW9ucwotICogQ29weXJpZ2h0IChDKSAyMDE4IFdpbGxpYW0gQnJlYXRoaXR0IEdyYXkK
LSAqLwotI2lmbmRlZiBfQ09VTlRFUl9FTlVNX0hfCi0jZGVmaW5lIF9DT1VOVEVSX0VOVU1fSF8K
LQotI2luY2x1ZGUgPGxpbnV4L3R5cGVzLmg+Ci0KLXN0cnVjdCBjb3VudGVyX2RldmljZTsKLXN0
cnVjdCBjb3VudGVyX3NpZ25hbDsKLXN0cnVjdCBjb3VudGVyX2NvdW50OwotCi1zc2l6ZV90IGNv
dW50ZXJfc2lnbmFsX2VudW1fcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50ZXIsCi0J
CQkJIHN0cnVjdCBjb3VudGVyX3NpZ25hbCAqc2lnbmFsLCB2b2lkICpwcml2LAotCQkJCSBjaGFy
ICpidWYpOwotc3NpemVfdCBjb3VudGVyX3NpZ25hbF9lbnVtX3dyaXRlKHN0cnVjdCBjb3VudGVy
X2RldmljZSAqY291bnRlciwKLQkJCQkgIHN0cnVjdCBjb3VudGVyX3NpZ25hbCAqc2lnbmFsLCB2
b2lkICpwcml2LAotCQkJCSAgY29uc3QgY2hhciAqYnVmLCBzaXplX3QgbGVuKTsKLQotc3NpemVf
dCBjb3VudGVyX3NpZ25hbF9lbnVtX2F2YWlsYWJsZV9yZWFkKHN0cnVjdCBjb3VudGVyX2Rldmlj
ZSAqY291bnRlciwKLQkJCQkJICAgc3RydWN0IGNvdW50ZXJfc2lnbmFsICpzaWduYWwsCi0JCQkJ
CSAgIHZvaWQgKnByaXYsIGNoYXIgKmJ1Zik7Ci0KLXNzaXplX3QgY291bnRlcl9jb3VudF9lbnVt
X3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJCXN0cnVjdCBjb3VudGVy
X2NvdW50ICpjb3VudCwgdm9pZCAqcHJpdiwKLQkJCQljaGFyICpidWYpOwotc3NpemVfdCBjb3Vu
dGVyX2NvdW50X2VudW1fd3JpdGUoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpjb3VudGVyLAotCQkJ
CSBzdHJ1Y3QgY291bnRlcl9jb3VudCAqY291bnQsIHZvaWQgKnByaXYsCi0JCQkJIGNvbnN0IGNo
YXIgKmJ1Ziwgc2l6ZV90IGxlbik7Ci0KLXNzaXplX3QgY291bnRlcl9jb3VudF9lbnVtX2F2YWls
YWJsZV9yZWFkKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwKLQkJCQkJICBzdHJ1Y3Qg
Y291bnRlcl9jb3VudCAqY291bnQsCi0JCQkJCSAgdm9pZCAqcHJpdiwgY2hhciAqYnVmKTsKLQot
c3NpemVfdCBjb3VudGVyX2RldmljZV9lbnVtX3JlYWQoc3RydWN0IGNvdW50ZXJfZGV2aWNlICpj
b3VudGVyLCB2b2lkICpwcml2LAotCQkJCSBjaGFyICpidWYpOwotc3NpemVfdCBjb3VudGVyX2Rl
dmljZV9lbnVtX3dyaXRlKHN0cnVjdCBjb3VudGVyX2RldmljZSAqY291bnRlciwgdm9pZCAqcHJp
diwKLQkJCQkgIGNvbnN0IGNoYXIgKmJ1Ziwgc2l6ZV90IGxlbik7Ci0KLXNzaXplX3QgY291bnRl
cl9kZXZpY2VfZW51bV9hdmFpbGFibGVfcmVhZChzdHJ1Y3QgY291bnRlcl9kZXZpY2UgKmNvdW50
ZXIsCi0JCQkJCSAgIHZvaWQgKnByaXYsIGNoYXIgKmJ1Zik7Ci0KLSNlbmRpZiAvKiBfQ09VTlRF
Ul9FTlVNX0hfICovCi0tIAoyLjMyLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fCkxpbnV4LXN0bTMyIG1haWxpbmcgbGlzdApMaW51eC1zdG0zMkBzdC1t
ZC1tYWlsbWFuLnN0b3JtcmVwbHkuY29tCmh0dHBzOi8vc3QtbWQtbWFpbG1hbi5zdG9ybXJlcGx5
LmNvbS9tYWlsbWFuL2xpc3RpbmZvL2xpbnV4LXN0bTMyCg==
