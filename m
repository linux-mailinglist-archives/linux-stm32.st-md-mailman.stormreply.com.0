Return-Path: <linux-stm32-bounces@st-md-mailman.stormreply.com>
X-Original-To: lists+linux-stm32@lfdr.de
Delivered-To: lists+linux-stm32@lfdr.de
Received: from stm-ict-prod-mailman-01.stormreply.prv (st-md-mailman.stormreply.com [52.209.6.89])
	by mail.lfdr.de (Postfix) with ESMTPS id 7A09E93F82E
	for <lists+linux-stm32@lfdr.de>; Mon, 29 Jul 2024 16:35:24 +0200 (CEST)
Received: from ip-172-31-3-47.eu-west-1.compute.internal (localhost [127.0.0.1])
	by stm-ict-prod-mailman-01.stormreply.prv (Postfix) with ESMTP id 3DF40C6DD96;
	Mon, 29 Jul 2024 14:35:24 +0000 (UTC)
Received: from mail-wm1-f44.google.com (mail-wm1-f44.google.com
 [209.85.128.44])
 (using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits))
 (No client certificate requested)
 by stm-ict-prod-mailman-01.stormreply.prv (Postfix) with ESMTPS id C31ACC5E2CD
 for <linux-stm32@st-md-mailman.stormreply.com>;
 Mon, 29 Jul 2024 14:35:22 +0000 (UTC)
Received: by mail-wm1-f44.google.com with SMTP id
 5b1f17b1804b1-427fc97a88cso17557095e9.0
 for <linux-stm32@st-md-mailman.stormreply.com>;
 Mon, 29 Jul 2024 07:35:22 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=baylibre-com.20230601.gappssmtp.com; s=20230601; t=1722263722; x=1722868522;
 darn=st-md-mailman.stormreply.com; 
 h=content-transfer-encoding:mime-version:references:in-reply-to
 :message-id:date:subject:cc:to:from:from:to:cc:subject:date
 :message-id:reply-to;
 bh=6pfF4deIEab/vxZmoh05/o96Mjb32dnv5FG3n9I9/lg=;
 b=FDWn7hkDrZA3Q5jZfeY/WZWgMNqQGYimJDZ0giXI3ofjFTgYZLEq7otp7yqGHTEhnw
 wAUkZQjNEANXr3l4WtTsN/OgjXaRKf2MolLZKmE32Jw21lIZHNu9dQPdsn6wtV7zW+Tx
 +BlO2z2VKZfTS8IDJ3RGns/KkmPFQyZRDsDqIQdu/uIOy528hsa/0MZRrkbqcnq9p5Gw
 x8dk/pXcyPlZfhDoCo9+6UV7fqRjxNglKbye+drnF8aWnq8AP7d/4Kyqgxkxt0OUVkf1
 eCQBAWGa5ByYPoA1zPw4aViAvyghcpG7UkJJyZ98wg0dKB64+sCsl3jsXk9TF7xlArjF
 FmCA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20230601; t=1722263722; x=1722868522;
 h=content-transfer-encoding:mime-version:references:in-reply-to
 :message-id:date:subject:cc:to:from:x-gm-message-state:from:to:cc
 :subject:date:message-id:reply-to;
 bh=6pfF4deIEab/vxZmoh05/o96Mjb32dnv5FG3n9I9/lg=;
 b=jY2EI1jAo7AUBfrqb2WUGJjfIdPZrzaOmO/MrWEnkpyXTqEauVa5lC/4OoznzoSzs9
 fVXBBS0jBcMpG//xZ9cMFqOWH/uFQcf/kiE9bjDBP2uvrnWN5NV8tSfGTT2AF6UIQtOr
 9qC2xr6+Y8kGIn9xpDNL1YVxuTKppVBVBT0F+T0o2R2SKaVuFP3g26vVTohwKzDwvHza
 gzcWLXbeWRBTfWXhGkt1R3e/N5JRdMqmrx9/gL5cMg98J+WoDXbeIm2MCEbbzJeVyecC
 1ccp/bAO9iA3vu6lx939WkrweRGsWh/d5wO80czTn2Em2gKOoHlS7MEqO3MZ0SJnrLAC
 VeZw==
X-Forwarded-Encrypted: i=1;
 AJvYcCWHHleaIQCOrKzV7pLskmx0EM4ycNljK/jnVd+DyNvGvH5zmW9PAHnjGqz1Odp7mJ9AkAz4DL6aQKqupYZSXX5HZflpduaRLsOSA8LtsxEiZeBlJvS7gRub
X-Gm-Message-State: AOJu0YwFJOBVYtUmFre5xntV2Z6c8ijDubQasv8CN+tgoE/Krm1VXqag
 PigbmoI1yX76C7et0s5hXij7mh2r0J7KFhURsfbxrwlnQN3ydI1n1viopg5ZmYY=
X-Google-Smtp-Source: AGHT+IE7yxPHidyiqrJwesEVlv6DnjKIHipLAQCs288B62eXtX7ZPDmBtZrtBufv8T0r4fbGYML9lQ==
X-Received: by 2002:a05:600c:5126:b0:428:eb6:2e73 with SMTP id
 5b1f17b1804b1-42811dd103fmr46209995e9.29.1722263722333; 
 Mon, 29 Jul 2024 07:35:22 -0700 (PDT)
Received: from localhost ([2a02:8071:b783:6940:59dd:510e:47d0:643f])
 by smtp.gmail.com with ESMTPSA id
 5b1f17b1804b1-42813e5067dsm90015485e9.16.2024.07.29.07.35.21
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Mon, 29 Jul 2024 07:35:22 -0700 (PDT)
From: =?UTF-8?q?Uwe=20Kleine-K=C3=B6nig?= <u.kleine-koenig@baylibre.com>
To: linux-pwm@vger.kernel.org
Date: Mon, 29 Jul 2024 16:34:24 +0200
Message-ID: <b193c8d4bc8e188ad6b4b4ddb6f730308d7f1099.1722261050.git.u.kleine-koenig@baylibre.com>
X-Mailer: git-send-email 2.43.0
In-Reply-To: <cover.1722261050.git.u.kleine-koenig@baylibre.com>
References: <cover.1722261050.git.u.kleine-koenig@baylibre.com>
MIME-Version: 1.0
X-Developer-Signature: v=1; a=openpgp-sha256; l=17104;
 i=u.kleine-koenig@baylibre.com; h=from:subject:message-id;
 bh=p3etr4V6tRF3RoLSJnJV32PLW+PXYWtkQtcV3LE/fYg=;
 b=owEBbQGS/pANAwAKAY+A+1h9Ev5OAcsmYgBmp6iBT8LYQ4vQSPDY6q7L3zurXNXT7CEerL/vk
 agz+Uh1H+SJATMEAAEKAB0WIQQ/gaxpOnoeWYmt/tOPgPtYfRL+TgUCZqeogQAKCRCPgPtYfRL+
 Tm4BCACt2YwihcMDhE0bYBrwwXtC44fOLKYKORkzS7Lzrui4eQnGIJLW3mq8BqIl7g5IDV1ZU6L
 YrWQhrU1FDyPOLLzVMnXeY8hzz+p/fEGMzE4zogQNkKWyt+qsGLtPmfFDURM3el5Aq91OzjYYVV
 SQx9XmIQaoRZmYBxmcnwc9Zh8G8YgzG2pEwtxIHFXZ98BXp+Ox78PnH77tQsm3N/hmriwlZFnVa
 g2AsQ2vhdK/2oZsPWgyx7Z2gmPIwFQ0OM/XCrUiIlNlNpxRyoD/gra71X0CkYeUOCgCe/FKLz0q
 ZA4kascV4CJtyZOVJtq+9pcFJkia7dLgDtta8WubfLOFjIOx
X-Developer-Key: i=u.kleine-koenig@baylibre.com; a=openpgp;
 fpr=0D2511F322BFAB1C1580266BE2DCDD9132669BD6
Cc: Trevor Gamblin <tgamblin@baylibre.com>,
 Maxime Coquelin <mcoquelin.stm32@gmail.com>,
 linux-stm32@st-md-mailman.stormreply.com, linux-arm-kernel@lists.infradead.org
Subject: [Linux-stm32] [PATCH v3 8/8] pwm: stm32: Implementation of the
	waveform callbacks
X-BeenThere: linux-stm32@st-md-mailman.stormreply.com
X-Mailman-Version: 2.1.15
Precedence: list
List-Id: <linux-stm32.st-md-mailman.stormreply.com>
List-Unsubscribe: <https://st-md-mailman.stormreply.com/mailman/options/linux-stm32>, 
 <mailto:linux-stm32-request@st-md-mailman.stormreply.com?subject=unsubscribe>
List-Archive: <http://st-md-mailman.stormreply.com/pipermail/linux-stm32/>
List-Post: <mailto:linux-stm32@st-md-mailman.stormreply.com>
List-Help: <mailto:linux-stm32-request@st-md-mailman.stormreply.com?subject=help>
List-Subscribe: <https://st-md-mailman.stormreply.com/mailman/listinfo/linux-stm32>, 
 <mailto:linux-stm32-request@st-md-mailman.stormreply.com?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: linux-stm32-bounces@st-md-mailman.stormreply.com
Sender: "Linux-stm32" <linux-stm32-bounces@st-md-mailman.stormreply.com>

Q29udmVydCB0aGUgc3RtMzIgcHdtIGRyaXZlciB0byB1c2UgdGhlIG5ldyBjYWxsYmFja3MgZm9y
IGhhcmR3YXJlCnByb2dyYW1taW5nLgoKU2lnbmVkLW9mZi1ieTogVXdlIEtsZWluZS1Lw7ZuaWcg
PHUua2xlaW5lLWtvZW5pZ0BiYXlsaWJyZS5jb20+Ci0tLQogZHJpdmVycy9wd20vcHdtLXN0bTMy
LmMgfCA2MDcgKysrKysrKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0tLQogMSBmaWxl
IGNoYW5nZWQsIDM4NiBpbnNlcnRpb25zKCspLCAyMjEgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9wd20vcHdtLXN0bTMyLmMgYi9kcml2ZXJzL3B3bS9wd20tc3RtMzIuYwppbmRl
eCBmZDc1NGE5OWNmMmUuLjg0NmRhMjY1YmJmZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9wd20vcHdt
LXN0bTMyLmMKKysrIGIvZHJpdmVycy9wd20vcHdtLXN0bTMyLmMKQEAgLTUxLDYgKzUxLDM4NiBA
QCBzdGF0aWMgdTMyIGFjdGl2ZV9jaGFubmVscyhzdHJ1Y3Qgc3RtMzJfcHdtICpkZXYpCiAJcmV0
dXJuIGNjZXIgJiBUSU1fQ0NFUl9DQ1hFOwogfQogCitzdHJ1Y3Qgc3RtMzJfcHdtX3dhdmVmb3Jt
IHsKKwl1MzIgY2NlcjsKKwl1MzIgcHNjOworCXUzMiBhcnI7CisJdTMyIGNjcjsKK307CisKK3N0
YXRpYyBpbnQgc3RtMzJfcHdtX3JvdW5kX3dhdmVmb3JtX3RvaHcoc3RydWN0IHB3bV9jaGlwICpj
aGlwLAorCQkJCQkgc3RydWN0IHB3bV9kZXZpY2UgKnB3bSwKKwkJCQkJIGNvbnN0IHN0cnVjdCBw
d21fd2F2ZWZvcm0gKndmLAorCQkJCQkgdm9pZCAqX3dmaHcpCit7CisJc3RydWN0IHN0bTMyX3B3
bV93YXZlZm9ybSAqd2ZodyA9IF93Zmh3OworCXN0cnVjdCBzdG0zMl9wd20gKnByaXYgPSB0b19z
dG0zMl9wd21fZGV2KGNoaXApOworCXVuc2lnbmVkIGludCBjaCA9IHB3bS0+aHdwd207CisJdW5z
aWduZWQgbG9uZyByYXRlOworCXU2NCBjY3IsIGR1dHk7CisJaW50IHJldDsKKworCWlmICh3Zi0+
cGVyaW9kX2xlbmd0aF9ucyA9PSAwKSB7CisJCSp3Zmh3ID0gKHN0cnVjdCBzdG0zMl9wd21fd2F2
ZWZvcm0peworCQkJLmNjZXIgPSAwLAorCQl9OworCisJCXJldHVybiAwOworCX0KKworCXJldCA9
IGNsa19lbmFibGUocHJpdi0+Y2xrKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJd2Zo
dy0+Y2NlciA9IFRJTV9DQ0VSX0NDeEUoY2ggKyAxKTsKKwlpZiAocHJpdi0+aGF2ZV9jb21wbGVt
ZW50YXJ5X291dHB1dCkKKwkJd2Zody0+Y2NlciA9IFRJTV9DQ0VSX0NDeE5FKGNoKTsKKworCXJh
dGUgPSBjbGtfZ2V0X3JhdGUocHJpdi0+Y2xrKTsKKworCWlmIChhY3RpdmVfY2hhbm5lbHMocHJp
dikgJiB+KDEgPDwgY2ggKiA0KSkgeworCQl1NjQgYXJyOworCisJCS8qCisJCSAqIE90aGVyIGNo
YW5uZWxzIGFyZSBhbHJlYWR5IGVuYWJsZWQsIHNvIHRoZSBjb25maWd1cmVkIFBTQyBhbmQKKwkJ
ICogQVJSIG11c3QgYmUgdXNlZCBmb3IgdGhpcyBjaGFubmVsLCB0b28uCisJCSAqLworCQlyZXQg
PSByZWdtYXBfcmVhZChwcml2LT5yZWdtYXAsIFRJTV9QU0MsICZ3Zmh3LT5wc2MpOworCQlpZiAo
cmV0KQorCQkJZ290byBvdXQ7CisKKwkJcmV0ID0gcmVnbWFwX3JlYWQocHJpdi0+cmVnbWFwLCBU
SU1fQVJSLCAmd2Zody0+YXJyKTsKKwkJaWYgKHJldCkKKwkJCWdvdG8gb3V0OworCisJCS8qCisJ
CSAqIGNhbGN1bGF0ZSB0aGUgYmVzdCB2YWx1ZSBmb3IgQVJSIGZvciB0aGUgZ2l2ZW4gUFNDLCBy
ZWZ1c2UgaWYKKwkJICogdGhlIHJlc3VsdGluZyBwZXJpb2QgZ2V0cyBiaWdnZXIgdGhhbiB0aGUg
cmVxdWVzdGVkIG9uZS4KKwkJICovCisJCWFyciA9IG11bF91NjRfdTY0X2Rpdl91NjQod2YtPnBl
cmlvZF9sZW5ndGhfbnMsIHJhdGUsCisJCQkJCSAgKHU2NClOU0VDX1BFUl9TRUMgKiAod2Zody0+
cHNjICsgMSkpOworCQlpZiAoYXJyIDw9IHdmaHctPmFycikgeworCQkJLyoKKwkJCSAqIHJlcXVl
c3RlZCBwZXJpb2QgaXMgc21hbGwgdGhhbiB0aGUgY3VycmVudGx5CisJCQkgKiBjb25maWd1cmVk
IGFuZCB1bmNoYW5nYWJsZSBwZXJpb2QsIHJlcG9ydCBiYWNrIHRoZSBzbWFsbGVzdAorCQkJICog
cG9zc2libGUgcGVyaW9kLCBpLmUuIHRoZSBjdXJyZW50IHN0YXRlOyBJbml0aWFsaXplCisJCQkg
KiBjY3IgdG8gYW55dGhpbmcgdmFsaWQuCisJCQkgKi8KKwkJCXdmaHctPmNjciA9IDA7CisJCQly
ZXQgPSAxOworCQkJZ290byBvdXQ7CisJCX0KKworCX0gZWxzZSB7CisJCS8qCisJCSAqIC5wcm9i
ZSgpIGFzc2VydGVkIHRoYXQgY2xrX2dldF9yYXRlKCkgaXMgbm90IGJpZ2dlciB0aGFuIDEgR0h6
LCBzbworCQkgKiB0aGUgY2FsY3VsYXRpb25zIGhlcmUgd29uJ3Qgb3ZlcmZsb3cuCisJCSAqIEZp
cnN0IHdlIG5lZWQgdG8gZmluZCB0aGUgbWluaW1hbCB2YWx1ZSBmb3IgcHJlc2NhbGVyIHN1Y2gg
dGhhdAorCQkgKgorCQkgKiAgICAgICAgcGVyaW9kX25zICogY2xrcmF0ZQorCQkgKiAgIC0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSA8IG1heF9hcnIgKyAxCisJCSAqICAgTlNFQ19QRVJf
U0VDICogKHByZXNjYWxlciArIDEpCisJCSAqCisJCSAqIFRoaXMgZXF1YXRpb24gaXMgZXF1aXZh
bGVudCB0bworCQkgKgorCQkgKiAgICAgICAgcGVyaW9kX25zICogY2xrcmF0ZQorCQkgKiAgIC0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gPCBwcmVzY2FsZXIgKyAxCisJCSAqICAgTlNFQ19Q
RVJfU0VDICogKG1heF9hcnIgKyAxKQorCQkgKgorCQkgKiBVc2luZyBpbnRlZ2VyIGRpdmlzaW9u
IGFuZCBrbm93aW5nIHRoYXQgdGhlIHJpZ2h0IGhhbmQgc2lkZSBpcworCQkgKiBpbnRlZ2VyLCB0
aGlzIGlzIGZ1cnRoZXIgZXF1aXZhbGVudCB0bworCQkgKgorCQkgKiAgIChwZXJpb2RfbnMgKiBj
bGtyYXRlKSAvLyAoTlNFQ19QRVJfU0VDICogKG1heF9hcnIgKyAxKSkg4omkIHByZXNjYWxlcgor
CQkgKi8KKwkJdTY0IHBzYyA9IG11bF91NjRfdTY0X2Rpdl91NjQod2YtPnBlcmlvZF9sZW5ndGhf
bnMsIHJhdGUsCisJCQkJCSAgICAgICh1NjQpTlNFQ19QRVJfU0VDICogKCh1NjQpcHJpdi0+bWF4
X2FyciArIDEpKTsKKwkJdTY0IGFycjsKKworCQl3Zmh3LT5wc2MgPSBtaW5fdCh1NjQsIHBzYywg
TUFYX1RJTV9QU0MpOworCisJCWFyciA9IG11bF91NjRfdTY0X2Rpdl91NjQod2YtPnBlcmlvZF9s
ZW5ndGhfbnMsIHJhdGUsCisJCQkJCSAgKHU2NClOU0VDX1BFUl9TRUMgKiAod2Zody0+cHNjICsg
MSkpOworCQlpZiAoIWFycikgeworCQkJLyoKKwkJCSAqIHJlcXVlc3RlZCBwZXJpb2QgaXMgdG9v
IHNtYWxsLCByZXBvcnQgYmFjayB0aGUgc21hbGxlc3QKKwkJCSAqIHBvc3NpYmxlIHBlcmlvZCwg
aS5lLiBBUlIgPSAwLiBUaGUgb25seSB2YWxpZCBDQ1IKKwkJCSAqIHZhbHVlIGlzIHRoZW4gemVy
bywgdG9vLgorCQkJICovCisJCQl3Zmh3LT5hcnIgPSAwOworCQkJd2Zody0+Y2NyID0gMDsKKwkJ
CXJldCA9IDE7CisJCQlnb3RvIG91dDsKKwkJfQorCisJCS8qCisJCSAqIEFSUiBpcyBsaW1pdGVk
IGludGVudGlvbmFsbHkgdG8gdmFsdWVzIGxlc3MgdGhhbgorCQkgKiBwcml2LT5tYXhfYXJyIHRv
IGFsbG93IDEwMCUgZHV0eSBjeWNsZS4KKwkJICovCisJCXdmaHctPmFyciA9IG1pbl90KHU2NCwg
YXJyLCBwcml2LT5tYXhfYXJyKSAtIDE7CisJfQorCisJZHV0eSA9IG11bF91NjRfdTY0X2Rpdl91
NjQod2YtPmR1dHlfbGVuZ3RoX25zLCByYXRlLAorCQkJCSAgICh1NjQpTlNFQ19QRVJfU0VDICog
KHdmaHctPnBzYyArIDEpKTsKKwlkdXR5ID0gbWluX3QodTY0LCBkdXR5LCB3Zmh3LT5hcnIgKyAx
KTsKKworCWlmICh3Zi0+ZHV0eV9sZW5ndGhfbnMgJiYgd2YtPmR1dHlfb2Zmc2V0X25zICYmCisJ
ICAgIHdmLT5kdXR5X2xlbmd0aF9ucyArIHdmLT5kdXR5X29mZnNldF9ucyA+PSB3Zi0+cGVyaW9k
X2xlbmd0aF9ucykgeworCQl3Zmh3LT5jY2VyIHw9IFRJTV9DQ0VSX0NDeFAoY2ggKyAxKTsKKwkJ
aWYgKHByaXYtPmhhdmVfY29tcGxlbWVudGFyeV9vdXRwdXQpCisJCQl3Zmh3LT5jY2VyIHw9IFRJ
TV9DQ0VSX0NDeE5QKGNoICsgMSk7CisKKwkJY2NyID0gd2Zody0+YXJyICsgMSAtIGR1dHk7CisJ
fSBlbHNlIHsKKwkJY2NyID0gZHV0eTsKKwl9CisKKwl3Zmh3LT5jY3IgPSBtaW5fdCh1NjQsIGNj
ciwgd2Zody0+YXJyICsgMSk7CisKKwlkZXZfZGJnKCZjaGlwLT5kZXYsICJwd20jJXU6ICVsbGQv
JWxsZCBbKyVsbGRdIEAlbHUgLT4gQ0NFUjogJTA4eCwgUFNDOiAlMDh4LCBBUlI6ICUwOHgsIEND
UjogJTA4eFxuIiwKKwkJcHdtLT5od3B3bSwgd2YtPmR1dHlfbGVuZ3RoX25zLCB3Zi0+cGVyaW9k
X2xlbmd0aF9ucywgd2YtPmR1dHlfb2Zmc2V0X25zLAorCQlyYXRlLCB3Zmh3LT5jY2VyLCB3Zmh3
LT5wc2MsIHdmaHctPmFyciwgd2Zody0+Y2NyKTsKKworb3V0OgorCWNsa19kaXNhYmxlKHByaXYt
PmNsayk7CisKKwlyZXR1cm4gcmV0OworfQorCisvKgorICogVGhpcyBzaG91bGQgYmUgbW92ZWQg
dG8gbGliL21hdGgvZGl2NjQuYy4gQ3VycmVudGx5IHRoZXJlIGFyZSBzb21lIGNoYW5nZXMKKyAq
IHBlbmRpbmcgdG8gbXVsX3U2NF91NjRfZGl2X3U2NC4gVXdlIHdpbGwgY2FyZSBmb3IgdGhhdCB3
aGVuIHRoZSBkdXN0IHNldHRsZXMuCisgKi8KK3N0YXRpYyB1NjQgc3RtMzJfcHdtX211bF91NjRf
dTY0X2Rpdl91NjRfcm91bmR1cCh1NjQgYSwgdTY0IGIsIHU2NCBjKQoreworCXU2NCByZXMgPSBt
dWxfdTY0X3U2NF9kaXZfdTY0KGEsIGIsIGMpOworCS8qIFRob3NlIG11bHRpcGxpY2F0aW9ucyBt
aWdodCBvdmVyZmxvdyBidXQgaXQgZG9lc24ndCBtYXR0ZXIgKi8KKwl1NjQgcmVtID0gYSAqIGIg
LSBjICogcmVzOworCisJaWYgKHJlbSkKKwkJcmVzICs9IDE7CisKKwlyZXR1cm4gcmVzOworfQor
CitzdGF0aWMgaW50IHN0bTMyX3B3bV9yb3VuZF93YXZlZm9ybV9mcm9taHcoc3RydWN0IHB3bV9j
aGlwICpjaGlwLAorCQkJCQkgICBzdHJ1Y3QgcHdtX2RldmljZSAqcHdtLAorCQkJCQkgICBjb25z
dCB2b2lkICpfd2ZodywKKwkJCQkJICAgc3RydWN0IHB3bV93YXZlZm9ybSAqd2YpCit7CisJY29u
c3Qgc3RydWN0IHN0bTMyX3B3bV93YXZlZm9ybSAqd2ZodyA9IF93Zmh3OworCXN0cnVjdCBzdG0z
Ml9wd20gKnByaXYgPSB0b19zdG0zMl9wd21fZGV2KGNoaXApOworCXVuc2lnbmVkIGludCBjaCA9
IHB3bS0+aHdwd207CisKKwlpZiAod2Zody0+Y2NlciAmIFRJTV9DQ0VSX0NDeEUoY2ggKyAxKSkg
eworCQl1bnNpZ25lZCBsb25nIHJhdGUgPSBjbGtfZ2V0X3JhdGUocHJpdi0+Y2xrKTsKKwkJdTY0
IGNjcl9uczsKKworCQkvKiBUaGUgcmVzdWx0IGRvZXNuJ3Qgb3ZlcmZsb3cgZm9yIHJhdGUgPj0g
MTUyNTkgKi8KKwkJd2YtPnBlcmlvZF9sZW5ndGhfbnMgPSBzdG0zMl9wd21fbXVsX3U2NF91NjRf
ZGl2X3U2NF9yb3VuZHVwKCgodTY0KXdmaHctPnBzYyArIDEpICogKHdmaHctPmFyciArIDEpLAor
CQkJCQkJCQkJICAgICBOU0VDX1BFUl9TRUMsIHJhdGUpOworCisJCWNjcl9ucyA9IHN0bTMyX3B3
bV9tdWxfdTY0X3U2NF9kaXZfdTY0X3JvdW5kdXAoKCh1NjQpd2Zody0+cHNjICsgMSkgKiB3Zmh3
LT5jY3IsCisJCQkJCQkJICAgICAgIE5TRUNfUEVSX1NFQywgcmF0ZSk7CisKKwkJaWYgKHdmaHct
PmNjZXIgJiBUSU1fQ0NFUl9DQ3hQKGNoICsgMSkpIHsKKwkJCXdmLT5kdXR5X2xlbmd0aF9ucyA9
CisJCQkJc3RtMzJfcHdtX211bF91NjRfdTY0X2Rpdl91NjRfcm91bmR1cCgoKHU2NCl3Zmh3LT5w
c2MgKyAxKSAqICh3Zmh3LT5hcnIgKyAxIC0gd2Zody0+Y2NyKSwKKwkJCQkJCQkJICAgICAgTlNF
Q19QRVJfU0VDLCByYXRlKTsKKworCQkJd2YtPmR1dHlfb2Zmc2V0X25zID0gY2NyX25zOworCQl9
IGVsc2UgeworCQkJd2YtPmR1dHlfbGVuZ3RoX25zID0gY2NyX25zOworCQkJd2YtPmR1dHlfb2Zm
c2V0X25zID0gMDsKKwkJfQorCX0gZWxzZSB7CisJCSp3ZiA9IChzdHJ1Y3QgcHdtX3dhdmVmb3Jt
KXsKKwkJCS5wZXJpb2RfbGVuZ3RoX25zID0gMCwKKwkJfTsKKwl9CisKKwlyZXR1cm4gMDsKK30K
Kworc3RhdGljIGludCBzdG0zMl9wd21fcmVhZF93YXZlZm9ybShzdHJ1Y3QgcHdtX2NoaXAgKmNo
aXAsCisJCQkJICAgICBzdHJ1Y3QgcHdtX2RldmljZSAqcHdtLAorCQkJCSAgICAgdm9pZCAqX3dm
aHcpCit7CisJc3RydWN0IHN0bTMyX3B3bV93YXZlZm9ybSAqd2ZodyA9IF93Zmh3OworCXN0cnVj
dCBzdG0zMl9wd20gKnByaXYgPSB0b19zdG0zMl9wd21fZGV2KGNoaXApOworCXVuc2lnbmVkIGlu
dCBjaCA9IHB3bS0+aHdwd207CisJaW50IHJldDsKKworCXJldCA9IGNsa19lbmFibGUocHJpdi0+
Y2xrKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJcmV0ID0gcmVnbWFwX3JlYWQocHJp
di0+cmVnbWFwLCBUSU1fQ0NFUiwgJndmaHctPmNjZXIpOworCWlmIChyZXQpCisJCWdvdG8gb3V0
OworCisJaWYgKHdmaHctPmNjZXIgJiBUSU1fQ0NFUl9DQ3hFKGNoICsgMSkpIHsKKwkJcmV0ID0g
cmVnbWFwX3JlYWQocHJpdi0+cmVnbWFwLCBUSU1fUFNDLCAmd2Zody0+cHNjKTsKKwkJaWYgKHJl
dCkKKwkJCWdvdG8gb3V0OworCisJCXJldCA9IHJlZ21hcF9yZWFkKHByaXYtPnJlZ21hcCwgVElN
X0FSUiwgJndmaHctPmFycik7CisJCWlmIChyZXQpCisJCQlnb3RvIG91dDsKKworCQlpZiAod2Zo
dy0+YXJyID09IFUzMl9NQVgpCisJCQl3Zmh3LT5hcnIgLT0gMTsKKworCQlyZXQgPSByZWdtYXBf
cmVhZChwcml2LT5yZWdtYXAsIFRJTV9DQ1J4KGNoICsgMSksICZ3Zmh3LT5jY3IpOworCQlpZiAo
cmV0KQorCQkJZ290byBvdXQ7CisKKwkJaWYgKHdmaHctPmNjciA+IHdmaHctPmFyciArIDEpCisJ
CQl3Zmh3LT5jY3IgPSB3Zmh3LT5hcnIgKyAxOworCX0KKworb3V0OgorCWNsa19kaXNhYmxlKHBy
aXYtPmNsayk7CisKKwlyZXR1cm4gcmV0OworfQorCitzdGF0aWMgaW50IHN0bTMyX3B3bV93cml0
ZV93YXZlZm9ybShzdHJ1Y3QgcHdtX2NoaXAgKmNoaXAsCisJCQkJICAgICAgc3RydWN0IHB3bV9k
ZXZpY2UgKnB3bSwKKwkJCQkgICAgICBjb25zdCB2b2lkICpfd2ZodykKK3sKKwljb25zdCBzdHJ1
Y3Qgc3RtMzJfcHdtX3dhdmVmb3JtICp3Zmh3ID0gX3dmaHc7CisJc3RydWN0IHN0bTMyX3B3bSAq
cHJpdiA9IHRvX3N0bTMyX3B3bV9kZXYoY2hpcCk7CisJdW5zaWduZWQgaW50IGNoID0gcHdtLT5o
d3B3bTsKKwlpbnQgcmV0OworCisJcmV0ID0gY2xrX2VuYWJsZShwcml2LT5jbGspOworCWlmIChy
ZXQpCisJCXJldHVybiByZXQ7CisKKwlpZiAod2Zody0+Y2NlciAmIFRJTV9DQ0VSX0NDeEUoY2gg
KyAxKSkgeworCQl1MzIgY2NlciwgbWFzazsKKwkJdW5zaWduZWQgaW50IHNoaWZ0OworCQl1MzIg
Y2NtcjsKKworCQlyZXQgPSByZWdtYXBfcmVhZChwcml2LT5yZWdtYXAsIFRJTV9DQ0VSLCAmY2Nl
cik7CisJCWlmIChyZXQpCisJCQlnb3RvIG91dDsKKworCQkvKiBJZiB0aGVyZSBhcmUgb3RoZXIg
Y2hhbm5lbHMgZW5hYmxlZCwgZG9uJ3QgdXBkYXRlIFBTQyBhbmQgQVJSICovCisJCWlmIChjY2Vy
ICYgflRJTV9DQ0VSX0NDeEUoY2ggKyAxKSAmIFRJTV9DQ0VSX0NDWEUpIHsKKwkJCXUzMiBwc2Ms
IGFycjsKKworCQkJcmV0ID0gcmVnbWFwX3JlYWQocHJpdi0+cmVnbWFwLCBUSU1fUFNDLCAmcHNj
KTsKKwkJCWlmIChyZXQpCisJCQkJZ290byBvdXQ7CisKKwkJCWlmIChwc2MgIT0gd2Zody0+cHNj
KSB7CisJCQkJcmV0ID0gLUVCVVNZOworCQkJCWdvdG8gb3V0OworCQkJfQorCisJCQlyZWdtYXBf
cmVhZChwcml2LT5yZWdtYXAsIFRJTV9BUlIsICZhcnIpOworCQkJaWYgKHJldCkKKwkJCQlnb3Rv
IG91dDsKKworCQkJaWYgKGFyciAhPSB3Zmh3LT5hcnIpIHsKKwkJCQlyZXQgPSAtRUJVU1k7CisJ
CQkJZ290byBvdXQ7CisJCQl9CisJCX0gZWxzZSB7CisJCQlyZXQgPSByZWdtYXBfd3JpdGUocHJp
di0+cmVnbWFwLCBUSU1fUFNDLCB3Zmh3LT5wc2MpOworCQkJaWYgKHJldCkKKwkJCQlnb3RvIG91
dDsKKworCQkJcmV0ID0gcmVnbWFwX3dyaXRlKHByaXYtPnJlZ21hcCwgVElNX0FSUiwgd2Zody0+
YXJyKTsKKwkJCWlmIChyZXQpCisJCQkJZ290byBvdXQ7CisKKwkJCXJldCA9IHJlZ21hcF9zZXRf
Yml0cyhwcml2LT5yZWdtYXAsIFRJTV9DUjEsIFRJTV9DUjFfQVJQRSk7CisJCQlpZiAocmV0KQor
CQkJCWdvdG8gb3V0OworCisJCX0KKworCQkvKiBzZXQgcG9sYXJpdHkgKi8KKwkJbWFzayA9IFRJ
TV9DQ0VSX0NDeFAoY2ggKyAxKSB8IFRJTV9DQ0VSX0NDeE5QKGNoICsgMSk7CisJCXJldCA9IHJl
Z21hcF91cGRhdGVfYml0cyhwcml2LT5yZWdtYXAsIFRJTV9DQ0VSLCBtYXNrLCB3Zmh3LT5jY2Vy
KTsKKwkJaWYgKHJldCkKKwkJCWdvdG8gb3V0OworCisJCXJldCA9IHJlZ21hcF93cml0ZShwcml2
LT5yZWdtYXAsIFRJTV9DQ1J4KGNoICsgMSksIHdmaHctPmNjcik7CisJCWlmIChyZXQpCisJCQln
b3RvIG91dDsKKworCQkvKiBDb25maWd1cmUgb3V0cHV0IG1vZGUgKi8KKwkJc2hpZnQgPSAoY2gg
JiAweDEpICogQ0NNUl9DSEFOTkVMX1NISUZUOworCQljY21yID0gKFRJTV9DQ01SX1BFIHwgVElN
X0NDTVJfTTEpIDw8IHNoaWZ0OworCQltYXNrID0gQ0NNUl9DSEFOTkVMX01BU0sgPDwgc2hpZnQ7
CisKKwkJaWYgKGNoIDwgMikKKwkJCXJldCA9IHJlZ21hcF91cGRhdGVfYml0cyhwcml2LT5yZWdt
YXAsIFRJTV9DQ01SMSwgbWFzaywgY2Ntcik7CisJCWVsc2UKKwkJCXJldCA9IHJlZ21hcF91cGRh
dGVfYml0cyhwcml2LT5yZWdtYXAsIFRJTV9DQ01SMiwgbWFzaywgY2Ntcik7CisJCWlmIChyZXQp
CisJCQlnb3RvIG91dDsKKworCQlyZXQgPSByZWdtYXBfc2V0X2JpdHMocHJpdi0+cmVnbWFwLCBU
SU1fQkRUUiwgVElNX0JEVFJfTU9FKTsKKwkJaWYgKHJldCkKKwkJCWdvdG8gb3V0OworCisJCWlm
ICghKGNjZXIgJiBUSU1fQ0NFUl9DQ3hFKGNoICsgMSkpKSB7CisJCQltYXNrID0gVElNX0NDRVJf
Q0N4RShjaCArIDEpIHwgVElNX0NDRVJfQ0N4TkUoY2ggKyAxKTsKKworCQkJcmV0ID0gY2xrX2Vu
YWJsZShwcml2LT5jbGspOworCQkJaWYgKHJldCkKKwkJCQlnb3RvIG91dDsKKworCQkJY2NlciA9
IChjY2VyICYgfm1hc2spIHwgKHdmaHctPmNjZXIgJiBtYXNrKTsKKwkJCXJlZ21hcF93cml0ZShw
cml2LT5yZWdtYXAsIFRJTV9DQ0VSLCBjY2VyKTsKKworCQkJLyogTWFrZSBzdXJlIHRoYXQgcmVn
aXN0ZXJzIGFyZSB1cGRhdGVkICovCisJCQlyZWdtYXBfc2V0X2JpdHMocHJpdi0+cmVnbWFwLCBU
SU1fRUdSLCBUSU1fRUdSX1VHKTsKKworCQkJLyogRW5hYmxlIGNvbnRyb2xsZXIgKi8KKwkJCXJl
Z21hcF9zZXRfYml0cyhwcml2LT5yZWdtYXAsIFRJTV9DUjEsIFRJTV9DUjFfQ0VOKTsKKwkJfQor
CisJfSBlbHNlIHsKKwkJLyogZGlzYWJsZSBjaGFubmVsICovCisJCXUzMiBtYXNrLCBjY2VyOwor
CisJCW1hc2sgPSBUSU1fQ0NFUl9DQ3hFKGNoICsgMSk7CisJCWlmIChwcml2LT5oYXZlX2NvbXBs
ZW1lbnRhcnlfb3V0cHV0KQorCQkJbWFzayB8PSBUSU1fQ0NFUl9DQ3hORShjaCArIDEpOworCisJ
CXJldCA9IHJlZ21hcF9yZWFkKHByaXYtPnJlZ21hcCwgVElNX0NDRVIsICZjY2VyKTsKKwkJaWYg
KHJldCkKKwkJCWdvdG8gb3V0OworCisJCWlmIChjY2VyICYgbWFzaykgeworCQkJY2NlciA9IGNj
ZXIgJiB+bWFzazsKKworCQkJcmV0ID0gcmVnbWFwX3dyaXRlKHByaXYtPnJlZ21hcCwgVElNX0ND
RVIsIGNjZXIpOworCQkJaWYgKHJldCkKKwkJCQlnb3RvIG91dDsKKworCQkJaWYgKCEoY2NlciAm
IFRJTV9DQ0VSX0NDWEUpKSB7CisJCQkJLyogV2hlbiBhbGwgY2hhbm5lbHMgYXJlIGRpc2FibGVk
LCB3ZSBjYW4gZGlzYWJsZSB0aGUgY29udHJvbGxlciAqLworCQkJCXJldCA9IHJlZ21hcF9jbGVh
cl9iaXRzKHByaXYtPnJlZ21hcCwgVElNX0NSMSwgVElNX0NSMV9DRU4pOworCQkJCWlmIChyZXQp
CisJCQkJCWdvdG8gb3V0OworCQkJfQorCisJCQljbGtfZGlzYWJsZShwcml2LT5jbGspOworCQl9
CisJfQorCitvdXQ6CisJY2xrX2Rpc2FibGUocHJpdi0+Y2xrKTsKKworCXJldHVybiByZXQ7Cit9
CisKICNkZWZpbmUgVElNX0NDRVJfQ0MxMlAgKFRJTV9DQ0VSX0NDMVAgfCBUSU1fQ0NFUl9DQzJQ
KQogI2RlZmluZSBUSU1fQ0NFUl9DQzEyRSAoVElNX0NDRVJfQ0MxRSB8IFRJTV9DQ0VSX0NDMkUp
CiAjZGVmaW5lIFRJTV9DQ0VSX0NDMzRQIChUSU1fQ0NFUl9DQzNQIHwgVElNX0NDRVJfQ0M0UCkK
QEAgLTMwOCwyMjggKzY4OCwxMyBAQCBzdGF0aWMgaW50IHN0bTMyX3B3bV9jYXB0dXJlKHN0cnVj
dCBwd21fY2hpcCAqY2hpcCwgc3RydWN0IHB3bV9kZXZpY2UgKnB3bSwKIAlyZXR1cm4gcmV0Owog
fQogCi1zdGF0aWMgaW50IHN0bTMyX3B3bV9jb25maWcoc3RydWN0IHN0bTMyX3B3bSAqcHJpdiwg
dW5zaWduZWQgaW50IGNoLAotCQkJICAgIHU2NCBkdXR5X25zLCB1NjQgcGVyaW9kX25zKQotewot
CXVuc2lnbmVkIGxvbmcgbG9uZyBwcmQsIGR0eTsKLQl1bnNpZ25lZCBsb25nIGxvbmcgcHJlc2Nh
bGVyOwotCXUzMiBjY21yLCBtYXNrLCBzaGlmdDsKLQotCS8qCi0JICogLnByb2JlKCkgYXNzZXJ0
ZWQgdGhhdCBjbGtfZ2V0X3JhdGUoKSBpcyBub3QgYmlnZ2VyIHRoYW4gMSBHSHosIHNvCi0JICog
dGhlIGNhbGN1bGF0aW9ucyBoZXJlIHdvbid0IG92ZXJmbG93LgotCSAqIEZpcnN0IHdlIG5lZWQg
dG8gZmluZCB0aGUgbWluaW1hbCB2YWx1ZSBmb3IgcHJlc2NhbGVyIHN1Y2ggdGhhdAotCSAqCi0J
ICogICAgICAgIHBlcmlvZF9ucyAqIGNsa3JhdGUKLQkgKiAgIC0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLSA8IG1heF9hcnIgKyAxCi0JICogICBOU0VDX1BFUl9TRUMgKiAocHJlc2NhbGVy
ICsgMSkKLQkgKgotCSAqIFRoaXMgZXF1YXRpb24gaXMgZXF1aXZhbGVudCB0bwotCSAqCi0JICog
ICAgICAgIHBlcmlvZF9ucyAqIGNsa3JhdGUKLQkgKiAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0gPCBwcmVzY2FsZXIgKyAxCi0JICogICBOU0VDX1BFUl9TRUMgKiAobWF4X2FyciArIDEp
Ci0JICoKLQkgKiBVc2luZyBpbnRlZ2VyIGRpdmlzaW9uIGFuZCBrbm93aW5nIHRoYXQgdGhlIHJp
Z2h0IGhhbmQgc2lkZSBpcwotCSAqIGludGVnZXIsIHRoaXMgaXMgZnVydGhlciBlcXVpdmFsZW50
IHRvCi0JICoKLQkgKiAgIChwZXJpb2RfbnMgKiBjbGtyYXRlKSAvLyAoTlNFQ19QRVJfU0VDICog
KG1heF9hcnIgKyAxKSkg4omkIHByZXNjYWxlcgotCSAqLwotCi0JcHJlc2NhbGVyID0gbXVsX3U2
NF91NjRfZGl2X3U2NChwZXJpb2RfbnMsIGNsa19nZXRfcmF0ZShwcml2LT5jbGspLAotCQkJCQko
dTY0KU5TRUNfUEVSX1NFQyAqICgodTY0KXByaXYtPm1heF9hcnIgKyAxKSk7Ci0JaWYgKHByZXNj
YWxlciA+IE1BWF9USU1fUFNDKQotCQlyZXR1cm4gLUVJTlZBTDsKLQotCXByZCA9IG11bF91NjRf
dTY0X2Rpdl91NjQocGVyaW9kX25zLCBjbGtfZ2V0X3JhdGUocHJpdi0+Y2xrKSwKLQkJCQkgICh1
NjQpTlNFQ19QRVJfU0VDICogKHByZXNjYWxlciArIDEpKTsKLQlpZiAoIXByZCkKLQkJcmV0dXJu
IC1FSU5WQUw7Ci0KLQkvKgotCSAqIEFsbCBjaGFubmVscyBzaGFyZSB0aGUgc2FtZSBwcmVzY2Fs
ZXIgYW5kIGNvdW50ZXIgc28gd2hlbiB0d28KLQkgKiBjaGFubmVscyBhcmUgYWN0aXZlIGF0IHRo
ZSBzYW1lIHRpbWUgd2UgY2FuJ3QgY2hhbmdlIHRoZW0KLQkgKi8KLQlpZiAoYWN0aXZlX2NoYW5u
ZWxzKHByaXYpICYgfigxIDw8IGNoICogNCkpIHsKLQkJdTMyIHBzYywgYXJyOwotCi0JCXJlZ21h
cF9yZWFkKHByaXYtPnJlZ21hcCwgVElNX1BTQywgJnBzYyk7Ci0JCXJlZ21hcF9yZWFkKHByaXYt
PnJlZ21hcCwgVElNX0FSUiwgJmFycik7Ci0KLQkJaWYgKChwc2MgIT0gcHJlc2NhbGVyKSB8fCAo
YXJyICE9IHByZCAtIDEpKQotCQkJcmV0dXJuIC1FQlVTWTsKLQl9Ci0KLQlyZWdtYXBfd3JpdGUo
cHJpdi0+cmVnbWFwLCBUSU1fUFNDLCBwcmVzY2FsZXIpOwotCXJlZ21hcF93cml0ZShwcml2LT5y
ZWdtYXAsIFRJTV9BUlIsIHByZCAtIDEpOwotCXJlZ21hcF9zZXRfYml0cyhwcml2LT5yZWdtYXAs
IFRJTV9DUjEsIFRJTV9DUjFfQVJQRSk7Ci0KLQkvKiBDYWxjdWxhdGUgdGhlIGR1dHkgY3ljbGVz
ICovCi0JZHR5ID0gbXVsX3U2NF91NjRfZGl2X3U2NChkdXR5X25zLCBjbGtfZ2V0X3JhdGUocHJp
di0+Y2xrKSwKLQkJCQkgICh1NjQpTlNFQ19QRVJfU0VDICogKHByZXNjYWxlciArIDEpKTsKLQot
CXJlZ21hcF93cml0ZShwcml2LT5yZWdtYXAsIFRJTV9DQ1J4KGNoICsgMSksIGR0eSk7Ci0KLQkv
KiBDb25maWd1cmUgb3V0cHV0IG1vZGUgKi8KLQlzaGlmdCA9IChjaCAmIDB4MSkgKiBDQ01SX0NI
QU5ORUxfU0hJRlQ7Ci0JY2NtciA9IChUSU1fQ0NNUl9QRSB8IFRJTV9DQ01SX00xKSA8PCBzaGlm
dDsKLQltYXNrID0gQ0NNUl9DSEFOTkVMX01BU0sgPDwgc2hpZnQ7Ci0KLQlpZiAoY2ggPCAyKQot
CQlyZWdtYXBfdXBkYXRlX2JpdHMocHJpdi0+cmVnbWFwLCBUSU1fQ0NNUjEsIG1hc2ssIGNjbXIp
OwotCWVsc2UKLQkJcmVnbWFwX3VwZGF0ZV9iaXRzKHByaXYtPnJlZ21hcCwgVElNX0NDTVIyLCBt
YXNrLCBjY21yKTsKLQotCXJlZ21hcF9zZXRfYml0cyhwcml2LT5yZWdtYXAsIFRJTV9CRFRSLCBU
SU1fQkRUUl9NT0UpOwotCi0JcmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyBpbnQgc3RtMzJfcHdtX3Nl
dF9wb2xhcml0eShzdHJ1Y3Qgc3RtMzJfcHdtICpwcml2LCB1bnNpZ25lZCBpbnQgY2gsCi0JCQkJ
ICBlbnVtIHB3bV9wb2xhcml0eSBwb2xhcml0eSkKLXsKLQl1MzIgbWFzazsKLQotCW1hc2sgPSBU
SU1fQ0NFUl9DQ3hQKGNoICsgMSk7Ci0JaWYgKHByaXYtPmhhdmVfY29tcGxlbWVudGFyeV9vdXRw
dXQpCi0JCW1hc2sgfD0gVElNX0NDRVJfQ0N4TlAoY2ggKyAxKTsKLQotCXJlZ21hcF91cGRhdGVf
Yml0cyhwcml2LT5yZWdtYXAsIFRJTV9DQ0VSLCBtYXNrLAotCQkJICAgcG9sYXJpdHkgPT0gUFdN
X1BPTEFSSVRZX05PUk1BTCA/IDAgOiBtYXNrKTsKLQotCXJldHVybiAwOwotfQotCi1zdGF0aWMg
aW50IHN0bTMyX3B3bV9lbmFibGUoc3RydWN0IHN0bTMyX3B3bSAqcHJpdiwgdW5zaWduZWQgaW50
IGNoKQotewotCXUzMiBtYXNrOwotCWludCByZXQ7Ci0KLQlyZXQgPSBjbGtfZW5hYmxlKHByaXYt
PmNsayk7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKLQotCS8qIEVuYWJsZSBjaGFubmVsICov
Ci0JbWFzayA9IFRJTV9DQ0VSX0NDeEUoY2ggKyAxKTsKLQlpZiAocHJpdi0+aGF2ZV9jb21wbGVt
ZW50YXJ5X291dHB1dCkKLQkJbWFzayB8PSBUSU1fQ0NFUl9DQ3hORShjaCk7Ci0KLQlyZWdtYXBf
c2V0X2JpdHMocHJpdi0+cmVnbWFwLCBUSU1fQ0NFUiwgbWFzayk7Ci0KLQkvKiBNYWtlIHN1cmUg
dGhhdCByZWdpc3RlcnMgYXJlIHVwZGF0ZWQgKi8KLQlyZWdtYXBfc2V0X2JpdHMocHJpdi0+cmVn
bWFwLCBUSU1fRUdSLCBUSU1fRUdSX1VHKTsKLQotCS8qIEVuYWJsZSBjb250cm9sbGVyICovCi0J
cmVnbWFwX3NldF9iaXRzKHByaXYtPnJlZ21hcCwgVElNX0NSMSwgVElNX0NSMV9DRU4pOwotCi0J
cmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyB2b2lkIHN0bTMyX3B3bV9kaXNhYmxlKHN0cnVjdCBzdG0z
Ml9wd20gKnByaXYsIHVuc2lnbmVkIGludCBjaCkKLXsKLQl1MzIgbWFzazsKLQotCS8qIERpc2Fi
bGUgY2hhbm5lbCAqLwotCW1hc2sgPSBUSU1fQ0NFUl9DQ3hFKGNoICsgMSk7Ci0JaWYgKHByaXYt
PmhhdmVfY29tcGxlbWVudGFyeV9vdXRwdXQpCi0JCW1hc2sgfD0gVElNX0NDRVJfQ0N4TkUoY2gg
KyAxKTsKLQotCXJlZ21hcF9jbGVhcl9iaXRzKHByaXYtPnJlZ21hcCwgVElNX0NDRVIsIG1hc2sp
OwotCi0JLyogV2hlbiBhbGwgY2hhbm5lbHMgYXJlIGRpc2FibGVkLCB3ZSBjYW4gZGlzYWJsZSB0
aGUgY29udHJvbGxlciAqLwotCWlmICghYWN0aXZlX2NoYW5uZWxzKHByaXYpKQotCQlyZWdtYXBf
Y2xlYXJfYml0cyhwcml2LT5yZWdtYXAsIFRJTV9DUjEsIFRJTV9DUjFfQ0VOKTsKLQotCWNsa19k
aXNhYmxlKHByaXYtPmNsayk7Ci19Ci0KLXN0YXRpYyBpbnQgc3RtMzJfcHdtX2FwcGx5KHN0cnVj
dCBwd21fY2hpcCAqY2hpcCwgc3RydWN0IHB3bV9kZXZpY2UgKnB3bSwKLQkJCSAgIGNvbnN0IHN0
cnVjdCBwd21fc3RhdGUgKnN0YXRlKQotewotCWJvb2wgZW5hYmxlZDsKLQlzdHJ1Y3Qgc3RtMzJf
cHdtICpwcml2ID0gdG9fc3RtMzJfcHdtX2RldihjaGlwKTsKLQlpbnQgcmV0OwotCi0JZW5hYmxl
ZCA9IHB3bS0+c3RhdGUuZW5hYmxlZDsKLQotCWlmICghc3RhdGUtPmVuYWJsZWQpIHsKLQkJaWYg
KGVuYWJsZWQpCi0JCQlzdG0zMl9wd21fZGlzYWJsZShwcml2LCBwd20tPmh3cHdtKTsKLQkJcmV0
dXJuIDA7Ci0JfQotCi0JaWYgKHN0YXRlLT5wb2xhcml0eSAhPSBwd20tPnN0YXRlLnBvbGFyaXR5
KQotCQlzdG0zMl9wd21fc2V0X3BvbGFyaXR5KHByaXYsIHB3bS0+aHdwd20sIHN0YXRlLT5wb2xh
cml0eSk7Ci0KLQlyZXQgPSBzdG0zMl9wd21fY29uZmlnKHByaXYsIHB3bS0+aHdwd20sCi0JCQkg
ICAgICAgc3RhdGUtPmR1dHlfY3ljbGUsIHN0YXRlLT5wZXJpb2QpOwotCWlmIChyZXQpCi0JCXJl
dHVybiByZXQ7Ci0KLQlpZiAoIWVuYWJsZWQgJiYgc3RhdGUtPmVuYWJsZWQpCi0JCXJldCA9IHN0
bTMyX3B3bV9lbmFibGUocHJpdiwgcHdtLT5od3B3bSk7Ci0KLQlyZXR1cm4gcmV0OwotfQotCi1z
dGF0aWMgaW50IHN0bTMyX3B3bV9hcHBseV9sb2NrZWQoc3RydWN0IHB3bV9jaGlwICpjaGlwLCBz
dHJ1Y3QgcHdtX2RldmljZSAqcHdtLAotCQkJCSAgY29uc3Qgc3RydWN0IHB3bV9zdGF0ZSAqc3Rh
dGUpCi17Ci0Jc3RydWN0IHN0bTMyX3B3bSAqcHJpdiA9IHRvX3N0bTMyX3B3bV9kZXYoY2hpcCk7
Ci0JaW50IHJldDsKLQotCS8qIHByb3RlY3QgY29tbW9uIHByZXNjYWxlciBmb3IgYWxsIGFjdGl2
ZSBjaGFubmVscyAqLwotCW11dGV4X2xvY2soJnByaXYtPmxvY2spOwotCXJldCA9IHN0bTMyX3B3
bV9hcHBseShjaGlwLCBwd20sIHN0YXRlKTsKLQltdXRleF91bmxvY2soJnByaXYtPmxvY2spOwot
Ci0JcmV0dXJuIHJldDsKLX0KLQotc3RhdGljIGludCBzdG0zMl9wd21fZ2V0X3N0YXRlKHN0cnVj
dCBwd21fY2hpcCAqY2hpcCwKLQkJCSAgICAgICBzdHJ1Y3QgcHdtX2RldmljZSAqcHdtLCBzdHJ1
Y3QgcHdtX3N0YXRlICpzdGF0ZSkKLXsKLQlzdHJ1Y3Qgc3RtMzJfcHdtICpwcml2ID0gdG9fc3Rt
MzJfcHdtX2RldihjaGlwKTsKLQlpbnQgY2ggPSBwd20tPmh3cHdtOwotCXVuc2lnbmVkIGxvbmcg
cmF0ZTsKLQl1MzIgY2NlciwgcHNjLCBhcnIsIGNjcjsKLQl1NjQgZHR5LCBwcmQ7Ci0JaW50IHJl
dDsKLQotCW11dGV4X2xvY2soJnByaXYtPmxvY2spOwotCi0JcmV0ID0gcmVnbWFwX3JlYWQocHJp
di0+cmVnbWFwLCBUSU1fQ0NFUiwgJmNjZXIpOwotCWlmIChyZXQpCi0JCWdvdG8gb3V0OwotCi0J
c3RhdGUtPmVuYWJsZWQgPSBjY2VyICYgVElNX0NDRVJfQ0N4RShjaCArIDEpOwotCXN0YXRlLT5w
b2xhcml0eSA9IChjY2VyICYgVElNX0NDRVJfQ0N4UChjaCArIDEpKSA/Ci0JCQkgIFBXTV9QT0xB
UklUWV9JTlZFUlNFRCA6IFBXTV9QT0xBUklUWV9OT1JNQUw7Ci0JcmV0ID0gcmVnbWFwX3JlYWQo
cHJpdi0+cmVnbWFwLCBUSU1fUFNDLCAmcHNjKTsKLQlpZiAocmV0KQotCQlnb3RvIG91dDsKLQly
ZXQgPSByZWdtYXBfcmVhZChwcml2LT5yZWdtYXAsIFRJTV9BUlIsICZhcnIpOwotCWlmIChyZXQp
Ci0JCWdvdG8gb3V0OwotCXJldCA9IHJlZ21hcF9yZWFkKHByaXYtPnJlZ21hcCwgVElNX0NDUngo
Y2ggKyAxKSwgJmNjcik7Ci0JaWYgKHJldCkKLQkJZ290byBvdXQ7Ci0KLQlyYXRlID0gY2xrX2dl
dF9yYXRlKHByaXYtPmNsayk7Ci0KLQlwcmQgPSAodTY0KU5TRUNfUEVSX1NFQyAqIChwc2MgKyAx
KSAqIChhcnIgKyAxKTsKLQlzdGF0ZS0+cGVyaW9kID0gRElWX1JPVU5EX1VQX1VMTChwcmQsIHJh
dGUpOwotCWR0eSA9ICh1NjQpTlNFQ19QRVJfU0VDICogKHBzYyArIDEpICogY2NyOwotCXN0YXRl
LT5kdXR5X2N5Y2xlID0gRElWX1JPVU5EX1VQX1VMTChkdHksIHJhdGUpOwotCi1vdXQ6Ci0JbXV0
ZXhfdW5sb2NrKCZwcml2LT5sb2NrKTsKLQlyZXR1cm4gcmV0OwotfQotCiBzdGF0aWMgY29uc3Qg
c3RydWN0IHB3bV9vcHMgc3RtMzJwd21fb3BzID0gewotCS5hcHBseSA9IHN0bTMyX3B3bV9hcHBs
eV9sb2NrZWQsCi0JLmdldF9zdGF0ZSA9IHN0bTMyX3B3bV9nZXRfc3RhdGUsCisJLnNpemVvZl93
Zmh3ID0gc2l6ZW9mKHN0cnVjdCBzdG0zMl9wd21fd2F2ZWZvcm0pLAorCS5yb3VuZF93YXZlZm9y
bV90b2h3ID0gc3RtMzJfcHdtX3JvdW5kX3dhdmVmb3JtX3RvaHcsCisJLnJvdW5kX3dhdmVmb3Jt
X2Zyb21odyA9IHN0bTMyX3B3bV9yb3VuZF93YXZlZm9ybV9mcm9taHcsCisJLnJlYWRfd2F2ZWZv
cm0gPSBzdG0zMl9wd21fcmVhZF93YXZlZm9ybSwKKwkud3JpdGVfd2F2ZWZvcm0gPSBzdG0zMl9w
d21fd3JpdGVfd2F2ZWZvcm0sCisKIAkuY2FwdHVyZSA9IElTX0VOQUJMRUQoQ09ORklHX0RNQV9F
TkdJTkUpID8gc3RtMzJfcHdtX2NhcHR1cmUgOiBOVUxMLAogfTsKIAotLSAKMi40My4wCgpfX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpMaW51eC1zdG0zMiBt
YWlsaW5nIGxpc3QKTGludXgtc3RtMzJAc3QtbWQtbWFpbG1hbi5zdG9ybXJlcGx5LmNvbQpodHRw
czovL3N0LW1kLW1haWxtYW4uc3Rvcm1yZXBseS5jb20vbWFpbG1hbi9saXN0aW5mby9saW51eC1z
dG0zMgo=
